<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>å®‰è£…æ’ä»¶æ–¹å¼æ¥è¿è¡Œgrafana-image-renderer</title>
      <link href="/posts/su3lwr/"/>
      <url>/posts/su3lwr/</url>
      
        <content type="html"><![CDATA[<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grafana-cli plugins install grafana-image-renderer</span><br></pre></td></tr></table></figure><p>æˆ–è€…å¯ä»¥åˆ°è¿™é‡Œ<a href="https://grafana.com/grafana/plugins/grafana-image-renderer/?tab=installation">https://grafana.com/grafana/plugins/grafana-image-renderer/?tab=installation</a>ä¸‹è½½ç¦»çº¿åŒ…ï¼Œç„¶åæ”¾åˆ° plugins æ–‡ä»¶å¤¹ä¸‹ã€‚éœ€è¦æ³¨æ„ä¸‹ plugins æ–‡ä»¶å¤¹çš„ä½ç½®ï¼Œå¯èƒ½ä½¿ç”¨å‘½ä»¤å®‰è£…çš„è·¯å¾„å’ŒçœŸå®çš„ plugins ç›®å½•ä¸ä¸€è‡´ã€‚<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/20250402181200283.png" alt="image.png|654"></p><p>å¦‚æœæ’ä»¶å¯åŠ¨å¤±è´¥ï¼ŒæŠ¥é”™ï¼šå¯ä»¥æ£€æŸ¥ä¸‹ <code>plugins/grafana-image-renderer/chrome-headless-shell/linux-136.0.7101.0/chrome-headless-shell-linux64</code> è¿™ä¸ªç¨‹åºèƒ½å¦æ­£å¸¸è¿è¡Œï¼Œå¦‚æœæŠ¥é”™<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/20250402181642753.png" alt="image.png"></p><p>éœ€è¦å®‰è£… <code>apt install -y libasound2t64</code></p><h2 id="å®Œæ•´é…ç½®å®¹å™¨"><a href="#å®Œæ•´é…ç½®å®¹å™¨" class="headerlink" title="å®Œæ•´é…ç½®å®¹å™¨"></a>å®Œæ•´é…ç½®å®¹å™¨</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unzip </span><br></pre></td></tr></table></figure><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> grafana/grafana-oss:<span class="number">11.6</span>.<span class="number">0</span>-ubuntu</span><br><span class="line"><span class="keyword">USER</span> root</span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash"> grafana-image-renderer /var/lib/grafana/plugins/grafana-image-renderer/</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker build . -t xxx</span><br><span class="line">docker run --name a xxx </span><br><span class="line">docker <span class="built_in">exec</span> -it a bash</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªè„šæœ¬å¿…é¡»è¦ç™»å½•å®¹å™¨åè¿è¡Œï¼Œå¦‚æœå†™åœ¨ dockerfile ä¸­ï¼Œä¸èƒ½æ‰§è¡Œï¼Œå¾ˆç¥å¥‡ï¼Œæš‚æ—¶ä¸çŸ¥é“åŸå› ï¼Œæ‰€ä»¥æˆ‘å®¹å™¨åˆ›å»ºå¥½äº†ä¹‹åï¼Œå† <code>docker commit</code> åšçš„é•œåƒã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sed -i <span class="string">&#x27;s@//.*archive.ubuntu.com@//mirrors.aliyun.com@g&#x27;</span> /etc/apt/sources.list</span><br><span class="line">sed -i <span class="string">&#x27;s/security.ubuntu.com/mirrors.aliyun.com/g&#x27;</span> /etc/apt/sources.list</span><br><span class="line">apt-get update</span><br><span class="line">apt-get install -y ca-certificates fonts-liberation libasound2 libatk-bridge2.0-0 libatk1.0-0 libc6 libcairo2 libcups2 libdbus-1-3 libexpat1 libfontconfig1 libgbm1 libgcc1 libglib2.0-0 libgtk-3-0 libnspr4 libnss3 libpango-1.0-0 libpangocairo-1.0-0 libstdc++6 libx11-6 libx11-xcb1 libxcb1 libxcomposite1 libxcursor1 libxdamage1 libxext6 libxfixes3 libxi6 libxrandr2 libxrender1 libxss1 libxtst6 lsb-release wget xdg-utils fonts-noto-cjk fonts-wqy-microhei</span><br><span class="line">fc-cache -f -v</span><br><span class="line">apt clean all</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ‰‹åŠ¨commit</span></span><br><span class="line">docker commit grafana registry.cn-hangzhou.aliyuncs.com/iuxt/grafana-with-render:1</span><br></pre></td></tr></table></figure><p>k8s è¿è¡Œçš„æ—¶å€™ï¼Œéœ€è¦é…ç½® <code>root_url</code> è¢«è¿™ä¸ªå‘äº†å¾ˆä¹…</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">sre-grafana</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">ops</span></span><br><span class="line">  <span class="attr">generation:</span> <span class="number">22</span></span><br><span class="line">  <span class="attr">creationTimestamp:</span> <span class="string">&#x27;2024-10-12T08:37:23Z&#x27;</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">sre-grafana</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">deployment.kubernetes.io/revision:</span> <span class="string">&#x27;22&#x27;</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">sre-grafana</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">creationTimestamp:</span> <span class="literal">null</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">sre-grafana</span></span><br><span class="line">      <span class="attr">annotations:</span></span><br><span class="line">        <span class="attr">kubectl.kubernetes.io/redeployAt:</span> <span class="string">&#x27;2024-10-28 11:28:33&#x27;</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">ldap-config</span></span><br><span class="line">          <span class="attr">configMap:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">grafana-ldap-config</span></span><br><span class="line">            <span class="attr">defaultMode:</span> <span class="number">420</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">grafana</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">registry.cn-hangzhou.aliyuncs.com/iuxt/grafana-with-render:1</span></span><br><span class="line">          <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">http-grafana</span></span><br><span class="line">              <span class="attr">containerPort:</span> <span class="number">3000</span></span><br><span class="line">              <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">          <span class="attr">env:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">GF_AUTH_BASIC_ENABLED</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&#x27;true&#x27;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">GF_AUTH_ANONYMOUS_ENABLED</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&#x27;false&#x27;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">GF_AUTH_ANONYMOUS_ORG_ROLE</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">Admin</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">GF_DASHBOARDS_JSON_ENABLED</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&#x27;true&#x27;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">GF_SECURITY_ADMIN_USER</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">admin</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">GF_SECURITY_ADMIN_PASSWORD</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">admin</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">GF_DATABASE_TYPE</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">mysql</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">GF_DATABASE_HOST</span></span><br><span class="line">              <span class="attr">value:</span> <span class="number">10.10</span><span class="number">.10</span><span class="number">.10</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">GF_DATABASE_PORT</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&#x27;3306&#x27;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">GF_DATABASE_USER</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">root</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">GF_DATABASE_PASSWORD</span></span><br><span class="line">              <span class="attr">value:</span> <span class="number">123456</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">GF_DATABASE_NAME</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">sre-grafana</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">GF_AUTH_LDAP_ENABLED</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&#x27;true&#x27;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">GF_AUTH_LDAP_ALLOW_SIGN_UP</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&#x27;true&#x27;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">GF_AUTH_LDAP_CONFIG_FILE</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">/etc/grafana/ldap.toml</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">GF_SERVER_ROOT_URL</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">https://sre-grafana.ingeek.com/</span></span><br><span class="line">          <span class="attr">resources:</span></span><br><span class="line">            <span class="attr">requests:</span></span><br><span class="line">              <span class="attr">cpu:</span> <span class="string">250m</span></span><br><span class="line">              <span class="attr">memory:</span> <span class="string">750Mi</span></span><br><span class="line">          <span class="attr">volumeMounts:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">ldap-config</span></span><br><span class="line">              <span class="attr">mountPath:</span> <span class="string">/etc/grafana/ldap.toml</span></span><br><span class="line">              <span class="attr">subPath:</span> <span class="string">ldap.toml</span></span><br><span class="line">          <span class="attr">livenessProbe:</span></span><br><span class="line">            <span class="attr">tcpSocket:</span></span><br><span class="line">              <span class="attr">port:</span> <span class="number">3000</span></span><br><span class="line">            <span class="attr">initialDelaySeconds:</span> <span class="number">30</span></span><br><span class="line">            <span class="attr">timeoutSeconds:</span> <span class="number">1</span></span><br><span class="line">            <span class="attr">periodSeconds:</span> <span class="number">10</span></span><br><span class="line">            <span class="attr">successThreshold:</span> <span class="number">1</span></span><br><span class="line">            <span class="attr">failureThreshold:</span> <span class="number">3</span></span><br><span class="line">          <span class="attr">readinessProbe:</span></span><br><span class="line">            <span class="attr">httpGet:</span></span><br><span class="line">              <span class="attr">path:</span> <span class="string">/robots.txt</span></span><br><span class="line">              <span class="attr">port:</span> <span class="number">3000</span></span><br><span class="line">              <span class="attr">scheme:</span> <span class="string">HTTP</span></span><br><span class="line">            <span class="attr">initialDelaySeconds:</span> <span class="number">10</span></span><br><span class="line">            <span class="attr">timeoutSeconds:</span> <span class="number">2</span></span><br><span class="line">            <span class="attr">periodSeconds:</span> <span class="number">30</span></span><br><span class="line">            <span class="attr">successThreshold:</span> <span class="number">1</span></span><br><span class="line">            <span class="attr">failureThreshold:</span> <span class="number">3</span></span><br><span class="line">          <span class="attr">terminationMessagePath:</span> <span class="string">/dev/termination-log</span></span><br><span class="line">          <span class="attr">terminationMessagePolicy:</span> <span class="string">File</span></span><br><span class="line">          <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">      <span class="attr">restartPolicy:</span> <span class="string">Always</span></span><br><span class="line">      <span class="attr">terminationGracePeriodSeconds:</span> <span class="number">30</span></span><br><span class="line">      <span class="attr">dnsPolicy:</span> <span class="string">ClusterFirst</span></span><br><span class="line">      <span class="attr">securityContext:</span></span><br><span class="line">        <span class="attr">supplementalGroups:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="number">0</span></span><br><span class="line">        <span class="attr">fsGroup:</span> <span class="number">472</span></span><br><span class="line">      <span class="attr">schedulerName:</span> <span class="string">default-scheduler</span></span><br><span class="line">  <span class="attr">strategy:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">RollingUpdate</span></span><br><span class="line">    <span class="attr">rollingUpdate:</span></span><br><span class="line">      <span class="attr">maxUnavailable:</span> <span class="number">25</span><span class="string">%</span></span><br><span class="line">      <span class="attr">maxSurge:</span> <span class="number">25</span><span class="string">%</span></span><br><span class="line">  <span class="attr">revisionHistoryLimit:</span> <span class="number">10</span></span><br><span class="line">  <span class="attr">progressDeadlineSeconds:</span> <span class="number">600</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="meta"></span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç›‘æ§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
            <tag> grafana </tag>
            
            <tag> Puppeteer </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨ Python è‡ªåŠ¨æˆªå›¾ Grafana ä»ªè¡¨ç›˜ï¼Œå®ç°å¯è§†åŒ–ç›‘æ§å¿«ç…§</title>
      <link href="/posts/stucr2/"/>
      <url>/posts/stucr2/</url>
      
        <content type="html"><![CDATA[<p>å®˜æ–¹é…ç½®æ–‡æ¡£åœ¨è¿™é‡Œï¼š<a href="https://grafana.com/docs/grafana/latest/setup-grafana/image-rendering/">https://grafana.com/docs/grafana/latest/setup-grafana/image-rendering/</a> ä½¿ç”¨æ–¹å¼æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯ç›´æ¥åœ¨ grafana æœºå™¨ä¸Šå®‰è£…æ’ä»¶ï¼Œå¦ä¸€ä¸ªæ˜¯ä½¿ç”¨å¤–æŒ‚æ¸²æŸ“å™¨çš„æ–¹å¼ã€‚</p><h2 id="éƒ¨ç½²æ¸²æŸ“å™¨-grafana-image-renderer"><a href="#éƒ¨ç½²æ¸²æŸ“å™¨-grafana-image-renderer" class="headerlink" title="éƒ¨ç½²æ¸²æŸ“å™¨ grafana-image-renderer"></a>éƒ¨ç½²æ¸²æŸ“å™¨ grafana-image-renderer</h2><blockquote><p>å®˜æ–¹æœ‰ç°æˆçš„é•œåƒï¼Œä¹Ÿå¯ä»¥ä¸ç”¨è‡ªå·±æ„å»ºé•œåƒ: <code>grafana/grafana-image-renderer:3.12.3</code> ä¹Ÿå¯ä»¥ç”¨ bitnami æ‰“åŒ…çš„é•œåƒï¼š<code>bitnami/grafana-image-renderer:latest</code>ï¼Œ æˆ‘å“¼å“§å“¼å“§æäº†åŠå¤©æ‰æƒ³èµ·æ¥å®˜æ–¹ä¹Ÿæœ‰é•œåƒğŸ˜“</p></blockquote><p>æˆ‘çš„ grafana æ˜¯è¿è¡Œåœ¨ kubernetes é‡Œçš„ï¼Œæ‰€ä»¥é€‰æ‹©ç”¨å¤–æŒ‚æ¸²æŸ“å™¨çš„æ–¹æ³•ã€‚æ¸²æŸ“å™¨æ ¸å¿ƒç”¨çš„æ˜¯ Puppeteerï¼Œæ ¹æ®å®˜ç½‘æ–‡æ¡£å®‰è£…ä¾èµ–åŒ…ï¼š<a href="https://pptr.dev/troubleshooting#chrome-doesnt-launch-on-linux">https://pptr.dev/troubleshooting#chrome-doesnt-launch-on-linux</a> ï¼Œå¦å¤–å¢åŠ äº†ä¸­æ–‡å­—ä½“åŒ…ï¼Œè§£å†³äº†ä¸­æ–‡æ˜¾ç¤ºæ¡†æ¡†çš„é—®é¢˜ã€‚æœ€ç»ˆçš„æ¸²æŸ“å™¨é•œåƒ dockerfile å¦‚ä¸‹ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> node:<span class="number">22.14</span>.<span class="number">0</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> git <span class="built_in">clone</span> --depth 1 https://github.com/grafana/grafana-image-renderer.git /app &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    <span class="built_in">cd</span> /app &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    yarn install --pure-lockfile &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    yarn run build</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> sed -i <span class="string">&#x27;s/deb.debian.org/mirrors.ustc.edu.cn/g&#x27;</span> /etc/apt/sources.list.d/debian.sources &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    apt-get update &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    apt-get install -y \</span></span><br><span class="line"><span class="language-bash">    ca-certificates \</span></span><br><span class="line"><span class="language-bash">    fonts-liberation \</span></span><br><span class="line"><span class="language-bash">    libasound2 \</span></span><br><span class="line"><span class="language-bash">    libatk-bridge2.0-0 \</span></span><br><span class="line"><span class="language-bash">    libatk1.0-0 \</span></span><br><span class="line"><span class="language-bash">    libc6 \</span></span><br><span class="line"><span class="language-bash">    libcairo2 \</span></span><br><span class="line"><span class="language-bash">    libcups2 \</span></span><br><span class="line"><span class="language-bash">    libdbus-1-3 \</span></span><br><span class="line"><span class="language-bash">    libexpat1 \</span></span><br><span class="line"><span class="language-bash">    libfontconfig1 \</span></span><br><span class="line"><span class="language-bash">    libgbm1 \</span></span><br><span class="line"><span class="language-bash">    libgcc1 \</span></span><br><span class="line"><span class="language-bash">    libglib2.0-0 \</span></span><br><span class="line"><span class="language-bash">    libgtk-3-0 \</span></span><br><span class="line"><span class="language-bash">    libnspr4 \</span></span><br><span class="line"><span class="language-bash">    libnss3 \</span></span><br><span class="line"><span class="language-bash">    libpango-1.0-0 \</span></span><br><span class="line"><span class="language-bash">    libpangocairo-1.0-0 \</span></span><br><span class="line"><span class="language-bash">    libstdc++6 \</span></span><br><span class="line"><span class="language-bash">    libx11-6 \</span></span><br><span class="line"><span class="language-bash">    libx11-xcb1 \</span></span><br><span class="line"><span class="language-bash">    libxcb1 \</span></span><br><span class="line"><span class="language-bash">    libxcomposite1 \</span></span><br><span class="line"><span class="language-bash">    libxcursor1 \</span></span><br><span class="line"><span class="language-bash">    libxdamage1 \</span></span><br><span class="line"><span class="language-bash">    libxext6 \</span></span><br><span class="line"><span class="language-bash">    libxfixes3 \</span></span><br><span class="line"><span class="language-bash">    libxi6 \</span></span><br><span class="line"><span class="language-bash">    libxrandr2 \</span></span><br><span class="line"><span class="language-bash">    libxrender1 \</span></span><br><span class="line"><span class="language-bash">    libxss1 \</span></span><br><span class="line"><span class="language-bash">    libxtst6 \</span></span><br><span class="line"><span class="language-bash">    lsb-release \</span></span><br><span class="line"><span class="language-bash">    wget \</span></span><br><span class="line"><span class="language-bash">    xdg-utils \</span></span><br><span class="line"><span class="language-bash">    fonts-noto-cjk \</span></span><br><span class="line"><span class="language-bash">    fonts-wqy-microhei &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    fc-cache -f -v &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    apt clean all</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;node&quot;</span>, <span class="string">&quot;build/app.js&quot;</span>, <span class="string">&quot;server&quot;</span>]</span></span><br></pre></td></tr></table></figure><p>éƒ¨ç½²åœ¨ kubernetes ä¸­ï¼Œyml æ–‡ä»¶å¦‚ä¸‹ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">grafana-image-renderer</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">ops</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">grafana-image-renderer</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">grafana-image-renderer</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">grafana-image-renderer</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">registry.cn-hangzhou.aliyuncs.com/iuxt/grafana-image-renderer:3</span></span><br><span class="line">          <span class="attr">env:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">HTTP_HOST</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&quot;0.0.0.0&quot;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">HTTP_PORT</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&quot;80&quot;</span></span><br><span class="line">          <span class="attr">resources:</span></span><br><span class="line">            <span class="attr">limits:</span></span><br><span class="line">              <span class="attr">cpu:</span> <span class="number">2</span></span><br><span class="line">              <span class="attr">memory:</span> <span class="string">2Gi</span></span><br><span class="line">            <span class="attr">requests:</span></span><br><span class="line">              <span class="attr">cpu:</span> <span class="number">2</span></span><br><span class="line">              <span class="attr">memory:</span> <span class="string">2Gi</span></span><br><span class="line">          <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">      <span class="attr">restartPolicy:</span> <span class="string">Always</span></span><br><span class="line">      <span class="attr">terminationGracePeriodSeconds:</span> <span class="number">30</span></span><br><span class="line">      <span class="attr">dnsPolicy:</span> <span class="string">ClusterFirst</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">grafana-image-renderer</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">ops</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">80</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">grafana-image-renderer</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">ClusterIP</span></span><br></pre></td></tr></table></figure><h2 id="Grafana-æ¥å…¥æ¸²æŸ“å™¨"><a href="#Grafana-æ¥å…¥æ¸²æŸ“å™¨" class="headerlink" title="Grafana æ¥å…¥æ¸²æŸ“å™¨"></a>Grafana æ¥å…¥æ¸²æŸ“å™¨</h2><p>å®¹å™¨è¿è¡Œçš„ grafana æ¥å…¥ æ¸²æŸ“å™¨ï¼Œå¢åŠ è¿™ä¸¤ä¸ªç¯å¢ƒå˜é‡</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">GF_RENDERING_SERVER_URL</span></span><br><span class="line">  <span class="attr">value:</span> <span class="string">http://grafana-image-renderer/render</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">GF_RENDERING_CALLBACK_URL</span></span><br><span class="line">  <span class="attr">value:</span> <span class="string">http://grafana:3000/</span></span><br></pre></td></tr></table></figure><p>åœ¨å¯¹åº”çš„é¢æ¿ï¼Œç‚¹å‡»åˆ†äº« å°±å¯ä»¥æ‹¿åˆ°æ¸²æŸ“åçš„å›¾åƒé“¾æ¥ï¼Œæµè§ˆå™¨æ‰“å¼€å¯ä»¥æ‹¿åˆ°å¯¹åº”çš„å›¾ç‰‡ã€‚</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/20250329003245507.png" alt="image.png|637"></p><h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><p>æ ¸å¿ƒä»£ç å°±æ˜¯è¿™ä¸ªï¼Œè¯·æ±‚æ¥å£ï¼Œç„¶åä¿å­˜æˆæ–‡ä»¶</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">render_panel</span>(<span class="params">self, panel_id, panel_title</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;æ¸²æŸ“é¢æ¿å¹¶ä¿å­˜ä¸º PNG&quot;&quot;&quot;</span></span><br><span class="line">    response = requests.get(</span><br><span class="line">        <span class="string">f&quot;https://sre-grafana.ingeek.com/render/d-solo/<span class="subst">&#123;self.uid&#125;</span>?orgId=1&amp;from=<span class="subst">&#123;self.date_from&#125;</span>&amp;to=<span class="subst">&#123;self.date_to&#125;</span>&amp;panelId=<span class="subst">&#123;panel_id&#125;</span>&amp;width=1500&amp;height=750&amp;scale=1&amp;tz=Asia%2FShanghai&quot;</span>,</span><br><span class="line">        headers=&#123;<span class="string">&quot;Authorization&quot;</span>: <span class="string">f&quot;Bearer <span class="subst">&#123;self.api_key&#125;</span>&quot;</span>&#125;</span><br><span class="line">    )</span><br><span class="line">    <span class="built_in">print</span>(response.url)</span><br><span class="line">    safe_filename = re.sub(<span class="string">r&#x27;[\\/*?:&quot;&lt;&gt;|]&#x27;</span>, <span class="string">&#x27;_&#x27;</span>, panel_title) + <span class="string">&#x27;.png&#x27;</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(safe_filename, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(response.content)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;download png success, save to <span class="subst">&#123;safe_filename&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯æ¯”å¦‚æƒ³è‡ªåŠ¨æˆªå–ä¸€ä¸ª dashboard é‡Œé¢çš„æ¯ä¸€å¼ å›¾ï¼Œå°±éœ€è¦è¿›è¡Œå¾ªç¯ panel äº†ã€‚è¿™ç§æ–¹å¼å¯ä»¥æ‹¿åˆ° dashboard çš„ jsonï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_dashboard_json</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;è·å–ä»ªè¡¨æ¿ JSON æ•°æ®&quot;&quot;&quot;</span></span><br><span class="line">    response = requests.get(</span><br><span class="line">        <span class="string">f&quot;https://sre-grafana.ingeek.com/api/dashboards/uid/<span class="subst">&#123;self.uid&#125;</span>&quot;</span>,</span><br><span class="line">        headers=&#123;<span class="string">&quot;Authorization&quot;</span>: <span class="string">f&quot;Bearer <span class="subst">&#123;self.api_key&#125;</span>&quot;</span>&#125;</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">return</span> response.json()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç›‘æ§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> grafana </tag>
            
            <tag> Puppeteer </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>javaå®¹å™¨entrypoint.shå‚æ•°ä¼ é€’çš„éšè—é™·é˜±</title>
      <link href="/posts/stgvyr/"/>
      <url>/posts/stgvyr/</url>
      
        <content type="html"><![CDATA[<p>æ„å»ºå®¹å™¨é•œåƒå¯¹è¿ç»´æ¥è¯´å·²ç»è½»è½¦ç†Ÿè·¯äº†ï¼Œä½†æ˜¯æœ€è¿‘é‡åˆ°ä¸ªé—®é¢˜ç™¾æ€ä¸å¾—å…¶è§£ï¼Œå‡†ç¡®çš„è¯´å°±æ˜¯æ‰‹åŠ¨æ‰§è¡Œ java -jar å¸¦ä¸Šæ‰€æœ‰å‚æ•°ï¼Œå¯ä»¥æ­£å¸¸å¯åŠ¨ï¼Œä½†æ˜¯æ‰“åŒ…æˆé•œåƒå°±ä¼šæŠ¥é”™ï¼š</p><p>å…ˆé™„ä¸Š <code>entrypoint.sh</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -n <span class="string">&quot;<span class="variable">$JVM_PARAM</span>&quot;</span> ];</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;JVM_PARAM: <span class="variable">$JVM_PARAM</span>&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  JVM_PARAM=<span class="string">&quot;-Xms2g -Xmx2g -XX:MetaspaceSize=256m -XX:MaxMetaspaceSize=512m&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -n <span class="string">&quot;<span class="variable">$JVM_OPTS</span>&quot;</span> ];</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;JVM_OPTS: <span class="variable">$JVM_OPTS</span>&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  JVM_OPTS=<span class="string">&quot;-XX:+UseConcMarkSweepGC -XX:+UseCMSInitiatingOccupancyOnly -XX:CMSInitiatingOccupancyFraction=70 -XX:+ExplicitGCInvokesConcurrentAndUnloadsClasses -XX:+CMSClassUnloadingEnabled -XX:+ParallelRefProcEnabled -XX:+CMSScavengeBeforeRemark -XX:ErrorFile=/logs/hs_err_pid%p.log -Xloggc:/logs/gc.log -XX:HeapDumpPath=/logs -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:+HeapDumpOnOutOfMemoryError -XX:+PrintCommandLineFlags&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">JAVA_CMD=<span class="string">&quot;<span class="variable">$JVM_PARAM</span> <span class="variable">$JVM_OPTS</span>&quot;</span></span><br><span class="line"></span><br><span class="line">AGENT_OPTS=<span class="string">&quot;-javaagent:/hawkeye-agent/hawkeye-agent.jar=APPNAME?AGENT_UID=x-zahuifan-userid&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;true&quot;</span> == <span class="string">&quot;<span class="variable">$AGENT_ENABLED</span>&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;JAVA_CMD: <span class="variable">$JAVA_CMD</span> <span class="variable">$AGENT_OPTS</span>&quot;</span></span><br><span class="line">    java <span class="string">&quot;<span class="variable">$JAVA_CMD</span>&quot;</span> <span class="string">&quot;<span class="variable">$AGENT_OPTS</span>&quot;</span> -jar /app/app.jar</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;JAVA_CMD: <span class="variable">$JAVA_CMD</span>&quot;</span></span><br><span class="line">    java <span class="string">&quot;<span class="variable">$JAVA_CMD</span>&quot;</span> -jar /app/app.jar</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><p>Dockerfile:</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> java:xxx</span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash"> app.jar /app.jar</span></span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash"> entrypoint.sh /entrypoint.sh</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;/entrypoint.sh&quot;</span>]</span></span><br></pre></td></tr></table></figure><p>çœ‹èµ·æ¥å¾ˆæ­£å¸¸å¯¹å§ï¼Œä½†æ˜¯å¯åŠ¨æŠ¥é”™ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Invalid initial heap size: -Xms2g -Xmx2g -XX:MetaspaceSize=256m -XX:MaxMetaspaceSize=512m -XX:+UseConcMarkSweepGC -XX:+UseCMSInitiatingOccupancyOnly -XX:CMSInitiatingOccupancyFraction=70 -XX:+ExplicitGCInvokesConcurrentAndUnloadsClasses -XX:+CMSClassUnloadingEnabled -XX:+ParallelRefProcEnabled -XX:+CMSScavengeBeforeRemark -XX:ErrorFile=/logs/hs_err_pid%p.log -Xloggc:/logs/gc.log -XX:HeapDumpPath=/logs -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:+HeapDumpOnOutOfMemoryError -XX:+PrintCommandLineFlags</span><br><span class="line">Error: Could not create the Java Virtual Machine.</span><br><span class="line">Error: A fatal exception has occurred. Program will <span class="built_in">exit</span>.</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹æ§åˆ¶å°ï¼Œecho å‡ºæ¥çš„ <code>JAVA_CMD</code> å˜é‡ä¹Ÿæ˜¯æ­£å¸¸çš„<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/20250321172510730.png" alt="image.png"></p><p>ä¸­é—´æ’æŸ¥è¿‡ç¨‹å¿½ç•¥ï¼Œæœ€åå¢åŠ äº† <code>set -x</code> å‚æ•°åï¼Œé‡æ–°æ‰“åŒ…é•œåƒï¼Œå†æ¬¡æŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºï¼š</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/20250321171117808.png" alt="image.png"></p><p>æ³¨æ„ä»¥ + å¼€å¤´çš„è¾“å‡º è¿™é‡Œ java å¯åŠ¨å‘½ä»¤æ˜¯è¢«è§£ææˆäº†å•å¼•å·å¼•ç”¨ï¼Œæ‰€ä»¥é€ æˆæ— æ³•å¯åŠ¨ã€‚æŠŠ java å¯åŠ¨å‚æ•°ä¸­çš„ç¯å¢ƒå˜é‡åŒå¼•å·å»æ‰ï¼Œå¯ä»¥æ­£å¸¸å¯åŠ¨äº†ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">set</span> -x</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -n <span class="string">&quot;<span class="variable">$JVM_PARAM</span>&quot;</span> ];</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;JVM_PARAM: <span class="variable">$JVM_PARAM</span>&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  JVM_PARAM=<span class="string">&quot;-Xms2g -Xmx2g -XX:MetaspaceSize=256m -XX:MaxMetaspaceSize=512m&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -n <span class="string">&quot;<span class="variable">$JVM_OPTS</span>&quot;</span> ];</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;JVM_OPTS: <span class="variable">$JVM_OPTS</span>&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  JVM_OPTS=<span class="string">&quot;-XX:+UseConcMarkSweepGC -XX:+UseCMSInitiatingOccupancyOnly -XX:CMSInitiatingOccupancyFraction=70 -XX:+ExplicitGCInvokesConcurrentAndUnloadsClasses -XX:+CMSClassUnloadingEnabled -XX:+ParallelRefProcEnabled -XX:+CMSScavengeBeforeRemark -XX:ErrorFile=/logs/hs_err_pid%p.log -Xloggc:/logs/gc.log -XX:HeapDumpPath=/logs -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:+HeapDumpOnOutOfMemoryError -XX:+PrintCommandLineFlags&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">JAVA_CMD=<span class="string">&quot;<span class="variable">$JVM_PARAM</span> <span class="variable">$JVM_OPTS</span>&quot;</span></span><br><span class="line"></span><br><span class="line">AGENT_OPTS=<span class="string">&quot;-javaagent:/hawkeye-agent/hawkeye-agent.jar=APPNAME?AGENT_UID=x-zahuifan-userid&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;true&quot;</span> == <span class="string">&quot;<span class="variable">$AGENT_ENABLED</span>&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;JAVA_CMD: <span class="variable">$JAVA_CMD</span> <span class="variable">$AGENT_OPTS</span>&quot;</span></span><br><span class="line">    java <span class="variable">$JAVA_CMD</span> <span class="variable">$AGENT_OPTS</span> -jar /app/app.jar  <span class="comment"># è¿™é‡Œå»æ‰åŒå¼•å·</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;JAVA_CMD: <span class="variable">$JAVA_CMD</span>&quot;</span></span><br><span class="line">    java <span class="variable">$JAVA_CMD</span> -jar /app/app.jar              <span class="comment"># è¿™é‡Œå»æ‰åŒå¼•å·</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><p>ç½ªé­ç¥¸é¦–ï¼šShell å˜é‡å±•å¼€çš„åˆ†è¯æœºåˆ¶<br>é—®é¢˜çš„æœ¬è´¨åœ¨äº Shell è„šæœ¬ä¸­å˜é‡å±•å¼€æ—¶çš„å‚æ•°åˆ†å‰²è§„åˆ™ã€‚å½“æˆ‘ä»¬ä½¿ç”¨ <code>&quot;$VAR&quot;</code> è¿™ç§å¸¦å¼•å·çš„å†™æ³•æ—¶ï¼Œå˜é‡å€¼ä¸­çš„æ‰€æœ‰å†…å®¹ä¼šè¢«è§†ä¸ºä¸€ä¸ªæ•´ä½“å‚æ•°ï¼Œå³ä½¿å…¶ä¸­åŒ…å«ç©ºæ ¼ä¹Ÿä¸ä¼šè¢«åˆ†å‰²ã€‚è€Œ Java è™šæ‹Ÿæœºè¦æ±‚æ¯ä¸ªå‚æ•°å¿…é¡»ä½œä¸ºç‹¬ç«‹çš„å‘½ä»¤è¡Œå‚æ•°ä¼ é€’ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> å®¹å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Shell </tag>
            
            <tag> Docker </tag>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åœ¨ Hyper-V ä¸‹å¯ç”¨ Fedora 41 çš„å¢å¼ºä¼šè¯æ¨¡å¼</title>
      <link href="/posts/ssqj2c/"/>
      <url>/posts/ssqj2c/</url>
      
        <content type="html"><![CDATA[<h2 id="å®‰è£…ä¸€äº›åŸºç¡€åŒ…"><a href="#å®‰è£…ä¸€äº›åŸºç¡€åŒ…" class="headerlink" title="å®‰è£…ä¸€äº›åŸºç¡€åŒ…"></a>å®‰è£…ä¸€äº›åŸºç¡€åŒ…</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo dnf install -y hyperv-tools</span><br><span class="line">sudo dnf install -y xrdp xrdp-selinux</span><br></pre></td></tr></table></figure><h2 id="é…ç½®-Fedora"><a href="#é…ç½®-Fedora" class="headerlink" title="é…ç½® Fedora"></a>é…ç½® Fedora</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> xrdp</span><br><span class="line">systemctl <span class="built_in">enable</span> xrdp-sesman</span><br><span class="line"></span><br><span class="line"><span class="comment"># use vsock transport.</span></span><br><span class="line">sed -i_orig -e <span class="string">&#x27;s/port=3389/port=vsock:\/\/-1:3389/g&#x27;</span> /etc/xrdp/xrdp.ini</span><br><span class="line"><span class="comment"># use rdp security.</span></span><br><span class="line">sed -i_orig -e <span class="string">&#x27;s/security_layer=negotiate/security_layer=rdp/g&#x27;</span> /etc/xrdp/xrdp.ini</span><br><span class="line"><span class="comment"># remove encryption validation.</span></span><br><span class="line">sed -i_orig -e <span class="string">&#x27;s/crypt_level=high/crypt_level=none/g&#x27;</span> /etc/xrdp/xrdp.ini</span><br><span class="line"><span class="comment"># disable bitmap compression since its local its much faster</span></span><br><span class="line">sed -i_orig -e <span class="string">&#x27;s/bitmap_compression=true/bitmap_compression=false/g&#x27;</span> /etc/xrdp/xrdp.ini</span><br><span class="line"><span class="comment"># rename the redirected drives to &#x27;shared-drives&#x27;</span></span><br><span class="line">sed -i_orig -e <span class="string">&#x27;s/FuseMountName=thinclient_drives/FuseMountName=shared-drives/g&#x27;</span> /etc/xrdp/sesman.ini</span><br><span class="line"></span><br><span class="line"><span class="comment"># Change the allowed_users</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;allowed_users=anybody&quot;</span> &gt; /etc/X11/Xwrapper.config</span><br><span class="line"></span><br><span class="line"><span class="comment">#Ensure hv_sock gets loaded</span></span><br><span class="line"><span class="keyword">if</span> [ ! -e /etc/modules-load.d/hv_sock.conf ]; <span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;hv_sock&quot;</span> &gt; /etc/modules-load.d/hv_sock.conf</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Open port</span></span><br><span class="line">firewall-cmd --add-port=3389/tcp --permanent</span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure><h2 id="é…ç½®-Hyper-V-è™šæ‹Ÿæœº"><a href="#é…ç½®-Hyper-V-è™šæ‹Ÿæœº" class="headerlink" title="é…ç½® Hyper-V è™šæ‹Ÿæœº"></a>é…ç½® Hyper-V è™šæ‹Ÿæœº</h2><p>å°† Fedora å…³æœºï¼Œä»¥<strong>ç®¡ç†å‘˜</strong>èº«ä»½è¿è¡Œ powershellï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Set-VM</span> <span class="literal">-VMName</span> &lt;your_vm_name&gt; <span class="literal">-EnhancedSessionTransportType</span> HvSocket</span><br></pre></td></tr></table></figure><h2 id="å¼•ç”¨"><a href="#å¼•ç”¨" class="headerlink" title="å¼•ç”¨"></a>å¼•ç”¨</h2><p>ä»£ç æ¥è‡ªï¼š<a href="https://github.com/hu-ximing/Hyper-V-RHEL-Fedora-enhanced-session/">https://github.com/hu-ximing/Hyper-V-RHEL-Fedora-enhanced-session/</a></p>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Logstash å†™å…¥ ESï¼šå€ŸåŠ©è‡ªå®šä¹‰æ¨¡æ¿ä¼˜åŒ–æ•°æ®æ˜ å°„ä¸å­˜å‚¨</title>
      <link href="/posts/ss9srz/"/>
      <url>/posts/ss9srz/</url>
      
        <content type="html"><![CDATA[<p>æˆ‘ä»¬çš„ä¸šåŠ¡åœºæ™¯æ˜¯ ES å­˜å‚¨çš„éƒ½æ˜¯ä¸€äº›ä¸å¤ªé‡è¦çš„æ—¥å¿—ï¼Œä½†æ˜¯å¯¹å­˜å‚¨æ¯”è¾ƒæ•æ„Ÿï¼Œä½†æ˜¯æŸ¥çœ‹äº† ES ç´¢å¼•éƒ½æ˜¯é»˜è®¤åˆ›å»ºäº†ä¸€ä¸ªå‰¯æœ¬çš„ã€‚è¿™ä¼šé€ æˆå­˜å‚¨ç©ºé—´ç¿»å€ã€‚ç°åœ¨é€šè¿‡è°ƒæ•´ logstash é…ç½®æ¥å®ç°åˆ›å»ºå‡ºæ¥çš„ç´¢å¼•åº”ç”¨è‡ªå®šä¹‰é…ç½®ï¼Œæ¯”å¦‚å¯ä»¥å®ç° 30 å¤©å‰çš„æ—¥å¿—è‡ªåŠ¨æ¸…ç†ï¼Œé»˜è®¤ä¸åˆ›å»ºå‰¯æœ¬ç­‰ã€‚</p><h2 id="åˆ›å»ºç”Ÿå‘½å‘¨æœŸç­–ç•¥"><a href="#åˆ›å»ºç”Ÿå‘½å‘¨æœŸç­–ç•¥" class="headerlink" title="åˆ›å»ºç”Ÿå‘½å‘¨æœŸç­–ç•¥"></a>åˆ›å»ºç”Ÿå‘½å‘¨æœŸç­–ç•¥</h2><p>åœ¨ ES ä¸Šåˆ›å»ºä¸€ä¸ªç”Ÿå‘½å‘¨æœŸç­–ç•¥ï¼Œå®šä¹‰ç´¢å¼•ä¿ç•™ 14 å¤©ã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">PUT _ilm/policy/user_monitor_point-retention-policy</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;policy&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;phases&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;hot&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;min_age&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0ms&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;actions&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;delete&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;min_age&quot;</span><span class="punctuation">:</span> <span class="string">&quot;14d&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;actions&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;delete&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h2 id="åˆ›å»º-ES-æ¨¡æ¿é…ç½®æ–‡ä»¶"><a href="#åˆ›å»º-ES-æ¨¡æ¿é…ç½®æ–‡ä»¶" class="headerlink" title="åˆ›å»º ES æ¨¡æ¿é…ç½®æ–‡ä»¶"></a>åˆ›å»º ES æ¨¡æ¿é…ç½®æ–‡ä»¶</h2><p>å‡†å¤‡ä¸€ä¸ª template é…ç½®æ–‡ä»¶ <code>logstash-template.json</code></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;index_patterns&quot;</span><span class="punctuation">:</span> <span class="string">&quot;user_monitor_point-*&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;order&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;lifecycle&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;user_monitor_point-retention-policy&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;number_of_replicas&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œå®šä¹‰äº†åº”ç”¨çš„æ¨¡æ¿è§„åˆ™ï¼Œåº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸè§„åˆ™ï¼Œè¿˜æœ‰å‰¯æœ¬æ•°ã€‚</p><p>logstash é…ç½®æ–‡ä»¶ <code>logstash.conf</code></p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">output &#123;</span><br><span class="line">  <span class="keyword">if</span> [type] == <span class="string">&quot;logstash_mixins&quot;</span> &#123;</span><br><span class="line">      elasticsearch &#123;</span><br><span class="line">        action   =&gt; <span class="string">&quot;index&quot;</span></span><br><span class="line">        hosts    =&gt; [<span class="string">&quot;http://10.20.20.2:9200&quot;</span>, <span class="string">&quot;http://10.20.20.3:9200&quot;</span>,<span class="string">&quot;http://10.20.20.6:9200&quot;</span>]</span><br><span class="line">        index    =&gt; <span class="string">&quot;user_monitor_point-%&#123;+YYYY.MM.dd&#125;&quot;</span></span><br><span class="line">        user     =&gt; <span class="string">&quot;elastic&quot;</span></span><br><span class="line">        password =&gt; <span class="string">&quot;password&quot;</span></span><br><span class="line">        <span class="comment"># è¿™ä¸ªè®¾ç½®æ§åˆ¶æ˜¯å¦è‡ªåŠ¨ç®¡ç†ç´¢å¼•æ¨¡æ¿ã€‚è®¾ç½®ä¸º true æ—¶ï¼ŒLogstash ä¼šè‡ªåŠ¨åˆ›å»ºå’Œç®¡ç†ç´¢å¼•æ¨¡æ¿ï¼ˆåŒ…æ‹¬å­—æ®µæ˜ å°„å’Œè®¾ç½®ï¼‰</span></span><br><span class="line">        manage_template =&gt; <span class="literal">true</span></span><br><span class="line">        <span class="comment"># å¦‚æœå·²ç»å­˜åœ¨ç›¸åŒåç§°çš„ç´¢å¼•æ¨¡æ¿ï¼Œè®¾ç½® template_overwrite =&gt; true ä¼šè¦†ç›–ç°æœ‰æ¨¡æ¿ã€‚</span></span><br><span class="line">        template_overwrite =&gt; <span class="literal">true</span></span><br><span class="line">        template =&gt; <span class="string">&#x27;/etc/logstash-template.json&#x27;</span></span><br><span class="line">     &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·ä½¿ç”¨ logstash åˆ›å»ºç´¢å¼•çš„æ—¶å€™å°±ä¼šè‡ªåŠ¨åº”ç”¨æ¨¡æ¿è§„åˆ™ã€‚</p><p>å½“ç„¶ä¹Ÿå¯ä»¥å°† <code>manage_template</code> è®¾ç½®æˆ <code>false</code> è½¬è€Œä½¿ç”¨ ES æ¥ç®¡ç†ç´¢å¼•æ¨¡æ¿é…ç½®ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æ—¥å¿— </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Elasticsearch </tag>
            
            <tag> ES </tag>
            
            <tag> logstash </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨Pythonè¯†åˆ«éªŒè¯ç  ddddocr</title>
      <link href="/posts/ss2wk6/"/>
      <url>/posts/ss2wk6/</url>
      
        <content type="html"><![CDATA[<p>GitHub åœ°å€ï¼š<a href="https://github.com/sml2h3/ddddocr">https://github.com/sml2h3/ddddocr</a></p><p>å®‰è£…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install ddddocr</span><br></pre></td></tr></table></figure><p>å¦‚æœ windows å®‰è£…æŠ¥é”™ï¼š<code>ImportErrorï¼šDLL load failed: æ‰¾ä¸åˆ°æŒ‡å®šçš„æ¨¡å—ã€‚</code><br>éœ€è¦å®‰è£… vc è¿è¡Œåº“ï¼š<br><a href="https://aka.ms/vs/16/release/VC_redist.x86.exe">https://aka.ms/vs/16/release/VC_redist.x86.exe</a></p><p><a href="https://aka.ms/vs/16/release/VC_redist.x64.exe">https://aka.ms/vs/16/release/VC_redist.x64.exe</a></p><p>åŸºæœ¬ä½¿ç”¨ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ddddocr</span><br><span class="line"></span><br><span class="line">ocr = ddddocr.DdddOcr(show_ad=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">image = <span class="built_in">open</span>(<span class="string">&quot;example.jpg&quot;</span>, <span class="string">&quot;rb&quot;</span>).read()</span><br><span class="line">result = ocr.classification(image)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure><p>åˆå§‹åŒ–ä¼ å‚ <code>show_ad=False</code> è¾“å‡ºå°±ä¸å¸¦ä½œè€…çš„å¹¿å‘Šäº†ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> OCR </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è§£å†³PyCharmç»ˆç«¯ä½¿ç”¨zsh powerlevel10kä¸»é¢˜æ—¶çš„ä¹±ç é—®é¢˜</title>
      <link href="/posts/srz9zs/"/>
      <url>/posts/srz9zs/</url>
      
        <content type="html"><![CDATA[<p><code>powerlevel10k</code> æ˜¯ zsh ä¸Šå¾ˆå¥½çœ‹çš„ä¸»é¢˜ï¼Œæˆ‘ä¸€ç›´æ˜¯åœ¨ wsl é‡Œç”¨ï¼Œé…åˆ <code>Windows Terminal</code> å¾ˆå¥½çœ‹ï¼Œä¸è¿‡åœ¨ PyCharm é‡Œæ‰“å¼€ä¼šä¹±ç ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹æ§åˆ¶å°å­—ä½“ä¸ºæ”¯æŒ powerline çš„å­—ä½“ï¼Œä¸è¿‡è¿˜æ˜¯ä¸å®Œç¾ï¼Œæœ‰æ—¶å€™è¿˜æœ‰ BUGã€‚</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/20250220230144904.png" alt="image.png|577"></p><p>æƒ³äº†ä¸‹ï¼Œæˆ‘å¹³æ—¶éƒ½æ˜¯åœ¨ <code>Windows Terminal</code> ä¸Šç”¨çš„ï¼Œé‚£ä¹ˆå¯ä»¥è®©ä½¿ç”¨ <code>Windows Terminal</code> çš„æ—¶å€™æ˜¾ç¤ºæˆ<strong>èŠ±é‡Œèƒ¡å“¨</strong>çš„ä¸»é¢˜ï¼Œç”¨å…¶ä»–è½¯ä»¶æ¯”å¦‚ PyCharm æˆ–è€… VScode çš„æ—¶å€™ï¼Œæ¢æˆ<strong>æœ´ç´ </strong>çš„ä¸»é¢˜ã€‚çœ‹äº†ä¸‹ï¼Œåœ¨ <code>Windows Terminal</code> ä¸Šæœ‰ä¸ªç‰¹æ®Šçš„ç¯å¢ƒå˜é‡ <code>WT_SESSION</code> å’Œ <code>WT_PROFILE_ID</code> ï¼Œçœ‹åå­—åº”è¯¥æ˜¯å’Œ Windows terminal æœ‰å…³ï¼Œæµ‹è¯•äº†ä¸‹ä¹Ÿç¡®å®å¦‚æ­¤ï¼Œé‚£ä¹ˆå¯ä»¥ä¿®æ”¹ <code>~/.zshrc</code> æ¥å®ç°ã€‚</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/20250220230859339.png" alt="image.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> [[ <span class="variable">$WT_SESSION</span> ]]; <span class="keyword">then</span></span><br><span class="line">  ZSH_THEME=<span class="string">&quot;powerlevel10k/powerlevel10k&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  ZSH_THEME=<span class="string">&quot;robbyrussell&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><p>æ­¤æ—¶æ˜¾ç¤ºå¦‚ä¸‹ï¼š</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/20250220231032118.png"></p>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Nacos 2.0.3 é›†ç¾¤å‡çº§ä¸º 2.1.0</title>
      <link href="/posts/srnwhe/"/>
      <url>/posts/srnwhe/</url>
      
        <content type="html"><![CDATA[<h2 id="2-0-3-ç‰ˆæœ¬çš„-BUG"><a href="#2-0-3-ç‰ˆæœ¬çš„-BUG" class="headerlink" title="2.0.3 ç‰ˆæœ¬çš„ BUG"></a>2.0.3 ç‰ˆæœ¬çš„ BUG</h2><p>è¯¦ç»† bug åœ¨ GitHub ä¸Šæœ‰ï¼Œæ¯”å¦‚ï¼š<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/20250214153333408.webp" alt="image.png"></p><p>issue é“¾æ¥è§ï¼š<br><a href="https://github.com/alibaba/nacos/issues/9332">https://github.com/alibaba/nacos/issues/9332</a><br><a href="https://github.com/alibaba/nacos/issues/8492">https://github.com/alibaba/nacos/issues/8492</a></p><p>æˆ‘ä»¬é‡åˆ°çš„ bug ç®€å•ä¸€å¥è¯æ€»ç»“å°±æ˜¯ï¼šé›†ç¾¤æ–¹å¼éƒ¨ç½²çš„ nacos å…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹é‡å¯åå¯èƒ½ä¼šæœ‰èŠ‚ç‚¹æ•°æ®ä¸ä¸€è‡´çš„ç°è±¡ï¼ˆæœåŠ¡æ³¨å†Œä¸æœåŠ¡å‘ç°é‡Œé¢çš„æœåŠ¡æ•°é‡ä¸ä¸€è‡´ï¼‰æ¯”å¦‚è¯´ä¸€ä¸ªæœåŠ¡æ³¨å†Œåˆ°äº† nacos ä¸­ï¼Œæˆ‘åœ¨ nacos ç½‘é¡µæ§åˆ¶å° <code>æœåŠ¡ç®¡ç†</code> <code>æœåŠ¡åˆ—è¡¨</code> é‡ŒæŸ¥çœ‹æœ‰ 10 ä¸ªæœåŠ¡æ³¨å†Œè¿›æ¥ï¼Œåˆ·æ–°ä¸‹ç½‘é¡µå¯èƒ½å°±å˜æˆäº† 9 ä¸ªï¼Œå†åˆ·æ–°åˆå˜æˆ 10 ä¸ªï¼Œè¿™ç§æƒ…å†µå°±æ˜¯ nacos çš„å¤šä¸ªèŠ‚ç‚¹æ•°æ®ä¸åŒæ­¥äº†ï¼ˆnacos é…ç½®ä¸­å¿ƒæ•°æ®æ˜¯ä» MySQL å–çš„ï¼Œä¸å—è¿™ä¸ª bug çš„å½±å“ï¼‰ï¼Œè¿™ç§æƒ…å†µå¯ä»¥ç›´æ¥å°† nacos å‰¯æœ¬æ•°è®¾ç½®æˆ 1 ä¸´æ—¶è§£å†³ï¼Œæƒ³è¦å½»åº•è§£å†³æˆ‘ä»¬éªŒè¯äº†å‡çº§åˆ° 2.1.0 å°±èƒ½ä¿®å¤ã€‚</p><h2 id="å‡çº§æ•°æ®åº“è¡¨ç»“æ„"><a href="#å‡çº§æ•°æ®åº“è¡¨ç»“æ„" class="headerlink" title="å‡çº§æ•°æ®åº“è¡¨ç»“æ„"></a>å‡çº§æ•°æ®åº“è¡¨ç»“æ„</h2><blockquote><p>nacos å®˜ç½‘æ–‡æ¡£å†™çš„å¤ªæ•·è¡äº†ï¼Œç‰ˆæœ¬ä¹‹é—´çš„å·®å¼‚éœ€è¦è‡ªå·±æ‰¾ï¼Œå“ªæ€•ä½ ä¸Šä¸ª flyway ä¹Ÿå¥½å•Šã€‚</p></blockquote><p>å…¶ä¸­æœ‰ä¸‰ä¸ªè¡¨ï¼ˆconfig_infoã€config_info_betaã€his_config_infoï¼‰éƒ½åŠ äº† encrypted_data_key è¿™ä¸ªå­—æ®µã€‚ æ‰€ä»¥å‡çº§æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼Œåœ¨è¿™ä¸‰å¼ è¡¨ä¸Šéƒ½åŠ ä¸Š encrypted_data_key è¿™ä¸ªå­—æ®µå°±è¡Œäº†ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> nacos.config_info <span class="keyword">ADD</span> encrypted_data_key TEXT <span class="keyword">NOT</span> <span class="keyword">NULL</span>; </span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> nacos.config_info_beta <span class="keyword">ADD</span> encrypted_data_key TEXT <span class="keyword">NOT</span> <span class="keyword">NULL</span>; </span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> nacos.his_config_info <span class="keyword">ADD</span> encrypted_data_key TEXT <span class="keyword">NOT</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure><h2 id="å‡çº§ç‰ˆæœ¬åˆ°-2-1-0"><a href="#å‡çº§ç‰ˆæœ¬åˆ°-2-1-0" class="headerlink" title="å‡çº§ç‰ˆæœ¬åˆ° 2.1.0"></a>å‡çº§ç‰ˆæœ¬åˆ° 2.1.0</h2><p>æˆ‘ä»¬æ˜¯éƒ¨ç½²åœ¨ Kubernetes ä¸­çš„ï¼Œåªéœ€è¦å‡çº§é•œåƒç‰ˆæœ¬å°±è¡Œäº†ã€‚ä¸€ä¸ªé•œåƒä»£ç†åœ°å€ï¼š<code>registry.cn-hangzhou.aliyuncs.com/iuxt/nacos-server:v2.1.0</code></p><p>å…·ä½“éƒ¨ç½²é…ç½®æŸ¥çœ‹ï¼š<a href="/posts/sebxm6/">åœ¨Kubernetesä¸­éƒ¨ç½²nacos 2.1.0</a></p>]]></content>
      
      
      <categories>
          
          <category> å®¹å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Kubernetes </tag>
            
            <tag> nacos </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¾¤æ™–NASéƒ¨ç½²zerotierå†…ç½‘ç©¿é€è®¿é—®</title>
      <link href="/posts/spi492/"/>
      <url>/posts/spi492/</url>
      
        <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å®Œæˆè¿™ä¸ªæ•™ç¨‹ï¼Œä½ ä¸»è¦éœ€è¦å®Œæˆä»¥ä¸‹æµç¨‹ï¼š</p><ul><li>åœ¨ NAS ä¸Šå¯ç”¨ SSH</li><li>åˆ›å»ºä¸€ä¸ªæŒä¹…çš„ TUN</li><li>å®‰è£… Docker</li><li>è®¾ç½® Docker</li></ul><h2 id="åˆ›å»ºä¸€ä¸ªæŒä¹…çš„-TUN"><a href="#åˆ›å»ºä¸€ä¸ªæŒä¹…çš„-TUN" class="headerlink" title="åˆ›å»ºä¸€ä¸ªæŒä¹…çš„ TUN"></a>åˆ›å»ºä¸€ä¸ªæŒä¹…çš„ TUN</h2><div class="note info flat"><p>å¦‚æœæœ‰ <code>/dev/net/tun</code> å°±ä¸ç”¨å†æ‰§è¡Œäº†</p></div><p>ä½¿ç”¨ SSH è¿æ¥åˆ°ä½ çš„ NASï¼Œåˆ‡æ¢ä¸º root èº«ä»½</p><p>åˆ›å»ºä¸€ä¸ªå¼€æœºè‡ªå¯åŠ¨è„šæœ¬: <code>/usr/local/etc/rc.d/tun.sh</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºå¼€æœºè‡ªå¯åŠ¨è„šæœ¬</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&#x27;#!/bin/sh -e \ninsmod /lib/modules/tun.ko&#x27;</span> &gt; /usr/local/etc/rc.d/tun.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ å¯æ‰§è¡Œæƒé™</span></span><br><span class="line"><span class="built_in">chmod</span> a+x /usr/local/etc/rc.d/tun.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰‹åŠ¨æ‰§è¡Œä¸€ä¸‹</span></span><br><span class="line">/usr/local/etc/rc.d/tun.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ˜¯å¦æœ‰tunè®¾å¤‡</span></span><br><span class="line"><span class="built_in">ls</span> /dev/net/tun</span><br></pre></td></tr></table></figure><h2 id="å®‰è£…-Docker-åˆ°ä½ çš„-NAS-ä¸Š"><a href="#å®‰è£…-Docker-åˆ°ä½ çš„-NAS-ä¸Š" class="headerlink" title="å®‰è£… Docker åˆ°ä½ çš„ NAS ä¸Š"></a>å®‰è£… Docker åˆ°ä½ çš„ NAS ä¸Š</h2><p>ç›´æ¥åˆ°å¥—ä»¶ä¸­å¿ƒå»å®‰è£…ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /var/lib/zerotier-one</span><br></pre></td></tr></table></figure><p>åˆ›å»ºä¸€ä¸ªå®¹å™¨ï¼Œè¿™é‡Œå°†å®ƒå‘½åä¸º zerotierï¼Œè¿™é‡Œä¼šè‡ªåŠ¨ä¸‹è½½æœ€æ–°ç‰ˆçš„ zerotier</p><p>è¦åœ¨ ssh é‡Œåˆ›å»ºï¼Œä¸è¦åœ¨ç¾¤æ™–æ§åˆ¶å°åˆ›å»ºã€‚åˆ›å»ºå®Œæˆåå¯ä»¥åœ¨æ§åˆ¶å°è¿›è¡Œç®¡ç†ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">docker run -d           \</span><br><span class="line">  --name zerotier       \</span><br><span class="line">  --restart=always      \</span><br><span class="line">  --device=/dev/net/tun \</span><br><span class="line">  --net=host            \</span><br><span class="line">  --cap-add=NET_ADMIN   \</span><br><span class="line">  --cap-add=SYS_ADMIN   \</span><br><span class="line">  -v /var/lib/zerotier-one:/var/lib/zerotier-one \</span><br><span class="line">  registry.cn-hangzhou.aliyuncs.com/iuxt/zerotier-synology:1.14.0</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨ï¼šå®˜æ–¹é•œåƒï¼š<code>zerotier/zerotier-synology:latest</code></p></blockquote><h2 id="ä½¿ç”¨ä¸é…ç½®"><a href="#ä½¿ç”¨ä¸é…ç½®" class="headerlink" title="ä½¿ç”¨ä¸é…ç½®"></a>ä½¿ç”¨ä¸é…ç½®</h2><p>æŸ¥çœ‹çŠ¶æ€</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it zerotier zerotier-cli status</span><br></pre></td></tr></table></figure><p>æ·»åŠ ç½‘ç»œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it zerotier zerotier-cli <span class="built_in">join</span> &lt;ä½ çš„ç½‘ç»œID&gt;</span><br></pre></td></tr></table></figure><p>åœ¨ zerotier åå°æˆæƒå½“å‰è®¾å¤‡ï¼Œç„¶åæŸ¥çœ‹çŠ¶æ€ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it zerotier zerotier-cli listnetworks</span><br></pre></td></tr></table></figure><h2 id="ä½¿å±€åŸŸç½‘ç½‘æ®µå¯ä»¥è®¿é—®"><a href="#ä½¿å±€åŸŸç½‘ç½‘æ®µå¯ä»¥è®¿é—®" class="headerlink" title="ä½¿å±€åŸŸç½‘ç½‘æ®µå¯ä»¥è®¿é—®"></a>ä½¿å±€åŸŸç½‘ç½‘æ®µå¯ä»¥è®¿é—®</h2><h3 id="1-æ·»åŠ è·¯ç”±"><a href="#1-æ·»åŠ è·¯ç”±" class="headerlink" title="1. æ·»åŠ è·¯ç”±"></a>1. æ·»åŠ è·¯ç”±</h3><p>å‡è®¾å®¶é‡Œçš„æœºå™¨ï¼šzerotier åœ°å€æ˜¯ï¼š172.28.135.11ï¼Œå†…ç½‘ IP åœ°å€æ˜¯ 192.168.1.11</p><p>åœ¨ zerotier ç½‘ç«™çš„ networks é‡Œé¢çš„ Managed Routes ä¸‹é…ç½®è·¯ç”±è¡¨,å¢åŠ å¦‚ä¸‹å†…å®¹</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/20250103135337663.png" alt="image.png"></p><p>åŠ è¿‡è·¯ç”±åï¼Œå¯ä»¥è®¿é—®è¿™å° zerotier èŠ‚ç‚¹çš„å†…ç½‘ ipï¼ˆ192.168.1.11ï¼‰ äº†ï¼Œä½†æ˜¯ä¸èƒ½è®¿é—®å†…ç½‘çš„å…¶ä»– ipï¼Œè¿˜éœ€è¦åšä¸€ä¸‹è½¬å‘ã€‚</p><h3 id="2-å¼€å¯å†…æ ¸è½¬å‘"><a href="#2-å¼€å¯å†…æ ¸è½¬å‘" class="headerlink" title="2. å¼€å¯å†…æ ¸è½¬å‘"></a>2. å¼€å¯å†…æ ¸è½¬å‘</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo sysctl -w net.ipv4.ip_forward=1</span><br><span class="line">sudo sysctl -p</span><br></pre></td></tr></table></figure><p>é‡å¯åé…ç½®ä¼šä¸¢å¤±ï¼Œè¦æŒä¹…åŒ–å¯ä»¥å†™å…¥åˆ° <code>/etc/sysctl.conf</code></p><h3 id="3-é˜²ç«å¢™è®¾ç½®"><a href="#3-é˜²ç«å¢™è®¾ç½®" class="headerlink" title="3. é˜²ç«å¢™è®¾ç½®"></a>3. é˜²ç«å¢™è®¾ç½®</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> PHY_IF=ovs_eth0 <span class="comment"># ç‰©ç†ç½‘å¡è®¾å¤‡å</span></span><br><span class="line"><span class="built_in">export</span> ZT_IF=ztre4xmo4y <span class="comment"># Zerotierè™šæ‹Ÿç½‘å¡è®¾å¤‡å</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ è½¬å‘è§„åˆ™</span></span><br><span class="line">sudo iptables -t nat -A POSTROUTING -o <span class="variable">$PHY_IF</span> -j MASQUERADE</span><br><span class="line">sudo iptables -A FORWARD -i <span class="variable">$PHY_IF</span> -o <span class="variable">$ZT_IF</span> -m state --state RELATED,ESTABLISHED -j ACCEPT</span><br><span class="line">sudo iptables -A FORWARD -i <span class="variable">$ZT_IF</span> -o <span class="variable">$PHY_IF</span> -j ACCEPT</span><br></pre></td></tr></table></figure><p>é˜²ç«å¢™è§„åˆ™æ²¡ä¿å­˜çš„è¯é‡å¯åä¼šä¸¢å¤±ã€‚</p><div class="note info flat"><p>è¿™ä¸‰æ¡ iptables è§„åˆ™ç”¨äºé…ç½®ç½‘ç»œåœ°å€è½¬æ¢ï¼ˆNATï¼‰å’Œæ•°æ®åŒ…è½¬å‘ï¼›</p><p>å«ä¹‰å¦‚ä¸‹ï¼š</p><p>è§„åˆ™ 1ï¼š <code>sudo iptables -t nat -A POSTROUTING -o $PHY_IF -j MASQUERADE</code></p><p>è¿™æ¡è§„åˆ™åœ¨ nat è¡¨çš„ POSTROUTING é“¾ä¸­æ·»åŠ äº†ä¸€æ¡è§„åˆ™ã€‚-o $PHY_IF è¡¨ç¤ºè¿™æ¡è§„åˆ™é€‚ç”¨äºæ‰€æœ‰é€šè¿‡ $PHY_IF è¿™ä¸ªç½‘ç»œæ¥å£ï¼ˆé€šå¸¸æ˜¯ç‰©ç†æ¥å£ï¼‰å‡ºå»çš„æ•°æ®åŒ…ã€‚-j MASQUERADE æŒ‡å®šäº† NAT æ“ä½œä¸­çš„ä¼ªè£…ï¼ˆmasqueradingï¼‰ã€‚è¿™æ„å‘³ç€ï¼Œå½“æ•°æ®åŒ…ä» $PHY_IF å‘é€å‡ºå»æ—¶ï¼Œå…¶æº IP åœ°å€ä¼šè¢«æ›¿æ¢ä¸º $PHY_IF çš„ IP åœ°å€ã€‚è¿™é€šå¸¸ç”¨äºå…è®¸å†…éƒ¨ç½‘ç»œé€šè¿‡ä¸€ä¸ªå…¬å…± IP åœ°å€è¿›è¡Œå¤–éƒ¨é€šä¿¡ï¼›</p><p>è§„åˆ™ 2ï¼š <code>sudo iptables -A FORWARD -i $PHY_IF -o $ZT_IF -m state --state RELATED,ESTABLISHED -j ACCEPT</code></p><p>è¿™æ¡è§„åˆ™åœ¨ filter è¡¨çš„ FORWARD é“¾ä¸­æ·»åŠ äº†ä¸€æ¡è§„åˆ™ã€‚-i $PHY_IF è¡¨ç¤ºé€‚ç”¨äºä» $PHY_IF è¿™ä¸ªæ¥å£è¿›å…¥çš„æ•°æ®åŒ…ï¼Œ-o $ZT_IF è¡¨ç¤ºè¿™äº›æ•°æ®åŒ…è¦è½¬å‘åˆ° $ZT_IF è¿™ä¸ªæ¥å£ã€‚-m state â€“state RELATED,ESTABLISHED æŒ‡å®šäº†åªæœ‰é‚£äº›ä¸å·²æœ‰è¿æ¥ç›¸å…³æˆ–å·²ç»å»ºç«‹çš„è¿æ¥çš„æ•°æ®åŒ…æ‰è¢«æ¥å—ï¼ˆACCEPTï¼‰ã€‚è¿™ä¸ªè§„åˆ™é€šå¸¸ç”¨äºå…è®¸æ¥è‡ªå¤–éƒ¨ç½‘ç»œçš„è¿”å›æµé‡è¿›å…¥å†…éƒ¨ç½‘ç»œï¼Œä»è€Œæ”¯æŒè¯¸å¦‚ HTTP ä¼šè¯ç­‰ï¼›</p><p>è§„åˆ™ 3ï¼š <code>sudo iptables -A FORWARD -i $ZT_IF -o $PHY_IF -j ACCEPT</code></p><p>è¿™æ¡è§„åˆ™åœ¨ filter è¡¨çš„ FORWARD é“¾ä¸­æ·»åŠ äº†ä¸€æ¡è§„åˆ™ã€‚-i $ZT_IF è¡¨ç¤ºé€‚ç”¨äºä» $ZT_IF è¿™ä¸ªæ¥å£è¿›å…¥çš„æ•°æ®åŒ…ï¼Œ-o $PHY_IF è¡¨ç¤ºè¿™äº›æ•°æ®åŒ…è¦è½¬å‘åˆ° $PHY_IF è¿™ä¸ªæ¥å£ã€‚-j ACCEPT è¡¨ç¤ºè¿™äº›æ•°æ®åŒ…ä¼šè¢«æ¥å—å¹¶è½¬å‘ã€‚è¿™æ¡è§„åˆ™å…è®¸æ¥è‡ª $ZT_IF çš„æµé‡ç»è¿‡è·¯ç”±å™¨è½¬å‘åˆ° $PHY_IFï¼Œä»è€Œå®ç°ç½‘ç»œä¹‹é—´çš„æ•°æ®ä¼ è¾“ï¼›</p><p>æ€»ç»“ï¼š</p><p>ç¬¬ä¸€æ¡è§„åˆ™ç”¨äºè®¾ç½®æºåœ°å€ä¼ªè£…ï¼Œå…è®¸å†…éƒ¨ç½‘ç»œè®¾å¤‡é€šè¿‡ä¸€ä¸ªå…¬å…± IP åœ°å€è¿›è¡Œå¤–éƒ¨é€šä¿¡ï¼›<br>ç¬¬äºŒæ¡è§„åˆ™å…è®¸è¿”å›æµé‡å’Œå·²ç»å»ºç«‹çš„è¿æ¥çš„æ•°æ®åŒ…ä»å¤–éƒ¨ç½‘ç»œè¿›å…¥å†…éƒ¨ç½‘ç»œï¼›<br>ç¬¬ä¸‰æ¡è§„åˆ™å…è®¸æ¥è‡ªå†…éƒ¨ç½‘ç»œçš„æ•°æ®åŒ…è¢«è½¬å‘åˆ°å¤–éƒ¨ç½‘ç»œï¼›</p></div><p>ç½‘å¡è®¾å¤‡åå‚è€ƒ åœ¨æœºå™¨ä¸Šä½¿ç”¨å‘½ä»¤ <code>ip a</code> æŸ¥çœ‹ï¼š</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/20250103232323506.png" alt="image.png"></p><h2 id="å¼•ç”¨ä¸æ–‡çŒ®"><a href="#å¼•ç”¨ä¸æ–‡çŒ®" class="headerlink" title="å¼•ç”¨ä¸æ–‡çŒ®"></a>å¼•ç”¨ä¸æ–‡çŒ®</h2><blockquote><p>æœ¬æ–‡åŸºäºå®˜æ–¹åŸæ–‡è¿›è¡Œç¿»è¯‘å’Œè¡¥å…… <a href="https://docs.zerotier.com/synology/#set-up-container">https://docs.zerotier.com/synology/#set-up-container</a><br>  iptables è§„åˆ™è½¬è½½è‡ªï¼š<a href="https://jasonkayzk.github.io/2024/08/21/Zerotier%E9%85%8D%E7%BD%AE%E5%86%85%E7%BD%91%E6%B5%81%E9%87%8F%E8%BD%AC%E5%8F%91/">https://jasonkayzk.github.io/2024/08/21/Zerotier%E9%85%8D%E7%BD%AE%E5%86%85%E7%BD%91%E6%B5%81%E9%87%8F%E8%BD%AC%E5%8F%91/</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç½‘ç»œ </tag>
            
            <tag> nas </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç®¡ç†Rediså†…å­˜å ç”¨</title>
      <link href="/posts/spcjoj/"/>
      <url>/posts/spcjoj/</url>
      
        <content type="html"><![CDATA[<h2 id="æ·˜æ±°ç­–ç•¥"><a href="#æ·˜æ±°ç­–ç•¥" class="headerlink" title="æ·˜æ±°ç­–ç•¥"></a>æ·˜æ±°ç­–ç•¥</h2><p>å¦‚æœè®¾ç½®äº†åˆé€‚çš„æ·˜æ±°ç­–ç•¥ï¼ŒRedis ä¼šæ ¹æ®ä»¥ä¸‹å‡ ç§ç­–ç•¥é€‰æ‹©æ€§åœ°ç§»é™¤æŸäº›é”®ï¼Œè…¾å‡ºå†…å­˜ç©ºé—´ï¼ˆæ·˜æ±°ç­–ç•¥éœ€è¦å’Œå†…å­˜é™åˆ¶é…åˆä½¿ç”¨ï¼‰</p><p>å¸¸ç”¨æ·˜æ±°ç­–ç•¥è¯´æ˜</p><table><thead><tr><th>ç­–ç•¥</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>volatile-lru</td><td>ä»è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ä¸­ï¼Œç§»é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼ˆLRUï¼‰çš„é”®ã€‚</td></tr><tr><td>allkeys-lru</td><td>ä»æ‰€æœ‰é”®ä¸­ï¼Œç§»é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼ˆLRUï¼‰çš„é”®ã€‚</td></tr><tr><td>volatile-random</td><td>ä»è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ä¸­ï¼Œéšæœºç§»é™¤é”®ã€‚</td></tr><tr><td>allkeys-random</td><td>ä»æ‰€æœ‰é”®ä¸­ï¼Œéšæœºç§»é™¤é”®ã€‚</td></tr><tr><td>volatile-ttl</td><td>ä»è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ä¸­ï¼Œç§»é™¤å³å°†è¿‡æœŸçš„é”®ï¼ˆä¼˜å…ˆç§»é™¤ TTL çŸ­çš„é”®ï¼‰ã€‚</td></tr><tr><td>noeviction</td><td>å½“å†…å­˜è¶…è¿‡é™åˆ¶æ—¶ï¼Œç›´æ¥è¿”å›é”™è¯¯ï¼Œä¸å†æ‰§è¡Œæ–°å¢æ“ä½œï¼ˆè¿™æ˜¯é»˜è®¤ç­–ç•¥ï¼‰ã€‚</td></tr></tbody></table><p>è®¾ç½®æ–¹æ³•ï¼š åœ¨ redis.conf æ–‡ä»¶ä¸­æ·»åŠ æˆ–ä¿®æ”¹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">maxmemory-policy allkeys-lru</span><br></pre></td></tr></table></figure><p>æˆ–é€šè¿‡å‘½ä»¤è¡ŒåŠ¨æ€è®¾ç½®ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli config <span class="built_in">set</span> maxmemory-policy allkeys-lru</span><br></pre></td></tr></table></figure><h2 id="å†…å­˜é™åˆ¶"><a href="#å†…å­˜é™åˆ¶" class="headerlink" title="å†…å­˜é™åˆ¶"></a>å†…å­˜é™åˆ¶</h2><p>è®¾ç½® maxmemory</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">maxmemory 4gb</span><br><span class="line"># maxmemory 4G</span><br><span class="line"># maxmemory 4294967296</span><br></pre></td></tr></table></figure><p>é€šè¿‡å‘½ä»¤è¡ŒåŠ¨æ€è®¾ç½®ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli config <span class="built_in">set</span> maxmemory 4294967296</span><br></pre></td></tr></table></figure><h2 id="æŒä¹…åŒ–è®¾ç½®"><a href="#æŒä¹…åŒ–è®¾ç½®" class="headerlink" title="æŒä¹…åŒ–è®¾ç½®"></a>æŒä¹…åŒ–è®¾ç½®</h2><p>å¦‚æœç¼“å­˜æ•°æ®å¯ä¸¢å¤±ï¼Œå¯ä»¥ç¦ç”¨æŒä¹…åŒ–ï¼ˆRDB å’Œ AOFï¼‰ä»¥å‡å°‘ç£ç›˜ IO å¼€é”€ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">save <span class="string">&quot;&quot;</span></span><br><span class="line">appendonly no</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> redis </tag>
            
            <tag> æ€§èƒ½ä¼˜åŒ– </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨Pythonè¯†åˆ«éªŒè¯ç  Muggle OCR</title>
      <link href="/posts/sp3b30/"/>
      <url>/posts/sp3b30/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘å‘ç°ä¸ª ddddocrï¼Œè¯†åˆ«ç‡å¾ˆé«˜ï¼Œè¯†åˆ«é€Ÿåº¦è¿˜å¾ˆå¿«ï¼š<a href="/posts/ss2wk6/">ä½¿ç”¨Pythonè¯†åˆ«éªŒè¯ç  ddddocr</a></p><div class="note flat"><p>ä»¥å‰ç”¨è¿‡ä»€ä¹ˆ pytesseract è¯†åˆ«æ•ˆæœå¾ˆå·®ï¼Œè¿˜éœ€è¦ç”µè„‘ä¸Šå®‰è£… <code>Tesseract OCR</code> çš„è½¯ä»¶ï¼Œä½†æ˜¯ä½¿ç”¨ä¸‹æ¥ï¼Œæ•ˆæœä¸å¥½ï¼Œåé¢ä¹Ÿç”¨è¿‡ <code>PaddleOCR</code> å¯ä»¥è¯†åˆ«ï¼Œä½†æ˜¯è¯†åˆ«é€Ÿåº¦æ¯”è¾ƒæ…¢ï¼ŒæˆåŠŸç‡ä¹Ÿä¸é«˜ã€‚åé¢åˆçœ‹åˆ°äº†è¿™ä¸ªå¼€æºå·¥å…·ï¼Œå¹ç‰›é€¼æ¯”è¾ƒå‰å®³ï¼Œå·ç§°è‡ªå·±æ˜¯éªŒè¯ç è¯†åˆ«çš„æœ€é«˜å¢ƒç•Œï¼Œå°±è¯•è¯•çœ‹ã€‚å®˜æ–¹çš„ GitHub åœ°å€æ˜¯ï¼š<a href="https://github.com/litongjava/muggle_ocr">https://github.com/litongjava/muggle_ocr</a></p></div><h2 id="æ•ˆæœå±•ç¤º"><a href="#æ•ˆæœå±•ç¤º" class="headerlink" title="æ•ˆæœå±•ç¤º"></a>æ•ˆæœå±•ç¤º</h2><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/20241226175928967.gif" alt="20241226175928967.gif|728"></p><h2 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h2><p>OSï¼š Windows 11<br>Pythonï¼š python-3.10.10-amd64</p><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>è¿™ä¸ªå¼€æºç¨‹åºåœ¨ pypi ä»“åº“ä¸Šè¢«ç§»é™¤äº†ï¼Œéœ€è¦åœ¨ GitHub ä¸Šå°†æºç åŒ…ä¸‹è½½ä¸‹æ¥å®‰è£…ã€‚</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/20241226152841716.png" alt="image.png|595"></p><p>ä¸‹è½½åˆ°æœ¬åœ°ï¼Œè§£å‹åï¼Œæ‰“å¼€ cmd å‘½ä»¤æç¤ºç¬¦ï¼Œ</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">REM åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ</span></span><br><span class="line">python -m venv venv</span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">REM å®‰è£…muggle_ocr</span></span><br><span class="line"><span class="built_in">cd</span> muggle_ocr-main</span><br><span class="line">python setup.py install</span><br></pre></td></tr></table></figure><h3 id="æŠ¥é”™å¤„ç†"><a href="#æŠ¥é”™å¤„ç†" class="headerlink" title="æŠ¥é”™å¤„ç†"></a>æŠ¥é”™å¤„ç†</h3><p><code>error: numpy 2.2.1 is installed but numpy&lt;2.1.0,&gt;=1.26.0 is required by &#123;&#39;tensorflow-intel&#39;&#125;</code></p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">REM ç”¨è¿™æ¡å‘½ä»¤æŸ¥ä¸€ä¸‹å¯ç”¨çš„ç‰ˆæœ¬</span></span><br><span class="line">pip index versions numpy</span><br><span class="line"></span><br><span class="line">pip install numpy==<span class="number">2</span>.<span class="number">0</span>.<span class="number">2</span></span><br></pre></td></tr></table></figure><p>ç„¶åå†é‡æ–°å®‰è£… muggle_ocr</p><h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><p>è¯†åˆ«éªŒè¯ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> os </span><br><span class="line"><span class="keyword">import</span> muggle_ocr</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">ä½¿ç”¨é¢„ç½®æ¨¡å‹ï¼Œé¢„ç½®æ¨¡å‹åŒ…å«äº†[ModelType.OCR, ModelType.Captcha] ä¸¤ç§</span></span><br><span class="line"><span class="string">å…¶ä¸­ ModelType.OCR ç”¨äºè¯†åˆ«æ™®é€šå°åˆ·æ–‡æœ¬, ModelType.Captcha ç”¨äºè¯†åˆ«4-6ä½ç®€å•è‹±æ•°éªŒè¯ç </span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰“å¼€éªŒè¯ç å›¾ç‰‡</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">r&quot;1.png&quot;</span>, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    captcha_bytes = f.read()</span><br><span class="line"></span><br><span class="line"><span class="comment"># ModelType.Captcha å¯è¯†åˆ«4-6ä½éªŒè¯ç </span></span><br><span class="line">sdk = muggle_ocr.SDK(model_type=muggle_ocr.ModelType.Captcha)</span><br><span class="line"><span class="comment"># 3. è°ƒç”¨é¢„æµ‹å‡½æ•°</span></span><br><span class="line">text = sdk.predict(image_bytes=captcha_bytes)</span><br><span class="line"><span class="built_in">print</span>(text)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> OCR </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>nginxåå‘ä»£ç†çš„context path</title>
      <link href="/posts/sootea/"/>
      <url>/posts/sootea/</url>
      
        <content type="html"><![CDATA[<h2 id="è¿”å›è¯·æ±‚-uri"><a href="#è¿”å›è¯·æ±‚-uri" class="headerlink" title="è¿”å›è¯·æ±‚ uri"></a>è¿”å›è¯·æ±‚ uri</h2><p>åœ¨ Nginx ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ <code>$request_uri</code> æ¥è¡¨ç¤ºè¯·æ±‚ uri, é…ç½®å¦‚ä¸‹ï¼›</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name example.com;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        add_header Content-Type text/html;</span><br><span class="line">        return 200 &quot;$request_uri\n&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå†ä½¿ç”¨å¦ä¸€å° nginx åå‘ä»£ç†åˆ°è¿™å° nginx å°±å¯ä»¥æµ‹è¯•è¯·æ±‚çš„ uri äº†ã€‚</p><h2 id="æµ‹è¯•-nginx-çš„åå‘ä»£ç†-content-path"><a href="#æµ‹è¯•-nginx-çš„åå‘ä»£ç†-content-path" class="headerlink" title="æµ‹è¯• nginx çš„åå‘ä»£ç† content path"></a>æµ‹è¯• nginx çš„åå‘ä»£ç† content path</h2><h3 id="1"><a href="#1" class="headerlink" title="1"></a>1</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">   proxy_pass http://192.168.200.12;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æœæ˜¯</p><p><code>curl localhost/aa/bb/</code> â€“&gt; <code>http://192.168.200.12/aa/bb/</code></p><h3 id="2"><a href="#2" class="headerlink" title="2"></a>2</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location /aa &#123;</span><br><span class="line">   proxy_pass http://192.168.200.12;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æœå’Œä¸Šé¢ä¸€æ ·ï¼Œä½†æ˜¯åªæœ‰ &#x2F;aa å¼€å¤´çš„æ‰èƒ½è½¬å‘åˆ°è¿™é‡Œ</p><h3 id="3"><a href="#3" class="headerlink" title="3"></a>3</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location /aa/ &#123;</span><br><span class="line">   proxy_pass http://192.168.200.12;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æœå’Œä¸Šé¢ä¸€æ ·ï¼Œä½†æ˜¯åªæœ‰ &#x2F;aa&#x2F; å¼€å¤´çš„æ‰èƒ½è½¬å‘åˆ°è¿™é‡Œ</p><h3 id="4"><a href="#4" class="headerlink" title="4"></a>4</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location /aa &#123;</span><br><span class="line">   proxy_pass http://192.168.200.12/;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æœæ˜¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@master1 nginx]<span class="comment"># curl localhost/aa/bb/cc</span></span><br><span class="line">//bb/cc</span><br></pre></td></tr></table></figure><h3 id="5"><a href="#5" class="headerlink" title="5"></a>5</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location /aa &#123;</span><br><span class="line">   proxy_pass http://192.168.200.12/x/y/z;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æœæ˜¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@master1 nginx]<span class="comment"># curl localhost/aa</span></span><br><span class="line">/x/y/z</span><br></pre></td></tr></table></figure><h2 id="nginx-çš„-alias"><a href="#nginx-çš„-alias" class="headerlink" title="nginx çš„ alias"></a>nginx çš„ alias</h2><p>Nginx çš„ alias æŒ‡ä»¤å¯ä»¥ç†è§£ä¸ºâ€œè·¯å¾„åˆ«åâ€ï¼Œå®ƒèƒ½æŠŠç”¨æˆ·è®¿é—®çš„ URL è·¯å¾„ç›´æ¥æ˜ å°„åˆ°æœåŠ¡å™¨ä¸Šçš„å¦ä¸€ä¸ªçœŸå®ç›®å½•ã€‚ä¸¾ä¸ªä¾‹å­ï¼š</p><p>å‡è®¾ä½ é…ç½®äº†ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location /images/ &#123;</span><br><span class="line">    alias /var/www/my_photos/;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ç”¨æˆ·è®¿é—® <code>http://ä½ çš„ç½‘ç«™/images/cat.jpg</code> æ—¶ï¼ŒNginx ä¼šç›´æ¥å»æœåŠ¡å™¨ä¸Šçš„ <code>/var/www/my_photos/cat.jpg</code> æ‰¾æ–‡ä»¶ï¼Œè€Œä¸ä¼šä¿ç•™ URL ä¸­çš„ <code>/images/</code> è·¯å¾„ã€‚</p><p>å’Œå¦ä¸€ä¸ªæŒ‡ä»¤ root çš„åŒºåˆ«åœ¨äºï¼š</p><p>ç”¨ root æ—¶ï¼Œè·¯å¾„æ˜¯è¿½åŠ ï¼ˆæ¯”å¦‚ location &#x2F;a&#x2F; { root &#x2F;b; }ï¼Œè®¿é—® <code>/a/1.jpg</code> ä¼šæ‰¾ <code>/b/a/1.jpg</code>ï¼‰<br>ç”¨ alias æ—¶ï¼Œè·¯å¾„æ˜¯æ›¿æ¢ï¼ˆåŒæ ·é…ç½®ä¸‹ï¼Œè®¿é—® <code>/a/1.jpg</code> ä¼šç›´æ¥æ‰¾ <code>/b/1.jpg</code>ï¼‰<br>éœ€è¦æ³¨æ„ï¼šé…ç½®æ—¶è·¯å¾„æœ«å°¾çš„ <code>/</code> è¦ç»Ÿä¸€ï¼Œæ¯”å¦‚ <code>location /images/</code> å’Œ <code>alias /var/www/my_photos/</code> éƒ½è¦å¸¦æ–œæ ï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´è·¯å¾„é”™è¯¯</p>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨kubeadméƒ¨ç½²ä¸€å¥—é«˜å¯ç”¨k8s 1.32é›†ç¾¤ for AlmaLinux9(RHEL9)</title>
      <link href="/posts/sof9i3/"/>
      <url>/posts/sof9i3/</url>
      
        <content type="html"><![CDATA[<blockquote><p>åŸºäº AlmaLinux9 ä½¿ç”¨ kubeadm æ­å»ºé›†ç¾¤ï¼Œ <a href="/posts/526ffc9a/">ubuntuéƒ¨ç½²æ–‡æ¡£</a>, æœ‰ç–‘é—®çš„åœ°æ–¹å¯ä»¥çœ‹ <a href="https://kubernetes.io/zh/docs/setup/production-environment/tools/kubeadm/">å®˜æ–¹æ–‡æ¡£</a>, æœ¬æ•™ç¨‹éœ€è¦èƒ½è®¿é—® <strong>å›½é™…äº’è”ç½‘</strong> ã€‚ä¸èƒ½çš„è¯ï¼Œéœ€è¦è§£å†³é•œåƒæ‹‰å–é—®é¢˜ã€yum å®‰è£…ç»„ä»¶çš„é—®é¢˜ã€‚</p></blockquote><h2 id="å‡†å¤‡æœºå™¨"><a href="#å‡†å¤‡æœºå™¨" class="headerlink" title="å‡†å¤‡æœºå™¨"></a>å‡†å¤‡æœºå™¨</h2><blockquote><p>æˆ‘çš„æœºå™¨è¯¦æƒ…å¦‚ä¸‹, é…ç½®è‡³å°‘ä¸º 4C4G</p></blockquote><table><thead><tr><th>hostname</th><th>IP</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>master1</td><td>10.0.0.11</td><td>k8s master èŠ‚ç‚¹</td></tr><tr><td>master2</td><td>10.0.0.12</td><td>k8s master èŠ‚ç‚¹</td></tr><tr><td>master3</td><td>10.0.0.13</td><td>k8s master èŠ‚ç‚¹</td></tr><tr><td>worker1</td><td>10.0.0.21</td><td>k8s worker èŠ‚ç‚¹</td></tr><tr><td>worker2</td><td>10.0.0.22</td><td>k8s worker èŠ‚ç‚¹</td></tr></tbody></table><p>æ¯å°æœºå™¨éƒ½åšåŸŸåè§£æï¼Œæˆ–è€…ç»‘å®š hostsï¼ˆç›´æ¥ä½¿ç”¨ ip åœ°å€ä¼šæœ‰è­¦å‘Šï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/hosts</span><br><span class="line"></span><br><span class="line">10.0.0.11 master1</span><br><span class="line">10.0.0.12 master2</span><br><span class="line">10.0.0.13 master3</span><br></pre></td></tr></table></figure><p>æ¯å°æœºå™¨éƒ½å…³é—­é˜²ç«å¢™å’Œ SELinux</p><blockquote><p>è´Ÿè½½å‡è¡¡æœºå™¨å¿…é¡»è¦å…³é—­,å› ä¸º 6443 ä¸æ˜¯ nginx çš„æ ‡å‡†ç«¯å£,ä¼šè¢« selinux æ‹¦æˆª, é˜²ç«å¢™ä¹Ÿéœ€è¦æ”¾è¡Œ 6443 ç«¯å£, å¯ä»¥è€ƒè™‘ç›´æ¥å…³é—­é˜²ç«å¢™</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl <span class="built_in">disable</span> --now firewalld</span><br><span class="line">setenforce 0</span><br><span class="line">sed -i <span class="string">&quot;s/^SELINUX=.*/SELINUX=disabled/g&quot;</span> /etc/selinux/config</span><br><span class="line"></span><br><span class="line"><span class="comment"># RHEL9ç³»åˆ—å®Œå…¨å…³é—­selinuxéœ€è¦ä¿®æ”¹å†…æ ¸å¯åŠ¨å‚æ•°ï¼Œ/etc/selinux/config æ–‡ä»¶é‡Œé¢æœ‰è¯´æ˜</span></span><br></pre></td></tr></table></figure><h2 id="åŸºç¡€ç¯å¢ƒé…ç½®"><a href="#åŸºç¡€ç¯å¢ƒé…ç½®" class="headerlink" title="åŸºç¡€ç¯å¢ƒé…ç½®"></a>åŸºç¡€ç¯å¢ƒé…ç½®</h2><blockquote><p>åŸºç¡€ç¯å¢ƒæ˜¯ä¸ç®¡ master è¿˜æ˜¯ worker éƒ½éœ€è¦çš„ç¯å¢ƒ</p></blockquote><ol><li>ç¦ç”¨ swap</li><li>ç¡®ä¿æ¯ä¸ªèŠ‚ç‚¹ä¸Š MAC åœ°å€å’Œ product_uuid çš„å”¯ä¸€æ€§ <code>sudo cat /sys/class/dmi/id/product_uuid</code></li><li>ä¿®æ”¹ hostname</li></ol><h3 id="å®‰è£…-runtime"><a href="#å®‰è£…-runtime" class="headerlink" title="å®‰è£… runtime"></a>å®‰è£… runtime</h3><h4 id="è®¾ç½®å†…æ ¸å‚æ•°"><a href="#è®¾ç½®å†…æ ¸å‚æ•°" class="headerlink" title="è®¾ç½®å†…æ ¸å‚æ•°"></a>è®¾ç½®å†…æ ¸å‚æ•°</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®¾ç½®å¿…éœ€çš„ sysctl å‚æ•°ï¼Œè¿™äº›å‚æ•°åœ¨é‡æ–°å¯åŠ¨åä»ç„¶å­˜åœ¨ã€‚</span></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF | sudo tee /etc/sysctl.d/99-kubernetes-cri.conf</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-iptables  = 1</span></span><br><span class="line"><span class="string">net.ipv4.ip_forward                 = 1</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-ip6tables = 1</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åº”ç”¨ sysctl å‚æ•°è€Œæ— éœ€é‡æ–°å¯åŠ¨</span></span><br><span class="line">sudo sysctl --system</span><br></pre></td></tr></table></figure><h4 id="å¯ç”¨å†…æ ¸æ¨¡å—"><a href="#å¯ç”¨å†…æ ¸æ¨¡å—" class="headerlink" title="å¯ç”¨å†…æ ¸æ¨¡å—"></a>å¯ç”¨å†…æ ¸æ¨¡å—</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF | sudo tee /etc/modules-load.d/containerd.conf</span></span><br><span class="line"><span class="string">overlay</span></span><br><span class="line"><span class="string">br_netfilter</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">sudo modprobe overlay</span><br><span class="line">sudo modprobe br_netfilter</span><br></pre></td></tr></table></figure><h4 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¸è½½æ—§ç‰ˆæœ¬Docker</span></span><br><span class="line">sudo yum remove docker \</span><br><span class="line">              docker-client \</span><br><span class="line">              docker-client-latest \</span><br><span class="line">              docker-common \</span><br><span class="line">              docker-latest \</span><br><span class="line">              docker-latest-logrotate \</span><br><span class="line">              docker-logrotate \</span><br><span class="line">              docker-engine</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…dockerä»“åº“</span></span><br><span class="line">sudo yum install -y yum-utils</span><br><span class="line">sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…containerd</span></span><br><span class="line">sudo yum install containerd.io -y</span><br></pre></td></tr></table></figure><h4 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h4><p>ä» yum æºå®‰è£…çš„ containerd é»˜è®¤ç¦ç”¨äº† criï¼Œå¯ä»¥ä½¿ç”¨å‘½ä»¤é‡æ–°ç”Ÿæˆé»˜è®¤é…ç½®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è½¯ä»¶åŒ…ä¸­è‡ªå¸¦çš„é…ç½®æ–‡ä»¶ä¸å…¨ï¼Œä½¿ç”¨å‘½ä»¤ç”Ÿæˆã€‚</span></span><br><span class="line">containerd config default | sudo <span class="built_in">tee</span> /etc/containerd/config.toml</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»“åˆ runc ä½¿ç”¨ systemd cgroup é©±åŠ¨ï¼Œåœ¨ `/etc/containerd/config.toml` ä¸­è®¾ç½®</span></span><br><span class="line">sed -i <span class="string">&#x27;s#SystemdCgroup = .*#SystemdCgroup = true#g&#x27;</span> /etc/containerd/config.toml</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹ pauseå®¹å™¨ é•œåƒï¼Œä¸èƒ½æ‹‰å–å®˜æ–¹é•œåƒçš„å¯ä»¥ä½¿ç”¨é˜¿é‡Œäº‘é•œåƒæº</span></span><br><span class="line"><span class="comment"># sed -i &#x27;s#sandbox_image = .*#sandbox_image = &quot;registry.aliyuncs.com/google_containers/pause:3.9&quot;#g&#x27; /etc/containerd/config.toml</span></span><br><span class="line">sed -i <span class="string">&#x27;s#sandbox_image = .*#sandbox_image = &quot;registry.k8s.io/pause:3.10&quot;#g&#x27;</span> /etc/containerd/config.toml</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®å¼€æœºè‡ªå¯åŠ¨</span></span><br><span class="line">sudo systemctl <span class="built_in">enable</span> containerd</span><br><span class="line">sudo systemctl restart containerd</span><br></pre></td></tr></table></figure><h4 id="crictl-é…ç½®"><a href="#crictl-é…ç½®" class="headerlink" title="crictl é…ç½®"></a>crictl é…ç½®</h4><p>ä¹‹å‰ä½¿ç”¨ docker çš„æ—¶å€™ï¼Œdocker ç»™æˆ‘ä»¬åšäº†å¾ˆå¤šå¥½ç”¨çš„å·¥å…·ï¼Œç°åœ¨ç”¨äº† containerdï¼Œç®¡ç†å®¹å™¨æˆ‘ä»¬ç”¨ cri ç®¡ç†å·¥å…· crictlï¼Œåˆ›å»ºé…ç½®æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; /etc/crictl.yaml &lt;&lt;-<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">runtime-endpoint: unix:///run/containerd/containerd.sock</span><br><span class="line">debug: <span class="literal">false</span></span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…-kubeadmã€kubelet-å’Œ-kubectl"><a href="#å®‰è£…-kubeadmã€kubelet-å’Œ-kubectl" class="headerlink" title="å®‰è£… kubeadmã€kubelet å’Œ kubectl"></a>å®‰è£… kubeadmã€kubelet å’Œ kubectl</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF | sudo tee /etc/yum.repos.d/kubernetes.repo</span></span><br><span class="line"><span class="string">[kubernetes]</span></span><br><span class="line"><span class="string">name=Kubernetes</span></span><br><span class="line"><span class="string">baseurl=https://pkgs.k8s.io/core:/stable:/v1.32/rpm/</span></span><br><span class="line"><span class="string">enabled=1</span></span><br><span class="line"><span class="string">gpgcheck=1</span></span><br><span class="line"><span class="string">gpgkey=https://pkgs.k8s.io/core:/stable:/v1.32/rpm/repodata/repomd.xml.key</span></span><br><span class="line"><span class="string">exclude=kubelet kubeadm kubectl cri-tools kubernetes-cni</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å¯ç”¨çš„ç‰ˆæœ¬</span></span><br><span class="line">yum list kubelet kubeadm kubectl --showduplicates --disableexcludes=kubernetes</span><br><span class="line"></span><br><span class="line">sudo yum install -y kubelet-1.32.0 kubeadm-1.32.0 kubectl-1.32.0 --disableexcludes=kubernetes</span><br><span class="line">sudo systemctl <span class="built_in">enable</span> --now kubelet</span><br></pre></td></tr></table></figure><h2 id="kube-apiserver-é«˜å¯ç”¨æ–¹æ¡ˆ"><a href="#kube-apiserver-é«˜å¯ç”¨æ–¹æ¡ˆ" class="headerlink" title="kube-apiserver é«˜å¯ç”¨æ–¹æ¡ˆ"></a>kube-apiserver é«˜å¯ç”¨æ–¹æ¡ˆ</h2><p>é«˜å¯ç”¨æ–¹æ¡ˆæœ‰å¾ˆå¤šç§ï¼Œå…¶ä»–æ–¹æ¡ˆè¯·å‚è€ƒ <a href="/posts/10cef768/">Kubernetesä¹‹masteré«˜å¯ç”¨æ–¹æ¡ˆ</a></p><p>è¿™é‡Œä½¿ç”¨<strong>æ¯å°</strong>èŠ‚ç‚¹éƒ¨ç½² nginx åä»£æ¥å®ç°é«˜å¯ç”¨ï¼Œè¿™ç§æ–¹å¼éœ€è¦<strong>æ‰€æœ‰</strong>èŠ‚ç‚¹éƒ½å®‰è£…è´Ÿè½½å‡è¡¡ (åŒ…æ‹¬ master å’Œ worker )</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /etc/kube-lb/&#123;conf,logs,sbin&#125;</span><br><span class="line"></span><br><span class="line">curl -L -C - https://file.babudiu.com/f/qjhX/kube-lb -o /etc/kube-lb/sbin/kube-lb</span><br><span class="line"><span class="built_in">chmod</span> +x /etc/kube-lb/sbin/kube-lb</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/kube-lb/conf/kube-lb.conf &lt;&lt;<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">user root;</span><br><span class="line">worker_processes 1;</span><br><span class="line"></span><br><span class="line">error_log  /etc/kube-lb/logs/error.log warn;</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  3000;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">stream &#123;</span><br><span class="line">    upstream backend &#123;</span><br><span class="line">        server 10.0.0.11:6443    max_fails=2 fail_timeout=3s;</span><br><span class="line">        server 10.0.0.12:6443    max_fails=2 fail_timeout=3s;</span><br><span class="line">        server 10.0.0.13:6443    max_fails=2 fail_timeout=3s;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen 127.0.0.1:8443;</span><br><span class="line">        proxy_connect_timeout 1s;</span><br><span class="line">        proxy_pass backend;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/systemd/system/kube-lb.service &lt;&lt;<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">[Unit]</span><br><span class="line">Description=l4 nginx proxy <span class="keyword">for</span> kube-apiservers</span><br><span class="line">After=network.target</span><br><span class="line">After=network-online.target</span><br><span class="line">Wants=network-online.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">ExecStartPre=/etc/kube-lb/sbin/kube-lb -c /etc/kube-lb/conf/kube-lb.conf -p /etc/kube-lb -t</span><br><span class="line">ExecStart=/etc/kube-lb/sbin/kube-lb -c /etc/kube-lb/conf/kube-lb.conf -p /etc/kube-lb</span><br><span class="line">ExecReload=/etc/kube-lb/sbin/kube-lb -c /etc/kube-lb/conf/kube-lb.conf -p /etc/kube-lb -s reload</span><br><span class="line">PrivateTmp=<span class="literal">true</span></span><br><span class="line">Restart=always</span><br><span class="line">RestartSec=15</span><br><span class="line">StartLimitInterval=0</span><br><span class="line">LimitNOFILE=65536</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨æœåŠ¡</span></span><br><span class="line">systemctl <span class="built_in">enable</span> --now kube-lb</span><br></pre></td></tr></table></figure><div class="note default flat"><p>kube-lb å…¶å®å°±æ˜¯è‡ªå·±ç¼–è¯‘çš„ Nginxï¼Œç²¾ç®€äº† http æ¨¡å—ï¼Œåªå¼€å¯äº† stream æ¨¡å—ç”¨ä½œ 4 å±‚è½¬å‘ï¼Œè¯¦ç»†å‚æ•°å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nginx version: nginx/1.24.0</span><br><span class="line">built by gcc 4.8.5 20150623 (Red Hat 4.8.5-44) (GCC)</span><br><span class="line">configure arguments: --with-stream --without-http --without-http_uwsgi_module --without-http_scgi_module --without-http_fastcgi_module</span><br></pre></td></tr></table></figure></div><h2 id="åˆ›å»ºé›†ç¾¤"><a href="#åˆ›å»ºé›†ç¾¤" class="headerlink" title="åˆ›å»ºé›†ç¾¤"></a>åˆ›å»ºé›†ç¾¤</h2><h3 id="æå‰æ‹‰é•œåƒï¼ˆå¯é€‰ï¼‰"><a href="#æå‰æ‹‰é•œåƒï¼ˆå¯é€‰ï¼‰" class="headerlink" title="æå‰æ‹‰é•œåƒï¼ˆå¯é€‰ï¼‰"></a>æå‰æ‹‰é•œåƒï¼ˆå¯é€‰ï¼‰</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubeadm config images pull \</span><br><span class="line">--kubernetes-version 1.32.0 \</span><br><span class="line">--image-repository registry.aliyuncs.com/google_containers</span><br></pre></td></tr></table></figure><h3 id="kubeadm-init"><a href="#kubeadm-init" class="headerlink" title="kubeadm init"></a>kubeadm init</h3><p>åœ¨ master1 ä¸Šæ‰§è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo kubeadm init \</span><br><span class="line">--control-plane-endpoint <span class="string">&quot;127.0.0.1:8443&quot;</span> \</span><br><span class="line">--kubernetes-version 1.32.0 \</span><br><span class="line">--upload-certs \</span><br><span class="line">--service-cidr=10.96.0.0/12 \</span><br><span class="line">--pod-network-cidr=10.244.0.0/16</span><br></pre></td></tr></table></figure><ul><li>ä¹Ÿå¯ä»¥ç”¨ <code>kubeadm config print init-defaults &gt; init.yaml</code> ç”Ÿæˆ kubeadm çš„é…ç½®ï¼Œå¹¶ç”¨ <code>kubeadm init --config=init.yaml</code> æ¥åˆ›å»ºé›†ç¾¤ã€‚</li><li>å¦‚æœä¸èƒ½æ‹‰å®˜æ–¹é•œåƒï¼Œå¢åŠ å‚æ•°ä½¿ç”¨é˜¿é‡Œäº‘é•œåƒæº <code>--image-repository registry.aliyuncs.com/google_containers</code></li></ul><h3 id="å®‰è£…ç½‘ç»œæ’ä»¶"><a href="#å®‰è£…ç½‘ç»œæ’ä»¶" class="headerlink" title="å®‰è£…ç½‘ç»œæ’ä»¶"></a>å®‰è£…ç½‘ç»œæ’ä»¶</h3><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">å®‰è£…flannelæ’ä»¶</button><button type="button" class="tab">å®‰è£…calicoæ’ä»¶</button></div><div class="tab-contents"><div class="tab-item-content active"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¦‚æœä¿®æ”¹äº† pod-network-cidr è¿™ä¸ªymlæ–‡ä»¶ä¹Ÿéœ€è¦ä¿®æ”¹</span></span><br><span class="line">kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å¾…è¡¥å……</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div><h2 id="å¸¸è§é—®é¢˜"><a href="#å¸¸è§é—®é¢˜" class="headerlink" title="å¸¸è§é—®é¢˜"></a>å¸¸è§é—®é¢˜</h2><p><a href="/posts/sepu3k/">kubeadm éƒ¨ç½²çš„é›†ç¾¤ å¸¸è§é—®é¢˜æ±‡æ€»</a></p>]]></content>
      
      
      <categories>
          
          <category> å®¹å™¨ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Grafanaè¡¨æ ¼ç»˜åˆ¶</title>
      <link href="/posts/so9bdi/"/>
      <url>/posts/so9bdi/</url>
      
        <content type="html"><![CDATA[<h2 id="é€‰æ‹©ä¸€ä¸ªå…³è”æ ‡ç­¾"><a href="#é€‰æ‹©ä¸€ä¸ªå…³è”æ ‡ç­¾" class="headerlink" title="é€‰æ‹©ä¸€ä¸ªå…³è”æ ‡ç­¾"></a>é€‰æ‹©ä¸€ä¸ªå…³è”æ ‡ç­¾</h2><p><code>instance</code> æ˜¯æœºå™¨ ipï¼Œä¸ä¼šé‡å¤ï¼Œæ‰€ä»¥æˆ‘ç”¨è¿™ä¸ªåšå…³è”å­—æ®µã€‚<br>ç¬¬ä¸€ä¸ªæŸ¥è¯¢æˆ‘ä¼šä¿ç•™å¤šä¸€äº›æ ‡ç­¾ï¼Œï¼ˆå¯ä»¥ä½¿ç”¨ <code>sum by ... (instance)</code> ä¿ç•™æƒ³è¦çš„æ ‡ç­¾ï¼‰å…¶ä»–çš„æŸ¥è¯¢å°½é‡åªä¿ç•™å…³è”å­—æ®µã€‚</p><p>é»˜è®¤é…ç½®äº†å¤šä¸ªæŸ¥è¯¢ï¼Œå¹¶å°† Grafana å›¾è¡¨ç±»å‹è®¾ç½®æˆ table åï¼Œå†å°†æŸ¥è¯¢çš„æ ¼å¼è®¾ç½®æˆ Tableï¼Œæ˜¾ç¤ºå¦‚ä¸‹ï¼Œæœ‰ä»¥ä¸‹å‡ ä¸ªé—®é¢˜ï¼š</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/20241210104651576.png" alt="image.png|918"></p><h2 id="æ•´åˆå¤šä¸ªæŸ¥è¯¢åœ¨ä¸€å¼ è¡¨é‡Œé¢"><a href="#æ•´åˆå¤šä¸ªæŸ¥è¯¢åœ¨ä¸€å¼ è¡¨é‡Œé¢" class="headerlink" title="æ•´åˆå¤šä¸ªæŸ¥è¯¢åœ¨ä¸€å¼ è¡¨é‡Œé¢"></a>æ•´åˆå¤šä¸ªæŸ¥è¯¢åœ¨ä¸€å¼ è¡¨é‡Œé¢</h2><p>ç°åœ¨æ˜¾ç¤ºçš„æ˜¯ 3 ä¸ªæŸ¥è¯¢ï¼Œé€šè¿‡ä¸€ä¸ªé€‰æ¡†æ¥åˆ‡æ¢çš„ï¼Œæˆ‘ä»¬æƒ³è¦è®©è¿™ 3 ä¸ªæŸ¥è¯¢æ˜¾ç¤ºåœ¨ä¸€ä¸ªæ¡†ä¸­ï¼Œå¯ä»¥åœ¨ Grafana çš„ <code>Transform data</code> ä¸­å¢åŠ ä¸€ä¸ª <code>Join by field</code>ï¼Œ æˆ‘è¿™é‡Œä»¥ instance è¿™ä¸ªå­—æ®µåšå…³è”ï¼Œä¹Ÿå°±æ˜¯è¯´åŒæ ·çš„ instance è®¤ä¸ºæ˜¯ä¸€æ¡æ•°æ®ã€‚å¯ä»¥çœ‹åˆ°å±•ç¤ºå‡ºæ¥åªæœ‰ä¸€æ¡æ•°æ®äº†ï¼Œå¹¶ä¸”é€‰æ¡†æ²¡æœ‰äº†ã€‚<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/20241210104917046.png" alt="image.png|970"></p><h2 id="ç§»é™¤ä¸æƒ³å±•ç¤ºçš„å­—æ®µ"><a href="#ç§»é™¤ä¸æƒ³å±•ç¤ºçš„å­—æ®µ" class="headerlink" title="ç§»é™¤ä¸æƒ³å±•ç¤ºçš„å­—æ®µ"></a>ç§»é™¤ä¸æƒ³å±•ç¤ºçš„å­—æ®µ</h2><p>ä¸Šé¢å¯ä»¥çœ‹åˆ°æ•°æ®å·²ç»è¢«å…³è”æˆäº†ä¸€æ¡ï¼Œä½†æ˜¯æœ‰å¾ˆå¤šä¸æƒ³æ˜¾ç¤ºçš„å­—æ®µï¼Œåœ¨ <code>Transform data</code> ä¸­å¢åŠ ä¸€ä¸ª <code>Organize fields by name</code>ï¼Œç»è¿‡è°ƒæ•´å</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/20241210105622474.png" alt="image.png|937"></p><h2 id="ä¿®æ”¹å­—æ®µå•ä½"><a href="#ä¿®æ”¹å­—æ®µå•ä½" class="headerlink" title="ä¿®æ”¹å­—æ®µå•ä½"></a>ä¿®æ”¹å­—æ®µå•ä½</h2><p>ä¸Šé¢çš„è¿è¡Œæ—¶é—´ï¼Œå•ä½æ˜¯ç§’ï¼Œéœ€è¦è°ƒæ•´ä¸€ä¸‹å•ä½ï¼Œåœ¨ Override ä¸­è°ƒæ•´ï¼š</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/20241210105842096.png" alt="image.png|1008"></p><h2 id="ç»™è¡¨æ ¼åˆ†é…é¢œè‰²"><a href="#ç»™è¡¨æ ¼åˆ†é…é¢œè‰²" class="headerlink" title="ç»™è¡¨æ ¼åˆ†é…é¢œè‰²"></a>ç»™è¡¨æ ¼åˆ†é…é¢œè‰²</h2><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/20241223164145064.png" alt="image.png|1051"></p><p>è¿™é‡Œçš„ unit å•ä½æ˜¯ percent 0-1 æ‰€ä»¥ä¸‹é¢çš„é˜ˆå€¼ä¹Ÿåº”è¯¥è®¾ç½®ä¸º 0-1 ä¹‹é—´ï¼Œæ¯”å¦‚è¶…è¿‡ 95% è®¾ç½®æˆçº¢è‰²ï¼Œè¶…è¿‡ 80% è®¾ç½®æˆé»„è‰²ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç›‘æ§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> grafana </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨RedisShakeè¿›è¡ŒRedisè¿ç§»</title>
      <link href="/posts/lmojvw5l/"/>
      <url>/posts/lmojvw5l/</url>
      
        <content type="html"><![CDATA[<p>å¯¹äºè‡ªå»ºçš„ redis, æˆ‘ä»¬å¯ä»¥å°† rdb&#x2F;aof æ–‡ä»¶æ‹·è´åˆ°ç›®çš„ redis, å¯åŠ¨æ¢å¤, ä½†æ˜¯äº‘ redis æˆ–è€…æŸäº›ç‰¹æ®Šæƒ…å†µ, æ¯”å¦‚æ²¡æœ‰äº‘å¹³å°çš„æƒé™ç­‰ç­‰æƒ…å†µ, å¯ä»¥ä½¿ç”¨å·¥å…·æ¥è¿›è¡Œè¿ç§».</p><p>RedisShake æ˜¯é˜¿é‡Œäº‘ Tair å›¢é˜Ÿ ç§¯æç»´æŠ¤çš„ä¸€ä¸ªé¡¹ç›®ã€‚å®ƒçš„æ¼”å˜å¯ä»¥è¿½æº¯åˆ°å…¶åˆå§‹ç‰ˆæœ¬ï¼Œè¯¥ç‰ˆæœ¬æ˜¯ä» redis-port åˆ†æ”¯å‡ºæ¥çš„ã€‚å®˜æ–¹æ–‡æ¡£<a href="https://tair-opensource.github.io/RedisShake/zh/guide/introduction.html">https://tair-opensource.github.io/RedisShake/zh/guide/introduction.html</a></p><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/tair-opensource/RedisShake/releases/download/v4.0.0/redis-shake-linux-amd64.tar.gz</span><br><span class="line">tar xf redis-shake-linux-amd64.tar.gz</span><br></pre></td></tr></table></figure><h2 id="åŒæ­¥è¿ç§»"><a href="#åŒæ­¥è¿ç§»" class="headerlink" title="åŒæ­¥è¿ç§»"></a>åŒæ­¥è¿ç§»</h2><p>åˆ›å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶ <code>redis_sync.toml</code></p><figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[sync_reader]</span></span><br><span class="line"><span class="attr">cluster</span> = <span class="literal">false</span>            <span class="comment"># æ˜¯å¦ä¸ºé›†ç¾¤</span></span><br><span class="line"><span class="attr">address</span> = <span class="string">&quot;127.0.0.1:6379&quot;</span></span><br><span class="line"><span class="attr">username</span> = <span class="string">&quot;&quot;</span>              <span class="comment"># keep empty if not using ACL</span></span><br><span class="line"><span class="attr">password</span> = <span class="string">&quot;&quot;</span>              <span class="comment"># keep empty if no authentication is required</span></span><br><span class="line"><span class="attr">tls</span> = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="section">[redis_writer]</span></span><br><span class="line"><span class="attr">cluster</span> = <span class="literal">false</span></span><br><span class="line"><span class="attr">address</span> = <span class="string">&quot;127.0.0.1:6380&quot;</span></span><br><span class="line"><span class="attr">username</span> = <span class="string">&quot;&quot;</span>              <span class="comment"># keep empty if not using ACL</span></span><br><span class="line"><span class="attr">password</span> = <span class="string">&quot;&quot;</span>              <span class="comment"># keep empty if no authentication is required</span></span><br><span class="line"><span class="attr">tls</span> = <span class="literal">false</span></span><br></pre></td></tr></table></figure><p>æ‰§è¡Œè¿ç§»æ“ä½œ, å‘½ä»¤ä¼šåœ¨åå°è¿›è¡Œç›‘å¬, åŒæ­¥ redis çš„å˜åŒ–, è¿ç§»å®Œæˆå†å…³é—­æ­¤æœåŠ¡.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./redis-shake ./redis_sync.toml</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨-RDB-æ–‡ä»¶è¿ç§»"><a href="#ä½¿ç”¨-RDB-æ–‡ä»¶è¿ç§»" class="headerlink" title="ä½¿ç”¨ RDB æ–‡ä»¶è¿ç§»"></a>ä½¿ç”¨ RDB æ–‡ä»¶è¿ç§»</h2><p>å…ˆåœ¨æº redis å¯¼å‡º rdb æ–‡ä»¶, ä¸Šä¼ åˆ°ä¸€å° linux æœºå™¨ (å¯ä»¥è®¿é—®ç›®æ ‡ redis), ç„¶åæ‰§è¡Œè¿ç§».</p><p>é…ç½®æ–‡ä»¶:</p><figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[rdb_reader]</span></span><br><span class="line"><span class="attr">filepath</span> = <span class="string">&quot;/tmp/dump.rdb&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="section">[redis_writer]</span></span><br><span class="line"><span class="attr">cluster</span> = <span class="literal">false</span></span><br><span class="line"><span class="attr">address</span> = <span class="string">&quot;127.0.0.1:6380&quot;</span></span><br><span class="line"><span class="attr">username</span> = <span class="string">&quot;&quot;</span>              <span class="comment"># keep empty if not using ACL</span></span><br><span class="line"><span class="attr">password</span> = <span class="string">&quot;&quot;</span>              <span class="comment"># keep empty if no authentication is required</span></span><br><span class="line"><span class="attr">tls</span> = <span class="literal">false</span></span><br></pre></td></tr></table></figure><p>æ‰§è¡Œè¿ç§»æ“ä½œ:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./redis-shake ./redis_sync.toml</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•°æ®è¿ç§» </tag>
            
            <tag> redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Elasticsearchç´¢å¼•ç”Ÿå‘½å‘¨æœŸé…ç½®</title>
      <link href="/posts/snui2r/"/>
      <url>/posts/snui2r/</url>
      
        <content type="html"><![CDATA[<p>å‚è€ƒ<br><a href="https://www.cnblogs.com/feifuzeng/p/13563430.html">https://www.cnblogs.com/feifuzeng/p/13563430.html</a><br><a href="https://blog.csdn.net/feiying0canglang/article/details/129789161">https://blog.csdn.net/feiying0canglang/article/details/129789161</a></p><p>è¿™é‡Œä»¥ <code>Elasticsearch 7.17.14</code> ä¸ºä¾‹ï¼Œ7.8 ç‰ˆæœ¬ä¹‹å‰ä¸ä¹‹åæœ‰ä¸€ç‚¹åŒºåˆ«ã€‚7.8 ä¹‹åçš„ API æ˜¯ï¼š<code>_index_template</code>ï¼Œ7.8 ä¹‹å‰çš„å‘½ä»¤æ˜¯ï¼š<code>_template</code></p><h2 id="è®¾ç½®ç´¢å¼•æ¨¡æ¿"><a href="#è®¾ç½®ç´¢å¼•æ¨¡æ¿" class="headerlink" title="è®¾ç½®ç´¢å¼•æ¨¡æ¿"></a>è®¾ç½®ç´¢å¼•æ¨¡æ¿</h2><p>æ¨¡æ¿æ˜¯ä¸ºäº†è®©åˆ›å»ºçš„ç´¢å¼•æŒ‰ç…§ä¸€å®šçš„è§„åˆ™ï¼Œæ¯”å¦‚ç´¢å¼•æŒ‰å¤©åˆ†å‰²ï¼Œæ‰‹åŠ¨ç»™æ¯ä¸ªç´¢å¼•åšé…ç½®å¤ªéº»çƒ¦</p><h2 id="åˆ›å»ºç”Ÿå‘½å‘¨æœŸç­–ç•¥"><a href="#åˆ›å»ºç”Ÿå‘½å‘¨æœŸç­–ç•¥" class="headerlink" title="åˆ›å»ºç”Ÿå‘½å‘¨æœŸç­–ç•¥"></a>åˆ›å»ºç”Ÿå‘½å‘¨æœŸç­–ç•¥</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®¾ç½®ingressæ—¥å¿—ä¿ç•™14å¤©ï¼Œè¶…è¿‡14å¤©åˆ é™¤ã€‚</span></span><br><span class="line">PUT _ilm/policy/ingress-log-retention-policy</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;policy&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;phases&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;hot&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;actions&quot;</span>: &#123;&#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&quot;delete&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;min_age&quot;</span>: <span class="string">&quot;14d&quot;</span>,</span><br><span class="line">        <span class="string">&quot;actions&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;delete&quot;</span>: &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åˆ›å»ºç´¢å¼•æ¨¡æ¿"><a href="#åˆ›å»ºç´¢å¼•æ¨¡æ¿" class="headerlink" title="åˆ›å»ºç´¢å¼•æ¨¡æ¿"></a>åˆ›å»ºç´¢å¼•æ¨¡æ¿</h2><p>ç´¢å¼•æ¨¡æ¿å¼•ç”¨ä¸Šé¢åˆ›å»ºçš„ç”Ÿå‘½å‘¨æœŸç­–ç•¥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºç´¢å¼•æ¨¡æ¿ï¼Œä¿è¯æ–°åˆ›å»ºçš„ç´¢å¼•éƒ½åº”ç”¨è¿™ä¸ªæ¨¡æ¿</span></span><br><span class="line">PUT /_index_template/ingress-log-template</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;index_patterns&quot;</span>: [<span class="string">&quot;ingress-*&quot;</span>],</span><br><span class="line">  <span class="string">&quot;template&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;settings&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;number_of_replicas&quot;</span>: 0,</span><br><span class="line">      <span class="string">&quot;index&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;lifecycle&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;name&quot;</span>: <span class="string">&quot;ingress-log-retention-policy&quot;</span>,</span><br><span class="line">          <span class="string">&quot;rollover_alias&quot;</span>: <span class="string">&quot;ingress-log-alias&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ£€æŸ¥æ˜¯å¦ç”Ÿæ•ˆ"><a href="#æ£€æŸ¥æ˜¯å¦ç”Ÿæ•ˆ" class="headerlink" title="æ£€æŸ¥æ˜¯å¦ç”Ÿæ•ˆ"></a>æ£€æŸ¥æ˜¯å¦ç”Ÿæ•ˆ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥è¯¢ç´¢å¼•çš„ilmçŠ¶æ€</span></span><br><span class="line">GET ingress-2024.12.01/_ilm/explain</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥è¯¢ç´¢å¼•è®¾ç½®ï¼Œæ¯”å¦‚æŸ¥çœ‹æ˜¯å¦ç»‘å®šäº†ilmç­–ç•¥</span></span><br><span class="line">GET ingress-2024.12.01/_settings</span><br></pre></td></tr></table></figure><h2 id="ä¿®æ”¹ç³»ç»Ÿé…ç½®"><a href="#ä¿®æ”¹ç³»ç»Ÿé…ç½®" class="headerlink" title="ä¿®æ”¹ç³»ç»Ÿé…ç½®"></a>ä¿®æ”¹ç³»ç»Ÿé…ç½®</h2><p>Elasticsearch ä¸ä¼šå®æ—¶æ£€æµ‹ï¼Œå¯ä»¥ä¿®æ”¹æ£€æµ‹æ—¶é—´é—´éš”</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹é›†ç¾¤çš„è®¾ç½®</span></span><br><span class="line">GET /_cluster/settings</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®æ£€æŸ¥æ—¶é—´ä¸º60s</span></span><br><span class="line">PUT _cluster/settings</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;persistent&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;indices.lifecycle.poll_interval&quot;</span>:<span class="string">&quot;60s&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ‰‹åŠ¨ä¿®æ”¹ç°å­˜çš„ç´¢å¼•"><a href="#æ‰‹åŠ¨ä¿®æ”¹ç°å­˜çš„ç´¢å¼•" class="headerlink" title="æ‰‹åŠ¨ä¿®æ”¹ç°å­˜çš„ç´¢å¼•"></a>æ‰‹åŠ¨ä¿®æ”¹ç°å­˜çš„ç´¢å¼•</h2><p>å› ä¸ºæˆ‘ä»¬åˆ›å»ºäº†ç´¢å¼•æ¨¡æ¿ï¼Œåªèƒ½åœ¨ä¸‹æ¬¡åˆ›å»ºæ–°ç´¢å¼•æ‰èƒ½ç”Ÿæ•ˆï¼Œè€ç´¢å¼•éœ€è¦æ‰‹åŠ¨ç»‘å®šåˆ°ç­–ç•¥ä¸Šã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ‰‹åŠ¨ä¿®æ”¹ç´¢å¼•ç»‘å®šçš„ilmç­–ç•¥</span></span><br><span class="line">PUT ingress-2024.12.01/_settings</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;index&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;lifecycle.name&quot;</span>: <span class="string">&quot;ingress-log-retention-policy&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å¯¹äº-logstash"><a href="#å¯¹äº-logstash" class="headerlink" title="å¯¹äº logstash"></a>å¯¹äº logstash</h2><p>logstash ä¼šåˆ›å»ºè‡ªå·±çš„é»˜è®¤ templateï¼Œæ‰€ä»¥æƒ³è¦åº”ç”¨ template éœ€è¦ç¦ç”¨ logstash çš„ manage_template</p><p><code>logstash.conf</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">input &#123;</span><br><span class="line">  kafka &#123;</span><br><span class="line">    bootstrap_servers =&gt; &quot;10.10.10.10:9092,10.10.10.11:9092,10.10.10.12:9092&quot;</span><br><span class="line">    topics =&gt; [&quot;ingress-k8s&quot;]</span><br><span class="line">    codec =&gt; &quot;json&quot;</span><br><span class="line">    consumer_threads =&gt; 3</span><br><span class="line">    group_id =&gt; &quot;k8s_group&quot;</span><br><span class="line">    decorate_events =&gt; true</span><br><span class="line">    type =&gt; &quot;logstash_mixins&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">filter&#123;</span><br><span class="line">    mutate&#123;</span><br><span class="line">        rename =&gt; [&quot;[host][name]&quot;, &quot;hostname&quot;]</span><br><span class="line">        remove_field =&gt; [&quot;ecs&quot;,&quot;@version&quot;,&quot;input&quot;,&quot;host&quot;,&quot;agent&quot;,&quot;log&quot;]</span><br><span class="line">        convert =&gt; &#123;</span><br><span class="line">          &quot;status&quot; =&gt; &quot;integer&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line">  if [type] == &quot;logstash_mixins&quot; &#123;</span><br><span class="line">      elasticsearch &#123;</span><br><span class="line">          action   =&gt; &quot;index&quot;</span><br><span class="line">          manage_template =&gt; false</span><br><span class="line">          hosts    =&gt; [&quot;http://10.10.10.21:9200&quot;,&quot;http://10.10.10.22:9200&quot;,&quot;http://10.10.10.23:9200&quot;]</span><br><span class="line">          index    =&gt; &quot;%&#123;[fields][type]&#125;-%&#123;+YYYY.MM.dd&#125;&quot;</span><br><span class="line">          user     =&gt; &quot;elastic&quot;</span><br><span class="line">          password =&gt; &quot;password&quot;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>éœ€è¦åœ¨ output ä¸­æ·»åŠ ä¸€è¡Œï¼š<code>manage_template =&gt; false</code></p>]]></content>
      
      
      <categories>
          
          <category> æ—¥å¿— </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¸¸ç”¨æ“ä½œ </tag>
            
            <tag> ES </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åœ¨Windowsä¸­ä½¿ç”¨msysæ¥è¿è¡Œlinuxå‘½ä»¤</title>
      <link href="/posts/snrcqh/"/>
      <url>/posts/snrcqh/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸ºä»€ä¹ˆä¸ç”¨-WSL"><a href="#ä¸ºä»€ä¹ˆä¸ç”¨-WSL" class="headerlink" title="ä¸ºä»€ä¹ˆä¸ç”¨ WSL"></a>ä¸ºä»€ä¹ˆä¸ç”¨ WSL</h2><p>ä¸»è¦åŸå› æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ol><li>WSL è®¿é—® Windows çš„è·¯å¾„å’ŒåŸç”Ÿ Windows ä¸ä¸€è‡´ï¼Œéœ€è¦æ‰‹åŠ¨æˆ–è€… <code>wslpath</code> å‘½ä»¤æ¥è½¬æ¢</li><li>åœ¨ Windows çš„å‘½ä»¤è¡Œè¿è¡Œ wsl å‘½ä»¤çš„æ—¶å€™ï¼Œéœ€è¦é€šè¿‡ <code>wsl &lt;linuxå‘½ä»¤&gt;</code> è¿™ç§æ–¹å¼æ¥å®ç°ï¼Œå¹¶ä¸æ˜¯åŸç”Ÿçš„ Windows å‘½ä»¤å†™æ³•ã€‚</li><li>WSL å¯åŠ¨è€—æ—¶é—®é¢˜ï¼ˆå€’è¿˜å¥½ï¼Œå½±å“ä¸å¤§ã€‚ï¼‰</li></ol><h2 id="ä¸‹è½½å®‰è£…"><a href="#ä¸‹è½½å®‰è£…" class="headerlink" title="ä¸‹è½½å®‰è£…"></a>ä¸‹è½½å®‰è£…</h2><p>å®˜ç½‘åœ°å€ï¼š<a href="https://www.msys2.org/">https://www.msys2.org/</a><br>å®‰è£…ç›´æ¥ä¸‹ä¸€æ­¥ä¸‹ä¸€æ­¥å³å¯ã€‚</p><blockquote><p>ä¸åŒçš„å¯åŠ¨å™¨ä¹‹é—´çš„åŒºåˆ«è¯·çœ‹ï¼š<a href="https://www.msys2.org/docs/environments/">https://www.msys2.org/docs/environments/</a></p></blockquote><h2 id="å¢åŠ ç¯å¢ƒå˜é‡"><a href="#å¢åŠ ç¯å¢ƒå˜é‡" class="headerlink" title="å¢åŠ ç¯å¢ƒå˜é‡"></a>å¢åŠ ç¯å¢ƒå˜é‡</h2><p>æˆ–è€… win + R è¾“å…¥ <code>sysdm.cpl</code> ç‚¹å‡» é«˜çº§ ç¯å¢ƒå˜é‡ è¿›å…¥ç¯å¢ƒå˜é‡é…ç½®ç•Œé¢ï¼š</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202411302227697.png" alt="image.png|753"></p><p>ä¸€èˆ¬æ¥è¯´å»ºè®®ä¿®æ”¹ç”¨æˆ·å˜é‡é‡Œé¢çš„ PATH å³å¯ï¼Œæ·»åŠ ä¸€ä¸ªè·¯å¾„ï¼š<code>C:\msys64\usr\bin</code></p><p>ç„¶åå°±å¯ä»¥æ­£å¸¸ä½¿ç”¨äº†ã€‚</p><h2 id="å¸¸ç”¨æŠ€å·§"><a href="#å¸¸ç”¨æŠ€å·§" class="headerlink" title="å¸¸ç”¨æŠ€å·§"></a>å¸¸ç”¨æŠ€å·§</h2><p>åŒ…ç®¡ç†ä½¿ç”¨çš„æ˜¯ pacman ï¼Œä½¿ç”¨æ–‡æ¡£å¯ä»¥çœ‹è¿™é‡Œï¼š<a href="https://www.msys2.org/docs/package-management/">https://www.msys2.org/docs/package-management/</a></p><p>æ¯”å¦‚å®‰è£… vimï¼Œå¯ä»¥æ‰§è¡Œ <code>pacman -S vim</code></p>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>HTTPSçš„åŸç†ï¼Œä½¿ç”¨HTTPSå°±ä¸€å®šæ˜¯å®‰å…¨çš„å—ï¼Ÿ</title>
      <link href="/posts/sna41n/"/>
      <url>/posts/sna41n/</url>
      
        <content type="html"><![CDATA[<h2 id="HTTPS-æ˜¯ä»€ä¹ˆ"><a href="#HTTPS-æ˜¯ä»€ä¹ˆ" class="headerlink" title="HTTPS æ˜¯ä»€ä¹ˆ"></a>HTTPS æ˜¯ä»€ä¹ˆ</h2><p>ä»¥å‰ä¸€ç›´ä»¥ä¸º HTTPS æ˜¯ä¸€ç§ä¸ HTTP ç±»ä¼¼çš„åº”ç”¨å±‚åè®®ï¼Œåæ¥æ‰å‘ç° HTTPS å¹¶ä¸æ˜¯ä¸€ç§åè®®ã€‚https åªæ˜¯åœ¨ URI ä¸­ä½œä¸º protocol identifier ç½¢äº†ã€‚HTTPS å…¶å®æ˜¯ HTTP Over TLSï¼ˆ <a href="https://datatracker.ietf.org/doc/html/rfc2818">RFC2818</a> ï¼‰çš„ç®€ç§°ï¼Œä¹Ÿå°±æ˜¯è¿è¡Œåœ¨ TLS åè®®ä¸Šçš„ HTTP åè®®ï¼Œä½¿ç”¨ TLS åè®®å¯¹ HTTP æ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œä»è€Œä¿è¯äº†å®‰å…¨æ€§ã€‚</p><h2 id="TLS-åè®®ç®€ä»‹"><a href="#TLS-åè®®ç®€ä»‹" class="headerlink" title="TLS åè®®ç®€ä»‹"></a>TLS åè®®ç®€ä»‹</h2><p>HTTPS çš„æ ¸å¿ƒå°±æ˜¯ TLS åè®®ï¼Œé‚£ä¹ˆ TLS åè®®åˆæ˜¯ä»€ä¹ˆå‘¢ï¼ŸTLS çš„å…¨ç§°ä¸º Transport Layer Securityï¼Œä¹Ÿå°±æ˜¯åœ¨ä¼ è¾“å±‚ä¿è¯å®‰å…¨ <a href="https://tools.ietf.org/html/rfc5246">RFC5246</a>ã€‚ä¸»è¦åˆ†ä¸ºä»¥ä¸‹å››ä¸ªåè®®ï¼š</p><ul><li><a href="https://tools.ietf.org/html/rfc5246#page-37">handshake protocol</a>ï¼Œç”¨æ¥å»ºç«‹è¿æ¥ã€èº«ä»½è®¤è¯ã€å¯†é’¥åå•†</li><li><a href="https://tools.ietf.org/html/rfc5246#page-28">alert protocol</a>ï¼Œç”¨æ¥å…³é—­è¿æ¥</li><li><a href="https://tools.ietf.org/html/rfc5246#page-27">change cipher spec protocol</a>ï¼Œç”¨æ¥è¡¨ç¤ºå¼€å§‹ä½¿ç”¨åå•†å¥½çš„åŠ å¯†æ–¹å¼è¿›è¡Œæ•°æ®ä¼ è¾“</li><li><a href="https://tools.ietf.org/html/rfc5246#page-65">application data protocol</a>ï¼Œç”¨æ¥ä¼ è¾“å¯†æ–‡</li></ul><p>TLS åè®®ä¸­æœ€é‡è¦çš„å°±æ˜¯ handshake äº†ï¼Œåœ¨æ¡æ‰‹é˜¶æ®µé€šä¿¡åŒæ–¹ä»¥å®‰å…¨çš„æ–¹å¼åå•†å¥½ç”¨äºä¹‹åæ•°æ®ä¼ è¾“çš„åŠ å¯†æ–¹å¼ä»¥åŠå„ç§å¯†é’¥ã€‚</p><h2 id="HTTPS-è¿æ¥è¿‡ç¨‹"><a href="#HTTPS-è¿æ¥è¿‡ç¨‹" class="headerlink" title="HTTPS è¿æ¥è¿‡ç¨‹"></a>HTTPS è¿æ¥è¿‡ç¨‹</h2><p>å¤§å®¶å¯èƒ½éƒ½å¬è¯´è¿‡ HTTPS åè®®ä¹‹æ‰€ä»¥æ˜¯å®‰å…¨çš„æ˜¯å› ä¸º HTTPS åè®®ä¼šå¯¹ä¼ è¾“çš„æ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œè€ŒåŠ å¯†è¿‡ç¨‹æ˜¯ä½¿ç”¨äº†éå¯¹ç§°åŠ å¯†å®ç°ã€‚ä½†å…¶å®ï¼ŒHTTPS åœ¨å†…å®¹ä¼ è¾“çš„åŠ å¯†ä¸Šä½¿ç”¨çš„æ˜¯å¯¹ç§°åŠ å¯†ï¼Œéå¯¹ç§°åŠ å¯†åªä½œç”¨åœ¨è¯ä¹¦éªŒè¯é˜¶æ®µã€‚</p><p>HTTPS çš„æ•´ä½“è¿‡ç¨‹åˆ†ä¸ºè¯ä¹¦éªŒè¯å’Œæ•°æ®ä¼ è¾“é˜¶æ®µï¼Œå…·ä½“çš„äº¤äº’è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202411211110422.webp" alt="41ac7d0df61046f0ab518fba866838dd.webp"></p><h3 id="å®¢æˆ·ç«¯è¯·æ±‚å»ºç«‹è¿æ¥"><a href="#å®¢æˆ·ç«¯è¯·æ±‚å»ºç«‹è¿æ¥" class="headerlink" title="å®¢æˆ·ç«¯è¯·æ±‚å»ºç«‹è¿æ¥"></a>å®¢æˆ·ç«¯è¯·æ±‚å»ºç«‹è¿æ¥</h3><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202411211139023.png" alt="image.png"></p><p>å®¢æˆ·ç«¯é¦–å…ˆè¦å‘æœåŠ¡å™¨è¯·æ±‚å»ºç«‹ä¸€ä¸ªå®‰å…¨è¿æ¥ã€‚éœ€è¦å‘é€ç»™æœåŠ¡å™¨çš„å¿…è¦ä¿¡æ¯æœ‰ï¼š</p><ul><li>TLS åè®®ç‰ˆæœ¬ã€‚</li><li>Cipher Suitesã€‚ç”±äºåŒæ–¹å¯¹ä¸€äº›åŠ å¯†ç®—æ³•çš„æ”¯æŒç¨‹åº¦å¯èƒ½ä¸åŒï¼Œå®¢æˆ·ç«¯éœ€è¦å°†å®ƒæ”¯æŒçš„åŠ å¯†æ–¹æ³•å‘é€ç»™æœåŠ¡å™¨ï¼Œä»¥ä¾›æœåŠ¡å™¨è¿›è¡Œé€‰æ‹©ã€‚</li><li>Session IDã€‚å¦‚æœæä¾›çš„è¯ï¼Œè¡¨ç¤ºä½¿ç”¨å‰ä¸€ä¸ªä¼šè¯ä¸­å·²åå•†å¥½çš„å¯†é’¥ï¼Œè€Œæ— éœ€å†æ¬¡åå•†ã€‚</li><li>Randomã€‚å®¢æˆ·ç«¯ç”Ÿæˆçš„éšæœºå€¼ï¼Œç”¨æ¥ç”Ÿæˆ <code>Master Secret</code>ã€‚</li><li>server_name extensionã€‚è¡¨ç¤ºè®¿é—®çš„æ˜¯å“ªä¸ªç½‘ç«™ã€‚</li></ul><h3 id="æœåŠ¡å™¨ç¡®å®šåŠ å¯†å¥—ä»¶"><a href="#æœåŠ¡å™¨ç¡®å®šåŠ å¯†å¥—ä»¶" class="headerlink" title="æœåŠ¡å™¨ç¡®å®šåŠ å¯†å¥—ä»¶"></a>æœåŠ¡å™¨ç¡®å®šåŠ å¯†å¥—ä»¶</h3><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202411211418010.png" alt="image.png"></p><p>æœåŠ¡å™¨æ¥æ”¶åˆ°å»ºç«‹è¿æ¥çš„è¯·æ±‚ä¹‹åï¼Œè¦å‘é€ä»¥ä¸‹ä¿¡æ¯ï¼š</p><ul><li>TLS åè®®ç‰ˆæœ¬ã€‚</li><li>Cipher Suiteã€‚ä»å®¢æˆ·ç«¯æä¾›çš„å¯é€‰åŠ å¯†æ–¹å¼ä¸­é€‰æ‹©ä¸€ä¸ªã€‚</li><li>Session IDã€‚æœ¬æ¬¡ä¼šè¯çš„ IDã€‚</li><li>Randomã€‚éšæœºç”Ÿæˆçš„å€¼ï¼Œç”¨æ¥ç”Ÿæˆ <code>Master Secret</code>ã€‚</li></ul><h3 id="æœåŠ¡å™¨å‘é€è¯ä¹¦"><a href="#æœåŠ¡å™¨å‘é€è¯ä¹¦" class="headerlink" title="æœåŠ¡å™¨å‘é€è¯ä¹¦"></a>æœåŠ¡å™¨å‘é€è¯ä¹¦</h3><p>åœ¨å‘é€ <code>Server Hello</code> ä¹‹åï¼ŒæœåŠ¡å™¨è¿˜éœ€è¦æŠŠå…¶è¯ä¹¦é€šè¿‡ <code>Certificate</code> å‘ç»™å®¢æˆ·ç«¯ã€‚</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202411211418690.png" alt="image.png"></p><p>è¯ä¹¦çš„ä½œç”¨åœ¨ <a href="https://yieldnull.com/blog/001efdfe76e6f4f672faf785dff1cc54e4fd26ba/">â€œç”¨æ•°å­—è¯ä¹¦è¯æ˜ä½ æ˜¯ä½ â€</a> ä¸€æ–‡ä¸­å·²ç»é˜æ˜ã€‚</p><p>è¦æ˜¯ä¹‹å‰ç¡®å®šçš„åŠ å¯†å¥—ä»¶ä¸­çš„ç§˜é’¥äº¤æ¢ç®—æ³•è¿˜éœ€è¦ä¸€äº›é¢å¤–çš„ä¿¡æ¯ï¼Œé‚£ä¹ˆæœåŠ¡å™¨è¿˜ä¼šå‘é€ä¸€ä¸ª <code>Server Key Exchange</code>ï¼Œç”¨æ¥ä¼ é€’é¢å¤–çš„ä¿¡æ¯ã€‚</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202411211419536.png" alt="image.png"></p><h3 id="åŒæ–¹å®Œæˆèº«ä»½è®¤è¯"><a href="#åŒæ–¹å®Œæˆèº«ä»½è®¤è¯" class="headerlink" title="åŒæ–¹å®Œæˆèº«ä»½è®¤è¯"></a>åŒæ–¹å®Œæˆèº«ä»½è®¤è¯</h3><p>ï¼ˆå¦‚æœæœåŠ¡å™¨è¦è®¤è¯å®¢æˆ·ç«¯çš„èº«ä»½ï¼Œé‚£ä¹ˆä¼šå‘é€ä¸€ä¸ª <code>Certificate Request</code> æ¥å‘å®¢æˆ·ç«¯è¯·æ±‚è¯ä¹¦ï¼Œå®¢æˆ·ç«¯æ”¶åˆ°è¯·æ±‚ä¹‹åä¼šå‘é€ <code>Certificate</code> ç»™æœåŠ¡å™¨ï¼‰</p><p>æœ€åï¼Œï¼ˆç¡®è®¤å®¢æˆ·ç«¯èº«ä»½ä¹‹åï¼‰æœåŠ¡å™¨å‘é€ <code>Server Done</code> è¡¨ç¤ºæˆ‘æƒ³çŸ¥é“çš„éƒ½å·²ç»çŸ¥é“äº†ï¼Œè¯¥å‘çš„ä¹Ÿå‘ç»™ä½ äº†ã€‚</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202411211419375.png" alt="image.png"></p><h3 id="ç”Ÿæˆå¯†é’¥"><a href="#ç”Ÿæˆå¯†é’¥" class="headerlink" title="ç”Ÿæˆå¯†é’¥"></a>ç”Ÿæˆå¯†é’¥</h3><p>é€šè¿‡ä¹‹å‰çš„æ­¥éª¤ï¼Œé€šä¿¡åŒæ–¹è®¤è¯äº†å¯¹æ–¹çš„èº«ä»½ï¼Œæ˜ç¡®äº†åŠ å¯†å¥—ä»¶ï¼Œç°åœ¨å°±ç¼ºåŠ å¯†å¯†é’¥äº†ã€‚</p><p>æ­¤æ—¶ï¼Œå®¢æˆ·ç«¯ä¼šç”Ÿæˆä¸€ä¸ª <code>premaster secret</code>ï¼Œå¹¶ç”¨æœåŠ¡å™¨è¯ä¹¦ä¸­çš„å…¬é’¥è¿›è¡ŒåŠ å¯†ï¼Œç„¶åé€šè¿‡ <code>Client Key Exchange</code> å‘é€ç»™æœåŠ¡å™¨ã€‚</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202411211420975.png" alt="image.png"></p><p>åŒæ—¶ï¼Œå®¢æˆ·ç«¯ä¼šåœ¨æœ¬åœ°ä½¿ç”¨ <code>premaster secret</code>ï¼Œä»¥åŠä¹‹å‰åœ¨ <code>Hello</code> é˜¶æ®µåŒæ–¹ç”Ÿæˆçš„ä¸¤ä¸ªéšæœºæ•°ï¼Œç”Ÿæˆæœ€ç»ˆçš„ <code>master secret</code></p><p>æœåŠ¡å™¨æ”¶åˆ° <code>Client Key Exchange</code> ä¹‹åï¼Œä½¿ç”¨å…¶ç§é’¥è§£å¯†å‡º <code>premaster secret</code>ã€‚ç„¶åä½¿ç”¨ä¸å®¢æˆ·ç«¯ç›¸åŒçš„æ–¹å¼ï¼Œç”Ÿæˆä¸å®¢æˆ·ç«¯ç›¸åŒçš„ <code>master secret</code>ã€‚</p><h3 id="é€šçŸ¥å¼€å§‹åŠ å¯†ä¼ è¾“"><a href="#é€šçŸ¥å¼€å§‹åŠ å¯†ä¼ è¾“" class="headerlink" title="é€šçŸ¥å¼€å§‹åŠ å¯†ä¼ è¾“"></a>é€šçŸ¥å¼€å§‹åŠ å¯†ä¼ è¾“</h3><p>å½“åŒæ–¹éƒ½å¾—åˆ° <code>master secret</code> ä¹‹åï¼Œå°±ä¼šå‘é€ <code>Change Cipher Spec</code> é€šçŸ¥å¯¹æ–¹ï¼šæˆ‘å¼€å§‹ç”¨ä¹‹å‰å•†é‡å¥½çš„åŠ å¯†æ–¹å¼ä»¥åŠå¯†é’¥ä¼ è¾“æ•°æ®äº†ã€‚</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202411211420400.png" alt="image.png"></p><h3 id="ç¡®ä¿å¯†é’¥å¯ç”¨"><a href="#ç¡®ä¿å¯†é’¥å¯ç”¨" class="headerlink" title="ç¡®ä¿å¯†é’¥å¯ç”¨"></a>ç¡®ä¿å¯†é’¥å¯ç”¨</h3><p>ä¸ºäº†ç¡®ä¿ä¹‹å‰çš„åå•†çš„ç¡®æ˜¯æˆåŠŸäº†ï¼ŒåŒæ–¹è¿˜éœ€è¦ç¡®è®¤ä¸€ä¸‹åŒæ–¹ä½¿ç”¨çš„å¯†é’¥æ˜¯ä¸æ˜¯ä¸€è‡´çš„ã€‚æ€ä¹ˆç¡®è®¤å‘¢ï¼Ÿé‚£å°±æŠŠä» <code>Client Hello</code> ä»¥æ¥æ¡æ‰‹è¿‡ç¨‹ä¸­åŒæ–¹é€šä¿¡çš„æ‰€æœ‰ä¿¡æ¯åŠ å¯†ä¹‹åï¼Œå†ç»™å¯¹æ–¹å‘é€ä¸€éã€‚è¦æ˜¯å¯¹æ–¹å‘è¿‡æ¥çš„ä¿¡æ¯è§£å¯†ä¹‹åä¸è‡ªå·±è®°å½•çš„ç›¸åŒï¼Œåˆ™è¡¨ç¤ºå¯†é’¥ç”Ÿæ•ˆäº†ï¼<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202411211420778.png" alt="image.png"></p><h3 id="åŠ å¯†å¥—ä»¶ä¸å¯†é’¥"><a href="#åŠ å¯†å¥—ä»¶ä¸å¯†é’¥" class="headerlink" title="åŠ å¯†å¥—ä»¶ä¸å¯†é’¥"></a>åŠ å¯†å¥—ä»¶ä¸å¯†é’¥</h3><p>ä¸Šä¸€èŠ‚ä»…ä»‹ç»äº†æ¡æ‰‹çš„æµç¨‹ï¼Œç°åœ¨æ¥ä»”ç»†çœ‹çœ‹å…¶ä¸­æ¶‰åŠåˆ°çš„åŠ å¯†å¥—ä»¶ï¼ˆ<a href="https://en.wikipedia.org/wiki/Cipher_suite">Cipher_suite</a>ï¼‰ä¸ <code>master secret</code>ã€‚</p><h3 id="åŠ å¯†å¥—ä»¶"><a href="#åŠ å¯†å¥—ä»¶" class="headerlink" title="åŠ å¯†å¥—ä»¶"></a>åŠ å¯†å¥—ä»¶</h3><p>åŠ å¯†å¥—ä»¶å®šä¹‰çš„æ˜¯åœ¨æ•´ä¸ªæ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸­ä½¿ç”¨åˆ°çš„åŠ å¯†æ–¹å¼ã€‚ä»¥ <code>TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256</code> ä¸ºä¾‹ï¼Œå…¶åŒ…å«ä»¥ä¸‹ç®—æ³•</p><ul><li><strong>å¯†é’¥äº¤æ¢ç®—æ³•</strong>ã€‚ç”¨æ¥äº¤æ¢å¯†é’¥ã€‚ä¾‹å¦‚ <code>ECDHE_RSA</code></li><li><strong>å¯¹ç§°åŠ å¯†ç®—æ³•</strong>ã€‚ç”¨æ¥åŠ å¯†ä¿¡æ¯ã€‚ä¾‹å¦‚ <code>AES_128_GCM</code></li><li><strong>ä¿¡æ¯æ‘˜è¦ç®—æ³•</strong>ã€‚ç”¨æ¥è®¡ç®—æ‘˜è¦ï¼Œé˜²æ­¢ç¯¡æ”¹ã€‚ä¾‹å¦‚ <code>SHA256</code></li><li><strong>ä¼ªéšæœºå‡½æ•°</strong>ã€‚ç”Ÿæˆ <code>master secret</code>ã€‚è¦ç”¨åˆ°ä¿¡æ¯æ‘˜è¦ç®—æ³•ã€‚</li></ul><h3 id="master-secret"><a href="#master-secret" class="headerlink" title="master secret"></a>master secret</h3><p>ä¸Šä¸€èŠ‚æåˆ°ï¼Œå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¼šæ ¹æ® <code>premaster secret</code> ä»¥åŠäºŒè€…åœ¨ <code>Hello</code> é˜¶æ®µå„è‡ªç”Ÿæˆçš„éšæœºæ•°ï¼Œäº§ç”Ÿç›¸åŒçš„ <code>master secret</code>ã€‚äºŒè€…ä½¿ç”¨çš„å‡½æ•°ä¸º</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202411211421527.png" alt="image.png"></p><p>è‡³äºç”Ÿæˆçš„ <code>master secret</code>ï¼Œå…¶æ ¼å¼ä¸º</p><blockquote><p>client write MAC key server write MAC key client write encryption key server write encryption key client write IV server write IV</p></blockquote><p>å‰ä¸¤ä¸ªæ˜¯è®¡ç®—æ‘˜è¦ç”¨çš„ KEYï¼Œä¸­é—´ä¸¤ä¸ªæ˜¯åŠ å¯†æ—¶ç”¨çš„ï¼Œæœ€åä¸¤ä¸ªé€‚ç”¨äºåŠ å¯†å¥—ä»¶ä½¿ç”¨ <code>AEAD</code> æ—¶ã€‚</p><h3 id="æ€»ç»“ä¸‹è¿æ¥è¿‡ç¨‹"><a href="#æ€»ç»“ä¸‹è¿æ¥è¿‡ç¨‹" class="headerlink" title="æ€»ç»“ä¸‹è¿æ¥è¿‡ç¨‹"></a>æ€»ç»“ä¸‹è¿æ¥è¿‡ç¨‹</h3><p><strong>â‘  è¯ä¹¦éªŒè¯é˜¶æ®µ</strong></p><ol><li>æµè§ˆå™¨å‘èµ· HTTPS è¯·æ±‚</li><li>æœåŠ¡ç«¯è¿”å› HTTPS è¯ä¹¦</li><li>å®¢æˆ·ç«¯éªŒè¯è¯ä¹¦æ˜¯å¦åˆæ³•ï¼Œå¦‚æœä¸åˆæ³•åˆ™æç¤ºå‘Šè­¦</li></ol><p><strong>â‘¡ æ•°æ®ä¼ è¾“é˜¶æ®µ</strong></p><ol><li>å½“è¯ä¹¦éªŒè¯åˆæ³•åï¼Œåœ¨æœ¬åœ°ç”Ÿæˆéšæœºæ•°</li><li>é€šè¿‡å…¬é’¥åŠ å¯†éšæœºæ•°ï¼Œå¹¶æŠŠåŠ å¯†åçš„éšæœºæ•°ä¼ è¾“åˆ°æœåŠ¡ç«¯</li><li>æœåŠ¡ç«¯é€šè¿‡ç§é’¥å¯¹éšæœºæ•°è¿›è¡Œè§£å¯†</li><li>æœåŠ¡ç«¯é€šè¿‡å®¢æˆ·ç«¯ä¼ å…¥çš„éšæœºæ•°æ„é€ å¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œå¯¹è¿”å›ç»“æœå†…å®¹è¿›è¡ŒåŠ å¯†åä¼ è¾“</li></ol><h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><h3 id="ä¸ºä»€ä¹ˆæ•°æ®ä¼ è¾“æ˜¯ç”¨å¯¹ç§°åŠ å¯†ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆæ•°æ®ä¼ è¾“æ˜¯ç”¨å¯¹ç§°åŠ å¯†ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆæ•°æ®ä¼ è¾“æ˜¯ç”¨å¯¹ç§°åŠ å¯†ï¼Ÿ"></a>ä¸ºä»€ä¹ˆæ•°æ®ä¼ è¾“æ˜¯ç”¨å¯¹ç§°åŠ å¯†ï¼Ÿ</h3><p>é¦–å…ˆï¼Œéå¯¹ç§°åŠ å¯†çš„åŠ è§£å¯†æ•ˆç‡æ˜¯éå¸¸ä½çš„ï¼Œè€Œ http çš„åº”ç”¨åœºæ™¯ä¸­é€šå¸¸ç«¯ä¸ç«¯ä¹‹é—´å­˜åœ¨å¤§é‡çš„äº¤äº’ï¼Œéå¯¹ç§°åŠ å¯†çš„æ•ˆç‡æ˜¯æ— æ³•æ¥å—çš„ï¼›</p><p>å¦å¤–ï¼Œåœ¨ HTTPS çš„åœºæ™¯ä¸­åªæœ‰æœåŠ¡ç«¯ä¿å­˜äº†ç§é’¥ï¼Œä¸€å¯¹å…¬ç§é’¥åªèƒ½å®ç°å•å‘çš„åŠ è§£å¯†ï¼Œæ‰€ä»¥ HTTPS ä¸­å†…å®¹ä¼ è¾“åŠ å¯†é‡‡å–çš„æ˜¯å¯¹ç§°åŠ å¯†ï¼Œè€Œä¸æ˜¯éå¯¹ç§°åŠ å¯†ã€‚</p><h3 id="ä¸ºä»€ä¹ˆéœ€è¦-CA-è®¤è¯æœºæ„é¢å‘è¯ä¹¦ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆéœ€è¦-CA-è®¤è¯æœºæ„é¢å‘è¯ä¹¦ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦ CA è®¤è¯æœºæ„é¢å‘è¯ä¹¦ï¼Ÿ"></a>ä¸ºä»€ä¹ˆéœ€è¦ CA è®¤è¯æœºæ„é¢å‘è¯ä¹¦ï¼Ÿ</h3><p>HTTP åè®®è¢«è®¤ä¸ºä¸å®‰å…¨æ˜¯å› ä¸ºä¼ è¾“è¿‡ç¨‹å®¹æ˜“è¢«ç›‘å¬è€…å‹¾çº¿ç›‘å¬ã€ä¼ªé€  <a href="https://cloud.tencent.com/product/cvm/?from_column=20065&from=20065">æœåŠ¡å™¨</a>ï¼Œè€Œ HTTPS åè®®ä¸»è¦è§£å†³çš„ä¾¿æ˜¯ç½‘ç»œä¼ è¾“çš„å®‰å…¨æ€§é—®é¢˜ã€‚</p><p>é¦–å…ˆæˆ‘ä»¬å‡è®¾ä¸å­˜åœ¨è®¤è¯æœºæ„ï¼Œä»»ä½•äººéƒ½å¯ä»¥åˆ¶ä½œè¯ä¹¦ï¼Œè¿™å¸¦æ¥çš„å®‰å…¨é£é™©ä¾¿æ˜¯ç»å…¸çš„Â <strong>â€œä¸­é—´äººæ”»å‡»â€</strong>Â é—®é¢˜ã€‚</p><p>â€œä¸­é—´äººæ”»å‡»â€çš„å…·ä½“è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202411211111399.webp" alt="f35348523dd744408647d2b97d2534c6.webp"></p><p>è¿‡ç¨‹åŸç†ï¼š</p><ol><li>æœ¬åœ°è¯·æ±‚è¢«åŠ«æŒï¼ˆå¦‚ DNS åŠ«æŒç­‰ï¼‰ï¼Œæ‰€æœ‰è¯·æ±‚å‡å‘é€åˆ°ä¸­é—´äººçš„æœåŠ¡å™¨</li><li>ä¸­é—´äººæœåŠ¡å™¨è¿”å›ä¸­é—´äººè‡ªå·±çš„è¯ä¹¦</li><li>å®¢æˆ·ç«¯åˆ›å»ºéšæœºæ•°ï¼Œé€šè¿‡ä¸­é—´äººè¯ä¹¦çš„å…¬é’¥å¯¹éšæœºæ•°åŠ å¯†åä¼ é€ç»™ä¸­é—´äººï¼Œç„¶åå‡­éšæœºæ•°æ„é€ å¯¹ç§°åŠ å¯†å¯¹ä¼ è¾“å†…å®¹è¿›è¡ŒåŠ å¯†ä¼ è¾“</li><li>ä¸­é—´äººå› ä¸ºæ‹¥æœ‰å®¢æˆ·ç«¯çš„éšæœºæ•°ï¼Œå¯ä»¥é€šè¿‡å¯¹ç§°åŠ å¯†ç®—æ³•è¿›è¡Œå†…å®¹è§£å¯†</li><li>ä¸­é—´äººä»¥å®¢æˆ·ç«¯çš„è¯·æ±‚å†…å®¹å†å‘æ­£è§„ç½‘ç«™å‘èµ·è¯·æ±‚</li><li>å› ä¸ºä¸­é—´äººä¸æœåŠ¡å™¨çš„é€šä¿¡è¿‡ç¨‹æ˜¯åˆæ³•çš„ï¼Œæ­£è§„ç½‘ç«™é€šè¿‡å»ºç«‹çš„å®‰å…¨é€šé“è¿”å›åŠ å¯†åçš„æ•°æ®</li><li>ä¸­é—´äººå‡­å€Ÿä¸æ­£è§„ç½‘ç«™å»ºç«‹çš„å¯¹ç§°åŠ å¯†ç®—æ³•å¯¹å†…å®¹è¿›è¡Œè§£å¯†</li><li>ä¸­é—´äººé€šè¿‡ä¸å®¢æˆ·ç«¯å»ºç«‹çš„å¯¹ç§°åŠ å¯†ç®—æ³•å¯¹æ­£è§„å†…å®¹è¿”å›çš„æ•°æ®è¿›è¡ŒåŠ å¯†ä¼ è¾“</li><li>å®¢æˆ·ç«¯é€šè¿‡ä¸ä¸­é—´äººå»ºç«‹çš„å¯¹ç§°åŠ å¯†ç®—æ³•å¯¹è¿”å›ç»“æœæ•°æ®è¿›è¡Œè§£å¯†</li></ol><p>ç”±äºç¼ºå°‘å¯¹è¯ä¹¦çš„éªŒè¯ï¼Œæ‰€ä»¥å®¢æˆ·ç«¯è™½ç„¶å‘èµ·çš„æ˜¯ HTTPS è¯·æ±‚ï¼Œä½†å®¢æˆ·ç«¯å®Œå…¨ä¸çŸ¥é“è‡ªå·±çš„ç½‘ç»œå·²è¢«æ‹¦æˆªï¼Œä¼ è¾“å†…å®¹è¢«ä¸­é—´äººå…¨éƒ¨çªƒå–ã€‚</p><h3 id="æµè§ˆå™¨æ˜¯å¦‚ä½•ç¡®ä¿-CA-è¯ä¹¦çš„åˆæ³•æ€§ï¼Ÿ"><a href="#æµè§ˆå™¨æ˜¯å¦‚ä½•ç¡®ä¿-CA-è¯ä¹¦çš„åˆæ³•æ€§ï¼Ÿ" class="headerlink" title="æµè§ˆå™¨æ˜¯å¦‚ä½•ç¡®ä¿ CA è¯ä¹¦çš„åˆæ³•æ€§ï¼Ÿ"></a>æµè§ˆå™¨æ˜¯å¦‚ä½•ç¡®ä¿ CA è¯ä¹¦çš„åˆæ³•æ€§ï¼Ÿ</h3><h4 id="1-è¯ä¹¦åŒ…å«ä»€ä¹ˆä¿¡æ¯ï¼Ÿ"><a href="#1-è¯ä¹¦åŒ…å«ä»€ä¹ˆä¿¡æ¯ï¼Ÿ" class="headerlink" title="1. è¯ä¹¦åŒ…å«ä»€ä¹ˆä¿¡æ¯ï¼Ÿ"></a>1. è¯ä¹¦åŒ…å«ä»€ä¹ˆä¿¡æ¯ï¼Ÿ</h4><ul><li>é¢å‘æœºæ„ä¿¡æ¯</li><li>å…¬é’¥</li><li>å…¬å¸ä¿¡æ¯</li><li>åŸŸå</li><li>æœ‰æ•ˆæœŸ</li><li>æŒ‡çº¹</li><li>â€¦â€¦</li></ul><h4 id="2-è¯ä¹¦çš„åˆæ³•æ€§ä¾æ®æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#2-è¯ä¹¦çš„åˆæ³•æ€§ä¾æ®æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="2. è¯ä¹¦çš„åˆæ³•æ€§ä¾æ®æ˜¯ä»€ä¹ˆï¼Ÿ"></a>2. è¯ä¹¦çš„åˆæ³•æ€§ä¾æ®æ˜¯ä»€ä¹ˆï¼Ÿ</h4><p>é¦–å…ˆï¼Œæƒå¨æœºæ„æ˜¯è¦æœ‰è®¤è¯çš„ï¼Œä¸æ˜¯éšä¾¿ä¸€ä¸ªæœºæ„éƒ½æœ‰èµ„æ ¼é¢å‘è¯ä¹¦ï¼Œä¸ç„¶ä¹Ÿä¸å«åšæƒå¨æœºæ„ã€‚å¦å¤–ï¼Œè¯ä¹¦çš„å¯ä¿¡æ€§åŸºäºä¿¡ä»»åˆ¶ï¼Œæƒå¨æœºæ„éœ€è¦å¯¹å…¶é¢å‘çš„è¯ä¹¦è¿›è¡Œä¿¡ç”¨èƒŒä¹¦ï¼Œåªè¦æ˜¯æƒå¨æœºæ„ç”Ÿæˆçš„è¯ä¹¦ï¼Œæˆ‘ä»¬å°±è®¤ä¸ºæ˜¯åˆæ³•çš„ã€‚æ‰€ä»¥æƒå¨æœºæ„ä¼šå¯¹ç”³è¯·è€…çš„ä¿¡æ¯è¿›è¡Œå®¡æ ¸ï¼Œä¸åŒç­‰çº§çš„æƒå¨æœºæ„å¯¹å®¡æ ¸çš„è¦æ±‚ä¹Ÿä¸ä¸€æ ·ï¼Œäºæ˜¯è¯ä¹¦ä¹Ÿåˆ†ä¸ºå…è´¹çš„ã€ä¾¿å®œçš„å’Œè´µçš„ã€‚</p><h4 id="3-æµè§ˆå™¨å¦‚ä½•éªŒè¯è¯ä¹¦çš„åˆæ³•æ€§ï¼Ÿ"><a href="#3-æµè§ˆå™¨å¦‚ä½•éªŒè¯è¯ä¹¦çš„åˆæ³•æ€§ï¼Ÿ" class="headerlink" title="3. æµè§ˆå™¨å¦‚ä½•éªŒè¯è¯ä¹¦çš„åˆæ³•æ€§ï¼Ÿ"></a>3. æµè§ˆå™¨å¦‚ä½•éªŒè¯è¯ä¹¦çš„åˆæ³•æ€§ï¼Ÿ</h4><p>æµè§ˆå™¨å‘èµ· HTTPS è¯·æ±‚æ—¶ï¼ŒæœåŠ¡å™¨ä¼šè¿”å›ç½‘ç«™çš„ SSL è¯ä¹¦ï¼Œæµè§ˆå™¨éœ€è¦å¯¹è¯ä¹¦åšä»¥ä¸‹éªŒè¯ï¼š</p><ol><li>éªŒè¯åŸŸåã€æœ‰æ•ˆæœŸç­‰ä¿¡æ¯æ˜¯å¦æ­£ç¡®ã€‚è¯ä¹¦ä¸Šéƒ½æœ‰åŒ…å«è¿™äº›ä¿¡æ¯ï¼Œæ¯”è¾ƒå®¹æ˜“å®ŒæˆéªŒè¯ï¼›</li><li>åˆ¤æ–­è¯ä¹¦æ¥æºæ˜¯å¦åˆæ³•ã€‚æ¯ä»½ç­¾å‘è¯ä¹¦éƒ½å¯ä»¥æ ¹æ®éªŒè¯é“¾æŸ¥æ‰¾åˆ°å¯¹åº”çš„æ ¹è¯ä¹¦ï¼Œæ“ä½œç³»ç»Ÿã€æµè§ˆå™¨ä¼šåœ¨æœ¬åœ°å­˜å‚¨æƒå¨æœºæ„çš„æ ¹è¯ä¹¦ï¼Œåˆ©ç”¨æœ¬åœ°æ ¹è¯ä¹¦å¯ä»¥å¯¹å¯¹åº”æœºæ„ç­¾å‘è¯ä¹¦å®Œæˆæ¥æºéªŒè¯ï¼›</li></ol><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202411211112715.webp" alt="e7d864735b9d4ff9a42e761bd44ce513.webp"></p><ol><li>åˆ¤æ–­è¯ä¹¦æ˜¯å¦è¢«ç¯¡æ”¹ã€‚éœ€è¦ä¸ CA æœåŠ¡å™¨è¿›è¡Œæ ¡éªŒï¼›</li><li>åˆ¤æ–­è¯ä¹¦æ˜¯å¦å·²åŠé”€ã€‚é€šè¿‡ CRLï¼ˆCertificate Revocation List è¯ä¹¦æ³¨é”€åˆ—è¡¨ï¼‰å’Œ OCSPï¼ˆOnline Certificate Status Protocol åœ¨çº¿è¯ä¹¦çŠ¶æ€åè®®ï¼‰å®ç°ï¼Œå…¶ä¸­ OCSP å¯ç”¨äºç¬¬ 3 æ­¥ä¸­ä»¥å‡å°‘ä¸ CA æœåŠ¡å™¨çš„äº¤äº’ï¼Œæé«˜éªŒè¯æ•ˆç‡</li></ol><p>ä»¥ä¸Šä»»æ„ä¸€æ­¥éƒ½æ»¡è¶³çš„æƒ…å†µä¸‹æµè§ˆå™¨æ‰è®¤ä¸ºè¯ä¹¦æ˜¯åˆæ³•çš„ã€‚</p><blockquote><p>è¿™é‡Œæ’ä¸€ä¸ªæˆ‘æƒ³äº†å¾ˆä¹…çš„ä½†å…¶å®ç­”æ¡ˆå¾ˆç®€å•çš„é—®é¢˜ï¼šÂ  æ—¢ç„¶è¯ä¹¦æ˜¯å…¬å¼€çš„ï¼Œå¦‚æœè¦å‘èµ·ä¸­é—´äººæ”»å‡»ï¼Œæˆ‘åœ¨å®˜ç½‘ä¸Šä¸‹è½½ä¸€ä»½è¯ä¹¦ä½œä¸ºæˆ‘çš„æœåŠ¡å™¨è¯ä¹¦ï¼Œé‚£å®¢æˆ·ç«¯è‚¯å®šä¼šè®¤åŒè¿™ä¸ªè¯ä¹¦æ˜¯åˆæ³•çš„ï¼Œå¦‚ä½•é¿å…è¿™ç§è¯ä¹¦å†’ç”¨çš„æƒ…å†µï¼Ÿ å…¶å®è¿™å°±æ˜¯éåŠ å¯†å¯¹ç§°ä¸­å…¬ç§é’¥çš„ç”¨å¤„ï¼Œè™½ç„¶ä¸­é—´äººå¯ä»¥å¾—åˆ°è¯ä¹¦ï¼Œä½†ç§é’¥æ˜¯æ— æ³•è·å–çš„ï¼Œä¸€ä»½å…¬é’¥æ˜¯ä¸å¯èƒ½æ¨ç®—å‡ºå…¶å¯¹åº”çš„ç§é’¥ï¼Œä¸­é—´äººå³ä½¿æ‹¿åˆ°è¯ä¹¦ä¹Ÿæ— æ³•ä¼ªè£…æˆåˆæ³•æœåŠ¡ç«¯ï¼Œå› ä¸ºæ— æ³•å¯¹å®¢æˆ·ç«¯ä¼ å…¥çš„åŠ å¯†æ•°æ®è¿›è¡Œè§£å¯†ã€‚</p></blockquote><h4 id="4-åªæœ‰è®¤è¯æœºæ„å¯ä»¥ç”Ÿæˆè¯ä¹¦å—ï¼Ÿ"><a href="#4-åªæœ‰è®¤è¯æœºæ„å¯ä»¥ç”Ÿæˆè¯ä¹¦å—ï¼Ÿ" class="headerlink" title="4. åªæœ‰è®¤è¯æœºæ„å¯ä»¥ç”Ÿæˆè¯ä¹¦å—ï¼Ÿ"></a>4. åªæœ‰è®¤è¯æœºæ„å¯ä»¥ç”Ÿæˆè¯ä¹¦å—ï¼Ÿ</h4><p>å¦‚æœéœ€è¦æµè§ˆå™¨ä¸æç¤ºå®‰å…¨é£é™©ï¼Œé‚£åªèƒ½ä½¿ç”¨è®¤è¯æœºæ„ç­¾å‘çš„è¯ä¹¦ã€‚ä½†æµè§ˆå™¨é€šå¸¸åªæ˜¯æç¤ºå®‰å…¨é£é™©ï¼Œå¹¶ä¸é™åˆ¶ç½‘ç«™ä¸èƒ½è®¿é—®ï¼Œæ‰€ä»¥ä»æŠ€æœ¯ä¸Šè°éƒ½å¯ä»¥ç”Ÿæˆè¯ä¹¦ï¼Œåªè¦æœ‰è¯ä¹¦å°±å¯ä»¥å®Œæˆç½‘ç«™çš„ HTTPS ä¼ è¾“ã€‚ä¾‹å¦‚æ—©æœŸçš„ 12306 é‡‡ç”¨çš„ä¾¿æ˜¯æ‰‹åŠ¨å®‰è£…ç§æœ‰è¯ä¹¦çš„å½¢å¼å®ç° HTTPS è®¿é—®ã€‚</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202411211112378.png" alt="1e9f4c5925fc4929804b8a1bc94cdd87.png"></p><p><strong>å¦‚ä½•ä¿è¯éšæœºæ•°ä¸ä¼šè¢«çªƒå–ï¼Ÿ</strong></p><p>å…¶å® HTTPS å¹¶ä¸åŒ…å«å¯¹éšæœºæ•°çš„å®‰å…¨ä¿è¯ï¼ŒHTTPS ä¿è¯çš„åªæ˜¯ä¼ è¾“è¿‡ç¨‹å®‰å…¨ï¼Œè€Œéšæœºæ•°å­˜å‚¨äºæœ¬åœ°ï¼Œæœ¬åœ°çš„å®‰å…¨å±äºå¦ä¸€å®‰å…¨èŒƒç•´ï¼Œåº”å¯¹çš„æªæ–½æœ‰å®‰è£…æ€æ¯’è½¯ä»¶ã€åæœ¨é©¬ã€æµè§ˆå™¨å‡çº§ä¿®å¤æ¼æ´ç­‰ã€‚</p><h3 id="ç”¨äº†-HTTPS-ä¼šè¢«æŠ“åŒ…å—ï¼Ÿ"><a href="#ç”¨äº†-HTTPS-ä¼šè¢«æŠ“åŒ…å—ï¼Ÿ" class="headerlink" title="ç”¨äº† HTTPS ä¼šè¢«æŠ“åŒ…å—ï¼Ÿ"></a>ç”¨äº† HTTPS ä¼šè¢«æŠ“åŒ…å—ï¼Ÿ</h3><p>HTTPS çš„æ•°æ®æ˜¯åŠ å¯†çš„ï¼Œå¸¸è§„ä¸‹æŠ“åŒ…å·¥å…·ä»£ç†è¯·æ±‚åæŠ“åˆ°çš„åŒ…å†…å®¹æ˜¯åŠ å¯†çŠ¶æ€ï¼Œæ— æ³•ç›´æ¥æŸ¥çœ‹ã€‚</p><p>ä½†æ˜¯ï¼Œæ­£å¦‚å‰æ–‡æ‰€è¯´ï¼Œæµè§ˆå™¨åªä¼šæç¤ºå®‰å…¨é£é™©ï¼Œå¦‚æœç”¨æˆ·æˆæƒä»ç„¶å¯ä»¥ç»§ç»­è®¿é—®ç½‘ç«™ï¼Œå®Œæˆè¯·æ±‚ã€‚å› æ­¤ï¼Œåªè¦å®¢æˆ·ç«¯æ˜¯æˆ‘ä»¬è‡ªå·±çš„ç»ˆç«¯ï¼Œæˆ‘ä»¬æˆæƒçš„æƒ…å†µä¸‹ï¼Œä¾¿å¯ä»¥ç»„å»ºä¸­é—´äººç½‘ç»œï¼Œè€ŒæŠ“åŒ…å·¥å…·ä¾¿æ˜¯ä½œä¸ºä¸­é—´äººçš„ä»£ç†ã€‚é€šå¸¸ HTTPS æŠ“åŒ…å·¥å…·çš„ä½¿ç”¨æ–¹æ³•æ˜¯ä¼šç”Ÿæˆä¸€ä¸ªè¯ä¹¦ï¼Œç”¨æˆ·éœ€è¦æ‰‹åŠ¨æŠŠè¯ä¹¦å®‰è£…åˆ°å®¢æˆ·ç«¯ä¸­ï¼Œç„¶åç»ˆç«¯å‘èµ·çš„æ‰€æœ‰è¯·æ±‚é€šè¿‡è¯¥è¯ä¹¦å®Œæˆä¸æŠ“åŒ…å·¥å…·çš„äº¤äº’ï¼Œç„¶åæŠ“åŒ…å·¥å…·å†è½¬å‘è¯·æ±‚åˆ°æœåŠ¡å™¨ï¼Œæœ€åæŠŠæœåŠ¡å™¨è¿”å›çš„ç»“æœåœ¨æ§åˆ¶å°è¾“å‡ºåå†è¿”å›ç»™ç»ˆç«¯ï¼Œä»è€Œå®Œæˆæ•´ä¸ªè¯·æ±‚çš„é—­ç¯ã€‚</p><p><strong>æ—¢ç„¶ HTTPS ä¸èƒ½é˜²æŠ“åŒ…ï¼Œé‚£ HTTPS æœ‰ä»€ä¹ˆæ„ä¹‰ï¼Ÿ</strong>Â  HTTPS å¯ä»¥é˜²æ­¢ç”¨æˆ·åœ¨ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹é€šä¿¡é“¾è·¯è¢«ç›‘å¬ï¼Œå¯¹äºä¸»åŠ¨æˆä¿¡çš„æŠ“åŒ…æ“ä½œæ˜¯ä¸æä¾›é˜²æŠ¤çš„ï¼Œå› ä¸ºè¿™ä¸ªåœºæ™¯ç”¨æˆ·æ˜¯å·²ç»å¯¹é£é™©çŸ¥æƒ…ã€‚è¦é˜²æ­¢è¢«æŠ“åŒ…ï¼Œéœ€è¦é‡‡ç”¨åº”ç”¨çº§çš„å®‰å…¨é˜²æŠ¤ï¼Œä¾‹å¦‚é‡‡ç”¨ç§æœ‰çš„å¯¹ç§°åŠ å¯†ï¼ŒåŒæ—¶åšå¥½ç§»åŠ¨ç«¯çš„é˜²åç¼–è¯‘åŠ å›ºï¼Œé˜²æ­¢æœ¬åœ°ç®—æ³•è¢«ç ´è§£ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ä»¥ä¸‹ç”¨ç®€çŸ­çš„ Q&amp;A å½¢å¼è¿›è¡Œå…¨æ–‡æ€»ç»“ï¼š</p><p>Q: HTTPS ä¸ºä»€ä¹ˆå®‰å…¨ï¼ŸÂ </p><p>A: å› ä¸º HTTPS ä¿è¯äº†ä¼ è¾“å®‰å…¨ï¼Œé˜²æ­¢ä¼ è¾“è¿‡ç¨‹è¢«ç›‘å¬ã€é˜²æ­¢æ•°æ®è¢«çªƒå–ï¼Œå¯ä»¥ç¡®è®¤ç½‘ç«™çš„çœŸå®æ€§ã€‚</p><p>Q: HTTPS çš„ä¼ è¾“è¿‡ç¨‹æ˜¯æ€æ ·çš„ï¼ŸÂ </p><p>A: å®¢æˆ·ç«¯å‘èµ· HTTPS è¯·æ±‚ï¼ŒæœåŠ¡ç«¯è¿”å›è¯ä¹¦ï¼Œå®¢æˆ·ç«¯å¯¹è¯ä¹¦è¿›è¡ŒéªŒè¯ï¼ŒéªŒè¯é€šè¿‡åæœ¬åœ°ç”Ÿæˆç”¨äºæ”¹é€ å¯¹ç§°åŠ å¯†ç®—æ³•çš„éšæœºæ•°ï¼Œé€šè¿‡è¯ä¹¦ä¸­çš„å…¬é’¥å¯¹éšæœºæ•°è¿›è¡ŒåŠ å¯†ä¼ è¾“åˆ°æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯æ¥æ”¶åé€šè¿‡ç§é’¥è§£å¯†å¾—åˆ°éšæœºæ•°ï¼Œä¹‹åçš„æ•°æ®äº¤äº’é€šè¿‡å¯¹ç§°åŠ å¯†ç®—æ³•è¿›è¡ŒåŠ è§£å¯†ã€‚</p><p>Q: ä¸ºä»€ä¹ˆéœ€è¦è¯ä¹¦ï¼ŸÂ </p><p>A: é˜²æ­¢â€ä¸­é—´äººâ€œæ”»å‡»ï¼ŒåŒæ—¶å¯ä»¥ä¸ºç½‘ç«™æä¾›èº«ä»½è¯æ˜ã€‚</p><p>Q: ä½¿ç”¨ HTTPS ä¼šè¢«æŠ“åŒ…å—ï¼ŸÂ </p><p>A: ä¼šè¢«æŠ“åŒ…ï¼ŒHTTPS åªé˜²æ­¢ç”¨æˆ·åœ¨ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹é€šä¿¡è¢«ç›‘å¬ï¼Œå¦‚æœç”¨æˆ·ä¸»åŠ¨æˆä¿¡ï¼Œæ˜¯å¯ä»¥æ„å»ºâ€œä¸­é—´äººâ€ç½‘ç»œï¼Œä»£ç†è½¯ä»¶å¯ä»¥å¯¹ä¼ è¾“å†…å®¹è¿›è¡Œè§£å¯†ã€‚</p><h2 id="æ¥æº"><a href="#æ¥æº" class="headerlink" title="æ¥æº"></a>æ¥æº</h2><ul><li><a href="https://tools.ietf.org/html/rfc2818">HTTP Over TLS. RFC2818</a></li><li><a href="https://msdn.microsoft.com/en-us/library/windows/desktop/aa380513%28v=vs.85%29.aspx">TLS Handshake Protocol</a></li><li><a href="http://www.moserware.com/2009/06/first-few-milliseconds-of-https.html">The First Few Milliseconds of an HTTPS Connection</a></li><li><a href="https://segmentfault.com/a/1190000002554673">SSL&#x2F;TLSåŸç†è¯¦è§£</a></li><li><a href="https://www.wosign.com/faq/faq2016-0309-04.htm">TLS&#x2F;SSLæ¡æ‰‹è¿‡ç¨‹</a></li><li><a href="http://blog.csdn.net/dog250/article/details/5717162">sslåè®®ä¸­çš„dhç®—æ³•çš„pre-master-secret</a></li><li><a href="https://en.wikipedia.org/wiki/Cipher_suite">Cipher_suite</a></li><li><a href="https://yieldnull.com/blog/001efdfe76e6f4f672faf785dff1cc54e4fd26ba/">ç”¨æ•°å­—è¯ä¹¦è¯æ˜ä½ æ˜¯ä½ </a></li></ul>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åŠ å¯† </tag>
            
            <tag> tls </tag>
            
            <tag> https </tag>
            
            <tag> SSL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç”Ÿäº§ç¯å¢ƒPrometheusç›‘æ§æ¶æ„è®°å½•</title>
      <link href="/posts/sn6pu2/"/>
      <url>/posts/sn6pu2/</url>
      
        <content type="html"><![CDATA[<p>æ¯”å¦‚æœ‰ 30 å®¶å®¢æˆ·ï¼Œæ¯ä¸€ä¸ªå®¢æˆ·éƒ½æœ‰è‡ªå·±çš„ Kubernetes é›†ç¾¤ï¼Œéƒ¨ç½²æ–¹å¼åƒå·®ä¸‡åˆ«ï¼Œè¿˜æœ‰å®¢æˆ·ä¸ä½¿ç”¨ Kubernetes çš„ï¼Œä½¿ç”¨è™šæ‹Ÿæœºéƒ¨ç½²ï¼Œé‚£ä¹ˆæ€ä¹ˆå¯¹è¿™ä¹ˆå¤šå®¢æˆ·çš„æœºå™¨ã€æœåŠ¡è¿›è¡Œæœ‰æ•ˆçš„ç›‘æ§ï¼Œæœ¬æ–‡è®°å½•ä¸€ä¸‹ç›‘æ§çš„æ¶æ„æ–¹æ¡ˆã€‚</p><h2 id="ç›‘æ§æ¶æ„å›¾"><a href="#ç›‘æ§æ¶æ„å›¾" class="headerlink" title="ç›‘æ§æ¶æ„å›¾"></a>ç›‘æ§æ¶æ„å›¾</h2><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202411201501698.png"></p><p>è¯´æ˜ï¼š<br>Prometheus Core æ˜¯ä¸€ä¸ªæ ¸å¿ƒçš„ Prometheusï¼Œæ‰€æœ‰å…¶ä»– Prometheus çš„æ•°æ®éƒ½æ±‡æ€»åˆ°è¿™é‡Œï¼ŒæŸ¥è¯¢ã€å‘Šè­¦ç­‰éƒ½ä½¿ç”¨è¿™ä¸ª Prometheus</p><h2 id="Prometheus-Core"><a href="#Prometheus-Core" class="headerlink" title="Prometheus Core"></a>Prometheus Core</h2><p>è¿™ä¸ªæ˜¯æ ¸å¿ƒçš„ Prometheusï¼Œå…¶ä»–å®¢æˆ·çš„ Prometheus é€šè¿‡è”é‚¦æ¥å…¥æˆ–è€… è¿œç¨‹å†™ (remote write) çš„æ–¹å¼æ¥å†™å…¥æ•°æ®åˆ°è¿™ä¸ª Prometheus ä¸­ã€‚Prometheus Core å¯ä»¥æ›´æ¢æˆ <a href="/posts/e59d8e32">VictoriaMetrics</a></p><h3 id="è”é‚¦æ¥å…¥é…ç½®"><a href="#è”é‚¦æ¥å…¥é…ç½®" class="headerlink" title="è”é‚¦æ¥å…¥é…ç½®"></a>è”é‚¦æ¥å…¥é…ç½®</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># http æ¥å£è”é‚¦</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;federate-http&#x27;</span></span><br><span class="line">  <span class="attr">scrape_interval:</span> <span class="string">30s</span></span><br><span class="line">  <span class="attr">scrape_timeout:</span> <span class="string">30s</span></span><br><span class="line">  <span class="attr">honor_labels:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">metrics_path:</span> <span class="string">&#x27;/federate&#x27;</span></span><br><span class="line">  <span class="attr">basic_auth:</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">&#x27;admin&#x27;</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">&#x27;password&#x27;</span></span><br><span class="line">  <span class="attr">params:</span></span><br><span class="line">    <span class="string">&#x27;match[]&#x27;</span><span class="string">:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;&#123;job=~&quot;.+&quot;&#125;&#x27;</span></span><br><span class="line">  <span class="attr">file_sd_configs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">files:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">/data/prometheus/conf.d/federate_http.yml</span></span><br><span class="line">      <span class="attr">refresh_interval:</span> <span class="string">30s</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># https æ¥å£è”é‚¦</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;federate-https&#x27;</span></span><br><span class="line">  <span class="attr">scrape_interval:</span> <span class="string">30s</span></span><br><span class="line">  <span class="attr">scrape_timeout:</span> <span class="string">30s</span></span><br><span class="line">  <span class="attr">honor_labels:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">metrics_path:</span> <span class="string">&#x27;/federate&#x27;</span></span><br><span class="line">  <span class="attr">basic_auth:</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">&#x27;admin&#x27;</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">&#x27;password&#x27;</span></span><br><span class="line">  <span class="attr">scheme:</span> <span class="string">https</span></span><br><span class="line">  <span class="attr">params:</span></span><br><span class="line">    <span class="string">&#x27;match[]&#x27;</span><span class="string">:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;&#123;job=~&quot;.+&quot;&#125;&#x27;</span></span><br><span class="line">  <span class="attr">file_sd_configs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">files:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">/data/prometheus/conf.d/federate_https.yml</span></span><br><span class="line">      <span class="attr">refresh_interval:</span> <span class="string">1m</span></span><br><span class="line">  <span class="attr">tls_config:</span></span><br><span class="line">    <span class="attr">insecure_skip_verify:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><p>å¯¹åº”çš„ <code>federate_http.yml</code></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">targets:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">10.252</span><span class="number">.0</span><span class="number">.250</span><span class="string">:9090</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">env:</span> <span class="string">&quot;test&quot;</span></span><br><span class="line">    <span class="attr">k8s:</span> <span class="string">k8s-test</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">&quot;prometheus&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">targets:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">10.249</span><span class="number">.48</span><span class="number">.250</span><span class="string">:9090</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">env:</span> <span class="string">&quot;prod&quot;</span></span><br><span class="line">    <span class="attr">k8s:</span> <span class="string">k8s-prod</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">&quot;prometheus&quot;</span></span><br></pre></td></tr></table></figure><h3 id="è¿œç¨‹å†™å…¥é…ç½®"><a href="#è¿œç¨‹å†™å…¥é…ç½®" class="headerlink" title="è¿œç¨‹å†™å…¥é…ç½®"></a>è¿œç¨‹å†™å…¥é…ç½®</h3><p>ä¿®æ”¹ Prometheus å¯åŠ¨å‚æ•°ï¼Œå¢åŠ ï¼š<code>--enable-feature=remote-write-receiver</code> å¯åŠ¨å‚æ•°ã€‚</p><h2 id="Kubernetes-ä¸­éƒ¨ç½²æœ‰é›†ç¾¤æƒé™çš„-Prometheus"><a href="#Kubernetes-ä¸­éƒ¨ç½²æœ‰é›†ç¾¤æƒé™çš„-Prometheus" class="headerlink" title="Kubernetes ä¸­éƒ¨ç½²æœ‰é›†ç¾¤æƒé™çš„ Prometheus"></a>Kubernetes ä¸­éƒ¨ç½²æœ‰é›†ç¾¤æƒé™çš„ Prometheus</h2><p>é€‚åˆæœ‰é›†ç¾¤æƒé™çš„ Prometheus,å¯ä»¥åˆ›å»º serviceaccount å’Œ clusterrole clusterrolebinding èµ„æºæ‰å¯ä»¥è‡ªåŠ¨å‘ç°</p><p>å‚è€ƒ Prometheus å®˜æ–¹ GitHub ä¸Šçš„é…ç½®æ–‡ä»¶ <a href="https://github.com/prometheus/prometheus/blob/main/documentation/examples/rbac-setup.yml">https://github.com/prometheus/prometheus/blob/main/documentation/examples/rbac-setup.yml</a></p><p>å®Œæ•´çš„é…ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">prometheus</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">nodes</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">nodes/proxy</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">services</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">endpoints</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">pods</span></span><br><span class="line">  <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;list&quot;</span>, <span class="string">&quot;watch&quot;</span>]</span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">extensions</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">networking.k8s.io</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">ingresses</span></span><br><span class="line">  <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;list&quot;</span>, <span class="string">&quot;watch&quot;</span>]</span><br><span class="line"><span class="bullet">-</span> <span class="attr">nonResourceURLs:</span> [<span class="string">&quot;/metrics&quot;</span>]</span><br><span class="line">  <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">prometheus</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">monitor</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">prometheus</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">prometheus</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">prometheus</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">monitor</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">prometheus-deployment</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">prometheus</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">monitor</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">prometheus</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">prometheus</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">serviceAccountName:</span> <span class="string">prometheus</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">image:</span> <span class="string">prom/prometheus:v2.34.0</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">prometheus</span></span><br><span class="line">        <span class="attr">command:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&quot;/bin/prometheus&quot;</span></span><br><span class="line">        <span class="attr">args:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&quot;--config.file=/etc/prometheus/prometheus.yml&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&quot;--storage.tsdb.path=/prometheus&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&quot;--storage.tsdb.retention=24h&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&quot;--web.enable-lifecycle&quot;</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">9090</span></span><br><span class="line">          <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">data</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">&quot;/prometheus&quot;</span></span><br><span class="line">        <span class="comment"># è¿™ç§æ–¹å¼æŒ‚è½½ï¼Œä¼šå°†åŸå§‹ç›®å½•æ•´ä¸ªæŒ‚è½½ï¼Œä¹Ÿå°±æ˜¯çœ‹ä¸åˆ°åŸå§‹çš„æ–‡ä»¶äº†ã€‚</span></span><br><span class="line">        <span class="comment"># - name: prometheus-config</span></span><br><span class="line">        <span class="comment">#   mountPath: /etc/prometheus</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">prometheus-config</span>                <span class="comment"># volumesçš„åå­—</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/etc/prometheus/prometheus.yml</span>     <span class="comment"># å®¹å™¨å†…çš„ç›®å½•</span></span><br><span class="line">          <span class="attr">subPath:</span> <span class="string">prometheus.yml</span>                       <span class="comment"># æŒ‡å®šconfigmapé‡Œé¢çš„key</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">prometheus-config</span>                <span class="comment"># volumesçš„åå­—</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/etc/prometheus/web.yml</span>     <span class="comment"># å®¹å™¨å†…çš„ç›®å½•</span></span><br><span class="line">          <span class="attr">subPath:</span> <span class="string">web.yml</span>                       <span class="comment"># æŒ‡å®šconfigmapé‡Œé¢çš„key</span></span><br><span class="line">        <span class="attr">resources:</span></span><br><span class="line">          <span class="attr">requests:</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">&quot;1&quot;</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">&quot;2Gi&quot;</span></span><br><span class="line">          <span class="attr">limits:</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">&quot;1&quot;</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">&quot;2Gi&quot;</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">data</span></span><br><span class="line">        <span class="attr">emptyDir:</span> &#123;&#125;</span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">prometheus-config</span></span><br><span class="line">        <span class="attr">configMap:</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">prometheus-config</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">prometheus</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">prometheus</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">monitor</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="comment"># type: NodePort</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">9090</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">9090</span></span><br><span class="line">    <span class="comment"># nodePort: 30090</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">prometheus</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">prometheus</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">monitor</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">kubernetes.io/ingress.class:</span> <span class="string">&quot;nginx&quot;</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/ssl-redirect:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">tls:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">hosts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">prometheus.i.com</span></span><br><span class="line">    <span class="attr">secretName:</span> <span class="string">i-com</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">prometheus.i.com</span></span><br><span class="line">    <span class="attr">http:</span></span><br><span class="line">      <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/</span></span><br><span class="line">        <span class="attr">pathType:</span> <span class="string">Prefix</span></span><br><span class="line">        <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">service:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">prometheus</span></span><br><span class="line">            <span class="attr">port:</span></span><br><span class="line">              <span class="attr">number:</span> <span class="number">9090</span></span><br></pre></td></tr></table></figure><p><code>configmap.yml</code></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">prometheus-config</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">monitor</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">web.yml:</span> <span class="string">|</span></span><br><span class="line"><span class="string">    basic_auth_users:</span></span><br><span class="line"><span class="string">      admin: $2y$05$UKSS18ztdsUNoEuXYScr2OE1TCMe1hWnmD6JuwUi/uPTJayHIakae</span></span><br><span class="line"><span class="string"></span>  <span class="attr">prometheus.yml:</span> <span class="string">|</span></span><br><span class="line"><span class="string">    global:</span></span><br><span class="line"><span class="string">      scrape_interval:     15s</span></span><br><span class="line"><span class="string">      evaluation_interval: 15s</span></span><br><span class="line"><span class="string">      </span></span><br><span class="line"><span class="string">      # å…¨å±€æ ‡ç­¾</span></span><br><span class="line"><span class="string">      external_labels:</span></span><br><span class="line"><span class="string">        env: prod</span></span><br><span class="line"><span class="string">        dept: ops</span></span><br><span class="line"><span class="string">        project: example</span></span><br><span class="line"><span class="string">        k8s: example</span></span><br><span class="line"><span class="string"></span></span><br><span class="line">    <span class="attr">scrape_configs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;apiservers&#x27;</span></span><br><span class="line">        <span class="attr">kubernetes_sd_configs:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">endpoints</span></span><br><span class="line">        <span class="attr">scheme:</span> <span class="string">https</span></span><br><span class="line">        <span class="attr">tls_config:</span></span><br><span class="line">          <span class="attr">ca_file:</span> <span class="string">/var/run/secrets/kubernetes.io/serviceaccount/ca.crt</span></span><br><span class="line">        <span class="attr">bearer_token_file:</span> <span class="string">/var/run/secrets/kubernetes.io/serviceaccount/token</span></span><br><span class="line">        <span class="attr">relabel_configs:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__meta_kubernetes_namespace</span>, <span class="string">__meta_kubernetes_service_name</span>, <span class="string">__meta_kubernetes_endpoint_port_name</span>]</span><br><span class="line">          <span class="attr">action:</span> <span class="string">keep</span></span><br><span class="line">          <span class="attr">regex:</span> <span class="string">default;kubernetes;https</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;cadvisor&#x27;</span></span><br><span class="line">        <span class="attr">kubernetes_sd_configs:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">node</span></span><br><span class="line">        <span class="attr">scheme:</span> <span class="string">https</span></span><br><span class="line">        <span class="attr">tls_config:</span></span><br><span class="line">          <span class="attr">ca_file:</span> <span class="string">/var/run/secrets/kubernetes.io/serviceaccount/ca.crt</span></span><br><span class="line">          <span class="attr">insecure_skip_verify:</span> <span class="literal">false</span></span><br><span class="line">        <span class="attr">bearer_token_file:</span> <span class="string">/var/run/secrets/kubernetes.io/serviceaccount/token</span></span><br><span class="line">        <span class="attr">relabel_configs:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">action:</span> <span class="string">labelmap</span></span><br><span class="line">          <span class="attr">regex:</span> <span class="string">__meta_kubernetes_node_label_(.+)</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">target_label:</span> <span class="string">__address__</span></span><br><span class="line">          <span class="attr">replacement:</span> <span class="string">kubernetes.default.svc:443</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__meta_kubernetes_node_name</span>]</span><br><span class="line">          <span class="attr">regex:</span> <span class="string">(.+)</span></span><br><span class="line">          <span class="attr">target_label:</span> <span class="string">__metrics_path__</span></span><br><span class="line">          <span class="attr">replacement:</span> <span class="string">/api/v1/nodes/$&#123;1&#125;/proxy/metrics/cadvisor</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&quot;kubelet&quot;</span></span><br><span class="line">        <span class="attr">honor_timestamps:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">scrape_interval:</span> <span class="string">1m</span></span><br><span class="line">        <span class="attr">scrape_timeout:</span> <span class="string">1m</span></span><br><span class="line">        <span class="attr">metrics_path:</span> <span class="string">/metrics</span></span><br><span class="line">        <span class="attr">scheme:</span> <span class="string">https</span></span><br><span class="line">        <span class="attr">kubernetes_sd_configs:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">node</span></span><br><span class="line">        <span class="attr">bearer_token_file:</span> <span class="string">/var/run/secrets/kubernetes.io/serviceaccount/token</span></span><br><span class="line">        <span class="attr">tls_config:</span></span><br><span class="line">          <span class="attr">ca_file:</span> <span class="string">/var/run/secrets/kubernetes.io/serviceaccount/ca.crt</span></span><br><span class="line">          <span class="attr">insecure_skip_verify:</span> <span class="literal">false</span></span><br><span class="line">        <span class="attr">relabel_configs:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">separator:</span> <span class="string">;</span></span><br><span class="line">          <span class="attr">regex:</span> <span class="string">__meta_kubernetes_node_label_(.+)</span></span><br><span class="line">          <span class="attr">replacement:</span> <span class="string">$1</span></span><br><span class="line">          <span class="attr">action:</span> <span class="string">labelmap</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">separator:</span> <span class="string">;</span></span><br><span class="line">          <span class="attr">regex:</span> <span class="string">(.*)</span></span><br><span class="line">          <span class="attr">target_label:</span> <span class="string">__address__</span></span><br><span class="line">          <span class="attr">replacement:</span> <span class="string">kubernetes.default.svc:443</span></span><br><span class="line">          <span class="attr">action:</span> <span class="string">replace</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__meta_kubernetes_node_name</span>]</span><br><span class="line">          <span class="attr">separator:</span> <span class="string">;</span></span><br><span class="line">          <span class="attr">regex:</span> <span class="string">(.+)</span></span><br><span class="line">          <span class="attr">target_label:</span> <span class="string">__metrics_path__</span></span><br><span class="line">          <span class="attr">replacement:</span> <span class="string">/api/v1/nodes/$&#123;1&#125;/proxy/metrics</span></span><br><span class="line">          <span class="attr">action:</span> <span class="string">replace</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;service_endpoints_metrics&#x27;</span></span><br><span class="line">        <span class="comment"># service éœ€è¦æ·»åŠ å…ƒæ•°æ® é€šå¸¸éœ€è¦æœ‰ /metrics æ¥å£è¿”å› prometheus æ•°æ®æ ¼å¼</span></span><br><span class="line">        <span class="comment"># prometheus.io/path: /metrics</span></span><br><span class="line">        <span class="comment"># prometheus.io/port: &quot;8080&quot;</span></span><br><span class="line">        <span class="comment"># prometheus.io/scrape: &quot;true&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="attr">kubernetes_sd_configs:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">endpoints</span></span><br><span class="line">        <span class="attr">relabel_configs:</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># å¸¦æ³¨è§£  prometheus.io/scrape: true  çš„æ‰ä¼šè¢«é‡‡é›†ï¼Œä¸ç„¶ä¸é‡‡é›†ï¼Œä¸å…¥åº“</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__meta_kubernetes_service_annotation_prometheus_io_scrape</span>]</span><br><span class="line">          <span class="attr">action:</span> <span class="string">keep</span></span><br><span class="line">          <span class="attr">regex:</span> <span class="literal">true</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__meta_kubernetes_service_annotation_prometheus_io_scheme</span>]</span><br><span class="line">          <span class="attr">action:</span> <span class="string">replace</span></span><br><span class="line">          <span class="attr">target_label:</span> <span class="string">__scheme__</span></span><br><span class="line">          <span class="attr">regex:</span> <span class="string">(https?)</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__meta_kubernetes_service_annotation_prometheus_io_path</span>]</span><br><span class="line">          <span class="attr">action:</span> <span class="string">replace</span></span><br><span class="line">          <span class="attr">target_label:</span> <span class="string">__metrics_path__</span></span><br><span class="line">          <span class="attr">regex:</span> <span class="string">(.+)</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__address__</span>, <span class="string">__meta_kubernetes_service_annotation_prometheus_io_port</span>]</span><br><span class="line">          <span class="attr">action:</span> <span class="string">replace</span></span><br><span class="line">          <span class="attr">target_label:</span> <span class="string">__address__</span></span><br><span class="line">          <span class="attr">regex:</span> <span class="string">([^:]+)(?::\d+)?;(\d+)</span></span><br><span class="line">          <span class="attr">replacement:</span> <span class="string">$1:$2</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">action:</span> <span class="string">labelmap</span></span><br><span class="line">          <span class="attr">regex:</span> <span class="string">__meta_kubernetes_service_label_(.+)</span></span><br></pre></td></tr></table></figure><blockquote><p>æ³¨ï¼šå¦‚æœéœ€è¦ç›‘æ§ pod çŠ¶æ€ï¼Œæ¯”å¦‚ pod é‡å¯æ¬¡æ•°ç­‰æ•°æ®ï¼Œéœ€è¦å®‰è£… <code>kube-state-metrics</code> å¹¶é€šè¿‡æœåŠ¡å‘ç°çš„æ–¹å¼å°†æ•°æ®æ¥å…¥åˆ° Prometheus</p></blockquote><h2 id="Kubernetes-ä¸­éƒ¨ç½²æ— é›†ç¾¤æƒé™çš„-Prometheus"><a href="#Kubernetes-ä¸­éƒ¨ç½²æ— é›†ç¾¤æƒé™çš„-Prometheus" class="headerlink" title="Kubernetes ä¸­éƒ¨ç½²æ— é›†ç¾¤æƒé™çš„ Prometheus"></a>Kubernetes ä¸­éƒ¨ç½²æ— é›†ç¾¤æƒé™çš„ Prometheus</h2><p>æœ‰çš„å®¢æˆ·ä¸ç»™é›†ç¾¤æƒé™ï¼Œæ¯”å¦‚ä¸€ä¸ªå¤§çš„ Kubernetes é›†ç¾¤ä¸­ï¼Œç»™åˆ†é…äº†ä¸€ä¸ª namespaceï¼Œå…¶ä»– namespace æ˜¯åˆ«äººçš„æœåŠ¡ï¼Œå½“ç„¶ä¸èƒ½ç»™ä½ å¾ˆé«˜çš„æƒé™ï¼Œæˆ–è€…æ˜¯ä¸ªå®šåˆ¶çš„æ§åˆ¶ç•Œé¢ï¼Œæ— æ³•è¿›è¡Œåˆ›å»º serviceaccount çš„æ“ä½œç­‰ã€‚è¿™æ ·åªèƒ½ç›‘æ§ä¸€äº›åŸºç¡€çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ service é€šä¸é€šï¼ˆé€šè¿‡ service åœ°å€æ¥ç›‘æ§ï¼‰ï¼Œç›‘æ§ä¸€äº›ä¸­é—´ä»¶çš„ç›‘æ§æ•°æ®ï¼ˆæ‰‹åŠ¨é…ç½® exporter çš„ service åœ°å€ï¼‰</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">global:</span></span><br><span class="line">  <span class="attr">scrape_interval:</span>     <span class="string">30s</span></span><br><span class="line">  <span class="attr">evaluation_interval:</span> <span class="string">30s</span></span><br><span class="line">  <span class="attr">external_labels:</span></span><br><span class="line">    <span class="attr">env:</span> <span class="string">prod</span></span><br><span class="line">    <span class="attr">dept:</span> <span class="string">ops</span></span><br><span class="line">    <span class="attr">project:</span> <span class="string">example</span></span><br><span class="line">    <span class="attr">k8s:</span> <span class="string">example</span></span><br><span class="line"></span><br><span class="line"><span class="attr">scrape_configs:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&quot;mysql_instance&quot;</span></span><br><span class="line">  <span class="attr">static_configs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;mysql-exporter:9104&#x27;</span>]</span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">prod_example_mysql</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&quot;redis_instance&quot;</span></span><br><span class="line">  <span class="attr">static_configs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;redis-exporter:9121&#x27;</span>]</span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">prod_example_redis</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&quot;port&quot;</span></span><br><span class="line">  <span class="attr">scrape_interval:</span> <span class="string">20s</span></span><br><span class="line">  <span class="attr">params:</span></span><br><span class="line">    <span class="attr">module:</span> [<span class="string">tcp_connect</span>]</span><br><span class="line">  <span class="attr">metrics_path:</span> <span class="string">/probe</span></span><br><span class="line">  <span class="attr">scheme:</span> <span class="string">http</span></span><br><span class="line">  <span class="attr">static_configs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;10.133.103.171:6379&#x27;</span>]</span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">redis</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;10.133.103.170:3306&#x27;</span>]</span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">mysql</span></span><br><span class="line">  <span class="attr">relabel_configs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__address__</span>]</span><br><span class="line">      <span class="attr">target_label:</span> <span class="string">__param_target</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__param_target</span>]</span><br><span class="line">      <span class="attr">target_label:</span> <span class="string">addr</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__param_target</span>]</span><br><span class="line">      <span class="attr">action:</span> <span class="string">replace</span></span><br><span class="line">      <span class="attr">regex:</span> <span class="string">(.+):(.*)</span></span><br><span class="line">      <span class="attr">replacement:</span> <span class="string">$2</span></span><br><span class="line">      <span class="attr">target_label:</span> <span class="string">port</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">target_label:</span> <span class="string">__address__</span></span><br><span class="line">      <span class="attr">replacement:</span> <span class="string">&quot;blackbox-exporter:9115&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿™é‡Œæ‰‹åŠ¨é…ç½®çš„serviceè¯·æ±‚åœ°å€</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&quot;http_get&quot;</span></span><br><span class="line">  <span class="attr">scrape_interval:</span> <span class="string">20s</span></span><br><span class="line">  <span class="attr">metrics_path:</span> <span class="string">/probe</span></span><br><span class="line">  <span class="attr">scheme:</span> <span class="string">http</span></span><br><span class="line">  <span class="attr">params:</span></span><br><span class="line">    <span class="attr">module:</span> [<span class="string">http_2xx</span>]</span><br><span class="line">  <span class="attr">static_configs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;prod-idk-mob-sdk-server:5003/actuator/info&#x27;</span>]</span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">idk-mob-sdk-server</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;prod-public-hsm-services:8007/hsm/actuator/health&#x27;</span>]</span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">public-hsm-services</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">relabel_configs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__address__</span>]</span><br><span class="line">      <span class="attr">target_label:</span> <span class="string">__param_target</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__param_target</span>]</span><br><span class="line">      <span class="attr">target_label:</span> <span class="string">instance</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">target_label:</span> <span class="string">__address__</span></span><br><span class="line">      <span class="attr">replacement:</span> <span class="string">&quot;blackbox-exporter:9115&quot;</span></span><br></pre></td></tr></table></figure><h2 id="è™šæ‹Ÿæœºéƒ¨ç½²"><a href="#è™šæ‹Ÿæœºéƒ¨ç½²" class="headerlink" title="è™šæ‹Ÿæœºéƒ¨ç½²"></a>è™šæ‹Ÿæœºéƒ¨ç½²</h2><p>ç±»ä¼¼äºä¸Šé¢çš„ Kubernetes ä¸­éƒ¨ç½²çš„æ— æƒé™ Prometheus</p><h2 id="æ²¡æœ‰å…¬ç½‘åŸŸåçš„-Prometheus"><a href="#æ²¡æœ‰å…¬ç½‘åŸŸåçš„-Prometheus" class="headerlink" title="æ²¡æœ‰å…¬ç½‘åŸŸåçš„ Prometheus"></a>æ²¡æœ‰å…¬ç½‘åŸŸåçš„ Prometheus</h2><p>æ²¡æœ‰å…¬ç½‘åŸŸåæ„å‘³ç€æ— æ³•é€šè¿‡ Prometheus Core æ¥æ‹‰å–ï¼ˆè”é‚¦ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ remote write è¿œç¨‹å†™çš„æ–¹å¼å†™å…¥åˆ°ç›®æ ‡çš„ Prometheus Core ä¸­</p><p><code>vim prometheus.yml</code></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">remote_write:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">url:</span> <span class="string">&quot;https://prometheus.example.com/api/v1/write&quot;</span></span><br><span class="line">  <span class="attr">basic_auth:</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">admin</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">password</span></span><br><span class="line">  <span class="attr">remote_timeout:</span> <span class="string">30s</span></span><br><span class="line">  <span class="attr">tls_config:</span></span><br><span class="line">    <span class="attr">insecure_skip_verify:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">queue_config:</span></span><br><span class="line">    <span class="attr">capacity:</span> <span class="number">2000</span></span><br><span class="line">    <span class="attr">max_shards:</span> <span class="number">1000</span></span><br><span class="line">    <span class="attr">min_shards:</span> <span class="number">1</span></span><br><span class="line">    <span class="attr">max_samples_per_send:</span> <span class="number">1000</span></span><br><span class="line">    <span class="attr">batch_send_deadline:</span> <span class="string">5s</span></span><br><span class="line">    <span class="attr">min_backoff:</span> <span class="string">30ms</span></span><br><span class="line">    <span class="attr">max_backoff:</span> <span class="string">100ms</span></span><br></pre></td></tr></table></figure><h3 id="è¿œç¨‹å†™-Prometheus-è‡ªèº«æŒ‚æ‰å¦‚ä½•ç›‘æ§"><a href="#è¿œç¨‹å†™-Prometheus-è‡ªèº«æŒ‚æ‰å¦‚ä½•ç›‘æ§" class="headerlink" title="è¿œç¨‹å†™ Prometheus è‡ªèº«æŒ‚æ‰å¦‚ä½•ç›‘æ§"></a>è¿œç¨‹å†™ Prometheus è‡ªèº«æŒ‚æ‰å¦‚ä½•ç›‘æ§</h3><p>ä½¿ç”¨ absent å‡½æ•°æ¥åšåˆ¤æ–­ å…·ä½“å¯ä»¥çœ‹ <a href="/posts/666e547f/">Prometheusé€šè¿‡remote_writeå†™å…¥æ•°æ®åˆ°å¦ä¸€å°Prometheus</a></p><h2 id="basicauth-è®¤è¯"><a href="#basicauth-è®¤è¯" class="headerlink" title="basicauth è®¤è¯"></a>basicauth è®¤è¯</h2><p>å…³äºè®¤è¯ï¼Œå¯ä»¥çœ‹ <a href="/posts/165a0cd3/">Prometheuså¼€å¯basic_authè®¤è¯</a></p>]]></content>
      
      
      <categories>
          
          <category> ç›‘æ§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> prometheus </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨snmp exporterå¯¹äº¤æ¢æœºã€æœåŠ¡å™¨ç­‰è¿›è¡Œç›‘æ§</title>
      <link href="/posts/smz2c9/"/>
      <url>/posts/smz2c9/</url>
      
        <content type="html"><![CDATA[<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>åˆ° GitHub ä¸‹è½½ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œç›´æ¥è¿è¡Œå³å¯ï¼Œæˆ–è€…ä½¿ç”¨ systemd æ¥è¿è¡Œï¼Œä¹Ÿå¯ä»¥ç›´æ¥éƒ¨ç½²åˆ° Kubernetes ä¸­ã€‚<br><a href="https://github.com/prometheus/snmp_exporter">https://github.com/prometheus/snmp_exporter</a></p><p>systemd é…ç½®ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Unit]</span></span><br><span class="line"><span class="attr">Description</span>=snmp_exporter</span><br><span class="line"><span class="attr">After</span>=network.target</span><br><span class="line"></span><br><span class="line"><span class="section">[Service]</span></span><br><span class="line"><span class="attr">ExecStart</span>=/opt/snmp_exporter/snmp_exporter --config.file=/opt/snmp_exporter/snmp.yml</span><br><span class="line"><span class="attr">Restart</span>=<span class="literal">on</span>-failure</span><br><span class="line"></span><br><span class="line"><span class="section">[Install]</span></span><br><span class="line"><span class="attr">WantedBy</span>=multi-user.target</span><br></pre></td></tr></table></figure><h2 id="äº¤æ¢æœºæˆ–æœåŠ¡å™¨æ‰“å¼€-snmp-åè®®"><a href="#äº¤æ¢æœºæˆ–æœåŠ¡å™¨æ‰“å¼€-snmp-åè®®" class="headerlink" title="äº¤æ¢æœºæˆ–æœåŠ¡å™¨æ‰“å¼€ snmp åè®®"></a>äº¤æ¢æœºæˆ–æœåŠ¡å™¨æ‰“å¼€ snmp åè®®</h2><p>è¿™ä¸€æ­¥éœ€è¦åœ¨äº¤æ¢æœºæˆ–æœåŠ¡å™¨çš„ ipmi ä¸Šé…ç½®ï¼Œäº¤æ¢æœºè¿™ç§ç½‘ç»œè®¾å¤‡ä¸€èˆ¬éƒ½åªæ”¯æŒ snmp åè®®æ¥è·å–æ•°æ®ï¼Œæ¯”å¦‚è¯´æ¯ä¸ªæ¥å£çš„çŠ¶æ€ï¼ˆæœ‰æ²¡æœ‰æ’ç½‘çº¿ç­‰ï¼‰<br>å¯¹äºæœåŠ¡å™¨ï¼Œåƒ cpu å ç”¨ç‡ã€å†…å­˜ä½¿ç”¨ç‡è¿™äº›æ•°æ®ä½¿ç”¨ node_exporter å°±å¯ä»¥åšï¼Œä¸ºå•¥è¿˜è¦ä½¿ç”¨ snmp_exporter å‘¢ï¼Œsnmp_exporter å¯ä»¥åšåˆ°ä¸€äº›åº•å±‚çš„ç›‘æ§ï¼Œæ¯”å¦‚è¯´ï¼šé£æ‰‡è½¬é€Ÿã€ç”µæºæ˜¯å¦æœ‰æŸåçš„ï¼ˆä¸€èˆ¬æœåŠ¡å™¨éƒ½æœ‰å¤šä¸ªç”µæºæ¨¡å—ï¼‰ã€æ¸©åº¦æƒ…å†µã€ç£ç›˜é˜µåˆ—çŠ¶æ€ï¼ˆæ˜¯å¦æœ‰ç¡¬ç›˜åæ‰äº†ï¼Œæ¯”å¦‚åšäº† raid1ï¼Œåäº†ä¸€å—ç¡¬ç›˜åœ¨è½¯ä»¶å±‚é¢æ˜¯æ— æ„ŸçŸ¥çš„ï¼Œä½†æ˜¯éœ€è¦åŠæ—¶æ›´æ¢ç¡¬ç›˜äº†ã€‚ï¼‰</p><p>æ‰“å¼€ snmp åè®®åï¼Œéœ€è¦è®¾ç½®å¹¶è®°å½•ä¸€ä¸‹å›¢ä½“åã€‚</p><p>æµ‹è¯• snmp å‘½ä»¤ç¤ºä¾‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">snmpwalk -v 2c -c 123456 100.200.1.254</span><br><span class="line">snmpwalk -v 2c -c 123456 172.18.48.5 1.3.6.1.2.1.47.1.1.1.1.7</span><br><span class="line">snmpwalk -v3 -u sysadmin -a MD5 -A rootuser -x DES -X rootuser -l authpriv 100.200.1.24</span><br></pre></td></tr></table></figure><h2 id="ç”Ÿæˆé…ç½®æ–‡ä»¶"><a href="#ç”Ÿæˆé…ç½®æ–‡ä»¶" class="headerlink" title="ç”Ÿæˆé…ç½®æ–‡ä»¶"></a>ç”Ÿæˆé…ç½®æ–‡ä»¶</h2><p>snmp exporter å¼€æºè½¯ä»¶ä¸­æœ‰ä¸ª snmp generator ï¼Œå¯ä»¥ç”¨äºç”Ÿæˆ snmp exporter çš„é…ç½®æ–‡ä»¶ã€‚<br>é…ç½®æ–‡ä»¶ä¸­æ ¹æ®ç¡¬ä»¶çš„ MIB æ–‡ä»¶ç”Ÿæˆäº† OID çš„æ˜ å°„å…³ç³»ã€‚ä»¥ Cisco äº¤æ¢æœºä¸ºä¾‹ï¼Œåœ¨å®˜æ–¹ GitHub ä¸Šä¸‹è½½æœ€æ–°çš„ <strong>snmp.yml</strong> æ–‡ä»¶ï¼Œç”±äº Cisco äº¤æ¢æœºä½¿ç”¨çš„æ˜¯ if_mib æ¨¡å—ï¼Œåœ¨ if_mib ä¸‹æ–°å¢ auth é…ç½®ï¼Œå›¢ä½“åè¦å’Œäº¤æ¢æœºä¸Šé…ç½®çš„ä¸€è‡´ã€‚<br>æ ¹æ® mib æ–‡ä»¶ç”Ÿæˆ yaml é…ç½®æ–‡ä»¶å·¥å…·ï¼š<a href="https://github.com/prometheus/snmp_exporter/tree/main/generator">https://github.com/prometheus/snmp_exporter/tree/main/generator</a><br>å…³äºé‡‡é›†çš„ç›‘æ§é¡¹æ˜¯åœ¨ walk å­—æ®µä¸‹ï¼Œå¦‚æœè¦æ–°å¢ç›‘æ§é¡¹ï¼Œå†™åœ¨ walk é¡¹ä¸‹ã€‚æˆ‘æ–°å¢äº†äº¤æ¢æœºçš„ CPU å’Œå†…å­˜ä¿¡æ¯ã€‚å®˜æ–¹ç¤ºä¾‹ä¸­çš„ if_mib è¿™ä¸ªæ˜¯ module åå­—ï¼Œ if_mib æ˜¯ä¸ªç½‘ç»œè®¾å¤‡çš„è§„èŒƒï¼ŒRFC1573</p><h3 id="H3C-äº¤æ¢æœºé…ç½®ç¤ºä¾‹"><a href="#H3C-äº¤æ¢æœºé…ç½®ç¤ºä¾‹" class="headerlink" title="H3C äº¤æ¢æœºé…ç½®ç¤ºä¾‹"></a>H3C äº¤æ¢æœºé…ç½®ç¤ºä¾‹</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># WARNING: This file was auto-generated using snmp_exporter generator, manual changes will be lost.</span></span><br><span class="line"><span class="attr">H3C:</span></span><br><span class="line">  <span class="attr">walk:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span>                     <span class="comment">#ç«¯å£æè¿°</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span><span class="number">.2</span><span class="number">.1</span><span class="number">.8</span>                     <span class="comment">#ç«¯å£çŠ¶æ€ 1upï¼Œ2down</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.31</span><span class="number">.1</span><span class="number">.1</span><span class="number">.1</span><span class="number">.1</span>                  <span class="comment">#ç«¯å£åç§°</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.31</span><span class="number">.1</span><span class="number">.1</span><span class="number">.1</span><span class="number">.18</span>                 <span class="comment">#ç«¯å£åˆ«å</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.25506</span><span class="number">.2</span><span class="number">.40</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span><span class="number">.3</span><span class="number">.1</span><span class="number">.5</span>      <span class="comment">#H3Cç«¯å£è¿›æµé‡</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.25506</span><span class="number">.2</span><span class="number">.40</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span><span class="number">.3</span><span class="number">.1</span><span class="number">.6</span>      <span class="comment">#H3Cç«¯å£å‡ºæµé‡</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.25506</span><span class="number">.8</span><span class="number">.35</span><span class="number">.18</span><span class="number">.4</span><span class="number">.3</span><span class="number">.1</span><span class="number">.13</span>      <span class="comment">#å†…å­˜åˆ©ç”¨ç‡</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.25506</span><span class="number">.8</span><span class="number">.35</span><span class="number">.18</span><span class="number">.4</span><span class="number">.3</span><span class="number">.1</span><span class="number">.4</span>       <span class="comment">#CPUåˆ©ç”¨ç‡</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.25506</span><span class="number">.8</span><span class="number">.35</span><span class="number">.9</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span>        <span class="comment">#ç”µæºçŠ¶æ€</span></span><br><span class="line">  <span class="attr">get:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.1</span><span class="number">.0</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.3</span><span class="number">.0</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.5</span><span class="number">.0</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.25506</span><span class="number">.8</span><span class="number">.35</span><span class="number">.18</span><span class="number">.1</span><span class="number">.1</span><span class="number">.0</span></span><br><span class="line">  <span class="attr">metrics:</span></span><br><span class="line">  <span class="comment"># è¿™é‡Œçš„nameå°±æ˜¯æ”¶é›†åˆ°çš„æŒ‡æ ‡çš„åå­—</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">sysDescr</span></span><br><span class="line">    <span class="attr">oid:</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">DisplayString</span></span><br><span class="line">    <span class="attr">help:</span> <span class="string">A</span> <span class="string">textual</span> <span class="string">description</span> <span class="string">of</span> <span class="string">the</span> <span class="string">entity</span> <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">sysUpTime</span></span><br><span class="line">    <span class="attr">oid:</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.3</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">gauge</span></span><br><span class="line">    <span class="attr">help:</span> <span class="string">The</span> <span class="string">time</span> <span class="string">(in</span> <span class="string">hundredths</span> <span class="string">of</span> <span class="string">a</span> <span class="string">second)</span> <span class="string">since</span> <span class="string">the</span> <span class="string">network</span> <span class="string">management</span> <span class="string">portion</span></span><br><span class="line">      <span class="string">of</span> <span class="string">the</span> <span class="string">system</span> <span class="string">was</span> <span class="string">last</span> <span class="string">re-initialized.</span> <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.3</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">sysName</span></span><br><span class="line">    <span class="attr">oid:</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.5</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">DisplayString</span></span><br><span class="line">    <span class="attr">help:</span> <span class="string">An</span> <span class="string">administratively-assigned</span> <span class="string">name</span> <span class="string">for</span> <span class="string">this</span> <span class="string">managed</span> <span class="string">node</span> <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.5</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">ifOperStatus</span></span><br><span class="line">    <span class="attr">oid:</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span><span class="number">.2</span><span class="number">.1</span><span class="number">.8</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">gauge</span></span><br><span class="line">    <span class="attr">help:</span> <span class="string">The</span> <span class="string">current</span> <span class="string">operational</span> <span class="string">state</span> <span class="string">of</span> <span class="string">the</span> <span class="string">interface</span> <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span><span class="number">.2</span><span class="number">.1</span><span class="number">.8</span></span><br><span class="line">    <span class="attr">indexes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">labelname:</span> <span class="string">ifIndex</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">gauge</span></span><br><span class="line">    <span class="attr">lookups:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">labels:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ifIndex</span></span><br><span class="line">      <span class="attr">labelname:</span> <span class="string">ifAlias</span></span><br><span class="line">      <span class="attr">oid:</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.31</span><span class="number">.1</span><span class="number">.1</span><span class="number">.1</span><span class="number">.18</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">DisplayString</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">labels:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ifIndex</span></span><br><span class="line">      <span class="attr">labelname:</span> <span class="string">ifDescr</span></span><br><span class="line">      <span class="attr">oid:</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">DisplayString</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">labels:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ifIndex</span></span><br><span class="line">      <span class="attr">labelname:</span> <span class="string">ifName</span></span><br><span class="line">      <span class="attr">oid:</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.31</span><span class="number">.1</span><span class="number">.1</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">DisplayString</span></span><br><span class="line">    <span class="attr">enum_values:</span></span><br><span class="line">      <span class="attr">1:</span> <span class="string">up</span></span><br><span class="line">      <span class="attr">2:</span> <span class="string">down</span></span><br><span class="line">      <span class="attr">3:</span> <span class="string">testing</span></span><br><span class="line">      <span class="attr">4:</span> <span class="string">unknown</span></span><br><span class="line">      <span class="attr">5:</span> <span class="string">dormant</span></span><br><span class="line">      <span class="attr">6:</span> <span class="string">notPresent</span></span><br><span class="line">      <span class="attr">7:</span> <span class="string">lowerLayerDown</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">hh3cIfStatFlowHCInBytes</span></span><br><span class="line">    <span class="attr">oid:</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.25506</span><span class="number">.2</span><span class="number">.40</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span><span class="number">.3</span><span class="number">.1</span><span class="number">.5</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">counter</span></span><br><span class="line">    <span class="attr">help:</span> <span class="string">In</span> <span class="string">bytes</span> <span class="string">in</span> <span class="string">the</span> <span class="string">specified</span> <span class="string">interval</span> <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.25506</span><span class="number">.2</span><span class="number">.40</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span><span class="number">.3</span><span class="number">.1</span><span class="number">.5</span></span><br><span class="line">    <span class="attr">indexes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">labelname:</span> <span class="string">ifIndex</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">gauge</span></span><br><span class="line">    <span class="attr">lookups:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">labels:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ifIndex</span></span><br><span class="line">      <span class="attr">labelname:</span> <span class="string">ifAlias</span></span><br><span class="line">      <span class="attr">oid:</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.31</span><span class="number">.1</span><span class="number">.1</span><span class="number">.1</span><span class="number">.18</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">DisplayString</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">labels:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ifIndex</span></span><br><span class="line">      <span class="attr">labelname:</span> <span class="string">ifDescr</span></span><br><span class="line">      <span class="attr">oid:</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">DisplayString</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">labels:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ifIndex</span></span><br><span class="line">      <span class="attr">labelname:</span> <span class="string">ifName</span></span><br><span class="line">      <span class="attr">oid:</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.31</span><span class="number">.1</span><span class="number">.1</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">DisplayString</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">hh3cIfStatFlowHCOutBytes</span></span><br><span class="line">    <span class="attr">oid:</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.25506</span><span class="number">.2</span><span class="number">.40</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span><span class="number">.3</span><span class="number">.1</span><span class="number">.6</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">counter</span></span><br><span class="line">    <span class="attr">help:</span> <span class="string">Out</span> <span class="string">bytes</span> <span class="string">in</span> <span class="string">the</span> <span class="string">specified</span> <span class="string">interval</span> <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.25506</span><span class="number">.2</span><span class="number">.40</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span><span class="number">.3</span><span class="number">.1</span><span class="number">.6</span></span><br><span class="line">    <span class="attr">indexes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">labelname:</span> <span class="string">ifIndex</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">gauge</span></span><br><span class="line">    <span class="attr">lookups:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">labels:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ifIndex</span></span><br><span class="line">      <span class="attr">labelname:</span> <span class="string">ifAlias</span></span><br><span class="line">      <span class="attr">oid:</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.31</span><span class="number">.1</span><span class="number">.1</span><span class="number">.1</span><span class="number">.18</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">DisplayString</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">labels:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ifIndex</span></span><br><span class="line">      <span class="attr">labelname:</span> <span class="string">ifDescr</span></span><br><span class="line">      <span class="attr">oid:</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">DisplayString</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">labels:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ifIndex</span></span><br><span class="line">      <span class="attr">labelname:</span> <span class="string">ifName</span></span><br><span class="line">      <span class="attr">oid:</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.31</span><span class="number">.1</span><span class="number">.1</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">DisplayString</span>  </span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">hh3cLswSysIpAddr</span></span><br><span class="line">    <span class="attr">oid:</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.25506</span><span class="number">.8</span><span class="number">.35</span><span class="number">.18</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">InetAddressIPv4</span></span><br><span class="line">    <span class="attr">help:</span> <span class="string">System</span> <span class="string">IP</span> <span class="string">address,</span> <span class="string">which</span> <span class="string">is</span> <span class="string">the</span> <span class="string">primary</span> <span class="string">IP</span> <span class="string">address</span> <span class="string">of</span> <span class="string">the</span> <span class="string">VLAN</span> <span class="string">interface</span></span><br><span class="line">      <span class="string">that</span> <span class="string">has</span> <span class="string">smallest</span> <span class="string">VLAN</span> <span class="string">ID</span> <span class="string">and</span> <span class="string">is</span> <span class="string">configured</span> <span class="string">IP</span> <span class="string">address.</span> <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.25506</span><span class="number">.8</span><span class="number">.35</span><span class="number">.18</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">hh3cLswSlotMemoryRatio</span></span><br><span class="line">    <span class="attr">oid:</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.25506</span><span class="number">.8</span><span class="number">.35</span><span class="number">.18</span><span class="number">.4</span><span class="number">.3</span><span class="number">.1</span><span class="number">.13</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">gauge</span></span><br><span class="line">    <span class="attr">help:</span> <span class="string">The</span> <span class="string">percentage</span> <span class="string">of</span> <span class="string">system</span> <span class="string">memory</span> <span class="string">in</span> <span class="string">use</span> <span class="string">on</span> <span class="string">the</span> <span class="string">board</span> <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.25506</span><span class="number">.8</span><span class="number">.35</span><span class="number">.18</span><span class="number">.4</span><span class="number">.3</span><span class="number">.1</span><span class="number">.13</span></span><br><span class="line">    <span class="attr">indexes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">labelname:</span> <span class="string">hh3cLswFrameIndex</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">gauge</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">labelname:</span> <span class="string">hh3cLswSlotIndex</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">gauge</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">hh3cLswSlotCpuRatio</span></span><br><span class="line">    <span class="attr">oid:</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.25506</span><span class="number">.8</span><span class="number">.35</span><span class="number">.18</span><span class="number">.4</span><span class="number">.3</span><span class="number">.1</span><span class="number">.4</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">gauge</span></span><br><span class="line">    <span class="attr">help:</span> <span class="string">CPU</span> <span class="string">usage</span> <span class="string">of</span> <span class="string">the</span> <span class="string">slot</span> <span class="string">in</span> <span class="string">accuracy</span> <span class="string">of</span> <span class="number">1</span><span class="string">%,</span> <span class="string">and</span> <span class="string">the</span> <span class="string">range</span> <span class="string">of</span> <span class="string">value</span> <span class="string">is</span> <span class="number">1</span> <span class="string">to</span></span><br><span class="line">      <span class="number">100</span><span class="string">.</span> <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.25506</span><span class="number">.8</span><span class="number">.35</span><span class="number">.18</span><span class="number">.4</span><span class="number">.3</span><span class="number">.1</span><span class="number">.4</span></span><br><span class="line">    <span class="attr">indexes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">labelname:</span> <span class="string">hh3cLswFrameIndex</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">gauge</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">labelname:</span> <span class="string">hh3cLswSlotIndex</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">gauge</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">hh3cDevMPowerStatus</span></span><br><span class="line">    <span class="attr">oid:</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.25506</span><span class="number">.8</span><span class="number">.35</span><span class="number">.9</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">gauge</span></span><br><span class="line">    <span class="attr">help:</span> <span class="string">&#x27;Power status: active (1), deactive (2) not installed (3) and unsupported</span></span><br><span class="line"><span class="string">      - 1.3.6.1.4.1.25506.8.35.9.1.2.1.2&#x27;</span></span><br><span class="line">    <span class="attr">indexes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">labelname:</span> <span class="string">hh3cDevMPowerNum</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">gauge</span></span><br><span class="line">    <span class="attr">enum_values:</span></span><br><span class="line">      <span class="attr">1:</span> <span class="string">active</span></span><br><span class="line">      <span class="attr">2:</span> <span class="string">deactive</span></span><br><span class="line">      <span class="attr">3:</span> <span class="string">not-install</span></span><br><span class="line">      <span class="attr">4:</span> <span class="string">unsupport</span></span><br><span class="line">  <span class="attr">version:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">max_repetitions:</span> <span class="number">25</span></span><br><span class="line">  <span class="attr">retries:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">timeout:</span> <span class="string">60s</span></span><br><span class="line">  <span class="attr">auth:</span></span><br><span class="line">    <span class="attr">community:</span> <span class="number">123456</span></span><br></pre></td></tr></table></figure><h3 id="æµªæ½®æœåŠ¡å™¨é…ç½®ç¤ºä¾‹"><a href="#æµªæ½®æœåŠ¡å™¨é…ç½®ç¤ºä¾‹" class="headerlink" title="æµªæ½®æœåŠ¡å™¨é…ç½®ç¤ºä¾‹"></a>æµªæ½®æœåŠ¡å™¨é…ç½®ç¤ºä¾‹</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># WARNING: This file was auto-generated using snmp_exporter generator, manual changes will be lost.</span></span><br><span class="line"><span class="attr">Inspur:</span></span><br><span class="line">  <span class="attr">walk:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.37945</span><span class="number">.2</span><span class="number">.1</span><span class="number">.5</span><span class="number">.1</span><span class="number">.1</span><span class="number">.3</span><span class="number">.19</span><span class="number">.9</span><span class="number">.65</span><span class="number">.115</span><span class="number">.115</span><span class="number">.101</span><span class="number">.116</span><span class="number">.32</span><span class="number">.84</span><span class="number">.97</span><span class="number">.103</span> <span class="comment">#æœºå™¨fruä¿¡æ¯</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.37945</span><span class="number">.2</span><span class="number">.3</span><span class="number">.1</span><span class="number">.1</span><span class="number">.1</span><span class="number">.3</span> <span class="comment">#ç”µæºæ¨¡å—PSUå½“å‰åœ¨ä½çŠ¶æ€</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.37945</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.1</span><span class="number">.1</span><span class="number">.1</span><span class="number">.3</span> <span class="comment">#CPUçŠ¶æ€</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.37945</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.3</span> <span class="comment">#ç”µå‹sensorå¥åº·çŠ¶æ€,0-N/A;1-Normal;2-Warning;3-Critical</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.37945</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.1</span><span class="number">.3</span> <span class="comment">#æ¸©åº¦sensorçš„å¥åº·çŠ¶æ€,0-N/A;1-Normal;2-Warning;3-Critical</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.37945</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span><span class="number">.3</span><span class="number">.1</span><span class="number">.1</span><span class="number">.3</span> <span class="comment">#é£æ‰‡è½¬é€Ÿ,0-N/A;1-Normal;2-Warning;3-Critical</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.37945</span><span class="number">.2</span><span class="number">.1</span><span class="number">.3</span><span class="number">.1</span><span class="number">.1</span><span class="number">.1</span><span class="number">.4</span> <span class="comment">#å‰ç½®ç¡¬ç›˜çŠ¶æ€ 0-N/A;1-Normal;2-Warning;3-Critical</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.37945</span><span class="number">.2</span><span class="number">.1</span><span class="number">.6</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.9</span> <span class="comment">#ç¡¬ç›˜çŠ¶æ€ç›‘æ§ä¿¡æ¯(é©±åŠ¨å™¨æ’æ§½)</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.37945</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.6</span><span class="number">.1</span><span class="number">.1</span><span class="number">.9</span> <span class="comment">#ç”µæºpower 0-N/A;1-Normal;2-Warning;3-Critical</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.37945</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span><span class="number">.5</span><span class="number">.1</span><span class="number">.1</span><span class="number">.3</span> <span class="comment">#å†…å­˜ç›‘æ§ 0-N/A;1-Normal;2-Warning;3-Critical</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.37945</span><span class="number">.2</span><span class="number">.1</span><span class="number">.6</span><span class="number">.3</span><span class="number">.1</span><span class="number">.1</span><span class="number">.4</span> <span class="comment">#raidç±»å‹,æ¯”å¦‚raid1 raid5 raid10</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.37945</span><span class="number">.2</span><span class="number">.1</span><span class="number">.6</span><span class="number">.3</span><span class="number">.1</span><span class="number">.1</span><span class="number">.2</span> <span class="comment">#Raidå¡å¥åº·çŠ¶æ€ä¿¡æ¯, &quot;Absent&quot;,&quot;Normal&quot;,&quot;Critical&quot;,&quot;N/A&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.37945</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span><span class="number">.14</span><span class="number">.1</span><span class="number">.1</span><span class="number">.5</span> <span class="comment">#ç½‘å¡å¥åº·çŠ¶æ€ï¼Œæ˜¾ç¤ºä¸º&quot;Normal&quot;,&quot;Warning&quot;,&quot;Critical&quot;,&quot;N/A&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">metrics:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">serverFRUInfoSetupAttributeValue</span>  <span class="comment">#æœºå™¨fruä¿¡æ¯:åºåˆ—å·</span></span><br><span class="line">    <span class="attr">oid:</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.37945</span><span class="number">.2</span><span class="number">.1</span><span class="number">.5</span><span class="number">.1</span><span class="number">.1</span><span class="number">.3</span><span class="number">.19</span><span class="number">.9</span><span class="number">.65</span><span class="number">.115</span><span class="number">.115</span><span class="number">.101</span><span class="number">.116</span><span class="number">.32</span><span class="number">.84</span><span class="number">.97</span><span class="number">.103</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">DisplayString</span></span><br><span class="line">    <span class="attr">help:</span> <span class="string">The</span> <span class="string">serverFRUInfoSetupAttributeValue</span> <span class="string">of</span> <span class="string">this</span> <span class="string">conceptual</span> <span class="string">row.</span> <span class="bullet">-</span> <span class="string">æœºå™¨fru</span> <span class="string">åºåˆ—å·ä¿¡æ¯</span></span><br><span class="line">    <span class="attr">indexes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">labelname:</span> <span class="string">inspur</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">gauge</span></span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">serverPowerSupplyMonitorPresent</span>  <span class="comment">#ç”µæºæ¨¡å—PSUå½“å‰åœ¨ä½çŠ¶æ€</span></span><br><span class="line">    <span class="attr">oid:</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.37945</span><span class="number">.2</span><span class="number">.3</span><span class="number">.1</span><span class="number">.1</span><span class="number">.1</span><span class="number">.3</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">DisplayString</span></span><br><span class="line">    <span class="attr">help:</span> <span class="string">The</span> <span class="string">serverPowerSupplyMonitorPresent</span> <span class="string">of</span> <span class="string">this</span> <span class="string">conceptual</span> <span class="string">row.</span> <span class="bullet">-</span> <span class="string">ç”µæºæ¨¡å—PSUå½“å‰åœ¨ä½çŠ¶æ€</span></span><br><span class="line">    <span class="attr">indexes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">labelname:</span> <span class="string">inspur</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">gauge</span></span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">serverCPUInfoPresent</span>  <span class="comment">#CPUå½“å‰åœ¨ä½çŠ¶æ€</span></span><br><span class="line">    <span class="attr">oid:</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.37945</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.1</span><span class="number">.1</span><span class="number">.1</span><span class="number">.3</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">DisplayString</span></span><br><span class="line">    <span class="attr">help:</span> <span class="string">The</span> <span class="string">serverCPUInfoPresent</span> <span class="string">of</span> <span class="string">this</span> <span class="string">conceptual</span> <span class="string">row.</span> <span class="bullet">-</span> <span class="string">CPUå½“å‰åœ¨ä½çŠ¶æ€</span></span><br><span class="line">    <span class="attr">indexes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">labelname:</span> <span class="string">inspur</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">gauge</span></span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">serverRaidDiskInfoVolumeraidLevel</span>  <span class="comment"># raidå¡ç±»å‹</span></span><br><span class="line">    <span class="attr">oid:</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.37945</span><span class="number">.2</span><span class="number">.1</span><span class="number">.6</span><span class="number">.3</span><span class="number">.1</span><span class="number">.1</span><span class="number">.4</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">DisplayString</span></span><br><span class="line">    <span class="attr">help:</span> <span class="string">serverRaidDiskInfoVolumeraidLevel</span> <span class="string">of</span> <span class="string">this</span> <span class="string">conceptual</span> <span class="string">row.</span> <span class="bullet">-</span> <span class="string">raidå¡ç±»å‹</span></span><br><span class="line">    <span class="attr">indexes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">labelname:</span> <span class="string">inspur</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">gauge</span></span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">serverVoltageStatus</span> <span class="comment">#ç”µå‹sensorå¥åº·çŠ¶æ€</span></span><br><span class="line">    <span class="attr">oid:</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.37945</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.3</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">gauge</span></span><br><span class="line">    <span class="attr">help:</span> <span class="string">The</span> <span class="string">serverVoltagestatus</span> <span class="string">of</span> <span class="string">this</span> <span class="string">conceptual</span> <span class="string">row.</span> <span class="bullet">-</span> <span class="string">ç”µå‹sensorå¥åº·çŠ¶æ€</span> <span class="number">1</span><span class="string">è¡¨ç¤ºæ­£å¸¸</span></span><br><span class="line">    <span class="attr">indexes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">labelname:</span> <span class="string">inspur</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">gauge</span></span><br><span class="line">    <span class="attr">enum_values:</span></span><br><span class="line">      <span class="attr">0:</span> <span class="string">N/A</span></span><br><span class="line">      <span class="attr">1:</span> <span class="string">Normal</span></span><br><span class="line">      <span class="attr">2:</span> <span class="string">Warning</span></span><br><span class="line">      <span class="attr">3:</span> <span class="string">Critical</span></span><br><span class="line">          </span><br><span class="line">          </span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">serverTemperatureSensorStatus</span> <span class="comment">#æ¸©åº¦sensorçš„å¥åº·çŠ¶æ€</span></span><br><span class="line">    <span class="attr">oid:</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.37945</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.1</span><span class="number">.3</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">gauge</span></span><br><span class="line">    <span class="attr">help:</span> <span class="string">The</span> <span class="string">serverTemperatureSensorStatus</span> <span class="string">of</span> <span class="string">this</span> <span class="string">conceptual</span> <span class="string">row.</span> <span class="bullet">-</span> <span class="string">æ¸©åº¦sensorçš„å¥åº·çŠ¶æ€</span> <span class="number">1</span><span class="string">è¡¨ç¤ºæ­£å¸¸</span></span><br><span class="line">    <span class="attr">indexes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">labelname:</span> <span class="string">inspur</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">gauge</span></span><br><span class="line">    <span class="attr">enum_values:</span></span><br><span class="line">      <span class="attr">0:</span> <span class="string">N/A</span></span><br><span class="line">      <span class="attr">1:</span> <span class="string">Normal</span></span><br><span class="line">      <span class="attr">2:</span> <span class="string">Warning</span></span><br><span class="line">      <span class="attr">3:</span> <span class="string">Critical</span></span><br><span class="line">          </span><br><span class="line">          </span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">serverFanSensorStatus</span> <span class="comment">#é£æ‰‡è½¬é€ŸçŠ¶æ€</span></span><br><span class="line">    <span class="attr">oid:</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.37945</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span><span class="number">.3</span><span class="number">.1</span><span class="number">.1</span><span class="number">.3</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">gauge</span></span><br><span class="line">    <span class="attr">help:</span> <span class="string">The</span> <span class="string">serverFanSensorStatus</span> <span class="string">of</span> <span class="string">this</span> <span class="string">conceptual</span> <span class="string">row.</span> <span class="bullet">-</span> <span class="string">é£æ‰‡è½¬é€ŸçŠ¶æ€</span> <span class="number">1</span><span class="string">è¡¨ç¤ºæ­£å¸¸</span></span><br><span class="line">    <span class="attr">indexes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">labelname:</span> <span class="string">inspur</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">gauge</span></span><br><span class="line">    <span class="attr">enum_values:</span></span><br><span class="line">      <span class="attr">0:</span> <span class="string">N/A</span></span><br><span class="line">      <span class="attr">1:</span> <span class="string">Normal</span></span><br><span class="line">      <span class="attr">2:</span> <span class="string">Warning</span></span><br><span class="line">      <span class="attr">3:</span> <span class="string">Critical</span></span><br><span class="line">         </span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">serverMemoryStatus</span> <span class="comment">#å†…å­˜ç›‘æ§</span></span><br><span class="line">    <span class="attr">oid:</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.37945</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span><span class="number">.5</span><span class="number">.1</span><span class="number">.1</span><span class="number">.3</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">gauge</span></span><br><span class="line">    <span class="attr">help:</span> <span class="string">The</span> <span class="string">serverMemoryStatus</span> <span class="string">of</span> <span class="string">this</span> <span class="string">conceptual</span> <span class="string">row.</span> <span class="bullet">-</span> <span class="string">å†…å­˜ç›‘æ§</span> <span class="number">1</span><span class="string">ä»£è¡¨æ­£å¸¸</span></span><br><span class="line">    <span class="attr">indexes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">labelname:</span> <span class="string">inspur</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">gauge</span></span><br><span class="line">    <span class="attr">enum_values:</span></span><br><span class="line">      <span class="attr">0:</span> <span class="string">N/A</span></span><br><span class="line">      <span class="attr">1:</span> <span class="string">Normal</span></span><br><span class="line">      <span class="attr">2:</span> <span class="string">Warning</span></span><br><span class="line">      <span class="attr">3:</span> <span class="string">Critical</span>        </span><br><span class="line">          </span><br><span class="line">          </span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">serverPowerSupplyStatus</span> <span class="comment">#ç”µæºpower</span></span><br><span class="line">    <span class="attr">oid:</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.37945</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.6</span><span class="number">.1</span><span class="number">.1</span><span class="number">.9</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">gauge</span></span><br><span class="line">    <span class="attr">help:</span> <span class="string">The</span> <span class="string">serverPowerSupplyStatus</span> <span class="string">of</span> <span class="string">this</span> <span class="string">conceptual</span> <span class="string">row.</span> <span class="bullet">-</span> <span class="string">ç”µæºpower</span> <span class="number">1</span><span class="string">ä»£è¡¨æ­£å¸¸</span></span><br><span class="line">    <span class="attr">indexes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">labelname:</span> <span class="string">inspur</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">gauge</span></span><br><span class="line">    <span class="attr">enum_values:</span></span><br><span class="line">      <span class="attr">0:</span> <span class="string">N/A</span></span><br><span class="line">      <span class="attr">1:</span> <span class="string">Normal</span></span><br><span class="line">      <span class="attr">2:</span> <span class="string">Warning</span></span><br><span class="line">      <span class="attr">3:</span> <span class="string">Critical</span>       </span><br><span class="line">          </span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">serverFrontHDStatus</span> <span class="comment">#å‰ç½®ç‰©ç†ç£ç›˜å¥åº·çŠ¶æ€</span></span><br><span class="line">    <span class="attr">oid:</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.37945</span><span class="number">.2</span><span class="number">.1</span><span class="number">.3</span><span class="number">.1</span><span class="number">.1</span><span class="number">.1</span><span class="number">.4</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">DisplayString</span></span><br><span class="line">    <span class="attr">help:</span> <span class="string">The</span> <span class="string">serverFrontHDStatus</span> <span class="string">of</span> <span class="string">this</span> <span class="string">conceptual</span> <span class="string">row.</span> <span class="bullet">-</span> <span class="string">å‰ç½®ç‰©ç†ç£ç›˜å¥åº·çŠ¶æ€</span> <span class="string">Normalä»£è¡¨æ­£å¸¸</span></span><br><span class="line">    <span class="attr">indexes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">labelname:</span> <span class="string">inspur</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">gauge</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">serverDriveSlotStatus</span> <span class="comment">#ç¡¬ç›˜å¥åº·çŠ¶æ€ä¿¡æ¯(é©±åŠ¨å™¨æ’æ§½)</span></span><br><span class="line">    <span class="attr">oid:</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.37945</span><span class="number">.2</span><span class="number">.1</span><span class="number">.6</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.9</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">DisplayString</span></span><br><span class="line">    <span class="attr">help:</span> <span class="string">The</span> <span class="string">serverDriveSlotStatus</span> <span class="string">of</span> <span class="string">this</span> <span class="string">conceptual</span> <span class="string">row.</span> <span class="bullet">-</span> <span class="string">ç¡¬ç›˜å¥åº·çŠ¶æ€ä¿¡æ¯</span> <span class="string">Normalä»£è¡¨æ­£å¸¸</span></span><br><span class="line">    <span class="attr">indexes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">labelname:</span> <span class="string">inspur</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">gauge</span></span><br><span class="line">    <span class="attr">enum_values:</span></span><br><span class="line">      <span class="attr">0:</span> <span class="number">0</span><span class="string">-N/A</span></span><br><span class="line">      <span class="attr">1:</span> <span class="string">Normal</span></span><br><span class="line">      <span class="attr">2:</span> <span class="string">Warning</span></span><br><span class="line">      <span class="attr">3:</span> <span class="string">Critical</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">serverRaidLogicDiskInfoStatus</span> <span class="comment">#Raidå¡å¥åº·çŠ¶æ€ä¿¡æ¯</span></span><br><span class="line">    <span class="attr">oid:</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.37945</span><span class="number">.2</span><span class="number">.1</span><span class="number">.6</span><span class="number">.3</span><span class="number">.1</span><span class="number">.1</span><span class="number">.2</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">DisplayString</span></span><br><span class="line">    <span class="attr">help:</span> <span class="string">The</span> <span class="string">serverRaidControllorStandardStatus</span> <span class="string">of</span> <span class="string">this</span> <span class="string">conceptual</span> <span class="string">row.</span> <span class="bullet">-</span> <span class="string">Raidå¡å¥åº·çŠ¶æ€ä¿¡æ¯</span> <span class="string">Optimalä»£è¡¨æ­£å¸¸</span></span><br><span class="line">    <span class="attr">indexes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">labelname:</span> <span class="string">inspur</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">gauge</span></span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">serverSystemNICStandardStatus</span> <span class="comment">#ç½‘å¡ç›‘æ§</span></span><br><span class="line">    <span class="attr">oid:</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.37945</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span><span class="number">.14</span><span class="number">.1</span><span class="number">.1</span><span class="number">.5</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">DisplayString</span></span><br><span class="line">    <span class="attr">help:</span> <span class="string">The</span> <span class="string">serverSystemNICStandardStatus</span> <span class="string">of</span> <span class="string">this</span> <span class="string">conceptual</span> <span class="string">row.</span> <span class="bullet">-</span> <span class="string">ç½‘å¡å¥åº·çŠ¶æ€ä¿¡æ¯</span> <span class="string">Normalä»£è¡¨æ­£å¸¸</span></span><br><span class="line">    <span class="attr">indexes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">labelname:</span> <span class="string">inspur</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">gauge</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">version:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">max_repetitions:</span> <span class="number">25</span></span><br><span class="line">  <span class="attr">retries:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">timeout:</span> <span class="string">60s</span></span><br><span class="line">  <span class="attr">auth:</span></span><br><span class="line">    <span class="attr">community:</span> <span class="number">123456</span></span><br><span class="line">    <span class="attr">security_level:</span> <span class="string">authPriv</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">sysadmin</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">rootuser</span></span><br><span class="line">    <span class="attr">auth_protocol:</span> <span class="string">MD5</span></span><br><span class="line">    <span class="attr">priv_protocol:</span> <span class="string">DES</span></span><br><span class="line">    <span class="attr">priv_password:</span> <span class="string">rootuser</span></span><br></pre></td></tr></table></figure><h3 id="éªŒè¯-snmp-exporter"><a href="#éªŒè¯-snmp-exporter" class="headerlink" title="éªŒè¯ snmp exporter"></a>éªŒè¯ snmp exporter</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://localhost:9116/snmp?module=if_mib,arista_sw&amp;target=192.0.0.8</span><br></pre></td></tr></table></figure><h2 id="prometheus-é‡‡é›†"><a href="#prometheus-é‡‡é›†" class="headerlink" title="prometheus é‡‡é›†"></a>prometheus é‡‡é›†</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;Inspurserver&#x27;</span></span><br><span class="line">  <span class="attr">scrape_interval:</span> <span class="string">60s</span></span><br><span class="line">  <span class="attr">scrape_timeout:</span> <span class="string">60s</span></span><br><span class="line">  <span class="attr">scheme:</span> <span class="string">http</span></span><br><span class="line">  <span class="attr">file_sd_configs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">files:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/data/prometheus/conf.d/inspur_server.yml</span></span><br><span class="line">      <span class="attr">refresh_interval:</span> <span class="string">30s</span></span><br><span class="line">  <span class="attr">metrics_path:</span> <span class="string">/snmp</span></span><br><span class="line">  <span class="attr">params:</span></span><br><span class="line">    <span class="attr">module:</span> [<span class="string">Inspur</span>]</span><br><span class="line">  <span class="attr">relabel_configs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__address__</span>]</span><br><span class="line">      <span class="attr">target_label:</span> <span class="string">__param_target</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__param_target</span>]</span><br><span class="line">      <span class="attr">target_label:</span> <span class="string">instance</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">target_label:</span> <span class="string">__address__</span></span><br><span class="line">      <span class="attr">replacement:</span> <span class="number">10.200</span><span class="number">.4</span><span class="number">.64</span><span class="string">:9130</span> </span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;h3cswitch&#x27;</span></span><br><span class="line">  <span class="attr">scrape_interval:</span> <span class="string">60s</span></span><br><span class="line">  <span class="attr">scrape_timeout:</span> <span class="string">60s</span></span><br><span class="line">  <span class="attr">scheme:</span> <span class="string">http</span></span><br><span class="line">  <span class="attr">file_sd_configs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">files:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/data/prometheus/conf.d/h3c_switch.yml</span></span><br><span class="line">      <span class="attr">refresh_interval:</span> <span class="string">30s</span></span><br><span class="line">  <span class="attr">metrics_path:</span> <span class="string">/snmp</span></span><br><span class="line">  <span class="attr">params:</span></span><br><span class="line">    <span class="attr">module:</span> [<span class="string">H3C</span>]</span><br><span class="line">  <span class="attr">relabel_configs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__address__</span>]</span><br><span class="line">      <span class="attr">target_label:</span> <span class="string">__param_target</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__param_target</span>]</span><br><span class="line">      <span class="attr">target_label:</span> <span class="string">instance</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">target_label:</span> <span class="string">__address__</span></span><br><span class="line">      <span class="attr">replacement:</span> <span class="number">10.200</span><span class="number">.4</span><span class="number">.64</span><span class="string">:9131</span></span><br></pre></td></tr></table></figure><p>å…·ä½“çš„æœºå™¨é…ç½®æ–‡ä»¶åœ¨ï¼š <code>/data/prometheus/conf.d/inspur_server.yml</code></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;100.200.1.23&#x27;</span>]</span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">&quot;lvs01&quot;</span></span><br><span class="line">    <span class="attr">addr:</span> <span class="string">&quot;100.200.1.23&quot;</span></span><br><span class="line">    <span class="attr">env:</span> <span class="string">prod</span></span><br><span class="line">    <span class="attr">dept:</span> <span class="string">hardware</span></span><br><span class="line">    <span class="attr">project:</span> <span class="string">&quot;hardware&quot;</span></span><br><span class="line">    <span class="attr">ip:</span> <span class="string">&quot;172.16.1.11&quot;</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">&quot;hardware&quot;</span></span><br><span class="line">    <span class="attr">hardware:</span> <span class="string">&quot;server&quot;</span></span><br><span class="line">    </span><br><span class="line"><span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;100.200.1.24&#x27;</span>]</span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">&quot;lvs02&quot;</span></span><br><span class="line">    <span class="attr">addr:</span> <span class="string">&quot;100.200.1.24&quot;</span></span><br><span class="line">    <span class="attr">env:</span> <span class="string">prod</span></span><br><span class="line">    <span class="attr">dept:</span> <span class="string">bi</span></span><br><span class="line">    <span class="attr">project:</span> <span class="string">&quot;bi&quot;</span></span><br><span class="line">    <span class="attr">ip:</span> <span class="string">&quot;172.16.1.12&quot;</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">&quot;hardware&quot;</span></span><br><span class="line">    <span class="attr">hardware:</span> <span class="string">&quot;server&quot;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç›‘æ§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> prometheus </tag>
            
            <tag> snmp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Windows å¼€æœºè‡ªå¯åŠ¨é…ç½®ä½ç½®</title>
      <link href="/posts/smvb2h/"/>
      <url>/posts/smvb2h/</url>
      
        <content type="html"><![CDATA[<h2 id="æ³¨å†Œè¡¨æ–¹å¼"><a href="#æ³¨å†Œè¡¨æ–¹å¼" class="headerlink" title="æ³¨å†Œè¡¨æ–¹å¼"></a>æ³¨å†Œè¡¨æ–¹å¼</h2><h4 id="ç³»ç»Ÿ"><a href="#ç³»ç»Ÿ" class="headerlink" title="ç³»ç»Ÿ"></a>ç³»ç»Ÿ</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run</span><br></pre></td></tr></table></figure><h4 id="ä¸ªäºº"><a href="#ä¸ªäºº" class="headerlink" title="ä¸ªäºº"></a>ä¸ªäºº</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run</span><br></pre></td></tr></table></figure><h4 id="åªè¿è¡Œä¸€æ¬¡"><a href="#åªè¿è¡Œä¸€æ¬¡" class="headerlink" title="åªè¿è¡Œä¸€æ¬¡"></a>åªè¿è¡Œä¸€æ¬¡</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce</span><br></pre></td></tr></table></figure><blockquote><p>æ–°å»ºå­—ç¬¦ä¸²å€¼ â€“ æ•°å€¼åç§°ä»»æ„,æ•°å€¼æ•°æ®ä¸ºè¦å¯åŠ¨çš„ç¨‹åºè·¯å¾„,å¦‚ C:\Program Files (x86)\WinHotKey\WinHotKey.exe<br>æˆ–è€…å‘½ä»¤è¡Œåˆ›å»º <code>reg add &quot;HKLM\Software\Microsoft\Windows\CurrentVersion\Run&quot; /f /v &quot;æ•°å€¼åç§°&quot; /t REG_SZ /d &quot;ç¨‹åºå¯åŠ¨è·¯å¾„&quot;</code></p></blockquote><h2 id="æ–‡ä»¶æ–¹å¼"><a href="#æ–‡ä»¶æ–¹å¼" class="headerlink" title="æ–‡ä»¶æ–¹å¼"></a>æ–‡ä»¶æ–¹å¼</h2><p>å¼€æœºè‡ªå¯åŠ¨ä¹Ÿä¼šæ˜¾ç¤ºåœ¨å¼€å§‹èœå•çš„ startup æ–‡ä»¶å¤¹é‡Œã€‚è¿™é‡Œå¯åŠ¨çš„è¯ï¼Œæ˜¯ä»¥ç”¨æˆ·èº«ä»½å¯åŠ¨ï¼Œå¦‚æœéœ€è¦ç®¡ç†å‘˜æƒé™çš„è½¯ä»¶ä¼šå¼¹çª—ã€‚</p><h4 id="ç³»ç»Ÿå¯åŠ¨æ–‡ä»¶å¤¹"><a href="#ç³»ç»Ÿå¯åŠ¨æ–‡ä»¶å¤¹" class="headerlink" title="ç³»ç»Ÿå¯åŠ¨æ–‡ä»¶å¤¹"></a>ç³»ç»Ÿå¯åŠ¨æ–‡ä»¶å¤¹</h4><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">C:\<span class="title">ProgramData</span>\<span class="title">Microsoft</span>\<span class="title">Windows</span>\<span class="title">Start</span> <span class="title">Menu</span>\<span class="title">Programs</span>\<span class="title">Startup</span></span></span><br></pre></td></tr></table></figure><h4 id="ä¸ªäººå¯åŠ¨æ–‡ä»¶å¤¹"><a href="#ä¸ªäººå¯åŠ¨æ–‡ä»¶å¤¹" class="headerlink" title="ä¸ªäººå¯åŠ¨æ–‡ä»¶å¤¹"></a>ä¸ªäººå¯åŠ¨æ–‡ä»¶å¤¹</h4><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">C:\<span class="title">Users</span>\ä½ çš„<span class="title">Windows</span>ç”¨æˆ·å\<span class="title">AppData</span>\<span class="title">Roaming</span>\<span class="title">Microsoft</span>\<span class="title">Windows</span>\<span class="title">Start</span> <span class="title">Menu</span>\<span class="title">Programs</span>\<span class="title">Startup</span></span></span><br></pre></td></tr></table></figure><blockquote><p>å¿«é€Ÿè¿›å…¥ startup æ–‡ä»¶å¤¹<br><code>win+r</code> è¾“å…¥ <code>shell:startup</code></p></blockquote><h2 id="æœåŠ¡æ–¹å¼"><a href="#æœåŠ¡æ–¹å¼" class="headerlink" title="æœåŠ¡æ–¹å¼"></a>æœåŠ¡æ–¹å¼</h2><p>å¾…å®Œå–„</p><h2 id="å®šæ—¶ä»»åŠ¡æ–¹å¼"><a href="#å®šæ—¶ä»»åŠ¡æ–¹å¼" class="headerlink" title="å®šæ—¶ä»»åŠ¡æ–¹å¼"></a>å®šæ—¶ä»»åŠ¡æ–¹å¼</h2><p>å®šæ—¶ä»»åŠ¡æ–¹å¼å¯åŠ¨æœ‰ä¸ªå¥½å¤„ï¼Œå°±æ˜¯å¯ä»¥ä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œï¼Œä¸ç”¨ç”¨æˆ·æˆæƒï¼Œä¹Ÿå°±æ˜¯ä¸ä¼š UAC å¼¹çª—ã€‚æŒ‰ç…§å¦‚å›¾é…ç½®å³å¯ã€‚</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202411191722190.png" alt="image.png|570"><br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202411191723758.png" alt="image.png|586"><br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202411191723472.png" alt="image.png"></p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202411191724674.png" alt="image.png"></p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202411191724869.png" alt="image.png"></p>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Windowså¸¸è§æ³¨å†Œè¡¨ä½ç½®</title>
      <link href="/posts/smvadg/"/>
      <url>/posts/smvadg/</url>
      
        <content type="html"><![CDATA[<h2 id="oem-ä¿¡æ¯"><a href="#oem-ä¿¡æ¯" class="headerlink" title="oem ä¿¡æ¯"></a>oem ä¿¡æ¯</h2><h3 id="æ·»åŠ -oem-ä¿¡æ¯"><a href="#æ·»åŠ -oem-ä¿¡æ¯" class="headerlink" title="æ·»åŠ  oem ä¿¡æ¯"></a>æ·»åŠ  oem ä¿¡æ¯</h3><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line">%<span class="number">1</span> mshta vbscript:CreateObject(&quot;Shell.Application&quot;).ShellExecute(&quot;<span class="built_in">cmd</span>.exe&quot;,&quot;/c %~s0 ::&quot;,&quot;&quot;,&quot;runas&quot;,<span class="number">1</span>)(window.close)&amp;&amp;<span class="keyword">exit</span></span><br><span class="line"><span class="built_in">cd</span> /d &quot;%~dp0&quot;</span><br><span class="line"></span><br><span class="line"><span class="built_in">copy</span> logo.bmp <span class="variable">%windir%</span>\media\logo.bmp</span><br><span class="line"></span><br><span class="line">reg add &quot;HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\OEMInformation&quot; /f /v &quot;SupportURL&quot; /t REG_SZ /d &quot;http://blog.sina.com.cn/iuxt&quot;</span><br><span class="line">reg add &quot;HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\OEMInformation&quot; /f /v &quot;Model&quot; /t REG_SZ /d &quot;iuxt&quot;</span><br><span class="line">reg add &quot;HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\OEMInformation&quot; /f /v &quot;SupportHours&quot; /t REG_SZ /d &quot;<span class="number">8</span>:<span class="number">00</span>-<span class="number">22</span>:<span class="number">00</span>&quot;</span><br><span class="line">reg add &quot;HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\OEMInformation&quot; /f /v &quot;SupportPhone&quot; /t REG_SZ /d &quot;<span class="number">17621268822</span>&quot;</span><br><span class="line">reg add &quot;HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\OEMInformation&quot; /f /v &quot;Logo&quot; /t REG_SZ /d &quot;C:\Windows\Media\logo.bmp&quot;</span><br><span class="line">reg add &quot;HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\OEMInformation&quot; /f /v &quot;Manufacturer&quot; /t REG_SZ /d &quot;å¼ ç†å¤&quot;</span><br></pre></td></tr></table></figure><h3 id="åˆ é™¤-OEM-ä¿¡æ¯"><a href="#åˆ é™¤-OEM-ä¿¡æ¯" class="headerlink" title="åˆ é™¤ OEM ä¿¡æ¯"></a>åˆ é™¤ OEM ä¿¡æ¯</h3><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reg delete &quot;HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\OEMInformation&quot; /f</span><br></pre></td></tr></table></figure><h2 id="ä¾§è¾¹æ çš„ç½‘ç›˜é“¾æ¥ï¼ˆOneDrive-ç­‰ï¼‰"><a href="#ä¾§è¾¹æ çš„ç½‘ç›˜é“¾æ¥ï¼ˆOneDrive-ç­‰ï¼‰" class="headerlink" title="ä¾§è¾¹æ çš„ç½‘ç›˜é“¾æ¥ï¼ˆOneDrive ç­‰ï¼‰"></a>ä¾§è¾¹æ çš„ç½‘ç›˜é“¾æ¥ï¼ˆOneDrive ç­‰ï¼‰</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Desktop\NameSpace</span><br></pre></td></tr></table></figure><h2 id="å¼€æœºè‡ªå¯åŠ¨æ³¨å†Œè¡¨é…ç½®"><a href="#å¼€æœºè‡ªå¯åŠ¨æ³¨å†Œè¡¨é…ç½®" class="headerlink" title="å¼€æœºè‡ªå¯åŠ¨æ³¨å†Œè¡¨é…ç½®"></a>å¼€æœºè‡ªå¯åŠ¨æ³¨å†Œè¡¨é…ç½®</h2><h4 id="ç³»ç»Ÿ"><a href="#ç³»ç»Ÿ" class="headerlink" title="ç³»ç»Ÿ"></a>ç³»ç»Ÿ</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run</span><br></pre></td></tr></table></figure><h4 id="ä¸ªäºº"><a href="#ä¸ªäºº" class="headerlink" title="ä¸ªäºº"></a>ä¸ªäºº</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run</span><br></pre></td></tr></table></figure><h4 id="åªè¿è¡Œä¸€æ¬¡"><a href="#åªè¿è¡Œä¸€æ¬¡" class="headerlink" title="åªè¿è¡Œä¸€æ¬¡"></a>åªè¿è¡Œä¸€æ¬¡</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce</span><br></pre></td></tr></table></figure><blockquote><p>æ–°å»ºå­—ç¬¦ä¸²å€¼ â€“ æ•°å€¼åç§°ä»»æ„,æ•°å€¼æ•°æ®ä¸ºè¦å¯åŠ¨çš„ç¨‹åºè·¯å¾„,å¦‚ C:\Program Files (x86)\WinHotKey\WinHotKey.exe<br>æˆ–è€…å‘½ä»¤è¡Œåˆ›å»º <code>reg add &quot;HKLM\Software\Microsoft\Windows\CurrentVersion\Run&quot; /f /v &quot;æ•°å€¼åç§°&quot; /t REG_SZ /d &quot;ç¨‹åºå¯åŠ¨è·¯å¾„&quot;</code></p></blockquote><h2 id="ç™»å½•ç•Œé¢ä¸æ˜¾ç¤ºç”¨æˆ·"><a href="#ç™»å½•ç•Œé¢ä¸æ˜¾ç¤ºç”¨æˆ·" class="headerlink" title="ç™»å½•ç•Œé¢ä¸æ˜¾ç¤ºç”¨æˆ·"></a>ç™»å½•ç•Œé¢ä¸æ˜¾ç¤ºç”¨æˆ·</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\SpecialAccounts\UserList]</span><br><span class="line">&quot;administrator&quot;=dword:00000000</span><br></pre></td></tr></table></figure><h2 id="IE-ä¸»é¡µ"><a href="#IE-ä¸»é¡µ" class="headerlink" title="IE ä¸»é¡µ"></a>IE ä¸»é¡µ</h2><h3 id="ä¸ªäººä¸»é¡µ"><a href="#ä¸ªäººä¸»é¡µ" class="headerlink" title="ä¸ªäººä¸»é¡µ"></a>ä¸ªäººä¸»é¡µ</h3><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reg add &quot;HKEY_CURRENT_USER\Software\Microsoft\Internet Explorer\Main&quot; /v &quot;<span class="built_in">Start</span> Page&quot; /t reg_sz /d http://www.<span class="number">2345</span>.com/?k393991732 /f</span><br></pre></td></tr></table></figure><h3 id="ç³»ç»Ÿä¸»é¡µ"><a href="#ç³»ç»Ÿä¸»é¡µ" class="headerlink" title="ç³»ç»Ÿä¸»é¡µ"></a>ç³»ç»Ÿä¸»é¡µ</h3><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reg add &quot;HKU\.DEFAULT\Software\Microsoft\Internet Explorer\Main&quot; /f /v &quot;<span class="built_in">Start</span> Page&quot; /t REG_SZ /d &quot;http://www.<span class="number">2345</span>.com/?k393991732&quot;</span><br></pre></td></tr></table></figure><h3 id="é»˜è®¤ä¸»é¡µ"><a href="#é»˜è®¤ä¸»é¡µ" class="headerlink" title="é»˜è®¤ä¸»é¡µ"></a>é»˜è®¤ä¸»é¡µ</h3><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reg add &quot;HKEY_CURRENT_USER\Software\Microsoft\Internet Explorer\Main&quot; /v &quot;Default_Page_URL&quot; /t reg_sz /d http://www.<span class="number">2345</span>.com/?k393991732 /f</span><br></pre></td></tr></table></figure><h2 id="Windows-Defender"><a href="#Windows-Defender" class="headerlink" title="Windows Defender"></a>Windows Defender</h2><p>å…³é—­ Windows Defender</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reg add &quot;HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows Defender&quot; /v &quot;DisableAntiSpyware&quot; /d <span class="number">1</span> /t REG_DWORD /f</span><br></pre></td></tr></table></figure><blockquote><p>è¿™ç§æ–¹æ³•å’Œç›´æ¥ä¿®æ”¹ç»„ç­–ç•¥æ˜¯ä¸€æ ·çš„ï¼Œå®¶åº­ç‰ˆä¸æ”¯æŒç»„ç­–ç•¥å¯ä»¥ä½¿ç”¨è¿™ç§æ–¹å¼</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Prometheusçš„ç¬æ—¶å‘é‡(Instant vector)å’ŒåŒºé—´å‘é‡(Range vector)</title>
      <link href="/posts/smrno6/"/>
      <url>/posts/smrno6/</url>
      
        <content type="html"><![CDATA[<p>åœ¨ Prometheus çš„è¡¨è¾¾å¼è¯­è¨€ä¸­ï¼Œè¡¨è¾¾å¼æˆ–å­è¡¨è¾¾å¼åŒ…æ‹¬ä»¥ä¸‹å››ç§ç±»å‹ä¹‹ä¸€ï¼š</p><ul><li>ç¬æ—¶å‘é‡ï¼ˆInstant vectorï¼‰ ï¼š ä¸€ç»„æ—¶é—´åºåˆ—ï¼Œæ¯ä¸ªæ—¶é—´åºåˆ—åŒ…å«å•ä¸ªæ ·æœ¬ï¼Œå®ƒä»¬å…±äº«ç›¸åŒçš„æ—¶é—´æˆ³ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¡¨è¾¾å¼çš„è¿”å›å€¼ä¸­åªä¼šåŒ…å«è¯¥æ—¶é—´åºåˆ—ä¸­çš„æœ€æ–°çš„ä¸€ä¸ªæ ·æœ¬å€¼ã€‚è€Œç›¸åº”çš„è¿™æ ·çš„è¡¨è¾¾å¼ç§°ä¹‹ä¸ºç¬æ—¶å‘é‡è¡¨è¾¾å¼ã€‚</li><li>åŒºé—´å‘é‡ï¼ˆRange vectorï¼‰ ï¼š ä¸€ç»„æ—¶é—´åºåˆ—ï¼Œæ¯ä¸ªæ—¶é—´åºåˆ—åŒ…å«ä¸€æ®µæ—¶é—´èŒƒå›´å†…çš„æ ·æœ¬æ•°æ®ã€‚</li><li>æ ‡é‡ï¼ˆScalarï¼‰ ï¼š ä¸€ä¸ªæµ®ç‚¹å‹çš„æ•°æ®å€¼ã€‚</li><li>å­—ç¬¦ä¸²ï¼ˆStringï¼‰ ï¼š ä¸€ä¸ªç®€å•çš„å­—ç¬¦ä¸²å€¼ã€‚</li></ul><h2 id="ç¬æ—¶å‘é‡"><a href="#ç¬æ—¶å‘é‡" class="headerlink" title="ç¬æ—¶å‘é‡"></a>ç¬æ—¶å‘é‡</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http_requests_total&#123;job=<span class="string">&quot;prometheus&quot;</span>&#125;</span><br></pre></td></tr></table></figure><p>æ¯”å¦‚è¿™æ ·çš„ï¼Œå–å€¼æ˜¯ä¸€ä¸ªå€¼</p><h2 id="åŒºé—´å‘é‡"><a href="#åŒºé—´å‘é‡" class="headerlink" title="åŒºé—´å‘é‡"></a>åŒºé—´å‘é‡</h2><p>æŒ‡çš„æ˜¯æŒ‡å®šæ—¶é—´æ®µçš„æ‰€æœ‰ç¬æ—¶å‘é‡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http_requests_total&#123;job=<span class="string">&quot;prometheus&quot;</span>&#125;[5m]</span><br></pre></td></tr></table></figure><h2 id="PromQL-èšåˆæ“ä½œ"><a href="#PromQL-èšåˆæ“ä½œ" class="headerlink" title="PromQL èšåˆæ“ä½œ"></a>PromQL èšåˆæ“ä½œ</h2><p>ä¾‹å¦‚ï¼šsumï¼Œminï¼Œmaxï¼Œcount ç­‰èšåˆå‡½æ•°ï¼Œåªèƒ½ä½œç”¨äºç¬æ—¶å‘é‡ä¸Šã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿™æ˜¯é”™è¯¯çš„ï¼Œå› ä¸ºcountåªèƒ½ä½œç”¨äºç¬æ—¶å‘é‡ï¼Œè€Œè¿™ä¸ªæŸ¥è¯¢æœ¬èº«è¿”å›çš„æ˜¯åŒºé—´å‘é‡</span></span><br><span class="line">count(http_requests_total&#123;job=<span class="string">&quot;prometheus&quot;</span>&#125;[5m])</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ­£ç¡®çš„å¦‚ä¸‹</span></span><br><span class="line">count(http_requests_total&#123;job=<span class="string">&quot;prometheus&quot;</span>&#125;)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç›‘æ§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> prometheus </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¿«é€Ÿéƒ¨ç½²å•èŠ‚ç‚¹kafka</title>
      <link href="/posts/slhl3q/"/>
      <url>/posts/slhl3q/</url>
      
        <content type="html"><![CDATA[<p>å¦‚æœéœ€è¦é›†ç¾¤éƒ¨ç½²çš„æ–‡æ¡£ä½ å¯ä»¥åœ¨ç«™å†…æœæœï¼Œä¹‹å‰å†™è¿‡ã€‚</p><p>å•èŠ‚ç‚¹éƒ¨ç½²ï¼Œä¸è€ƒè™‘é«˜å¯ç”¨æ€§ï¼Œåªæ±‚å¿«é€Ÿæ­å»ºå‡ºç¯å¢ƒï¼Œä¸€èˆ¬éƒ½æ˜¯è‡ªå·±å¼€å‘æˆ–è€…è¿ç»´åšæµ‹è¯•ä½¿ç”¨ã€‚æˆ–è€…ä¸šåŠ¡çš„æµ‹è¯•ç¯å¢ƒä¸ºäº†èŠ‚çœæœåŠ¡å™¨èµ„æºé‡‡å–çš„æ–¹æ¡ˆã€‚ä¸è¿‡æˆ‘ä¸ä¸€æ ·ï¼Œæˆ‘ä»¬æµ‹è¯•ç¯å¢ƒèµ„æºå……è¶³ï¼Œæˆ‘åªæ˜¯å•çº¯çš„æ‡’ã€‚</p><h2 id="ç¬¬ä¸€æ­¥-å®‰è£…-Docker"><a href="#ç¬¬ä¸€æ­¥-å®‰è£…-Docker" class="headerlink" title="ç¬¬ä¸€æ­¥ å®‰è£… Docker"></a>ç¬¬ä¸€æ­¥ å®‰è£… Docker</h2><p>éƒ¨ç½²æ˜¯åŸºäº docker æ¥éƒ¨ç½²çš„ï¼Œæ‰€ä»¥è¦å…ˆå®‰è£… dockerï¼Œå®‰è£… docker çš„è¿‡ç¨‹å¯ä»¥çœ‹è¿™ä¸ªæ–‡æ¡£ï¼š<a href="/posts/5e168f7e">å¿«é€Ÿæ­å»ºç¯å¢ƒè®°å½•</a></p><h2 id="ç¬¬äºŒæ­¥-é€‰æ‹©é•œåƒ"><a href="#ç¬¬äºŒæ­¥-é€‰æ‹©é•œåƒ" class="headerlink" title="ç¬¬äºŒæ­¥ é€‰æ‹©é•œåƒ"></a>ç¬¬äºŒæ­¥ é€‰æ‹©é•œåƒ</h2><p>æ‰“å¼€ docker é•œåƒä»“åº“ <code>https://hub.docker.com</code> æ‰¾äº†æ‰¾ï¼Œ æŒ‰ç…§ä¸‹è½½é‡æ’åºï¼Œæœ‰ä»¥ä¸‹å‡ ç§ï¼Œæˆ‘é€‰æ‹© bitnami æ‰“åŒ…çš„ kafka</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202410171116643.png" alt="image.png|1048"></p><h2 id="ç¬¬ä¸‰æ­¥-ç¼–å†™å¯åŠ¨è„šæœ¬"><a href="#ç¬¬ä¸‰æ­¥-ç¼–å†™å¯åŠ¨è„šæœ¬" class="headerlink" title="ç¬¬ä¸‰æ­¥ ç¼–å†™å¯åŠ¨è„šæœ¬"></a>ç¬¬ä¸‰æ­¥ ç¼–å†™å¯åŠ¨è„šæœ¬</h2><p>æˆ‘ä¸ªäººä¸å–œæ¬¢ docker-compose ï¼Œæ€»è§‰å¾—è¿™ä¸ªä¸œè¥¿ä¸ä¼¦ä¸ç±»çš„ï¼Œè®ºçµæ´»ä¸å¦‚ bash è„šæœ¬ï¼Œè®ºä¸“ä¸šä¸å¦‚ Kubernetes ç”šè‡³ Docker Swarmï¼Œè¿˜ä¸å¦‚è‡ªå·±å†™è„šæœ¬æ¥åšã€‚</p><p>éœ€è¦åˆ›å»ºä¸€ä¸ª docker network ï¼Œé»˜è®¤çš„ bridge ç½‘ç»œä¸èƒ½é€šè¿‡ dns åå­—æ‰¾åˆ°å¯¹åº”çš„å®¹å™¨ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> kafka-data</span><br><span class="line">sudo <span class="built_in">chown</span> -R 1001:1001 kafka-data</span><br><span class="line"></span><br><span class="line">sudo docker network create ops</span><br><span class="line"></span><br><span class="line">sudo docker run -d --name kafka-server --hostname kafka-server \</span><br><span class="line">    --network ops \</span><br><span class="line">    -e KAFKA_CFG_NODE_ID=0 \</span><br><span class="line">    -e KAFKA_CFG_PROCESS_ROLES=controller,broker \</span><br><span class="line">    -e KAFKA_CFG_LISTENERS=PLAINTEXT://:9092,CONTROLLER://:9093 \</span><br><span class="line">    -e KAFKA_CFG_LISTENER_SECURITY_PROTOCOL_MAP=CONTROLLER:PLAINTEXT,PLAINTEXT:PLAINTEXT \</span><br><span class="line">    -e KAFKA_CFG_CONTROLLER_QUORUM_VOTERS=0@kafka-server:9093 \</span><br><span class="line">    -e KAFKA_CFG_CONTROLLER_LISTENER_NAMES=CONTROLLER \</span><br><span class="line">    -e KAFKA_CFG_AUTO_CREATE_TOPICS_ENABLE=<span class="literal">true</span> \</span><br><span class="line">    -v ./kafka-data:/bitnami/kafka \</span><br><span class="line">    -p 9092:9092 \</span><br><span class="line">    -p 9093:9093 \</span><br><span class="line">    bitnami/kafka:3.8.0</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼š</p><p>kafka çš„å¯åŠ¨ç”¨æˆ· id æ˜¯ 1001ï¼Œæ‰€ä»¥éœ€è¦ç»™ kafka-data ç›®å½•æˆæƒï¼Œä¸ç„¶å¯èƒ½ä¼šä¸èƒ½å†™å…¥æŒ‚è½½çš„ç›®å½•ã€‚</p><h2 id="ç¬¬å››æ­¥-ä½¿ç”¨"><a href="#ç¬¬å››æ­¥-ä½¿ç”¨" class="headerlink" title="ç¬¬å››æ­¥ ä½¿ç”¨"></a>ç¬¬å››æ­¥ ä½¿ç”¨</h2><h3 id="æ§åˆ¶å°ç”Ÿäº§"><a href="#æ§åˆ¶å°ç”Ÿäº§" class="headerlink" title="æ§åˆ¶å°ç”Ÿäº§"></a>æ§åˆ¶å°ç”Ÿäº§</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --network ops --<span class="built_in">rm</span> bitnami/kafka:3.8.0 kafka-console-producer.sh --producer.config /opt/bitnami/kafka/config/producer.properties --bootstrap-server kafka-server:9092 --topic iuxt_test</span><br></pre></td></tr></table></figure><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202410171408280.png" alt="image.png"></p><h3 id="æ§åˆ¶å°æ¶ˆè´¹"><a href="#æ§åˆ¶å°æ¶ˆè´¹" class="headerlink" title="æ§åˆ¶å°æ¶ˆè´¹"></a>æ§åˆ¶å°æ¶ˆè´¹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --network ops --<span class="built_in">rm</span> bitnami/kafka:3.8.0 kafka-console-consumer.sh --consumer.config /opt/bitnami/kafka/config/consumer.properties --bootstrap-server kafka-server:9092 --topic iuxt_test --from-beginning</span><br></pre></td></tr></table></figure><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202410171409368.png" alt="image.png"></p><p>å…¶ä»–å‘½ä»¤æŸ¥çœ‹ <a href="/posts/12ab226e">Kafkaå¸¸ç”¨æ“ä½œè®°å½•</a></p>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
            <tag> Kafka </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>yamlå¤šè¡Œæ–‡æœ¬çš„å†™æ³•å’ŒåŒºåˆ«</title>
      <link href="/posts/sldz99/"/>
      <url>/posts/sldz99/</url>
      
        <content type="html"><![CDATA[<p>ç›´æ¥çœ‹æ•ˆæœï¼ˆ<code>pip install pyyaml</code>ï¼‰ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> yaml</span><br><span class="line"></span><br><span class="line">yaml_data = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">example1: |</span></span><br><span class="line"><span class="string">  This is line one.</span></span><br><span class="line"><span class="string">  This is line two.</span></span><br><span class="line"><span class="string">example2: |-</span></span><br><span class="line"><span class="string">  This is line one.</span></span><br><span class="line"><span class="string">  This is line two.</span></span><br><span class="line"><span class="string">example3: &gt;-</span></span><br><span class="line"><span class="string">  This is line one.</span></span><br><span class="line"><span class="string">  This is line two.</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å°† YAML æ•°æ®è§£æä¸º Python å¯¹è±¡</span></span><br><span class="line">data = yaml.safe_load(yaml_data)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¿é—®ç‰¹å®šå­—æ®µ</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;example1: <span class="subst">&#123;data[<span class="string">&#x27;example1&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;example2: <span class="subst">&#123;data[<span class="string">&#x27;example2&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;example3: <span class="subst">&#123;data[<span class="string">&#x27;example3&#x27;</span>]&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">example1: This is line one.</span><br><span class="line">This is line two.</span><br><span class="line"></span><br><span class="line">example2: This is line one.</span><br><span class="line">This is line two.</span><br><span class="line">example3: This is line one. This is line two.</span><br></pre></td></tr></table></figure><h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>åœ¨ YAML ä¸­ï¼Œ<code>|</code>ã€<code>|-</code> å’Œ <code>&gt;-</code> éƒ½ç”¨äºå®šä¹‰å¤šè¡Œå­—ç¬¦ä¸²ï¼Œä½†å®ƒä»¬çš„å¤„ç†æ–¹å¼ä¸åŒï¼š</p><ol><li><p><code>|</code></p><ul><li>ä¿ç•™æ¢è¡Œç¬¦ã€‚</li><li>ç”Ÿæˆçš„å­—ç¬¦ä¸²åœ¨æ¯è¡Œçš„æœ«å°¾ä¿ç•™æ¢è¡Œç¬¦ã€‚</li></ul></li><li><p><code>|-</code></p><ul><li>ç±»ä¼¼äº <code>|</code>ï¼Œä½†å»æ‰æœ€åçš„æ¢è¡Œç¬¦ã€‚</li><li>ç»“æœä¸­çš„æœ€åä¸€è¡Œä¸ä¼šæœ‰æ¢è¡Œç¬¦ã€‚</li></ul></li><li><p><code>&gt;-</code></p><ul><li>å°†æ¢è¡Œç¬¦è½¬æ¢ä¸ºç©ºæ ¼ã€‚</li><li>ç»“æœä¸­çš„æ‰€æœ‰è¡Œä¼šè¢«è¿æ¥æˆä¸€è¡Œï¼Œä¸­é—´ç”¨ç©ºæ ¼åˆ†éš”ï¼Œæœ€åä¸€è¡Œä¹Ÿæ²¡æœ‰æ¢è¡Œç¬¦ã€‚</li></ul></li></ol>]]></content>
      
      
      <categories>
          
          <category> å¼€å‘ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Grafana æ¥å…¥ LDAP è®¤è¯</title>
      <link href="/posts/sl8dop/"/>
      <url>/posts/sl8dop/</url>
      
        <content type="html"><![CDATA[<p><code>Grafana</code> æ˜¯ä¸€ä¸ªéå¸¸å¥½ç”¨çš„å±•ç¤ºæ•°æ®è½¯ä»¶ï¼Œæˆ‘ä¸€ç›´ä»¥ä¸ºå¯ä»¥ç›´æ¥åœ¨è®¾ç½®é‡Œå¢åŠ  ldap é…ç½®ï¼Œæ²¡æƒ³åˆ°å•Šæ²¡æƒ³åˆ° å¿…é¡»è¦ä¿®æ”¹é…ç½®æ–‡ä»¶æ‰èƒ½æ¥å…¥åˆ° <code>LDAP</code>ï¼Œè¿˜æ˜¯è®°å½•ä¸€ä¸‹å§ï¼Œå…å¾—ä¸‹æ¬¡éƒ¨ç½²æµªè´¹æ—¶é—´ã€‚</p><p>æˆ‘æ˜¯åœ¨ <code>Kubernetes</code> ä¸­éƒ¨ç½²çš„ï¼Œæ•°æ®å­˜å‚¨ç”¨çš„æ˜¯ <code>MySQL</code>ï¼Œæ‰€ä»¥ <code>Grafana</code> æœ¬èº«å¯ä»¥å½“ä½œä¸€ä¸ªæ— çŠ¶æ€æœåŠ¡æ¥çœ‹å¾…ã€‚ä¹Ÿå¯ä»¥ä¸åšæ•°æ®æŒä¹…åŒ–ã€‚</p><h2 id="å…ˆåˆ›å»º-ldap-é…ç½®æ–‡ä»¶"><a href="#å…ˆåˆ›å»º-ldap-é…ç½®æ–‡ä»¶" class="headerlink" title="å…ˆåˆ›å»º ldap é…ç½®æ–‡ä»¶"></a>å…ˆåˆ›å»º ldap é…ç½®æ–‡ä»¶</h2><p>è¿™é‡ŒåŒ…æ‹¬ ldap æ•°æ®çš„æ˜ å°„å…³ç³»ï¼Œå¯ä»¥è‡ªå·±å°è¯•ä¿®æ”¹è°ƒæ•´ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">grafana-ldap-config</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">ops</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">ldap.toml:</span> <span class="string">|</span></span><br><span class="line"><span class="string">    [[servers]]</span></span><br><span class="line"><span class="string">    host = &quot;10.0.0.11&quot;</span></span><br><span class="line"><span class="string">    port = 389</span></span><br><span class="line"><span class="string">    use_ssl = false</span></span><br><span class="line"><span class="string">    start_tls = false</span></span><br><span class="line"><span class="string">    ssl_skip_verify = false</span></span><br><span class="line"><span class="string">    bind_dn = &quot;cn=admin,dc=i,dc=com&quot;</span></span><br><span class="line"><span class="string">    bind_password = &quot;password&quot;</span></span><br><span class="line"><span class="string">    search_filter = &quot;(uid=%s)&quot;</span></span><br><span class="line"><span class="string">    search_base_dns = [&quot;dc=i,dc=com&quot;]</span></span><br><span class="line"><span class="string">    [servers.attributes]</span></span><br><span class="line"><span class="string">    member_of = &quot;memberOf&quot;</span></span><br><span class="line"><span class="string">    email =  &quot;uid&quot;</span></span><br><span class="line"><span class="string">    name = &quot;cn&quot;</span></span><br><span class="line"><span class="string">    username = &quot;uid&quot;</span></span><br></pre></td></tr></table></figure><h2 id="åˆ›å»º-deployment-å’Œ-service"><a href="#åˆ›å»º-deployment-å’Œ-service" class="headerlink" title="åˆ›å»º deployment å’Œ service"></a>åˆ›å»º deployment å’Œ service</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">ops</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">grafana</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">grafana</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">grafana</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">grafana</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">securityContext:</span></span><br><span class="line">        <span class="attr">fsGroup:</span> <span class="number">472</span></span><br><span class="line">        <span class="attr">supplementalGroups:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="number">0</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">ldap-config</span></span><br><span class="line">          <span class="attr">configMap:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">grafana-ldap-config</span></span><br><span class="line">            <span class="attr">defaultMode:</span> <span class="number">420</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">grafana</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">registry.cn-hangzhou.aliyuncs.com/yaml/images:grafana-11.2.2-ubuntu</span></span><br><span class="line">          <span class="attr">env:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">GF_AUTH_BASIC_ENABLED</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&#x27;true&#x27;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">GF_AUTH_ANONYMOUS_ENABLED</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&#x27;false&#x27;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">GF_AUTH_ANONYMOUS_ORG_ROLE</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">Admin</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">GF_DASHBOARDS_JSON_ENABLED</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&#x27;true&#x27;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">GF_SECURITY_ADMIN_USER</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">admin</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">GF_SECURITY_ADMIN_PASSWORD</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">admin</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">GF_DATABASE_TYPE</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">mysql</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">GF_DATABASE_HOST</span></span><br><span class="line">              <span class="attr">value:</span> <span class="number">10.0</span><span class="number">.0</span><span class="number">.65</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">GF_DATABASE_PORT</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&#x27;3306&#x27;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">GF_DATABASE_USER</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">root</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">GF_DATABASE_PASSWORD</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">password</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">GF_DATABASE_NAME</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">grafana</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">GF_AUTH_LDAP_ENABLED</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&#x27;true&#x27;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">GF_AUTH_LDAP_ALLOW_SIGN_UP</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&#x27;true&#x27;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">GF_AUTH_LDAP_CONFIG_FILE</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">/etc/grafana/ldap.toml</span></span><br><span class="line">          <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">          <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">3000</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">http-grafana</span></span><br><span class="line">              <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">          <span class="attr">readinessProbe:</span></span><br><span class="line">            <span class="attr">failureThreshold:</span> <span class="number">3</span></span><br><span class="line">            <span class="attr">httpGet:</span></span><br><span class="line">              <span class="attr">path:</span> <span class="string">/robots.txt</span></span><br><span class="line">              <span class="attr">port:</span> <span class="number">3000</span></span><br><span class="line">              <span class="attr">scheme:</span> <span class="string">HTTP</span></span><br><span class="line">            <span class="attr">initialDelaySeconds:</span> <span class="number">10</span></span><br><span class="line">            <span class="attr">periodSeconds:</span> <span class="number">30</span></span><br><span class="line">            <span class="attr">successThreshold:</span> <span class="number">1</span></span><br><span class="line">            <span class="attr">timeoutSeconds:</span> <span class="number">2</span></span><br><span class="line">          <span class="attr">livenessProbe:</span></span><br><span class="line">            <span class="attr">failureThreshold:</span> <span class="number">3</span></span><br><span class="line">            <span class="attr">initialDelaySeconds:</span> <span class="number">30</span></span><br><span class="line">            <span class="attr">periodSeconds:</span> <span class="number">10</span></span><br><span class="line">            <span class="attr">successThreshold:</span> <span class="number">1</span></span><br><span class="line">            <span class="attr">tcpSocket:</span></span><br><span class="line">              <span class="attr">port:</span> <span class="number">3000</span></span><br><span class="line">            <span class="attr">timeoutSeconds:</span> <span class="number">1</span></span><br><span class="line">          <span class="attr">resources:</span></span><br><span class="line">            <span class="attr">requests:</span></span><br><span class="line">              <span class="attr">cpu:</span> <span class="string">250m</span></span><br><span class="line">              <span class="attr">memory:</span> <span class="string">750Mi</span></span><br><span class="line">          <span class="attr">volumeMounts:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">ldap-config</span></span><br><span class="line">              <span class="attr">mountPath:</span> <span class="string">/etc/grafana/ldap.toml</span></span><br><span class="line">              <span class="attr">subPath:</span> <span class="string">ldap.toml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">grafana</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">ops</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="comment"># type: NodePort</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">3000</span></span><br><span class="line">      <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="string">http-grafana</span></span><br><span class="line">      <span class="comment"># nodePort: 30030</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">grafana</span></span><br><span class="line">  <span class="attr">sessionAffinity:</span> <span class="string">None</span></span><br></pre></td></tr></table></figure><h2 id="åˆ›å»º-ingress"><a href="#åˆ›å»º-ingress" class="headerlink" title="åˆ›å»º ingress"></a>åˆ›å»º ingress</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">grafana</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">ops</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="comment"># kubernetes.io/ingress.class: &quot;nginx&quot;</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/ssl-redirect:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ingressClassName:</span> <span class="string">internet</span></span><br><span class="line">  <span class="attr">tls:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">hosts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">grafana.i.com</span></span><br><span class="line">    <span class="attr">secretName:</span> <span class="string">i-com</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">grafana.i.com</span></span><br><span class="line">    <span class="attr">http:</span></span><br><span class="line">      <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/</span></span><br><span class="line">        <span class="attr">pathType:</span> <span class="string">Prefix</span></span><br><span class="line">        <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">service:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">grafana</span></span><br><span class="line">            <span class="attr">port:</span></span><br><span class="line">              <span class="attr">number:</span> <span class="number">3000</span></span><br></pre></td></tr></table></figure><h2 id="éªŒè¯-LADP-å­—æ®µé…ç½®"><a href="#éªŒè¯-LADP-å­—æ®µé…ç½®" class="headerlink" title="éªŒè¯ LADP å­—æ®µé…ç½®"></a>éªŒè¯ LADP å­—æ®µé…ç½®</h2><p>é…ç½®å¥½ä»¥åï¼Œä½¿ç”¨é»˜è®¤ç®¡ç†å‘˜è´¦æˆ·ç™»å½•ï¼š é»˜è®¤è´¦å·å¯†ç ï¼š<code>admin/admin</code> ç™»å½•ä»¥åï¼Œåœ¨ <code>ç®¡ç†</code> â€“ <code>èº«ä»½éªŒè¯</code> â€“ <code>LDAP</code> é‡ŒéªŒè¯å­—æ®µçš„æ˜ å°„æƒ…å†µã€‚<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202410121607340.png" alt="image.png"></p><h2 id="LADP-ç”¨æˆ·æƒé™è°ƒæ•´"><a href="#LADP-ç”¨æˆ·æƒé™è°ƒæ•´" class="headerlink" title="LADP ç”¨æˆ·æƒé™è°ƒæ•´"></a>LADP ç”¨æˆ·æƒé™è°ƒæ•´</h2><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæƒé™æ˜¯ viewerï¼Œåªå¯ä»¥æŸ¥çœ‹ï¼Œä¸èƒ½ç¼–è¾‘ï¼Œç³»ç»Ÿåå°ä¹Ÿä¸èƒ½ä¿®æ”¹æƒé™ã€‚å¦‚å›¾ï¼š<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202410121551118.png" alt="image.png"></p><p>éœ€è¦åˆ° ldap æ¥é…ç½®æƒé™å¹¶åŒæ­¥åˆ° Grafanaï¼Œæˆ‘ä»¬åªå¸Œæœ› ldap åšä¸ªè½»é‡çš„ç”¨æˆ·æ•°æ®åº“ï¼Œä¸å¸Œæœ›èµ‹äºˆ ldap å¤ªå¤šçš„åŠŸèƒ½ï¼Œè¿™é‡Œæˆ‘ä»¬ç›´æ¥ä¿®æ”¹æ•°æ®åº“æ¥ä¿®æ”¹æƒé™ã€‚</p><ol><li>å…ˆåˆ° user è¡¨æŸ¥è¯¢ç”¨æˆ· id<br> <img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202410121559413.png" alt="image.png"></li><li>å†åˆ° org_user è¡¨ä¸­ä¿®æ”¹ role å­—æ®µä¸º Admin å³å¯èµ‹äºˆè¯¥ç”¨æˆ· Admin æƒé™<br> <img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202410121600773.png" alt="image.png"></li></ol>]]></content>
      
      
      <categories>
          
          <category> ç›‘æ§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> OpenLDAP </tag>
            
            <tag> grafana </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç”¨Prometheuså¯¹nacosé›†ç¾¤è¿›è¡Œç›‘æ§</title>
      <link href="/posts/skma0p/"/>
      <url>/posts/skma0p/</url>
      
        <content type="html"><![CDATA[<p>å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š<a href="https://nacos.io/zh-cn/docs/monitor-guide.html">https://nacos.io/zh-cn/docs/monitor-guide.html</a></p><p>æš´éœ² <code>metrics</code> æ•°æ® éœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œ<code>spring boot</code> æ”¯æŒé€šè¿‡ç¯å¢ƒå˜é‡æ¥ä¿®æ”¹ç³»ç»Ÿé…ç½®ï¼Œåœ¨ <code>Kubernets</code> ç¯å¢ƒä¸‹ï¼Œå¯ä»¥é€šè¿‡å¢åŠ ç¯å¢ƒå˜é‡çš„å½¢å¼æ¥æš´éœ² <code>metrics</code> æ•°æ®ã€‚</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">kind:</span> <span class="string">StatefulSet</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nacos</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">public</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">nacos</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">nacos</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nacos</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">nacos/nacos-server:v2.1.0</span></span><br><span class="line">          <span class="attr">env:</span></span><br><span class="line"><span class="string">...</span></span><br><span class="line">            <span class="comment"># å¢åŠ è¿™ä¸ªç¯å¢ƒå˜é‡</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">management.endpoints.web.exposure.include</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&#x27;*&#x27;</span></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure><p>å¢åŠ ç¯å¢ƒå˜é‡åï¼Œnacos æœåŠ¡ä¼šé‡å¯ï¼Œé‡å¯åè¿›å…¥ Podï¼Œæ‰§è¡Œå‘½ä»¤æŸ¥çœ‹æ˜¯å¦æœ‰ metrics æ•°æ®ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl localhost:8848/nacos/actuator/prometheus</span><br></pre></td></tr></table></figure><h2 id="æ•°æ®æ¥å…¥-Prometheus"><a href="#æ•°æ®æ¥å…¥-Prometheus" class="headerlink" title="æ•°æ®æ¥å…¥ Prometheus"></a>æ•°æ®æ¥å…¥ Prometheus</h2><p>è‡ªåŠ¨æ¥å…¥æˆ–æ‰‹åŠ¨æ¥å…¥æŒ‰ç…§éœ€æ±‚é€‰æ‹©ä¸€ä¸ªã€‚</p><h3 id="è‡ªåŠ¨æ¥å…¥"><a href="#è‡ªåŠ¨æ¥å…¥" class="headerlink" title="è‡ªåŠ¨æ¥å…¥"></a>è‡ªåŠ¨æ¥å…¥</h3><p>è‡ªåŠ¨æ¥å…¥éœ€è¦ä½¿ç”¨åˆ° <code>Prometheus</code> çš„è‡ªåŠ¨å‘ç°æœºåˆ¶ï¼Œåˆ©ç”¨ <code>servcie discovery endpoint</code> æ¥æ¥å…¥ï¼Œ<code>Prometheus</code> é…ç½®ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">global:</span></span><br><span class="line">   <span class="attr">scrape_interval:</span>     <span class="string">30s</span></span><br><span class="line">   <span class="attr">evaluation_interval:</span> <span class="string">30s</span></span><br><span class="line"></span><br><span class="line"> <span class="attr">scrape_configs:</span></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;service_endpoints_metrics&#x27;</span></span><br><span class="line">     <span class="attr">kubernetes_sd_configs:</span></span><br><span class="line">     <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">endpoints</span></span><br><span class="line">     <span class="attr">relabel_configs:</span></span><br><span class="line">     <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__meta_kubernetes_service_annotation_prometheus_io_scrape</span>]</span><br><span class="line">       <span class="attr">action:</span> <span class="string">keep</span></span><br><span class="line">       <span class="attr">regex:</span> <span class="literal">true</span></span><br><span class="line">     <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__meta_kubernetes_service_annotation_prometheus_io_scheme</span>]</span><br><span class="line">       <span class="attr">action:</span> <span class="string">replace</span></span><br><span class="line">       <span class="attr">target_label:</span> <span class="string">__scheme__</span></span><br><span class="line">       <span class="attr">regex:</span> <span class="string">(https?)</span></span><br><span class="line">     <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__meta_kubernetes_service_annotation_prometheus_io_path</span>]</span><br><span class="line">       <span class="attr">action:</span> <span class="string">replace</span></span><br><span class="line">       <span class="attr">target_label:</span> <span class="string">__metrics_path__</span></span><br><span class="line">       <span class="attr">regex:</span> <span class="string">(.+)</span></span><br><span class="line">     <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__address__</span>, <span class="string">__meta_kubernetes_service_annotation_prometheus_io_port</span>]</span><br><span class="line">       <span class="attr">action:</span> <span class="string">replace</span></span><br><span class="line">       <span class="attr">target_label:</span> <span class="string">__address__</span></span><br><span class="line">       <span class="attr">regex:</span> <span class="string">([^:]+)(?::\d+)?;(\d+)</span></span><br><span class="line">       <span class="attr">replacement:</span> <span class="string">$1:$2</span></span><br><span class="line">     <span class="comment"># é¢å¤–å¢åŠ çš„æ ‡ç­¾</span></span><br><span class="line">     <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__meta_kubernetes_namespace</span>]</span><br><span class="line">       <span class="attr">target_label:</span> <span class="string">namespace</span></span><br><span class="line">     <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__meta_kubernetes_service_name</span>]</span><br><span class="line">       <span class="attr">target_label:</span> <span class="string">service_name</span></span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ nacos çš„ serviceï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nacos-svc</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">public</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nacos</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="comment"># å¢åŠ å¦‚ä¸‹æ³¨è§£ï¼Œå³å¯è¢«Prometheusè‡ªåŠ¨å‘ç°</span></span><br><span class="line">    <span class="attr">prometheus.io/path:</span> <span class="string">/nacos/actuator/prometheus</span></span><br><span class="line">    <span class="attr">prometheus.io/port:</span> <span class="string">&quot;8848&quot;</span></span><br><span class="line">    <span class="attr">prometheus.io/scrape:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">8848</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">server</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">8848</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">9848</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">client-rpc</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">9848</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">9849</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">raft-rpc</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">9849</span></span><br><span class="line">    <span class="comment">## å…¼å®¹1.4.xç‰ˆæœ¬çš„é€‰ä¸¾ç«¯å£</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">7848</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">old-raft-rpc</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">7848</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">ClusterIP</span></span><br><span class="line">  <span class="attr">selector:</span></span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹ Prometheus çš„ targetsï¼š<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202409301700141.png" alt="image.png"></p><h3 id="æ‰‹åŠ¨æ¥å…¥"><a href="#æ‰‹åŠ¨æ¥å…¥" class="headerlink" title="æ‰‹åŠ¨æ¥å…¥"></a>æ‰‹åŠ¨æ¥å…¥</h3><p>å¦‚æœç”±äºç§ç§åŸå› ä¸èƒ½è‡ªåŠ¨å‘ç°ï¼Œå¯ä»¥æ‰‹åŠ¨é…ç½®çš„æ–¹å¼æ¥æ¥å…¥åˆ° <code>Prometheus</code></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">scrape_configs:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">nacos</span></span><br><span class="line">  <span class="attr">honor_timestamps:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">scrape_interval:</span> <span class="string">15s</span></span><br><span class="line">  <span class="attr">scrape_timeout:</span> <span class="string">10s</span></span><br><span class="line">  <span class="attr">metrics_path:</span> <span class="string">&#x27;/nacos/actuator/prometheus&#x27;</span></span><br><span class="line">  <span class="attr">scheme:</span> <span class="string">http</span></span><br><span class="line">  <span class="attr">follow_redirects:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">static_configs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">targets:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;&#123;ip1&#125;:8848&#x27;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;&#123;ip2&#125;:8848&#x27;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;&#123;ip3&#125;:8848&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="Nacos-metrics-å«ä¹‰"><a href="#Nacos-metrics-å«ä¹‰" class="headerlink" title="Nacos metrics å«ä¹‰"></a>Nacos metrics å«ä¹‰</h2><h3 id="jvm-metrics"><a href="#jvm-metrics" class="headerlink" title="jvm metrics"></a>jvm metrics</h3><table><thead><tr><th>æŒ‡æ ‡</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>system_cpu_usage</td><td>CPU ä½¿ç”¨ç‡</td></tr><tr><td>system_load_average_1m</td><td>load</td></tr><tr><td>jvm_memory_used_bytes</td><td>å†…å­˜ä½¿ç”¨å­—èŠ‚ï¼ŒåŒ…å«å„ç§å†…å­˜åŒº</td></tr><tr><td>jvm_memory_max_bytes</td><td>å†…å­˜æœ€å¤§å­—èŠ‚ï¼ŒåŒ…å«å„ç§å†…å­˜åŒº</td></tr><tr><td>jvm_gc_pause_seconds_count</td><td>gc æ¬¡æ•°ï¼ŒåŒ…å«å„ç§ gc</td></tr><tr><td>jvm_gc_pause_seconds_sum</td><td>gc è€—æ—¶ï¼ŒåŒ…å«å„ç§ gc</td></tr><tr><td>jvm_threads_daemon</td><td>çº¿ç¨‹æ•°</td></tr></tbody></table><h3 id="Nacos-ç›‘æ§æŒ‡æ ‡"><a href="#Nacos-ç›‘æ§æŒ‡æ ‡" class="headerlink" title="Nacos ç›‘æ§æŒ‡æ ‡"></a>Nacos ç›‘æ§æŒ‡æ ‡</h3><table><thead><tr><th>æŒ‡æ ‡</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>http_server_requests_seconds_count</td><td>http è¯·æ±‚æ¬¡æ•°ï¼ŒåŒ…æ‹¬å¤šç§ (url,æ–¹æ³•,code)</td></tr><tr><td>http_server_requests_seconds_sum</td><td>http è¯·æ±‚æ€»è€—æ—¶ï¼ŒåŒ…æ‹¬å¤šç§ (url,æ–¹æ³•,code)</td></tr><tr><td>nacos_timer_seconds_sum</td><td>Nacos config æ°´å¹³é€šçŸ¥è€—æ—¶</td></tr><tr><td>nacos_timer_seconds_count</td><td>Nacos config æ°´å¹³é€šçŸ¥æ¬¡æ•°</td></tr><tr><td>nacos_monitor{name&#x3D;â€™longPollingâ€™}</td><td>Nacos config é•¿è¿æ¥æ•°</td></tr><tr><td>nacos_monitor{name&#x3D;â€™configCountâ€™}</td><td>Nacos config é…ç½®ä¸ªæ•°</td></tr><tr><td>nacos_monitor{name&#x3D;â€™dumpTaskâ€™}</td><td>Nacos config é…ç½®è½ç›˜ä»»åŠ¡å †ç§¯æ•°</td></tr><tr><td>nacos_monitor{name&#x3D;â€™notifyTaskâ€™}</td><td>Nacos config é…ç½®æ°´å¹³é€šçŸ¥ä»»åŠ¡å †ç§¯æ•°</td></tr><tr><td>nacos_monitor{name&#x3D;â€™getConfigâ€™}</td><td>Nacos config è¯»é…ç½®ç»Ÿè®¡æ•°</td></tr><tr><td>nacos_monitor{name&#x3D;â€™publishâ€™}</td><td>Nacos config å†™é…ç½®ç»Ÿè®¡æ•°</td></tr><tr><td>nacos_monitor{name&#x3D;â€™ipCountâ€™}</td><td>Nacos naming ip ä¸ªæ•°</td></tr><tr><td>nacos_monitor{name&#x3D;â€™domCountâ€™}</td><td>Nacos naming åŸŸåä¸ªæ•° (1.x ç‰ˆæœ¬)</td></tr><tr><td>nacos_monitor{name&#x3D;â€™serviceCountâ€™}</td><td>Nacos naming åŸŸåä¸ªæ•° (2.x ç‰ˆæœ¬)</td></tr><tr><td>nacos_monitor{name&#x3D;â€™failedPushâ€™}</td><td>Nacos naming æ¨é€å¤±è´¥æ•°</td></tr><tr><td>nacos_monitor{name&#x3D;â€™avgPushCostâ€™}</td><td>Nacos naming å¹³å‡æ¨é€è€—æ—¶</td></tr><tr><td>nacos_monitor{name&#x3D;â€™leaderStatusâ€™}</td><td>Nacos naming è§’è‰²çŠ¶æ€</td></tr><tr><td>nacos_monitor{name&#x3D;â€™maxPushCostâ€™}</td><td>Nacos naming æœ€å¤§æ¨é€è€—æ—¶</td></tr><tr><td>nacos_monitor{name&#x3D;â€™mysqlhealthCheckâ€™}</td><td>Nacos naming mysql å¥åº·æ£€æŸ¥æ¬¡æ•°</td></tr><tr><td>nacos_monitor{name&#x3D;â€™httpHealthCheckâ€™}</td><td>Nacos naming http å¥åº·æ£€æŸ¥æ¬¡æ•°</td></tr><tr><td>nacos_monitor{name&#x3D;â€™tcpHealthCheckâ€™}</td><td>Nacos naming tcp å¥åº·æ£€æŸ¥æ¬¡æ•°</td></tr><tr><td>nacos_monitor{module&#x3D;â€namingâ€,name&#x3D;â€serviceCountâ€,}</td><td>Nacos æ³¨å†Œçš„æœåŠ¡æ•°é‡</td></tr></tbody></table><h3 id="nacos-å¼‚å¸¸æŒ‡æ ‡"><a href="#nacos-å¼‚å¸¸æŒ‡æ ‡" class="headerlink" title="nacos å¼‚å¸¸æŒ‡æ ‡"></a>nacos å¼‚å¸¸æŒ‡æ ‡</h3><table><thead><tr><th>æŒ‡æ ‡</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>nacos_exception_total{name&#x3D;â€™dbâ€™}</td><td>æ•°æ®åº“å¼‚å¸¸</td></tr><tr><td>nacos_exception_total{name&#x3D;â€™configNotifyâ€™}</td><td>Nacos config æ°´å¹³é€šçŸ¥å¤±è´¥</td></tr><tr><td>nacos_exception_total{name&#x3D;â€™unhealthâ€™}</td><td>Nacos config server ä¹‹é—´å¥åº·æ£€æŸ¥å¼‚å¸¸</td></tr><tr><td>nacos_exception_total{name&#x3D;â€™diskâ€™}</td><td>Nacos naming å†™ç£ç›˜å¼‚å¸¸</td></tr><tr><td>nacos_exception_total{name&#x3D;â€™leaderSendBeatFailedâ€™}</td><td>Nacos naming leader å‘é€å¿ƒè·³å¼‚å¸¸</td></tr><tr><td>nacos_exception_total{name&#x3D;â€™illegalArgumentâ€™}</td><td>è¯·æ±‚å‚æ•°ä¸åˆæ³•</td></tr><tr><td>nacos_exception_total{name&#x3D;â€™nacosâ€™}</td><td>Nacos è¯·æ±‚å“åº”å†…éƒ¨é”™è¯¯å¼‚å¸¸ï¼ˆè¯»å†™å¤±è´¥ï¼Œæ²¡æƒé™ï¼Œå‚æ•°é”™è¯¯ï¼‰</td></tr></tbody></table><h3 id="client-metrics"><a href="#client-metrics" class="headerlink" title="client metrics"></a>client metrics</h3><table><thead><tr><th>æŒ‡æ ‡</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>nacos_monitor{name&#x3D;â€™subServiceCountâ€™}</td><td>è®¢é˜…çš„æœåŠ¡æ•°</td></tr><tr><td>nacos_monitor{name&#x3D;â€™pubServiceCountâ€™}</td><td>å‘å¸ƒçš„æœåŠ¡æ•°</td></tr><tr><td>nacos_monitor{name&#x3D;â€™configListenSizeâ€™}</td><td>ç›‘å¬çš„é…ç½®æ•°</td></tr><tr><td>nacos_client_request_seconds_count</td><td>è¯·æ±‚çš„æ¬¡æ•°ï¼ŒåŒ…æ‹¬å¤šç§ (url,æ–¹æ³•,code)</td></tr><tr><td>nacos_client_request_seconds_sum</td><td>è¯·æ±‚çš„æ€»è€—æ—¶ï¼ŒåŒ…æ‹¬å¤šç§ (url,æ–¹æ³•,code)</td></tr></tbody></table><h2 id="å‘Šè­¦è§„åˆ™åˆ¶å®š"><a href="#å‘Šè­¦è§„åˆ™åˆ¶å®š" class="headerlink" title="å‘Šè­¦è§„åˆ™åˆ¶å®š"></a>å‘Šè­¦è§„åˆ™åˆ¶å®š</h2><p>é’ˆå¯¹å¼‚å¸¸æŒ‡æ ‡è¿›è¡Œå‘Šè­¦ï¼Œä¿®æ”¹ Prometheus alert é…ç½®æ–‡ä»¶ã€‚å‘Šè­¦è§„åˆ™å¾…éªŒè¯ã€‚</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">groups:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nocaså‘Šè­¦</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">alert:</span> <span class="string">&quot;nocasæœåŠ¡æ³¨å†Œæ•°é‡å¼‚å¸¸&quot;</span></span><br><span class="line">    <span class="attr">expr:</span> <span class="string">nacos_monitor&#123;module=&quot;naming&quot;,name=&quot;serviceCount&quot;,&#125;</span> <span class="string">&lt;</span> <span class="number">10</span></span><br><span class="line">    <span class="attr">for:</span> <span class="string">1m</span></span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">severity:</span> <span class="string">critical</span></span><br><span class="line">    <span class="attr">annotations:</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">&quot;é¡¹ç›®:<span class="template-variable">&#123;&#123;$labels.project&#125;&#125;</span> nocaså½“å‰æ³¨å†Œæ•°é‡:<span class="template-variable">&#123;&#123;$value&#125;&#125;</span>&quot;</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">&quot;æœåŠ¡æ³¨å†Œæ•°é‡å¼‚å¸¸&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">alert:</span> <span class="string">&quot;Nacos naming leaderå‘é€å¿ƒè·³å¼‚å¸¸&quot;</span></span><br><span class="line">    <span class="attr">expr:</span> <span class="string">increase(nacos_exception_total&#123;name=&#x27;leaderSendBeatFailed&#x27;&#125;[1m])</span> <span class="type">!=0</span></span><br><span class="line">    <span class="attr">for:</span> <span class="string">1m</span></span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">severity:</span> <span class="string">critical</span></span><br><span class="line">    <span class="attr">annotations:</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">&quot;é¡¹ç›®:<span class="template-variable">&#123;&#123;$labels.project&#125;&#125;</span> å‘é€å¿ƒè·³å¼‚å¸¸æ•°é‡ä¸º:<span class="template-variable">&#123;&#123;$value&#125;&#125;</span>&quot;</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">&quot;Nacos naming leaderå‘é€å¿ƒè·³å¼‚å¸¸&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">alert:</span> <span class="string">&quot;Nacos configé•¿è¿æ¥æ•°å¤§äº5000&quot;</span></span><br><span class="line">    <span class="attr">expr:</span> <span class="string">sum</span> <span class="string">by</span> <span class="string">(project,instance,dept)</span> <span class="string">(irate(nacos_monitor&#123;name=&#x27;longPolling&#x27;&#125;[5m]))</span> <span class="string">&gt;</span> <span class="number">5000</span></span><br><span class="line">    <span class="attr">for:</span> <span class="string">5m</span></span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">severity:</span> <span class="string">critical</span></span><br><span class="line">    <span class="attr">annotations:</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">&quot;é¡¹ç›®:<span class="template-variable">&#123;&#123;$labels.project&#125;&#125;</span> å‘é€å¿ƒè·³å¼‚å¸¸æ•°é‡ä¸º:<span class="template-variable">&#123;&#123;$value&#125;&#125;</span>&quot;</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">&quot;Nacos configé•¿è¿æ¥æ•°å¤§äº5000&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">alert:</span> <span class="string">&quot;Nacos config serverä¹‹é—´å¥åº·æ£€æŸ¥å¼‚å¸¸&quot;</span></span><br><span class="line">    <span class="attr">expr:</span> <span class="string">sum</span> <span class="string">by</span> <span class="string">(project,instance,dept)</span> <span class="string">(rate(nacos_exception_total&#123;name=&#x27;unhealth&#x27;&#125;[1m]))</span>  <span class="string">&gt;</span> <span class="number">1</span></span><br><span class="line">    <span class="attr">for:</span> <span class="string">1m</span></span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">severity:</span> <span class="string">critical</span></span><br><span class="line">    <span class="attr">annotations:</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">&quot;é¡¹ç›®:<span class="template-variable">&#123;&#123;$labels.project&#125;&#125;</span> config unhealth exception alert&quot;</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">&quot;Nacos config serverä¹‹é—´å¥åº·æ£€æŸ¥å¼‚å¸¸&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">alert:</span> <span class="string">&quot;Nacos namingæ¨é€å¤±è´¥æ•°å¤§äº1&quot;</span></span><br><span class="line">    <span class="attr">expr :</span> <span class="string">sum</span> <span class="string">by</span> <span class="string">(project,instance,dept)</span> <span class="string">(irate(nacos_monitor&#123;name=&#x27;failedPush&#x27;&#125;[5m]))</span> <span class="string">&gt;</span> <span class="number">1</span></span><br><span class="line">    <span class="attr">for:</span> <span class="string">5m</span></span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">severity:</span> <span class="string">critical</span></span><br><span class="line">    <span class="attr">annotations:</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">&quot;é¡¹ç›®:<span class="template-variable">&#123;&#123;$labels.project&#125;&#125;</span> æ¨é€å¤±è´¥æ•° <span class="template-variable">&#123;&#123;$value&#125;&#125;</span>&quot;</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">&quot;Nacos namingæ¨é€å¤±è´¥æ•°å¤§äº1&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">alert:</span> <span class="string">&quot;Nacos namingå†™ç£ç›˜å¼‚å¸¸&quot;</span></span><br><span class="line">    <span class="attr">expr :</span> <span class="string">sum</span> <span class="string">by</span> <span class="string">(project,instance,dept)</span> <span class="string">(rate(nacos_exception_total&#123;name=&#x27;disk&#x27;&#125;[1m]))</span> <span class="string">&gt;</span> <span class="number">1</span></span><br><span class="line">    <span class="attr">for:</span> <span class="string">1m</span></span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">severity:</span> <span class="string">critical</span></span><br><span class="line">    <span class="attr">annotations:</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">&quot;é¡¹ç›®:<span class="template-variable">&#123;&#123;$labels.project&#125;&#125;</span> å†™ç£ç›˜å¼‚å¸¸&quot;</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">&quot;Nacos namingå†™ç£ç›˜å¼‚å¸¸&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">alert:</span> <span class="string">&quot;Nacos configæ°´å¹³é€šçŸ¥å¤±è´¥&quot;</span></span><br><span class="line">    <span class="attr">expr :</span> <span class="string">sum</span> <span class="string">by</span> <span class="string">(project,instance,dept)</span> <span class="string">(rate(nacos_exception_total&#123;name=&#x27;configNotify&#x27;&#125;[1m]))</span> <span class="string">&gt;</span> <span class="number">1</span></span><br><span class="line">    <span class="attr">for:</span> <span class="string">1m</span></span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">severity:</span> <span class="string">critical</span></span><br><span class="line">    <span class="attr">annotations:</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">&quot;é¡¹ç›®:<span class="template-variable">&#123;&#123;$labels.project&#125;&#125;</span> æ°´å¹³é€šçŸ¥å¤±è´¥&quot;</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">&quot;Nacos configæ°´å¹³é€šçŸ¥å¤±è´¥&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">alert:</span> <span class="string">&quot;Nacosè¯·æ±‚å“åº”å†…éƒ¨é”™è¯¯å¼‚å¸¸(è¯»å†™å¤±è´¥,æ²¡æƒé™,å‚æ•°é”™è¯¯)&quot;</span></span><br><span class="line">    <span class="attr">expr :</span> <span class="string">sum</span> <span class="string">by</span> <span class="string">(project,instance,dept)</span> <span class="string">(rate(nacos_exception_total&#123;name=&#x27;nacos&#x27;&#125;[1m]))</span> <span class="string">&gt;</span> <span class="number">1</span></span><br><span class="line">    <span class="attr">for:</span> <span class="string">1m</span></span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">severity:</span> <span class="string">critical</span></span><br><span class="line">    <span class="attr">annotations:</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">&quot;é¡¹ç›®:<span class="template-variable">&#123;&#123;$labels.project&#125;&#125;</span> è¯»å†™å¤±è´¥&quot;</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">&quot;Nacosè¯·æ±‚å“åº”å†…éƒ¨é”™è¯¯å¼‚å¸¸(è¯»å†™å¤±è´¥,æ²¡æƒé™,å‚æ•°é”™è¯¯)&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç›‘æ§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nacos </tag>
            
            <tag> prometheus </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åœ¨Kubernetesä¸‹æ”¶é›†ingressæ—¥å¿—åˆ°Elasticsearch</title>
      <link href="/posts/skk1ln/"/>
      <url>/posts/skk1ln/</url>
      
        <content type="html"><![CDATA[<p>æœ¬æ–‡ ingress ç”¨çš„æ˜¯ Nginx-ingressï¼Œæ™®é€šçš„ Nginx åŸç†æ˜¯ä¸€æ ·çš„ã€‚å®¹å™¨è¿è¡Œæ—¶æ˜¯ Dockerã€‚</p><h2 id="ingress-é…ç½®"><a href="#ingress-é…ç½®" class="headerlink" title="ingress é…ç½®"></a>ingress é…ç½®</h2><p>ingress éœ€è¦è°ƒæ•´ä¸€ä¸‹æ—¥å¿—æ ¼å¼ï¼Œjson æ—¥å¿—æ›´æœ‰åˆ©äºåˆ†æä¸å¤„ç†ã€‚</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Source: ingress-nginx/templates/controller-configmap.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="string">...</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ingress-nginx-controller</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">ingress-nginx</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="string">...</span></span><br><span class="line">  <span class="comment"># annotation: nginx.ingress.kubernetes.io/client-body-buffer-size: 1M</span></span><br><span class="line">  <span class="attr">log-format-upstream:</span> <span class="string">&#x27;&#123;&quot;@timestamp&quot;: &quot;$time_iso8601&quot;,&quot;server_addr&quot;:&quot;$server_addr&quot;,&quot;remote_addr&quot;:&quot;$remote_addr&quot;,&quot;scheme&quot;:&quot;$scheme&quot;,&quot;request_method&quot;:&quot;$request_method&quot;,&quot;request_uri&quot;: &quot;$request_uri&quot;,&quot;request_length&quot;: &quot;$request_length&quot;,&quot;uri&quot;: &quot;$uri&quot;,&quot;request_time&quot;:$request_time,&quot;body_bytes_sent&quot;:$body_bytes_sent,&quot;bytes_sent&quot;:$bytes_sent,&quot;status&quot;:&quot;$status&quot;,&quot;upstream_host&quot;:&quot;$upstream_addr&quot;,&quot;domain&quot;:&quot;$host&quot;,&quot;http_referer&quot;:&quot;$http_referer&quot;,&quot;http_user_agent&quot;:&quot;$http_user_agent&quot;,&quot;http_app_id&quot;:&quot;$http_app_id&quot;,&quot;x_forwarded&quot;:&quot;$http_x_forwarded_for&quot;,&quot;up_r_time&quot;:&quot;$upstream_response_time&quot;,&quot;up_status&quot;:&quot;$upstream_status&quot;,&quot;listen_port&quot;:&quot;$server_port&quot;&#125;&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="filebeat-é…ç½®"><a href="#filebeat-é…ç½®" class="headerlink" title="filebeat é…ç½®"></a>filebeat é…ç½®</h2><p>åœ¨ Linux ä¸­ï¼Œä¸€åˆ‡çš†æ–‡ä»¶ï¼Œé‚£ä¹ˆ Pod çš„æ§åˆ¶å°æ—¥å¿—ä¹Ÿæ˜¯å­˜å‚¨åœ¨æ–‡ä»¶é‡Œçš„ï¼Œå¦‚æœå®¹å™¨è¿è¡Œæ—¶ç”¨çš„æ˜¯ Dockerï¼Œé»˜è®¤ä½¿ç”¨çš„æ˜¯ json æ—¥å¿—æ–‡ä»¶æ ¼å¼ <code>&quot;log-driver&quot;: &quot;json-file&quot;</code> æ—¥å¿—åœ¨ä¸»æœºä¸Šçš„ <code>/var/lib/docker/containers/xx/xx-json.log</code>, é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æŠŠè¿™ä¸ªç›®å½•æŒ‚è½½åˆ° filebeat å®¹å™¨ä¸­å³å¯ä½¿ç”¨ filebeat æ¥æœé›†æ—¥å¿—ï¼Œä½†æ˜¯è¿™æ ·ä¸æ–¹ä¾¿åˆ†è¾¨æ˜¯å“ªä¸ªå®¹å™¨çš„æ—¥å¿—ï¼ŒKubernetes ç»™æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç›®å½• <code>/var/log/pods</code> è¿™é‡Œæ–‡ä»¶ç›®å½•éƒ½æ˜¯ä»¥å›ºå®šæ ¼å¼æ¥æ˜¾ç¤ºçš„ï¼Œå¯ä»¥æ ¹æ®æ–‡ä»¶åæ¥åˆ†ææ˜¯å“ªä¸ª namespace çš„å“ªä¸ª pod çš„æ—¥å¿—äº†ã€‚è¿˜æœ‰ä¸ªç›®å½•æ˜¯ <code>/var/log/containers/</code> è¿™ä¸ªç›®å½•é‡Œé¢çš„æ–‡ä»¶æ˜¯é“¾æ¥åˆ° <code>/var/log/pods/</code> é‡Œé¢çš„æ—¥å¿—æ–‡ä»¶ã€‚æ‰€ä»¥æ”¶é›†æ—¥å¿—å¯ä»¥ç›´æ¥ä» <code>/var/log/containers</code> æ¥æ”¶é›†ã€‚æ‰€ä»¥ filebeat éœ€è¦åªè¯»è®¿é—® 3 ä¸ªç›®å½•ï¼š</p><ol><li><code>/var/lib/docker/containers/</code></li><li><code>/var/log/containers/</code></li><li><code>/var/log/pods/</code></li></ol><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202409291142969.png" alt="image.png"></p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202409291150198.png" alt="image.png"></p><p>é¦–å…ˆåœ¨ Kubernetes ç¯å¢ƒä¸‹ï¼Œæˆ‘ä»¬è®¤ä¸º Pod æ˜¯å¹¶ä¸å›ºå®šçš„ï¼Œå¯èƒ½ä¼šæ¼‚ç§»åˆ°ä»»æ„çš„èŠ‚ç‚¹ï¼Œé‚£ä¹ˆæ”¶é›†æ—¥å¿—éœ€è¦æ¯å°èŠ‚ç‚¹ä¸Šéƒ½éƒ¨ç½² filebeat æ¥æœé›†ï¼Œé‚£ä¹ˆä½¿ç”¨ daemonset æ˜¯æœ€åˆé€‚çš„ã€‚</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">filebeat</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">filebeat</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">ops</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">filebeat</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">filebeat</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">filebeat</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>] <span class="comment"># &quot;&quot; indicates the core API group</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">namespaces</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">pods</span></span><br><span class="line">  <span class="attr">verbs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">watch</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">list</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">filebeat</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">ops</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">filebeat</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">filebeat-config</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">ops</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">filebeat</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">filebeat.yml:</span> <span class="string">|-</span></span><br><span class="line"><span class="string">    ###################### Filebeat Configuration Example  #########################</span></span><br><span class="line"><span class="string"></span></span><br><span class="line">    <span class="attr">filebeat.inputs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">log</span></span><br><span class="line">        <span class="attr">symlinks:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">json.keys_under_root:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">json.overwrite_keys:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">json.add_error_key:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">tail_files:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">paths:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">/var/log/containers/ingress-nginx-controller-*.log</span></span><br><span class="line">        <span class="attr">processors:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">decode_json_fields:</span></span><br><span class="line">              <span class="attr">fields:</span> [<span class="string">&#x27;log&#x27;</span>] <span class="comment"># è¿™é‡Œé’ˆå¯¹çš„æ˜¯dockerè½¬æ¢åçš„jsonæ—¥å¿—ï¼ŒåŸå§‹æ—¥å¿—åœ¨logå­—æ®µå†…ã€‚</span></span><br><span class="line">              <span class="attr">target:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">              <span class="attr">overwrite_keys:</span> <span class="literal">false</span></span><br><span class="line">              <span class="attr">process_array:</span> <span class="literal">false</span></span><br><span class="line">              <span class="attr">max_depth:</span> <span class="number">1</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">drop_event:</span></span><br><span class="line">              <span class="attr">when:</span></span><br><span class="line">                <span class="attr">or:</span></span><br><span class="line">                  <span class="bullet">-</span> <span class="attr">regexp:</span></span><br><span class="line">                      <span class="attr">http_user_agent:</span> <span class="string">&#x27;Go-http-client&#x27;</span></span><br><span class="line">                  <span class="bullet">-</span> <span class="attr">regexp:</span></span><br><span class="line">                      <span class="attr">request_uri:</span> <span class="string">&#x27;/actuator/info&#x27;</span></span><br><span class="line">        <span class="attr">fields:</span></span><br><span class="line">          <span class="attr">log_topic:</span> <span class="string">&quot;ingress-k8s&quot;</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">&quot;ingress&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># ============================= Filebeat modules ===============================</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">filebeat.config.modules:</span></span><br><span class="line">      <span class="attr">path:</span> <span class="string">$&#123;path.config&#125;/modules.d/*.yml</span></span><br><span class="line">      <span class="attr">reload.enabled:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#==================== Elasticsearch template setting ==========================</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">setup.template.settings:</span></span><br><span class="line">      <span class="attr">index.number_of_shards:</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#============================== Kibana =====================================</span></span><br><span class="line">    <span class="comment"># Uncomment and add the necessary Kibana configuration if needed</span></span><br><span class="line">    <span class="comment"># setup.kibana:</span></span><br><span class="line">    <span class="comment">#   host: &quot;http://your-kibana-host:5601&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">output.kafka:</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">hosts:</span> [<span class="string">&quot;10.0.0.3:9092&quot;</span>, <span class="string">&quot;10.0.0.4:9092&quot;</span>, <span class="string">&quot;10.0.0.5:9092&quot;</span>]</span><br><span class="line">      <span class="attr">topic:</span> <span class="string">&#x27;<span class="template-variable">%&#123;[fields.log_topic]&#125;</span>&#x27;</span></span><br><span class="line">      <span class="attr">partition.round_robin:</span></span><br><span class="line">        <span class="attr">reachable_only:</span> <span class="literal">false</span></span><br><span class="line">      <span class="attr">required_acks:</span> <span class="number">1</span></span><br><span class="line">      <span class="attr">compression:</span> <span class="string">none</span></span><br><span class="line">      <span class="attr">max_message_bytes:</span> <span class="number">100000</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#================================ Processors =====================================</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">processors:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">add_host_metadata:</span> <span class="string">~</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">add_cloud_metadata:</span> <span class="string">~</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">DaemonSet</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">filebeat</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">ops</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">filebeat</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">filebeat</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">filebeat</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">config</span></span><br><span class="line">          <span class="attr">configMap:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">filebeat-config</span></span><br><span class="line">            <span class="attr">defaultMode:</span> <span class="number">420</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">varlibdockercontainers</span></span><br><span class="line">          <span class="attr">hostPath:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/opt/docker/containers</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">varlog</span></span><br><span class="line">          <span class="attr">hostPath:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/var/log</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">data</span></span><br><span class="line">          <span class="attr">hostPath:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/var/lib/filebeat-data</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">DirectoryOrCreate</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">filebeat</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">registry.cn-hangzhou.aliyuncs.com/yaml/images:filebeat-7.3.2</span></span><br><span class="line">          <span class="attr">args:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&#x27;-c&#x27;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">/etc/filebeat.yml</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&#x27;-e&#x27;</span></span><br><span class="line">          <span class="attr">resources:</span></span><br><span class="line">            <span class="attr">limits:</span></span><br><span class="line">              <span class="attr">cpu:</span> <span class="string">300m</span></span><br><span class="line">              <span class="attr">memory:</span> <span class="string">200Mi</span></span><br><span class="line">            <span class="attr">requests:</span></span><br><span class="line">              <span class="attr">cpu:</span> <span class="string">200m</span></span><br><span class="line">              <span class="attr">memory:</span> <span class="string">100Mi</span></span><br><span class="line">          <span class="attr">volumeMounts:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">config</span></span><br><span class="line">              <span class="attr">readOnly:</span> <span class="literal">true</span></span><br><span class="line">              <span class="attr">mountPath:</span> <span class="string">/etc/filebeat.yml</span></span><br><span class="line">              <span class="attr">subPath:</span> <span class="string">filebeat.yml</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">data</span></span><br><span class="line">              <span class="attr">mountPath:</span> <span class="string">/usr/share/filebeat/data</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">varlibdockercontainers</span></span><br><span class="line">              <span class="attr">readOnly:</span> <span class="literal">true</span></span><br><span class="line">              <span class="attr">mountPath:</span> <span class="string">/opt/docker/containers</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">varlog</span></span><br><span class="line">              <span class="attr">readOnly:</span> <span class="literal">true</span></span><br><span class="line">              <span class="attr">mountPath:</span> <span class="string">/var/log</span></span><br><span class="line">          <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">          <span class="attr">securityContext:</span></span><br><span class="line">            <span class="attr">runAsUser:</span> <span class="number">0</span></span><br><span class="line">      <span class="attr">restartPolicy:</span> <span class="string">Always</span></span><br><span class="line">      <span class="attr">terminationGracePeriodSeconds:</span> <span class="number">30</span></span><br><span class="line">      <span class="attr">dnsPolicy:</span> <span class="string">ClusterFirst</span></span><br><span class="line">      <span class="attr">serviceAccountName:</span> <span class="string">filebeat</span></span><br><span class="line">      <span class="attr">serviceAccount:</span> <span class="string">filebeat</span></span><br><span class="line">      <span class="attr">hostNetwork:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„ filebeat æŠŠæ”¶é›†åˆ°çš„æ—¥å¿—å†™å…¥åˆ° Kafka é›†ç¾¤ä¸­ã€‚å¦‚æœå®¹å™¨è¿è¡Œæ—¶æ˜¯ containerdï¼Œéœ€è¦åšç›¸åº”çš„ä¿®æ”¹ã€‚</p><h2 id="logstash-é…ç½®"><a href="#logstash-é…ç½®" class="headerlink" title="logstash é…ç½®"></a>logstash é…ç½®</h2><p>logstash æ¶ˆè´¹ kafka æ•°æ®ï¼Œè¿›è¡Œå¤„ç†å å†™å…¥åˆ° Elasticsearch</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">logstash-ingress-logs</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">ops</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">logstash-ingress-logs</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">logstash-ingress-logs</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">image:</span> <span class="string">logstash:7.5.1</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">logstash</span></span><br><span class="line">          <span class="attr">volumeMounts:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/usr/share/logstash/config/logstash.yml</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">logstash-ingress-logs-conf</span></span><br><span class="line">            <span class="attr">readOnly:</span> <span class="literal">true</span></span><br><span class="line">            <span class="attr">subPath:</span> <span class="string">logstash.yml</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/usr/share/logstash/pipeline/logstash.conf</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">logstash-ingress-logs-conf</span></span><br><span class="line">            <span class="attr">readOnly:</span> <span class="literal">true</span></span><br><span class="line">            <span class="attr">subPath:</span> <span class="string">logstash.conf</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/usr/share/logstash/config/jvm.options</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">logstash-ingress-logs-conf</span></span><br><span class="line">            <span class="attr">readOnly:</span> <span class="literal">true</span></span><br><span class="line">            <span class="attr">subPath:</span> <span class="string">jvm.options</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">configMap:</span></span><br><span class="line">            <span class="attr">defaultMode:</span> <span class="number">420</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">logstash-ingress-logs-conf</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">logstash-ingress-logs-conf</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">logstash-ingress-logs-conf</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">ops</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">jvm.options:</span> <span class="string">|</span></span><br><span class="line"><span class="string">    -Xms2g</span></span><br><span class="line"><span class="string">    -Xmx3g</span></span><br><span class="line"><span class="string">    -XX:+UseConcMarkSweepGC</span></span><br><span class="line"><span class="string">    -XX:CMSInitiatingOccupancyFraction=75</span></span><br><span class="line"><span class="string">    -XX:+UseCMSInitiatingOccupancyOnly</span></span><br><span class="line"><span class="string">    -Djava.awt.headless=true</span></span><br><span class="line"><span class="string">    -Dfile.encoding=UTF-8</span></span><br><span class="line"><span class="string">    -Djruby.compile.invokedynamic=true</span></span><br><span class="line"><span class="string">    -Djruby.jit.threshold=0</span></span><br><span class="line"><span class="string">    -Djruby.regexp.interruptible=true</span></span><br><span class="line"><span class="string">    -XX:+HeapDumpOnOutOfMemoryError</span></span><br><span class="line"><span class="string">    -Djava.security.egd=file:/dev/urandom</span></span><br><span class="line"><span class="string"></span>  <span class="attr">logstash.yml:</span> <span class="string">&#x27;config.reload.automatic: true&#x27;</span></span><br><span class="line">  <span class="attr">logstash.conf:</span> <span class="string">|</span></span><br><span class="line"><span class="string">    input &#123;</span></span><br><span class="line"><span class="string">      kafka &#123;</span></span><br><span class="line"><span class="string">        bootstrap_servers =&gt; &quot;10.0.0.3:9092,10.0.0.4:9092,10.0.0.5:9092&quot;</span></span><br><span class="line"><span class="string">        topics =&gt; [&quot;ingress-k8s&quot;]</span></span><br><span class="line"><span class="string">        codec =&gt; &quot;json&quot;</span></span><br><span class="line"><span class="string">        consumer_threads =&gt; 3</span></span><br><span class="line"><span class="string">        group_id =&gt; &quot;k8s_group&quot;</span></span><br><span class="line"><span class="string">        decorate_events =&gt; true</span></span><br><span class="line"><span class="string">        type =&gt; &quot;logstash_mixins&quot;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line">    <span class="string">filter&#123;</span></span><br><span class="line">        <span class="string">mutate&#123;</span></span><br><span class="line">            <span class="string">rename</span> <span class="string">=&gt;</span> [<span class="string">&quot;[host][name]&quot;</span>, <span class="string">&quot;hostname&quot;</span>]</span><br><span class="line">            <span class="string">remove_field</span> <span class="string">=&gt;</span> [<span class="string">&quot;ecs&quot;</span>,<span class="string">&quot;@version&quot;</span>,<span class="string">&quot;input&quot;</span>,<span class="string">&quot;host&quot;</span>,<span class="string">&quot;agent&quot;</span>,<span class="string">&quot;log&quot;</span>]</span><br><span class="line">            <span class="string">convert</span> <span class="string">=&gt;</span> &#123;</span><br><span class="line">              <span class="string">&quot;status&quot;</span> <span class="string">=&gt;</span> <span class="string">&quot;integer&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        <span class="string">&#125;</span></span><br><span class="line">    <span class="string">&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="string">output</span> &#123;</span><br><span class="line">      <span class="string">if</span> [<span class="string">type</span>] <span class="string">==</span> <span class="string">&quot;logstash_mixins&quot;</span> &#123;</span><br><span class="line">          <span class="string">elasticsearch</span> &#123;</span><br><span class="line">              <span class="string">action</span>   <span class="string">=&gt;</span> <span class="string">&quot;index&quot;</span></span><br><span class="line">              <span class="string">hosts</span>    <span class="string">=&gt;</span> [<span class="string">&quot;http://10.0.0.13:9200&quot;</span>,<span class="string">&quot;http://10.0.0.14:9200&quot;</span>,<span class="string">&quot;http://10.0.0.15:9200&quot;</span>]</span><br><span class="line">              <span class="string">index</span>    <span class="string">=&gt;</span> <span class="string">&quot;<span class="template-variable">%&#123;[fields][type]&#125;</span>-<span class="template-variable">%&#123;+YYYY.MM.dd&#125;</span>&quot;</span></span><br><span class="line">              <span class="string">user</span>     <span class="string">=&gt;</span> <span class="string">&quot;elastic&quot;</span></span><br><span class="line">              <span class="string">password</span> <span class="string">=&gt;</span> <span class="string">&quot;elasticçš„å¯†ç &quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å†™å…¥åˆ° Elasticsearch åï¼Œåœ¨ Elasticsearch å°±å¯ä»¥çœ‹åˆ°å¯¹åº”çš„ç´¢å¼•äº†ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æ—¥å¿— </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Elasticsearch </tag>
            
            <tag> Kafka </tag>
            
            <tag> filebeat </tag>
            
            <tag> logstash </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Grafanaä¸­è‡ªå®šä¹‰Legendçš„åå­—å’Œè‡ªå®šä¹‰valueçš„æ˜¾ç¤º</title>
      <link href="/posts/skf07c/"/>
      <url>/posts/skf07c/</url>
      
        <content type="html"><![CDATA[<h2 id="é’ˆå¯¹-value-çš„å€¼è¿›è¡Œä¿®æ”¹è§£é‡Š"><a href="#é’ˆå¯¹-value-çš„å€¼è¿›è¡Œä¿®æ”¹è§£é‡Š" class="headerlink" title="é’ˆå¯¹ value çš„å€¼è¿›è¡Œä¿®æ”¹è§£é‡Š"></a>é’ˆå¯¹ value çš„å€¼è¿›è¡Œä¿®æ”¹è§£é‡Š</h2><p>ä¸¾ä¸ªä¾‹å­ï¼šä½¿ç”¨ <code>snmp_exporter</code> å¯¹é˜²ç«å¢™è¿›è¡Œç›‘æ§ï¼Œç«¯å£çŠ¶æ€ç›‘æ§å€¼ä¸º <code>1</code> æˆ– <code>2</code>ï¼ˆ1 æ˜¯å¯ç”¨ï¼Œ2 æ˜¯æœªå¯ç”¨ï¼‰ï¼Œ åœ¨ Prometheus ä¸­çš„åŸå§‹æ•°æ®æ˜¯ï¼š</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202409261819318.png" alt="image.png|841"></p><p>åœ¨ <code>Grafana</code> ä¸­æ˜¾ç¤ºæ•ˆæœä¸ºï¼š<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202409261942989.png" alt="image.png"></p><p>å…¶ä¸­ï¼š<br><code>Value mappings</code> æ§åˆ¶æ•°å€¼å¯¹åº”çš„æ˜¾ç¤ºæ–‡å­—ã€‚<br><code>Thresholds</code> æ§åˆ¶æ•°å€¼å¯¹åº”çš„æ˜¾ç¤ºé¢œè‰²ã€‚</p><h2 id="é’ˆå¯¹-Legend-ä¿®æ”¹æè¿°æ–‡å­—"><a href="#é’ˆå¯¹-Legend-ä¿®æ”¹æè¿°æ–‡å­—" class="headerlink" title="é’ˆå¯¹ Legend ä¿®æ”¹æè¿°æ–‡å­—"></a>é’ˆå¯¹ Legend ä¿®æ”¹æè¿°æ–‡å­—</h2><p><code>Legend</code> è¿™é‡Œé…ç½®çš„æ˜¯ <code>&#123;&#123;ifName&#125;&#125;</code> æ˜¾ç¤ºå‡ºæ¥å°±æ˜¯ç±»ä¼¼ <code>ge0/2</code> ç­‰ï¼Œä¹Ÿå°±æ˜¯ <code>Prometheus</code> é‡ŒåŸå§‹æ•°æ®çš„æ ‡ç­¾åã€‚</p><p>å¦‚æœæˆ‘æƒ³æ ¹æ®è¿™ä¸ªåå­—æ¥æŒ‡å®šä¸€ä¸ªå¯¹åº”å…³ç³»æ¥æ˜¾ç¤ºï¼Œæ¯”å¦‚é¢†å¯¼ä¸çŸ¥é“ <code>ge0/2</code> æ˜¯ä»€ä¹ˆæ„æ€ï¼ˆå¼€ç©ç¬‘çš„ï¼Œæ²¡æ‰¾åˆ°åˆé€‚çš„ä¾‹å­ï¼‰ï¼Œå¯ä»¥å°† <code>ge0/2</code> è½¬æ¢ä¸ºï¼š<code>ç¬¬ä¸€æ’ç¬¬äºŒä¸ªç½‘å£</code>ï¼Œå¯ä»¥è¿™ä¹ˆé…ç½®ï¼š</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202409261958842.png" alt="image.png"></p>]]></content>
      
      
      <categories>
          
          <category> ç›‘æ§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> prometheus </tag>
            
            <tag> grafana </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nginx Ingress æš´éœ²æ²¡æœ‰å®šä¹‰Hostçš„ingressçš„Metricsæ•°æ®</title>
      <link href="/posts/sk5u8v/"/>
      <url>/posts/sk5u8v/</url>
      
        <content type="html"><![CDATA[<h2 id="æŒ‡å®šé»˜è®¤çš„-ingress-åç«¯"><a href="#æŒ‡å®šé»˜è®¤çš„-ingress-åç«¯" class="headerlink" title="æŒ‡å®šé»˜è®¤çš„ ingress åç«¯"></a>æŒ‡å®šé»˜è®¤çš„ ingress åç«¯</h2><p>åå­—æœ‰ç‚¹ç»•å£ï¼Œå‡å¦‚è¯´ä¹‹å‰æœ‰ä¸ªæœåŠ¡æ˜¯é€šè¿‡ <code>ip:port</code> æ¥è®¿é—® nginx(å°±æ˜¯ default server)ï¼Œç„¶åè½¬å‘åˆ°åç«¯æœåŠ¡çš„ï¼Œé‚£ä¹ˆè½¬æ¢æˆ ingress åï¼Œä¸èƒ½æŒ‡å®š hostï¼Œä¸ç„¶ä¼šåŒ¹é…ä¸åˆ°è§„åˆ™ã€‚ingress å°±ä¸èƒ½é…ç½® hostï¼Œåˆ›å»ºå‡ºæ¥çš„ ingress èµ„æºå°±æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/ssl-redirect:</span> <span class="string">&quot;false&quot;</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">g.example.com</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">http:</span></span><br><span class="line">      <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">serviceName:</span> <span class="string">server1</span></span><br><span class="line">          <span class="attr">servicePort:</span> <span class="number">5003</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">/sdk</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">serviceName:</span> <span class="string">server2</span></span><br><span class="line">          <span class="attr">servicePort:</span> <span class="number">8665</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">/tsp</span></span><br></pre></td></tr></table></figure><p>åˆ›å»ºå‡ºæ¥çš„ ingress èµ„æºæ˜¾ç¤ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@VM_233_33_centos new]<span class="comment"># kubectl get ingress</span></span><br><span class="line">NAME                               HOSTS   ADDRESS        PORTS   AGE</span><br><span class="line">g.example.com                      *       10.13.255.17   80      4h40m</span><br></pre></td></tr></table></figure><h2 id="metrics-ç›‘æ§æŒ‡æ ‡é—®é¢˜"><a href="#metrics-ç›‘æ§æŒ‡æ ‡é—®é¢˜" class="headerlink" title="metrics ç›‘æ§æŒ‡æ ‡é—®é¢˜"></a>metrics ç›‘æ§æŒ‡æ ‡é—®é¢˜</h2><p>å› ä¸ºä¸Šé¢æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª ingressï¼Œä½†æ˜¯æ²¡æœ‰æŒ‡å®š hostï¼Œåœ¨ ingress-nginx ä¸­ï¼Œæ²¡æœ‰ host çš„ ingress çš„ metrics æŒ‡æ ‡æ˜¯ä¸æ”¶é›†çš„ï¼Œä»£ç åœ¨æ­¤ï¼š<a href="https://github.com/kubernetes/ingress-nginx/blob/d82585917c845e598a2cd5d2c4291ce891b5e5b4/internal/ingress/metric/collectors/socket.go#L233-L235">https://github.com/kubernetes/ingress-nginx/blob/d82585917c845e598a2cd5d2c4291ce891b5e5b4/internal/ingress/metric/collectors/socket.go#L233-L235</a></p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202409231515944.png" alt="image.png|980"></p><p>GitHub ä¸Šæœ‰å¾ˆå¤šå¯¹åº”çš„ issuesï¼Œæ¯”å¦‚ï¼š<a href="https://github.com/kubernetes/ingress-nginx/issues/5755">https://github.com/kubernetes/ingress-nginx/issues/5755</a> å’Œ <a href="https://github.com/kubernetes/ingress-nginx/issues/3713">https://github.com/kubernetes/ingress-nginx/issues/3713</a><br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202409231511781.png" alt="image.png|738"></p><p>è¿™é‡Œæœ‰ä¸ªä¿®å¤é“¾æ¥ï¼Œ<code>https://github.com/kubernetes/ingress-nginx/pull/4139</code> ç†è®ºä¸Šåœ¨è¿™ä¸ªæ—¶é—´ä¹‹åçš„ç‰ˆæœ¬å°±å·²ç»ä¿®å¤äº†ï¼Œéœ€è¦æ·»åŠ å¯åŠ¨å‚æ•°ï¼š<code>--metrics-per-host=false</code>ï¼Œ yml æ–‡ä»¶å¦‚ä¸‹ï¼ˆéƒ¨åˆ†å†…å®¹ç²¾ç®€ï¼‰ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Source: ingress-nginx/templates/controller-deployment.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">dnsPolicy:</span> <span class="string">ClusterFirst</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">controller</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">k8s.gcr.io/ingress-nginx/controller:v0.35.0@sha256:fc4979d8b8443a831c9789b5155cded454cb7de737a8b727bc2ba0106d2eae8b</span></span><br><span class="line">          <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">          <span class="attr">lifecycle:</span></span><br><span class="line">            <span class="attr">preStop:</span></span><br><span class="line">              <span class="attr">exec:</span></span><br><span class="line">                <span class="attr">command:</span></span><br><span class="line">                  <span class="bullet">-</span> <span class="string">/wait-shutdown</span></span><br><span class="line">          <span class="attr">args:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">/nginx-ingress-controller</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">--election-id=ingress-controller-leader</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">--ingress-class=nginx</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">--configmap=$(POD_NAMESPACE)/ingress-nginx-controller</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">--validating-webhook=:8443</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">--validating-webhook-certificate=/usr/local/certificates/cert</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">--validating-webhook-key=/usr/local/certificates/key</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">--default-backend-service=$(POD_NAMESPACE)/ingress-nginx-default-backend</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">--metrics-per-host=false</span></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure><p>ç„¶åç­‰å¾…é‡å¯å®Œæˆï¼Œæ—¢å¯çœ‹åˆ°ç›‘æ§æŒ‡æ ‡ï¼šéœ€è¦æ³¨æ„æ ‡ç­¾çš„å˜åŒ–ï¼Œgrafana ä¸­ä¹Ÿéœ€è¦åšç›¸åº”çš„ä¿®æ”¹ã€‚</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202409231527790.png" alt="image.png"></p>]]></content>
      
      
      <categories>
          
          <category> å®¹å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Nginx </tag>
            
            <tag> ingress </tag>
            
            <tag> prometheus </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Kubernetesé…ç½®é•œåƒä»“åº“è®¤è¯imagePullSecrets</title>
      <link href="/posts/sjmzr1/"/>
      <url>/posts/sjmzr1/</url>
      
        <content type="html"><![CDATA[<h2 id="åˆ›å»º-secret"><a href="#åˆ›å»º-secret" class="headerlink" title="åˆ›å»º secret"></a>åˆ›å»º secret</h2><p>å¯ä»¥åœ¨ namespace é‡Œç”¨ä¸€ä¸ªå…¨å±€çš„ image pull secretï¼Œåˆ›å»ºä¸ª secretï¼Œå¦‚æœæœ‰ç‰¹æ®Šå­—ç¬¦çš„ï¼Œå¯ä»¥ç”¨å•å¼•å· â€˜ â€˜ å¼•èµ·æ¥ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker-secret æ˜¯ secret çš„åå­—</span></span><br><span class="line">kubectl create secret docker-registry docker-secret --docker-server=harbor.i.com --docker-username=<span class="string">&#x27;robot$ali&#x27;</span> --docker-password=123456 -n default</span><br></pre></td></tr></table></figure><h2 id="å…¨å±€é…ç½®"><a href="#å…¨å±€é…ç½®" class="headerlink" title="å…¨å±€é…ç½®"></a>å…¨å±€é…ç½®</h2><p>ç»™é»˜è®¤çš„ <code>serviceaccount</code> é…ç½® <code>imagePullSecrets</code> ï¼Œ è¿™æ ·é…ç½®å¥½äº†ä¹‹åï¼Œå°±æ— é¡»åœ¨æ¯ä¸ª deployment ä¸Šé…ç½®äº†ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl patch serviceaccount default -n default -p <span class="string">&#x27;&#123;&quot;imagePullSecrets&quot;: [&#123;&quot;name&quot;: &quot;docker-secret&quot;&#125;]&#125;&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="åœ¨æ¯ä¸ªæœåŠ¡ä¸Šå•ç‹¬é…ç½®"><a href="#åœ¨æ¯ä¸ªæœåŠ¡ä¸Šå•ç‹¬é…ç½®" class="headerlink" title="åœ¨æ¯ä¸ªæœåŠ¡ä¸Šå•ç‹¬é…ç½®"></a>åœ¨æ¯ä¸ªæœåŠ¡ä¸Šå•ç‹¬é…ç½®</h2><p>åœ¨æ¯ä¸ª deployment é‡Œé¢å¼•ç”¨è¿™ä¸ª secret</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-app</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">my-app</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">my-app</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">my-app-container</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">&lt;ç§æœ‰ä»“åº“çš„é•œåƒåœ°å€&gt;</span></span><br><span class="line">      <span class="attr">imagePullSecrets:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">docker-secret</span></span><br></pre></td></tr></table></figure><h2 id="æ— æ•ˆæ’æŸ¥"><a href="#æ— æ•ˆæ’æŸ¥" class="headerlink" title="æ— æ•ˆæ’æŸ¥"></a>æ— æ•ˆæ’æŸ¥</h2><p>å¦‚æœåˆ›å»ºäº†ä¸ç”Ÿæ•ˆï¼Œå¯ä»¥æ’æŸ¥ <code>secret</code> å†…å®¹æ˜¯å¦æ­£ç¡®ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl -n default get secret docker-secret --output=<span class="string">&quot;jsonpath=&#123;.data.\.dockerconfigjson&#125;&quot;</span> | <span class="built_in">base64</span> -d</span><br></pre></td></tr></table></figure><p>ç„¶åçœ‹ä¸‹ <code>username</code> å’Œ <code>password</code> å­—æ®µæ˜¯å¦æ­£ç¡®ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> å®¹å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>fail2banå¤±æ•ˆæ’æŸ¥</title>
      <link href="/posts/sjcnkn/"/>
      <url>/posts/sjcnkn/</url>
      
        <content type="html"><![CDATA[<h2 id="selinux"><a href="#selinux" class="headerlink" title="selinux"></a>selinux</h2><p>å®¹æ˜“å¿½ç•¥çš„ä¸€ç‚¹ï¼Œselinux ä¼šé™åˆ¶ fail2ban çš„æ‰§è¡Œï¼Œ æ‰‹åŠ¨è¿è¡Œ <code>/usr/bin/fail2ban-server -xf start</code> å¯ä»¥æ­£å¸¸è¿è¡Œï¼Œä½†æ˜¯ systemd å°±æ˜¯æ— æ³•å¯åŠ¨ï¼Œä¼šæŠ¥é”™æ‰¾ä¸åˆ°æ—¥å¿—æ–‡ä»¶ï¼Œè¿™ç§æƒ…å†µå¯ä»¥å°† selinux ç¦ç”¨å†æµ‹è¯•ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Sep 09 10:44:01 zhangfei fail2ban-server[1795]: 2024-09-09 10:44:01,134 fail2ban                [1795]: ERROR   Failed during configuration: Have not found any <span class="built_in">log</span> file <span class="keyword">for</span> nginx-http-cc jail</span><br><span class="line">Sep 09 10:44:01 zhangfei fail2ban-server[1795]: 2024-09-09 10:44:01,134 fail2ban                [1795]: ERROR   Async configuration of server failed</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨-fail2ban-regex-æ’æŸ¥è§„åˆ™"><a href="#ä½¿ç”¨-fail2ban-regex-æ’æŸ¥è§„åˆ™" class="headerlink" title="ä½¿ç”¨ fail2ban-regex æ’æŸ¥è§„åˆ™"></a>ä½¿ç”¨ fail2ban-regex æ’æŸ¥è§„åˆ™</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fail2ban-regex /var/log/xxx.log /etc/fail2ban/filter.d/xxx.conf</span><br></pre></td></tr></table></figure><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202409101104574.png" alt="image.png"></p><h2 id="IndexError"><a href="#IndexError" class="headerlink" title="IndexError"></a>IndexError</h2><p>ä½¿ç”¨ fail2ban åˆ†ææ—¥å¿—ï¼Œå°†æ¶æ„ IP å°é”ï¼Œé€šè¿‡ fail2ban-regex éªŒè¯ï¼ŒæŠ¥é”™ï¼š <code>IndexError: string index out of range</code></p><p>æ—¥å¿—æ˜¯ç»è¿‡ docker å¤„ç†è¿‡çš„ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;log&quot;</span><span class="punctuation">:</span><span class="string">&quot;\u001b[0m\u001b[1;34m2024-09-06 00:35:39.125 [I] [proxy/proxy.go:204] [83f2b08de40a51a0] [test.rdp] get a user connection [1.1.1.1:2276]\n&quot;</span><span class="punctuation">,</span><span class="attr">&quot;stream&quot;</span><span class="punctuation">:</span><span class="string">&quot;stdout&quot;</span><span class="punctuation">,</span><span class="attr">&quot;time&quot;</span><span class="punctuation">:</span><span class="string">&quot;2024-09-05T16:35:39.125745206Z&quot;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>filter æ–‡ä»¶ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Definition]</span></span><br><span class="line"><span class="attr">failregex</span> = ^.*get a user connection \[&lt;HOST&gt;:[<span class="number">0</span>-<span class="number">9</span>]*\]</span><br><span class="line">            ^.*get a new work connection: \<span class="section">[&lt;HOST&gt;:[0-9]</span>*\]</span><br><span class="line">ignoreregex =</span><br></pre></td></tr></table></figure><p>fail2ban-regex æŠ¥é”™å¦‚ä¸‹ï¼š</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202409060106166.png" alt="image.png"></p><p>é—®é¢˜åŸå› ï¼šæ—¥å¿—ä¸­å­˜åœ¨æ—¥æœŸå­—æ®µï¼Œdocker åˆç»™æ·»åŠ äº†ä¸€ä¸ªæ—¥æœŸå­—æ®µï¼Œå¯¼è‡´å­˜åœ¨ä¸¤ä¸ªæ—¥æœŸå­—æ®µï¼Œfail2ban æ— æ³•è§£æã€‚</p><p>è§£å†³æ–¹æ³•ï¼š æŒ‡å®šæ—¥æœŸæ ¼å¼</p><p>ä¿®æ”¹ filter æ–‡ä»¶ï¼Œå¢åŠ ä¸€è¡Œï¼šï¼ˆ<code>%%</code> è¡¨ç¤º <code>%</code>ï¼‰</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">datepattern</span> = %%Y-%%m-%%d %%H:%%M:%%S</span><br></pre></td></tr></table></figure><h2 id="é˜²ç«å¢™"><a href="#é˜²ç«å¢™" class="headerlink" title="é˜²ç«å¢™"></a>é˜²ç«å¢™</h2><p>æˆ‘éƒ½æ˜¯æŠŠç³»ç»Ÿè‡ªå¸¦çš„é˜²ç«å¢™å·¥å…·å…³æ‰çš„ï¼Œé¿å…é˜²ç«å¢™ç®¡ç†å·¥å…·å½±å“åˆ° fail2ban çš„æ­£å¸¸è¿è¡Œï¼Œå¦‚æœéœ€è¦ç”¨åˆ°é˜²ç«å¢™ï¼Œç›´æ¥ä½¿ç”¨ iptables å‘½ä»¤å°±è¡Œã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># for CentOS</span></span><br><span class="line">systemctl <span class="built_in">disable</span> --now firewalld</span><br><span class="line"></span><br><span class="line"><span class="comment"># for Ubuntu</span></span><br><span class="line">systemctl <span class="built_in">disable</span> --now ufw</span><br></pre></td></tr></table></figure><p>ç„¶ååˆ é™¤å…¼å®¹ firewalld çš„é…ç½®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mv</span> /etc/fail2ban/jail.d/00-firewalld.conf&#123;,.bak&#125;</span><br></pre></td></tr></table></figure><h2 id="Ubuntu-çš„é—®é¢˜"><a href="#Ubuntu-çš„é—®é¢˜" class="headerlink" title="Ubuntu çš„é—®é¢˜"></a>Ubuntu çš„é—®é¢˜</h2><p>å»ºè®®ä¸è¦ç”¨ Ubuntuï¼Œæˆ‘ç”¨äº†å°±æœ‰äº›è«åå…¶å¦™çš„é—®é¢˜ï¼Œç”¨ <code>fail2ban-regex</code> æ£€æµ‹éƒ½æ²¡æœ‰é—®é¢˜ï¼Œèƒ½æ­£å¸¸è¯†åˆ«åˆ°æ—¥å¿—ï¼Œä½†æ˜¯æ­£å¸¸å¯åŠ¨ fail2ban å°±ä¸èƒ½æ­£å¸¸è¯†åˆ«å¼‚å¸¸æ—¥å¿—ï¼Œæ¢æˆ AlmaLinux (RedHat ç³») å°±æ²¡é—®é¢˜äº†</p>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Prometheusä¸­æŸ¥è¯¢æ— æ•°æ®æä¾›é»˜è®¤å€¼</title>
      <link href="/posts/sjaoe0/"/>
      <url>/posts/sjaoe0/</url>
      
        <content type="html"><![CDATA[<p>å•ä¸€æ—¶é—´åºåˆ—ï¼ˆæ—¶é—´æˆ³ï¼‰çš„æ ·æœ¬ã€‚å…·ä½“æ¥è¯´ï¼Œ<code>vector(0)</code> å°†åˆ›å»ºä¸€ä¸ªåŒ…å«å€¼ 0 çš„ç¬æ—¶å‘é‡ï¼ˆå³åœ¨æŸä¸ªæ—¶é—´ç‚¹çš„æ—¶é—´åºåˆ—ï¼‰ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sum(increase(nginx_ingress_controller_requests&#123;status=~&quot;4.*&quot;&#125;[3m])) or vector(0)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„ <code>vector(0)</code> çš„ä½œç”¨æ˜¯ä¸ºæŸ¥è¯¢ç»“æœæä¾›ä¸€ä¸ªé»˜è®¤å€¼æˆ–å›é€€å€¼ã€‚å½“å‰é¢çš„ <code>sum(increase(...))</code> æŸ¥è¯¢æ²¡æœ‰è¿”å›ä»»ä½•ç»“æœæ—¶ï¼Œæ•´ä¸ªæŸ¥è¯¢å°†è¿”å› <code>vector(0)</code> ç”Ÿæˆçš„å€¼ï¼Œå³ 0ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç›‘æ§ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>kubectlå¯¼å‡ºçš„yamlå¿½ç•¥æŒ‡å®šå­—æ®µ</title>
      <link href="/posts/sj8cec/"/>
      <url>/posts/sj8cec/</url>
      
        <content type="html"><![CDATA[<p>kubectl æŒ‡å®š -o yaml è¾“å‡ºçš„ yaml æ–‡ä»¶åŒ…å«ä¸€äº›é»˜è®¤å­—æ®µï¼Œè¿™äº›å­—æ®µæˆ‘ä»¬æ˜¯ä¸éœ€è¦çš„ï¼Œå¯ä»¥ä½¿ç”¨ yq æ¥è¿›è¡Œå»é™¤è¿™äº›å­—æ®µï¼Œç”Ÿæˆçš„ yaml æ–‡ä»¶å¯ä»¥ç”¨äºè¿ç§»&#x2F;éƒ¨ç½²æœåŠ¡ç­‰ã€‚</p><h2 id="å®‰è£…-yq"><a href="#å®‰è£…-yq" class="headerlink" title="å®‰è£… yq"></a>å®‰è£… yq</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -L https://file.babudiu.com/f/AQHE/yq_linux_amd64 -o /bin/yq</span><br><span class="line"><span class="built_in">chmod</span> +x /bin/yq</span><br></pre></td></tr></table></figure><h2 id="å¯¼å‡º-deployment"><a href="#å¯¼å‡º-deployment" class="headerlink" title="å¯¼å‡º deployment"></a>å¯¼å‡º deployment</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">kubectl get deployment nginx -o yaml | yq <span class="built_in">eval</span> <span class="string">&#x27;</span></span><br><span class="line"><span class="string">  del(</span></span><br><span class="line"><span class="string">    .metadata.annotations,</span></span><br><span class="line"><span class="string">    .metadata.creationTimestamp,</span></span><br><span class="line"><span class="string">    .metadata.generation,</span></span><br><span class="line"><span class="string">    .metadata.resourceVersion,</span></span><br><span class="line"><span class="string">    .metadata.selfLink,</span></span><br><span class="line"><span class="string">    .metadata.uid, </span></span><br><span class="line"><span class="string">    .spec.progressDeadlineSeconds,</span></span><br><span class="line"><span class="string">    .spec.revisionHistoryLimit,</span></span><br><span class="line"><span class="string">    .spec.template.metadata.creationTimestamp,</span></span><br><span class="line"><span class="string">    .status</span></span><br><span class="line"><span class="string">    )</span></span><br><span class="line"><span class="string">&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="å¯¼å‡º-service"><a href="#å¯¼å‡º-service" class="headerlink" title="å¯¼å‡º service"></a>å¯¼å‡º service</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">kubectl get svc nginx -o yaml | yq <span class="built_in">eval</span> <span class="string">&#x27;</span></span><br><span class="line"><span class="string">  del(</span></span><br><span class="line"><span class="string">    .metadata.annotations,</span></span><br><span class="line"><span class="string">    .metadata.creationTimestamp,</span></span><br><span class="line"><span class="string">    .metadata.resourceVersion,</span></span><br><span class="line"><span class="string">    .metadata.selfLink,</span></span><br><span class="line"><span class="string">    .metadata.uid, </span></span><br><span class="line"><span class="string">    .spec.clusterIP,</span></span><br><span class="line"><span class="string">    .spec.externalTrafficPolicy,</span></span><br><span class="line"><span class="string">    .status</span></span><br><span class="line"><span class="string">    )</span></span><br><span class="line"><span class="string">&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="å¯¼å‡º-Configmap"><a href="#å¯¼å‡º-Configmap" class="headerlink" title="å¯¼å‡º Configmap"></a>å¯¼å‡º Configmap</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">kubectl get configmap nginx -o yaml | yq <span class="built_in">eval</span> <span class="string">&#x27;</span></span><br><span class="line"><span class="string">  del(</span></span><br><span class="line"><span class="string">    .metadata.annotations,</span></span><br><span class="line"><span class="string">    .metadata.creationTimestamp,</span></span><br><span class="line"><span class="string">    .metadata.resourceVersion,</span></span><br><span class="line"><span class="string">    .metadata.selfLink,</span></span><br><span class="line"><span class="string">    .metadata.uid</span></span><br><span class="line"><span class="string">    )</span></span><br><span class="line"><span class="string">&#x27;</span></span><br></pre></td></tr></table></figure><p>å¦‚æœå¯¼å‡ºçš„ configmap æ ¼å¼é”™ä¹±ï¼Œæ¢è¡Œç¬¦å˜æˆ <code>\n</code> ï¼Œå¯ä»¥ä½¿ç”¨ yq å†æ¬¡è¿›è¡Œæ ¼å¼åŒ–</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> prometheus_config.yaml | yq -r <span class="string">&#x27;.data.&quot;prometheus.yml&quot;&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="å¯¼å‡º-secret"><a href="#å¯¼å‡º-secret" class="headerlink" title="å¯¼å‡º secret"></a>å¯¼å‡º secret</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">kubectl get configmap nginx -o yaml | yq <span class="built_in">eval</span> <span class="string">&#x27;</span></span><br><span class="line"><span class="string">  del(</span></span><br><span class="line"><span class="string">    .metadata.creationTimestamp,</span></span><br><span class="line"><span class="string">    .metadata.resourceVersion,</span></span><br><span class="line"><span class="string">    .metadata.selfLink,</span></span><br><span class="line"><span class="string">    .metadata.uid</span></span><br><span class="line"><span class="string">    )</span></span><br><span class="line"><span class="string">&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="å¯¼å‡º-ingress"><a href="#å¯¼å‡º-ingress" class="headerlink" title="å¯¼å‡º ingress"></a>å¯¼å‡º ingress</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">kubectl get ingress example.com -o yaml | yq <span class="built_in">eval</span> <span class="string">&#x27;</span></span><br><span class="line"><span class="string">  del(</span></span><br><span class="line"><span class="string">    .metadata.annotations.&quot;kubectl.kubernetes.io/last-applied-configuration&quot;,</span></span><br><span class="line"><span class="string">    .metadata.creationTimestamp,</span></span><br><span class="line"><span class="string">    .metadata.finalizers,</span></span><br><span class="line"><span class="string">    .metadata.generation,</span></span><br><span class="line"><span class="string">    .metadata.resourceVersion,</span></span><br><span class="line"><span class="string">    .metadata.selfLink,</span></span><br><span class="line"><span class="string">    .metadata.uid,</span></span><br><span class="line"><span class="string">    .status</span></span><br><span class="line"><span class="string">    )</span></span><br><span class="line"><span class="string">&#x27;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å®¹å™¨ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>MySQLè¿›è¡Œæ–‡ä»¶æ“ä½œ</title>
      <link href="/posts/sio0v4/"/>
      <url>/posts/sio0v4/</url>
      
        <content type="html"><![CDATA[<p>æˆ‘æ‰§è¡Œäº†è¿™æ¡å‘½ä»¤ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> concat(<span class="string">&#x27;KILL &#x27;</span>,id,<span class="string">&#x27;;&#x27;</span>) <span class="keyword">from</span> information_schema.processlist <span class="keyword">where</span>  COMMAND<span class="operator">=</span><span class="string">&#x27;Query&#x27;</span> <span class="keyword">AND</span> <span class="type">time</span> <span class="operator">&gt;</span> <span class="number">10</span> <span class="keyword">into</span> outfile <span class="string">&#x27;/tmp/a.txt&#x27;</span>;</span><br></pre></td></tr></table></figure><p>æŠ¥é”™ï¼š <code>The MySQL server is running with the --secure-file-priv option so it cannot execute this statement</code></p><p>æŸ¥è¯¢ MySQL çš„å®‰å…¨æ–‡ä»¶ç›®å½•</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;%secure%&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------------+-----------------------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name            <span class="operator">|</span> <span class="keyword">Value</span>                 <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------------+-----------------------+</span></span><br><span class="line"><span class="operator">|</span> require_secure_transport <span class="operator">|</span> OFF                   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> secure_file_priv         <span class="operator">|</span> <span class="operator">/</span>var<span class="operator">/</span>lib<span class="operator">/</span>mysql<span class="operator">-</span>files<span class="operator">/</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------------+-----------------------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>æ–‡ä»¶å¯ä»¥å†™å…¥åˆ°è¿™ä¸ªç›®å½•ï¼Œä¿®æ”¹ä¸€ä¸‹ SQLï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> concat(<span class="string">&#x27;KILL &#x27;</span>,id,<span class="string">&#x27;;&#x27;</span>) <span class="keyword">from</span> information_schema.processlist <span class="keyword">where</span>  COMMAND<span class="operator">=</span><span class="string">&#x27;Query&#x27;</span> <span class="keyword">AND</span> <span class="type">time</span> <span class="operator">&gt;</span> <span class="number">10</span> <span class="keyword">into</span> outfile <span class="string">&#x27;/var/lib/mysql-files/a.txt&#x27;</span>;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>PyCharmé…åˆWSLè¿›è¡Œå¼€å‘</title>
      <link href="/posts/sik0ul/"/>
      <url>/posts/sik0ul/</url>
      
        <content type="html"><![CDATA[<p>æœ¬æ–‡ä½¿ç”¨ WSL2ï¼ŒWSL2 é‡Œé¢å®‰è£…äº† Dockerï¼Œ PyCharm æ”¯æŒçš„é…åˆ wsl è¿›è¡Œä½¿ç”¨çš„æ–¹æ³•æœ‰å¾ˆå¤šç§ï¼Œè¿™é‡Œæä¾›å‡ ä¸ªæ€è·¯</p><p>æ–¹æ³• 1: WSL è¿œç¨‹å¼€å‘ï¼ˆç›®å‰ BETA ç‰ˆï¼‰<br>æ–¹æ³• 2: ä»£ç æ”¾åœ¨ Windows ä¸Šï¼ŒPython è§£é‡Šå™¨åœ¨ WSL é‡Œ<br>æ–¹æ³• 3: ä»£ç æ”¾åœ¨ WSL é‡Œï¼ŒPython è§£é‡Šå™¨åœ¨ WSL é‡Œ<br>æ–¹æ³• 4: ä»£ç æ”¾åœ¨ WSL é‡Œï¼ŒPython è§£é‡Šå™¨åœ¨ WSL é‡Œçš„ Docker é‡Œ<br>æ–¹æ³• 5: ä»£ç æ”¾åœ¨ Windows ä¸Šï¼ŒPython è§£é‡Šå™¨æ”¾åœ¨ WSL é‡Œçš„ Docker é‡Œ<br>æ–¹æ³• 6: ç›´æ¥åœ¨ WSL é‡Œå®‰è£… Linux ç‰ˆçš„ PyCharmï¼ˆWSL æ”¯æŒ GUI ç¨‹åºè¿è¡Œï¼‰<br>æ–¹æ³• 7: ä½¿ç”¨ devcontainerï¼ˆä¸å¥½ç”¨ï¼‰</p><p>æˆ‘æœ€æ¨èçš„ï¼š å°†ä»£ç æ”¾åœ¨ WSL ä¸­ï¼Œå°† Python è§£é‡Šå™¨æ”¾åœ¨ WSL ä¸­ã€‚</p><h2 id="ä»£ç æ”¾åœ¨-WSL-é‡Œï¼ŒPython-è§£é‡Šå™¨åœ¨-WSL-é‡Œ"><a href="#ä»£ç æ”¾åœ¨-WSL-é‡Œï¼ŒPython-è§£é‡Šå™¨åœ¨-WSL-é‡Œ" class="headerlink" title="ä»£ç æ”¾åœ¨ WSL é‡Œï¼ŒPython è§£é‡Šå™¨åœ¨ WSL é‡Œ"></a>ä»£ç æ”¾åœ¨ WSL é‡Œï¼ŒPython è§£é‡Šå™¨åœ¨ WSL é‡Œ</h2><p>é¦–é€‰ï¼Œè¿™ä¸ªæ—¶å€™æ‰§è¡Œçš„å°±æ˜¯ wsl é‡Œçš„ç¨‹åºï¼Œæ¯”å¦‚ git è°ƒç”¨çš„å°±æ˜¯ wsl é‡Œçš„ git ç¨‹åºã€‚</p><p>ä½¿ç”¨æ–¹æ³•ï¼š</p><ol><li>è¿›å…¥ WSL ç»ˆç«¯æ‹‰å–ä»£ç ï¼ˆPyCharm ç›®å‰ä¸æ”¯æŒæ‹‰ä»£ç åˆ° WSL é‡Œï¼‰</li><li>åœ¨ PyCharm é‡Œæ‰“å¼€é¡¹ç›®ï¼Œé¡¹ç›®è·¯å¾„å¦‚å›¾ï¼š<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202408161038687.png" alt="image.png"></li></ol><p>æ‰“å¼€ PyCharm ç»ˆç«¯ä¼šè‡ªåŠ¨è¿›å…¥ WSL ç¯å¢ƒã€‚ä½†éœ€è¦æ‰‹åŠ¨ source æ‰èƒ½è¿›å…¥è™šæ‹Ÿç¯å¢ƒã€‚</p><h2 id="è¿œç¨‹å¼€å‘"><a href="#è¿œç¨‹å¼€å‘" class="headerlink" title="è¿œç¨‹å¼€å‘"></a>è¿œç¨‹å¼€å‘</h2><p>å¤‡é€‰æ–¹æ¡ˆ</p><p>è¿œç¨‹å¼€å‘éœ€è¦åœ¨ WSL é‡Œå®‰è£…ä¸€ä¸ª PyCharm æœåŠ¡ç‰ˆï¼ˆä½¿ç”¨è¿œç¨‹å¼€å‘ä¼šè‡ªåŠ¨å®‰è£…ï¼‰ï¼Œå¹¶ç”¨ Windows çš„ PyCharm è¿æ¥ä¸Šå®ƒï¼Œä½¿ç”¨æ–¹å¼å’Œç›´æ¥ç”¨ Linux ç‰ˆçš„ç›¸ä¼¼ï¼Œç¼ºç‚¹æ˜¯æ¯æ¬¡æ›´æ–° PyCharm åï¼Œåœ¨ WSL é‡Œä¹Ÿéœ€è¦æ›´æ–°ä¸€ä¸‹ã€‚è¿˜æœ‰ä¸€ä¸ªç¼ºç‚¹ï¼šä¸èƒ½ç›´æ¥å¯åŠ¨ï¼Œå¿…é¡»ä» Windows çš„ PyCharm ç‚¹å‡»è¿œç¨‹å¼€å‘ï¼Œç„¶åä¼šå†è¿è¡Œä¸€ä¸ª PyCharmã€‚<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202408161023064.png" alt="image.png"></p><p>èŠ±é‡Œèƒ¡å“¨çš„ç»ˆç«¯ä¼šä¹±ç <br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202408161030953.png" alt="image.png"></p><p>æ¯•ç«Ÿèµ°ç½‘ç»œé€šä¿¡ï¼Œè¿œç¨‹å¼€å‘ä¼šæœ‰ä¸€ç‚¹å»¶è¿Ÿã€‚<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202408161032027.png" alt="image.png"></p><p>è¿œç¨‹å¼€å‘ä¼˜åŠ¿ï¼š å¯ä»¥ç›´æ¥ä½¿ç”¨ Linux æœ¬åœ°è§£é‡Šå™¨ï¼Œè·¯å¾„ä¹Ÿéƒ½æ˜¯ Linux è·¯å¾„</p><h2 id="ä½¿ç”¨-WSL-é‡Œçš„-Python-è§£é‡Šå™¨"><a href="#ä½¿ç”¨-WSL-é‡Œçš„-Python-è§£é‡Šå™¨" class="headerlink" title="ä½¿ç”¨ WSL é‡Œçš„ Python è§£é‡Šå™¨"></a>ä½¿ç”¨ WSL é‡Œçš„ Python è§£é‡Šå™¨</h2><p>ç¼ºç‚¹ï¼š PyCharm è‡ªå¸¦çš„ç»ˆç«¯éœ€è¦é…ç½®ï¼Œä¸ç„¶é»˜è®¤æ‰“å¼€çš„æ˜¯ PowerShellï¼Œéœ€è¦å…ˆæ‰§è¡Œ WSL å‘½ä»¤è¿›å…¥ WSLï¼Œç„¶åæ‰§è¡Œ <code>source ~/.virtualenvs/auppus-drf/bin/activate</code> æ‰èƒ½åŠ è½½è™šæ‹Ÿç¯å¢ƒã€‚è°ƒç”¨çš„ GIT ç­‰ç¨‹åºï¼Œç”¨çš„æ˜¯ Windows ä¸Šçš„ã€‚</p><h2 id="ä½¿ç”¨-WSL-è¿è¡Œå›¾å½¢ç‰ˆ-PyCharm"><a href="#ä½¿ç”¨-WSL-è¿è¡Œå›¾å½¢ç‰ˆ-PyCharm" class="headerlink" title="ä½¿ç”¨ WSL è¿è¡Œå›¾å½¢ç‰ˆ PyCharm"></a>ä½¿ç”¨ WSL è¿è¡Œå›¾å½¢ç‰ˆ PyCharm</h2><p>ä¸ç¨³å®šï¼Œä¸æ¨èäº†ã€‚æƒ³è¦è¾“å…¥ä¸­æ–‡ï¼Œè¾“å…¥æ³•éœ€è¦ç”¨ WSL é‡Œçš„è¾“å…¥æ³•ï¼Œå¾ˆéº»çƒ¦è¿˜ä¸ç¨³å®šã€‚</p><h2 id="ä¾èµ–-Docker-çš„æ–¹æ³•"><a href="#ä¾èµ–-Docker-çš„æ–¹æ³•" class="headerlink" title="ä¾èµ– Docker çš„æ–¹æ³•"></a>ä¾èµ– Docker çš„æ–¹æ³•</h2><p>æ‰€æœ‰ä½¿ç”¨ Docker çš„æ–¹æ³•éƒ½ä¸å¥½ç”¨ï¼Œæ…¢ä¸è¯´è¿˜ä¸æ–¹ä¾¿ï¼Œä½¿ç”¨ Docker çœ‹èµ·æ¥å¾ˆç¾å¥½ï¼Œä½†æ˜¯çœŸçš„ä¸å¥½ç”¨ã€‚åŒ…æ‹¬ devcontainerï¼Œå¦‚æœä½ è§‰å¾—å¥½ç”¨ï¼Œé‚£ä½ æ˜¯å¯¹çš„ï¼Œæ˜¯æˆ‘ç”¨çš„å§¿åŠ¿ä¸å¯¹ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¼€å‘å·¥å…·é…ç½® </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨Pythonå¼€å‘ä¸€ä¸ªPrometheus exporter</title>
      <link href="/posts/siij5o/"/>
      <url>/posts/siij5o/</url>
      
        <content type="html"><![CDATA[<p>éœ€æ±‚ï¼šéœ€è¦ç›‘æ§æŒ‡å®šçš„é‚®ç®±å‘é€é‚®ä»¶æ˜¯å¦æ­£å¸¸ï¼Œä½¿ç”¨ Prometheus å®˜æ–¹çš„ Python sdkï¼Œä»£ç å¦‚ä¸‹ï¼š</p><h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> prometheus_client <span class="keyword">import</span> start_http_server, Gauge</span><br><span class="line"><span class="keyword">import</span> smtplib</span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ª Gauge ç±»å‹çš„æŒ‡æ ‡</span></span><br><span class="line">EMAIL_AUTHENTICATION_SUCCESS = Gauge(<span class="string">&#x27;email_authentication_success&#x27;</span>, <span class="string">&#x27;Indicates if the email authentication was successful&#x27;</span>, [<span class="string">&#x27;email&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_email_authentication</span>(<span class="params">email, password, smtp_server, smtp_port</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        server = smtplib.SMTP_SSL(smtp_server, smtp_port)</span><br><span class="line">        server.login(email, password)</span><br><span class="line">        <span class="comment"># å¦‚æœç™»å½•æˆåŠŸï¼Œåˆ™æ›´æ–°æŒ‡æ ‡ä¸º 1</span></span><br><span class="line">        EMAIL_AUTHENTICATION_SUCCESS.labels(email=email).<span class="built_in">set</span>(<span class="number">1</span>)</span><br><span class="line">        server.quit()</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="comment"># å¦‚æœç™»å½•å¤±è´¥ï¼Œåˆ™æ›´æ–°æŒ‡æ ‡ä¸º 0</span></span><br><span class="line">        EMAIL_AUTHENTICATION_SUCCESS.labels(email=email).<span class="built_in">set</span>(<span class="number">0</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Failed to authenticate email <span class="subst">&#123;email&#125;</span>: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    parser = argparse.ArgumentParser(description=<span class="string">&#x27;Email Authentication Prometheus Exporter&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--email&#x27;</span>, required=<span class="literal">True</span>, <span class="built_in">help</span>=<span class="string">&#x27;Email address to authenticate&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--password&#x27;</span>, required=<span class="literal">True</span>, <span class="built_in">help</span>=<span class="string">&#x27;Password for the email account&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--smtp_server&#x27;</span>, default=<span class="string">&#x27;smtp.gmail.com&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;SMTP server address&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--smtp_port&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">int</span>, default=<span class="number">587</span>, <span class="built_in">help</span>=<span class="string">&#x27;SMTP server port&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    args = parser.parse_args()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¯åŠ¨ Prometheus HTTP æœåŠ¡</span></span><br><span class="line">    start_http_server(<span class="number">8000</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Prometheus exporter is running on port 80. Use CTRL+C to exit.&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è®©ç¨‹åºä¿æŒè¿è¡Œ</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="comment"># è¿›è¡Œé‚®ç®±éªŒè¯</span></span><br><span class="line">        check_email_authentication(args.email, args.password, args.smtp_server, args.smtp_port)</span><br><span class="line">        <span class="comment"># ç­‰å¾…ä¸€å°æ—¶ï¼Œé¢‘ç‡å¤ªå¿«å®¹æ˜“è¢«banï¼Ÿ</span></span><br><span class="line">        time.sleep(<span class="number">3600</span>)</span><br></pre></td></tr></table></figure><h2 id="å±•ç¤º"><a href="#å±•ç¤º" class="headerlink" title="å±•ç¤º"></a>å±•ç¤º</h2><p>é‚®ä»¶ç™»å½•æ­£å¸¸ï¼š<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202408201734136.png" alt="image.png"></p><p>æ–­å¼€ç½‘ç»œï¼Œæˆ–è€…ä¿®æ”¹é‚®ç®±å¯†ç ï¼š<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202408201741839.png" alt="image.png"></p><p>Prometheus ç•Œé¢æŸ¥è¯¢<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202408201838450.png" alt="image.png"></p><h2 id="ä½¿ç”¨æ–¹å¼"><a href="#ä½¿ç”¨æ–¹å¼" class="headerlink" title="ä½¿ç”¨æ–¹å¼"></a>ä½¿ç”¨æ–¹å¼</h2><p>å®‰è£…ä¾èµ–åŒ…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install prometheus-client</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯åŠ¨ exporter</span></span><br><span class="line">python3.8 email_exporter.py --email qq@qq.com --password xxx --smtp_server smtp.feishu.cn --smtp_port 465</span><br></pre></td></tr></table></figure><h2 id="éƒ¨ç½²åˆ°-Kubernetes"><a href="#éƒ¨ç½²åˆ°-Kubernetes" class="headerlink" title="éƒ¨ç½²åˆ° Kubernetes"></a>éƒ¨ç½²åˆ° Kubernetes</h2><h3 id="Dockerfile"><a href="#Dockerfile" class="headerlink" title="Dockerfile"></a>Dockerfile</h3><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> python:<span class="number">3.9</span>-slim</span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash"> email-exporter.py /</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> pip3 install prometheus-client</span></span><br></pre></td></tr></table></figure><h3 id="yaml"><a href="#yaml" class="headerlink" title="yaml"></a>yaml</h3><p>éƒ¨ç½²åˆ° Kubernetesï¼Œå€ŸåŠ© Prometheus æœåŠ¡å‘ç°å°† service çš„ metrics æ•°æ®æ¥å…¥</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">email-exporter</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">ops</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">email-exporter</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">email-exporter</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">image:</span> <span class="string">registry.cn-hangzhou.aliyuncs.com/iuxt/email-exporter:1</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">email-exporter</span></span><br><span class="line">          <span class="attr">command:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&quot;bash&quot;</span></span><br><span class="line">          <span class="attr">args:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&quot;-c&quot;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&quot;python3 -u /email-exporter.py --email qq@qq.com --password xxx --smtp_server smtp.feishu.cn --smtp_port 465&quot;</span></span><br><span class="line">          <span class="attr">resources:</span></span><br><span class="line">            <span class="attr">limits:</span></span><br><span class="line">              <span class="attr">cpu:</span> <span class="string">200m</span></span><br><span class="line">              <span class="attr">memory:</span> <span class="string">200Mi</span></span><br><span class="line">            <span class="attr">requests:</span></span><br><span class="line">              <span class="attr">cpu:</span> <span class="string">200m</span></span><br><span class="line">              <span class="attr">memory:</span> <span class="string">200Mi</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">prometheus.io/env:</span> <span class="string">dev</span></span><br><span class="line">    <span class="attr">prometheus.io/path:</span> <span class="string">/</span></span><br><span class="line">    <span class="attr">prometheus.io/port:</span> <span class="string">&quot;80&quot;</span></span><br><span class="line">    <span class="attr">prometheus.io/project:</span> <span class="string">idp</span></span><br><span class="line">    <span class="attr">prometheus.io/scrape:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">email-exporter</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">ops</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">      <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">80</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">email-exporter</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">ClusterIP</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="å…¶ä»–é—®é¢˜"><a href="#å…¶ä»–é—®é¢˜" class="headerlink" title="å…¶ä»–é—®é¢˜"></a>å…¶ä»–é—®é¢˜</h2><p>python å®¹å™¨åŒ–éƒ¨ç½²ä¸äº§ç”Ÿæ§åˆ¶å°æ—¥å¿—ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨éƒ¨ç½²pythonçš„å®¹å™¨æœåŠ¡æ—¶ï¼Œdocker logs/kubectl logsè·å–ä¸åˆ°çš„ä¸»è¦åŸå› æ˜¯printçš„æ ‡å‡†æ§åˆ¶å°è¾“å‡ºï¼Œäº§ç”Ÿäº†bufferï¼Œå¯¼è‡´æ§åˆ¶å°è¾“å‡ºä¸åŠæ—¶ã€‚è§£å†³è¯¥ç¼“å­˜é—®é¢˜æˆ–è€…ç¦æ­¢bufferå³å¯</span></span><br><span class="line">python -u xx.py</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç›‘æ§ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Alpineå®¹å™¨æ–‡ä»¶åç¼€æµè§ˆå™¨ä¸‹è½½å˜æˆzip</title>
      <link href="/posts/siid4q/"/>
      <url>/posts/siid4q/</url>
      
        <content type="html"><![CDATA[<p>æ¯”å¦‚ä¸€ä¸ªç½‘ç›˜ç¨‹åºï¼Œä¸Šä¼ äº†ä¸€ä¸ª excel æ–‡ä»¶ï¼Œç‚¹å‡»è·å–ç›´é“¾ï¼Œç„¶åå°†è·å–åˆ°çš„ç›´é“¾æ”¾åˆ°æµè§ˆå™¨åœ°å€æ è®¿é—®è§¦å‘ä¸‹è½½ï¼Œä¸‹è½½ä¸‹æ¥çš„æ–‡ä»¶åç¼€è‡ªåŠ¨å˜æˆäº†.zip<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202408201603813.png" alt="image.png"></p><p>è¿™æ˜¯å› ä¸º Alpine é•œåƒæ¯”è¾ƒç²¾ç®€ï¼Œç¼ºå°‘äº†å¾ˆå¤š MIME ç±»å‹æ•°æ®ï¼Œå¯ä»¥é€šè¿‡å®‰è£… <code>mailcap</code> åŒ…æ¥è§£å†³ã€‚</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> Alpine:latest</span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apk add --no-cache mailcap</span></span><br></pre></td></tr></table></figure><p>å†æ¬¡æµ‹è¯•ï¼Œå·²ç»æ­£å¸¸</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202408201613078.png" alt="image.png"></p>]]></content>
      
      
      <categories>
          
          <category> å®¹å™¨ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>nginx Ingress å¯¹æŒ‡å®šè·¯å¾„å»é™¤ contextpath</title>
      <link href="/posts/sib2vi/"/>
      <url>/posts/sib2vi/</url>
      
        <content type="html"><![CDATA[<p>è¦åœ¨ Kubernetes ä¸­é…ç½® Nginx Ingress ä»¥ä¾¿è½¬å‘åˆ°åç«¯æ—¶å»æ‰ <code>contextPath</code>ï¼Œä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹æ­¥éª¤æ¥å®ç°ï¼š</p><h2 id="å•ä¸ª-path-å»æ‰-contextpath"><a href="#å•ä¸ª-path-å»æ‰-contextpath" class="headerlink" title="å•ä¸ª path å»æ‰ contextpath"></a>å•ä¸ª path å»æ‰ contextpath</h2><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªæœåŠ¡åœ¨ <code>/app</code> è·¯å¾„ä¸‹è¿è¡Œï¼Œå¹¶å¸Œæœ›é€šè¿‡ Ingress ç›´æ¥è®¿é—®åç«¯æœåŠ¡çš„æ ¹è·¯å¾„ <code>/</code>ï¼Œå¯ä»¥å¦‚ä¸‹é…ç½®ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">example-ingress</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/rewrite-target:</span> <span class="string">/$2</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">example.com</span></span><br><span class="line">    <span class="attr">http:</span></span><br><span class="line">      <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/app(/|$)(.*)</span></span><br><span class="line">        <span class="attr">pathType:</span> <span class="string">ImplementationSpecific</span></span><br><span class="line">        <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">service:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">example-service</span></span><br><span class="line">            <span class="attr">port:</span></span><br><span class="line">              <span class="attr">number:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure><h3 id="2-æ˜¯ä»€ä¹ˆ"><a href="#2-æ˜¯ä»€ä¹ˆ" class="headerlink" title="$2 æ˜¯ä»€ä¹ˆ"></a>$2 æ˜¯ä»€ä¹ˆ</h3><p>å‡è®¾ä¸€ä¸ªè¯·æ±‚è·¯å¾„æ˜¯ <code>/app1/foo/bar</code>ï¼Œæ ¹æ®è·¯å¾„åŒ¹é…è§„åˆ™ <code>/app1(/|$)(.*)</code>ï¼š</p><p>ç¬¬ä¸€ç»„ <code>(/|$)</code> åŒ¹é…çš„æ˜¯ <code>/</code>ã€‚<br>ç¬¬äºŒç»„ <code>(.*)</code> åŒ¹é…çš„æ˜¯ <code>foo/bar</code>ã€‚<br>å› æ­¤ï¼Œ<code>$2</code> å°†åŒ…å« <code>foo/bar</code>ï¼Œé‡å†™åçš„ç›®æ ‡è·¯å¾„ä¸º <code>/foo/bar</code>ã€‚</p><p><code>pathType: ImplementationSpecific</code>: å…è®¸è·¯å¾„åŒ¹é…ç±»å‹ç”±å…·ä½“çš„ Ingress æ§åˆ¶å™¨å®ç°å†³å®šã€‚åœ¨ <code>Nginx</code> ä¸­ï¼Œè¿™é€šå¸¸è¡¨ç¤ºä½¿ç”¨æœ€é•¿å‰ç¼€åŒ¹é…ã€‚</p><h2 id="å¦‚æœæœ‰å¤šä¸ª-location-éœ€è¦å¯¹å…¶ä¸­ä¸€ä¸ª-location-å»é™¤-contextpath"><a href="#å¦‚æœæœ‰å¤šä¸ª-location-éœ€è¦å¯¹å…¶ä¸­ä¸€ä¸ª-location-å»é™¤-contextpath" class="headerlink" title="å¦‚æœæœ‰å¤šä¸ª location éœ€è¦å¯¹å…¶ä¸­ä¸€ä¸ª location å»é™¤ contextpath"></a>å¦‚æœæœ‰å¤šä¸ª location éœ€è¦å¯¹å…¶ä¸­ä¸€ä¸ª location å»é™¤ contextpath</h2><h3 id="æ–¹æ³•ä¸€ï¼š-ä½¿ç”¨å¤šä¸ª-Ingressï¼Œé…ç½®åŒä¸€ä¸ªåŸŸå"><a href="#æ–¹æ³•ä¸€ï¼š-ä½¿ç”¨å¤šä¸ª-Ingressï¼Œé…ç½®åŒä¸€ä¸ªåŸŸå" class="headerlink" title="æ–¹æ³•ä¸€ï¼š ä½¿ç”¨å¤šä¸ª Ingressï¼Œé…ç½®åŒä¸€ä¸ªåŸŸå"></a>æ–¹æ³•ä¸€ï¼š ä½¿ç”¨å¤šä¸ª Ingressï¼Œé…ç½®åŒä¸€ä¸ªåŸŸå</h3><p>ä¸ªäººæ¯”è¾ƒæ¨èè¿™ç§é…ç½®</p><p>ingress1:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ibr-portal</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">kubernetes.io/ingress.class:</span> <span class="string">apple-internet</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">tls:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">hosts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">register.example.com</span></span><br><span class="line">      <span class="attr">secretName:</span> <span class="string">example-com</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">register.example.com</span></span><br><span class="line">      <span class="attr">http:</span></span><br><span class="line">        <span class="attr">paths:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/</span></span><br><span class="line">            <span class="attr">pathType:</span> <span class="string">ImplementationSpecific</span></span><br><span class="line">            <span class="attr">backend:</span></span><br><span class="line">              <span class="attr">service:</span></span><br><span class="line">                <span class="attr">name:</span> <span class="string">ibr-wfe</span></span><br><span class="line">                <span class="attr">port:</span></span><br><span class="line">                  <span class="attr">number:</span> <span class="number">80</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/job</span></span><br><span class="line">            <span class="attr">pathType:</span> <span class="string">ImplementationSpecific</span></span><br><span class="line">            <span class="attr">backend:</span></span><br><span class="line">              <span class="attr">service:</span></span><br><span class="line">                <span class="attr">name:</span> <span class="string">xxl-job</span></span><br><span class="line">                <span class="attr">port:</span></span><br><span class="line">                  <span class="attr">number:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure><p>ingress2:<br>è¿™ä¸ª ingress æ˜¯éœ€è¦å»é™¤ contextpath çš„è·¯å¾„ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ibr</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">kubernetes.io/ingress.class:</span> <span class="string">apple-internet</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/rewrite-target:</span> <span class="string">/$2</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">tls:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">hosts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">register.example.com</span></span><br><span class="line">      <span class="attr">secretName:</span> <span class="string">example-com</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">register.example.com</span></span><br><span class="line">      <span class="attr">http:</span></span><br><span class="line">        <span class="attr">paths:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/ibr(/|$)(.*)</span></span><br><span class="line">            <span class="attr">pathType:</span> <span class="string">ImplementationSpecific</span></span><br><span class="line">            <span class="attr">backend:</span></span><br><span class="line">              <span class="attr">service:</span></span><br><span class="line">                <span class="attr">name:</span> <span class="string">ibr</span></span><br><span class="line">                <span class="attr">port:</span></span><br><span class="line">                  <span class="attr">number:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure><h3 id="æ–¹æ³•äºŒï¼šç›´æ¥ä½¿ç”¨-Nginx-é…ç½®"><a href="#æ–¹æ³•äºŒï¼šç›´æ¥ä½¿ç”¨-Nginx-é…ç½®" class="headerlink" title="æ–¹æ³•äºŒï¼šç›´æ¥ä½¿ç”¨ Nginx é…ç½®"></a>æ–¹æ³•äºŒï¼šç›´æ¥ä½¿ç”¨ Nginx é…ç½®</h3><p>è¿™ä¸ªç”¨ ingress å¥½åƒå®ç°ä¸äº†äº†ï¼Œéœ€è¦ç”¨åˆ°åŸç”Ÿçš„ Nginx é…ç½®ï¼Œå¢åŠ ä¸€æ¡ <code>server-snippet</code> æ³¨è§£ï¼Œè®°å¾—å…¨å±€ configmap ä¹Ÿéœ€è¦å¼€å¯ server-snippet æ”¯æŒã€‚è¿™ä¸ªæ–¹æ¡ˆæœ‰ä¸ªç¼ºç‚¹ï¼Œå¦‚æœæˆ‘åˆ é™¤äº† service ç„¶åå†åˆ›å»ºä¸ªåŒåçš„ serviceï¼Œè¿˜æ˜¯è®¿é—®ä¸äº†çš„ï¼Œè¿™ä¸ªæ˜¯ Nginx çš„ç‰¹æ€§ï¼Œnginx proxy_pass å¦‚æœé…ç½®äº†åŸŸåï¼Œé‚£ä¹ˆ nginx ä¼šå°†åŸŸåè§£æçš„ IP ç¼“å­˜ä¸‹æ¥ï¼Œä¸ä¼šæ›´æ–°çš„ã€‚é™¤éä½  reload æˆ– restart</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ibr-portal</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">kubernetes.io/ingress.class:</span> <span class="string">apple-internet</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/server-snippet:</span> <span class="string">|</span></span><br><span class="line"><span class="string">      location /ibr &#123;</span></span><br><span class="line"><span class="string">        proxy_pass http://ibr.default/; </span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">tls:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">hosts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">register.example.com</span></span><br><span class="line">      <span class="attr">secretName:</span> <span class="string">example-com</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">register.example.com</span></span><br><span class="line">      <span class="attr">http:</span></span><br><span class="line">        <span class="attr">paths:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/</span></span><br><span class="line">            <span class="attr">pathType:</span> <span class="string">ImplementationSpecific</span></span><br><span class="line">            <span class="attr">backend:</span></span><br><span class="line">              <span class="attr">service:</span></span><br><span class="line">                <span class="attr">name:</span> <span class="string">ibr-wfe</span></span><br><span class="line">                <span class="attr">port:</span></span><br><span class="line">                  <span class="attr">number:</span> <span class="number">80</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/job</span></span><br><span class="line">            <span class="attr">pathType:</span> <span class="string">ImplementationSpecific</span></span><br><span class="line">            <span class="attr">backend:</span></span><br><span class="line">              <span class="attr">service:</span></span><br><span class="line">                <span class="attr">name:</span> <span class="string">xxl-job</span></span><br><span class="line">                <span class="attr">port:</span></span><br><span class="line">                  <span class="attr">number:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å®¹å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ingress </tag>
            
            <tag> contextpath </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CentOS 7 åœæ­¢ç»´æŠ¤åå¦‚ä½•ä½¿ç”¨</title>
      <link href="/posts/si78gg/"/>
      <url>/posts/si78gg/</url>
      
        <content type="html"><![CDATA[<p>CentOS 7 åœæ­¢ç»´æŠ¤åï¼Œå¾ˆå¤šæºéƒ½å¤±æ•ˆäº†ï¼Œä½¿ç”¨ yum çš„æ—¶å€™æŠ¥é”™ 404ï¼Œéœ€è¦ä¿®æ”¹æºæ‰èƒ½ç»§ç»­ä½¿ç”¨ã€‚</p><p>è€ç‰ˆæœ¬ CentOS æºè¢«æ›´æ”¹æˆ vault æºï¼Œéœ€è¦æ›´æ¢æˆ vault æºæ‰èƒ½ç»§ç»­ä½¿ç”¨ yumã€‚</p><h2 id="ä¸€ã€ä¿®æ”¹æˆå®˜æ–¹æº"><a href="#ä¸€ã€ä¿®æ”¹æˆå®˜æ–¹æº" class="headerlink" title="ä¸€ã€ä¿®æ”¹æˆå®˜æ–¹æº"></a>ä¸€ã€ä¿®æ”¹æˆå®˜æ–¹æº</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo sed -i.bak \</span><br><span class="line">  -e <span class="string">&#x27;s|^mirrorlist=|#mirrorlist=|g&#x27;</span> \</span><br><span class="line">  -e <span class="string">&#x27;s|^#baseurl=http://mirror.centos.org/centos|baseurl=https://vault.centos.org/centos|g&#x27;</span> \</span><br><span class="line">  /etc/yum.repos.d/CentOS-Base.repo</span><br></pre></td></tr></table></figure><h2 id="äºŒã€æ¢æˆé˜¿é‡Œäº‘æº"><a href="#äºŒã€æ¢æˆé˜¿é‡Œäº‘æº" class="headerlink" title="äºŒã€æ¢æˆé˜¿é‡Œäº‘æº"></a>äºŒã€æ¢æˆé˜¿é‡Œäº‘æº</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span><br></pre></td></tr></table></figure><h2 id="ä¸‰ã€æ›´æ¢æˆä¸­ç§‘å¤§çš„æº"><a href="#ä¸‰ã€æ›´æ¢æˆä¸­ç§‘å¤§çš„æº" class="headerlink" title="ä¸‰ã€æ›´æ¢æˆä¸­ç§‘å¤§çš„æº"></a>ä¸‰ã€æ›´æ¢æˆä¸­ç§‘å¤§çš„æº</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; /etc/yum.repos.d/CentOS-Base.repo &lt;&lt;-<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">[base]</span><br><span class="line">name=CentOS-<span class="variable">$releasever</span> - Base</span><br><span class="line"><span class="comment">#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&amp;arch=$basearch&amp;repo=os&amp;infra=$infra</span></span><br><span class="line">baseurl=https://mirrors.ustc.edu.cn/centos-vault/centos/<span class="variable">$releasever</span>/os/<span class="variable">$basearch</span>/</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span><br><span class="line"></span><br><span class="line"><span class="comment">#released updates</span></span><br><span class="line">[updates]</span><br><span class="line">name=CentOS-<span class="variable">$releasever</span> - Updates</span><br><span class="line"><span class="comment">#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&amp;arch=$basearch&amp;repo=updates&amp;infra=$infra</span></span><br><span class="line">baseurl=https://mirrors.ustc.edu.cn/centos-vault/centos/<span class="variable">$releasever</span>/updates/<span class="variable">$basearch</span>/</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span><br><span class="line"></span><br><span class="line"><span class="comment">#additional packages that may be useful</span></span><br><span class="line">[extras]</span><br><span class="line">name=CentOS-<span class="variable">$releasever</span> - Extras</span><br><span class="line"><span class="comment">#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&amp;arch=$basearch&amp;repo=extras&amp;infra=$infra</span></span><br><span class="line">baseurl=https://mirrors.ustc.edu.cn/centos-vault/centos/<span class="variable">$releasever</span>/extras/<span class="variable">$basearch</span>/</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span><br><span class="line"></span><br><span class="line"><span class="comment">#additional packages that extend functionality of existing packages</span></span><br><span class="line">[centosplus]</span><br><span class="line">name=CentOS-<span class="variable">$releasever</span> - Plus</span><br><span class="line"><span class="comment">#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&amp;arch=$basearch&amp;repo=centosplus&amp;infra=$infra</span></span><br><span class="line">baseurl=https://mirrors.ustc.edu.cn/centos-vault/centos/<span class="variable">$releasever</span>/centosplus/<span class="variable">$basearch</span>/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h2 id="EPEL-æº"><a href="#EPEL-æº" class="headerlink" title="EPEL æº"></a>EPEL æº</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -o /etc/yum.repos.d/epel.repo https://mirrors.aliyun.com/repo/epel-7.repo</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨-ISO-åšä¸ºç¦»çº¿ä»“åº“"><a href="#ä½¿ç”¨-ISO-åšä¸ºç¦»çº¿ä»“åº“" class="headerlink" title="ä½¿ç”¨ ISO åšä¸ºç¦»çº¿ä»“åº“"></a>ä½¿ç”¨ ISO åšä¸ºç¦»çº¿ä»“åº“</h2><p>iso é€‰æ‹© everything ç‰ˆæœ¬é•œåƒ</p><p>2.åˆ›å»º ISO å­˜æ”¾ç›®å½•ä»¥åŠæŒ‚è½½ç›®å½•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /mnt/cdrom</span><br></pre></td></tr></table></figure><p>4.æŒ‚è½½ ISO é•œåƒåˆ°æŒ‚è½½ç›®å½•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount -o loop /mnt/iso/*.iso /mnt/cdrom </span><br></pre></td></tr></table></figure><ol><li>æ£€æŸ¥æŒ‚è½½æ˜¯å¦æˆåŠŸ<br><code>df -h</code><br>2.å¤‡ä»½ <code>/etc/yum.repos.d</code> ç›®å½•é‡Œçš„åŸå§‹ repo æ–‡ä»¶</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/yum.repos.d</span><br><span class="line"><span class="built_in">mkdir</span> bak</span><br><span class="line"><span class="built_in">mv</span> *.repo bak/</span><br></pre></td></tr></table></figure><p> 4.å†™å…¥ä¿¡æ¯è‡³ local.repo</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; /etc/yum.repos.d/local.repo &lt;-<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">[<span class="built_in">local</span>]</span><br><span class="line">name=<span class="built_in">local</span></span><br><span class="line"><span class="comment">#æŒ‚è½½åœ°å€ï¼š/mnt/cdrom</span></span><br><span class="line">baseurl=file:///mnt/cdrom    </span><br><span class="line">enabled=1                    </span><br><span class="line">gpgcheck=0</span><br><span class="line"><span class="comment">#cd /mnt/cdrom/å¯ä»¥çœ‹åˆ°KEY</span></span><br><span class="line">gpgkey=file:///mnt/cdrom/RPM-GPG-KEY-CentOS-7</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><p> yum å®‰è£…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum clean all</span><br><span class="line">yum install ntp</span><br></pre></td></tr></table></figure><p>å–æ¶ˆæŒ‚è½½</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">umount /mnt/cdrom</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>trzsz ä½¿ç”¨è®°å½•</title>
      <link href="/posts/shqeci/"/>
      <url>/posts/shqeci/</url>
      
        <content type="html"><![CDATA[<p>å®˜æ–¹ä»‹ç»ï¼štrzsz ( trz &#x2F; tsz ) æ˜¯ä¸€æ¬¾ä¼˜ç§€çš„æ–‡ä»¶ä¼ è¾“å·¥å…·ï¼Œå’Œ lrzsz ( rz &#x2F; sz ) ç±»ä¼¼çš„ã€å…¼å®¹ tmux çš„æ–‡ä»¶ä¼ è¾“å·¥å…·ã€‚å…¶å®å°±æ˜¯ä¸€ä¸ªåˆ©ç”¨ç»ˆç«¯æ¥ä¼ è¾“æ–‡ä»¶çš„å·¥å…·ï¼Œå¯ä»¥ç”¨æ¥å–ä»£ lrzszï¼Œæ›´å¤šè¯¦æƒ…çœ‹å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://trzsz.github.io/cn/">https://trzsz.github.io/cn/</a> å’Œ GitHubï¼š<a href="https://github.com/trzsz/trzsz-ssh/blob/main/README.cn.md">https://github.com/trzsz/trzsz-ssh/blob/main/README.cn.md</a></p><blockquote><p>tssh æˆ‘æµ‹è¯•ä½¿ç”¨ zmodem ä¸Šä¼ æˆ–ä¸‹è½½æ–‡ä»¶çš„æ—¶å€™ä¸ä¼šå‡ºç°ä¹±ç çš„æƒ…å†µï¼Œæ¯”å¦‚ xshell å°±ç»å¸¸å‡ºç°ä¹±ç </p></blockquote><h2 id="ä½¿ç”¨-tssh-å‘½ä»¤"><a href="#ä½¿ç”¨-tssh-å‘½ä»¤" class="headerlink" title="ä½¿ç”¨ tssh å‘½ä»¤"></a>ä½¿ç”¨ tssh å‘½ä»¤</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### è‡ªåŠ¨åœ¨æœåŠ¡å™¨ä¸Šå®‰è£… lrzsz</span></span><br><span class="line">tssh --install-trzsz root@x.x.x.x</span><br><span class="line"></span><br><span class="line"><span class="comment">### äº¤äº’å¼æ·»åŠ æœºå™¨</span></span><br><span class="line">tssh --new-host</span><br><span class="line"></span><br><span class="line"><span class="comment">### æŒ‡å®šç”¨æˆ·åï¼Œ ssh ç”¨æˆ·åå¸¦ `@` ç¬¦å·çš„æ—¶å€™ï¼Œä½¿ç”¨ tssh ä¼šè§£æé”™è¯¯ï¼ˆssh æ— é—®é¢˜ï¼‰æ­¤æ—¶å¯ä»¥æŒ‡å®šç”¨æˆ·åçš„æ–¹å¼æ¥ä½¿ç”¨ã€‚</span></span><br><span class="line"><span class="comment"># --zmodem æ˜¯å¼€å¯ zmodem æ”¯æŒï¼Œå¯ä»¥ä½¿ç”¨ rz æˆ– sz å‘½ä»¤ã€‚</span></span><br><span class="line">tssh --zmodem -l <span class="string">&#x27;a@qq.com&#x27;</span> 1.1.1.1 -p 2222</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨-openssh-config"><a href="#ä½¿ç”¨-openssh-config" class="headerlink" title="ä½¿ç”¨ openssh config"></a>ä½¿ç”¨ openssh config</h2><p>é™¤äº†ä½¿ç”¨ <code>tssh</code> å‘½ä»¤çš„æ–¹æ³•å¤–ï¼Œè¿˜å¯ä»¥å°†æœåŠ¡å™¨ä¿¡æ¯é…ç½®åˆ° <code>~/.ssh/config</code>ï¼ˆç±»ä¼¼äº opensshï¼‰ï¼Œä¸ºäº†å…¼å®¹ <code>openssh</code>ï¼Œå¯ä»¥å°† <code>tssh</code> ç‹¬æœ‰çš„é…ç½®å‰åŠ ä¸Š <code>#!!</code> ï¼Œ åç»­ç›´æ¥ä½¿ç”¨ tssh å‘½ä»¤å°±å¯ä»¥è¿›è¡Œæœºå™¨é€‰æ‹©ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># ä½¿ç”¨ ssh-key å…å¯†è¿æ¥</span><br><span class="line">Host orange-pi</span><br><span class="line">  Hostname 1.1.1.1</span><br><span class="line">  HostKeyAlgorithms +ssh-rsa</span><br><span class="line">  PubkeyAcceptedKeyTypes +ssh-rsa</span><br><span class="line">  User orangepi</span><br><span class="line">  Port 22</span><br><span class="line">  IdentityFile ~/.ssh/id_rsa</span><br><span class="line">  IdentitiesOnly yes</span><br><span class="line"></span><br><span class="line"># ä½¿ç”¨å¯†ç è¿æ¥</span><br><span class="line">Host ubuntu</span><br><span class="line">  Hostname 1.1.1.1</span><br><span class="line">  User root</span><br><span class="line">  Port 22</span><br><span class="line">  #!! EnableZmodem Yes</span><br><span class="line">  #!! encPassword fe7219e2eb0c10aa6a0ea3c35307334e9810fd0cb042a05804dcd34b52125e088d3af3</span><br><span class="line">  #!! Password 123456</span><br></pre></td></tr></table></figure><blockquote><p>ä¸Šé¢çš„ <code>encPassword</code> å¯ä»¥é€šè¿‡ <code>tssh --enc-secret</code> æ¥ç”Ÿæˆï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ <code>Password æ˜æ–‡å¯†ç </code> çš„æ–¹å¼ã€‚</p></blockquote><h3 id="ä½¿ç”¨æ–¹æ³•"><a href="#ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h3><p>ç›´æ¥æ‰§è¡Œ tssh å°±ä¼šæœ‰ä¸€ä¸ªç»ˆç«¯ç»„æˆçš„å›¾å½¢ç•Œé¢<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202408051438414.png" alt="image.png"></p><p>ä¸Šé¢ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>tssh test-ubuntu</code> æ¥å¿«é€Ÿè¿æ¥</p><h2 id="æ”¯æŒ-zmodemï¼ˆå¯ç”¨äºå–ä»£-lrzszï¼‰"><a href="#æ”¯æŒ-zmodemï¼ˆå¯ç”¨äºå–ä»£-lrzszï¼‰" class="headerlink" title="æ”¯æŒ zmodemï¼ˆå¯ç”¨äºå–ä»£ lrzszï¼‰"></a>æ”¯æŒ zmodemï¼ˆå¯ç”¨äºå–ä»£ lrzszï¼‰</h2><h3 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><p>æ–°ç‰ˆ trzsz å†…ç½®æ”¯æŒ lrzsz çš„åŠŸèƒ½ï¼Œä½¿ç”¨æ–¹æ³•ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tssh --zmodem root@x.x.x.x -p 22</span><br></pre></td></tr></table></figure><p>æˆ–è€…åœ¨ <code>~/.ssh/config</code> é‡Œé¢é…ç½®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Host *</span><br><span class="line">  # å¦‚æœé…ç½®åœ¨ ~/.ssh/config ä¸­ï¼Œå¯ä»¥åŠ ä¸Š `#!!` å‰ç¼€ï¼Œä»¥å…¼å®¹æ ‡å‡† ssh</span><br><span class="line">  EnableZmodem Yes</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><p>ç„¶ååœ¨ç»ˆç«¯é‡Œå°±å¯ä»¥æ‰§è¡Œ rz å’Œ sz å‘½ä»¤äº† (<strong>ä¸éœ€è¦</strong>ä¿®æ”¹ç»ˆç«¯çš„é…ç½®ï¼Œæ¯”å¦‚ iTerm2 é…ç½® triggers)ï¼Œå¹¶ä¸”æ”¯æŒä¸Šä¼ é€Ÿåº¦å’Œä¸Šä¼ å¤§å°æ˜¾ç¤ºã€‚</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202408051427004.png" alt="image.png"></p><h2 id="macOS-ä¸‹ä½¿ç”¨é…ç½®"><a href="#macOS-ä¸‹ä½¿ç”¨é…ç½®" class="headerlink" title="macOS ä¸‹ä½¿ç”¨é…ç½®"></a>macOS ä¸‹ä½¿ç”¨é…ç½®</h2><p>trzsz-ssh æ˜¯å†…ç½®æ”¯æŒ trzsz çš„ ssh å®¢æˆ·ç«¯ï¼Œ å¯ä»¥æ›¿ä»£ opensshï¼Œå¹¶ä¸”ä¸ä¾èµ–ç»ˆç«¯çš„æ”¯æŒã€‚</p><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install trzsz-ssh</span><br></pre></td></tr></table></figure><h3 id="ç®€å•ç”¨æ³•"><a href="#ç®€å•ç”¨æ³•" class="headerlink" title="ç®€å•ç”¨æ³•"></a>ç®€å•ç”¨æ³•</h3><p>ä½¿ç”¨ <code>tssh</code> æ›¿ä»£ <code>ssh</code> å‘½ä»¤</p><h2 id="Windows-ä¸‹ä½¿ç”¨é…ç½®"><a href="#Windows-ä¸‹ä½¿ç”¨é…ç½®" class="headerlink" title="Windows ä¸‹ä½¿ç”¨é…ç½®"></a>Windows ä¸‹ä½¿ç”¨é…ç½®</h2><h3 id="ä½¿ç”¨-windows-ç‰ˆ-tssh-exe"><a href="#ä½¿ç”¨-windows-ç‰ˆ-tssh-exe" class="headerlink" title="ä½¿ç”¨ windows ç‰ˆ tssh.exe"></a>ä½¿ç”¨ windows ç‰ˆ tssh.exe</h3><p>lrzsz å¯ä»¥ä½¿ç”¨ <a href="https://github.com/trzsz/lrzsz-win32/releases/tag/v0.12.21rc">Release v0.12.21rc Â· trzsz&#x2F;lrzsz-win32 Â· GitHub</a>ï¼Œæ”¾åˆ° PATH ç¯å¢ƒå˜é‡è·¯å¾„ä¸‹ï¼Œä¸æ¸…æ¥šçš„ä¹Ÿå¯ä»¥ç›´æ¥æ‰”è¿› <code>C:\Windows</code> ç›®å½•ä¸‹ã€‚<br>ç›´æ¥ github ä¸Šä¸‹è½½ <code>tssh.exe</code> æ‰€åœ¨è·¯å¾„æ”¾åˆ° PATH ç¯å¢ƒå˜é‡ä¸­å³å¯ã€‚rz æˆ– sz çš„æ—¶å€™æ‰“å¼€çš„æ˜¯èµ„æºç®¡ç†å™¨ <code>explorer.exe</code></p><h3 id="åœ¨-WSL2-ä¸­ä½¿ç”¨"><a href="#åœ¨-WSL2-ä¸­ä½¿ç”¨" class="headerlink" title="åœ¨ WSL2 ä¸­ä½¿ç”¨"></a>åœ¨ WSL2 ä¸­ä½¿ç”¨</h3><p>å®‰è£… Linux ç‰ˆ tsshï¼Œå¹¶å®‰è£… zenity åŒ…ï¼Œæ–‡ä»¶ç®¡ç†å™¨æ˜¯ Linux æ¡Œé¢ç‰ˆæ–‡ä»¶ç®¡ç†å™¨ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update &amp;&amp; sudo apt install software-properties-common</span><br><span class="line">sudo add-apt-repository ppa:trzsz/ppa &amp;&amp; sudo apt update</span><br><span class="line"></span><br><span class="line">sudo apt install tssh</span><br><span class="line"></span><br><span class="line"><span class="comment"># è§£å†³ rz æˆ– sz æ— æ³•å¼¹å‡ºæ–‡ä»¶ç®¡ç†å™¨çš„é—®é¢˜ã€‚</span></span><br><span class="line">sudo apt install libgles2 zenity fonts-wqy-microhei -y</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> OpenSSH </tag>
            
            <tag> lrzsz </tag>
            
            <tag> zmodem </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaç¨‹åºè¢«åœæ­¢å‰è‡ªåŠ¨dumpå†…å­˜å¿«ç…§</title>
      <link href="/posts/sh7n7f/"/>
      <url>/posts/sh7n7f/</url>
      
        <content type="html"><![CDATA[<p>çº¿ä¸Šä¸šåŠ¡å¶å°”ä¼šå‡ºç°é‡å¯ç°è±¡ï¼Œä¸ºäº†æ’æŸ¥è¿™ä¸ªé—®é¢˜ï¼Œå†³å®šåœ¨ OOM çš„æ—¶å€™è‡ªåŠ¨è¿›è¡Œ dump å†…å­˜å¿«ç…§ç”¨äºåˆ†æ</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202407261022514.png" alt="image.png"></p><h2 id="é’ˆå¯¹-JVM-OOM-çš„æƒ…å†µ"><a href="#é’ˆå¯¹-JVM-OOM-çš„æƒ…å†µ" class="headerlink" title="é’ˆå¯¹ JVM OOM çš„æƒ…å†µ"></a>é’ˆå¯¹ JVM OOM çš„æƒ…å†µ</h2><p>OOM å…¨ç§° â€œOut Of Memoryâ€ï¼Œè¡¨ç¤ºå†…å­˜è€—å°½ã€‚å½“ JVM å› ä¸ºæ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜æ¥ä¸ºå¯¹è±¡åˆ†é…ç©ºé—´ï¼Œå¹¶ä¸”åƒåœ¾å›æ”¶å™¨ä¹Ÿå·²ç»æ²¡æœ‰ç©ºé—´å¯å›æ”¶æ—¶ï¼Œå°±ä¼šæŠ›å‡ºè¿™ä¸ªé”™è¯¯ï¼Œè§£å†³ OOM é—®é¢˜çš„ä¸€ä¸ªæ€è·¯:</p><p>å‡è®¾å‘ç”Ÿ OOM äº†ï¼Œå¿…ç„¶è¯´æ˜ç³»ç»Ÿä¸­æŸä¸ªåŒºåŸŸçš„å¯¹è±¡å¤ªå¤šäº†ï¼Œå¡æ»¡äº†é‚£ä¸ªåŒºåŸŸï¼Œè€Œä¸”ä¸€å®šæ˜¯æ— æ³•å›æ”¶æ‰é‚£äº›å¯¹è±¡ï¼Œæœ€ç»ˆæ‰ä¼šå¯¼è‡´å†…å­˜æº¢å‡ºçš„ï¼Œé¦–å…ˆå°±å¾—çŸ¥é“åˆ°åº•æ˜¯ä»€ä¹ˆå¯¹è±¡å¤ªå¤šäº†å¯¼è‡´ OOM ï¼Œå°±å¿…é¡»å¾—æœ‰ä¸€ä»½ JVM å‘ç”Ÿ OOM æ—¶çš„ dump å†…å­˜å¿«ç…§<br>æœ‰äº† dump å†…å­˜å¿«ç…§ï¼Œå°±å¯ä»¥ç”¨ MAT ä¹‹ç±»çš„å·¥å…·ï¼Œæˆ–è€…åœ¨çº¿å·¥å…·æ¥åˆ†æï¼š<a href="https://memory.console.heapdump.cn/">https://memory.console.heapdump.cn/</a><br>JVM åœ¨å‘ç”Ÿ OOM çš„æ—¶å€™å¹¶ä¸æ˜¯ç›´æ¥æŒ‚æ‰çš„ï¼Œ è€Œæ˜¯åœ¨ OOM ä¹‹å‰ä¼šå°½é‡å» GC è…¾å‡ºæ¥ä¸€äº›å†…å­˜ç©ºé—´ï¼Œå¦‚æœ GC åè¿˜æ˜¯æ²¡æœ‰ç©ºé—´ï¼Œæ”¾ä¸ä¸‹å¯¹è±¡ï¼Œ æ‰ä¼šè§¦å‘å†…å­˜æº¢å‡ºçš„ã€‚JVM ç»™æˆ‘ä»¬æä¾›äº†ä¸€äº›å‚æ•°å¯ä»¥åœ¨å‘ç”Ÿ OOM çš„æ—¶å€™è¿›è¡Œè‡ªåŠ¨ dump å†…å­˜å¿«ç…§ã€‚ï¼š <code>-XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=/logs/heapdump.hprof</code> &#x2F;logs ç›®å½•ä¹Ÿé€šè¿‡ hostpath æŒä¹…åŒ–åˆ°å¯¹åº”çš„ä¸»æœºèŠ‚ç‚¹ä¸Šäº†ï¼Œä¸è¿‡è¿™æ ·æœ‰ä¸¤ä¸ªé—®é¢˜ï¼š</p><ol><li>å¤šæ¬¡é‡å¯ä¼šå‘ç”Ÿè¦†ç›–ï¼Œæ¯”å¦‚ç¨‹åº OOM äº† 2 æ¬¡ï¼Œé‚£ä¹ˆç¬¬ä¸€æ¬¡çš„ heapdump ä¼šè¢«ç¬¬äºŒæ¬¡è¦†ç›–ã€‚</li><li>æ­¤å‚æ•°åªèƒ½é’ˆå¯¹ jvm å‘ç”Ÿçš„ OOMï¼Œk8s ä¸»åŠ¨é‡å¯æœåŠ¡çš„æƒ…å†µæ²¡æ³•å¯¼å‡º heapdumpã€‚</li></ol><p>å¯¹äºæ­¤æ¬¡çº¿ä¸Šé‡å¯é—®é¢˜ï¼Œé€šè¿‡ <code>kubectl describe pod</code> çœ‹åˆ°çš„åŸå› å°±æ˜¯ç”±äºå¥åº·æ£€æŸ¥ä¸å“åº”äº†ï¼Œk8s è‡ªåŠ¨å°†æœåŠ¡é‡å¯ï¼Œè¿™ç§æƒ…å†µä¸å±äº jvm çš„ OOMï¼Œé‚£ä¹ˆé€šè¿‡ä¸Šé¢çš„ jvm å‚æ•°æ¥å¯¼å‡ºä¸é è°±ã€‚</p><h2 id="é’ˆå¯¹å…¶ä»–æƒ…å†µçš„é‡å¯"><a href="#é’ˆå¯¹å…¶ä»–æƒ…å†µçš„é‡å¯" class="headerlink" title="é’ˆå¯¹å…¶ä»–æƒ…å†µçš„é‡å¯"></a>é’ˆå¯¹å…¶ä»–æƒ…å†µçš„é‡å¯</h2><p>æœ¬æ¬¡çº¿ä¸Šé‡å¯é—®é¢˜æ˜¯ k8s å¹²çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä» k8s çš„è§’åº¦æ¥å¤„ç†è¿™ä¸ªé—®é¢˜ï¼Œå‚è€ƒå®˜æ–¹æ–‡æ¡£ <a href="https://kubernetes.io/zh-cn/docs/tasks/configure-pod-container/attach-handler-lifecycle-event/">ä¸ºå®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸäº‹ä»¶è®¾ç½®å¤„ç†å‡½æ•°</a> å¯ä»¥é€šè¿‡é…ç½® preStop é’©å­æ¥å®ç°åœæ­¢å‰å°†å†…å­˜å¿«ç…§ dump ä¸‹æ¥ã€‚ç”¨åˆ°çš„å‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è·å– pidä¸º10çš„ç¨‹åº è¿›ç¨‹å †æ ˆä¿¡æ¯</span></span><br><span class="line">jstack -F 10 &gt;&gt; /logs/thread.dump</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”Ÿæˆå †å†…å­˜è½¬å‚¨å¿«ç…§</span></span><br><span class="line">jmap -dump:format=b,file=/logs/dump.hprof 10</span><br></pre></td></tr></table></figure><p>é…ç½®åœ¨ kubernetes ä¸­çš„ preStop é’©å­ä¸­ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">  <span class="attr">name:</span> <span class="string">test-java</span></span><br><span class="line">  <span class="attr">image:</span> <span class="string">harbor.example.com/base/example:v1</span></span><br><span class="line">  <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">  <span class="attr">lifecycle:</span></span><br><span class="line">    <span class="attr">preStop:</span></span><br><span class="line">      <span class="attr">exec:</span></span><br><span class="line">        <span class="attr">command:</span> [<span class="string">&quot;sh&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;jstack -F $(jps |grep -v Jps | awk &#x27;&#123;print $1&#125;&#x27;) | tee -a /logs/thread.dump &amp;&amp; jmap -dump:format=b,file=/logs/$(date +&#x27;%Y-%m-%d_%H%M%S&#x27;).hprof $(jps |grep -v Jps | awk &#x27;&#123;print $1&#125;&#x27;)&quot;</span>]</span><br><span class="line">  <span class="attr">readinessProbe:</span></span><br><span class="line">    <span class="attr">failureThreshold:</span> <span class="number">2</span></span><br><span class="line">    <span class="attr">httpGet:</span></span><br><span class="line">      <span class="attr">path:</span> <span class="string">/actuator/info</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">5003</span></span><br><span class="line">      <span class="attr">scheme:</span> <span class="string">HTTP</span></span><br><span class="line">    <span class="attr">initialDelaySeconds:</span> <span class="number">30</span></span><br><span class="line">    <span class="attr">periodSeconds:</span> <span class="number">15</span></span><br><span class="line">    <span class="attr">successThreshold:</span> <span class="number">1</span></span><br><span class="line">    <span class="attr">timeoutSeconds:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">volumeMounts:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/logs</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">app-logs</span></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hostPath:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/logs</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">DirectoryOrCreate</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">app-logs</span></span><br></pre></td></tr></table></figure><p>ç”±äºåœ¨ command ä¸­é…ç½® <code>&gt;&gt;</code> ä¸ç”Ÿæ•ˆï¼Œ æ‰€ä»¥æ¢æˆäº† <code>tee</code> å‘½ä»¤ï¼Œ å¹¶æŠŠå¯¼å‡ºçš„ hprof æ–‡ä»¶æŒ‰ç…§æ—¶é—´å‘½åé˜²æ­¢è¢«è¦†ç›–ã€‚å…¶ä¸­ <code>/logs</code> ç›®å½•é€šè¿‡ <code>hostpath</code> æŒä¹…åŒ–äº†ã€‚<br>æ‰‹åŠ¨æ‰§è¡Œ <code>kubectl delete pod xxxx</code>ï¼Œå¯ä»¥æŸ¥çœ‹åˆ°ç”Ÿæˆçš„æ–‡ä»¶äº†</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202407261103592.png" alt="image.png"></p>]]></content>
      
      
      <categories>
          
          <category> å®¹å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Kubernetes </tag>
            
            <tag> k8s </tag>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ— æ˜¾ç¤ºå™¨ç¯å¢ƒä¸‹è¿æ¥é¦™æ©™æ´¾</title>
      <link href="/posts/sghymc/"/>
      <url>/posts/sghymc/</url>
      
        <content type="html"><![CDATA[<p>è¿æ¥é¦™æ©™æ´¾ï¼ˆæ ‘è“æ´¾ç­‰å…¶ä»–æ´¾ä¹Ÿç±»ä¼¼ï¼‰ä¸€èˆ¬æœ‰ä»¥ä¸‹å‡ ç§æ–¹æ³•ï¼š</p><ol><li>æ’æ˜¾ç¤ºå™¨ã€é”®ç›˜é¼ æ ‡ç›´æ¥è¿›è¡Œæ“ä½œ</li><li>ä½¿ç”¨ä¸²å£è¿æ¥ç”µè„‘ï¼Œé€šè¿‡ä¸²å£è®¿é—®ç»ˆç«¯</li><li>é€šè¿‡ç½‘çº¿è¿æ¥è·¯ç”±å™¨ï¼ˆè·¯ç”±å™¨ä¼šé€šè¿‡ DHCP åˆ†é…ä¸€ä¸ª IP ç»™é¦™æ©™æ´¾ï¼‰ä»è·¯ç”±å™¨åå°è·å–åˆ° IP åœ°å€è¿›è¡Œè¿æ¥</li><li>é€šè¿‡ç½‘çº¿ç›´è¿ç”µè„‘ï¼Œç”µè„‘è¿è¡Œä¸€ä¸ª DHCP æœåŠ¡åˆ†é… IP ç»™é¦™æ©™æ´¾ï¼Œé€šè¿‡ IP åœ°å€è¿›è¡Œè¿æ¥</li><li>é€šè¿‡å®˜æ–¹çš„ <code>orangepi_first_run.txt</code> æ–‡ä»¶æ¥è‡ªåŠ¨é…ç½®ä¸€ä¸ªç½‘å£ IP åœ°å€ï¼Œç”µè„‘å›ºå®šä¸€ä¸ªåŒç½‘æ®µçš„ IPï¼Œç„¶åé€šè¿‡ IP åœ°å€è¿›è¡Œè®¿é—®</li></ol><p>æˆ‘è¿™é‡Œä½¿ç”¨ <code>tftpd64</code> æ¥å®ç°ä¸€ä¸ªç®€å•çš„ DHCP æœåŠ¡ã€‚</p><p>é…ç½®å¦‚ä¸‹ï¼š</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202407121331095.png" alt="image.png"></p><p>è®¾ç½®å¥½äº†ä»¥åï¼Œé€šè¿‡ç½‘çº¿å°†é¦™æ©™æ´¾å’Œç”µè„‘ç›´æ¥è¿èµ·æ¥ï¼Œè¿™é‡Œå°±èƒ½çœ‹åˆ°æœ‰è®¾å¤‡è·å–åˆ°äº† IP åœ°å€äº†ã€‚ï¼ˆä¸è¦è®¾ç½® Def routerï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦è®©ç½‘ç»œä½¿ç”¨ Wi-Fi çš„ç½‘å¡ï¼Œæœ‰çº¿ç½‘å¡åªæ˜¯ä¸ºäº†å†…ç½‘è¿æ¥ã€‚ï¼‰</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202407121332964.png" alt="image.png"></p><p>192.168.88.1 å°±æ˜¯é¦™æ©™æ´¾çš„ IP åœ°å€ã€‚å¯ä»¥ç”¨ ssh è¿æ¥äº†ã€‚</p><p>è”ç½‘ï¼š</p><p>æ‰‹æœºå¼€çƒ­ç‚¹ï¼Œä½¿ç”¨ <code>nmtui</code> å‘½ä»¤è¿æ¥ Wi-Fi</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202407121450535.png" alt="image.png"><br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202407121451371.png" alt="image.png|351"></p>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¦™æ©™æ´¾ </tag>
            
            <tag> å¼€å‘ç‰ˆ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é¦™æ©™æ´¾é…ç½®VNC Server</title>
      <link href="/posts/sghylv/"/>
      <url>/posts/sghylv/</url>
      
        <content type="html"><![CDATA[<p>vnc å¤§è‡´å¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§ç›´æ¥æŸ¥çœ‹ <code>TTY</code> ä¸Šæ­£åœ¨æ˜¾ç¤ºçš„æ¡Œé¢ï¼ˆå’Œæ’ä¸Šæ˜¾ç¤ºå™¨æ˜¾ç¤ºçš„ä¸€è‡´ï¼‰ï¼Œå¦ä¸€ç§æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„æ¡Œé¢ï¼ˆå³ å¯ä»¥åœ¨ä¸€å° linux ä¸Šæ‰“å¼€è‹¥å¹²ä¸ªæ¡Œé¢ä¾›è‹¥å¹²ç”¨æˆ·ä½¿ç”¨ï¼‰</p><p>è¿™é‡Œä½¿ç”¨è™šæ‹Ÿæ¡Œé¢ VNCï¼Œç”¨çš„æ˜¯ <code>tigervncserver</code>, å…¨ç¨‹ä½¿ç”¨ <code>orangepi</code> ç”¨æˆ·, é¦™æ©™æ´¾å®‰è£…çš„æ˜¯ <code>Ubuntu 22.04</code> ç³»ç»Ÿ, å¦‚æœéœ€è¦ç›´æ¥è½¬å‘æ˜¾ç¤ºå™¨çš„å†…å®¹ï¼Œè¯·æŸ¥çœ‹ <a href="/posts/bd65d26a/">Ubuntuå®‰è£…é…ç½®VNCç›´æ¥è½¬å‘æ¡Œé¢æ˜¾ç¤º</a></p><h2 id="å®‰è£…ä¾èµ–åŒ…"><a href="#å®‰è£…ä¾èµ–åŒ…" class="headerlink" title="å®‰è£…ä¾èµ–åŒ…"></a>å®‰è£…ä¾èµ–åŒ…</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get upgrade</span><br><span class="line"></span><br><span class="line">sudo apt-get -y install xorg lightdm xfce4 tango-icon-theme gnome-icon-theme dbus-x11</span><br><span class="line">sudo apt-get install xfonts-base tightvncserver</span><br></pre></td></tr></table></figure><h2 id="å¯åŠ¨-VNC-Server"><a href="#å¯åŠ¨-VNC-Server" class="headerlink" title="å¯åŠ¨ VNC Server"></a>å¯åŠ¨ VNC Server</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vncserver :1</span><br></pre></td></tr></table></figure><p>display :1 refers to port 5901</p><h2 id="é‡å¯-VNC-Server"><a href="#é‡å¯-VNC-Server" class="headerlink" title="é‡å¯ VNC Server"></a>é‡å¯ VNC Server</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vncserver -<span class="built_in">kill</span> :1</span><br><span class="line">vncserver :1</span><br></pre></td></tr></table></figure><h2 id="å¼€æœºè‡ªå¯åŠ¨"><a href="#å¼€æœºè‡ªå¯åŠ¨" class="headerlink" title="å¼€æœºè‡ªå¯åŠ¨"></a>å¼€æœºè‡ªå¯åŠ¨</h2><p><code>sudo vim /usr/local/bin/tightvncserver</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">PATH=<span class="string">&quot;<span class="variable">$PATH</span>:/usr/bin/&quot;</span></span><br><span class="line">DISPLAY=<span class="string">&quot;1&quot;</span></span><br><span class="line">DEPTH=<span class="string">&quot;16&quot;</span></span><br><span class="line">GEOMETRY=<span class="string">&quot;1024x768&quot;</span></span><br><span class="line">OPTIONS=<span class="string">&quot;-depth <span class="variable">$&#123;DEPTH&#125;</span> -geometry <span class="variable">$&#123;GEOMETRY&#125;</span> :<span class="variable">$&#123;DISPLAY&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;<span class="variable">$1</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">start)</span><br><span class="line">/usr/bin/vncserver <span class="variable">$&#123;OPTIONS&#125;</span></span><br><span class="line">;;</span><br><span class="line"></span><br><span class="line">stop)</span><br><span class="line">/usr/bin/vncserver -<span class="built_in">kill</span> :<span class="variable">$&#123;DISPLAY&#125;</span></span><br><span class="line">;;</span><br><span class="line"></span><br><span class="line">restart)</span><br><span class="line"><span class="variable">$0</span> stop</span><br><span class="line"><span class="variable">$0</span> start</span><br><span class="line">;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"><span class="built_in">exit</span> 0</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">chmod</span> +x /usr/local/bin/tightvncserver</span><br></pre></td></tr></table></figure><p><code>sudo vim /lib/systemd/system/tightvncserver.service</code></p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Unit]</span></span><br><span class="line"><span class="attr">Description</span>=Manage tightVNC Server</span><br><span class="line"></span><br><span class="line"><span class="section">[Service]</span></span><br><span class="line"><span class="attr">Type</span>=forking</span><br><span class="line"><span class="attr">ExecStart</span>=/usr/local/bin/tightvncserver start</span><br><span class="line"><span class="attr">ExecStop</span>=/usr/local/bin/tightvncserver stop</span><br><span class="line"><span class="attr">ExecReload</span>=/usr/local/bin/tightvncserver restart</span><br><span class="line"><span class="attr">User</span>=orangepi</span><br><span class="line"></span><br><span class="line"><span class="section">[Install]</span></span><br><span class="line"><span class="attr">WantedBy</span>=multi-user.target</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl <span class="built_in">enable</span> tightvncserver.service </span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¦™æ©™æ´¾ </tag>
            
            <tag> å¼€å‘ç‰ˆ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åœ¨Kubernetesç¯å¢ƒä¸‹å¿«é€Ÿéƒ¨ç½²MySQL</title>
      <link href="/posts/sgch4h/"/>
      <url>/posts/sgch4h/</url>
      
        <content type="html"><![CDATA[<p>æ”¶åˆ°ä¸ªéœ€æ±‚ï¼Œå¼€å‘å›¢é˜Ÿå¸Œæœ›å¿«é€Ÿå¯åŠ¨ä¸€å¥—ä¸šåŠ¡ç¯å¢ƒï¼ŒåŒ…æ‹¬æ‰€æœ‰ä¸šåŠ¡æœåŠ¡ï¼ˆéƒ¨ç½²åœ¨ <code>Kubernetes</code> ä¸­ï¼‰ã€<code>MySQL</code> æ•°æ®åº“ã€<code>Redis</code> ç­‰ä¸­é—´ä»¶ä¹Ÿä¸€å¹¶åˆ›å»ºå‡ºæ¥å¹¶åˆå§‹åŒ–ï¼Œä¸šåŠ¡ä¹Ÿéœ€è¦è‡ªåŠ¨è¿æ¥ä¸Šè¿™äº›ä¸­é—´ä»¶ã€‚</p><p>æœ¬æ–‡è®°å½•ä¸€ä¸‹åœ¨ <code>Kubernetes</code> ä¸­éƒ¨ç½² <code>MySQL</code> å¹¶å®Œæˆåˆå§‹åŒ–æ“ä½œï¼ˆè®¾ç½®å¯†ç ã€åˆ›å»ºæ•°æ®åº“ï¼‰</p><h2 id="é‡åˆ°çš„é—®é¢˜"><a href="#é‡åˆ°çš„é—®é¢˜" class="headerlink" title="é‡åˆ°çš„é—®é¢˜"></a>é‡åˆ°çš„é—®é¢˜</h2><h3 id="è¡¨åå¤§å°å†™æ•æ„Ÿé—®é¢˜"><a href="#è¡¨åå¤§å°å†™æ•æ„Ÿé—®é¢˜" class="headerlink" title="è¡¨åå¤§å°å†™æ•æ„Ÿé—®é¢˜"></a>è¡¨åå¤§å°å†™æ•æ„Ÿé—®é¢˜</h3><p>æˆ‘ä»¬çš„ä¸šåŠ¡éœ€è¦æ•°æ®åº“è®¾ç½®ä¸ºè¡¨åå¤§å°å†™ä¸æ•æ„Ÿï¼Œå³æ— è®ºå¤§å°å†™éƒ½è½¬æ¢ä¸ºå°å†™ï¼Œéœ€è¦è®¾ç½®å‚æ•°ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[mysqld]</span></span><br><span class="line"><span class="attr">lower_case_table_names</span>=<span class="number">1</span></span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆåœ¨å®¹å™¨ä¸­ï¼Œå‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼Œå¯ä»¥å°† cnf æ–‡ä»¶æŒ‚è½½åˆ° <code>/etc/mysql/conf.d/</code> ä¸­ã€‚</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202407091515566.png" alt="image.png|928"></p><h2 id="åˆ›å»ºå¤šä¸ªæ•°æ®åº“"><a href="#åˆ›å»ºå¤šä¸ªæ•°æ®åº“" class="headerlink" title="åˆ›å»ºå¤šä¸ªæ•°æ®åº“"></a>åˆ›å»ºå¤šä¸ªæ•°æ®åº“</h2><p>ä¸šåŠ¡éœ€è¦ç”¨åˆ°å¤šä¸ªåº“ï¼Œæ£€æŸ¥å®˜æ–¹ç¯å¢ƒå˜é‡ï¼Œæœ‰ä¸ª <code>MYSQL_DATABASE</code> ä¸è¿‡æˆ‘æµ‹è¯•å¯ä»¥åˆ›å»ºä¸€ä¸ªåº“ï¼Œä¸æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ã€‚å¹¶ä¸”é™¤äº†å»ºåº“ï¼Œå¯èƒ½è¿˜æœ‰å…¶ä»–çš„æ“ä½œã€‚</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202407091520705.png" alt="image.png|944"></p><p>å¯ä»¥å°†ä½ éœ€è¦çš„ sql æ–‡ä»¶æ”¾åˆ° <code>/docker-entrypoint-initdb.d</code> ç›®å½•ä¸­ï¼Œåˆå§‹åŒ–çš„æ—¶å€™ä¼šè‡ªåŠ¨æ‰§è¡Œã€‚</p><h2 id="å®Œæ•´çš„-yaml-æ–‡ä»¶"><a href="#å®Œæ•´çš„-yaml-æ–‡ä»¶" class="headerlink" title="å®Œæ•´çš„ yaml æ–‡ä»¶"></a>å®Œæ•´çš„ yaml æ–‡ä»¶</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mysql-config</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">custom.cnf:</span> <span class="string">|</span></span><br><span class="line"><span class="string">    [mysqld]</span></span><br><span class="line"><span class="string">    lower_case_table_names=1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mysql-init-sql</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">init1.sql:</span> <span class="string">|</span></span><br><span class="line"><span class="string">    CREATE DATABASE IF NOT EXISTS database1;</span></span><br><span class="line"><span class="string"></span>  <span class="attr">init2.sql:</span> <span class="string">|</span></span><br><span class="line"><span class="string">    CREATE DATABASE IF NOT EXISTS database2;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">StatefulSet</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mysql</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">mysql</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">mysql</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">mysql</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">host-time</span></span><br><span class="line">          <span class="attr">hostPath:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/etc/localtime</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mysql-config</span></span><br><span class="line">          <span class="attr">configMap:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">mysql-config</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mysql-init-sql</span></span><br><span class="line">          <span class="attr">configMap:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">mysql-init-sql</span></span><br><span class="line"></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mysql</span></span><br><span class="line">          <span class="comment"># arm64 è®¾ç½®ä¸ºmysql:oracle, amd64è®¾ç½®ä¸ºmysql:latest</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">registry.cn-hangzhou.aliyuncs.com/iuxt/mysql:8.0.38</span></span><br><span class="line">          <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">tcp-3306</span></span><br><span class="line">              <span class="attr">containerPort:</span> <span class="number">3306</span></span><br><span class="line">              <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">tcp-33060</span></span><br><span class="line">              <span class="attr">containerPort:</span> <span class="number">33060</span></span><br><span class="line">              <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">          <span class="attr">env:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">MYSQL_ROOT_PASSWORD</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">com.012</span></span><br><span class="line"></span><br><span class="line">          <span class="attr">volumeMounts:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mysql-config</span></span><br><span class="line">              <span class="attr">mountPath:</span> <span class="string">/etc/mysql/conf.d</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mysql-init-sql</span></span><br><span class="line">              <span class="attr">mountPath:</span> <span class="string">/docker-entrypoint-initdb.d</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">host-time</span></span><br><span class="line">              <span class="attr">mountPath:</span> <span class="string">/etc/localtime</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mysql-data</span></span><br><span class="line">              <span class="attr">mountPath:</span> <span class="string">/var/lib/mysql</span></span><br><span class="line">          <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">      <span class="attr">restartPolicy:</span> <span class="string">Always</span></span><br><span class="line">      <span class="attr">dnsPolicy:</span> <span class="string">ClusterFirst</span></span><br><span class="line">  <span class="attr">volumeClaimTemplates:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">PersistentVolumeClaim</span></span><br><span class="line">      <span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line">      <span class="attr">metadata:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">mysql-data</span></span><br><span class="line">        <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line">      <span class="attr">spec:</span></span><br><span class="line">        <span class="attr">accessModes:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">ReadWriteOnce</span></span><br><span class="line">        <span class="attr">resources:</span></span><br><span class="line">          <span class="attr">requests:</span></span><br><span class="line">            <span class="attr">storage:</span> <span class="string">10Gi</span></span><br><span class="line">        <span class="attr">storageClassName:</span> <span class="string">nfs-storage</span></span><br><span class="line">        <span class="attr">volumeMode:</span> <span class="string">Filesystem</span></span><br><span class="line">  <span class="attr">serviceName:</span> <span class="string">mysql</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mysql</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">mysql</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">http-3306</span></span><br><span class="line">      <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">3306</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">3306</span></span><br><span class="line">      <span class="attr">nodePort:</span> <span class="number">30001</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">mysql</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">NodePort</span></span><br></pre></td></tr></table></figure><p>è¿™ç§æŒ‚è½½æ–¹å¼æ˜¯å°† configmap ä¸­çš„æ‰€æœ‰ key éƒ½æŒ‚è½½åˆ°æŒ‡å®šçš„ç›®å½•ä¸­ã€‚ç›®å½•ä¸­åŸæ–‡ä»¶ä¸å¯è§ï¼ˆæœ¬æ¥å°±æ²¡æœ‰æ–‡ä»¶ï¼‰ï¼Œå¦‚æœæƒ³è¦ä»¥å•ä¸ªæ–‡ä»¶å½¢å¼æŒ‚è½½ï¼Œå‚è€ƒæ–‡ç« ï¼š<a href="/posts/75a76e3b/">åœ¨Kubernetesé›†ç¾¤ä¸­æŒ‚è½½configmapåˆ°podä¸­</a></p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>åœ¨Kubernetesä¸­éƒ¨ç½²nacos 2.3.2</title>
      <link href="/posts/sgajkk/"/>
      <url>/posts/sgajkk/</url>
      
        <content type="html"><![CDATA[<p>å…¶ä»–ç‰ˆæœ¬å‚è€ƒæ–‡æ¡£ <a href="/posts/sebxm6/">åœ¨Kubernetesä¸­éƒ¨ç½²nacos 2.1.0</a></p><p>nacos å®˜æ–¹æ–‡æ¡£å†™çš„å¤ªæ•·è¡äº†ï¼Œå¾ˆå¤šä¸œè¥¿éƒ½éœ€è¦è‡ªå·±å»æ‰¾ï¼Œæ¯”å¦‚å®¹å™¨è¿è¡Œçš„æ—¶å€™ï¼Œå¿…é¡»çš„ç¯å¢ƒå˜é‡éƒ½æ²¡æœ‰å†™å…¨ï¼Œé‡åˆ°çš„ä¸€äº›å‘æ•´ç†äº†å‡ºæ¥ã€‚</p><h2 id="æ–°ç‰ˆçš„å˜åŒ–"><a href="#æ–°ç‰ˆçš„å˜åŒ–" class="headerlink" title="æ–°ç‰ˆçš„å˜åŒ–"></a>æ–°ç‰ˆçš„å˜åŒ–</h2><h3 id="é‰´æƒé€»è¾‘ä¼˜åŒ–"><a href="#é‰´æƒé€»è¾‘ä¼˜åŒ–" class="headerlink" title="é‰´æƒé€»è¾‘ä¼˜åŒ–"></a>é‰´æƒé€»è¾‘ä¼˜åŒ–</h3><p>å®˜æ–¹è¯´æ˜ï¼š<a href="https://nacos.io/zh-cn/docs/v2/guide/user/auth.html">https://nacos.io/zh-cn/docs/v2/guide/user/auth.html</a></p><p>2.2.2 ç‰ˆæœ¬ä¹‹å‰çš„ Nacos é»˜è®¤æ§åˆ¶å°ï¼Œæ— è®ºæœåŠ¡ç«¯æ˜¯å¦å¼€å¯é‰´æƒï¼Œéƒ½ä¼šå­˜åœ¨ä¸€ä¸ªç™»å½•é¡µï¼›è¿™å¯¼è‡´å¾ˆå¤šç”¨æˆ·è¢«è¯¯å¯¼è®¤ä¸º Nacos é»˜è®¤æ˜¯å­˜åœ¨é‰´æƒçš„ã€‚åœ¨ç¤¾åŒºå®‰å…¨å·¥ç¨‹å¸ˆçš„å»ºè®®ä¸‹ï¼ŒNacos è‡ª 2.2.2 ç‰ˆæœ¬å¼€å§‹ï¼Œåœ¨æœªå¼€å¯é‰´æƒæ—¶ï¼Œé»˜è®¤æ§åˆ¶å°å°†ä¸éœ€è¦ç™»å½•å³å¯è®¿é—®ï¼ŒåŒæ—¶åœ¨æ§åˆ¶å°ä¸­ç»™äºˆæç¤ºï¼Œæé†’ç”¨æˆ·å½“å‰é›†ç¾¤æœªå¼€å¯é‰´æƒã€‚</p><h3 id="éƒ¨åˆ†ç¯å¢ƒå˜é‡é»˜è®¤å€¼åˆ é™¤"><a href="#éƒ¨åˆ†ç¯å¢ƒå˜é‡é»˜è®¤å€¼åˆ é™¤" class="headerlink" title="éƒ¨åˆ†ç¯å¢ƒå˜é‡é»˜è®¤å€¼åˆ é™¤"></a>éƒ¨åˆ†ç¯å¢ƒå˜é‡é»˜è®¤å€¼åˆ é™¤</h3><p>nacos æ–°ç‰ˆï¼ˆ2.2.1 ä¹‹ååˆ é™¤äº†é»˜è®¤å€¼ï¼‰</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202407081430186.png" alt="image.png|782"></p><p>å¯ä»¥æŸ¥çœ‹ <code>/home/nacos/conf/application.properties</code> è¿™ä¸ªæ–‡ä»¶ï¼Œå¦‚æœæœ‰ç¯å¢ƒå˜é‡åä¸ç¡®è®¤ä¹Ÿå¯ä»¥åˆ°è¿™ä¸ªæ–‡ä»¶é‡ŒæŸ¥è¯¢ï¼š</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202407081433781.png" alt="image.png|940"></p><p>æ¯”å¦‚ï¼š <code>server.port=$&#123;NACOS_APPLICATION_PORT:8848&#125;</code> NACOS_APPLICATION_PORT æ˜¯ç¯å¢ƒå˜é‡åï¼Œ8848 æ˜¯é»˜è®¤å€¼ã€‚</p><h2 id="é‡åˆ°çš„é—®é¢˜"><a href="#é‡åˆ°çš„é—®é¢˜" class="headerlink" title="é‡åˆ°çš„é—®é¢˜"></a>é‡åˆ°çš„é—®é¢˜</h2><h3 id="the-length-of-secret-key-must-great-than-or-equal-32-bytes-And-the-secret-key-must-be-encoded-by-base64-Please-see-https-nacos-io-zh-cn-docs-v2-guide-user-auth-html"><a href="#the-length-of-secret-key-must-great-than-or-equal-32-bytes-And-the-secret-key-must-be-encoded-by-base64-Please-see-https-nacos-io-zh-cn-docs-v2-guide-user-auth-html" class="headerlink" title="the length of secret key must great than or equal 32 bytes; And the secret key must be encoded by base64.Please see https://nacos.io/zh-cn/docs/v2/guide/user/auth.html"></a>the length of secret key must great than or equal 32 bytes; And the secret key must be encoded by base64.Please see <a href="https://nacos.io/zh-cn/docs/v2/guide/user/auth.html">https://nacos.io/zh-cn/docs/v2/guide/user/auth.html</a></h3><p>è¿™ä¸ªé—®é¢˜æ˜¯å› ä¸º <code>NACOS_AUTH_IDENTITY_KEY</code> <code>NACOS_AUTH_IDENTITY_VALUE</code> <code>NACOS_AUTH_TOKEN</code> è¿™ä¸‰ä¸ªå˜é‡æ²¡æœ‰é»˜è®¤å€¼ï¼Œéœ€è¦é…ç½®ç¯å¢ƒå˜é‡</p><p><code>NACOS_AUTH_IDENTITY_KEY</code> è®¾ç½®æˆ <code>serverIdentity</code></p><p><code>NACOS_AUTH_IDENTITY_VALUE</code> å€¼æ¨èå°†é…ç½®é¡¹è®¾ç½®ä¸º Base64 ç¼–ç çš„å­—ç¬¦ä¸²ï¼Œä¸”åŸå§‹å¯†é’¥é•¿åº¦ä¸å¾—ä½äº 32 å­—ç¬¦ã€‚ç”Ÿæˆéšæœºå­—ç¬¦ä¸²ï¼Œå¹¶ä½¿ç”¨ base64 ç¼–ç ä¸€ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> EbDxUpWcw3G9lCBZqZoKtqZyqmsCH2Ktex5TA1zTXxOIVm6f1q | <span class="built_in">base64</span></span><br></pre></td></tr></table></figure><p><code>NACOS_AUTH_TOKEN</code> æˆ‘è®¾ç½®æˆäº† <code>SecretKeyXXjYYn7qwURG1bqBSDc8fBYqi5NwFOGgtwRX1lfKy0Ihl5Cdva3B7nJpZlV0</code></p><h3 id="errCode-102-errMsg-dataSource-or-tableName-is-null"><a href="#errCode-102-errMsg-dataSource-or-tableName-is-null" class="headerlink" title="errCode: 102, errMsg: dataSource or tableName is null"></a>errCode: 102, errMsg: dataSource or tableName is null</h3><p>è¿™ä¸ªæ˜¯åŒæ ·çš„é—®é¢˜ï¼Œ<code>SPRING_DATASOURCE_PLATFORM</code> é»˜è®¤ç¯å¢ƒå˜é‡è¢«åˆ é™¤</p><p>å°†ç¯å¢ƒå˜é‡ <code>SPRING_DATASOURCE_PLATFORM</code> è®¾ç½®æˆ <code>mysql</code> å³å¯ã€‚</p><h2 id="MySQL-æ•°æ®åº“å‡†å¤‡"><a href="#MySQL-æ•°æ®åº“å‡†å¤‡" class="headerlink" title="MySQL æ•°æ®åº“å‡†å¤‡"></a>MySQL æ•°æ®åº“å‡†å¤‡</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Copyright 1999-2018 Alibaba Group Holding Ltd.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></span><br><span class="line"><span class="comment"> * you may not use this file except in compliance with the License.</span></span><br><span class="line"><span class="comment"> * You may obtain a copy of the License at</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *      http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Unless required by applicable law or agreed to in writing, software</span></span><br><span class="line"><span class="comment"> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></span><br><span class="line"><span class="comment"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span><br><span class="line"><span class="comment"> * See the License for the specific language governing permissions and</span></span><br><span class="line"><span class="comment"> * limitations under the License.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="comment">/*   è¡¨åç§° = config_info                  */</span></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `config_info` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">  `data_id` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;data_id&#x27;</span>,</span><br><span class="line">  `group_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;group_id&#x27;</span>,</span><br><span class="line">  `content` longtext <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;content&#x27;</span>,</span><br><span class="line">  `md5` <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;md5&#x27;</span>,</span><br><span class="line">  `gmt_create` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,</span><br><span class="line">  `gmt_modified` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;ä¿®æ”¹æ—¶é—´&#x27;</span>,</span><br><span class="line">  `src_user` text COMMENT <span class="string">&#x27;source user&#x27;</span>,</span><br><span class="line">  `src_ip` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;source ip&#x27;</span>,</span><br><span class="line">  `app_name` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;app_name&#x27;</span>,</span><br><span class="line">  `tenant_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;ç§Ÿæˆ·å­—æ®µ&#x27;</span>,</span><br><span class="line">  `c_desc` <span class="type">varchar</span>(<span class="number">256</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;configuration description&#x27;</span>,</span><br><span class="line">  `c_use` <span class="type">varchar</span>(<span class="number">64</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;configuration usage&#x27;</span>,</span><br><span class="line">  `effect` <span class="type">varchar</span>(<span class="number">64</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;é…ç½®ç”Ÿæ•ˆçš„æè¿°&#x27;</span>,</span><br><span class="line">  `type` <span class="type">varchar</span>(<span class="number">64</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;é…ç½®çš„ç±»å‹&#x27;</span>,</span><br><span class="line">  `c_schema` text COMMENT <span class="string">&#x27;é…ç½®çš„æ¨¡å¼&#x27;</span>,</span><br><span class="line">  `encrypted_data_key` text <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;å¯†é’¥&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `uk_configinfo_datagrouptenant` (`data_id`,`group_id`,`tenant_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_bin COMMENT<span class="operator">=</span><span class="string">&#x27;config_info&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="comment">/*   è¡¨åç§° = config_info_aggr             */</span></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `config_info_aggr` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">  `data_id` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;data_id&#x27;</span>,</span><br><span class="line">  `group_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;group_id&#x27;</span>,</span><br><span class="line">  `datum_id` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;datum_id&#x27;</span>,</span><br><span class="line">  `content` longtext <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;å†…å®¹&#x27;</span>,</span><br><span class="line">  `gmt_modified` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;ä¿®æ”¹æ—¶é—´&#x27;</span>,</span><br><span class="line">  `app_name` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;app_name&#x27;</span>,</span><br><span class="line">  `tenant_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;ç§Ÿæˆ·å­—æ®µ&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `uk_configinfoaggr_datagrouptenantdatum` (`data_id`,`group_id`,`tenant_id`,`datum_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_bin COMMENT<span class="operator">=</span><span class="string">&#x27;å¢åŠ ç§Ÿæˆ·å­—æ®µ&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="comment">/*   è¡¨åç§° = config_info_beta             */</span></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `config_info_beta` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">  `data_id` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;data_id&#x27;</span>,</span><br><span class="line">  `group_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;group_id&#x27;</span>,</span><br><span class="line">  `app_name` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;app_name&#x27;</span>,</span><br><span class="line">  `content` longtext <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;content&#x27;</span>,</span><br><span class="line">  `beta_ips` <span class="type">varchar</span>(<span class="number">1024</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;betaIps&#x27;</span>,</span><br><span class="line">  `md5` <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;md5&#x27;</span>,</span><br><span class="line">  `gmt_create` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,</span><br><span class="line">  `gmt_modified` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;ä¿®æ”¹æ—¶é—´&#x27;</span>,</span><br><span class="line">  `src_user` text COMMENT <span class="string">&#x27;source user&#x27;</span>,</span><br><span class="line">  `src_ip` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;source ip&#x27;</span>,</span><br><span class="line">  `tenant_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;ç§Ÿæˆ·å­—æ®µ&#x27;</span>,</span><br><span class="line">  `encrypted_data_key` text <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;å¯†é’¥&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `uk_configinfobeta_datagrouptenant` (`data_id`,`group_id`,`tenant_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_bin COMMENT<span class="operator">=</span><span class="string">&#x27;config_info_beta&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="comment">/*   è¡¨åç§° = config_info_tag              */</span></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `config_info_tag` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">  `data_id` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;data_id&#x27;</span>,</span><br><span class="line">  `group_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;group_id&#x27;</span>,</span><br><span class="line">  `tenant_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;tenant_id&#x27;</span>,</span><br><span class="line">  `tag_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;tag_id&#x27;</span>,</span><br><span class="line">  `app_name` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;app_name&#x27;</span>,</span><br><span class="line">  `content` longtext <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;content&#x27;</span>,</span><br><span class="line">  `md5` <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;md5&#x27;</span>,</span><br><span class="line">  `gmt_create` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,</span><br><span class="line">  `gmt_modified` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;ä¿®æ”¹æ—¶é—´&#x27;</span>,</span><br><span class="line">  `src_user` text COMMENT <span class="string">&#x27;source user&#x27;</span>,</span><br><span class="line">  `src_ip` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;source ip&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `uk_configinfotag_datagrouptenanttag` (`data_id`,`group_id`,`tenant_id`,`tag_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_bin COMMENT<span class="operator">=</span><span class="string">&#x27;config_info_tag&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="comment">/*   è¡¨åç§° = config_tags_relation         */</span></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `config_tags_relation` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">  `tag_name` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;tag_name&#x27;</span>,</span><br><span class="line">  `tag_type` <span class="type">varchar</span>(<span class="number">64</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;tag_type&#x27;</span>,</span><br><span class="line">  `data_id` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;data_id&#x27;</span>,</span><br><span class="line">  `group_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;group_id&#x27;</span>,</span><br><span class="line">  `tenant_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;tenant_id&#x27;</span>,</span><br><span class="line">  `nid` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;nid, è‡ªå¢é•¿æ ‡è¯†&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`nid`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `uk_configtagrelation_configidtag` (`id`,`tag_name`,`tag_type`),</span><br><span class="line">  KEY `idx_tenant_id` (`tenant_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_bin COMMENT<span class="operator">=</span><span class="string">&#x27;config_tag_relation&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="comment">/*   è¡¨åç§° = group_capacity               */</span></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `group_capacity` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;ä¸»é”®ID&#x27;</span>,</span><br><span class="line">  `group_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;Group IDï¼Œç©ºå­—ç¬¦è¡¨ç¤ºæ•´ä¸ªé›†ç¾¤&#x27;</span>,</span><br><span class="line">  `quota` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;é…é¢ï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼&#x27;</span>,</span><br><span class="line">  `usage` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;ä½¿ç”¨é‡&#x27;</span>,</span><br><span class="line">  `max_size` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;å•ä¸ªé…ç½®å¤§å°ä¸Šé™ï¼Œå•ä½ä¸ºå­—èŠ‚ï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼&#x27;</span>,</span><br><span class="line">  `max_aggr_count` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;èšåˆå­é…ç½®æœ€å¤§ä¸ªæ•°ï¼Œï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼&#x27;</span>,</span><br><span class="line">  `max_aggr_size` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;å•ä¸ªèšåˆæ•°æ®çš„å­é…ç½®å¤§å°ä¸Šé™ï¼Œå•ä½ä¸ºå­—èŠ‚ï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼&#x27;</span>,</span><br><span class="line">  `max_history_count` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;æœ€å¤§å˜æ›´å†å²æ•°é‡&#x27;</span>,</span><br><span class="line">  `gmt_create` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,</span><br><span class="line">  `gmt_modified` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;ä¿®æ”¹æ—¶é—´&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `uk_group_id` (`group_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_bin COMMENT<span class="operator">=</span><span class="string">&#x27;é›†ç¾¤ã€å„Groupå®¹é‡ä¿¡æ¯è¡¨&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="comment">/*   è¡¨åç§° = his_config_info              */</span></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `his_config_info` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">  `nid` <span class="type">bigint</span>(<span class="number">20</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;nid, è‡ªå¢æ ‡è¯†&#x27;</span>,</span><br><span class="line">  `data_id` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;data_id&#x27;</span>,</span><br><span class="line">  `group_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;group_id&#x27;</span>,</span><br><span class="line">  `app_name` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;app_name&#x27;</span>,</span><br><span class="line">  `content` longtext <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;content&#x27;</span>,</span><br><span class="line">  `md5` <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;md5&#x27;</span>,</span><br><span class="line">  `gmt_create` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,</span><br><span class="line">  `gmt_modified` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;ä¿®æ”¹æ—¶é—´&#x27;</span>,</span><br><span class="line">  `src_user` text COMMENT <span class="string">&#x27;source user&#x27;</span>,</span><br><span class="line">  `src_ip` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;source ip&#x27;</span>,</span><br><span class="line">  `op_type` <span class="type">char</span>(<span class="number">10</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;operation type&#x27;</span>,</span><br><span class="line">  `tenant_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;ç§Ÿæˆ·å­—æ®µ&#x27;</span>,</span><br><span class="line">  `encrypted_data_key` text <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;å¯†é’¥&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`nid`),</span><br><span class="line">  KEY `idx_gmt_create` (`gmt_create`),</span><br><span class="line">  KEY `idx_gmt_modified` (`gmt_modified`),</span><br><span class="line">  KEY `idx_did` (`data_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_bin COMMENT<span class="operator">=</span><span class="string">&#x27;å¤šç§Ÿæˆ·æ”¹é€ &#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="comment">/*   è¡¨åç§° = tenant_capacity              */</span></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `tenant_capacity` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;ä¸»é”®ID&#x27;</span>,</span><br><span class="line">  `tenant_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;Tenant ID&#x27;</span>,</span><br><span class="line">  `quota` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;é…é¢ï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼&#x27;</span>,</span><br><span class="line">  `usage` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;ä½¿ç”¨é‡&#x27;</span>,</span><br><span class="line">  `max_size` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;å•ä¸ªé…ç½®å¤§å°ä¸Šé™ï¼Œå•ä½ä¸ºå­—èŠ‚ï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼&#x27;</span>,</span><br><span class="line">  `max_aggr_count` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;èšåˆå­é…ç½®æœ€å¤§ä¸ªæ•°&#x27;</span>,</span><br><span class="line">  `max_aggr_size` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;å•ä¸ªèšåˆæ•°æ®çš„å­é…ç½®å¤§å°ä¸Šé™ï¼Œå•ä½ä¸ºå­—èŠ‚ï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼&#x27;</span>,</span><br><span class="line">  `max_history_count` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;æœ€å¤§å˜æ›´å†å²æ•°é‡&#x27;</span>,</span><br><span class="line">  `gmt_create` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,</span><br><span class="line">  `gmt_modified` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;ä¿®æ”¹æ—¶é—´&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `uk_tenant_id` (`tenant_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_bin COMMENT<span class="operator">=</span><span class="string">&#x27;ç§Ÿæˆ·å®¹é‡ä¿¡æ¯è¡¨&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `tenant_info` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">  `kp` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;kp&#x27;</span>,</span><br><span class="line">  `tenant_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">default</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;tenant_id&#x27;</span>,</span><br><span class="line">  `tenant_name` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">default</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;tenant_name&#x27;</span>,</span><br><span class="line">  `tenant_desc` <span class="type">varchar</span>(<span class="number">256</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;tenant_desc&#x27;</span>,</span><br><span class="line">  `create_source` <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;create_source&#x27;</span>,</span><br><span class="line">  `gmt_create` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,</span><br><span class="line">  `gmt_modified` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;ä¿®æ”¹æ—¶é—´&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `uk_tenant_info_kptenantid` (`kp`,`tenant_id`),</span><br><span class="line">  KEY `idx_tenant_id` (`tenant_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_bin COMMENT<span class="operator">=</span><span class="string">&#x27;tenant_info&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `users` (</span><br><span class="line">`username` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">PRIMARY</span> KEY COMMENT <span class="string">&#x27;username&#x27;</span>,</span><br><span class="line">`password` <span class="type">varchar</span>(<span class="number">500</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;password&#x27;</span>,</span><br><span class="line">`enabled` <span class="type">boolean</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;enabled&#x27;</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `roles` (</span><br><span class="line">`username` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;username&#x27;</span>,</span><br><span class="line">`role` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;role&#x27;</span>,</span><br><span class="line"><span class="keyword">UNIQUE</span> INDEX `idx_user_role` (`username` <span class="keyword">ASC</span>, `role` <span class="keyword">ASC</span>) <span class="keyword">USING</span> BTREE</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `permissions` (</span><br><span class="line">    `role` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;role&#x27;</span>,</span><br><span class="line">    `resource` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;resource&#x27;</span>,</span><br><span class="line">    `action` <span class="type">varchar</span>(<span class="number">8</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;action&#x27;</span>,</span><br><span class="line">    <span class="keyword">UNIQUE</span> INDEX `uk_role_permission` (`role`,`resource`,`action`) <span class="keyword">USING</span> BTREE</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> users (username, password, enabled) <span class="keyword">VALUES</span> (<span class="string">&#x27;nacos&#x27;</span>, <span class="string">&#x27;$2a$10$EuWPZHzz32dJN7jexM34MOeYirDdFAZm2kuWj7VEOJhhZkDrxfvUu&#x27;</span>, <span class="literal">TRUE</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> roles (username, role) <span class="keyword">VALUES</span> (<span class="string">&#x27;nacos&#x27;</span>, <span class="string">&#x27;ROLE_ADMIN&#x27;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="yaml-æ–‡ä»¶"><a href="#yaml-æ–‡ä»¶" class="headerlink" title="yaml æ–‡ä»¶"></a>yaml æ–‡ä»¶</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">root@op-k8s-master1</span> <span class="string">~</span>]<span class="comment"># cat nacos-2.3.2.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nacos-headless</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">public</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nacos-headless</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">ClusterIP</span></span><br><span class="line">  <span class="attr">clusterIP:</span> <span class="string">None</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">8848</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">server</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">8848</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">9848</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">client-rpc</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">9848</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">9849</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">raft-rpc</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">9849</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">7848</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">old-raft-rpc</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">7848</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nacos</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nacos-svc</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">public</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nacos</span></span><br><span class="line">  <span class="comment"># annotations:</span></span><br><span class="line">    <span class="comment"># prometheus.io/path: /nacos/actuator/prometheus</span></span><br><span class="line">    <span class="comment"># prometheus.io/port: &quot;8848&quot;</span></span><br><span class="line">    <span class="comment"># prometheus.io/scrape: &quot;true&quot;</span></span><br><span class="line">    <span class="comment"># service.alpha.kubernetes.io/tolerate-unready-endpoints: &quot;true&quot;</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">8848</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">server</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">8848</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">9848</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">client-rpc</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">9848</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">9849</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">raft-rpc</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">9849</span></span><br><span class="line">    <span class="comment">## å…¼å®¹1.4.xç‰ˆæœ¬çš„é€‰ä¸¾ç«¯å£</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">7848</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">old-raft-rpc</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">7848</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">ClusterIP</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nacos</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nacos-cm</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">public</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">mysql.host:</span> <span class="string">&quot;10.186.128.93&quot;</span></span><br><span class="line">  <span class="attr">mysql.db.name:</span> <span class="string">&quot;nacos&quot;</span></span><br><span class="line">  <span class="attr">mysql.port:</span> <span class="string">&quot;3306&quot;</span></span><br><span class="line">  <span class="attr">mysql.user:</span> <span class="string">&quot;root&quot;</span></span><br><span class="line">  <span class="attr">mysql.password:</span> <span class="string">&quot;6pH5M1mrH^JLD8mU&quot;</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">StatefulSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nacos</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">public</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">serviceName:</span> <span class="string">nacos-headless</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">nacos</span></span><br><span class="line">      <span class="attr">annotations:</span></span><br><span class="line">        <span class="attr">pod.alpha.kubernetes.io/initialized:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">affinity:</span></span><br><span class="line">        <span class="attr">podAntiAffinity:</span></span><br><span class="line">          <span class="attr">requiredDuringSchedulingIgnoredDuringExecution:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">labelSelector:</span></span><br><span class="line">                <span class="attr">matchExpressions:</span></span><br><span class="line">                  <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">&quot;app&quot;</span></span><br><span class="line">                    <span class="attr">operator:</span> <span class="string">In</span></span><br><span class="line">                    <span class="attr">values:</span></span><br><span class="line">                      <span class="bullet">-</span> <span class="string">nacos</span></span><br><span class="line">              <span class="attr">topologyKey:</span> <span class="string">&quot;kubernetes.io/hostname&quot;</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">k8snacos</span></span><br><span class="line">          <span class="attr">imagePullPolicy:</span> <span class="string">Always</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">registry.cn-hangzhou.aliyuncs.com/iuxt/nacos-server:v2.3.2</span></span><br><span class="line">          <span class="attr">resources:</span></span><br><span class="line">            <span class="attr">requests:</span></span><br><span class="line">              <span class="attr">memory:</span> <span class="string">&quot;2Gi&quot;</span></span><br><span class="line">              <span class="attr">cpu:</span> <span class="string">&quot;500m&quot;</span></span><br><span class="line">          <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">8848</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">client</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">9848</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">client-rpc</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">9849</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">raft-rpc</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">7848</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">old-raft-rpc</span></span><br><span class="line">          <span class="attr">env:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">NACOS_REPLICAS</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&quot;3&quot;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">SPRING_DATASOURCE_PLATFORM</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">mysql</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">MYSQL_SERVICE_HOST</span></span><br><span class="line">              <span class="attr">valueFrom:</span></span><br><span class="line">                <span class="attr">configMapKeyRef:</span></span><br><span class="line">                  <span class="attr">name:</span> <span class="string">nacos-cm</span></span><br><span class="line">                  <span class="attr">key:</span> <span class="string">mysql.host</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">MYSQL_SERVICE_DB_NAME</span></span><br><span class="line">              <span class="attr">valueFrom:</span></span><br><span class="line">                <span class="attr">configMapKeyRef:</span></span><br><span class="line">                  <span class="attr">name:</span> <span class="string">nacos-cm</span></span><br><span class="line">                  <span class="attr">key:</span> <span class="string">mysql.db.name</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">MYSQL_SERVICE_PORT</span></span><br><span class="line">              <span class="attr">valueFrom:</span></span><br><span class="line">                <span class="attr">configMapKeyRef:</span></span><br><span class="line">                  <span class="attr">name:</span> <span class="string">nacos-cm</span></span><br><span class="line">                  <span class="attr">key:</span> <span class="string">mysql.port</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">MYSQL_SERVICE_USER</span></span><br><span class="line">              <span class="attr">valueFrom:</span></span><br><span class="line">                <span class="attr">configMapKeyRef:</span></span><br><span class="line">                  <span class="attr">name:</span> <span class="string">nacos-cm</span></span><br><span class="line">                  <span class="attr">key:</span> <span class="string">mysql.user</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">MYSQL_SERVICE_PASSWORD</span></span><br><span class="line">              <span class="attr">valueFrom:</span></span><br><span class="line">                <span class="attr">configMapKeyRef:</span></span><br><span class="line">                  <span class="attr">name:</span> <span class="string">nacos-cm</span></span><br><span class="line">                  <span class="attr">key:</span> <span class="string">mysql.password</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">NACOS_SERVER_PORT</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&quot;8848&quot;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">NACOS_APPLICATION_PORT</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&quot;8848&quot;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">PREFER_HOST_MODE</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&quot;hostname&quot;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">NACOS_SERVERS</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&gt;-</span></span><br><span class="line"><span class="string">                nacos-0.nacos-headless.public.svc.cluster.local:8848</span></span><br><span class="line"><span class="string">                nacos-1.nacos-headless.public.svc.cluster.local:8848</span></span><br><span class="line"><span class="string">                nacos-2.nacos-headless.public.svc.cluster.local:8848</span></span><br><span class="line"><span class="string"></span>            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">NACOS_AUTH_ENABLE</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">NACOS_AUTH_IDENTITY_KEY</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">serverIdentity</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">NACOS_AUTH_IDENTITY_VALUE</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">RWJEeFVwV2N3M0c5bENCWnFab0t0cVp5cW1zQ0gyS3RleDVUQTF6VFh4T0lWbTZmMXEK</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">NACOS_AUTH_TOKEN</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">SecretKeyXXjYYn7qwURG1bqBSDc8fBYqi5NwFOGgtwRX1lfKy0Ihl5Cdva3B7nJpZlV0</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">nacos</span></span><br></pre></td></tr></table></figure><h2 id="ingress-è§„åˆ™"><a href="#ingress-è§„åˆ™" class="headerlink" title="ingress è§„åˆ™"></a>ingress è§„åˆ™</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="comment"># kubernetes.io/ingress.class: &quot;nginx&quot;                   # è¿™é‡Œæ˜¯ingressclassåå­—, è€ç‰ˆæœ¬k8sç”¨è¿™ä¸ª</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/ssl-redirect:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/app-root:</span> <span class="string">&quot;/nacos&quot;</span></span><br><span class="line">    <span class="comment"># ä¸‹é¢çš„é…ç½®å’Œä¸Šé¢çš„app-rootæ•ˆæœä¸€æ ·ï¼Œå°±æ˜¯è·³è½¬åˆ° /nacos</span></span><br><span class="line">    <span class="comment"># nginx.ingress.kubernetes.io/configuration-snippet: |</span></span><br><span class="line">    <span class="comment">#   rewrite ^/$ https://$host/nacos/ redirect;</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">prod-nacos-ingress</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">public</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ingressClassName:</span> <span class="string">&quot;public-nginx&quot;</span>    <span class="comment"># è¿™é‡Œæ˜¯ingressclassåå­—, æ–°ç‰ˆæœ¬k8sç”¨è¿™ä¸ª</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">è¿™é‡Œä¿®æ”¹ä¸ºnacosçš„åŸŸå</span></span><br><span class="line">    <span class="attr">http:</span></span><br><span class="line">      <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">service:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">nacos-svc</span></span><br><span class="line">            <span class="attr">port:</span></span><br><span class="line">              <span class="attr">number:</span> <span class="number">8848</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">/</span></span><br><span class="line">        <span class="attr">pathType:</span> <span class="string">ImplementationSpecific</span></span><br><span class="line">  <span class="attr">tls:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">hosts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">è¿™é‡Œä¿®æ”¹ä¸ºnacosçš„åŸŸå</span></span><br><span class="line">    <span class="attr">secretName:</span> <span class="string">i-com</span>     <span class="comment"># è¿™é‡Œé…ç½®sslè¯ä¹¦çš„secretåå­—</span></span><br></pre></td></tr></table></figure><p>å…¶ä»–å¸¸è§é—®é¢˜å¯ä»¥å‚è€ƒ <a href="/posts/sebxm6/">åœ¨Kubernetesä¸­éƒ¨ç½²nacos 2.1.0</a></p>]]></content>
      
      
      <categories>
          
          <category> å®¹å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> éƒ¨ç½² </tag>
            
            <tag> Kubernetes </tag>
            
            <tag> k8s </tag>
            
            <tag> nacos </tag>
            
            <tag> è®°å½• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Kubernetesä¸­çš„é™æ€Pod</title>
      <link href="/posts/sfrqkr/"/>
      <url>/posts/sfrqkr/</url>
      
        <content type="html"><![CDATA[<h2 id="å•¥æ˜¯é™æ€-Pod"><a href="#å•¥æ˜¯é™æ€-Pod" class="headerlink" title="å•¥æ˜¯é™æ€ Pod"></a>å•¥æ˜¯é™æ€ Pod</h2><p>é™æ€ pod å°±æ˜¯ä¸é€šè¿‡ Kubernetes æ§åˆ¶å™¨ç›´æ¥è¿è¡Œçš„ podï¼Œæ¯”å¦‚ä¸‹é¢æ˜¯ä¸€ä¸ª nginx çš„é™æ€ pod</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">static-web</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">web</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">registry.cn-hangzhou.aliyuncs.com/iuxt/nginx:1.27.0</span></span><br><span class="line">      <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">web</span></span><br><span class="line">          <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">          <span class="attr">protocol:</span> <span class="string">TCP</span></span><br></pre></td></tr></table></figure><p>è¿™ç§ pod å¦‚æœé€šè¿‡ <code>kubectl delete pod static-web</code> æ¥åˆ é™¤ï¼Œ é‚£ä¹ˆå°±ç›´æ¥åˆ é™¤äº†ï¼Œä¸ä¼šåƒæ§åˆ¶å™¨ä¸€æ ·é‡å»º podã€‚</p><h2 id="kubeadm-é›†ç¾¤çš„ç»„ä»¶"><a href="#kubeadm-é›†ç¾¤çš„ç»„ä»¶" class="headerlink" title="kubeadm é›†ç¾¤çš„ç»„ä»¶"></a>kubeadm é›†ç¾¤çš„ç»„ä»¶</h2><h3 id="äºŒè¿›åˆ¶è¿è¡Œçš„ç»„ä»¶"><a href="#äºŒè¿›åˆ¶è¿è¡Œçš„ç»„ä»¶" class="headerlink" title="äºŒè¿›åˆ¶è¿è¡Œçš„ç»„ä»¶"></a>äºŒè¿›åˆ¶è¿è¡Œçš„ç»„ä»¶</h3><p>äºŒè¿›åˆ¶è¿è¡Œçš„ç»„ä»¶å°±æ˜¯ä¸é€šè¿‡å®¹å™¨åŒ–ï¼Œç›´æ¥åœ¨æœºå™¨ä¸Šè¿è¡Œçš„ç»„ä»¶ï¼Œæœ‰ 3 ä¸ªç»„ä»¶ <code>kubeadm</code> <code>kubelet</code> <code>kubectl</code> ï¼Œå…¶ä¸­ï¼š</p><ul><li>kubectl è¿™ä¸ªæ˜¯å®¢æˆ·ç«¯ç¨‹åºï¼Œä¸æ˜¯å¿…é¡»çš„ï¼Œå¦‚æœéœ€è¦ç”¨åˆ° kubectl å‘½ä»¤ï¼Œå®‰è£…ä¸€ä¸ªå°±è¡Œ</li><li>kubeadm è¿™ä¸ªç¨‹åºæ¯å°æœºå™¨éƒ½éœ€è¦å®‰è£…ï¼Œä½¿ç”¨å®ƒæ¥ç®¡ç† masterï¼Œworker èŠ‚ç‚¹ä¹Ÿéœ€è¦æ‰§è¡Œ kubeadm æ‰èƒ½åŠ å…¥é›†ç¾¤</li><li>kubelet è¿™ä¸ªç»„ä»¶æ¯å°æœºå™¨éƒ½éœ€è¦å®‰è£…ï¼Œ å®ƒè´Ÿè´£ç®¡ç†èŠ‚ç‚¹ä¸Šçš„ Pod ç”Ÿå‘½å‘¨æœŸï¼Œä¹Ÿæ˜¯å®ƒè´Ÿè´£å°†èŠ‚ç‚¹æ³¨å†Œåˆ°é›†ç¾¤ä¸­</li></ul><p><code>kubelet</code> ç»„ä»¶åœ¨èŠ‚ç‚¹ä¸Šæ˜¯é€šè¿‡ <code>systemd</code> æ¥ç®¡ç†çš„ã€‚</p><h3 id="é™æ€-Pod-ç»„ä»¶"><a href="#é™æ€-Pod-ç»„ä»¶" class="headerlink" title="é™æ€ Pod ç»„ä»¶"></a>é™æ€ Pod ç»„ä»¶</h3><p>ä½¿ç”¨ <code>kubeadm</code> éƒ¨ç½²çš„é›†ç¾¤ä¸­ï¼Œ<code>etcd</code>ã€<code>kube-apiserver</code>ã€<code>kube-controller-manager</code>ã€<code>kube-scheduler</code> è¿™äº›ç»„ä»¶éƒ½æ˜¯é€šè¿‡é™æ€ Pod æ¥è¿è¡Œçš„ï¼Œå¦‚å›¾ï¼š</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202406281033638.png" alt="image.png|754"></p><p>ä½†æ˜¯æœ‰ä¸ªå¥‡æ€ªçš„é—®é¢˜ï¼Œ æŠŠè¿™äº›é™æ€ Pod åˆ é™¤åï¼Œå®ƒä¼šè‡ªå·±é‡å»ºä¸€ä¸ªæ–°çš„ï¼Œä¸åƒé™æ€ pod ä¸€æ ·åˆ é™¤äº†å°±æ²¡äº†ã€‚</p><h2 id="æŸ¥çœ‹-kubelet-é…ç½®"><a href="#æŸ¥çœ‹-kubelet-é…ç½®" class="headerlink" title="æŸ¥çœ‹ kubelet é…ç½®"></a>æŸ¥çœ‹ kubelet é…ç½®</h2><p>ç”±äºæ‰€æœ‰çš„ Pod éƒ½æ˜¯ <code>kubelet</code> è´Ÿè´£å¯åŠ¨çš„ï¼Œæˆ‘ä»¬çœ‹ä¸‹ <code>kubelet</code> çš„é…ç½®</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202406281046264.png" alt="image.png|849"></p><p>æ‰¾åˆ°é…ç½®æ–‡ä»¶åœ¨ <code>/var/lib/kubelet/config.yaml</code> , æŸ¥çœ‹ä¸‹è¿™ä¸ªæ–‡ä»¶çš„å†…å®¹ï¼š</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202406281047136.png" alt="image.png"></p><p><code>staticPodPath</code> å®šä¹‰äº†é™æ€ Pod yaml æ–‡ä»¶çš„ä½ç½®ï¼Œå¯ä»¥çœ‹åˆ°æœç„¶éƒ½åœ¨è¿™é‡Œï¼š</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202406281049578.png" alt="image.png"></p><h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><p>å°†ä¸Šé¢çš„ Nginx é™æ€ Pod çš„ yaml æ–‡ä»¶å¤åˆ¶åˆ°è¿™ä¸ªç›®å½•ï¼Œå¯ä»¥çœ‹åˆ° Pod è‡ªåŠ¨åˆ›å»ºå‡ºæ¥äº†</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202406281052803.png" alt="image.png"></p><p><code>kubelet</code> è‡ªåŠ¨åˆ›å»ºçš„é™æ€ Pod ä¼šåœ¨ Pod åå­—åé¢åŠ ä¸Š <code>-&lt;è®¡ç®—æœºå&gt;</code></p><p>å°† <code>/etc/kubernetes/manifests</code> ä¸­çš„ yaml æ–‡ä»¶åˆ é™¤ï¼Œpod ä¹Ÿä¼šè‡ªåŠ¨é”€æ¯ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> å®¹å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> éƒ¨ç½² </tag>
            
            <tag> Kubernetes </tag>
            
            <tag> kubeadm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>K8Sçš„headless service</title>
      <link href="/posts/sfo7gw/"/>
      <url>/posts/sfo7gw/</url>
      
        <content type="html"><![CDATA[<h2 id="ä»€ä¹ˆæ˜¯-headless-service"><a href="#ä»€ä¹ˆæ˜¯-headless-service" class="headerlink" title="ä»€ä¹ˆæ˜¯ headless service"></a>ä»€ä¹ˆæ˜¯ headless service</h2><p>headless service æ˜¯é…åˆ statefulset æ§åˆ¶å™¨ä½¿ç”¨çš„ï¼Œå°±æ˜¯ä¸€ä¸ªæ²¡æœ‰ ip åœ°å€çš„æ™®é€š service</p><h2 id="yml-é…ç½®"><a href="#yml-é…ç½®" class="headerlink" title="yml é…ç½®"></a>yml é…ç½®</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">zk-hs</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">zookeeper</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">tcp-client</span></span><br><span class="line">      <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">2181</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">2181</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">tcp-follower</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">2888</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">2888</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">tcp-election</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">3888</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">3888</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">zookeeper</span></span><br><span class="line">  <span class="attr">clusterIP:</span> <span class="string">None</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">ClusterIP</span></span><br></pre></td></tr></table></figure><p>åœ¨ statefulset é‡ŒæŒ‡å®š service åå­—ï¼š</p><blockquote><p>å¦‚æœè¿™é‡Œä¸è®¾ç½® <code>serviceName</code> çš„è¯ï¼Œservice è¿˜æ˜¯å¯ä»¥é€šçš„ï¼Œä½†æ˜¯ pod å°±æ²¡æœ‰å›ºå®šçš„åŸŸåäº†ã€‚</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">StatefulSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">zookeeper</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">zookeeper</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">zookeeper</span></span><br><span class="line">  <span class="attr">serviceName:</span> <span class="string">zk-hs</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">zookeeper</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">zookeeper</span></span><br></pre></td></tr></table></figure><h2 id="ç”¨å¤„"><a href="#ç”¨å¤„" class="headerlink" title="ç”¨å¤„"></a>ç”¨å¤„</h2><p>æ¯”å¦‚è¯´ä¸€ä¸ª statefulset æ§åˆ¶å™¨è¿è¡Œçš„ zookeeper é›†ç¾¤ï¼Œå°±å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">env:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">ZOO_ENABLE_AUTH</span></span><br><span class="line">    <span class="attr">value:</span> <span class="string">&quot;no&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">ALLOW_ANONYMOUS_LOGIN</span></span><br><span class="line">    <span class="attr">value:</span> <span class="string">&quot;yes&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">ZOO_SERVERS</span></span><br><span class="line">    <span class="attr">value:</span> <span class="string">&gt;</span></span><br><span class="line"><span class="string">      zookeeper-0.zk-hs.default.svc.cluster.local:2888:3888</span></span><br><span class="line"><span class="string">      zookeeper-1.zk-hs.default.svc.cluster.local:2888:3888</span></span><br><span class="line"><span class="string">      zookeeper-2.zk-hs.default.svc.cluster.local:2888:3888</span></span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œè¿™ 3 ä¸ª pod çš„åŸŸåæ˜¯ä¸ä¼šå˜çš„ã€‚</p><h2 id="ä¸€äº›æµ‹è¯•"><a href="#ä¸€äº›æµ‹è¯•" class="headerlink" title="ä¸€äº›æµ‹è¯•"></a>ä¸€äº›æµ‹è¯•</h2><h3 id="ping-çš„æ•ˆæœ"><a href="#ping-çš„æ•ˆæœ" class="headerlink" title="ping çš„æ•ˆæœ"></a>ping çš„æ•ˆæœ</h3><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202406261238205.png" alt="image.png|745"></p><p>10.1.0.119ã€10.1.0.137ã€10.1.0.124 å¯¹åº”çš„æ­£å¥½æ˜¯ Pod IP</p><h3 id="ä½¿ç”¨-dig-æ¥è§£æ"><a href="#ä½¿ç”¨-dig-æ¥è§£æ" class="headerlink" title="ä½¿ç”¨ dig æ¥è§£æ"></a>ä½¿ç”¨ dig æ¥è§£æ</h3><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202406261308981.png" alt="image.png|738"></p><h3 id="åå‘è§£æ-pod-ip"><a href="#åå‘è§£æ-pod-ip" class="headerlink" title="åå‘è§£æ pod ip"></a>åå‘è§£æ pod ip</h3><p><code>headless service</code> çš„ <code>pod ip</code> å¯ä»¥åå‘è§£æï¼Œå¹¶ä¸”è§£æåˆ°çš„åŸŸåæ˜¯ä¸ªå›ºå®šå€¼ï¼ˆä¸ä¼šéšç€ pod é”€æ¯é‡å»ºè€Œå˜åŒ–ï¼‰</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202406261309782.png" alt="image.png|740"></p><p>çœ‹çœ‹å¦ä¸€ä¸ªæœåŠ¡ï¼Œåˆ›å»ºäº†ä¸¤ä¸ª Serviceï¼Œä¸€ä¸ªæ™®é€šçš„ serviceï¼Œä¸€ä¸ª headless serviceï¼Œé‚£ä¹ˆè¿™ä¸ª pod çš„åŸŸåæ˜¯ä»€ä¹ˆï¼š</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202406261313057.png" alt="image.png|737"></p>]]></content>
      
      
      <categories>
          
          <category> å®¹å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Kubernetes </tag>
            
            <tag> Service </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åœ¨Kubernetesä¸­éƒ¨ç½²zookeeperé›†ç¾¤</title>
      <link href="/posts/sfbpoq/"/>
      <url>/posts/sfbpoq/</url>
      
        <content type="html"><![CDATA[<h2 id="éƒ¨ç½²é‡åˆ°çš„é—®é¢˜"><a href="#éƒ¨ç½²é‡åˆ°çš„é—®é¢˜" class="headerlink" title="éƒ¨ç½²é‡åˆ°çš„é—®é¢˜"></a>éƒ¨ç½²é‡åˆ°çš„é—®é¢˜</h2><h3 id="æŒ‚è½½ç›®å½•æ²¡æœ‰å†™å…¥æƒé™"><a href="#æŒ‚è½½ç›®å½•æ²¡æœ‰å†™å…¥æƒé™" class="headerlink" title="æŒ‚è½½ç›®å½•æ²¡æœ‰å†™å…¥æƒé™"></a>æŒ‚è½½ç›®å½•æ²¡æœ‰å†™å…¥æƒé™</h3><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202406191739203.png" alt="image.png"></p><p>ä¿®æ”¹å®¹å™¨å¯åŠ¨å‘½ä»¤ï¼ŒæŸ¥çœ‹åˆ°ç”¨æˆ· id æ˜¯ 1001</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202406201606689.png" alt="image.png"></p><p>å®˜æ–¹ä¹Ÿæœ‰è¯´æ˜<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202406191741358.png" alt="image.png"></p><h4 id="è§£å†³æ–¹æ³•-1-ä½¿ç”¨-initcontainer-æˆæƒ"><a href="#è§£å†³æ–¹æ³•-1-ä½¿ç”¨-initcontainer-æˆæƒ" class="headerlink" title="è§£å†³æ–¹æ³• 1: ä½¿ç”¨ initcontainer æˆæƒ"></a>è§£å†³æ–¹æ³• 1: ä½¿ç”¨ initcontainer æˆæƒ</h4><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">initContainers:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">init</span></span><br><span class="line">  <span class="attr">image:</span> <span class="string">busybox:1.28</span></span><br><span class="line">  <span class="attr">command:</span> [<span class="string">&#x27;sh&#x27;</span>, <span class="string">&#x27;-c&#x27;</span>, <span class="string">&quot;chown -R 1001:1001 /bitnami/&quot;</span>]</span><br><span class="line">  <span class="attr">volumeMounts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">data</span></span><br><span class="line">      <span class="attr">mountPath:</span> <span class="string">/bitnami/zookeeper</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202406191826920.png" alt="image.png|580"></p><h4 id="è§£å†³æ–¹æ³•-2ï¼š-å¢åŠ å®‰å…¨ä¸Šä¸‹æ–‡ï¼Œä½¿ç”¨-root-ç”¨æˆ·"><a href="#è§£å†³æ–¹æ³•-2ï¼š-å¢åŠ å®‰å…¨ä¸Šä¸‹æ–‡ï¼Œä½¿ç”¨-root-ç”¨æˆ·" class="headerlink" title="è§£å†³æ–¹æ³• 2ï¼š å¢åŠ å®‰å…¨ä¸Šä¸‹æ–‡ï¼Œä½¿ç”¨ root ç”¨æˆ·"></a>è§£å†³æ–¹æ³• 2ï¼š å¢åŠ å®‰å…¨ä¸Šä¸‹æ–‡ï¼Œä½¿ç”¨ root ç”¨æˆ·</h4><p>è¿™ä¹ˆåšä¼šé™ä½å®¹å™¨çš„å®‰å…¨æ€§ï¼Œä¸æ¨èï¼</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">securityContext:</span></span><br><span class="line">  <span class="attr">runAsUser:</span> <span class="number">0</span></span><br><span class="line">  <span class="attr">runAsGroup:</span> <span class="number">0</span></span><br></pre></td></tr></table></figure><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202406191746763.png" alt="image.png"></p><h2 id="æœ€ç»ˆçš„-yaml-æ–‡ä»¶"><a href="#æœ€ç»ˆçš„-yaml-æ–‡ä»¶" class="headerlink" title="æœ€ç»ˆçš„ yaml æ–‡ä»¶"></a>æœ€ç»ˆçš„ yaml æ–‡ä»¶</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">zk-hs</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">zookeeper</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">tcp-client</span></span><br><span class="line">      <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">2181</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">2181</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">tcp-follower</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">2888</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">2888</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">tcp-election</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">3888</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">3888</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">zookeeper</span></span><br><span class="line">  <span class="attr">clusterIP:</span> <span class="string">None</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">ClusterIP</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">StatefulSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">zookeeper</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">zookeeper</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">zookeeper</span></span><br><span class="line">  <span class="attr">serviceName:</span> <span class="string">zk-hs</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">zookeeper</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">zookeeper</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="comment"># ä½¿ç”¨ initContainers è§£å†³æŒ‚è½½ç›®å½•æ²¡æœ‰æƒé™å†™å…¥é—®é¢˜</span></span><br><span class="line">      <span class="attr">initContainers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">init</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">busybox:1.28</span></span><br><span class="line">        <span class="attr">command:</span> [<span class="string">&#x27;sh&#x27;</span>, <span class="string">&#x27;-c&#x27;</span>, <span class="string">&quot;chown -R 1001:1001 /bitnami/&quot;</span>]</span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">data</span></span><br><span class="line">            <span class="attr">mountPath:</span> <span class="string">/bitnami/zookeeper</span></span><br><span class="line"></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">zookeeper</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">bitnami/zookeeper:3.8.2</span></span><br><span class="line">          <span class="attr">command:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">bash</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&#x27;-ec&#x27;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">|</span></span><br><span class="line"><span class="string">              HOSTNAME=&quot;$(hostname -s)&quot;</span></span><br><span class="line"><span class="string">              if [[ $HOSTNAME =~ (.*)-([0-9]+)$ ]]; then</span></span><br><span class="line"><span class="string">                ORD=$&#123;BASH_REMATCH[2]&#125;</span></span><br><span class="line"><span class="string">                export ZOO_SERVER_ID=&quot;$((ORD + 1 ))&quot;</span></span><br><span class="line"><span class="string">              else</span></span><br><span class="line"><span class="string">                echo &quot;Failed to get index from hostname $HOST&quot;</span></span><br><span class="line"><span class="string">                exit 1</span></span><br><span class="line"><span class="string">              fi</span></span><br><span class="line"><span class="string">              exec /entrypoint.sh /run.sh</span></span><br><span class="line"><span class="string"></span>          <span class="attr">resources:</span></span><br><span class="line">            <span class="attr">limits:</span></span><br><span class="line">              <span class="attr">cpu:</span> <span class="number">1</span></span><br><span class="line">              <span class="attr">memory:</span> <span class="string">2Gi</span></span><br><span class="line">            <span class="attr">requests:</span></span><br><span class="line">              <span class="attr">cpu:</span> <span class="string">50m</span></span><br><span class="line">              <span class="attr">memory:</span> <span class="string">500Mi</span></span><br><span class="line">          <span class="attr">env:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">ZOO_ENABLE_AUTH</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&quot;no&quot;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">ALLOW_ANONYMOUS_LOGIN</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&quot;yes&quot;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">ZOO_SERVERS</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&gt;</span></span><br><span class="line"><span class="string">                zookeeper-0.zk-hs.default.svc.cluster.local:2888:3888</span></span><br><span class="line"><span class="string">                zookeeper-1.zk-hs.default.svc.cluster.local:2888:3888</span></span><br><span class="line"><span class="string">                zookeeper-2.zk-hs.default.svc.cluster.local:2888:3888</span></span><br><span class="line"><span class="string"></span>          <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">client</span></span><br><span class="line">              <span class="attr">containerPort:</span> <span class="number">2181</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">follower</span></span><br><span class="line">              <span class="attr">containerPort:</span> <span class="number">2888</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">election</span></span><br><span class="line">              <span class="attr">containerPort:</span> <span class="number">3888</span></span><br><span class="line">          <span class="attr">livenessProbe:</span></span><br><span class="line">            <span class="attr">tcpSocket:</span></span><br><span class="line">              <span class="attr">port:</span> <span class="string">client</span></span><br><span class="line">            <span class="attr">failureThreshold:</span> <span class="number">6</span></span><br><span class="line">            <span class="attr">initialDelaySeconds:</span> <span class="number">30</span></span><br><span class="line">            <span class="attr">periodSeconds:</span> <span class="number">10</span></span><br><span class="line">            <span class="attr">successThreshold:</span> <span class="number">1</span></span><br><span class="line">            <span class="attr">timeoutSeconds:</span> <span class="number">5</span></span><br><span class="line">          <span class="attr">readinessProbe:</span></span><br><span class="line">            <span class="attr">tcpSocket:</span></span><br><span class="line">              <span class="attr">port:</span> <span class="string">client</span></span><br><span class="line">            <span class="attr">failureThreshold:</span> <span class="number">6</span></span><br><span class="line">            <span class="attr">initialDelaySeconds:</span> <span class="number">5</span></span><br><span class="line">            <span class="attr">periodSeconds:</span> <span class="number">10</span></span><br><span class="line">            <span class="attr">successThreshold:</span> <span class="number">1</span></span><br><span class="line">            <span class="attr">timeoutSeconds:</span> <span class="number">5</span></span><br><span class="line">          <span class="attr">volumeMounts:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">data</span></span><br><span class="line">              <span class="attr">mountPath:</span> <span class="string">/bitnami/zookeeper</span></span><br><span class="line">  <span class="attr">volumeClaimTemplates:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">metadata:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">data</span></span><br><span class="line">      <span class="attr">spec:</span></span><br><span class="line">        <span class="attr">accessModes:</span> [ <span class="string">&quot;ReadWriteOnce&quot;</span> ]</span><br><span class="line">        <span class="attr">storageClassName:</span> <span class="string">&quot;longhorn&quot;</span></span><br><span class="line">        <span class="attr">resources:</span></span><br><span class="line">          <span class="attr">requests:</span></span><br><span class="line">            <span class="attr">storage:</span> <span class="string">2Gi</span></span><br></pre></td></tr></table></figure><h2 id="é›†ç¾¤éªŒè¯"><a href="#é›†ç¾¤éªŒè¯" class="headerlink" title="é›†ç¾¤éªŒè¯"></a>é›†ç¾¤éªŒè¯</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ£€æŸ¥FQDN</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> 0 1 2; <span class="keyword">do</span> kubectl <span class="built_in">exec</span> zookeeper-<span class="variable">$i</span> -- hostname -f; <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æŸ¥ç”Ÿæˆçš„myidæ–‡ä»¶</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> 0 1 2; <span class="keyword">do</span> <span class="built_in">echo</span> <span class="string">&quot;myid zookeeper-<span class="variable">$i</span>&quot;</span>;kubectl <span class="built_in">exec</span> zookeeper-<span class="variable">$i</span> -- <span class="built_in">cat</span> /bitnami/zookeeper/data/myid; <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æŸ¥è‡ªåŠ¨ç”Ÿæˆçš„é…ç½®æ–‡ä»¶</span></span><br><span class="line">kubectl <span class="built_in">exec</span> -it zookeeper-0 --  <span class="built_in">cat</span> /opt/bitnami/zookeeper/conf/zoo.cfg | grep -vE <span class="string">&quot;^#|^$&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æŸ¥é›†ç¾¤çŠ¶æ€</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> 0 1 2; <span class="keyword">do</span> <span class="built_in">echo</span> -e <span class="string">&quot;# myid zookeeper-<span class="variable">$i</span> \n&quot;</span>;kubectl <span class="built_in">exec</span> zookeeper-<span class="variable">$i</span> -- opt/bitnami/zookeeper/bin/zkServer.sh status;<span class="built_in">echo</span> -e <span class="string">&quot;\n&quot;</span>; <span class="keyword">done</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="æ•°æ®éªŒè¯"><a href="#æ•°æ®éªŒè¯" class="headerlink" title="æ•°æ®éªŒè¯"></a>æ•°æ®éªŒè¯</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">kubectl run --<span class="built_in">rm</span> -it zookeeper-client --image=zookeeper:3.8.2 -- bash</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /apache-zookeeper-3.8.2-bin/bin</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿ä¸Š zookeeper ç¬¬ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">./zkCli.sh -server zookeeper-0.zk-hs.default.svc.cluster.local:2181</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºæµ‹è¯•æ•°æ®</span></span><br><span class="line">[zk: zookeeper-0.zk-hs.default.svc.cluster.local:2181(CONNECTED) 0] create /test test-data</span><br><span class="line">Created /test</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯»å–æµ‹è¯•æ•°æ®</span></span><br><span class="line">[zk: zookeeper-0.zk-hs.default.svc.cluster.local:2181(CONNECTED) 1] get /test</span><br><span class="line">test-data</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿ä¸Š zookeeper ç¬¬äºŒä¸ªèŠ‚ç‚¹</span></span><br><span class="line">./zkCli.sh -server zookeeper-1.zk-hs.default.svc.cluster.local:2181</span><br><span class="line"><span class="comment"># è·å–æ•°æ®</span></span><br><span class="line">[zk: zookeeper-1.zk-hs.default.svc.cluster.local:2181(CONNECTED) 0] get /test</span><br><span class="line">test-data</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å®¹å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
            <tag> Kubernetes </tag>
            
            <tag> æœ‰çŠ¶æ€æœåŠ¡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Windows é…ç½®è‡ªåŠ¨ç™»å½•</title>
      <link href="/posts/sewhsk/"/>
      <url>/posts/sewhsk/</url>
      
        <content type="html"><![CDATA[<p>windows ä¸­æœ‰éƒ¨åˆ†åº”ç”¨ç¨‹åºéœ€è¦ç™»å½•å½“å‰è´¦æˆ·æ‰å¯ä»¥è‡ªåŠ¨å¯åŠ¨ï¼Œæˆ–è€…å«Œè¾“å¯†ç éº»çƒ¦ï¼Œéƒ½å¯ä»¥è®¾ç½®è‡ªåŠ¨ç™»å½•ï¼Œä¸ç”¨åˆ é™¤å¼€æœºå¯†ç ï¼ˆåˆ é™¤å¼€æœºå¯†ç ä¹Ÿè¦é¼ æ ‡ç‚¹ä¸€ä¸‹ç™»å½•æ‰å¯ä»¥ç™»å½•ï¼‰</p><h2 id="ä¿®æ”¹æ³¨å†Œè¡¨"><a href="#ä¿®æ”¹æ³¨å†Œè¡¨" class="headerlink" title="ä¿®æ”¹æ³¨å†Œè¡¨"></a>ä¿®æ”¹æ³¨å†Œè¡¨</h2><p>æ—§ç‰ˆæœ¬ windows 10 æˆ–è€… windows 7 å¯ä»¥ç›´æ¥è®¾ç½®ï¼Œä½†æ˜¯æ–°ç‰ˆæœ¬ windows æ²¡æœ‰äº†è¿™ä¸ªé€‰é¡¹ï¼Œéœ€è¦ä¿®æ”¹æ³¨å†Œè¡¨é…ç½®</p><p>å°†ä¸‹é¢æ–‡æœ¬ä¿å­˜æˆ reg æ–‡ä»¶ï¼ŒåŒå‡»å¯¼å…¥ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Windows Registry Editor Version 5.00</span><br><span class="line"></span><br><span class="line">[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\PasswordLess\Device]</span><br><span class="line">&quot;DevicePasswordLessBuildVersion&quot;=dword:00000000</span><br></pre></td></tr></table></figure><h2 id="netplwiz-é…ç½®"><a href="#netplwiz-é…ç½®" class="headerlink" title="netplwiz é…ç½®"></a>netplwiz é…ç½®</h2><p>win + R è¾“å…¥ netplwiz æ‰“å¼€ç”¨æˆ·ç®¡ç†ç•Œé¢ã€‚</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202406111331601.png" alt="image.png"></p><p>å–æ¶ˆå‹¾é€‰ è¦ä½¿ç”¨æœ¬è®¡ç®—æœºï¼Œç”¨æˆ·å¿…é¡»è¾“å…¥ç”¨æˆ·åå’Œå¯†ç  é€‰é¡¹ï¼Œ åœ¨å¼¹å‡ºçš„æ¡†ä¸­è¾“å…¥å½“å‰ç”¨æˆ·å¯†ç ã€‚</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202406111331636.png" alt="image.png"></p>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows </tag>
            
            <tag> é…ç½®è®°å½• </tag>
            
            <tag> æ³¨å†Œè¡¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>kubeadm éƒ¨ç½²çš„é›†ç¾¤ å¸¸è§é—®é¢˜æ±‡æ€»</title>
      <link href="/posts/sepu3k/"/>
      <url>/posts/sepu3k/</url>
      
        <content type="html"><![CDATA[<h2 id="æ‰©å®¹èŠ‚ç‚¹"><a href="#æ‰©å®¹èŠ‚ç‚¹" class="headerlink" title="æ‰©å®¹èŠ‚ç‚¹"></a>æ‰©å®¹èŠ‚ç‚¹</h2><h3 id="æ‰©å®¹-Worker-èŠ‚ç‚¹"><a href="#æ‰©å®¹-Worker-èŠ‚ç‚¹" class="headerlink" title="æ‰©å®¹ Worker èŠ‚ç‚¹"></a>æ‰©å®¹ Worker èŠ‚ç‚¹</h3><blockquote><p>kubeadm init åä¼šè¾“å‡ºåœ¨ç»ˆç«¯ä¸Š, æœ‰æ•ˆæœŸ 2 å°æ—¶, è¶…æ—¶åå¯ä»¥é‡æ–°ç”Ÿæˆ</p></blockquote><p>ç”Ÿæˆæ·»åŠ å‘½ä»¤:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubeadm token create --print-join-command</span><br></pre></td></tr></table></figure><h3 id="æ‰©å®¹-Master-èŠ‚ç‚¹"><a href="#æ‰©å®¹-Master-èŠ‚ç‚¹" class="headerlink" title="æ‰©å®¹ Master èŠ‚ç‚¹"></a>æ‰©å®¹ Master èŠ‚ç‚¹</h3><h4 id="ç”ŸæˆåŠ å…¥å‘½ä»¤"><a href="#ç”ŸæˆåŠ å…¥å‘½ä»¤" class="headerlink" title="ç”ŸæˆåŠ å…¥å‘½ä»¤"></a>ç”ŸæˆåŠ å…¥å‘½ä»¤</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç”Ÿæˆè¯ä¹¦, è®°å½• certificate key</span></span><br><span class="line">kubeadm init phase upload-certs --upload-certs</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–åŠ å…¥å‘½ä»¤</span></span><br><span class="line">kubeadm token create --print-join-command</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†ä¸Šé¢çš„è¾“å‡ºç»“æœæ‹¼æ¥ï¼Œè¿™ä¸ªå°±æ˜¯åŠ å…¥ master çš„å‘½ä»¤ï¼Œåœ¨æ–°çš„ master ä¸Šæ‰§è¡Œ</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="subst">$(kubeadm token create --print-join-command)</span> --control-plane --certificate-key <span class="subst">$(kubeadm init phase upload-certs --upload-certs | tail -1)</span>&quot;</span></span><br></pre></td></tr></table></figure><h4 id="ä¿®æ”¹è´Ÿè½½å‡è¡¡é…ç½®"><a href="#ä¿®æ”¹è´Ÿè½½å‡è¡¡é…ç½®" class="headerlink" title="ä¿®æ”¹è´Ÿè½½å‡è¡¡é…ç½®"></a>ä¿®æ”¹è´Ÿè½½å‡è¡¡é…ç½®</h4><p>æ‰©å®¹å®Œ master èŠ‚ç‚¹ä¸è¦å¿˜äº†å°†æ–°çš„èŠ‚ç‚¹å¢åŠ åˆ° Apiserver çš„è´Ÿè½½å‡è¡¡ä¸Šã€‚</p><h4 id="è¯ä¹¦ä½ç½®"><a href="#è¯ä¹¦ä½ç½®" class="headerlink" title="è¯ä¹¦ä½ç½®"></a>è¯ä¹¦ä½ç½®</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿™é‡Œèƒ½çœ‹åˆ°åœ¨ç”¨å“ªä¸ª secret</span></span><br><span class="line">kubectl get secret -n kube-system kubeadm-certs -o yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å¯¹åº”çš„ secret</span></span><br><span class="line">kubectl get secret -n kube-system bootstrap-token-277b0n -o yaml</span><br></pre></td></tr></table></figure><h2 id="ç§»é™¤èŠ‚ç‚¹"><a href="#ç§»é™¤èŠ‚ç‚¹" class="headerlink" title="ç§»é™¤èŠ‚ç‚¹"></a>ç§»é™¤èŠ‚ç‚¹</h2><h3 id="ç§»é™¤-worker-èŠ‚ç‚¹"><a href="#ç§»é™¤-worker-èŠ‚ç‚¹" class="headerlink" title="ç§»é™¤ worker èŠ‚ç‚¹"></a>ç§»é™¤ worker èŠ‚ç‚¹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl drain worker2 --ignore-daemonsets</span><br><span class="line">kubectl delete node worker2</span><br></pre></td></tr></table></figure><h3 id="ç§»é™¤-etcd-member"><a href="#ç§»é™¤-etcd-member" class="headerlink" title="ç§»é™¤ etcd member"></a>ç§»é™¤ etcd member</h3><p>å¦‚æœè¦ç§»é™¤ master èŠ‚ç‚¹ï¼Œå¹¶ä¸” master èŠ‚ç‚¹ä¸Šéƒ¨ç½²äº† etcd ï¼Œé‚£é™¤äº†ä¸Šä¸€æ­¥æ“ä½œï¼Œè¿˜éœ€è¦ä» etcd é›†ç¾¤ä¸­ç§»é™¤è¿™ä¸ªèŠ‚ç‚¹ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">kubectl <span class="built_in">exec</span> -it -n kube-system etcd-master1 -- /bin/sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹etcd member list</span></span><br><span class="line">etcdctl --endpoints 127.0.0.1:2379 --cacert /etc/kubernetes/pki/etcd/ca.crt --cert /etc/kubernetes/pki/etcd/server.crt --key /etc/kubernetes/pki/etcd/server.key member list</span><br><span class="line"></span><br><span class="line"><span class="comment"># é€šè¿‡IDæ¥åˆ é™¤etcd member</span></span><br><span class="line">etcdctl --endpoints 127.0.0.1:2379 --cacert /etc/kubernetes/pki/etcd/ca.crt --cert /etc/kubernetes/pki/etcd/server.crt --key /etc/kubernetes/pki/etcd/server.key member remove 12637f5ec2bd02b8</span><br></pre></td></tr></table></figure><h2 id="å‡çº§é›†ç¾¤"><a href="#å‡çº§é›†ç¾¤" class="headerlink" title="å‡çº§é›†ç¾¤"></a>å‡çº§é›†ç¾¤</h2><p>kubeadm æ­å»ºçš„é›†ç¾¤å‡çº§æ¯”è¾ƒæ–¹ä¾¿ï¼Œæ€»ä½“æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li>å‡çº§ç¬¬ä¸€ä¸ª master èŠ‚ç‚¹</li><li>å‡çº§å…¶ä½™çš„ master èŠ‚ç‚¹</li><li>å‡çº§ worker èŠ‚ç‚¹<br>å¦‚æœé›†ç¾¤è¿è¡Œç€æœåŠ¡ï¼Œå‡çº§èŠ‚ç‚¹å‰éœ€è¦å…ˆè…¾ç©ºèŠ‚ç‚¹ <code>kubectl drain --ignore-daemonsets &lt;èŠ‚ç‚¹åç§°&gt;</code> å‡çº§å®Œæˆåï¼Œå†æ¢å¤è°ƒåº¦ <code>kubectl uncordon &lt;èŠ‚ç‚¹åç§°&gt; </code><br>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://kubernetes.io/zh-cn/docs/tasks/administer-cluster/kubeadm/kubeadm-upgrade/">https://kubernetes.io/zh-cn/docs/tasks/administer-cluster/kubeadm/kubeadm-upgrade/</a></li></ol><h3 id="å‡çº§ç¬¬ä¸€ä¸ª-master-èŠ‚ç‚¹"><a href="#å‡çº§ç¬¬ä¸€ä¸ª-master-èŠ‚ç‚¹" class="headerlink" title="å‡çº§ç¬¬ä¸€ä¸ª master èŠ‚ç‚¹"></a>å‡çº§ç¬¬ä¸€ä¸ª master èŠ‚ç‚¹</h3><p>ä¸Šé¢å®‰è£…çš„ <code>kubelet</code> <code>kubeadm</code> <code>kubectl</code> è¿™ 3 ä¸ªæ˜¯æœºå™¨ä¸Šä½¿ç”¨ yum å®‰è£…çš„ï¼Œæ‰€ä»¥éœ€è¦é€šè¿‡ yum æ¥å‡çº§ã€‚å…ˆå‡çº§ <code>kubeadm</code> ç»„ä»¶ï¼Œ æ–°ç‰ˆæœ¬æ¯ä¸ªå¤§ç‰ˆæœ¬ä¸€ä¸ª yum ä»“åº“ï¼Œéœ€è¦å…ˆä¿®æ”¹ä»“åº“é…ç½®æ–‡ä»¶ï¼Œå‚è€ƒï¼š<a href="https://kubernetes.io/zh-cn/docs/tasks/administer-cluster/kubeadm/change-package-repository/">https://kubernetes.io/zh-cn/docs/tasks/administer-cluster/kubeadm/change-package-repository/</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å¯ç”¨çš„ç‰ˆæœ¬</span></span><br><span class="line">sudo yum list --showduplicates kubeadm --disableexcludes=kubernetes</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‡çº§kubeadmåˆ°æŒ‡å®šçš„ç‰ˆæœ¬</span></span><br><span class="line">sudo yum update kubeadm-1.29.6 --disableexcludes=kubernetes</span><br><span class="line"></span><br><span class="line"><span class="comment"># éªŒè¯kubeadmç‰ˆæœ¬</span></span><br><span class="line">kubeadm version</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‡çº§æ£€æŸ¥ï¼Œä¸»è¦æ£€æŸ¥å…¼å®¹æ€§ä»¥åŠå»ºè®®å‡çº§åˆ°çš„ç‰ˆæœ¬</span></span><br><span class="line">kubeadm upgrade plan</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¼€å§‹å‡çº§ï¼Œå‡çº§ `kube-apiserver` `kube-controller-manager` `kube-scheduler` è¿™äº›ç»„ä»¶åœ¨èŠ‚ç‚¹ä¸Šæ˜¯ä»¥é™æ€ Pod çš„å½¢å¼å­˜åœ¨çš„ã€‚</span></span><br><span class="line">kubeadm upgrade apply v1.29.6</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŠŠå…¶ä»–ç»„ä»¶ä¹Ÿä¸€å—å‡çº§äº†</span></span><br><span class="line">sudo yum update kubelet-1.29.6 kubectl-1.29.6 cri-tools kubernetes-cni --disableexcludes=kubernetes</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡å¯kubelet</span></span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart kubelet</span><br></pre></td></tr></table></figure><h3 id="å‡çº§å…¶ä»–-master-èŠ‚ç‚¹"><a href="#å‡çº§å…¶ä»–-master-èŠ‚ç‚¹" class="headerlink" title="å‡çº§å…¶ä»– master èŠ‚ç‚¹"></a>å‡çº§å…¶ä»– master èŠ‚ç‚¹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‡çº§kubeadmåˆ°æŒ‡å®šçš„ç‰ˆæœ¬</span></span><br><span class="line">sudo yum update kubeadm-1.29.6 --disableexcludes=kubernetes</span><br><span class="line"></span><br><span class="line"><span class="comment"># éªŒè¯kubeadmç‰ˆæœ¬</span></span><br><span class="line">kubeadm version</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‡çº§èŠ‚ç‚¹</span></span><br><span class="line">kubeadm upgrade node</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‡çº§å…¶ä»–è½¯ä»¶åŒ…</span></span><br><span class="line">sudo yum update kubelet-1.29.6 kubectl-1.29.6 cri-tools kubernetes-cni --disableexcludes=kubernetes</span><br><span class="line"></span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart kubelet</span><br></pre></td></tr></table></figure><h3 id="å‡çº§-worker-èŠ‚ç‚¹"><a href="#å‡çº§-worker-èŠ‚ç‚¹" class="headerlink" title="å‡çº§ worker èŠ‚ç‚¹"></a>å‡çº§ worker èŠ‚ç‚¹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‡çº§è½¯ä»¶åŒ…</span></span><br><span class="line">sudo yum update kubeadm-1.29.6 kubelet-1.29.6 kubectl-1.29.6 cri-tools kubernetes-cni --disableexcludes=kubernetes</span><br><span class="line"></span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart kubelet</span><br></pre></td></tr></table></figure><h2 id="æµ‹è¯•é›†ç¾¤æ˜¯å¦æ­£å¸¸"><a href="#æµ‹è¯•é›†ç¾¤æ˜¯å¦æ­£å¸¸" class="headerlink" title="æµ‹è¯•é›†ç¾¤æ˜¯å¦æ­£å¸¸"></a>æµ‹è¯•é›†ç¾¤æ˜¯å¦æ­£å¸¸</h2><p>åˆ›å»ºä¸€ä¸ª nginx çš„ pod èµ„æº</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl create deployment nginx --image=nginx</span><br><span class="line">kubectl expose deployment nginx --port=80 --<span class="built_in">type</span>=NodePort</span><br><span class="line">kubectl get deploy,svc,pod</span><br></pre></td></tr></table></figure><p>è®¿é—® nodeportï¼Œæ£€æŸ¥èƒ½å¦è®¿é—®åˆ° nginx æœåŠ¡</p><h2 id="æŸ¥çœ‹-ETCD-çŠ¶æ€"><a href="#æŸ¥çœ‹-ETCD-çŠ¶æ€" class="headerlink" title="æŸ¥çœ‹ ETCD çŠ¶æ€"></a>æŸ¥çœ‹ ETCD çŠ¶æ€</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl <span class="built_in">exec</span> -n kube-system etcd-master1 -- etcdctl --endpoints=<span class="string">&quot;10.0.0.13:2379,10.0.0.12:2379,10.0.0.11:2379&quot;</span> --cacert /etc/kubernetes/pki/etcd/ca.crt --cert /etc/kubernetes/pki/etcd/server.crt --key /etc/kubernetes/pki/etcd/server.key endpoint status --write-out=table</span><br></pre></td></tr></table></figure><h2 id="pause-é•œåƒç‰ˆæœ¬é—®é¢˜"><a href="#pause-é•œåƒç‰ˆæœ¬é—®é¢˜" class="headerlink" title="pause é•œåƒç‰ˆæœ¬é—®é¢˜"></a>pause é•œåƒç‰ˆæœ¬é—®é¢˜</h2><p>ä½¿ç”¨ <code>kubeadm image pull</code> äº‹å…ˆæŠŠé•œåƒæ‹‰å–ä¸‹æ¥ï¼Œä½†æ˜¯åé¢ <code>kubeadm init</code> è¿˜æ˜¯æŠ¥é”™ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; journalctl -xeu kubelet -f</span><br><span class="line"></span><br><span class="line">Jul 22 08:35:49 master1 kubelet[2079]: E0722 08:35:49.169395    2079 pod_workers.go:190] <span class="string">&quot;Error syncing pod, skipping&quot;</span> err=<span class="string">&quot;failed to \&quot;CreatePodSandbox\&quot; for \&quot;etcd-master1_kube-system(642dcd53ce8660a2287cd7eaabcd5fdc)\&quot; with CreatePodSandboxError: \&quot;Failed to create sandbox for pod \\\&quot;etcd-master1_kube-system(642dcd53ce8660a2287cd7eaabcd5fdc)\\\&quot;: rpc error: code = Unknown desc = failed to get sandbox image \\\&quot;k8s.gcr.io/pause:3.6\\\&quot;: failed to pull image \\\&quot;k8s.gcr.io/pause:3.6\\\&quot;: failed to pull and unpack image \\\&quot;k8s.gcr.io/pause:3.6\\\&quot;: failed to resolve reference \\\&quot;k8s.gcr.io/pause:3.6\\\&quot;: failed to do request: Head \\\&quot;https://k8s.gcr.io/v2/pause/manifests/3.6\\\&quot;: dial tcp 142.250.157.82:443: connect: connection refused\&quot;&quot;</span> pod=<span class="string">&quot;kube-system/etcd-master1&quot;</span> podUID=642dcd53ce8660a2287cd7eaabcd5fdc</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬å·²ç»æå‰æ‹‰å–äº†é•œåƒåœ¨æœ¬åœ°äº†ï¼Œ ä½†æ˜¯ init çš„æ—¶å€™è¿˜æ˜¯ä¼šä» <code>k8s.gcr.io</code> æ‹‰å–é•œåƒï¼Œé€ æˆ init å¤±è´¥ï¼Œå¦‚æœä½ çš„ç½‘ç»œå¯ä»¥è®¿é—® <code>k8s.gcr.io</code> çš„æƒ…å†µä¸‹åˆ™å¯ä»¥å®Œæˆåˆå§‹åŒ–, ä½ ä¼šå‘ç°è¿™é‡Œæ‹‰å–å¤±è´¥çš„é•œåƒ tag å’Œ <code>kubeadm config images pull</code> æ‹‰ä¸‹æ¥çš„ç‰ˆæœ¬ä¸ä¸€è‡´ã€‚</p><p>é—®é¢˜åŸå› ï¼šcontainerd çš„é…ç½®æ–‡ä»¶é‡Œé¢æŒ‡å®šäº† pause çš„é•œåƒï¼Œè¿™é‡Œä¼šæ‹‰å–è¿™ä¸ªç‰ˆæœ¬çš„é•œåƒï¼Œå’Œ <code>kubeadm</code> ä¸ä¸€è‡´ã€‚æ‰€ä»¥ä¸¤ä¸ªé•œåƒéƒ½éœ€è¦ï¼Œæˆ–è€…ä¿®æ”¹ä¸‹ containerd çš„é…ç½®ã€‚</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202405052245258.png" alt="image.png|522"></p><h2 id="ä¿®æ”¹-NodePort-ç«¯å£èŒƒå›´"><a href="#ä¿®æ”¹-NodePort-ç«¯å£èŒƒå›´" class="headerlink" title="ä¿®æ”¹ NodePort ç«¯å£èŒƒå›´"></a>ä¿®æ”¹ NodePort ç«¯å£èŒƒå›´</h2><p>åœ¨ master èŠ‚ç‚¹ä¸Šä¿®æ”¹:</p><p>vim &#x2F;etc&#x2F;kubernetes&#x2F;manifests&#x2F;kube-apiserver.yaml</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">kubeadm.kubernetes.io/kube-apiserver.advertise-address.endpoint:</span> <span class="number">10.0</span><span class="number">.0</span><span class="number">.22</span><span class="string">:6443</span></span><br><span class="line">  <span class="attr">creationTimestamp:</span> <span class="literal">null</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">component:</span> <span class="string">kube-apiserver</span></span><br><span class="line">    <span class="attr">tier:</span> <span class="string">control-plane</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kube-apiserver</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">command:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">kube-apiserver</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--advertise-address=10.0.0.22</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--allow-privileged=true</span></span><br><span class="line">    <span class="string">...</span></span><br><span class="line">    <span class="comment"># å¢åŠ äº†è¿™ä¸€è¡Œ</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--service-node-port-range=1-65535</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">registry.k8s.io/kube-apiserver:v1.27.3</span></span><br><span class="line">    <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">    <span class="attr">livenessProbe:</span></span><br><span class="line">      <span class="attr">failureThreshold:</span> <span class="number">8</span></span><br><span class="line">      <span class="attr">httpGet:</span></span><br><span class="line">        <span class="attr">host:</span> <span class="number">10.0</span><span class="number">.0</span><span class="number">.22</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">/livez</span></span><br></pre></td></tr></table></figure><p>ä¿®æ”¹å®Œæˆåä¿å­˜, apiserver ä¼šè‡ªåŠ¨é‡å¯.</p><h2 id="master-èŠ‚ç‚¹å…è®¸è°ƒåº¦"><a href="#master-èŠ‚ç‚¹å…è®¸è°ƒåº¦" class="headerlink" title="master èŠ‚ç‚¹å…è®¸è°ƒåº¦"></a>master èŠ‚ç‚¹å…è®¸è°ƒåº¦</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è€ç‰ˆæœ¬Kubernetesæ‰§è¡Œè¿™ä¸ªï¼Œæˆ‘æµ‹è¯•1.21æ˜¯è¿™æ±¡ç‚¹</span></span><br><span class="line"><span class="comment"># kubectl taint node --all node-role.kubernetes.io/master:NoSchedule-</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.28ç‰ˆæœ¬ å»æ‰masterä¸Šçš„è¿™ä¸ªæ±¡ç‚¹å³å¯</span></span><br><span class="line">kubectl taint nodes --all node-role.kubernetes.io/control-plane-</span><br></pre></td></tr></table></figure><h2 id="æ‰‹åŠ¨è¯ä¹¦æ›´æ–°"><a href="#æ‰‹åŠ¨è¯ä¹¦æ›´æ–°" class="headerlink" title="æ‰‹åŠ¨è¯ä¹¦æ›´æ–°"></a>æ‰‹åŠ¨è¯ä¹¦æ›´æ–°</h2><p><a href="/posts/ltckjzor/">ä½¿ç”¨kubeadméƒ¨ç½²çš„é›†ç¾¤è¯ä¹¦è¿‡æœŸåå¤„ç†</a></p><h2 id="ä¿®æ”¹-kube-proxy-ä»£ç†æ¨¡å¼"><a href="#ä¿®æ”¹-kube-proxy-ä»£ç†æ¨¡å¼" class="headerlink" title="ä¿®æ”¹ kube-proxy ä»£ç†æ¨¡å¼"></a>ä¿®æ”¹ kube-proxy ä»£ç†æ¨¡å¼</h2><p>ç›¸æ¯” iptablesï¼Œä½¿ç”¨ ipvs å¯ä»¥æä¾›æ›´å¥½çš„æ€§èƒ½</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl -n kube-system edit configmap kube-proxy</span><br></pre></td></tr></table></figure><p>mode å‚æ•°ä¿®æ”¹æˆ ipvs</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202312112232082.png" alt="image.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl -n kube-system rollout restart daemonset kube-proxy</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹ kube-proxy æ—¥å¿—ï¼Œå‡ºç° Using ipvs Proxier è¯´æ˜ä¿®æ”¹æˆåŠŸã€‚<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202312112236807.png" alt="image.png"></p><h2 id="è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½"><a href="#è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½" class="headerlink" title="è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½"></a>è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½</h2><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">CentOS</button><button type="button" class="tab">Ubuntu</button></div><div class="tab-contents"><div class="tab-item-content active"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install bash-completion</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install -y bash-completion</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &gt;&gt; ~/.bashrc &lt;&lt;<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line"><span class="built_in">source</span> /usr/share/bash-completion/bash_completion</span><br><span class="line"><span class="built_in">source</span> &lt;(kubectl completion bash)</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å®¹å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
            <tag> å¸¸ç”¨æ“ä½œ </tag>
            
            <tag> éƒ¨ç½² </tag>
            
            <tag> æ­å»º </tag>
            
            <tag> Kubernetes </tag>
            
            <tag> kubeadm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨ PowerShell ä¿®æ”¹ Windows é˜²ç«å¢™è§„åˆ™</title>
      <link href="/posts/seln9g/"/>
      <url>/posts/seln9g/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¿®æ”¹ç½‘ç»œä½ç½®ï¼ˆä¸“ç”¨ç½‘ç»œæˆ–å…±ç”¨ç½‘ç»œï¼‰"><a href="#ä¿®æ”¹ç½‘ç»œä½ç½®ï¼ˆä¸“ç”¨ç½‘ç»œæˆ–å…±ç”¨ç½‘ç»œï¼‰" class="headerlink" title="ä¿®æ”¹ç½‘ç»œä½ç½®ï¼ˆä¸“ç”¨ç½‘ç»œæˆ–å…±ç”¨ç½‘ç»œï¼‰"></a>ä¿®æ”¹ç½‘ç»œä½ç½®ï¼ˆä¸“ç”¨ç½‘ç»œæˆ–å…±ç”¨ç½‘ç»œï¼‰</h2><p>åœ¨ windows 7 æ—¶ä»£åœ¨æ§åˆ¶é¢æ¿é‡Œæ˜¯å¯ä»¥ç›´æ¥ä¿®æ”¹çš„ï¼Œ ä½†æ˜¯åœ¨ Windows 11 å·²ç»ä¸èƒ½ä¿®æ”¹äº†ã€‚</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202406051653691.png" alt="image.png"></p><p>ä½¿ç”¨å…¬ç”¨ç½‘ç»œä¼šå½±å“åˆ°é˜²ç«å¢™ç­–ç•¥ï¼Œ æ¯”å¦‚åœ¨ä¸“ç”¨ç½‘ç»œä¸‹ï¼Œ å±€åŸŸç½‘å†…æ˜¯å¯ä»¥ç½‘ç»œå‘ç°å…¶ä»–è®¾å¤‡çš„ã€‚</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202406051656111.png" alt="image.png"></p><p>æ¯”å¦‚æˆ‘ç”¨ <code>zerotier</code> è¿™ä¸ªè½¯ä»¶ä¼šç»™ç”µè„‘å®‰è£…ä¸€ä¸ªè™šæ‹Ÿç½‘å¡ï¼Œå®¶é‡Œçš„ç”µè„‘ <code>zerotier</code> çš„ç½‘å¡è®¾ç½®æˆäº†å…¬ç”¨ç½‘ç»œï¼Œé‚£ä¹ˆå°±ä¸èƒ½ rdp è¿œç¨‹è¿æ¥å®¶é‡Œç”µè„‘äº†ã€‚</p><h3 id="ä¿®æ”¹æ–¹æ³•"><a href="#ä¿®æ”¹æ–¹æ³•" class="headerlink" title="ä¿®æ”¹æ–¹æ³•"></a>ä¿®æ”¹æ–¹æ³•</h3><p>éœ€è¦ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ <code>PowerShell</code> æ¥æ‰§è¡Œï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\Users\iuxt&gt; <span class="built_in">Get-NetConnectionProfile</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Name                     : CMCC<span class="literal">-Captain</span></span><br><span class="line">InterfaceAlias           : WLAN</span><br><span class="line">InterfaceIndex           : <span class="number">13</span></span><br><span class="line">NetworkCategory          : Private</span><br><span class="line">DomainAuthenticationKind : None</span><br><span class="line">IPv4Connectivity         : Internet</span><br><span class="line">IPv6Connectivity         : Internet</span><br><span class="line"></span><br><span class="line">Name                     : ç½‘ç»œ <span class="number">3</span></span><br><span class="line">InterfaceAlias           : ZeroTier One [<span class="number">272</span><span class="type">f5eae1628958e</span>]</span><br><span class="line">InterfaceIndex           : <span class="number">20</span></span><br><span class="line">NetworkCategory          : Public</span><br><span class="line">DomainAuthenticationKind : None</span><br><span class="line">IPv4Connectivity         : LocalNetwork</span><br><span class="line">IPv6Connectivity         : NoTraffic</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ ¹æ® <code>InterfaceIndex</code> æ¥ä¿®æ”¹ï¼ˆä¹Ÿå¯ä»¥æ ¹æ® InterfaceAlias ï¼‰</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Set-NetConnectionProfile</span> <span class="literal">-InterfaceIndex</span> <span class="number">20</span> <span class="literal">-NetworkCategory</span> Private</span><br></pre></td></tr></table></figure><h2 id="æ”¾é€šæŸä¸ªç½‘å¡"><a href="#æ”¾é€šæŸä¸ªç½‘å¡" class="headerlink" title="æ”¾é€šæŸä¸ªç½‘å¡"></a>æ”¾é€šæŸä¸ªç½‘å¡</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨ Get-NetAdapter æˆ– Get-NetConnectionProfile è·å–ç½‘å¡çš„ID</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ ¹æ®IDæ”¾è¡Œ</span></span><br><span class="line"><span class="built_in">New-NetFirewallRule</span> <span class="literal">-DisplayName</span> <span class="string">&quot;å…è®¸zerotierç½‘å¡&quot;</span> <span class="literal">-ID</span> <span class="number">23</span> <span class="literal">-Direction</span> Inbound <span class="literal">-Action</span> Allow</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ ¹æ®åå­—æ”¾è¡Œ</span></span><br><span class="line"><span class="built_in">New-NetFirewallRule</span> <span class="literal">-DisplayName</span> <span class="string">&quot;å…è®¸NATç½‘å¡&quot;</span> <span class="literal">-InterfaceAlias</span> <span class="string">&quot;vEthernet (NAT)&quot;</span> <span class="literal">-Direction</span> Inbound <span class="literal">-Action</span> Allow</span><br></pre></td></tr></table></figure><h2 id="ç¦æ­¢æŸä¸ªç¨‹åºè”ç½‘"><a href="#ç¦æ­¢æŸä¸ªç¨‹åºè”ç½‘" class="headerlink" title="ç¦æ­¢æŸä¸ªç¨‹åºè”ç½‘"></a>ç¦æ­¢æŸä¸ªç¨‹åºè”ç½‘</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">New-NetFirewallRule</span> <span class="literal">-DisplayName</span> <span class="string">&quot;Block-adobe-out&quot;</span> <span class="literal">-Direction</span> Outbound <span class="literal">-Program</span> <span class="string">&quot;C:\Program Files\Adobe\Adobe Photoshop 2025\Photoshop.exe&quot;</span> <span class="literal">-Action</span> Block</span><br><span class="line"></span><br><span class="line"><span class="built_in">New-NetFirewallRule</span> <span class="literal">-DisplayName</span> <span class="string">&quot;Block-adobe-in&quot;</span> <span class="literal">-Direction</span> Inbound <span class="literal">-Program</span> <span class="string">&quot;C:\Program Files\Adobe\Adobe Photoshop 2025\Photoshop.exe&quot;</span> <span class="literal">-Action</span> Block</span><br></pre></td></tr></table></figure><h2 id="å…è®¸æŸä¸ªç½‘æ®µ"><a href="#å…è®¸æŸä¸ªç½‘æ®µ" class="headerlink" title="å…è®¸æŸä¸ªç½‘æ®µ"></a>å…è®¸æŸä¸ªç½‘æ®µ</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">New-NetFirewallRule</span> <span class="literal">-DisplayName</span> <span class="string">&quot;Allow Subnet 10.233.233.0/24&quot;</span> <span class="literal">-Direction</span> Inbound <span class="literal">-Action</span> Allow <span class="literal">-RemoteAddress</span> <span class="number">10.233</span>.<span class="number">233.0</span>/<span class="number">24</span> <span class="literal">-Protocol</span> Any <span class="literal">-Enabled</span> True</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PowerShell </tag>
            
            <tag> é…ç½®è®°å½• </tag>
            
            <tag> ç½‘ç»œ </tag>
            
            <tag> é˜²ç«å¢™ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python ä½¿ç”¨ Easyocr è¿›è¡Œå›¾åƒè¯†åˆ«</title>
      <link href="/posts/sel45f/"/>
      <url>/posts/sel45f/</url>
      
        <content type="html"><![CDATA[<p>å¦‚æœä½ æœ‰ NVIDIA GPUï¼Œå¯ä»¥é¢å¤–å®‰è£… CUDAï¼Œæä¾›æ›´å¥½çš„æ€§èƒ½ï¼Œæ²¡æœ‰ NVIDIA GPUï¼Œå¯ä»¥ä½¿ç”¨ CPU è®¡ç®—ã€‚</p><p>easyocr å®˜æ–¹åœ°å€ï¼š<a href="https://github.com/jaidedai/easyocr">https://github.com/jaidedai/easyocr</a></p><h2 id="å®‰è£…-pytorch"><a href="#å®‰è£…-pytorch" class="headerlink" title="å®‰è£… pytorch"></a>å®‰è£… pytorch</h2><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install torch torchvision torchaudio</span><br></pre></td></tr></table></figure><h2 id="å®‰è£…-easyocr"><a href="#å®‰è£…-easyocr" class="headerlink" title="å®‰è£… easyocr"></a>å®‰è£… easyocr</h2><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install easyocr</span><br></pre></td></tr></table></figure><h2 id="ç²¾ç®€è¾“å‡º"><a href="#ç²¾ç®€è¾“å‡º" class="headerlink" title="ç²¾ç®€è¾“å‡º"></a>ç²¾ç®€è¾“å‡º</h2><p>é»˜è®¤æƒ…å†µä¸‹ä¼šè¾“å‡ºï¼š<code>Neither CUDA nor MPS are available - defaulting to CPU. Note: This module is much faster with a GPU.</code> å¯ä»¥é€šè¿‡æ·»åŠ å‚æ•° <code>verbose=False</code> æ¥å»æ‰è¿™ä¸ªæç¤ºã€‚</p><p>é»˜è®¤ä¼šè¾“å‡ºåæ ‡ã€å­—ç¬¦ç­‰ä¿¡æ¯ï¼Œå¦‚æœåªéœ€è¦è¾“å‡ºå­—ç¬¦ï¼Œå¯ä»¥å¢åŠ å‚æ•° <code>detail=0</code> è·å¾—ç²¾ç®€çš„è¾“å‡ºã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> easyocr</span><br><span class="line">reader = easyocr.Reader([<span class="string">&#x27;en&#x27;</span>], gpu=<span class="literal">False</span>, verbose=<span class="literal">False</span>) <span class="comment"># è¿™é‡ŒåŠ è½½è‹±æ–‡æ¨¡å‹ï¼Œå¦‚æœéœ€è¦è¯†åˆ«ç®€ä½“ä¸­æ–‡ï¼Œå¯ä»¥ reader = easyocr.Reader([&#x27;ch_sim&#x27;, &#x27;en&#x27;])</span></span><br><span class="line">result = reader.readtext(<span class="string">&#x27;D:\\ocr\\1.png&#x27;</span>,detail=<span class="number">0</span>)</span><br><span class="line"><span class="built_in">print</span>(result[<span class="number">0</span>].replace(<span class="string">&quot; &quot;</span>, <span class="string">&quot;&quot;</span>))</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€æ¬¡è¿è¡Œä¼šä¸‹è½½æ¨¡å‹ï¼Œæ¨¡å‹é»˜è®¤å­˜å‚¨ä½ç½®åœ¨ï¼š<code>%userprofile%\.EasyOCR\model</code></p><h2 id="å¸¸è§æŠ¥é”™"><a href="#å¸¸è§æŠ¥é”™" class="headerlink" title="å¸¸è§æŠ¥é”™"></a>å¸¸è§æŠ¥é”™</h2><h3 id="fbgemm-dll-åŠ è½½å¤±è´¥"><a href="#fbgemm-dll-åŠ è½½å¤±è´¥" class="headerlink" title="fbgemm.dll åŠ è½½å¤±è´¥"></a>fbgemm.dll åŠ è½½å¤±è´¥</h3><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">OSError: [<span class="title">WinError</span> 126] æ‰¾ä¸åˆ°æŒ‡å®šçš„æ¨¡å—ã€‚ <span class="title">Error</span> <span class="title">loading</span> &quot;<span class="title">D</span>:\<span class="title">ocr</span>\<span class="title">venv</span>\<span class="title">Lib</span>\<span class="title">site</span>-<span class="title">packages</span>\<span class="title">torch</span>\<span class="title">lib</span>\<span class="title">fbgemm.dll</span>&quot; <span class="title">or</span> <span class="title">one</span> <span class="title">of</span> <span class="title">its</span> <span class="title">dependencies</span>.</span></span><br></pre></td></tr></table></figure><p>åœ¨ <code>widnows</code> ç¯å¢ƒä¸‹ï¼Œéœ€è¦å®‰è£… <code>Microsoft Visual C++ Redistributable</code> <a href="https://learn.microsoft.com/en-US/cpp/windows/latest-supported-vc-redist">https://learn.microsoft.com/en-US/cpp/windows/latest-supported-vc-redist</a></p>]]></content>
      
      
      <categories>
          
          <category> å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows </tag>
            
            <tag> Python </tag>
            
            <tag> OCR </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åœ¨Kubernetesä¸­éƒ¨ç½²nacos 2.1.0</title>
      <link href="/posts/sebxm6/"/>
      <url>/posts/sebxm6/</url>
      
        <content type="html"><![CDATA[<p>æœ¬æ¬¡åœ¨ Kubernetes ä¸Šéƒ¨ç½² nacos 2.1.0 ç‰ˆæœ¬ï¼Œ éƒ¨ç½² 3 èŠ‚ç‚¹é›†ç¾¤ï¼Œä¸åšæ•°æ®æŒä¹…åŒ–ï¼ˆnacos çš„é…ç½®ç®¡ç†æ˜¯å­˜å‚¨ MySQL æ•°æ®åº“çš„ï¼ŒæœåŠ¡å‘ç°æ˜¯éœ€è¦æœ¬åœ°å­˜å‚¨çš„ï¼‰æ–°ç‰ˆæœ¬ nacos éƒ¨ç½²å‚è€ƒï¼š</p><p><a href="/posts/sgajkk/">åœ¨Kubernetesä¸­éƒ¨ç½²nacos 2.3.2</a></p><h2 id="MySQL-æ•°æ®åº“å‡†å¤‡"><a href="#MySQL-æ•°æ®åº“å‡†å¤‡" class="headerlink" title="MySQL æ•°æ®åº“å‡†å¤‡"></a>MySQL æ•°æ®åº“å‡†å¤‡</h2><p>åˆ›å»ºæ•°æ®åº“ï¼Œé…ç½®å¥½è´¦å·æƒé™ï¼Œæ‰§è¡Œå¦‚ä¸‹ SQL å»ºè¡¨ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> NAMES utf8mb4;</span><br><span class="line"><span class="keyword">SET</span> FOREIGN_KEY_CHECKS <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for config_info</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `config_info`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `config_info`  (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">  `data_id` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;data_id&#x27;</span>,</span><br><span class="line">  `group_id` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `content` longtext <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;content&#x27;</span>,</span><br><span class="line">  `md5` <span class="type">varchar</span>(<span class="number">32</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;md5&#x27;</span>,</span><br><span class="line">  `gmt_create` datetime(<span class="number">0</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>(<span class="number">0</span>) COMMENT <span class="string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,</span><br><span class="line">  `gmt_modified` datetime(<span class="number">0</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>(<span class="number">0</span>) COMMENT <span class="string">&#x27;ä¿®æ”¹æ—¶é—´&#x27;</span>,</span><br><span class="line">  `src_user` text <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;source user&#x27;</span>,</span><br><span class="line">  `src_ip` <span class="type">varchar</span>(<span class="number">50</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;source ip&#x27;</span>,</span><br><span class="line">  `app_name` <span class="type">varchar</span>(<span class="number">128</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `tenant_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;ç§Ÿæˆ·å­—æ®µ&#x27;</span>,</span><br><span class="line">  `c_desc` <span class="type">varchar</span>(<span class="number">256</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `c_use` <span class="type">varchar</span>(<span class="number">64</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `effect` <span class="type">varchar</span>(<span class="number">64</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `type` <span class="type">varchar</span>(<span class="number">64</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `c_schema` text <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NULL</span>,</span><br><span class="line">  `encrypted_data_key` text <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;ç§˜é’¥&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`) <span class="keyword">USING</span> BTREE,</span><br><span class="line">  <span class="keyword">UNIQUE</span> INDEX `uk_configinfo_datagrouptenant`(`data_id`, `group_id`, `tenant_id`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB AUTO_INCREMENT <span class="operator">=</span> <span class="number">1485</span> <span class="type">CHARACTER</span> <span class="keyword">SET</span> <span class="operator">=</span> utf8 <span class="keyword">COLLATE</span> <span class="operator">=</span> utf8_bin COMMENT <span class="operator">=</span> <span class="string">&#x27;config_info&#x27;</span> ROW_FORMAT <span class="operator">=</span> <span class="keyword">Dynamic</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for config_info_aggr</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `config_info_aggr`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `config_info_aggr`  (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">  `data_id` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;data_id&#x27;</span>,</span><br><span class="line">  `group_id` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;group_id&#x27;</span>,</span><br><span class="line">  `datum_id` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;datum_id&#x27;</span>,</span><br><span class="line">  `content` longtext <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;å†…å®¹&#x27;</span>,</span><br><span class="line">  `gmt_modified` datetime(<span class="number">0</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;ä¿®æ”¹æ—¶é—´&#x27;</span>,</span><br><span class="line">  `app_name` <span class="type">varchar</span>(<span class="number">128</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `tenant_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;ç§Ÿæˆ·å­—æ®µ&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`) <span class="keyword">USING</span> BTREE,</span><br><span class="line">  <span class="keyword">UNIQUE</span> INDEX `uk_configinfoaggr_datagrouptenantdatum`(`data_id`, `group_id`, `tenant_id`, `datum_id`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB AUTO_INCREMENT <span class="operator">=</span> <span class="number">1</span> <span class="type">CHARACTER</span> <span class="keyword">SET</span> <span class="operator">=</span> utf8 <span class="keyword">COLLATE</span> <span class="operator">=</span> utf8_bin COMMENT <span class="operator">=</span> <span class="string">&#x27;å¢åŠ ç§Ÿæˆ·å­—æ®µ&#x27;</span> ROW_FORMAT <span class="operator">=</span> <span class="keyword">Dynamic</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for config_info_beta</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `config_info_beta`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `config_info_beta`  (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">  `data_id` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;data_id&#x27;</span>,</span><br><span class="line">  `group_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;group_id&#x27;</span>,</span><br><span class="line">  `app_name` <span class="type">varchar</span>(<span class="number">128</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;app_name&#x27;</span>,</span><br><span class="line">  `content` longtext <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;content&#x27;</span>,</span><br><span class="line">  `beta_ips` <span class="type">varchar</span>(<span class="number">1024</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;betaIps&#x27;</span>,</span><br><span class="line">  `md5` <span class="type">varchar</span>(<span class="number">32</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;md5&#x27;</span>,</span><br><span class="line">  `gmt_create` datetime(<span class="number">0</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>(<span class="number">0</span>) COMMENT <span class="string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,</span><br><span class="line">  `gmt_modified` datetime(<span class="number">0</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>(<span class="number">0</span>) COMMENT <span class="string">&#x27;ä¿®æ”¹æ—¶é—´&#x27;</span>,</span><br><span class="line">  `src_user` text <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;source user&#x27;</span>,</span><br><span class="line">  `src_ip` <span class="type">varchar</span>(<span class="number">50</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;source ip&#x27;</span>,</span><br><span class="line">  `tenant_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;ç§Ÿæˆ·å­—æ®µ&#x27;</span>,</span><br><span class="line">  `encrypted_data_key` text <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;ç§˜é’¥&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`) <span class="keyword">USING</span> BTREE,</span><br><span class="line">  <span class="keyword">UNIQUE</span> INDEX `uk_configinfobeta_datagrouptenant`(`data_id`, `group_id`, `tenant_id`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB AUTO_INCREMENT <span class="operator">=</span> <span class="number">1</span> <span class="type">CHARACTER</span> <span class="keyword">SET</span> <span class="operator">=</span> utf8 <span class="keyword">COLLATE</span> <span class="operator">=</span> utf8_bin COMMENT <span class="operator">=</span> <span class="string">&#x27;config_info_beta&#x27;</span> ROW_FORMAT <span class="operator">=</span> <span class="keyword">Dynamic</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for config_info_tag</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `config_info_tag`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `config_info_tag`  (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">  `data_id` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;data_id&#x27;</span>,</span><br><span class="line">  `group_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;group_id&#x27;</span>,</span><br><span class="line">  `tenant_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;tenant_id&#x27;</span>,</span><br><span class="line">  `tag_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;tag_id&#x27;</span>,</span><br><span class="line">  `app_name` <span class="type">varchar</span>(<span class="number">128</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;app_name&#x27;</span>,</span><br><span class="line">  `content` longtext <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;content&#x27;</span>,</span><br><span class="line">  `md5` <span class="type">varchar</span>(<span class="number">32</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;md5&#x27;</span>,</span><br><span class="line">  `gmt_create` datetime(<span class="number">0</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>(<span class="number">0</span>) COMMENT <span class="string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,</span><br><span class="line">  `gmt_modified` datetime(<span class="number">0</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>(<span class="number">0</span>) COMMENT <span class="string">&#x27;ä¿®æ”¹æ—¶é—´&#x27;</span>,</span><br><span class="line">  `src_user` text <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;source user&#x27;</span>,</span><br><span class="line">  `src_ip` <span class="type">varchar</span>(<span class="number">50</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;source ip&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`) <span class="keyword">USING</span> BTREE,</span><br><span class="line">  <span class="keyword">UNIQUE</span> INDEX `uk_configinfotag_datagrouptenanttag`(`data_id`, `group_id`, `tenant_id`, `tag_id`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB AUTO_INCREMENT <span class="operator">=</span> <span class="number">1</span> <span class="type">CHARACTER</span> <span class="keyword">SET</span> <span class="operator">=</span> utf8 <span class="keyword">COLLATE</span> <span class="operator">=</span> utf8_bin COMMENT <span class="operator">=</span> <span class="string">&#x27;config_info_tag&#x27;</span> ROW_FORMAT <span class="operator">=</span> <span class="keyword">Dynamic</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for config_tags_relation</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `config_tags_relation`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `config_tags_relation`  (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">  `tag_name` <span class="type">varchar</span>(<span class="number">128</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;tag_name&#x27;</span>,</span><br><span class="line">  `tag_type` <span class="type">varchar</span>(<span class="number">64</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;tag_type&#x27;</span>,</span><br><span class="line">  `data_id` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;data_id&#x27;</span>,</span><br><span class="line">  `group_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;group_id&#x27;</span>,</span><br><span class="line">  `tenant_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;tenant_id&#x27;</span>,</span><br><span class="line">  `nid` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`nid`) <span class="keyword">USING</span> BTREE,</span><br><span class="line">  <span class="keyword">UNIQUE</span> INDEX `uk_configtagrelation_configidtag`(`id`, `tag_name`, `tag_type`) <span class="keyword">USING</span> BTREE,</span><br><span class="line">  INDEX `idx_tenant_id`(`tenant_id`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB AUTO_INCREMENT <span class="operator">=</span> <span class="number">1</span> <span class="type">CHARACTER</span> <span class="keyword">SET</span> <span class="operator">=</span> utf8 <span class="keyword">COLLATE</span> <span class="operator">=</span> utf8_bin COMMENT <span class="operator">=</span> <span class="string">&#x27;config_tag_relation&#x27;</span> ROW_FORMAT <span class="operator">=</span> <span class="keyword">Dynamic</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for group_capacity</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `group_capacity`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `group_capacity`  (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) UNSIGNED <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;ä¸»é”®ID&#x27;</span>,</span><br><span class="line">  `group_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;Group IDï¼Œç©ºå­—ç¬¦è¡¨ç¤ºæ•´ä¸ªé›†ç¾¤&#x27;</span>,</span><br><span class="line">  `quota` <span class="type">int</span>(<span class="number">10</span>) UNSIGNED <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">0</span> COMMENT <span class="string">&#x27;é…é¢ï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼&#x27;</span>,</span><br><span class="line">  `usage` <span class="type">int</span>(<span class="number">10</span>) UNSIGNED <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">0</span> COMMENT <span class="string">&#x27;ä½¿ç”¨é‡&#x27;</span>,</span><br><span class="line">  `max_size` <span class="type">int</span>(<span class="number">10</span>) UNSIGNED <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">0</span> COMMENT <span class="string">&#x27;å•ä¸ªé…ç½®å¤§å°ä¸Šé™ï¼Œå•ä½ä¸ºå­—èŠ‚ï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼&#x27;</span>,</span><br><span class="line">  `max_aggr_count` <span class="type">int</span>(<span class="number">10</span>) UNSIGNED <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">0</span> COMMENT <span class="string">&#x27;èšåˆå­é…ç½®æœ€å¤§ä¸ªæ•°ï¼Œï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼&#x27;</span>,</span><br><span class="line">  `max_aggr_size` <span class="type">int</span>(<span class="number">10</span>) UNSIGNED <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">0</span> COMMENT <span class="string">&#x27;å•ä¸ªèšåˆæ•°æ®çš„å­é…ç½®å¤§å°ä¸Šé™ï¼Œå•ä½ä¸ºå­—èŠ‚ï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼&#x27;</span>,</span><br><span class="line">  `max_history_count` <span class="type">int</span>(<span class="number">10</span>) UNSIGNED <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">0</span> COMMENT <span class="string">&#x27;æœ€å¤§å˜æ›´å†å²æ•°é‡&#x27;</span>,</span><br><span class="line">  `gmt_create` datetime(<span class="number">0</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>(<span class="number">0</span>) COMMENT <span class="string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,</span><br><span class="line">  `gmt_modified` datetime(<span class="number">0</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>(<span class="number">0</span>) COMMENT <span class="string">&#x27;ä¿®æ”¹æ—¶é—´&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`) <span class="keyword">USING</span> BTREE,</span><br><span class="line">  <span class="keyword">UNIQUE</span> INDEX `uk_group_id`(`group_id`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB AUTO_INCREMENT <span class="operator">=</span> <span class="number">1</span> <span class="type">CHARACTER</span> <span class="keyword">SET</span> <span class="operator">=</span> utf8 <span class="keyword">COLLATE</span> <span class="operator">=</span> utf8_bin COMMENT <span class="operator">=</span> <span class="string">&#x27;é›†ç¾¤ã€å„Groupå®¹é‡ä¿¡æ¯è¡¨&#x27;</span> ROW_FORMAT <span class="operator">=</span> <span class="keyword">Dynamic</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for his_config_info</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `his_config_info`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `his_config_info`  (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">64</span>) UNSIGNED <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `nid` <span class="type">bigint</span>(<span class="number">20</span>) UNSIGNED <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `data_id` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `group_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `app_name` <span class="type">varchar</span>(<span class="number">128</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;app_name&#x27;</span>,</span><br><span class="line">  `content` longtext <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `md5` <span class="type">varchar</span>(<span class="number">32</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `gmt_create` datetime(<span class="number">0</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>(<span class="number">0</span>),</span><br><span class="line">  `gmt_modified` datetime(<span class="number">0</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>(<span class="number">0</span>),</span><br><span class="line">  `src_user` text <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NULL</span>,</span><br><span class="line">  `src_ip` <span class="type">varchar</span>(<span class="number">50</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `op_type` <span class="type">char</span>(<span class="number">10</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `tenant_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;ç§Ÿæˆ·å­—æ®µ&#x27;</span>,</span><br><span class="line">  `encrypted_data_key` text <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;ç§˜é’¥&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`nid`) <span class="keyword">USING</span> BTREE,</span><br><span class="line">  INDEX `idx_gmt_create`(`gmt_create`) <span class="keyword">USING</span> BTREE,</span><br><span class="line">  INDEX `idx_gmt_modified`(`gmt_modified`) <span class="keyword">USING</span> BTREE,</span><br><span class="line">  INDEX `idx_did`(`data_id`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB AUTO_INCREMENT <span class="operator">=</span> <span class="number">1683</span> <span class="type">CHARACTER</span> <span class="keyword">SET</span> <span class="operator">=</span> utf8 <span class="keyword">COLLATE</span> <span class="operator">=</span> utf8_bin COMMENT <span class="operator">=</span> <span class="string">&#x27;å¤šç§Ÿæˆ·æ”¹é€ &#x27;</span> ROW_FORMAT <span class="operator">=</span> <span class="keyword">Dynamic</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for permissions</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `permissions`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `permissions`  (</span><br><span class="line">  `role` <span class="type">varchar</span>(<span class="number">50</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_general_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `resource` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_general_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `action` <span class="type">varchar</span>(<span class="number">8</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_general_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">UNIQUE</span> INDEX `uk_role_permission`(`role`, `resource`, `action`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB <span class="type">CHARACTER</span> <span class="keyword">SET</span> <span class="operator">=</span> utf8mb4 <span class="keyword">COLLATE</span> <span class="operator">=</span> utf8mb4_general_ci ROW_FORMAT <span class="operator">=</span> <span class="keyword">Dynamic</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for roles</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `roles`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `roles`  (</span><br><span class="line">  `username` <span class="type">varchar</span>(<span class="number">50</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_general_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `role` <span class="type">varchar</span>(<span class="number">50</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_general_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">UNIQUE</span> INDEX `idx_user_role`(`username`, `role`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB <span class="type">CHARACTER</span> <span class="keyword">SET</span> <span class="operator">=</span> utf8mb4 <span class="keyword">COLLATE</span> <span class="operator">=</span> utf8mb4_general_ci ROW_FORMAT <span class="operator">=</span> <span class="keyword">Dynamic</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for tenant_capacity</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `tenant_capacity`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `tenant_capacity`  (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) UNSIGNED <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;ä¸»é”®ID&#x27;</span>,</span><br><span class="line">  `tenant_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;Tenant ID&#x27;</span>,</span><br><span class="line">  `quota` <span class="type">int</span>(<span class="number">10</span>) UNSIGNED <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">0</span> COMMENT <span class="string">&#x27;é…é¢ï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼&#x27;</span>,</span><br><span class="line">  `usage` <span class="type">int</span>(<span class="number">10</span>) UNSIGNED <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">0</span> COMMENT <span class="string">&#x27;ä½¿ç”¨é‡&#x27;</span>,</span><br><span class="line">  `max_size` <span class="type">int</span>(<span class="number">10</span>) UNSIGNED <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">0</span> COMMENT <span class="string">&#x27;å•ä¸ªé…ç½®å¤§å°ä¸Šé™ï¼Œå•ä½ä¸ºå­—èŠ‚ï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼&#x27;</span>,</span><br><span class="line">  `max_aggr_count` <span class="type">int</span>(<span class="number">10</span>) UNSIGNED <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">0</span> COMMENT <span class="string">&#x27;èšåˆå­é…ç½®æœ€å¤§ä¸ªæ•°&#x27;</span>,</span><br><span class="line">  `max_aggr_size` <span class="type">int</span>(<span class="number">10</span>) UNSIGNED <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">0</span> COMMENT <span class="string">&#x27;å•ä¸ªèšåˆæ•°æ®çš„å­é…ç½®å¤§å°ä¸Šé™ï¼Œå•ä½ä¸ºå­—èŠ‚ï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼&#x27;</span>,</span><br><span class="line">  `max_history_count` <span class="type">int</span>(<span class="number">10</span>) UNSIGNED <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">0</span> COMMENT <span class="string">&#x27;æœ€å¤§å˜æ›´å†å²æ•°é‡&#x27;</span>,</span><br><span class="line">  `gmt_create` datetime(<span class="number">0</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>(<span class="number">0</span>) COMMENT <span class="string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,</span><br><span class="line">  `gmt_modified` datetime(<span class="number">0</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>(<span class="number">0</span>) COMMENT <span class="string">&#x27;ä¿®æ”¹æ—¶é—´&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`) <span class="keyword">USING</span> BTREE,</span><br><span class="line">  <span class="keyword">UNIQUE</span> INDEX `uk_tenant_id`(`tenant_id`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB AUTO_INCREMENT <span class="operator">=</span> <span class="number">1</span> <span class="type">CHARACTER</span> <span class="keyword">SET</span> <span class="operator">=</span> utf8 <span class="keyword">COLLATE</span> <span class="operator">=</span> utf8_bin COMMENT <span class="operator">=</span> <span class="string">&#x27;ç§Ÿæˆ·å®¹é‡ä¿¡æ¯è¡¨&#x27;</span> ROW_FORMAT <span class="operator">=</span> <span class="keyword">Dynamic</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for tenant_info</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `tenant_info`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `tenant_info`  (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">  `kp` <span class="type">varchar</span>(<span class="number">128</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;kp&#x27;</span>,</span><br><span class="line">  `tenant_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;tenant_id&#x27;</span>,</span><br><span class="line">  `tenant_name` <span class="type">varchar</span>(<span class="number">128</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;tenant_name&#x27;</span>,</span><br><span class="line">  `tenant_desc` <span class="type">varchar</span>(<span class="number">256</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;tenant_desc&#x27;</span>,</span><br><span class="line">  `create_source` <span class="type">varchar</span>(<span class="number">32</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;create_source&#x27;</span>,</span><br><span class="line">  `gmt_create` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,</span><br><span class="line">  `gmt_modified` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;ä¿®æ”¹æ—¶é—´&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`) <span class="keyword">USING</span> BTREE,</span><br><span class="line">  <span class="keyword">UNIQUE</span> INDEX `uk_tenant_info_kptenantid`(`kp`, `tenant_id`) <span class="keyword">USING</span> BTREE,</span><br><span class="line">  INDEX `idx_tenant_id`(`tenant_id`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB AUTO_INCREMENT <span class="operator">=</span> <span class="number">43</span> <span class="type">CHARACTER</span> <span class="keyword">SET</span> <span class="operator">=</span> utf8 <span class="keyword">COLLATE</span> <span class="operator">=</span> utf8_bin COMMENT <span class="operator">=</span> <span class="string">&#x27;tenant_info&#x27;</span> ROW_FORMAT <span class="operator">=</span> <span class="keyword">Dynamic</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for users</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `users`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `users`  (</span><br><span class="line">  `username` <span class="type">varchar</span>(<span class="number">50</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_general_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `password` <span class="type">varchar</span>(<span class="number">500</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_general_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `enabled` tinyint(<span class="number">1</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`username`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB <span class="type">CHARACTER</span> <span class="keyword">SET</span> <span class="operator">=</span> utf8mb4 <span class="keyword">COLLATE</span> <span class="operator">=</span> utf8mb4_general_ci ROW_FORMAT <span class="operator">=</span> <span class="keyword">Dynamic</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> FOREIGN_KEY_CHECKS <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> users (username, password, enabled) <span class="keyword">VALUES</span> (<span class="string">&#x27;nacos&#x27;</span>, <span class="string">&#x27;$2a$10$EuWPZHzz32dJN7jexM34MOeYirDdFAZm2kuWj7VEOJhhZkDrxfvUu&#x27;</span>, <span class="literal">TRUE</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> roles (username, role) <span class="keyword">VALUES</span> (<span class="string">&#x27;nacos&#x27;</span>, <span class="string">&#x27;ROLE_ADMIN&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="comment">/*   ipv6 support   */</span></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> `config_info_tag`</span><br><span class="line">MODIFY <span class="keyword">COLUMN</span> `src_ip` <span class="type">varchar</span>(<span class="number">50</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;source ip&#x27;</span> AFTER `src_user`;</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> `his_config_info`</span><br><span class="line">MODIFY <span class="keyword">COLUMN</span> `src_ip` <span class="type">varchar</span>(<span class="number">50</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> AFTER `src_user`;</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> `config_info`</span><br><span class="line">MODIFY <span class="keyword">COLUMN</span> `src_ip` <span class="type">varchar</span>(<span class="number">50</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;source ip&#x27;</span> AFTER `src_user`;</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> `config_info_beta`</span><br><span class="line">MODIFY <span class="keyword">COLUMN</span> `src_ip` <span class="type">varchar</span>(<span class="number">50</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;source ip&#x27;</span> AFTER `src_user`;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¯è¿ç§»ï¼Œ å¯ä»¥ç›´æ¥å°† nacos æ•°æ®åº“æ•´ä½“è¿ç§»ï¼Œå…å»å»ºè¡¨æ­¥éª¤ã€‚</p><h2 id="åˆ›å»º-Pod"><a href="#åˆ›å»º-Pod" class="headerlink" title="åˆ›å»º Pod"></a>åˆ›å»º Pod</h2><p>namespace æŒ‰ç…§éœ€æ±‚æ¥ä¿®æ”¹</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">StatefulSet</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nacos</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">public</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">nacos</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">nacos</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nacos</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">registry.cn-hangzhou.aliyuncs.com/iuxt/nacos-server:v2.1.0</span></span><br><span class="line">          <span class="comment"># image: nacos/nacos-server:v2.1.0       # å®˜æ–¹é•œåƒåœ°å€</span></span><br><span class="line">          <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">client</span></span><br><span class="line">              <span class="attr">containerPort:</span> <span class="number">8848</span></span><br><span class="line">              <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">client-rpc</span></span><br><span class="line">              <span class="attr">containerPort:</span> <span class="number">9848</span></span><br><span class="line">              <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">raft-rpc</span></span><br><span class="line">              <span class="attr">containerPort:</span> <span class="number">9849</span></span><br><span class="line">              <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">old-raft-rpc</span></span><br><span class="line">              <span class="attr">containerPort:</span> <span class="number">7848</span></span><br><span class="line">              <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">          <span class="attr">env:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">NACOS_REPLICAS</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">MYSQL_SERVICE_HOST</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">æ›¿æ¢æˆMySQLåœ°å€</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">MYSQL_SERVICE_DB_NAME</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">nacos</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">MYSQL_SERVICE_PORT</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&#x27;3306&#x27;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">MYSQL_SERVICE_USER</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">MySQLç”¨æˆ·å</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">MYSQL_SERVICE_PASSWORD</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">MySQLå¯†ç </span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">NACOS_SERVER_PORT</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&#x27;8848&#x27;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">NACOS_APPLICATION_PORT</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&#x27;8848&#x27;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">PREFER_HOST_MODE</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">hostname</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">NACOS_AUTH_ENABLE</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&#x27;true&#x27;</span></span><br><span class="line">              </span><br><span class="line">            <span class="comment"># è¿™é‡Œçš„åœ°å€éœ€è¦æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œä¿®æ”¹ï¼Œç”¨curlå…ˆæµ‹è¯•</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">NACOS_SERVERS</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&gt;-</span></span><br><span class="line"><span class="string">                nacos-0.nacos-headless.public.svc.cluster.local:8848</span></span><br><span class="line"><span class="string">                nacos-1.nacos-headless.public.svc.cluster.local:8848</span></span><br><span class="line"><span class="string">                nacos-2.nacos-headless.public.svc.cluster.local:8848</span></span><br><span class="line"><span class="string"></span>          <span class="attr">resources:</span></span><br><span class="line">            <span class="attr">requests:</span></span><br><span class="line">              <span class="attr">cpu:</span> <span class="string">500m</span></span><br><span class="line">              <span class="attr">memory:</span> <span class="string">2Gi</span></span><br><span class="line">      <span class="attr">dnsPolicy:</span> <span class="string">ClusterFirst</span></span><br><span class="line">      <span class="attr">affinity:</span></span><br><span class="line">        <span class="attr">podAntiAffinity:</span></span><br><span class="line">          <span class="attr">requiredDuringSchedulingIgnoredDuringExecution:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">labelSelector:</span></span><br><span class="line">                <span class="attr">matchExpressions:</span></span><br><span class="line">                  <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">app</span></span><br><span class="line">                    <span class="attr">operator:</span> <span class="string">In</span></span><br><span class="line">                    <span class="attr">values:</span></span><br><span class="line">                      <span class="bullet">-</span> <span class="string">nacos</span></span><br><span class="line">              <span class="attr">topologyKey:</span> <span class="string">kubernetes.io/hostname</span></span><br><span class="line">      <span class="attr">schedulerName:</span> <span class="string">default-scheduler</span></span><br><span class="line">  <span class="attr">serviceName:</span> <span class="string">nacos-headless</span></span><br><span class="line">  <span class="attr">podManagementPolicy:</span> <span class="string">OrderedReady</span></span><br></pre></td></tr></table></figure><h2 id="åˆ›å»º-Service"><a href="#åˆ›å»º-Service" class="headerlink" title="åˆ›å»º Service"></a>åˆ›å»º Service</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nacos-headless</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">public</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nacos-headless</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">ClusterIP</span></span><br><span class="line">  <span class="attr">clusterIP:</span> <span class="string">None</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">8848</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">server</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">8848</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">9848</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">client-rpc</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">9848</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">9849</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">raft-rpc</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">9849</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">7848</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">old-raft-rpc</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">7848</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nacos</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nacos-svc</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">public</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nacos</span></span><br><span class="line">  <span class="comment"># annotations:</span></span><br><span class="line">    <span class="comment"># prometheus.io/path: /nacos/actuator/prometheus</span></span><br><span class="line">    <span class="comment"># prometheus.io/port: &quot;8848&quot;</span></span><br><span class="line">    <span class="comment"># prometheus.io/scrape: &quot;true&quot;</span></span><br><span class="line">    <span class="comment"># service.alpha.kubernetes.io/tolerate-unready-endpoints: &quot;true&quot;</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">8848</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">server</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">8848</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">9848</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">client-rpc</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">9848</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">9849</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">raft-rpc</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">9849</span></span><br><span class="line">    <span class="comment">## å…¼å®¹1.4.xç‰ˆæœ¬çš„é€‰ä¸¾ç«¯å£</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">7848</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">old-raft-rpc</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">7848</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">ClusterIP</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nacos</span></span><br></pre></td></tr></table></figure><h2 id="åˆ›å»º-ingress-è§„åˆ™"><a href="#åˆ›å»º-ingress-è§„åˆ™" class="headerlink" title="åˆ›å»º ingress è§„åˆ™"></a>åˆ›å»º ingress è§„åˆ™</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="comment"># kubernetes.io/ingress.class: &quot;nginx&quot;                   # è¿™é‡Œæ˜¯ingressclassåå­—, è€ç‰ˆæœ¬k8sç”¨è¿™ä¸ª</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/ssl-redirect:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/app-root:</span> <span class="string">&quot;/nacos&quot;</span></span><br><span class="line">    <span class="comment"># ä¸‹é¢çš„é…ç½®å’Œä¸Šé¢çš„app-rootæ•ˆæœä¸€æ ·ï¼Œå°±æ˜¯è·³è½¬åˆ° /nacos</span></span><br><span class="line">    <span class="comment"># nginx.ingress.kubernetes.io/configuration-snippet: |</span></span><br><span class="line">    <span class="comment">#   rewrite ^/$ https://$host/nacos/ redirect;</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">prod-nacos-ingress</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">public</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ingressClassName:</span> <span class="string">&quot;public-nginx&quot;</span>    <span class="comment"># è¿™é‡Œæ˜¯ingressclassåå­—, æ–°ç‰ˆæœ¬k8sç”¨è¿™ä¸ª</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">è¿™é‡Œä¿®æ”¹ä¸ºnacosçš„åŸŸå</span></span><br><span class="line">    <span class="attr">http:</span></span><br><span class="line">      <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">service:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">nacos-svc</span></span><br><span class="line">            <span class="attr">port:</span></span><br><span class="line">              <span class="attr">number:</span> <span class="number">8848</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">/</span></span><br><span class="line">        <span class="attr">pathType:</span> <span class="string">ImplementationSpecific</span></span><br><span class="line">  <span class="attr">tls:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">hosts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">è¿™é‡Œä¿®æ”¹ä¸ºnacosçš„åŸŸå</span></span><br><span class="line">    <span class="attr">secretName:</span> <span class="string">i-com</span>     <span class="comment"># è¿™é‡Œé…ç½®sslè¯ä¹¦çš„secretåå­—</span></span><br></pre></td></tr></table></figure><p>ingress è§„åˆ™ä½œç”¨æ˜¯è®©ç½‘é¡µæ§åˆ¶å°åŸŸåè½¬å‘åˆ° 8848 ç«¯å£ï¼Œå¦‚æœä¸éœ€è¦åŸŸåï¼Œå¯ä»¥åœ¨ service ä¸Šå¼€ nodeportï¼Œç”¨ ip+ ç«¯å£æ¥è®¿é—®ã€‚</p><h2 id="æ£€æŸ¥éƒ¨ç½²æƒ…å†µ"><a href="#æ£€æŸ¥éƒ¨ç½²æƒ…å†µ" class="headerlink" title="æ£€æŸ¥éƒ¨ç½²æƒ…å†µ"></a>æ£€æŸ¥éƒ¨ç½²æƒ…å†µ</h2><p>éƒ¨ç½²å®Œæˆåï¼Œ è¿›å…¥ nacos çš„ podï¼Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /home/nacos/conf/cluster.conf</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#2023-11-21T14:48:56.695</span></span><br><span class="line">nacos-0.nacos-headless.public.svc.cluster.local:8848</span><br><span class="line">nacos-1.nacos-headless.public.svc.cluster.local:8848</span><br><span class="line">nacos-2.nacos-headless.public.svc.cluster.local:8848</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>3 èŠ‚ç‚¹çš„ nacosï¼Œè¿™é‡Œåº”è¯¥æ˜¯ 3 è¡Œé…ç½®ã€‚</p><h3 id="æ£€æŸ¥æ§åˆ¶å°"><a href="#æ£€æŸ¥æ§åˆ¶å°" class="headerlink" title="æ£€æŸ¥æ§åˆ¶å°"></a>æ£€æŸ¥æ§åˆ¶å°</h3><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202404291522377.png" alt="202404291522377.png|737"></p><p>çŠ¶æ€ä¸º UP é›†ç¾¤æ­£å¸¸ã€‚</p><h3 id="æ£€æŸ¥é›†ç¾¤çŠ¶æ€æ—¥å¿—"><a href="#æ£€æŸ¥é›†ç¾¤çŠ¶æ€æ—¥å¿—" class="headerlink" title="æ£€æŸ¥é›†ç¾¤çŠ¶æ€æ—¥å¿—"></a>æ£€æŸ¥é›†ç¾¤çŠ¶æ€æ—¥å¿—</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /home/nacos/logs/naming-server.log</span><br></pre></td></tr></table></figure><p>è§‚å¯Ÿæœ‰æ²¡æœ‰ ERROR ç±»ä¼¼çš„æ—¥å¿—ã€‚</p><h2 id="å¸¸ç”¨-API-æ¥å£"><a href="#å¸¸ç”¨-API-æ¥å£" class="headerlink" title="å¸¸ç”¨ API æ¥å£"></a>å¸¸ç”¨ API æ¥å£</h2><h3 id="è·å–é…ç½®æ–‡ä»¶"><a href="#è·å–é…ç½®æ–‡ä»¶" class="headerlink" title="è·å–é…ç½®æ–‡ä»¶"></a>è·å–é…ç½®æ–‡ä»¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¼€å¯äº†è®¤è¯çš„</span></span><br><span class="line">curl -X GET <span class="string">&quot;http://nacos-svc:8848/nacos/v1/cs/configs?dataId=&lt;é…ç½®æ–‡ä»¶ID&gt;&amp;group=DEFAULT_GROUP&amp;tenant=uat&amp;username=nacos&amp;password=nacos&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æœªå¼€å¯è®¤è¯</span></span><br><span class="line">curl -X GET <span class="string">&quot;http://nacos-svc:8848/nacos/v1/cs/configs?dataId=&lt;é…ç½®æ–‡ä»¶ID&gt;&amp;group=DEFAULT_GROUP&amp;tenant=sit&quot;</span></span><br></pre></td></tr></table></figure><p>tenant å‘½åç©ºé—´<br>dataID é…ç½®æ–‡ä»¶å<br>group åˆ†ç»„ï¼Œé»˜è®¤ä¸º DEFAULT_GROUP</p><h3 id="å…³é—­åŒå†™"><a href="#å…³é—­åŒå†™" class="headerlink" title="å…³é—­åŒå†™"></a>å…³é—­åŒå†™</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT <span class="string">&#x27;http://nacos-svc:8848/nacos/v1/ns/operator/switches?entry=doubleWriteEnabled&amp;value=false&amp;username=nacos&amp;password=nacos&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="å¸¸è§é—®é¢˜"><a href="#å¸¸è§é—®é¢˜" class="headerlink" title="å¸¸è§é—®é¢˜"></a>å¸¸è§é—®é¢˜</h2><h3 id="nacos-ä¿®æ”¹å¯†ç ä¸æˆåŠŸ"><a href="#nacos-ä¿®æ”¹å¯†ç ä¸æˆåŠŸ" class="headerlink" title="nacos ä¿®æ”¹å¯†ç ä¸æˆåŠŸ"></a>nacos ä¿®æ”¹å¯†ç ä¸æˆåŠŸ</h3><p>ä¿®æ”¹å¯†ç æç¤ºå·²ä¿®æ”¹ï¼Œå¹¶è‡ªåŠ¨æ³¨é”€ï¼Œç™»å½•æ—¶æ–°å¯†ç æ— æ³•ç™»å½•ï¼Œç”Ÿæ•ˆçš„è¿˜æ˜¯æ—§å¯†ç </p><p>éœ€è¦å…ˆå°† <code>NACOS_AUTH_ENABLE</code> å…³é—­ï¼Œ ä¿®æ”¹å®Œæˆå¯†ç åå†å¼€å¯ã€‚</p><h3 id="è´¦å·ç™»å½•åé©¬ä¸Šé€€å‡ºï¼Œæç¤ºæ²¡æœ‰æƒé™"><a href="#è´¦å·ç™»å½•åé©¬ä¸Šé€€å‡ºï¼Œæç¤ºæ²¡æœ‰æƒé™" class="headerlink" title="è´¦å·ç™»å½•åé©¬ä¸Šé€€å‡ºï¼Œæç¤ºæ²¡æœ‰æƒé™"></a>è´¦å·ç™»å½•åé©¬ä¸Šé€€å‡ºï¼Œæç¤ºæ²¡æœ‰æƒé™</h3><p>è´¦å·ç™»å½•åç°å®çš„æ˜¯ public å‘½åç©ºé—´ï¼Œå¦‚æœæ²¡æœ‰ public å‘½åç©ºé—´çš„æƒé™å°±ä¼šè‡ªåŠ¨é€€å‡ºã€‚</p><h3 id="æ‰§è¡Œ-sql-å»ºè¡¨çš„æ—¶å€™ï¼Œæç¤º-Specified-key-was-too-long-max-key-length-is-767-bytes"><a href="#æ‰§è¡Œ-sql-å»ºè¡¨çš„æ—¶å€™ï¼Œæç¤º-Specified-key-was-too-long-max-key-length-is-767-bytes" class="headerlink" title="æ‰§è¡Œ sql å»ºè¡¨çš„æ—¶å€™ï¼Œæç¤º Specified key was too long; max key length is 767 bytes"></a>æ‰§è¡Œ sql å»ºè¡¨çš„æ—¶å€™ï¼Œæç¤º Specified key was too long; max key length is 767 bytes</h3><p>éœ€è¦ä¿®æ”¹ MySQL innodb_large_prefix ä¸º ON</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æŸ¥çœ‹å‚æ•°</span></span><br><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;innodb_large_prefix&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ä¿®æ”¹å‚æ•°</span></span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> innodb_large_prefix <span class="operator">=</span> <span class="keyword">ON</span>;</span><br></pre></td></tr></table></figure><p>å¦‚æœ MySQL ä¸å…è®¸ä¿®æ”¹å‚æ•°ï¼Œ é‚£ä¹ˆä¹Ÿå¯ä»¥ä¿®æ”¹ nacos çš„ SQL</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- resource varchar(255) è¿™é‡Œé•¿åº¦æ”¹æˆ150</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `permissions` (</span><br><span class="line">`role` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">`resource` <span class="type">varchar</span>(<span class="number">150</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">`action` <span class="type">varchar</span>(<span class="number">8</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line"><span class="keyword">UNIQUE</span> INDEX `uk_role_permission` (`role`,`resource`,`action`) <span class="keyword">USING</span> BTREE</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h3 id="å¿˜è®°å¯†ç -é‡ç½®å¯†ç "><a href="#å¿˜è®°å¯†ç -é‡ç½®å¯†ç " class="headerlink" title="å¿˜è®°å¯†ç  é‡ç½®å¯†ç "></a>å¿˜è®°å¯†ç  é‡ç½®å¯†ç </h3><p>é‡ç½®è´¦å· nacos å¯†ç  ä¸º nacos</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> `nacos`.`users` <span class="keyword">SET</span> `password` <span class="operator">=</span> <span class="string">&#x27;$2a$10$EuWPZHzz32dJN7jexM34MOeYirDdFAZm2kuWj7VEOJhhZkDrxfvUu&#x27;</span>, `enabled` <span class="operator">=</span> <span class="number">1</span> <span class="keyword">WHERE</span> `username` <span class="operator">=</span> <span class="string">&#x27;nacos&#x27;</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> `nacos`.`roles` <span class="keyword">SET</span> `role` <span class="operator">=</span> <span class="string">&#x27;ROLE_ADMIN&#x27;</span> <span class="keyword">WHERE</span> `username` <span class="operator">=</span> <span class="string">&#x27;nacos&#x27;</span>;</span><br></pre></td></tr></table></figure><h3 id="ä¸šåŠ¡æŠ¥é”™-unknown-user"><a href="#ä¸šåŠ¡æŠ¥é”™-unknown-user" class="headerlink" title="ä¸šåŠ¡æŠ¥é”™ unknown user"></a>ä¸šåŠ¡æŠ¥é”™ unknown user</h3><p>æ£€æŸ¥ä¸€ä¸‹ï¼š</p><ul><li>ä¸šåŠ¡è¿ä¸Š nacos åï¼Œä¼šæ‹‰å–ä¸€ä»½é…ç½®æ–‡ä»¶åˆ°æœ¬åœ°ç¼“å­˜ï¼Œç¼“å­˜ä½ç½®åœ¨ <code>~/nacos/config</code> ç›®å½•ä¸‹ï¼Œ ç¡®è®¤ä¸‹è¿™é‡Œæ˜¯å¦æ‹‰å–äº†é…ç½®æ–‡ä»¶ã€‚</li><li>nacos æœåŠ¡ç®¡ç† æœåŠ¡åˆ—è¡¨ä¸­æ˜¯å¦æˆåŠŸæ³¨å†Œäº†èŠ‚ç‚¹ï¼ˆä¸šåŠ¡ä½¿ç”¨äº† nacos æœåŠ¡å‘ç°ï¼‰</li><li>ä½¿ç”¨ API æ¥å£æ¥è·å–é…ç½®æ–‡ä»¶æ˜¯å¦æ­£å¸¸è·å–åˆ°</li></ul><p>éœ€è¦æ³¨æ„çš„ï¼š</p><ul><li>å°½é‡ä¸è¦ä½¿ç”¨ public å‘½åç©ºé—´ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„å‘½åç©ºé—´ï¼Œå‘½åç©ºé—´ ID è®¾ç½®å’Œå‘½åç©ºé—´åå­—ä¸€æ ·ï¼Œä¸šåŠ¡é…ç½®ä¹Ÿè¦æŒ‡å®šé…ç½® namespace å’ŒæœåŠ¡å‘ç° namespace</li><li>ç¯å¢ƒå˜é‡ï¼š<code>spring.cloud.nacos.username</code> å’Œ <code>spring.cloud.nacos.password</code> çœ‹æƒ…å†µé…ç½®ä¸‹ï¼Œæˆ‘å°±é‡åˆ°è¿‡ nacos æ²¡å¼€é‰´æƒï¼Œä½†æ˜¯å¿…é¡»è¦é…ç½®è¿™ä¸¤ä¸ªå‚æ•°çš„æƒ…å†µã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> å®¹å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> éƒ¨ç½² </tag>
            
            <tag> Kubernetes </tag>
            
            <tag> k8s </tag>
            
            <tag> nacos </tag>
            
            <tag> è®°å½• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨cronjobè‡ªåŠ¨é‡å¯k8sçš„deployment</title>
      <link href="/posts/se4t7a/"/>
      <url>/posts/se4t7a/</url>
      
        <content type="html"><![CDATA[<h2 id="é…ç½®æƒé™"><a href="#é…ç½®æƒé™" class="headerlink" title="é…ç½®æƒé™"></a>é…ç½®æƒé™</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">deployment-restart</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Role</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">deployment-restart</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;apps&quot;</span>, <span class="string">&quot;extensions&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span> [<span class="string">&quot;deployments&quot;</span>]</span><br><span class="line">    <span class="attr">resourceNames:</span> []</span><br><span class="line">    <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;patch&quot;</span>, <span class="string">&quot;list&quot;</span>, <span class="string">&quot;watch&quot;</span>] <span class="comment"># list å’Œ watch å°±å¤Ÿç”¨äº†ï¼Œå¦‚æœéœ€è¦æ‰§è¡Œ rollout status ï¼Œåˆ™éœ€è¦ get patch</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># è§’è‰²ç»‘å®šè´¦å·</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">RoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">deployment-restart</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">Role</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">deployment-restart</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">deployment-restart</span></span><br><span class="line">    <span class="attr">namespace:</span> <span class="string">default</span></span><br></pre></td></tr></table></figure><h2 id="ç¼–å†™-cronjob"><a href="#ç¼–å†™-cronjob" class="headerlink" title="ç¼–å†™ cronjob"></a>ç¼–å†™ cronjob</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">batch/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CronJob</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">deployment-restart</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="comment"># å¤šå°‘ç§’åæ¸…ç†å·²å®Œæˆçš„jobï¼Œ1.23ç‰ˆæœ¬ä¹‹åå¯ç”¨ã€‚</span></span><br><span class="line">  <span class="attr">ttlSecondsAfterFinished:</span> <span class="number">100</span></span><br><span class="line">  <span class="attr">concurrencyPolicy:</span> <span class="string">Forbid</span></span><br><span class="line">  <span class="attr">schedule:</span> <span class="string">&#x27;37 14 * * *&#x27;</span> <span class="comment"># åˆ†æ—¶æ—¥æœˆå‘¨</span></span><br><span class="line">  <span class="attr">jobTemplate:</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">backoffLimit:</span> <span class="number">2</span></span><br><span class="line">      <span class="attr">activeDeadlineSeconds:</span> <span class="number">600</span></span><br><span class="line">      <span class="attr">template:</span></span><br><span class="line">        <span class="attr">spec:</span></span><br><span class="line">          <span class="attr">serviceAccountName:</span> <span class="string">deployment-restart</span></span><br><span class="line">          <span class="attr">restartPolicy:</span> <span class="string">Never</span></span><br><span class="line">          <span class="attr">containers:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">kubectl</span></span><br><span class="line">              <span class="comment"># image: bitnami/kubectl:1.30.1</span></span><br><span class="line">              <span class="attr">image:</span> <span class="string">registry.cn-hangzhou.aliyuncs.com/iuxt/kubectl:1.30.1</span></span><br><span class="line">              <span class="attr">command:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">bash</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">-c</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">&gt;-</span></span><br><span class="line"><span class="string">                  kubectl rollout restart deployment/nginx &amp;&amp;</span></span><br><span class="line"><span class="string">                  kubectl rollout status deployment/java-example</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å®¹å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Crontab </tag>
            
            <tag> kubectl </tag>
            
            <tag> Kubernetes </tag>
            
            <tag> k8s </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hadoopé›†ç¾¤æ­å»ºè®°å½•</title>
      <link href="/posts/sds4t1/"/>
      <url>/posts/sds4t1/</url>
      
        <content type="html"><![CDATA[<h2 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h2><h3 id="é…ç½®èŠ‚ç‚¹é—´-ssh-å…å¯†"><a href="#é…ç½®èŠ‚ç‚¹é—´-ssh-å…å¯†" class="headerlink" title="é…ç½®èŠ‚ç‚¹é—´ ssh å…å¯†"></a>é…ç½®èŠ‚ç‚¹é—´ ssh å…å¯†</h3><p>ç•¥</p><h3 id="å®‰è£…-java-ç¯å¢ƒ"><a href="#å®‰è£…-java-ç¯å¢ƒ" class="headerlink" title="å®‰è£… java ç¯å¢ƒ"></a>å®‰è£… java ç¯å¢ƒ</h3><p>ç•¥</p><h3 id="æ­å»º-zookeeper"><a href="#æ­å»º-zookeeper" class="headerlink" title="æ­å»º zookeeper"></a>æ­å»º zookeeper</h3><p><a href="/posts/sds4db/">zookeeperé›†ç¾¤æ­å»º</a></p><h3 id="ç»‘å®š-hosts"><a href="#ç»‘å®š-hosts" class="headerlink" title="ç»‘å®š hosts"></a>ç»‘å®š hosts</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt;&gt; /etc/hosts &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">192.168.200.11 hadoop1</span><br><span class="line">192.168.200.12 hadoop2</span><br><span class="line">192.168.200.13 hadoop3</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h3 id="ç¯å¢ƒå˜é‡"><a href="#ç¯å¢ƒå˜é‡" class="headerlink" title="ç¯å¢ƒå˜é‡"></a>ç¯å¢ƒå˜é‡</h3><p>vim &#x2F;etc&#x2F;profile</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># hadoop</span></span><br><span class="line"><span class="built_in">export</span> HADOOP_HOME=/data/hadoop-3.2.4/</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$HADOOP_HOME</span>/bin:<span class="variable">$HADOOP_HOME</span>/sbin</span><br></pre></td></tr></table></figure><h3 id="åˆ›å»ºç›®å½•"><a href="#åˆ›å»ºç›®å½•" class="headerlink" title="åˆ›å»ºç›®å½•"></a>åˆ›å»ºç›®å½•</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /data/hadoop_data/</span><br><span class="line"><span class="built_in">mkdir</span> -p /var/lib/hadoop-hdfs</span><br></pre></td></tr></table></figure><h2 id="ä¿®æ”¹é…ç½®"><a href="#ä¿®æ”¹é…ç½®" class="headerlink" title="ä¿®æ”¹é…ç½®"></a>ä¿®æ”¹é…ç½®</h2><p>workers è¿™é‡Œé¢æ˜¯ datanode èŠ‚ç‚¹åˆ—è¡¨ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@m1 hadoop]<span class="comment"># cat workers</span></span><br><span class="line">hadoop1</span><br><span class="line">hadoop2</span><br><span class="line">hadoop3</span><br></pre></td></tr></table></figure><p>hadoop-env.sh</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é…ç½®JAVA_HOME</span></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/local/java</span><br><span class="line"><span class="comment"># è®¾ç½®ç”¨æˆ·ä»¥æ‰§è¡Œå¯¹åº”è§’è‰²shellå‘½ä»¤</span></span><br><span class="line"><span class="built_in">export</span> HDFS_NAMENODE_USER=root</span><br><span class="line"><span class="built_in">export</span> HDFS_DATANODE_USER=root</span><br><span class="line"><span class="built_in">export</span> HDFS_SECONDARYNAMENODE_USER=root</span><br><span class="line"><span class="built_in">export</span> YARN_RESOURCEMANAGER_USER=root</span><br><span class="line"><span class="built_in">export</span> YARN_NODEMANAGER_USER=root</span><br><span class="line"><span class="built_in">export</span> HDFS_JOURNALNODE_USER=root</span><br><span class="line"><span class="built_in">export</span> HDFS_ZKFC_USER=root</span><br></pre></td></tr></table></figure><p>hdfs-site.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--æŒ‡å®š hdfs çš„ nameservice ä¸º myclusterï¼Œéœ€è¦å’Œ core-site.xml ä¸­çš„ä¿æŒä¸€è‡´ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.nameservices<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>mycluster<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- mycluster ä¸‹é¢æœ‰ä¸¤ä¸ª NameNodeï¼Œåˆ†åˆ«æ˜¯ nn1ï¼Œnn2 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.ha.namenodes.mycluster<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>nn1,nn2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- nn1 çš„ RPC é€šä¿¡åœ°å€ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.rpc-address.mycluster.nn1<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop1:8020<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- nn1 çš„ http é€šä¿¡åœ°å€ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.http-address.mycluster.nn1<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop1:9870<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- nn2 çš„ RPC é€šä¿¡åœ°å€ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.rpc-address.mycluster.nn2<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop2:8020<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- nn2 çš„ http é€šä¿¡åœ°å€ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.http-address.mycluster.nn2<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop2:9870<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- æŒ‡å®š NameNode çš„ edits å…ƒæ•°æ®åœ¨ JournalNode ä¸Šçš„å­˜æ”¾ä½ç½® --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.shared.edits.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>qjournal://hadoop1:8485;hadoop2:8485;hadoop3:8485/mycluster<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- æŒ‡å®š JournalNode åœ¨æœ¬åœ°ç£ç›˜å­˜æ”¾æ•°æ®çš„ä½ç½® --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.journalnode.edits.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>/data/hadoop_data/journaldata<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- å¼€å¯ NameNode å¤±è´¥è‡ªåŠ¨åˆ‡æ¢ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.ha.automatic-failover.enabled<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- æŒ‡å®šè¯¥é›†ç¾¤å‡ºæ•…éšœæ—¶ï¼Œå“ªä¸ªå®ç°ç±»è´Ÿè´£æ‰§è¡Œæ•…éšœåˆ‡æ¢ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.client.failover.proxy.provider.mycluster<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>org.apache.hadoop.hdfs.server.namenode.ha.ConfiguredFailoverProxyProvider<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- é…ç½®éš”ç¦»æœºåˆ¶æ–¹æ³•--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.ha.fencing.methods<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>shell(/bin/true)<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- å¼€å¯çŸ­è·¯æœ¬åœ°è¯»å–åŠŸèƒ½ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.client.read.shortcircuit<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- éœ€æ‰‹åŠ¨åˆ›å»ºç›®å½• mkdir -p /var/lib/hadoop-hdfs --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.domain.socket.path<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>/var/lib/hadoop-hdfs/dn_socket<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- å¼€å¯é»‘åå• --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.hosts.exclude<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>/data/hadoop-3.2.4/etc/hadoop/excludes<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><p>core-site.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- HA é›†ç¾¤åç§°ï¼Œè¯¥å€¼è¦å’Œ hdfs-site.xml ä¸­çš„é…ç½®ä¿æŒä¸€è‡´ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>fs.defaultFS<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://mycluster<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- hadoop æœ¬åœ°æ•°æ®å­˜å‚¨ç›®å½• format æ—¶è‡ªåŠ¨ç”Ÿæˆ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.tmp.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>/data/hadoop_data/tmp<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- åœ¨ Web UI è®¿é—® HDFS ä½¿ç”¨çš„ç”¨æˆ·åã€‚--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.http.staticuser.user<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>root<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- ZooKeeper é›†ç¾¤çš„åœ°å€å’Œç«¯å£--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>ha.zookeeper.quorum<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop1:2181,hadoop2:2181,hadoop3:2181<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="é›†ç¾¤åˆå§‹åŒ–"><a href="#é›†ç¾¤åˆå§‹åŒ–" class="headerlink" title="é›†ç¾¤åˆå§‹åŒ–"></a>é›†ç¾¤åˆå§‹åŒ–</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. é¦–å…ˆå¯åŠ¨ zookeeper é›†ç¾¤</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 2. æ‰‹åŠ¨å¯åŠ¨ JN é›†ç¾¤ï¼ˆ3å°æœºå™¨ï¼‰</span></span><br><span class="line">hdfs --daemon start journalnode</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 3. åœ¨ hadoop01 æ‰§è¡Œæ ¼å¼åŒ– namenode å¹¶å¯åŠ¨ namenode</span></span><br><span class="line">[root@hadoop1 ~]<span class="comment"># hdfs namenode -format</span></span><br><span class="line">[root@hadoop1 ~]<span class="comment"># hdfs --daemon start namenode</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 4. åœ¨ hadoop02 ä¸Šè¿›è¡Œ namenode å…ƒæ•°æ®åŒæ­¥</span></span><br><span class="line">[root@hadoop2 ~]<span class="comment"># hdfs namenode -bootstrapStandby</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 5. æ ¼å¼åŒ– zkfcã€‚æ³¨æ„ï¼šåœ¨å“ªå°æœºå™¨ä¸Šæ‰§è¡Œï¼Œå“ªå°æœºå™¨å°±å°†æˆä¸ºç¬¬ä¸€æ¬¡çš„ Active NN</span></span><br><span class="line">[root@hadoop1 ~]<span class="comment"># hdfs zkfc -formatZK</span></span><br></pre></td></tr></table></figure><p>start-dfs.sh</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@hadoop1 ~]<span class="comment"># jps</span></span><br><span class="line">6355 QuorumPeerMain</span><br><span class="line">6516 JournalNode</span><br><span class="line">7573 DataNode</span><br><span class="line">7989 DFSZKFailoverController</span><br><span class="line">8040 Jps</span><br><span class="line">7132 NameNode</span><br><span class="line"> </span><br><span class="line">[root@hadoop2 ~]<span class="comment"># jps</span></span><br><span class="line">4688 JournalNode</span><br><span class="line">5201 NameNode</span><br><span class="line">5521 Jps</span><br><span class="line">5282 DataNode</span><br><span class="line">4536 QuorumPeerMain</span><br><span class="line">5482 DFSZKFailoverController</span><br><span class="line"> </span><br><span class="line">[root@hadoop3 ~]<span class="comment"># jps</span></span><br><span class="line">4384 DataNode</span><br><span class="line">3990 QuorumPeerMain</span><br><span class="line">4136 JournalNode</span><br><span class="line">4511 Jps</span><br></pre></td></tr></table></figure><h2 id="æ£€æŸ¥"><a href="#æ£€æŸ¥" class="headerlink" title="æ£€æŸ¥"></a>æ£€æŸ¥</h2><p>æµè§ˆå™¨æ‰“å¼€</p><p><a href="http://hadoop1:9870/">http://hadoop1:9870</a> æŸ¥çœ‹çŠ¶æ€ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æ—¥å¿— </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
            <tag> éƒ¨ç½² </tag>
            
            <tag> å¤§æ•°æ® </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¼€æºåˆ†å¸ƒå¼å­˜å‚¨å·¥å…·longhornéƒ¨ç½²</title>
      <link href="/posts/scx23m/"/>
      <url>/posts/scx23m/</url>
      
        <content type="html"><![CDATA[<p>k8s å¦‚æœéœ€è¦ç”¨åˆ°å­˜å‚¨ï¼Œå¯¹äºäº‘äº§å“ä¸€èˆ¬éƒ½æ˜¯é‡‡ç”¨äº‘å‚å•†æä¾›çš„å­˜å‚¨é©±åŠ¨ï¼Œè‡ªå»ºæœºæˆ¿ç®€å•ä¸€ç‚¹çš„ä¼šé‡‡ç”¨ nfsï¼Œnfs æœ‰ä»¥ä¸‹é—®é¢˜ï¼š</p><ul><li>é«˜å¯ç”¨æ€§é—®é¢˜ï¼Œä¸€èˆ¬éƒ½æ˜¯å•å°æœºå™¨åœ¨è·‘ï¼Œé«˜å¯ç”¨å®Œå…¨ä¾é ç‰©ç†æœºå™¨çš„ RAIDï¼Œéå¸¸ä¸äº‘åŸç”Ÿ</li><li>æ€§èƒ½é—®é¢˜ï¼ŒNFS æœ¬èº«æ€§èƒ½ä¸ç®—å¥½ï¼Œå¤–åŠ ä¸€ä¸ªé›†ç¾¤éƒ½åœ¨ä½¿ç”¨ï¼Œç½‘å¡é€Ÿåº¦æ˜¯ä¸ªç“¶é¢ˆ<br>longhorn æ˜¯ä¸ªå¼€æºçš„å­˜å‚¨å¼•æ“ï¼Œç®€å•æ¥è¯´å°±æ˜¯å®ƒæŠŠ k8s æ¯ä¸ªèŠ‚ç‚¹çš„ç£ç›˜ç©ºé—´æœé›†èµ·æ¥ï¼Œç»„æˆä¸€ä¸ªå¤§æ± å­ï¼Œç„¶ååˆ†é…ä¸ªå„ä¸ª pod ä½¿ç”¨ã€‚å¹¶é€šè¿‡å¤šå‰¯æœ¬çš„æ–¹å¼åšé«˜å¯ç”¨ã€‚longhorn å¥½åƒæ˜¯ openSUSE å®¶çš„å§ï¼Œå’Œ rancher ä¸€ä¸ªå…¬å¸ã€‚</li></ul><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202405231106850.svg"></p><h2 id="å®˜æ–¹æ–‡æ¡£"><a href="#å®˜æ–¹æ–‡æ¡£" class="headerlink" title="å®˜æ–¹æ–‡æ¡£"></a>å®˜æ–¹æ–‡æ¡£</h2><p>å®˜æ–¹å®‰è£…è¯´æ˜ï¼š<br><a href="https://longhorn.io/docs/1.6.1/deploy/install/install-with-kubectl/">https://longhorn.io/docs/1.6.1/deploy/install/install-with-kubectl/</a></p><p>å®˜æ–¹å®‰è£…è¦æ±‚ï¼š<br><a href="https://longhorn.io/docs/1.6.1/deploy/install/#installation-requirements">https://longhorn.io/docs/1.6.1/deploy/install/#installation-requirements</a></p><p>å®˜æ–¹çš„æ£€æŸ¥ä¾èµ–é¡¹è„šæœ¬ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -fsSL https://raw.githubusercontent.com/longhorn/longhorn/v1.6.1/scripts/environment_check.sh | bash</span><br></pre></td></tr></table></figure><h2 id="å®‰è£…ä¾èµ–"><a href="#å®‰è£…ä¾èµ–" class="headerlink" title="å®‰è£…ä¾èµ–"></a>å®‰è£…ä¾èµ–</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># CentOS 7</span></span><br><span class="line">yum install -y jq <span class="built_in">mktemp</span> <span class="built_in">sort</span> <span class="built_in">printf</span></span><br><span class="line">yum install -y iscsi-initiator-utils</span><br><span class="line">systemctl <span class="built_in">enable</span> --now iscsid.service</span><br><span class="line"></span><br><span class="line">yum install -y nfs-utils</span><br><span class="line">yum install -y cryptsetup</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨-kubectl-å®‰è£…-longhorn"><a href="#ä½¿ç”¨-kubectl-å®‰è£…-longhorn" class="headerlink" title="ä½¿ç”¨ kubectl å®‰è£… longhorn"></a>ä½¿ç”¨ kubectl å®‰è£… longhorn</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f https://raw.githubusercontent.com/longhorn/longhorn/v1.6.1/deploy/longhorn.yaml</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å®¹å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> kubectl </tag>
            
            <tag> å­˜å‚¨ </tag>
            
            <tag> Kubernetes </tag>
            
            <tag> k8s </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å•èŠ‚ç‚¹Kubernetesæ›´æ¢ipåœ°å€</title>
      <link href="/posts/scpj14/"/>
      <url>/posts/scpj14/</url>
      
        <content type="html"><![CDATA[<p>å¦‚æœæ˜¯ä¸ªå¤šèŠ‚ç‚¹çš„é›†ç¾¤ï¼Œæ›´æ¢ä¸€å° master èŠ‚ç‚¹çš„ ip æœ‰ä¸ªæ›´ç®€å•çš„åŠæ³•ï¼Œé‚£å°±æ˜¯å…ˆæŠŠè¿™å°æœºå™¨ä¸‹çº¿ï¼Œç„¶åå†æ‰©å®¹ä¸€å°æ–°çš„ masterï¼Œå®‰å…¨æ— å‰¯ä½œç”¨ï¼Œå¦‚æœæ˜¯å•èŠ‚ç‚¹æ›´æ¢ ip åœ°å€ï¼ˆå¦‚æœæ—§ ip ä¸ç”¨å›æ”¶ï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥åœ¨ç½‘å¡ä¸Šå†ç»‘å®šä¸€ä¸ª ip åœ°å€ï¼Œä¸ç”¨å¯¹ k8s è¿›è¡Œä¿®æ”¹ï¼‰</p><p>å’Œ <a href="/posts/34d8fad0/">kubeadmä¹‹å•èŠ‚ç‚¹masterå‡çº§é«˜å¯ç”¨master</a> æœ‰ç‚¹ç±»ä¼¼</p><h2 id="é¦–å…ˆæ›´æ¢æ“ä½œç³»ç»Ÿ-ip-åœ°å€"><a href="#é¦–å…ˆæ›´æ¢æ“ä½œç³»ç»Ÿ-ip-åœ°å€" class="headerlink" title="é¦–å…ˆæ›´æ¢æ“ä½œç³»ç»Ÿ ip åœ°å€"></a>é¦–å…ˆæ›´æ¢æ“ä½œç³»ç»Ÿ ip åœ°å€</h2><p>ç•¥</p><h2 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¤‡ä»½é…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="built_in">cp</span> -r /etc/kubernetes&#123;,-bak&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹è¯ä¹¦ç»‘å®šçš„ipæˆ–åŸŸå</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(find /etc/kubernetes/pki -<span class="built_in">type</span> f -name <span class="string">&quot;*.crt&quot;</span>);<span class="keyword">do</span> <span class="built_in">echo</span> <span class="variable">$&#123;i&#125;</span> &amp;&amp; openssl x509 -<span class="keyword">in</span> <span class="variable">$&#123;i&#125;</span> -text | grep <span class="string">&#x27;DNS:&#x27;</span>;<span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤éœ€è¦é‡æ–°ç”Ÿæˆçš„è¯ä¹¦</span></span><br><span class="line"><span class="built_in">rm</span> -rf /etc/kubernetes/pki/&#123;apiserver*,front-proxy-client*&#125;</span><br><span class="line"><span class="built_in">rm</span> -rf /etc/kubernetes/pki/etcd/&#123;healthcheck*,peer*,server*&#125;</span><br></pre></td></tr></table></figure><h2 id="é‡æ–°ç­¾å‘è¯ä¹¦"><a href="#é‡æ–°ç­¾å‘è¯ä¹¦" class="headerlink" title="é‡æ–°ç­¾å‘è¯ä¹¦"></a>é‡æ–°ç­¾å‘è¯ä¹¦</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿™é‡Œéœ€è¦ä¿®æ”¹è¯ä¹¦ç»‘å®šçš„ip</span></span><br><span class="line">kubeadm init phase certs all \</span><br><span class="line">    --apiserver-advertise-address 192.168.163.10 \</span><br><span class="line">    --apiserver-cert-extra-sans <span class="string">&quot;192.168.163.10,192.168.163.11,192.168.163.12&quot;</span> \</span><br><span class="line">    --cert-dir <span class="string">&quot;/etc/kubernetes/pki&quot;</span></span><br></pre></td></tr></table></figure><h2 id="æ›´æ–°é…ç½®æ–‡ä»¶é‡Œçš„-ip-åœ°å€"><a href="#æ›´æ–°é…ç½®æ–‡ä»¶é‡Œçš„-ip-åœ°å€" class="headerlink" title="æ›´æ–°é…ç½®æ–‡ä»¶é‡Œçš„ ip åœ°å€"></a>æ›´æ–°é…ç½®æ–‡ä»¶é‡Œçš„ ip åœ°å€</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">grep -R 10.0.0.10 /etc/kubernetes/*</span><br><span class="line"></span><br><span class="line">vim ~/.kube/config</span><br></pre></td></tr></table></figure><h2 id="è¿™ä¸ªæ—¶å€™-kubectl-å¯ç”¨äº†ï¼Œä¿®æ”¹-configmap"><a href="#è¿™ä¸ªæ—¶å€™-kubectl-å¯ç”¨äº†ï¼Œä¿®æ”¹-configmap" class="headerlink" title="è¿™ä¸ªæ—¶å€™ kubectl å¯ç”¨äº†ï¼Œä¿®æ”¹ configmap"></a>è¿™ä¸ªæ—¶å€™ kubectl å¯ç”¨äº†ï¼Œä¿®æ”¹ configmap</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl edit cm -n kube-system kubeadm-config</span><br><span class="line">kubectl edit cm -n kube-system kube-proxy</span><br></pre></td></tr></table></figure><h2 id="ç„¶ååˆ é™¤-pod-é‡å»º"><a href="#ç„¶ååˆ é™¤-pod-é‡å»º" class="headerlink" title="ç„¶ååˆ é™¤ pod é‡å»º"></a>ç„¶ååˆ é™¤ pod é‡å»º</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl -n kube-system delete pod kube-apiserver-k8s kube-controller-manager-k8s kube-proxy-nhqvg kube-scheduler-k8s etcd-k8s coredns-558bd4d5db-c4xbw</span><br><span class="line">kubectl -n kube-flannel delete pod kube-flannel-ds-8s6cn</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å®¹å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Kubernetes </tag>
            
            <tag> k8s </tag>
            
            <tag> kubeadm </tag>
            
            <tag> è®°å½• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨ Docker æ­å»ºé›†ç¾¤ç‰ˆ Elasticsearch å­¦ä¹ ç¯å¢ƒ</title>
      <link href="/posts/schwdt/"/>
      <url>/posts/schwdt/</url>
      
        <content type="html"><![CDATA[<p>ä¸€èˆ¬æ¥è¯´ï¼Œå­¦ä¹  ES éƒ½æ˜¯è‡ªå·±å…ˆæ­å»ºå‡ å°è™šæ‹Ÿæœºï¼Œç„¶ååœ¨è™šæ‹Ÿæœºé‡Œéƒ¨ç½² ES é›†ç¾¤ï¼Œè¿™æ ·åšèµ„æºæ¶ˆè€—æ¯”è¾ƒå¤§ï¼Œä¸€èˆ¬çš„ç”µè„‘éƒ½æ²¡æœ‰è¿™ä¹ˆé«˜çš„é…ç½®ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Docker æ¥å¿«é€Ÿéƒ¨ç½²ä¸€å¥— Elasticsearch é›†ç¾¤ï¼Œè¿™é‡Œä»¥ 3 èŠ‚ç‚¹é›†ç¾¤ä¸ºä¾‹ï¼š</p><h2 id="å‡†å¤‡-Docker-ç½‘ç»œ"><a href="#å‡†å¤‡-Docker-ç½‘ç»œ" class="headerlink" title="å‡†å¤‡ Docker ç½‘ç»œ"></a>å‡†å¤‡ Docker ç½‘ç»œ</h2><p>é›†ç¾¤èŠ‚ç‚¹ä¹‹é—´æ˜¯é€šè¿‡ ip è¿›è¡Œäº¤äº’çš„ï¼Œæ‰€ä»¥éœ€è¦å›ºå®šä¸€ä¸‹ ipï¼Œå›ºå®š ip ä¹‹å‰éœ€è¦å…ˆåˆ›å»ºä¸€ä¸ª Docker ç§æœ‰ç½‘ç»œï¼Œå¹¶å›ºå®šç½‘æ®µ (ç½‘æ®µä¸è¦å’Œä½ çš„å†…ç½‘å†²çª)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network create --subnet=172.16.0.0/24 elasticsearch-br0</span><br></pre></td></tr></table></figure><h2 id="é›†ç¾¤ç‰ˆ-Elasticsearch-éœ€è¦ç”Ÿæˆè¯ä¹¦"><a href="#é›†ç¾¤ç‰ˆ-Elasticsearch-éœ€è¦ç”Ÿæˆè¯ä¹¦" class="headerlink" title="é›†ç¾¤ç‰ˆ Elasticsearch éœ€è¦ç”Ÿæˆè¯ä¹¦"></a>é›†ç¾¤ç‰ˆ Elasticsearch éœ€è¦ç”Ÿæˆè¯ä¹¦</h2><p>é»˜è®¤ç”Ÿæˆ 3 å¹´è¯ä¹¦ï¼Œæˆ‘æŒ‡å®šç”Ÿæˆäº† 100 å¹´çš„è¯ä¹¦ï¼Œ ç”Ÿæˆåˆ°äº† <code>certs</code> ç›®å½•ä¸‹ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker run --<span class="built_in">rm</span> -it -v $(<span class="built_in">pwd</span>)/certs:/tmp/certs elasticsearch:7.17.14 bash -c \</span><br><span class="line">    <span class="string">&#x27;echo -e &quot;\n\n&quot; | /usr/share/elasticsearch/bin/elasticsearch-certutil ca -s -days 36500 &amp;&amp; \</span></span><br><span class="line"><span class="string">    echo -e &quot;\n\n\n&quot; | /usr/share/elasticsearch/bin/elasticsearch-certutil cert -s -days 36500 --ca elastic-stack-ca.p12 &amp;&amp; \</span></span><br><span class="line"><span class="string">    mv /usr/share/elasticsearch/*.p12 /tmp/certs &amp;&amp; \</span></span><br><span class="line"><span class="string">    chmod 777 -R /tmp/certs&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="æŒ‡å®š-IP-è¿è¡Œå®¹å™¨"><a href="#æŒ‡å®š-IP-è¿è¡Œå®¹å™¨" class="headerlink" title="æŒ‡å®š IP è¿è¡Œå®¹å™¨"></a>æŒ‡å®š IP è¿è¡Œå®¹å™¨</h2><p>æˆ‘è¿™é‡Œå°†æ•°æ®æŒä¹…åŒ–åˆ°äº† docker å·ä¸­ï¼Œé€šè¿‡ <code>docker volume ls</code> å¯ä»¥æŸ¥çœ‹ã€‚</p><h3 id="elasticsearch1"><a href="#elasticsearch1" class="headerlink" title="elasticsearch1"></a>elasticsearch1</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name elasticsearch1 \</span><br><span class="line">    --<span class="built_in">ulimit</span> memlock=-1:-1 \</span><br><span class="line">    -e <span class="string">&quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot;</span> \</span><br><span class="line">    -e node.name=elasticsearch1 \</span><br><span class="line">    -e cluster.name=es-cluster \</span><br><span class="line">    -e discovery.seed_hosts=elasticsearch2,elasticsearch3 \</span><br><span class="line">    -e cluster.initial_master_nodes=elasticsearch1,elasticsearch2,elasticsearch3 \</span><br><span class="line">    -e bootstrap.memory_lock=<span class="literal">true</span> \</span><br><span class="line">    -e xpack.security.enabled=<span class="literal">true</span> \</span><br><span class="line">    -e http.cors.enabled=<span class="literal">true</span> \</span><br><span class="line">    -e http.cors.allow-origin=<span class="string">&quot;*&quot;</span> \</span><br><span class="line">    -e http.cors.allow-headers=Authorization \</span><br><span class="line">    -e xpack.security.enabled=<span class="literal">true</span> \</span><br><span class="line">    -e xpack.security.transport.ssl.enabled=<span class="literal">true</span> \</span><br><span class="line">    -e xpack.security.transport.ssl.verification_mode=certificate \</span><br><span class="line">    -e xpack.security.transport.ssl.keystore.path=/usr/share/elasticsearch/config/elastic-certificates.p12 \</span><br><span class="line">    -e xpack.security.transport.ssl.truststore.path=/usr/share/elasticsearch/config/elastic-certificates.p12 \</span><br><span class="line">    -v es-data1:/usr/share/elasticsearch/data:rw \</span><br><span class="line">    -v es-logs1:/usr/share/elasticsearch/logs:rw \</span><br><span class="line">    --mount <span class="built_in">type</span>=<span class="built_in">bind</span>,<span class="built_in">source</span>=$(<span class="built_in">pwd</span>)/certs/elastic-certificates.p12,target=/usr/share/elasticsearch/config/elastic-certificates.p12 \</span><br><span class="line">    --network elasticsearch-br0 \</span><br><span class="line">    --ip 172.16.0.11 \</span><br><span class="line">    -p 9201:9200 -p 9301:9300 \</span><br><span class="line">    elasticsearch:7.17.14</span><br></pre></td></tr></table></figure><h3 id="elasticsearch2"><a href="#elasticsearch2" class="headerlink" title="elasticsearch2"></a>elasticsearch2</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name elasticsearch2 \</span><br><span class="line">    --<span class="built_in">ulimit</span> memlock=-1:-1 \</span><br><span class="line">    -e <span class="string">&quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot;</span> \</span><br><span class="line">    -e node.name=elasticsearch2 \</span><br><span class="line">    -e cluster.name=es-cluster \</span><br><span class="line">    -e discovery.seed_hosts=elasticsearch1,elasticsearch3 \</span><br><span class="line">    -e cluster.initial_master_nodes=elasticsearch1,elasticsearch2,elasticsearch3 \</span><br><span class="line">    -e bootstrap.memory_lock=<span class="literal">true</span> \</span><br><span class="line">    -e xpack.security.enabled=<span class="literal">true</span> \</span><br><span class="line">    -e http.cors.enabled=<span class="literal">true</span> \</span><br><span class="line">    -e http.cors.allow-origin=<span class="string">&quot;*&quot;</span> \</span><br><span class="line">    -e http.cors.allow-headers=Authorization \</span><br><span class="line">    -e xpack.security.enabled=<span class="literal">true</span> \</span><br><span class="line">    -e xpack.security.transport.ssl.enabled=<span class="literal">true</span> \</span><br><span class="line">    -e xpack.security.transport.ssl.verification_mode=certificate \</span><br><span class="line">    -e xpack.security.transport.ssl.keystore.path=/usr/share/elasticsearch/config/elastic-certificates.p12 \</span><br><span class="line">    -e xpack.security.transport.ssl.truststore.path=/usr/share/elasticsearch/config/elastic-certificates.p12 \</span><br><span class="line">    -v es-data2:/usr/share/elasticsearch/data:rw \</span><br><span class="line">    -v es-logs2:/usr/share/elasticsearch/logs:rw \</span><br><span class="line">    --mount <span class="built_in">type</span>=<span class="built_in">bind</span>,<span class="built_in">source</span>=$(<span class="built_in">pwd</span>)/certs/elastic-certificates.p12,target=/usr/share/elasticsearch/config/elastic-certificates.p12 \</span><br><span class="line">    --network elasticsearch-br0 \</span><br><span class="line">    --ip 172.16.0.12 \</span><br><span class="line">    -p 9202:9200 -p 9302:9300 \</span><br><span class="line">    elasticsearch:7.17.14</span><br></pre></td></tr></table></figure><h3 id="elasticsearch3"><a href="#elasticsearch3" class="headerlink" title="elasticsearch3"></a>elasticsearch3</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name elasticsearch3 \</span><br><span class="line">    --<span class="built_in">ulimit</span> memlock=-1:-1 \</span><br><span class="line">    -e <span class="string">&quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot;</span> \</span><br><span class="line">    -e node.name=elasticsearch3 \</span><br><span class="line">    -e cluster.name=es-cluster \</span><br><span class="line">    -e discovery.seed_hosts=elasticsearch1,elasticsearch2 \</span><br><span class="line">    -e cluster.initial_master_nodes=elasticsearch1,elasticsearch2,elasticsearch3 \</span><br><span class="line">    -e bootstrap.memory_lock=<span class="literal">true</span> \</span><br><span class="line">    -e xpack.security.enabled=<span class="literal">true</span> \</span><br><span class="line">    -e http.cors.enabled=<span class="literal">true</span> \</span><br><span class="line">    -e http.cors.allow-origin=<span class="string">&quot;*&quot;</span> \</span><br><span class="line">    -e http.cors.allow-headers=Authorization \</span><br><span class="line">    -e xpack.security.enabled=<span class="literal">true</span> \</span><br><span class="line">    -e xpack.security.transport.ssl.enabled=<span class="literal">true</span> \</span><br><span class="line">    -e xpack.security.transport.ssl.verification_mode=certificate \</span><br><span class="line">    -e xpack.security.transport.ssl.keystore.path=/usr/share/elasticsearch/config/elastic-certificates.p12 \</span><br><span class="line">    -e xpack.security.transport.ssl.truststore.path=/usr/share/elasticsearch/config/elastic-certificates.p12 \</span><br><span class="line">    -v es-data3:/usr/share/elasticsearch/data:rw \</span><br><span class="line">    -v es-logs3:/usr/share/elasticsearch/logs:rw \</span><br><span class="line">    --mount <span class="built_in">type</span>=<span class="built_in">bind</span>,<span class="built_in">source</span>=$(<span class="built_in">pwd</span>)/certs/elastic-certificates.p12,target=/usr/share/elasticsearch/config/elastic-certificates.p12 \</span><br><span class="line">    --network elasticsearch-br0 \</span><br><span class="line">    --ip 172.16.0.13 \</span><br><span class="line">    -p 9203:9200 -p 9303:9300 \</span><br><span class="line">    elasticsearch:7.17.14</span><br></pre></td></tr></table></figure><h2 id="åˆå§‹åŒ–å¯†ç "><a href="#åˆå§‹åŒ–å¯†ç " class="headerlink" title="åˆå§‹åŒ–å¯†ç "></a>åˆå§‹åŒ–å¯†ç </h2><p>éœ€è¦ç­‰å¾…æœåŠ¡å¯åŠ¨åæ‰å¯è®¾ç½®åˆå§‹åŒ–å¯†ç ï¼Œå‘½ä»¤åªèƒ½ç”Ÿæˆä¸€æ¬¡ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è‡ªåŠ¨ç”Ÿæˆå¯†ç </span></span><br><span class="line">docker <span class="built_in">exec</span> elasticsearch1 bash -c <span class="string">&quot;echo y | /usr/share/elasticsearch/bin/elasticsearch-setup-passwords auto&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆå§‹åŒ–ç”ŸæˆæŒ‡å®šçš„å¯†ç </span></span><br><span class="line">ELASTIC_PASSWORD=<span class="string">&quot;123456&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;y</span></span><br><span class="line"><span class="string"><span class="variable">$&#123;ELASTIC_PASSWORD&#125;</span></span></span><br><span class="line"><span class="string"><span class="variable">$&#123;ELASTIC_PASSWORD&#125;</span></span></span><br><span class="line"><span class="string"><span class="variable">$&#123;ELASTIC_PASSWORD&#125;</span></span></span><br><span class="line"><span class="string"><span class="variable">$&#123;ELASTIC_PASSWORD&#125;</span></span></span><br><span class="line"><span class="string"><span class="variable">$&#123;ELASTIC_PASSWORD&#125;</span></span></span><br><span class="line"><span class="string"><span class="variable">$&#123;ELASTIC_PASSWORD&#125;</span></span></span><br><span class="line"><span class="string"><span class="variable">$&#123;ELASTIC_PASSWORD&#125;</span></span></span><br><span class="line"><span class="string"><span class="variable">$&#123;ELASTIC_PASSWORD&#125;</span></span></span><br><span class="line"><span class="string"><span class="variable">$&#123;ELASTIC_PASSWORD&#125;</span></span></span><br><span class="line"><span class="string"><span class="variable">$&#123;ELASTIC_PASSWORD&#125;</span></span></span><br><span class="line"><span class="string"><span class="variable">$&#123;ELASTIC_PASSWORD&#125;</span></span></span><br><span class="line"><span class="string"><span class="variable">$&#123;ELASTIC_PASSWORD&#125;</span>&quot;</span> | docker <span class="built_in">exec</span> -i elasticsearch /usr/share/elasticsearch/bin/elasticsearch-setup-passwords interactive</span><br></pre></td></tr></table></figure><h2 id="éƒ¨ç½²-kibana"><a href="#éƒ¨ç½²-kibana" class="headerlink" title="éƒ¨ç½² kibana"></a>éƒ¨ç½² kibana</h2><h3 id="å‡†å¤‡-kibana-yml"><a href="#å‡†å¤‡-kibana-yml" class="headerlink" title="å‡†å¤‡ kibana.yml"></a>å‡†å¤‡ kibana.yml</h3><p>å¯†ç æŒ‰ç…§å®é™…æƒ…å†µä¿®æ”¹</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server.name:</span> <span class="string">kibana</span></span><br><span class="line"><span class="attr">server.port:</span> <span class="number">5601</span></span><br><span class="line"><span class="attr">server.host:</span> <span class="string">&quot;0.0.0.0&quot;</span></span><br><span class="line"><span class="attr">elasticsearch.username:</span> <span class="string">&quot;elastic&quot;</span></span><br><span class="line"><span class="attr">elasticsearch.password:</span> <span class="string">&quot;123456&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">elasticsearch.hosts:</span> [<span class="string">&quot;http://elasticsearch1:9200&quot;</span>, <span class="string">&quot;http://elasticsearch2:9200&quot;</span>, <span class="string">&quot;http://elasticsearch3:9200&quot;</span>]</span><br><span class="line"><span class="attr">i18n.locale:</span> <span class="string">&quot;zh-CN&quot;</span></span><br></pre></td></tr></table></figure><h3 id="å‡†å¤‡-kibana-sh"><a href="#å‡†å¤‡-kibana-sh" class="headerlink" title="å‡†å¤‡ kibana.sh"></a>å‡†å¤‡ kibana.sh</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name kibana \</span><br><span class="line">    --net elasticsearch-br0 \</span><br><span class="line">    -p 5601:5601 \</span><br><span class="line">    -v <span class="string">&quot;<span class="subst">$(pwd)</span>&quot;</span>/kibana.yml:/usr/share/kibana/config/kibana.yml \</span><br><span class="line">    kibana:7.17.14</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æ—¥å¿— </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
            <tag> éƒ¨ç½² </tag>
            
            <tag> æ­å»º </tag>
            
            <tag> Elasticsearch </tag>
            
            <tag> ES </tag>
            
            <tag> å¼€æºè½¯ä»¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨ Docker æ­å»ºå•èŠ‚ç‚¹ Elasticsearch å­¦ä¹ ç¯å¢ƒ</title>
      <link href="/posts/st219s/"/>
      <url>/posts/st219s/</url>
      
        <content type="html"><![CDATA[<p>ä¸€èˆ¬æ¥è¯´ï¼Œå­¦ä¹  ES éƒ½æ˜¯è‡ªå·±å…ˆæ­å»ºå‡ å°è™šæ‹Ÿæœºï¼Œç„¶ååœ¨è™šæ‹Ÿæœºé‡Œéƒ¨ç½² ES é›†ç¾¤ï¼Œè¿™æ ·åšèµ„æºæ¶ˆè€—æ¯”è¾ƒå¤§ï¼Œä¸€èˆ¬çš„ç”µè„‘éƒ½æ²¡æœ‰è¿™ä¹ˆé«˜çš„é…ç½®ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Docker æ¥å¿«é€Ÿéƒ¨ç½² Elasticsearchï¼Œè¿™é‡Œæ­å»ºå•èŠ‚ç‚¹ï¼š</p><h2 id="å¯åŠ¨-Elasticsearch"><a href="#å¯åŠ¨-Elasticsearch" class="headerlink" title="å¯åŠ¨ Elasticsearch"></a>å¯åŠ¨ Elasticsearch</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">docker network create elasticsearch</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿è¯ç›®å½•æƒé™æ­£ç¡®</span></span><br><span class="line"><span class="built_in">mkdir</span> es-data es-logs</span><br><span class="line">sudo <span class="built_in">chown</span> -R 1000 es-data es-logs</span><br><span class="line"></span><br><span class="line">docker run -d --name elasticsearch \</span><br><span class="line">    -e <span class="string">&quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot;</span> \</span><br><span class="line">    -e <span class="string">&quot;discovery.type=single-node&quot;</span> \</span><br><span class="line">    -v <span class="string">&quot;<span class="subst">$(pwd)</span>&quot;</span>/elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml:ro \</span><br><span class="line">    -v <span class="string">&quot;<span class="subst">$(pwd)</span>&quot;</span>/es-data:/usr/share/elasticsearch/data:rw \</span><br><span class="line">    -v <span class="string">&quot;<span class="subst">$(pwd)</span>&quot;</span>/es-logs:/usr/share/elasticsearch/logs:rw \</span><br><span class="line">    --privileged --network elasticsearch \</span><br><span class="line">    -p 9200:9200 -p 9300:9300 \</span><br><span class="line">    elasticsearch:7.17.14</span><br></pre></td></tr></table></figure><h2 id="åˆå§‹åŒ–å¯†ç "><a href="#åˆå§‹åŒ–å¯†ç " class="headerlink" title="åˆå§‹åŒ–å¯†ç "></a>åˆå§‹åŒ–å¯†ç </h2><p>éœ€è¦ç­‰å¾…æœåŠ¡å¯åŠ¨åæ‰å¯è®¾ç½®åˆå§‹åŒ–å¯†ç ï¼Œå‘½ä»¤åªèƒ½ç”Ÿæˆä¸€æ¬¡ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è‡ªåŠ¨ç”Ÿæˆå¯†ç </span></span><br><span class="line">docker <span class="built_in">exec</span> elasticsearch1 bash -c <span class="string">&quot;echo y | /usr/share/elasticsearch/bin/elasticsearch-setup-passwords auto&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆå§‹åŒ–ç”ŸæˆæŒ‡å®šçš„å¯†ç </span></span><br><span class="line">ELASTIC_PASSWORD=<span class="string">&quot;123456&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;y</span></span><br><span class="line"><span class="string"><span class="variable">$&#123;ELASTIC_PASSWORD&#125;</span></span></span><br><span class="line"><span class="string"><span class="variable">$&#123;ELASTIC_PASSWORD&#125;</span></span></span><br><span class="line"><span class="string"><span class="variable">$&#123;ELASTIC_PASSWORD&#125;</span></span></span><br><span class="line"><span class="string"><span class="variable">$&#123;ELASTIC_PASSWORD&#125;</span></span></span><br><span class="line"><span class="string"><span class="variable">$&#123;ELASTIC_PASSWORD&#125;</span></span></span><br><span class="line"><span class="string"><span class="variable">$&#123;ELASTIC_PASSWORD&#125;</span></span></span><br><span class="line"><span class="string"><span class="variable">$&#123;ELASTIC_PASSWORD&#125;</span></span></span><br><span class="line"><span class="string"><span class="variable">$&#123;ELASTIC_PASSWORD&#125;</span></span></span><br><span class="line"><span class="string"><span class="variable">$&#123;ELASTIC_PASSWORD&#125;</span></span></span><br><span class="line"><span class="string"><span class="variable">$&#123;ELASTIC_PASSWORD&#125;</span></span></span><br><span class="line"><span class="string"><span class="variable">$&#123;ELASTIC_PASSWORD&#125;</span></span></span><br><span class="line"><span class="string"><span class="variable">$&#123;ELASTIC_PASSWORD&#125;</span>&quot;</span> | docker <span class="built_in">exec</span> -i elasticsearch /usr/share/elasticsearch/bin/elasticsearch-setup-passwords interactive</span><br></pre></td></tr></table></figure><h2 id="éƒ¨ç½²-kibana"><a href="#éƒ¨ç½²-kibana" class="headerlink" title="éƒ¨ç½² kibana"></a>éƒ¨ç½² kibana</h2><h3 id="å‡†å¤‡-kibana-yml"><a href="#å‡†å¤‡-kibana-yml" class="headerlink" title="å‡†å¤‡ kibana.yml"></a>å‡†å¤‡ kibana.yml</h3><p>å¯†ç æŒ‰ç…§å®é™…æƒ…å†µä¿®æ”¹</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server.name:</span> <span class="string">kibana</span></span><br><span class="line"><span class="attr">server.port:</span> <span class="number">5601</span></span><br><span class="line"><span class="attr">server.host:</span> <span class="string">&quot;0.0.0.0&quot;</span></span><br><span class="line"><span class="attr">elasticsearch.username:</span> <span class="string">&quot;elastic&quot;</span></span><br><span class="line"><span class="attr">elasticsearch.password:</span> <span class="string">&quot;123456&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">elasticsearch.hosts:</span> [<span class="string">&quot;http://elasticsearch:9200&quot;</span>]</span><br><span class="line"><span class="attr">i18n.locale:</span> <span class="string">&quot;zh-CN&quot;</span></span><br></pre></td></tr></table></figure><h3 id="å‡†å¤‡-kibana-sh"><a href="#å‡†å¤‡-kibana-sh" class="headerlink" title="å‡†å¤‡ kibana.sh"></a>å‡†å¤‡ kibana.sh</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name kibana \</span><br><span class="line">    --net elasticsearch \</span><br><span class="line">    -p 5601:5601 \</span><br><span class="line">    -v <span class="string">&quot;<span class="subst">$(pwd)</span>&quot;</span>/kibana.yml:/usr/share/kibana/config/kibana.yml \</span><br><span class="line">    kibana:7.17.14</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æ—¥å¿— </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
            <tag> éƒ¨ç½² </tag>
            
            <tag> æ­å»º </tag>
            
            <tag> Elasticsearch </tag>
            
            <tag> ES </tag>
            
            <tag> å¼€æºè½¯ä»¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>centosåˆ é™¤swapåæ— æ³•å¯åŠ¨</title>
      <link href="/posts/scfoaz/"/>
      <url>/posts/scfoaz/</url>
      
        <content type="html"><![CDATA[<p>åˆ é™¤äº† CentOS çš„ swap åˆ†åŒºåï¼Œé‡å¯ç³»ç»ŸæŠ¥é”™ï¼Œæç¤º <code>Warning: /dev/centos/swap does not exist</code>ï¼Œå¦‚å›¾ï¼š</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202404241243993.png" alt="image.png"></p><p>å…ˆæŒ‚è½½ &#x2F;boot åˆ†åŒº, ä¸ç¡®å®šå°±ä¸€ä¸ªä¸€ä¸ªæŒ‚è½½çœ‹çœ‹é‡Œé¢çš„æ–‡ä»¶å¯¹ä¸å¯¹ï¼Œæ­£å¸¸æƒ…å†µä¸‹ &#x2F;boot åˆ†åŒºå¤§å°åœ¨ 1GB ä»¥å†…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /tmp/boot</span><br><span class="line">mount /dev/sda1 /tmp/boot</span><br><span class="line"><span class="built_in">cd</span> /tmp/boot</span><br></pre></td></tr></table></figure><p><code>vi grub2/grub.cfg</code><br>åˆ é™¤ <code>rd.lvm.lv=centos/swap</code> è¿™ä¸ªé…ç½®, ç„¶åï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">umount /tmp/boot</span><br></pre></td></tr></table></figure><p>è¿™æ ·ç³»ç»Ÿå°±å¯ä»¥æ­£å¸¸å¯åŠ¨äº†ï¼Œä½†æ˜¯è¿˜æ²¡å®Œ</p><p>&#x2F;boot é‡Œçš„æ–‡ä»¶éƒ½æ˜¯è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œæ¯æ¬¡æ›´æ–°å†…æ ¸æˆ–è€…æ‰‹åŠ¨æ‰§è¡Œ <code>grub2-mkconfig</code>ï¼Œ ä¼šè¢«è¦†ç›–æ‰ï¼Œæ‰€ä»¥è¿˜éœ€è¦ä¿®æ”¹åŸå§‹çš„ grub é…ç½®æ–‡ä»¶ï¼Œ</p><p>vim &#x2F;etc&#x2F;default&#x2F;grub</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">GRUB_TIMEOUT=5</span><br><span class="line">GRUB_DISTRIBUTOR=<span class="string">&quot;<span class="subst">$(sed &#x27;s, release .*$,,g&#x27; /etc/system-release)</span>&quot;</span></span><br><span class="line">GRUB_DEFAULT=saved</span><br><span class="line">GRUB_DISABLE_SUBMENU=<span class="literal">true</span></span><br><span class="line">GRUB_TERMINAL_OUTPUT=<span class="string">&quot;console&quot;</span></span><br><span class="line">GRUB_CMDLINE_LINUX=<span class="string">&quot;rd.lvm.lv=centos/root biosdevname=0 net.ifnames=0 rhgb quiet&quot;</span></span><br><span class="line">GRUB_DISABLE_RECOVERY=<span class="string">&quot;true&quot;</span></span><br></pre></td></tr></table></figure><p>æŠŠè¿™é‡Œå’Œ swap ç›¸å…³çš„ <code>rd.lvm.lv=centos/swap</code> é…ç½®åˆ é™¤, ç„¶åé‡æ–°ç”Ÿæˆä¸€ä¸‹é…ç½®æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grub2-mkconfig -o /boot/grub2/grub.cfg</span><br></pre></td></tr></table></figure><p>å…³ç³»æ˜¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/default/grub  +  /etc/grub.d/*  --&gt;  /etc/grub.cfg  --&gt;  /boot/grub2/grub.cfg</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ä¿®æ”¹ grub é…ç½®ï¼Œåªéœ€è¦ä¿®æ”¹ <code>/etc/default/grub</code> å³å¯ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åˆ†åŒº </tag>
            
            <tag> ç£ç›˜ </tag>
            
            <tag> CentOS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>dockerå®˜æ–¹ç§æœ‰ä»“åº“registryéƒ¨ç½²ä¸ä½¿ç”¨</title>
      <link href="/posts/sc3b39/"/>
      <url>/posts/sc3b39/</url>
      
        <content type="html"><![CDATA[<p>ä¸€èˆ¬æ¥è¯´å¤§å®¶ç”¨å®¹å™¨é•œåƒéƒ½é€‰æ‹© harborï¼Œæœ‰ä¸ªç®¡ç†ç•Œé¢ï¼Œè¿˜æ”¯æŒæƒé™æ§åˆ¶ã€æ¼æ´æ‰«æç­‰ï¼Œä½†æ˜¯æˆ‘å…¬å¸æœ‰ä¸ªå®¢æˆ·çš„ç¯å¢ƒåªå…è®¸é€šè¿‡è·³æ¿æœºç™»å½• Linux æœºå™¨ï¼Œæ²¡æ³•ä½¿ç”¨æµè§ˆå™¨ï¼Œå¦å¤–ä¹Ÿåªæ˜¯éœ€è¦ä¸€ä¸ªç®€å•ä¸€ç‚¹çš„ã€å¥½ç»´æŠ¤çš„ä»“åº“ï¼Œæ‰¾äº†ä¸€ä¸‹ï¼Œè¿™ä¸ªæ¯”è¾ƒç®€å•ã€‚å¦‚æœéœ€è¦æ›´ä¸“ä¸šçš„ç§æœ‰é•œåƒä»“åº“ï¼Œå¯ä»¥é€‰æ‹© harborï¼ˆå…è´¹ï¼‰æˆ–è€… jFrog å®¶çš„ï¼ˆæ”¶è´¹ï¼‰</p><h2 id="è‡ªç­¾åè¯ä¹¦"><a href="#è‡ªç­¾åè¯ä¹¦" class="headerlink" title="è‡ªç­¾åè¯ä¹¦"></a>è‡ªç­¾åè¯ä¹¦</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p certs</span><br><span class="line"></span><br><span class="line">openssl req \</span><br><span class="line">  -newkey rsa:4096 -nodes -sha256 -keyout certs/i.com.key \</span><br><span class="line">  -addext <span class="string">&quot;subjectAltName = DNS:hub.i.com&quot;</span> \</span><br><span class="line">  -x509 -days 3650 -out certs/i.com.crt</span><br></pre></td></tr></table></figure><h2 id="docker-ä¿¡ä»»è¯ä¹¦"><a href="#docker-ä¿¡ä»»è¯ä¹¦" class="headerlink" title="docker ä¿¡ä»»è¯ä¹¦"></a>docker ä¿¡ä»»è¯ä¹¦</h2><p>å°†æ–‡ä»¶å¤åˆ¶åˆ°æ¯ä¸ª Docker ä¸Š ä¸»æœºã€‚æ‚¨æ— éœ€é‡æ–°å¯åŠ¨ Dockerã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /etc/docker/certs.d/hub.i.com/</span><br><span class="line"><span class="built_in">cp</span> i.com.crt /etc/docker/certs.d/hub.i.com/</span><br></pre></td></tr></table></figure><div class="note warning flat"><p>å¦‚æœæ›´æ¢äº†é»˜è®¤ç«¯å£ï¼Œè¿™é‡Œçš„æ–‡ä»¶å¤¹ä¹Ÿè¦åŠ ä¸Šç«¯å£ï¼Œæ¯”å¦‚ <code>/etc/docker/certs.d/hub.i.com:8000/</code></p></div><h2 id="éƒ¨ç½²æœåŠ¡"><a href="#éƒ¨ç½²æœåŠ¡" class="headerlink" title="éƒ¨ç½²æœåŠ¡"></a>éƒ¨ç½²æœåŠ¡</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">docker run -d \</span><br><span class="line">  --restart=always \</span><br><span class="line">  --name registry \</span><br><span class="line">  -v ./data:/var/lib/registry \</span><br><span class="line">  -v ./certs:/certs \</span><br><span class="line">  -e REGISTRY_HTTP_ADDR=0.0.0.0:443 \</span><br><span class="line">  -e REGISTRY_HTTP_TLS_CERTIFICATE=/certs/i.com.crt \</span><br><span class="line">  -e REGISTRY_HTTP_TLS_KEY=/certs/i.com.key \</span><br><span class="line">  -p 443:443 \</span><br><span class="line">  registry:2</span><br></pre></td></tr></table></figure><h2 id="å¸¸ç”¨çš„-API"><a href="#å¸¸ç”¨çš„-API" class="headerlink" title="å¸¸ç”¨çš„ API"></a>å¸¸ç”¨çš„ API</h2><p>å‡è®¾é•œåƒåä¸ºï¼š<code>hub.i.com/iuxt/test:latest</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹é•œåƒåˆ—è¡¨</span></span><br><span class="line">curl https://hub.i.com/v2/_catalog</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹é•œåƒçš„tagåˆ—è¡¨ï¼Œå‡è®¾é•œåƒåæ˜¯test</span></span><br><span class="line">curl https://hub.i.com/v2/iuxt/test/tags/list</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æŸä¸ªtagçš„è¯¦ç»†ä¿¡æ¯</span></span><br><span class="line">curl https://hub.i.com/v2/iuxt/test/manifests/latest</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–é•œåƒæ‘˜è¦</span></span><br><span class="line">curl -s -H <span class="string">&quot;Accept: application/vnd.docker.distribution.manifest.v2+json&quot;</span> \</span><br><span class="line">https://hub.i.com/v2/iuxt/test/manifests/latest \</span><br><span class="line">| jq -r <span class="string">&#x27;.config.digest&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤é•œåƒï¼Œä¸ä¼šé‡Šæ”¾ç£ç›˜ç©ºé—´ï¼Œé‡Šæ”¾ç£ç›˜ç©ºé—´è¿˜éœ€è¦è¿›è¡Œåƒåœ¾å›æ”¶æ“ä½œã€‚</span></span><br><span class="line">curl -X DELETE \</span><br><span class="line">https://hub.i.com/v2/iuxt/test/manifests/sha256:xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</span><br></pre></td></tr></table></figure><h2 id="åƒåœ¾å›æ”¶"><a href="#åƒåœ¾å›æ”¶" class="headerlink" title="åƒåœ¾å›æ”¶"></a>åƒåœ¾å›æ”¶</h2><p>åœ¨ Docker Registry é…ç½®æ–‡ä»¶ config.yml ä¸­ï¼Œå¯ç”¨åˆ é™¤åŠŸèƒ½ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">storage:</span></span><br><span class="line">  <span class="attr">delete:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><p>æ‰§è¡Œåƒåœ¾å›æ”¶æ“ä½œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> &lt;registry-container&gt; bin/registry garbage-collect /etc/docker/registry/config.yml</span><br></pre></td></tr></table></figure><h2 id="é™„ï¼š"><a href="#é™„ï¼š" class="headerlink" title="é™„ï¼š"></a>é™„ï¼š</h2><p>è‡ªç­¾è¯ä¹¦ä»¥åŠé…ç½® OS ä¿¡ä»» CA è¯ä¹¦ï¼š<a href="/posts/097e5b7c">åˆ¶ä½œå’Œä½¿ç”¨è‡ªç­¾åè¯ä¹¦</a><br>å¿«é€Ÿç­¾å‘è¯ä¹¦å°å·¥å…·ï¼š<a href="https://github.com/iuxt/my_cert">https://github.com/iuxt/my_cert</a></p>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
            <tag> éƒ¨ç½² </tag>
            
            <tag> ä»“åº“ </tag>
            
            <tag> é•œåƒ </tag>
            
            <tag> æ­å»º </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>KubernetesåŒä¸€ä¸ªnamespaceå…±ç”¨é•œåƒsecret</title>
      <link href="/posts/sc2yhw/"/>
      <url>/posts/sc2yhw/</url>
      
        <content type="html"><![CDATA[<p>é…ç½®ä¸€ä¸ªå…¨å±€çš„é•œåƒæ‹‰å–å¯†é’¥ï¼Œ åç»­æ‹‰é•œåƒå°±ä¸ç”¨æ¯ä¸ª deployment å•ç‹¬é…ç½®äº†ã€‚</p><p>åœ¨æ¯ä¸ª <code>namespace</code> ä¸‹éƒ½æœ‰ä¸€ä¸ªé»˜è®¤çš„ <code>service account</code>, å‡è®¾å‘½åç©ºé—´æ˜¯ <code>test</code></p><p>ä½¿ç”¨ <code>kubectl get sa -n test</code> æŸ¥çœ‹<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202404171737797.png" alt="image.png"></p><p>æŸ¥çœ‹ serviceaccount ä¿¡æ¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl describe sa -n <span class="built_in">test</span></span><br></pre></td></tr></table></figure><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202404171738437.png" alt="image.png"></p><p>Image pull secrets æ˜¯æ­¤ namespace ä¸‹æ‹‰å–é•œåƒçš„ç§˜é’¥</p><p>1.åˆ›å»º secret</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create secret -p docker-registry registrykey --namespace=<span class="built_in">test</span> --docker-username=&lt;harbor_user&gt; --docker-password=&lt;harbor_password&gt; --docker-server=&lt;harbor_url&gt;</span><br></pre></td></tr></table></figure><p>2.é…ç½®è¿› service account</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl patch serviceaccount default -p <span class="string">&#x27;&#123;&quot;imagePullSecrets&quot;: [&#123;&quot;name&quot;: &quot;registrykey&quot;&#125;]&#125;&#x27;</span> -n <span class="built_in">test</span></span><br></pre></td></tr></table></figure><p>è‡³æ­¤åœ¨ <code>test</code> ä¸‹æ‹‰å–é•œåƒæ— éœ€é…ç½®é•œåƒæ‹‰å–ç§˜é’¥äº†</p>]]></content>
      
      
      <categories>
          
          <category> å®¹å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Kubernetes </tag>
            
            <tag> k8s </tag>
            
            <tag> secret </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è§£å†³MySQL 5.7åœ¨Redhat 9ä¸­å¯åŠ¨æŠ¥é”™ï¼šlibncurses.so.5å’Œlibtinfo.so.5ç¼ºå¤±é—®é¢˜</title>
      <link href="/posts/lv23gkql/"/>
      <url>/posts/lv23gkql/</url>
      
        <content type="html"><![CDATA[<p>é‡‡ç”¨äºŒè¿›åˆ¶å®‰è£… MySQL æœåŠ¡çš„æ—¶å€™ï¼Œ ä¹‹å‰åœ¨ CentOS 7 ç³»ç»Ÿä¸­ï¼Œç›´æ¥ yum å®‰è£…ä¾èµ–åŒ…å°±å¯ä»¥æ­£å¸¸è¿è¡Œï¼Œä½†æ˜¯åˆ°äº† RHEL 9 ç³»ç»Ÿä¸‹ï¼Œ ä¼šæŠ¥é”™æ‰¾ä¸åˆ° libncurses.so.5ï¼Œ æ ¹æ®ç»éªŒéœ€è¦æŸ¥æ‰¾ä¸€ä¸‹è¿™ä¸ªåº“å±äºå“ªä¸ªåŒ…ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum provides libncurses.so.5</span><br></pre></td></tr></table></figure><p>æ‰¾ä¸åˆ°è¿™ä¸ªåŒ…</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202404152343237.png" alt="image.png"></p><p>ä¸è€ƒè™‘ç‰ˆæœ¬ï¼Œå†æ¬¡æœç´¢</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum provides libncurses.so.*</span><br></pre></td></tr></table></figure><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202404152344067.png" alt="image.png"></p><p>å‘ç°å¯ä»¥æ‰¾åˆ° 6.2 çš„ç‰ˆæœ¬, å®‰è£…è¿™ä¸ªåŒ…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install ncurses-libs</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹è¿™ä¸ª rpm åŒ…åŒ…å«çš„æ–‡ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -ql ncurses-libs | grep libncurses.so</span><br></pre></td></tr></table></figure><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202404152347847.png" alt="image.png"></p><p>æ­¤æ—¶éœ€è¦åšä¸€ä¸ªè½¯é“¾æ¥ï¼ˆå‰ææ˜¯æ­¤ç‰ˆæœ¬å¯ä»¥å‘åå…¼å®¹ï¼Œè‡³å°‘åœ¨ MySQL 5.7 è¿™é‡Œè¿è¡Œæ˜¯æ²¡é—®é¢˜çš„ã€‚ï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ln</span> -s /usr/lib64/libncurses.so.6 /usr/lib64/libncurses.so.5</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹å®Œæˆï¼ŒæŠ¥å¦ä¸€ä¸ªé”™è¯¯äº†ï¼š</p><p>åŒæ ·çš„æ–¹æ³•ï¼Œ å†åˆ›å»ºä¸€ä¸ªè½¯é“¾æ¥ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ln</span> -s /usr/lib64/libtinfo.so.6 /usr/lib64/libtinfo.so.5</span><br></pre></td></tr></table></figure><p>ç„¶å MySQL å°±å¯ä»¥æ­£å¸¸è¿è¡Œäº†ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysqld </tag>
            
            <tag> CentOS </tag>
            
            <tag> MySQL </tag>
            
            <tag> è¿è¡Œåº“ </tag>
            
            <tag> RHEL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQLåŸºäºGTIDçš„ä¸»ä»å¤åˆ¶</title>
      <link href="/posts/luwwdbjr/"/>
      <url>/posts/luwwdbjr/</url>
      
        <content type="html"><![CDATA[<p>æ²¡å¼€å¯ GTID çš„ MySQL æ•°æ®åº“å¢åŠ ä»åº“è¯·çœ‹ï¼š<a href="/posts/86a9c8f5/">ä¼˜é›…åœ°ç»™æ­£åœ¨è¿è¡Œçš„MySQLæ·»åŠ ä»åº“</a></p><h2 id="è‡ªåŠ¨åŒæ­¥è¿æ¥ä¸»åº“-æ–¹æ³•ä¸€"><a href="#è‡ªåŠ¨åŒæ­¥è¿æ¥ä¸»åº“-æ–¹æ³•ä¸€" class="headerlink" title="è‡ªåŠ¨åŒæ­¥è¿æ¥ä¸»åº“ (æ–¹æ³•ä¸€)"></a>è‡ªåŠ¨åŒæ­¥è¿æ¥ä¸»åº“ (æ–¹æ³•ä¸€)</h2><p>é€‚ç”¨äº master ä¹Ÿæ˜¯æ–°å»ºä¸ä¹…çš„æƒ…å†µï¼Œå¦‚æœä½ çš„ master æ‰€æœ‰çš„ binlog è¿˜åœ¨ï¼Œå¯ä»¥å®‰è£… slaveï¼Œslave ç›´æ¥ change master to åˆ° master ç«¯ã€‚åŸç†æ˜¯ç›´æ¥è·å– master æ‰€æœ‰çš„ GTID å¹¶æ‰§è¡Œã€‚</p><p>ä¼˜ç‚¹ï¼šç®€å•æ–¹ä¾¿ã€‚ä¸éœ€è¦å¤‡ä»½ä¸»åº“å†åœ¨ä»åº“è¿˜åŸã€‚<br>ç¼ºç‚¹ï¼šå¦‚æœ binlog å¤ªå¤šï¼Œæ•°æ®å®Œå…¨åŒæ­¥éœ€è¦æ—¶é—´è¾ƒé•¿ã€‚å¦‚æœæ—§çš„ binlog å·²ç»è¢«æ¸…ç†äº†ï¼Œåˆ™ä¸èƒ½æ­£å¸¸åŒæ­¥ã€‚</p><p>åœ¨ä»åº“æ‰§è¡Œï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CHANGE MASTER <span class="keyword">TO</span></span><br><span class="line">MASTER_HOST<span class="operator">=</span><span class="string">&#x27;10.0.0.11&#x27;</span>,</span><br><span class="line">MASTER_USER<span class="operator">=</span><span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">MASTER_PASSWORD<span class="operator">=</span><span class="string">&#x27;Vb6CAEJqqtcmKndiAkEl&#x27;</span>,</span><br><span class="line">MASTER_PORT<span class="operator">=</span><span class="number">3306</span>,</span><br><span class="line">MASTER_CONNECT_RETRY<span class="operator">=</span><span class="number">10</span>,</span><br><span class="line">MASTER_AUTO_POSITION<span class="operator">=</span><span class="number">1</span>;</span><br></pre></td></tr></table></figure><p><code>master_auto_position=1</code> ä»åº“è‡ªåŠ¨æ‰¾åŒæ­¥ç‚¹</p><h2 id="å¤‡ä»½å¯¼å…¥è¿æ¥ä¸»åº“-æ–¹æ³•äºŒ"><a href="#å¤‡ä»½å¯¼å…¥è¿æ¥ä¸»åº“-æ–¹æ³•äºŒ" class="headerlink" title="å¤‡ä»½å¯¼å…¥è¿æ¥ä¸»åº“ (æ–¹æ³•äºŒ)"></a>å¤‡ä»½å¯¼å…¥è¿æ¥ä¸»åº“ (æ–¹æ³•äºŒ)</h2><p>é€‚ç”¨äºæ‹¥æœ‰è¾ƒå¤§æ•°æ®çš„æƒ…å†µã€‚ï¼ˆæ¨èï¼‰</p><p>é€šè¿‡ master æˆ–è€…å…¶ä»– slave çš„å¤‡ä»½æ­å»ºæ–°çš„ slaveã€‚<br>åŸç†ï¼šè·å– master çš„æ•°æ®å’Œè¿™äº›æ•°æ®å¯¹åº”çš„ GTID èŒƒå›´ï¼Œç„¶åé€šè¿‡ slave è®¾ç½® <code>master_auto_position=1</code>,è‡ªåŠ¨åŒæ­¥ï¼Œè·³è¿‡å¤‡ä»½åŒ…å«çš„ gtidã€‚<br>ç¼ºç‚¹ï¼šç›¸å¯¹æ¥è¯´æœ‰ç‚¹éº»çƒ¦ã€‚</p><h3 id="ä¸»åº“ä½¿ç”¨-mysqldump-å¯¼å‡º"><a href="#ä¸»åº“ä½¿ç”¨-mysqldump-å¯¼å‡º" class="headerlink" title="ä¸»åº“ä½¿ç”¨ mysqldump å¯¼å‡º"></a>ä¸»åº“ä½¿ç”¨ mysqldump å¯¼å‡º</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump  -uroot -pVb6CAEJqqtcmKndiAkEl -hlocalhost -P3306 --triggers --routines --events --hex-blob --single-transaction --skip-tz-utc --all-databases &gt; backup.sql</span><br></pre></td></tr></table></figure><p>SQL æ–‡ä»¶æœ€åæœ‰ä¸€æ¡ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> @<span class="variable">@GLOBAL</span>.GTID_PURGED<span class="operator">=</span><span class="string">&#x27;aab83329-fb19-11ee-85e8-4e5363c108f2:1-689&#x27;</span>;</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯è®°å½•äº†å½“å‰çš„ SQL å¯¹åº”çš„ GTID ä½ç½®ï¼Ÿ</p><h3 id="ä»åº“æ•°æ®å¯¼å…¥æ•°æ®"><a href="#ä»åº“æ•°æ®å¯¼å…¥æ•°æ®" class="headerlink" title="ä»åº“æ•°æ®å¯¼å…¥æ•°æ®"></a>ä»åº“æ•°æ®å¯¼å…¥æ•°æ®</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -pVb6CAEJqqtcmKndiAkEl -hlocalhost -P3306 &lt; backup.sql</span><br></pre></td></tr></table></figure><p>å¦‚æœå¯¼å…¥æŠ¥é”™ <code>@@GLOBAL.GTID_PURGED can only be set when @@GLOBAL.GTID_EXECUTED is empty</code> ï¼Œ éœ€è¦åœ¨ä»åº“æ‰§è¡Œï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æŸ¥çœ‹å½“å‰çš„GTID</span></span><br><span class="line"><span class="keyword">select</span> @<span class="variable">@global</span>.gtid_executed\G;</span><br><span class="line"></span><br><span class="line">stop slave;</span><br><span class="line">reset slave <span class="keyword">all</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ¸…ç©ºæœ¬åœ°çš„GTID</span></span><br><span class="line">reset master;</span><br></pre></td></tr></table></figure><h3 id="ä»åº“è¿æ¥ä¸»åº“"><a href="#ä»åº“è¿æ¥ä¸»åº“" class="headerlink" title="ä»åº“è¿æ¥ä¸»åº“"></a>ä»åº“è¿æ¥ä¸»åº“</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CHANGE MASTER <span class="keyword">TO</span></span><br><span class="line">MASTER_HOST<span class="operator">=</span><span class="string">&#x27;10.0.0.11&#x27;</span>,</span><br><span class="line">MASTER_USER<span class="operator">=</span><span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">MASTER_PASSWORD<span class="operator">=</span><span class="string">&#x27;Vb6CAEJqqtcmKndiAkEl&#x27;</span>,</span><br><span class="line">MASTER_PORT<span class="operator">=</span><span class="number">3306</span>,</span><br><span class="line">MASTER_CONNECT_RETRY<span class="operator">=</span><span class="number">10</span>,</span><br><span class="line">MASTER_AUTO_POSITION<span class="operator">=</span><span class="number">1</span>;</span><br></pre></td></tr></table></figure><p>ä»åº“å¯åŠ¨å¤åˆ¶çº¿ç¨‹</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">start</span> slave;</span><br></pre></td></tr></table></figure><h3 id="ä»åº“æŸ¥çœ‹å¤åˆ¶çŠ¶æ€"><a href="#ä»åº“æŸ¥çœ‹å¤åˆ¶çŠ¶æ€" class="headerlink" title="ä»åº“æŸ¥çœ‹å¤åˆ¶çŠ¶æ€"></a>ä»åº“æŸ¥çœ‹å¤åˆ¶çŠ¶æ€</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> slave status \G;</span><br></pre></td></tr></table></figure><h3 id="ä¸»åº“æŸ¥çœ‹çŠ¶æ€"><a href="#ä¸»åº“æŸ¥çœ‹çŠ¶æ€" class="headerlink" title="ä¸»åº“æŸ¥çœ‹çŠ¶æ€"></a>ä¸»åº“æŸ¥çœ‹çŠ¶æ€</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> master status;</span><br><span class="line"><span class="keyword">show</span> slave hosts;</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">global</span> variables <span class="keyword">like</span> <span class="string">&#x27;%gtid%&#x27;</span>;</span><br></pre></td></tr></table></figure><h3 id="å…¶ä»–å‘½ä»¤"><a href="#å…¶ä»–å‘½ä»¤" class="headerlink" title="å…¶ä»–å‘½ä»¤"></a>å…¶ä»–å‘½ä»¤</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> binlog events;</span><br><span class="line"><span class="keyword">show</span> binlog events <span class="keyword">in</span> <span class="string">&#x27;master-bin.000001&#x27;</span>;</span><br><span class="line"><span class="keyword">show</span> master logs;</span><br><span class="line"><span class="keyword">show</span> processlist</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">full</span> processlist;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysqld </tag>
            
            <tag> MySQL </tag>
            
            <tag> æ•°æ®è¿ç§» </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>WSLæ–°çš„ç½‘ç»œæ¨¡å¼-mirroredé•œåƒç½‘ç»œ</title>
      <link href="/posts/luam6g8o/"/>
      <url>/posts/luam6g8o/</url>
      
        <content type="html"><![CDATA[<p>åˆšå¼€å§‹æˆ‘ç”¨ <a href="/posts/6f952944">Hyper-V è‡ªå®šä¹‰å†…éƒ¨ç½‘ç»œç½‘æ®µå’ŒIPåœ°å€</a> é…ç½® Hyper-V å¹¶åˆ›å»ºäº†å‡ å°è™šæ‹Ÿæœºï¼Œ ä½†æ˜¯å’Œ WSL çš„ç½‘ç»œä¸é€šï¼Œ è§£å†³æ–¹æ¡ˆå¯ä»¥æ˜¯å°† Hyper-V è™šæ‹Ÿæœºåªæ¥ä½¿ç”¨ WSL çš„ç½‘ç»œé€‚é…å™¨ã€‚ä¸è¿‡ 2023 å¹´ 9 æœˆçš„ WSL æ›´æ–°æ·»åŠ äº†ä¸€äº›æ–°çš„å®éªŒæ€§åŠŸèƒ½ï¼Œå…¶ä¸­åŒ…æ‹¬ä¸€äº›å…³äºæ–°çš„ç½‘ç»œæ¨¡å¼â€œé•œåƒâ€ã€‚é•œåƒç½‘ç»œå¸¦æ¥äº†ä¸€äº›å®ç”¨çš„ç‰¹æ€§ï¼Œä¾‹å¦‚å°† WSL ä¸­çš„æœåŠ¡å¼€æ”¾åˆ°å±€åŸŸç½‘ï¼ˆä¹‹å‰æ˜¯ NAT ç½‘ç»œï¼Œåªæœ‰ä¸»æœºå¯ä»¥é€šè¿‡ localhost è®¿é—®ï¼‰ã€‚<br>æ›´æ–°æ—¥å¿—ä¸­æåˆ°ï¼Œé•œåƒç½‘ç»œå¸¦æ¥çš„æ–°ç‰¹æ€§å¦‚ä¸‹ï¼š</p><ul><li>IPv6 æ”¯æŒ</li><li>åœ¨ Linux ä¸­é€šè¿‡ <code>127.0.0.1</code> è®¿é—® Windows æœåŠ¡</li><li>é€šè¿‡å±€åŸŸç½‘ç›´æ¥è¿æ¥ WSL</li><li>å¯¹ VPN æ›´å¥½çš„å…¼å®¹æ€§</li><li>å¤šæ’­æ”¯æŒ</li></ul><h2 id="å®‰è£…ä½¿ç”¨"><a href="#å®‰è£…ä½¿ç”¨" class="headerlink" title="å®‰è£…ä½¿ç”¨"></a>å®‰è£…ä½¿ç”¨</h2><p>é¦–å…ˆï¼Œè¿™é¡¹ç‰¹æ€§éœ€è¦ <code>22621.2359</code> åŠä»¥ä¸Šç‰ˆæœ¬çš„ <code>Windows 11</code> ä»¥åŠ <code>2.0</code> ä»¥ä¸Šç‰ˆæœ¬çš„ WSLã€‚ä½¿ç”¨ <code>wsl --version</code> å‘½ä»¤å¯ä»¥æ£€æŸ¥æ˜¯å¦ç¬¦åˆéœ€æ±‚ï¼Œ<code>wsl --update</code> å‘½ä»¤å¯ä»¥æ›´æ–° WSLã€‚</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">C:\<span class="title">Users</span>\<span class="title">iuxt</span>&gt;<span class="title">wsl</span> --<span class="title">version</span></span></span><br><span class="line"><span class="function"><span class="title">WSL</span> ç‰ˆæœ¬ï¼š 2.1.5.0</span></span><br><span class="line"><span class="function">å†…æ ¸ç‰ˆæœ¬ï¼š 5.15.146.1-2</span></span><br><span class="line"><span class="function"><span class="title">WSLg</span> ç‰ˆæœ¬ï¼š 1.0.60</span></span><br><span class="line"><span class="function"><span class="title">MSRDC</span> ç‰ˆæœ¬ï¼š 1.2.5105</span></span><br><span class="line"><span class="function"><span class="title">Direct3D</span> ç‰ˆæœ¬ï¼š 1.611.1-81528511</span></span><br><span class="line"><span class="function"><span class="title">DXCore</span> ç‰ˆæœ¬ï¼š 10.0.25131.1002-220531-1700.<span class="title">rs</span>-<span class="title">onecore</span>-<span class="title">base2</span>-<span class="title">hyp</span></span></span><br><span class="line"><span class="function"><span class="title">Windows</span> ç‰ˆæœ¬ï¼š 10.0.22631.3296</span></span><br></pre></td></tr></table></figure><p>ç¡®è®¤æ»¡è¶³ç‰ˆæœ¬éœ€æ±‚åï¼Œ åœ¨ windows çš„ä¸ªäººæ–‡ä»¶å¤¹ä¸‹åˆ›å»º <code>.wslconfig</code> æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[wsl2]</span></span><br><span class="line"><span class="attr">autoProxy</span>=<span class="literal">false</span>             <span class="comment"># æ˜¯å¦å¼ºåˆ¶ WSL2/WSLg å­ç³»ç»Ÿä½¿ç”¨ Windows ä»£ç†è®¾ç½®ï¼ˆè¯·æ ¹æ®å®é™…éœ€è¦å¯ç”¨ï¼‰</span></span><br><span class="line"><span class="attr">dnsTunneling</span>=<span class="literal">true</span>           <span class="comment"># WSL2/WSLg DNS ä»£ç†éš§é“ï¼Œä»¥ä¾¿ç”± Windows ä»£ç†è½¬å‘ DNS è¯·æ±‚ï¼ˆè¯·æ ¹æ®å®é™…éœ€è¦å¯ç”¨ï¼‰</span></span><br><span class="line"><span class="attr">firewall</span>=<span class="literal">true</span>               <span class="comment"># WSL2/WSLg å­ç³»ç»Ÿçš„ Windows é˜²ç«å¢™é›†æˆï¼Œä»¥ä¾¿ Hyper-V æˆ–è€… WPF èƒ½è¿‡æ»¤å­ç³»ç»Ÿæµé‡ï¼ˆè¯·æ ¹æ®å®é™…éœ€è¦å¯ç”¨ï¼‰</span></span><br><span class="line"><span class="attr">guiApplications</span>=<span class="literal">true</span>        <span class="comment"># å¯ç”¨ WSLg GUI å›¾å½¢åŒ–ç¨‹åºæ”¯æŒ</span></span><br><span class="line"><span class="attr">ipv6</span>=<span class="literal">true</span>                   <span class="comment"># å¯ç”¨ IPv6 ç½‘ç»œæ”¯æŒ</span></span><br><span class="line"><span class="attr">localhostForwarding</span>=<span class="literal">true</span>    <span class="comment"># å¯ç”¨ localhost ç½‘ç»œè½¬å‘æ”¯æŒ</span></span><br><span class="line"><span class="attr">memory</span>=<span class="number">4</span>GB                  <span class="comment"># é™åˆ¶ WSL2/WSLg å­ç³»ç»Ÿçš„æœ€å¤§å†…å­˜å ç”¨</span></span><br><span class="line"><span class="attr">nestedVirtualization</span>=<span class="literal">true</span>   <span class="comment"># å¯ç”¨ WSL2/WSLg å­ç³»ç»ŸåµŒå¥—è™šæ‹ŸåŒ–åŠŸèƒ½æ”¯æŒ</span></span><br><span class="line"><span class="attr">networkingMode</span>=mirrored     <span class="comment"># å¯ç”¨é•œåƒç½‘ç»œç‰¹æ€§æ”¯æŒ</span></span><br><span class="line"><span class="comment"># pageReporting=true          # å¯ç”¨ WSL2/WSLg å­ç³»ç»Ÿé¡µé¢æ–‡ä»¶é€šæŠ¥ï¼Œä»¥ä¾¿ Windows å›æ”¶å·²åˆ†é…ä½†æœªä½¿ç”¨çš„å†…å­˜</span></span><br><span class="line"><span class="attr">processors</span>=<span class="number">8</span>                <span class="comment"># è®¾ç½® WSL2/WSLg å­ç³»ç»Ÿçš„é€»è¾‘ CPU æ ¸å¿ƒæ•°ä¸º 8ï¼ˆæœ€å¤§è‚¯å®šæ²¡æ³•è¶…è¿‡ç¡¬ä»¶çš„ç‰©ç†é€»è¾‘æ ¸å¿ƒæ•°ï¼‰</span></span><br><span class="line"><span class="attr">vmIdleTimeout</span>=-<span class="number">1</span>            <span class="comment"># WSL2 VM å®ä¾‹ç©ºé—²è¶…æ—¶å…³é—­æ—¶é—´ï¼Œ-1 ä¸ºæ°¸ä¸å…³é—­ï¼Œæ ¹æ®å‚æ•°è¯´æ˜ï¼Œç›®å‰ä¼¼ä¹ä»…é€‚ç”¨äº Win11+</span></span><br><span class="line"></span><br><span class="line"><span class="section">[experimental]</span>                  <span class="comment"># å®éªŒæ€§åŠŸèƒ½ï¼ˆæŒ‰ç…§è¿‡å¾€ç»éªŒï¼Œè‹¥åç»­è½¬æ­£ï¼Œåˆ™æ˜¯é…ç½®åœ¨ä¸Šé¢çš„ [wsl2] é€‰èŠ‚ï¼‰</span></span><br><span class="line"><span class="attr">autoMemoryReclaim</span>=gradual       <span class="comment"># å¯ç”¨ç©ºé—²å†…å­˜è‡ªåŠ¨ç¼“æ…¢å›æ”¶ï¼Œå…¶å®ƒé€‰é¡¹ï¼šdropcache / disabledï¼ˆç«‹å³/ç¦ç”¨ï¼‰</span></span><br><span class="line"><span class="attr">hostAddressLoopback</span>=<span class="literal">true</span>        <span class="comment"># å¯ç”¨ WSL2/WSLg å­ç³»ç»Ÿå’Œ Windows å®¿ä¸»ä¹‹é—´çš„æœ¬åœ°å›ç¯äº’é€šæ”¯æŒ</span></span><br><span class="line"><span class="attr">sparseVhd</span>=<span class="literal">true</span>                  <span class="comment"># å¯ç”¨ WSL2/WSLg å­ç³»ç»Ÿè™šæ‹Ÿç¡¬ç›˜ç©ºé—´è‡ªåŠ¨å›æ”¶</span></span><br><span class="line"><span class="attr">useWindowsDnsCache</span>=<span class="literal">false</span>        <span class="comment"># å’Œ dnsTunneling é…åˆä½¿ç”¨ï¼Œå†³å®šæ˜¯å¦ä½¿ç”¨ Windows DNS ç¼“å­˜æ± </span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>sparseVhd=true</code> ç”Ÿæ•ˆéœ€è¦ç¨€ç– <code>vhdx</code>ï¼Œ è½¬æ¢å‘½ä»¤ <code>wsl --manage &#39;Ubuntu-24.04&#39; --set-sparse true</code></p><p>è¯¦ç»†é…ç½®è¯´æ˜ï¼š<a href="https://learn.microsoft.com/zh-cn/windows/wsl/wsl-config">https://learn.microsoft.com/zh-cn/windows/wsl/wsl-config</a></p><p>ç„¶åé‡å¯ WSL</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wsl --shutdown</span><br><span class="line">wsl</span><br></pre></td></tr></table></figure><h2 id="WSL-ç½‘å¡å˜åŒ–"><a href="#WSL-ç½‘å¡å˜åŒ–" class="headerlink" title="WSL ç½‘å¡å˜åŒ–"></a>WSL ç½‘å¡å˜åŒ–</h2><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202403281045337.png" alt="image.png"></p><h2 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h2><p><a href="https://zhuanlan.zhihu.com/p/668181689">åœ¨WSL2ä¸­è®¿é—®WindowsæœåŠ¡çš„å¦ä¸€ç§é€‰æ‹©â€”â€”mirroredé•œåƒç½‘ç»œ</a><br><a href="https://devblogs.microsoft.com/commandline/windows-subsystem-for-linux-september-2023-update/">Windows Subsystem for Linux September 2023 update</a><br><a href="https://learn.microsoft.com/en-us/windows/wsl/wsl-config#wslconfig">Advanced settings configuration in WSL</a></p><h2 id="é‡åˆ°çš„é—®é¢˜"><a href="#é‡åˆ°çš„é—®é¢˜" class="headerlink" title="é‡åˆ°çš„é—®é¢˜"></a>é‡åˆ°çš„é—®é¢˜</h2><h3 id="æ— æ³•è®¿é—®-docker-å®¹å™¨ç«¯å£"><a href="#æ— æ³•è®¿é—®-docker-å®¹å™¨ç«¯å£" class="headerlink" title="æ— æ³•è®¿é—® docker å®¹å™¨ç«¯å£"></a>æ— æ³•è®¿é—® docker å®¹å™¨ç«¯å£</h3><p>æˆ‘çš„ <code>.wslconfig</code> é…ç½®ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[wsl2]</span><br><span class="line">autoProxy=false             # æ˜¯å¦å¼ºåˆ¶ WSL2/WSLg å­ç³»ç»Ÿä½¿ç”¨ Windows ä»£ç†è®¾ç½®ï¼ˆè¯·æ ¹æ®å®é™…éœ€è¦å¯ç”¨ï¼‰</span><br><span class="line">dnsTunneling=true           # WSL2/WSLg DNS ä»£ç†éš§é“ï¼Œä»¥ä¾¿ç”± Windows ä»£ç†è½¬å‘ DNS è¯·æ±‚ï¼ˆè¯·æ ¹æ®å®é™…éœ€è¦å¯ç”¨ï¼‰</span><br><span class="line">firewall=true               # WSL2/WSLg å­ç³»ç»Ÿçš„ Windows é˜²ç«å¢™é›†æˆï¼Œä»¥ä¾¿ Hyper-V æˆ–è€… WPF èƒ½è¿‡æ»¤å­ç³»ç»Ÿæµé‡ï¼ˆè¯·æ ¹æ®å®é™…éœ€è¦å¯ç”¨ï¼‰</span><br><span class="line">guiApplications=true        # å¯ç”¨ WSLg GUI å›¾å½¢åŒ–ç¨‹åºæ”¯æŒ</span><br><span class="line">ipv6=true                   # å¯ç”¨ IPv6 ç½‘ç»œæ”¯æŒ</span><br><span class="line">nestedVirtualization=true   # å¯ç”¨ WSL2/WSLg å­ç³»ç»ŸåµŒå¥—è™šæ‹ŸåŒ–åŠŸèƒ½æ”¯æŒ</span><br><span class="line">networkingMode=mirrored     # å¯ç”¨é•œåƒç½‘ç»œç‰¹æ€§æ”¯æŒ</span><br><span class="line">vmIdleTimeout=-1            # WSL2 VM å®ä¾‹ç©ºé—²è¶…æ—¶å…³é—­æ—¶é—´ï¼Œ-1 ä¸ºæ°¸ä¸å…³é—­ï¼Œæ ¹æ®å‚æ•°è¯´æ˜ï¼Œç›®å‰ä¼¼ä¹ä»…é€‚ç”¨äº Win11+</span><br><span class="line"></span><br><span class="line">[experimental]</span><br><span class="line">autoMemoryReclaim=gradual       # å¯ç”¨ç©ºé—²å†…å­˜è‡ªåŠ¨ç¼“æ…¢å›æ”¶ï¼Œå…¶å®ƒé€‰é¡¹ï¼šdropcache / disabledï¼ˆç«‹å³/ç¦ç”¨ï¼‰</span><br><span class="line">hostAddressLoopback=true        # å¯ç”¨ WSL2/WSLg å­ç³»ç»Ÿå’Œ Windows å®¿ä¸»ä¹‹é—´çš„æœ¬åœ°å›ç¯äº’é€šæ”¯æŒ</span><br><span class="line">sparseVhd=true                  # å¯ç”¨ WSL2/WSLg å­ç³»ç»Ÿè™šæ‹Ÿç¡¬ç›˜ç©ºé—´è‡ªåŠ¨å›æ”¶</span><br><span class="line">useWindowsDnsCache=false        # å’Œ dnsTunneling é…åˆä½¿ç”¨ï¼Œå†³å®šæ˜¯å¦ä½¿ç”¨ Windows DNS ç¼“å­˜æ± </span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ubuntuç³»ç»Ÿå…³é—­é˜²ç«å¢™</span></span><br><span class="line">sudo systemctl <span class="built_in">disable</span> --now ufw</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ Docker é…ç½®æ–‡ä»¶ <code>/etc/docker/daemon.json</code></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;iptables&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> wsl2 </tag>
            
            <tag> ç½‘ç»œ </tag>
            
            <tag> æ•ˆç‡å·¥å…· </tag>
            
            <tag> å‘½ä»¤è¡Œå·¥å…· </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexoåšå®¢æ›´æ¢urlç»“æ„åé…ç½®è‡ªåŠ¨è·³è½¬</title>
      <link href="/posts/lu96kcpp/"/>
      <url>/posts/lu96kcpp/</url>
      
        <content type="html"><![CDATA[<p>å› ä¸ºä¿®æ”¹è¿‡åšå®¢çš„é“¾æ¥è§„åˆ™ï¼Œ åŸæ¥çš„é“¾æ¥æ˜¯ <code>https://zahui.fan/xxx/</code> ä¿®æ”¹æˆäº† <code>https://zahui.fan/posts/xxx/</code> æˆ–è€…åˆ é™¤äº†éƒ¨åˆ†æ ‡ç­¾ï¼Œé€ æˆäº†æœç´¢å¼•æ“å†…ä¹‹å‰æ”¶å½•çš„ä¸€äº›é“¾æ¥éƒ½å˜æˆäº† 404ï¼Œä¸åˆ©äº SEO</p><p>å¦‚æœæ˜¯ hugoï¼Œå¯ä»¥æŸ¥çœ‹è¿™ç¯‡æ–‡ç« ï¼š<a href="/posts/b75ec1fe/">Hugoåšå®¢æ‰¹é‡æ›´æ¢urlç»“æ„</a></p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202403271024183.png" alt="image.png"></p><p>åœ¨ hexo ä¸­æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>hexo-generator-alias</code> å¯¹æ–‡ç« è¿›è¡Œè·³è½¬ã€‚</p><h2 id="å®‰è£…-hexo-generator-alias"><a href="#å®‰è£…-hexo-generator-alias" class="headerlink" title="å®‰è£… hexo-generator-alias"></a>å®‰è£… hexo-generator-alias</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-generator-alias --save</span><br></pre></td></tr></table></figure><p>GitHub åœ°å€ï¼š <a href="https://github.com/hexojs/hexo-generator-alias">https://github.com/hexojs/hexo-generator-alias</a></p><h2 id="å…¨å±€é…ç½®"><a href="#å…¨å±€é…ç½®" class="headerlink" title="å…¨å±€é…ç½®"></a>å…¨å±€é…ç½®</h2><p>æ¯”å¦‚ tagsã€category ç­‰è¿™ç§ä¸å­˜åœ¨å¯¹åº”çš„ markdown æ–‡ä»¶ï¼Œ å¯ä»¥é…ç½®åœ¨å…¨å±€é…ç½® <code>_config.yml</code> ä¸­ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">alias:</span></span><br><span class="line">  <span class="comment"># è®¿é—® https://zahui.fan/index.html  è·³è½¬åˆ°  https://zahui.fan/</span></span><br><span class="line">  <span class="attr">index.html:</span> <span class="string">/</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment"># è®¿é—® https://zahui.fan/tags/flask/ è·³è½¬åˆ° https://zahui.fan/tags/Flask/</span></span><br><span class="line">  <span class="attr">tags/flask/:</span> <span class="string">tags/Flask/</span></span><br></pre></td></tr></table></figure><h2 id="æ–‡ç« é…ç½®"><a href="#æ–‡ç« é…ç½®" class="headerlink" title="æ–‡ç« é…ç½®"></a>æ–‡ç« é…ç½®</h2><p>é…ç½®åœ¨æ–‡ç« çš„ <code>front-matter</code> ä¸­ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">title:</span> <span class="string">æ‰“é€ ä¸€ä¸ªèµå¿ƒæ‚¦ç›®çš„ç»ˆç«¯</span></span><br><span class="line"><span class="attr">abbrlink:</span> <span class="string">57e7c794</span></span><br><span class="line"><span class="attr">alias:</span> <span class="string">/57e7c794/</span></span><br><span class="line"><span class="attr">categories:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">Windows</span></span><br><span class="line"><span class="attr">tags:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">Linux</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">é…ç½®è®°å½•</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">WSL</span></span><br><span class="line"><span class="attr">date:</span> <span class="number">2021-03-05 11:54:29</span></span><br><span class="line"><span class="meta">---</span></span><br></pre></td></tr></table></figure><p>abbrlinkï¼šå°±æ˜¯æ–‡ç« æœ¬æ¥çš„é“¾æ¥ï¼Œ æ¯”å¦‚æˆ‘çš„å°±æ˜¯ <code>https://zahui.fan/posts/57e7c794/</code></p><p>alias: è¿™ä¸ªæ˜¯å…³è”çš„é“¾æ¥ï¼Œé…ç½®æˆ <code>/57e7c794/</code>, åˆ™è®¿é—® <code>https://zahui.fan/57e7c794/</code> ä¼šè·³è½¬åˆ°æœ¬ç¯‡æ–‡ç« ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Blog </tag>
            
            <tag> hexo </tag>
            
            <tag> seo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RustDeskæœåŠ¡å™¨æ­å»ºè®°å½•</title>
      <link href="/posts/cb24765f/"/>
      <url>/posts/cb24765f/</url>
      
        <content type="html"><![CDATA[<p>RustDesk æ˜¯ä¸€ä¸ªè¿œç¨‹æ§åˆ¶å·¥å…·ï¼Œå¼€æºè·¨å¹³å°ï¼Œå¯ä»¥ä½¿ç”¨å®˜æ–¹çš„æœåŠ¡å™¨ï¼Œä¹Ÿå¯ä»¥è‡ªå»ºæœåŠ¡å™¨ä½¿ç”¨ã€‚æœåŠ¡å™¨åˆ†ä¸ºå¼€æºç‰ˆ oss å’Œä»˜è´¹ç‰ˆ proï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯å¼€æºç‰ˆã€‚</p><h2 id="éƒ¨ç½²æœåŠ¡å™¨"><a href="#éƒ¨ç½²æœåŠ¡å™¨" class="headerlink" title="éƒ¨ç½²æœåŠ¡å™¨"></a>éƒ¨ç½²æœåŠ¡å™¨</h2><p>æœåŠ¡ç«¯æ˜¯ rust å¼€å‘çš„ï¼Œå•æ–‡ä»¶ç›´æ¥è¿è¡Œå³å¯ã€‚ä½ å¯ä»¥ä½¿ç”¨ä½ å–œæ¬¢çš„è¿›ç¨‹ç®¡ç†å·¥å…·æ¥ç®¡ç†ï¼Œæ¯”å¦‚ nodejs å†™çš„ pm2ï¼Œ Python å†™çš„ supervisorï¼Œ æˆ–è€…ä½¿ç”¨ docker è¿è¡Œï¼Œæˆ‘é€‰æ‹© dockerã€‚</p><h3 id="å¯åŠ¨å‘½ä»¤"><a href="#å¯åŠ¨å‘½ä»¤" class="headerlink" title="å¯åŠ¨å‘½ä»¤"></a>å¯åŠ¨å‘½ä»¤</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">docker run -td --name hbbs \</span><br><span class="line">    -v ./data:/root \</span><br><span class="line">    --net=host \</span><br><span class="line">    --restart unless-stopped \</span><br><span class="line">    rustdesk/rustdesk-server hbbs</span><br><span class="line"></span><br><span class="line">docker run -td --name hbbr \</span><br><span class="line">    -v ./data:/root \</span><br><span class="line">    --net=host \</span><br><span class="line">    --restart unless-stopped \</span><br><span class="line">    rustdesk/rustdesk-server hbbr</span><br></pre></td></tr></table></figure><h3 id="æ–‡ä»¶è¯´æ˜"><a href="#æ–‡ä»¶è¯´æ˜" class="headerlink" title="æ–‡ä»¶è¯´æ˜"></a>æ–‡ä»¶è¯´æ˜</h3><p>data ç›®å½•ï¼ˆå®¹å™¨å†…çš„ root ç›®å½•ï¼‰ä¸‹çš„æ–‡ä»¶ï¼š</p><table><thead><tr><th>æ–‡ä»¶å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>db å¼€å¤´çš„æ–‡ä»¶</td><td>SQLite æ•°æ®åº“æ–‡ä»¶</td></tr><tr><td>id_ed25519</td><td>ç§é’¥</td></tr><tr><td>id_ed25519.pub</td><td>å…¬é’¥ï¼Œæ–‡ä»¶å†…å®¹å°±æ˜¯å®¢æˆ·ç«¯éœ€è¦çš„ key</td></tr></tbody></table><h3 id="ç½‘ç»œç«¯å£"><a href="#ç½‘ç»œç«¯å£" class="headerlink" title="ç½‘ç»œç«¯å£"></a>ç½‘ç»œç«¯å£</h3><p>æˆ‘ä½¿ç”¨äº† host ç½‘ç»œï¼Œå¦‚æœä½¿ç”¨ bridge ç½‘ç»œï¼ˆdocker é»˜è®¤ç½‘ç»œï¼‰ï¼Œéœ€è¦æ˜ å°„ä»¥ä¸‹ç«¯å£</p><h4 id="hbbs-æœåŠ¡"><a href="#hbbs-æœåŠ¡" class="headerlink" title="hbbs æœåŠ¡"></a>hbbs æœåŠ¡</h4><table><thead><tr><th>ç«¯å£</th><th>ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>21115</td><td>tcp</td><td>used for the NAT type test</td></tr><tr><td>21116</td><td>tcp</td><td>used for TCP hole punching and connection service</td></tr><tr><td>21116</td><td>udp</td><td>used for the ID registration and heartbeat service</td></tr><tr><td>21118</td><td>tcp</td><td>web ä½¿ç”¨ï¼ˆå¼€æºç‰ˆæœ¬æš‚æ—¶æ²¡æœ‰ web é¡µé¢ï¼‰</td></tr></tbody></table><h4 id="hbbr-æœåŠ¡"><a href="#hbbr-æœåŠ¡" class="headerlink" title="hbbr æœåŠ¡"></a>hbbr æœåŠ¡</h4><table><thead><tr><th>ç«¯å£</th><th>ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>21117</td><td>tcp</td><td>used for the Relay services</td></tr><tr><td>21119</td><td>tcp</td><td>web ä½¿ç”¨ï¼ˆå¼€æºç‰ˆæœ¬æš‚æ—¶æ²¡æœ‰ web é¡µé¢ï¼‰</td></tr></tbody></table><h2 id="å®¢æˆ·ç«¯é…ç½®"><a href="#å®¢æˆ·ç«¯é…ç½®" class="headerlink" title="å®¢æˆ·ç«¯é…ç½®"></a>å®¢æˆ·ç«¯é…ç½®</h2><p>åœ¨ <code>è®¾ç½®</code> â€“&gt; <code>ç½‘ç»œ</code> é‡Œé¢é…ç½® <code>ID æœåŠ¡å™¨</code>, ID æœåŠ¡å™¨å¡« ä½ çš„æœåŠ¡å™¨ <code>IP:21116</code> æˆ–è€…ç›´æ¥å¡«å†™åŸŸåï¼Œä¸å†™ç«¯å£é»˜è®¤æ˜¯ 21116ï¼Œå¦å¤–ä¸¤ä¸ªåœ°å€å¯ä»¥ä¸å¡«ï¼ŒRustDesk ä¼šè‡ªåŠ¨æ¨å¯¼ï¼ˆå¦‚æœæ²¡æœ‰ç‰¹åˆ«è®¾å®šï¼‰ï¼Œä¸­ç»§æœåŠ¡å™¨æŒ‡çš„æ˜¯ hbbrï¼ˆ21117ï¼‰ç«¯å£ã€‚</p><p>key å¯ä»¥å¡«å¯ä»¥ä¸å¡«ï¼Œ ä¸å¡«çš„è¯ï¼Œ è¿æ¥ä¸èƒ½åŠ å¯†ã€‚key åœ¨ hbbs æœåŠ¡çš„æ§åˆ¶å°æ—¥å¿—é‡Œæœ‰ï¼Œ <code>cat id_ed25519.pub</code> ä¹Ÿå¯ä»¥çœ‹åˆ° key</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202403131652971.png" alt="image.png|533"></p><p>åˆ°æ­¤ä¸ºæ­¢å°±å·²ç»å¯ä»¥ä½¿ç”¨äº†</p><h2 id="å®‰å…¨æ€§"><a href="#å®‰å…¨æ€§" class="headerlink" title="å®‰å…¨æ€§"></a>å®‰å…¨æ€§</h2><p>è€ƒè™‘åˆ°ä¸Šé¢é…ç½®ä¸åŠ å¯†çš„è¯ï¼Œä»»ä½•äººé…ç½®ä¸Šäº†æˆ‘çš„æœåŠ¡å™¨åœ°å€éƒ½å¯ä»¥ä½¿ç”¨æˆ‘çš„æœåŠ¡äº†ï¼ˆè¿æ¥æˆ‘çš„ç”µè„‘è¿˜éœ€è¦ id å’Œå¯†ç ï¼‰ï¼Œä¸å¤ªå®‰å…¨ï¼Œæ‰€ä»¥å»ºè®®å¼€å¯åŠ å¯†è¿æ¥ã€‚</p><p><code>hbbr</code> å’Œ <code>hbbs</code> å¢åŠ å¯åŠ¨å‚æ•° <code> -k _</code>ï¼Œ docker å¯åŠ¨å‘½ä»¤ä¸ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">docker run -td --name hbbs \</span><br><span class="line">    -v ./data:/root \</span><br><span class="line">    --net=host \</span><br><span class="line">    --restart unless-stopped \</span><br><span class="line">    rustdesk/rustdesk-server hbbs -k _</span><br><span class="line"></span><br><span class="line">docker run -td --name hbbr \</span><br><span class="line">    -v ./data:/root \</span><br><span class="line">    --net=host \</span><br><span class="line">    --restart unless-stopped \</span><br><span class="line">    rustdesk/rustdesk-server hbbr -k _</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ—¶å€™å†æ¬¡å°è¯•è¿æ¥ï¼š<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202403131705610.png" alt="image.png|808"></p><p>é…ç½®äº†æ­£ç¡®çš„ key åï¼Œå¯ä»¥æ­£å¸¸ä½¿ç”¨ã€‚</p><h2 id="å¸¸è§é—®é¢˜"><a href="#å¸¸è§é—®é¢˜" class="headerlink" title="å¸¸è§é—®é¢˜"></a>å¸¸è§é—®é¢˜</h2><h3 id="ç¬¬ä¸€æ¬¡æ— æ³•è¿æ¥"><a href="#ç¬¬ä¸€æ¬¡æ— æ³•è¿æ¥" class="headerlink" title="ç¬¬ä¸€æ¬¡æ— æ³•è¿æ¥"></a>ç¬¬ä¸€æ¬¡æ— æ³•è¿æ¥</h3><p>å¯ä»¥å°è¯•å¼ºåˆ¶ä¸­ç»§æœåŠ¡å™¨è¿æ¥ï¼Œ åªéœ€è¦åœ¨ id åé¢åŠ ä¸Š <code>/r</code> å³å¯ã€‚å¦‚<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202403152226765.png" alt="image.png"></p><p>è¿æ¥æˆåŠŸåï¼Œå¯ä»¥æ‰“å¼€ å¼ºåˆ¶èµ°ä¸­ç»§è¿æ¥</p><h3 id="å°†é…ç½®æ”¾åœ¨æ–‡ä»¶åä¸­ï¼ˆä»…æ”¯æŒ-Windowsï¼‰"><a href="#å°†é…ç½®æ”¾åœ¨æ–‡ä»¶åä¸­ï¼ˆä»…æ”¯æŒ-Windowsï¼‰" class="headerlink" title="å°†é…ç½®æ”¾åœ¨æ–‡ä»¶åä¸­ï¼ˆä»…æ”¯æŒ Windowsï¼‰"></a>å°†é…ç½®æ”¾åœ¨æ–‡ä»¶åä¸­ï¼ˆä»…æ”¯æŒ Windowsï¼‰</h3><p>å°†å®‰è£…ç¨‹åºä¿®æ”¹ä¸€ä¸‹åå­—ï¼ŒæŒ‰ç…§è¿™ä¸ªè§„åˆ™ï¼š</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rustdesk-host=&lt;host-ip-or-name&gt;,key=&lt;public-key-string&gt;.exe</span><br></pre></td></tr></table></figure><p>å®‰è£…å®Œæˆåå¯ä»¥çœå»é…ç½®ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
            <tag> éƒ¨ç½² </tag>
            
            <tag> æ­å»º </tag>
            
            <tag> å¼€æºè½¯ä»¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Django Restframework å®ç°æ ¹æ®å­—æ®µè¿‡æ»¤</title>
      <link href="/posts/ltmpr1yl/"/>
      <url>/posts/ltmpr1yl/</url>
      
        <content type="html"><![CDATA[<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install django-filter</span><br></pre></td></tr></table></figure><h2 id="æ³¨å†Œè¿›-Django"><a href="#æ³¨å†Œè¿›-Django" class="headerlink" title="æ³¨å†Œè¿› Django"></a>æ³¨å†Œè¿› Django</h2><p>vim settings.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line">    ...</span><br><span class="line">    <span class="string">&#x27;django_filters&#x27;</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®åœ¨è¿™é‡Œçš„æ˜¯ç³»ç»Ÿçš„é»˜è®¤è®¾ç½®ï¼Œä¹Ÿå¯ä»¥åœ¨è§†å›¾é›†ä¸­å•ç‹¬æŒ‡å®š</span></span><br><span class="line">REST_FRAMEWORK = &#123;</span><br><span class="line">   <span class="comment"># è¿‡æ»¤å™¨é»˜è®¤åç«¯</span></span><br><span class="line">    <span class="string">&#x27;DEFAULT_FILTER_BACKENDS&#x27;</span>: [<span class="string">&#x27;django_filters.rest_framework.DjangoFilterBackend&#x27;</span>],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è§†å›¾ä¸­å•ç‹¬æŒ‡å®š"><a href="#è§†å›¾ä¸­å•ç‹¬æŒ‡å®š" class="headerlink" title="è§†å›¾ä¸­å•ç‹¬æŒ‡å®š"></a>è§†å›¾ä¸­å•ç‹¬æŒ‡å®š</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä½ ä¹Ÿå¯ä»¥å°†å…¶å•ç‹¬é…ç½®åœ¨ç‰¹å®šçš„è§†å›¾ä¸­ï¼š</span></span><br><span class="line"></span><br><span class="line"> <span class="keyword">from</span> django_filters.rest_framework <span class="keyword">import</span> DjangoFilterBackend</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="keyword">class</span> <span class="title class_">ArticleViewSet</span>(viewsets.ModelViewSet):</span><br><span class="line">     <span class="comment"># è®¾ç½®è¿‡æ»¤çš„åç«¯ï¼Œä¸è®¾ç½®åˆ™èµ°ä¸Šé¢çš„é»˜è®¤é…ç½®ã€‚</span></span><br><span class="line">     filter_backends = [DjangoFilterBackend]</span><br><span class="line">     <span class="comment"># è®¾ç½®è¿‡æ»¤çš„å­—æ®µï¼Œè¿™ä¸ªéœ€è¦é…ç½®ä¸€ä¸‹ã€‚</span></span><br><span class="line">     filterset_fields = [<span class="string">&#x27;author__username&#x27;</span>, <span class="string">&#x27;title&#x27;</span>]</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><p>ä¸Šé¢æŒ‡å®šäº†è¿‡æ»¤çš„å­—æ®µï¼Œé‚£ä¹ˆå¯ä»¥æ ¹æ®è¿™ä¸¤ä¸ªå­—æ®µè¿›è¡Œè¿‡æ»¤äº†ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://localhost:8000/api/article/?author__username=iuxt&amp;title=</span><br></pre></td></tr></table></figure><h2 id="æ¨¡ç³Šæœç´¢"><a href="#æ¨¡ç³Šæœç´¢" class="headerlink" title="æ¨¡ç³Šæœç´¢"></a>æ¨¡ç³Šæœç´¢</h2><p>ä¸Šé¢çš„æœç´¢ï¼ˆè¿‡æ»¤ï¼‰æ–¹å¼æ˜¯ç²¾ç¡®æœç´¢ï¼Œ å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ DRFï¼Œéœ€è¦æ¨¡ç³Šæœç´¢å¯ä»¥ä½¿ç”¨ <code>rest_framework</code> çš„ filters</p><p>vim views.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> filters</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ArticleViewSet</span>(viewsets.ModelViewSet):</span><br><span class="line">    queryset = Article.objects.<span class="built_in">all</span>()</span><br><span class="line">    serializer_class = ArticleSerializer</span><br><span class="line">    permission_classes = [IsAdminUserOrReadOnly]</span><br><span class="line"></span><br><span class="line">    filter_backends = [filters.SearchFilter]</span><br><span class="line">    search_fields = [<span class="string">&#x27;title&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è¿™ä¸ªå±æ€§ä¸éœ€è¦äº†</span></span><br><span class="line">    <span class="comment"># filterset_fields = [&#x27;author__username&#x27;, &#x27;title&#x27;]</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æœç´¢æ–¹å¼</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://localhost:8000/api/article/?search=æµ‹è¯•æµ‹</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> django </tag>
            
            <tag> Python </tag>
            
            <tag> drf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨kubeadméƒ¨ç½²çš„é›†ç¾¤è¯ä¹¦è¿‡æœŸåå¤„ç†</title>
      <link href="/posts/ltckjzor/"/>
      <url>/posts/ltckjzor/</url>
      
        <content type="html"><![CDATA[<p>ä¹‹å‰ä½¿ç”¨ <code>kubeadm</code> éƒ¨ç½²çš„é›†ç¾¤ï¼Œçªç„¶æœ‰ä¸€å¤©æ‰§è¡Œ <code>kubectl get pod</code> æç¤ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Unable to connect to the server: x509: certificate has expired or is not yet valid: current time 2024-03-04T14:26:31+08:00 is after 2024-02-27T08:36:50Z</span><br></pre></td></tr></table></figure><p>æ„æ€æ˜¯è¯ä¹¦æœ‰æ•ˆæœŸåˆ° 2024-02-27T08:36:50Zï¼Œ å·²ç»è¶…è¿‡äº†è¯ä¹¦æœ‰æ•ˆæœŸäº†ã€‚</p><h2 id="æŸ¥çœ‹è¯ä¹¦æœ‰æ•ˆæœŸ"><a href="#æŸ¥çœ‹è¯ä¹¦æœ‰æ•ˆæœŸ" class="headerlink" title="æŸ¥çœ‹è¯ä¹¦æœ‰æ•ˆæœŸ"></a>æŸ¥çœ‹è¯ä¹¦æœ‰æ•ˆæœŸ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@ALSHBSITL00061 kubernetes]<span class="comment"># kubeadm certs check-expiration</span></span><br><span class="line">[check-expiration] Reading configuration from the cluster...</span><br><span class="line">[check-expiration] FYI: You can look at this config file with <span class="string">&#x27;kubectl -n kube-system get cm kubeadm-config -o yaml&#x27;</span></span><br><span class="line">[check-expiration] Error reading configuration from the Cluster. Falling back to default configuration</span><br><span class="line"></span><br><span class="line">CERTIFICATE                EXPIRES                  RESIDUAL TIME   CERTIFICATE AUTHORITY   EXTERNALLY MANAGED</span><br><span class="line">admin.conf                 Feb 27, 2024 08:36 UTC   &lt;invalid&gt;       ca                      no</span><br><span class="line">apiserver                  Feb 27, 2024 08:36 UTC   &lt;invalid&gt;       ca                      no</span><br><span class="line">apiserver-etcd-client      Feb 27, 2024 08:36 UTC   &lt;invalid&gt;       etcd-ca                 no</span><br><span class="line">apiserver-kubelet-client   Feb 27, 2024 08:36 UTC   &lt;invalid&gt;       ca                      no</span><br><span class="line">controller-manager.conf    Feb 27, 2024 08:36 UTC   &lt;invalid&gt;       ca                      no</span><br><span class="line">etcd-healthcheck-client    Feb 27, 2024 08:36 UTC   &lt;invalid&gt;       etcd-ca                 no</span><br><span class="line">etcd-peer                  Feb 27, 2024 08:36 UTC   &lt;invalid&gt;       etcd-ca                 no</span><br><span class="line">etcd-server                Feb 27, 2024 08:36 UTC   &lt;invalid&gt;       etcd-ca                 no</span><br><span class="line">front-proxy-client         Feb 27, 2024 08:36 UTC   &lt;invalid&gt;       front-proxy-ca          no</span><br><span class="line">scheduler.conf             Feb 27, 2024 08:36 UTC   &lt;invalid&gt;       ca                      no</span><br><span class="line"></span><br><span class="line">CERTIFICATE AUTHORITY   EXPIRES                  RESIDUAL TIME   EXTERNALLY MANAGED</span><br><span class="line">ca                      Feb 24, 2033 08:36 UTC   8y              no</span><br><span class="line">etcd-ca                 Feb 24, 2033 08:36 UTC   8y              no</span><br><span class="line">front-proxy-ca          Feb 24, 2033 08:36 UTC   8y              no</span><br></pre></td></tr></table></figure><h2 id="æ‰§è¡Œç»­æœŸæ“ä½œ"><a href="#æ‰§è¡Œç»­æœŸæ“ä½œ" class="headerlink" title="æ‰§è¡Œç»­æœŸæ“ä½œ"></a>æ‰§è¡Œç»­æœŸæ“ä½œ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@ALSHBSITL00061 kubernetes]<span class="comment"># kubeadm certs renew all</span></span><br><span class="line">[renew] Reading configuration from the cluster...</span><br><span class="line">[renew] FYI: You can look at this config file with <span class="string">&#x27;kubectl -n kube-system get cm kubeadm-config -o yaml&#x27;</span></span><br><span class="line">[renew] Error reading configuration from the Cluster. Falling back to default configuration</span><br><span class="line"></span><br><span class="line">certificate embedded <span class="keyword">in</span> the kubeconfig file <span class="keyword">for</span> the admin to use and <span class="keyword">for</span> kubeadm itself renewed</span><br><span class="line">certificate <span class="keyword">for</span> serving the Kubernetes API renewed</span><br><span class="line">certificate the apiserver uses to access etcd renewed</span><br><span class="line">certificate <span class="keyword">for</span> the API server to connect to kubelet renewed</span><br><span class="line">certificate embedded <span class="keyword">in</span> the kubeconfig file <span class="keyword">for</span> the controller manager to use renewed</span><br><span class="line">certificate <span class="keyword">for</span> liveness probes to healthcheck etcd renewed</span><br><span class="line">certificate <span class="keyword">for</span> etcd nodes to communicate with each other renewed</span><br><span class="line">certificate <span class="keyword">for</span> serving etcd renewed</span><br><span class="line">certificate <span class="keyword">for</span> the front proxy client renewed</span><br><span class="line">certificate embedded <span class="keyword">in</span> the kubeconfig file <span class="keyword">for</span> the scheduler manager to use renewed</span><br><span class="line"></span><br><span class="line">Done renewing certificates. You must restart the kube-apiserver, kube-controller-manager, kube-scheduler and etcd, so that they can use the new certificates.</span><br></pre></td></tr></table></figure><h2 id="æ›´æ–°-kubectl-é…ç½®"><a href="#æ›´æ–°-kubectl-é…ç½®" class="headerlink" title="æ›´æ–° kubectl é…ç½®"></a>æ›´æ–° kubectl é…ç½®</h2><p>å¦‚æœå½“æ—¶å®‰è£…çš„æ—¶å€™æ˜¯é€šè¿‡ <code>cp /etc/kubernetes/admin.conf ~/.kube/config</code> å¤åˆ¶çš„é…ç½®ï¼Œéœ€è¦å†æ›´æ–°ä¸€éï¼Œç®¡ç†å‘˜ä¹Ÿå¯ä»¥æŒ‡å®šä½¿ç”¨ <code>/etc/kubernetes/admin.conf</code> ä½œä¸º kubeconfigï¼Œå°±ä¸ç”¨æ¯æ¬¡æ›´æ–°äº†ã€‚</p><h2 id="é‡å¯æœåŠ¡"><a href="#é‡å¯æœåŠ¡" class="headerlink" title="é‡å¯æœåŠ¡"></a>é‡å¯æœåŠ¡</h2><p>éœ€è¦é‡å¯ kube-apiserver, kube-controller-manager, kube-scheduler å’Œ etcdï¼Œ kubeadm å®‰è£…çš„ kubelet ä¼šè‡ªåŠ¨æ›´æ–°è¯ä¹¦ï¼Œæ‰€ä»¥ä¸ç”¨é‡å¯ã€‚</p><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">å®¹å™¨è¿è¡Œæ—¶æ˜¯containerd</button><button type="button" class="tab">å®¹å™¨è¿è¡Œæ—¶æ˜¯docker</button></div><div class="tab-contents"><div class="tab-item-content active"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">crictl pods --namespace kube-system --name <span class="string">&#x27;kube-scheduler-*|kube-controller-manager-*|kube-apiserver-*|etcd-*&#x27;</span> -q | xargs crictl rmp -f</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker ps</span><br><span class="line">docker restart xxx </span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div>]]></content>
      
      
      <categories>
          
          <category> å®¹å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Kubernetes </tag>
            
            <tag> kubeadm </tag>
            
            <tag> è®°å½• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Windowsä¿®æ”¹ç”¨æˆ·å</title>
      <link href="/posts/lta396h7/"/>
      <url>/posts/lta396h7/</url>
      
        <content type="html"><![CDATA[<p>ä¹‹å‰ windows10 åœ¨å®‰è£…è¿‡ç¨‹ä¸­å¦‚æœä¸ä½¿ç”¨å¾®è½¯è´¦å·ç™»å½•çš„è¯ï¼Œåˆ›å»ºä¸€ä¸ªæœ¬åœ°è´¦æˆ·ï¼Œé‚£ä¹ˆåˆ›å»ºå¥½çš„ç”¨æˆ·åå°±æ˜¯ä¸ªäººæ–‡ä»¶å¤¹çš„åå­—ã€‚å¦‚æœè®¾ç½®äº†ä¸­æ–‡ï¼Œé‚£ä¹ˆä¸ªäººæ–‡ä»¶å¤¹åå­—å°±æ˜¯ä¸­æ–‡ï¼Œåç»­ä¼šæœ‰è½¯ä»¶å…¼å®¹æ€§é—®é¢˜ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹æ³¨å†Œè¡¨æ¥ä¿®æ”¹æ–‡ä»¶å¤¹åå­—ã€‚</p><h2 id="ä¿®æ”¹ç”¨æˆ·å"><a href="#ä¿®æ”¹ç”¨æˆ·å" class="headerlink" title="ä¿®æ”¹ç”¨æˆ·å"></a>ä¿®æ”¹ç”¨æˆ·å</h2><p>é¦–å…ˆè¦åŒºåˆ†ä¸€ä¸‹ä»€ä¹ˆæ˜¯ç”¨æˆ·å<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202403022109093.png" alt="image.png"></p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202403022111200.png" alt="image.png"></p><p>ä¸Šé¢è¿™äº›éƒ½ä¸æ˜¯ç”¨æˆ·åï¼Œè€Œæ˜¯æ˜¾ç¤ºå‡ºæ¥çš„ç”¨æˆ·åï¼Œä¹Ÿå°±æ˜¯ç”¨æˆ·åå…¨åã€‚å¯ä»¥åœ¨ <code>lusrmgr.msc</code> æˆ– <code>control userpasswords2</code> æˆ– <code>netplwiz</code> æŸ¥çœ‹:</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202403022113496.png" alt="image.png"></p><p>é€šè¿‡ä¸Šå›¾å‘ç°ï¼Œæˆ‘çš„ç”¨æˆ·ååº”è¯¥æ˜¯ ooo</p><p>ä¿®æ”¹ç”¨æˆ·åå¯ä»¥ç›´æ¥åœ¨ <code>lusrmgr.msc</code> è¿›è¡Œä¿®æ”¹ï¼ŒåŒ…æ‹¬æ˜¾ç¤ºçš„å…¨åï¼Œå¦‚æœä½ åªæ˜¯æƒ³ä¿®æ”¹æ˜¾ç¤ºå‡ºæ¥çš„åå­—ï¼Œåˆ°è¿™é‡Œå°±å¯ä»¥äº†ã€‚</p><h2 id="ä¿®æ”¹ä¸ªäººæ–‡ä»¶å¤¹è·¯å¾„"><a href="#ä¿®æ”¹ä¸ªäººæ–‡ä»¶å¤¹è·¯å¾„" class="headerlink" title="ä¿®æ”¹ä¸ªäººæ–‡ä»¶å¤¹è·¯å¾„"></a>ä¿®æ”¹ä¸ªäººæ–‡ä»¶å¤¹è·¯å¾„</h2><div class="note danger flat"><p>danger ä¿®æ”¹ä¸ªäººæ–‡ä»¶å¤¹è·¯å¾„éœ€è¦æ…é‡ï¼æœ‰éƒ¨åˆ†å·²å®‰è£…è½¯ä»¶å¼•ç”¨çš„è¿˜æ˜¯æ—§çš„è·¯å¾„ï¼Œè¿™æ ·ä¼šé€ æˆå„ç§æŠ¥é”™ï¼Œå¯èƒ½éœ€è¦å¸è½½é‡æ–°å®‰è£…æ‰èƒ½æ­£å¸¸ä½¿ç”¨ã€‚</p></div><p>å½“å‰æˆ‘çš„æ–‡ä»¶å¤¹åå­—æ˜¯ æµ‹è¯•ï¼Œ å¦‚å›¾ï¼š<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202403022118314.png" alt="image.png"></p><h3 id="ä¿®æ”¹ç³»ç»Ÿå®šä¹‰çš„è·¯å¾„"><a href="#ä¿®æ”¹ç³»ç»Ÿå®šä¹‰çš„è·¯å¾„" class="headerlink" title="ä¿®æ”¹ç³»ç»Ÿå®šä¹‰çš„è·¯å¾„"></a>ä¿®æ”¹ç³»ç»Ÿå®šä¹‰çš„è·¯å¾„</h3><p>æ‰“å¼€æ³¨å†Œè¡¨ç¼–è¾‘å™¨ï¼Œå®šä½åˆ° <code>è®¡ç®—æœº\HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\ProfileList\</code> ä¸‹é¢ä¸€ä¸ªç”¨æˆ·å¯¹åº”ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œæ‰¾åˆ°è‡ªå·±çš„é¡¹ï¼Œä¿®æ”¹ <code>ProfileImagePath</code> çš„å€¼<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202403022122885.png" alt="image.png"></p><p>æ³¨é”€å†æ¬¡ç™»å½•ï¼Œä¼šå‡ºç°æ­£åœ¨å‡†å¤‡ windows çš„æç¤ºï¼Œè¿™ä¸ªæ˜¯æ­£å¸¸çš„ã€‚è¿›å…¥æ¡Œé¢ï¼Œå‡ºç°ä¸‹é¢çš„æç¤ºï¼Œç‚¹å‡»å…³é—­ (è¿™ä¸€æ­¥ä¹Ÿå¯ä»¥åœ¨ pe ä¸‹å®Œæˆ)<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202403022125931.png" alt="image.png"></p><p>ç°åœ¨å¯ä»¥æŠŠç”¨æˆ·æ–‡ä»¶å¤¹è¿›è¡Œé‡å‘½åæ“ä½œï¼Œé‡å‘½ååå†æ¬¡æ³¨é”€é‡æ–°ç™»å½•ã€‚è¿™ä¸ªæ—¶å€™å·²ç»å¯ä»¥æ­£å¸¸è¿›å…¥æ¡Œé¢äº†ã€‚</p><h3 id="ä¿®æ”¹ç¯å¢ƒå˜é‡"><a href="#ä¿®æ”¹ç¯å¢ƒå˜é‡" class="headerlink" title="ä¿®æ”¹ç¯å¢ƒå˜é‡"></a>ä¿®æ”¹ç¯å¢ƒå˜é‡</h3><p>åœ¨ ç³»ç»Ÿå±æ€§ â€“ é«˜çº§ â€“ ç¯å¢ƒå˜é‡ é‡Œå°†æ²¡æœ‰æ›´æ–°çš„é…ç½®è¿›è¡Œæ›´æ–°ã€‚</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202403022129458.png" alt="image.png"></p>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows </tag>
            
            <tag> é…ç½®è®°å½• </tag>
            
            <tag> æ³¨å†Œè¡¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é€šè¿‡dockerå®¹å™¨æŸ¥çœ‹runå‘½ä»¤</title>
      <link href="/posts/lt41mupw/"/>
      <url>/posts/lt41mupw/</url>
      
        <content type="html"><![CDATA[<p>å…¬å¸æœ‰ä¸€å°æœåŠ¡å™¨ä¸Šè¿è¡Œç€ä¸€ä¸ªæœåŠ¡ï¼Œé€šè¿‡ <code>docker start</code> å¯åŠ¨ï¼Œå·²ç»æ²¡æœ‰æ–‡æ¡£è®°å½•å¦‚ä½•æ­å»ºçš„äº†ã€‚ç°åœ¨éœ€è¦è¿ç§»ï¼Œè®°å½•ä¸€ä¸‹è·å– docker run å‘½ä»¤çš„æ–¹æ³•</p><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">é€šè¿‡æ¨¡ç‰ˆå¤„ç† docker inspect çš„æ•°æ®æ¥è·å–</button><button type="button" class="tab">ä½¿ç”¨ runlike æ¥è·å–</button></div><div class="tab-contents"><div class="tab-item-content active"><p>æ¨¡ç‰ˆæ–‡ä»¶æ¥è‡ª<a href="https://gist.githubusercontent.com/efrecon/8ce9c75d518b6eb863f667442d7bc679/raw/run.tpl">https://gist.githubusercontent.com/efrecon/8ce9c75d518b6eb863f667442d7bc679/raw/run.tpl</a></p><p>å‡è®¾å®¹å™¨åæ˜¯ mysqlï¼Œ å‘½ä»¤åé¢å¯ä»¥è·Ÿå®¹å™¨åæˆ–è€…å®¹å™¨ idã€‚å‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br></pre></td><td class="code"><pre><span class="line">docker inspect --format <span class="string">&#x27;docker run \</span></span><br><span class="line"><span class="string">  --name &#123;&#123;printf &quot;%q&quot; .Name&#125;&#125; \</span></span><br><span class="line"><span class="string">    &#123;&#123;- with .HostConfig&#125;&#125;</span></span><br><span class="line"><span class="string">        &#123;&#123;- if .Privileged&#125;&#125;</span></span><br><span class="line"><span class="string">  --privileged \</span></span><br><span class="line"><span class="string">        &#123;&#123;- end&#125;&#125;</span></span><br><span class="line"><span class="string">        &#123;&#123;- if .AutoRemove&#125;&#125;</span></span><br><span class="line"><span class="string">  --rm \</span></span><br><span class="line"><span class="string">        &#123;&#123;- end&#125;&#125;</span></span><br><span class="line"><span class="string">        &#123;&#123;- if .Runtime&#125;&#125;</span></span><br><span class="line"><span class="string">  --runtime &#123;&#123;printf &quot;%q&quot; .Runtime&#125;&#125; \</span></span><br><span class="line"><span class="string">        &#123;&#123;- end&#125;&#125;</span></span><br><span class="line"><span class="string">        &#123;&#123;- range $b := .Binds&#125;&#125;</span></span><br><span class="line"><span class="string">  --volume &#123;&#123;printf &quot;%q&quot; $b&#125;&#125; \</span></span><br><span class="line"><span class="string">        &#123;&#123;- end&#125;&#125;</span></span><br><span class="line"><span class="string">        &#123;&#123;- range $v := .VolumesFrom&#125;&#125;</span></span><br><span class="line"><span class="string">  --volumes-from &#123;&#123;printf &quot;%q&quot; $v&#125;&#125; \</span></span><br><span class="line"><span class="string">        &#123;&#123;- end&#125;&#125;</span></span><br><span class="line"><span class="string">        &#123;&#123;- range $l := .Links&#125;&#125;</span></span><br><span class="line"><span class="string">  --link &#123;&#123;printf &quot;%q&quot; $l&#125;&#125; \</span></span><br><span class="line"><span class="string">        &#123;&#123;- end&#125;&#125;</span></span><br><span class="line"><span class="string">        &#123;&#123;- if index . &quot;Mounts&quot;&#125;&#125;</span></span><br><span class="line"><span class="string">            &#123;&#123;- range $m := .Mounts&#125;&#125;</span></span><br><span class="line"><span class="string">  --mount type=&#123;&#123;.Type&#125;&#125;</span></span><br><span class="line"><span class="string">                &#123;&#123;- if $s := index $m &quot;Source&quot;&#125;&#125;,source=&#123;&#123;$s&#125;&#125;&#123;&#123;- end&#125;&#125;</span></span><br><span class="line"><span class="string">                &#123;&#123;- if $t := index $m &quot;Target&quot;&#125;&#125;,destination=&#123;&#123;$t&#125;&#125;&#123;&#123;- end&#125;&#125;</span></span><br><span class="line"><span class="string">                &#123;&#123;- if index $m &quot;ReadOnly&quot;&#125;&#125;,readonly&#123;&#123;- end&#125;&#125;</span></span><br><span class="line"><span class="string">                &#123;&#123;- if $vo := index $m &quot;VolumeOptions&quot;&#125;&#125;</span></span><br><span class="line"><span class="string">                    &#123;&#123;- range $i, $v := $vo.Labels&#125;&#125;</span></span><br><span class="line"><span class="string">                        &#123;&#123;- printf &quot;,volume-label=%s=%s&quot; $i $v&#125;&#125;</span></span><br><span class="line"><span class="string">                    &#123;&#123;- end&#125;&#125;</span></span><br><span class="line"><span class="string">                    &#123;&#123;- if $dc := index $vo &quot;DriverConfig&quot; &#125;&#125;</span></span><br><span class="line"><span class="string">                        &#123;&#123;- if $n := index $dc &quot;Name&quot; &#125;&#125;</span></span><br><span class="line"><span class="string">                            &#123;&#123;- printf &quot;,volume-driver=%s&quot; $n&#125;&#125;</span></span><br><span class="line"><span class="string">                        &#123;&#123;- end&#125;&#125;</span></span><br><span class="line"><span class="string">                        &#123;&#123;- range $i, $v := $dc.Options&#125;&#125;</span></span><br><span class="line"><span class="string">                            &#123;&#123;- printf &quot;,volume-opt=%s=%s&quot; $i $v&#125;&#125;</span></span><br><span class="line"><span class="string">                        &#123;&#123;- end&#125;&#125;</span></span><br><span class="line"><span class="string">                    &#123;&#123;- end&#125;&#125;</span></span><br><span class="line"><span class="string">                &#123;&#123;- end&#125;&#125;</span></span><br><span class="line"><span class="string">                &#123;&#123;- if $bo := index $m &quot;BindOptions&quot;&#125;&#125;</span></span><br><span class="line"><span class="string">                    &#123;&#123;- if $p := index $bo &quot;Propagation&quot; &#125;&#125;</span></span><br><span class="line"><span class="string">                        &#123;&#123;- printf &quot;,bind-propagation=%s&quot; $p&#125;&#125;</span></span><br><span class="line"><span class="string">                    &#123;&#123;- end&#125;&#125;</span></span><br><span class="line"><span class="string">                &#123;&#123;- end&#125;&#125; \</span></span><br><span class="line"><span class="string">            &#123;&#123;- end&#125;&#125;</span></span><br><span class="line"><span class="string">        &#123;&#123;- end&#125;&#125;</span></span><br><span class="line"><span class="string">        &#123;&#123;- if .PublishAllPorts&#125;&#125;</span></span><br><span class="line"><span class="string">  --publish-all \</span></span><br><span class="line"><span class="string">        &#123;&#123;- end&#125;&#125;</span></span><br><span class="line"><span class="string">        &#123;&#123;- if .UTSMode&#125;&#125;</span></span><br><span class="line"><span class="string">  --uts &#123;&#123;printf &quot;%q&quot; .UTSMode&#125;&#125; \</span></span><br><span class="line"><span class="string">        &#123;&#123;- end&#125;&#125;</span></span><br><span class="line"><span class="string">        &#123;&#123;- with .LogConfig&#125;&#125;</span></span><br><span class="line"><span class="string">  --log-driver &#123;&#123;printf &quot;%q&quot; .Type&#125;&#125; \</span></span><br><span class="line"><span class="string">            &#123;&#123;- range $o, $v := .Config&#125;&#125;</span></span><br><span class="line"><span class="string">  --log-opt &#123;&#123;$o&#125;&#125;=&#123;&#123;printf &quot;%q&quot; $v&#125;&#125; \</span></span><br><span class="line"><span class="string">            &#123;&#123;- end&#125;&#125;</span></span><br><span class="line"><span class="string">        &#123;&#123;- end&#125;&#125;</span></span><br><span class="line"><span class="string">        &#123;&#123;- with .RestartPolicy&#125;&#125;</span></span><br><span class="line"><span class="string">  --restart &quot;&#123;&#123;.Name -&#125;&#125;</span></span><br><span class="line"><span class="string">            &#123;&#123;- if eq .Name &quot;on-failure&quot;&#125;&#125;:&#123;&#123;.MaximumRetryCount&#125;&#125;</span></span><br><span class="line"><span class="string">            &#123;&#123;- end&#125;&#125;&quot; \</span></span><br><span class="line"><span class="string">        &#123;&#123;- end&#125;&#125;</span></span><br><span class="line"><span class="string">        &#123;&#123;- range $e := .ExtraHosts&#125;&#125;</span></span><br><span class="line"><span class="string">  --add-host &#123;&#123;printf &quot;%q&quot; $e&#125;&#125; \</span></span><br><span class="line"><span class="string">        &#123;&#123;- end&#125;&#125;</span></span><br><span class="line"><span class="string">        &#123;&#123;- range $v := .CapAdd&#125;&#125;</span></span><br><span class="line"><span class="string">  --cap-add &#123;&#123;printf &quot;%q&quot; $v&#125;&#125; \</span></span><br><span class="line"><span class="string">        &#123;&#123;- end&#125;&#125;</span></span><br><span class="line"><span class="string">        &#123;&#123;- range $v := .CapDrop&#125;&#125;</span></span><br><span class="line"><span class="string">  --cap-drop &#123;&#123;printf &quot;%q&quot; $v&#125;&#125; \</span></span><br><span class="line"><span class="string">        &#123;&#123;- end&#125;&#125;</span></span><br><span class="line"><span class="string">        &#123;&#123;- range $d := .Devices&#125;&#125;</span></span><br><span class="line"><span class="string">  --device &#123;&#123;printf &quot;%q&quot; (index $d).PathOnHost&#125;&#125;:&#123;&#123;printf &quot;%q&quot; (index $d).PathInContainer&#125;&#125;:&#123;&#123;(index $d).CgroupPermissions&#125;&#125; \</span></span><br><span class="line"><span class="string">        &#123;&#123;- end&#125;&#125;</span></span><br><span class="line"><span class="string">    &#123;&#123;- end&#125;&#125;</span></span><br><span class="line"><span class="string">    &#123;&#123;- with .NetworkSettings -&#125;&#125;</span></span><br><span class="line"><span class="string">        &#123;&#123;- range $p, $conf := .Ports&#125;&#125;</span></span><br><span class="line"><span class="string">            &#123;&#123;- with $conf&#125;&#125;</span></span><br><span class="line"><span class="string">  --publish &quot;</span></span><br><span class="line"><span class="string">                &#123;&#123;- if $h := (index $conf 0).HostIp&#125;&#125;&#123;&#123;$h&#125;&#125;:</span></span><br><span class="line"><span class="string">                &#123;&#123;- end&#125;&#125;</span></span><br><span class="line"><span class="string">                &#123;&#123;- (index $conf 0).HostPort&#125;&#125;:&#123;&#123;$p&#125;&#125;&quot; \</span></span><br><span class="line"><span class="string">            &#123;&#123;- end&#125;&#125;</span></span><br><span class="line"><span class="string">        &#123;&#123;- end&#125;&#125;</span></span><br><span class="line"><span class="string">        &#123;&#123;- range $n, $conf := .Networks&#125;&#125;</span></span><br><span class="line"><span class="string">            &#123;&#123;- with $conf&#125;&#125;</span></span><br><span class="line"><span class="string">  --network &#123;&#123;printf &quot;%q&quot; $n&#125;&#125; \</span></span><br><span class="line"><span class="string">                &#123;&#123;- range $a := $conf.Aliases&#125;&#125;</span></span><br><span class="line"><span class="string">  --network-alias &#123;&#123;printf &quot;%q&quot; $a&#125;&#125; \</span></span><br><span class="line"><span class="string">                &#123;&#123;- end&#125;&#125;</span></span><br><span class="line"><span class="string">            &#123;&#123;- end&#125;&#125;</span></span><br><span class="line"><span class="string">        &#123;&#123;- end&#125;&#125;</span></span><br><span class="line"><span class="string">    &#123;&#123;- end&#125;&#125;</span></span><br><span class="line"><span class="string">    &#123;&#123;- with .Config&#125;&#125;</span></span><br><span class="line"><span class="string">        &#123;&#123;- if .Hostname&#125;&#125;</span></span><br><span class="line"><span class="string">  --hostname &#123;&#123;printf &quot;%q&quot; .Hostname&#125;&#125; \</span></span><br><span class="line"><span class="string">        &#123;&#123;- end&#125;&#125;</span></span><br><span class="line"><span class="string">        &#123;&#123;- if .Domainname&#125;&#125;</span></span><br><span class="line"><span class="string">  --domainname &#123;&#123;printf &quot;%q&quot; .Domainname&#125;&#125; \</span></span><br><span class="line"><span class="string">        &#123;&#123;- end&#125;&#125;</span></span><br><span class="line"><span class="string">        &#123;&#123;- if index . &quot;ExposedPorts&quot;&#125;&#125;</span></span><br><span class="line"><span class="string">        &#123;&#123;- range $p, $conf := .ExposedPorts&#125;&#125;</span></span><br><span class="line"><span class="string">  --expose &#123;&#123;printf &quot;%q&quot; $p&#125;&#125; \</span></span><br><span class="line"><span class="string">        &#123;&#123;- end&#125;&#125;</span></span><br><span class="line"><span class="string">        &#123;&#123;- end&#125;&#125;</span></span><br><span class="line"><span class="string">        &#123;&#123;- if .User&#125;&#125;</span></span><br><span class="line"><span class="string">  --user &#123;&#123;printf &quot;%q&quot; .User&#125;&#125; \</span></span><br><span class="line"><span class="string">        &#123;&#123;- end&#125;&#125;</span></span><br><span class="line"><span class="string">        &#123;&#123;- range $e := .Env&#125;&#125;</span></span><br><span class="line"><span class="string">  --env &#123;&#123;printf &quot;%q&quot; $e&#125;&#125; \</span></span><br><span class="line"><span class="string">        &#123;&#123;- end&#125;&#125;</span></span><br><span class="line"><span class="string">        &#123;&#123;- range $l, $v := .Labels&#125;&#125;</span></span><br><span class="line"><span class="string">  --label &#123;&#123;printf &quot;%q&quot; $l&#125;&#125;=&#123;&#123;printf &quot;%q&quot; $v&#125;&#125; \</span></span><br><span class="line"><span class="string">        &#123;&#123;- end&#125;&#125;</span></span><br><span class="line"><span class="string">    &#123;&#123;- if not (or .AttachStdin  (or .AttachStdout .AttachStderr))&#125;&#125;</span></span><br><span class="line"><span class="string">  --detach \</span></span><br><span class="line"><span class="string">    &#123;&#123;- end&#125;&#125;</span></span><br><span class="line"><span class="string">    &#123;&#123;- if .AttachStdin&#125;&#125;</span></span><br><span class="line"><span class="string">  --attach stdin \</span></span><br><span class="line"><span class="string">    &#123;&#123;- end&#125;&#125;</span></span><br><span class="line"><span class="string">    &#123;&#123;- if .AttachStdout&#125;&#125;</span></span><br><span class="line"><span class="string">  --attach stdout \</span></span><br><span class="line"><span class="string">    &#123;&#123;- end&#125;&#125;</span></span><br><span class="line"><span class="string">    &#123;&#123;- if .AttachStderr&#125;&#125;</span></span><br><span class="line"><span class="string">  --attach stderr \</span></span><br><span class="line"><span class="string">    &#123;&#123;- end&#125;&#125;</span></span><br><span class="line"><span class="string">    &#123;&#123;- if .Tty&#125;&#125;</span></span><br><span class="line"><span class="string">  --tty \</span></span><br><span class="line"><span class="string">    &#123;&#123;- end&#125;&#125;</span></span><br><span class="line"><span class="string">    &#123;&#123;- if .OpenStdin&#125;&#125;</span></span><br><span class="line"><span class="string">  --interactive \</span></span><br><span class="line"><span class="string">    &#123;&#123;- end&#125;&#125;</span></span><br><span class="line"><span class="string">    &#123;&#123;- if .Entrypoint&#125;&#125;</span></span><br><span class="line"><span class="string">&#123;&#123;- /* Since the entry point cannot be overridden from the command line with an array of size over 1,</span></span><br><span class="line"><span class="string">       we are fine assuming the default value in such a case. */ -&#125;&#125;</span></span><br><span class="line"><span class="string">        &#123;&#123;- if eq (len .Entrypoint) 1 &#125;&#125;</span></span><br><span class="line"><span class="string">  --entrypoint &quot;</span></span><br><span class="line"><span class="string">            &#123;&#123;- range $i, $v := .Entrypoint&#125;&#125;</span></span><br><span class="line"><span class="string">                &#123;&#123;- if $i&#125;&#125; &#123;&#123;end&#125;&#125;</span></span><br><span class="line"><span class="string">                &#123;&#123;- $v&#125;&#125;</span></span><br><span class="line"><span class="string">            &#123;&#123;- end&#125;&#125;&quot; \</span></span><br><span class="line"><span class="string">        &#123;&#123;- end&#125;&#125;</span></span><br><span class="line"><span class="string">    &#123;&#123;- end&#125;&#125;</span></span><br><span class="line"><span class="string">  &#123;&#123;printf &quot;%q&quot; .Image&#125;&#125; \</span></span><br><span class="line"><span class="string">  &#123;&#123;range .Cmd&#125;&#125;&#123;&#123;printf &quot;%q &quot; .&#125;&#125;&#123;&#123;- end&#125;&#125;</span></span><br><span class="line"><span class="string">&#123;&#123;- end&#125;&#125;&#x27;</span> \</span><br><span class="line">mysql</span><br></pre></td></tr></table></figure><p>å¾—åˆ°çš„ç»“æœå’ŒåŸå§‹çš„ä¸ä¸€æ ·ï¼Œä½†æ˜¯å¤§å·®ä¸å·®äº†ã€‚</p></div><div class="tab-item-content"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker run --<span class="built_in">rm</span> -v /var/run/docker.sock:/var/run/docker.sock:ro assaflavie/runlike mysql</span><br><span class="line"></span><br><span class="line"><span class="comment"># æˆ–è€…ç”¨è¿™ä¸ª</span></span><br><span class="line">docker run --<span class="built_in">rm</span> -v /var/run/docker.sock:/var/run/docker.sock:ro cucker/get_command_4_run_container mysql</span><br></pre></td></tr></table></figure><p>runlike çš„ç»“æœä¹Ÿæ˜¯è¿‘ä¼¼çš„</p></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div><h2 id="æˆ–è€…ä½¿ç”¨-get-command-4-run-container"><a href="#æˆ–è€…ä½¿ç”¨-get-command-4-run-container" class="headerlink" title="æˆ–è€…ä½¿ç”¨ get_command_4_run_container"></a>æˆ–è€…ä½¿ç”¨ get_command_4_run_container</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --<span class="built_in">rm</span> -v /var/run/docker.sock:/var/run/docker.sock cucker/get_command_4_run_container mysql</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
            <tag> å¸¸ç”¨æ“ä½œ </tag>
            
            <tag> å®¹å™¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Grafana ç›‘æ§é¢æ¿é…ç½®</title>
      <link href="/posts/lswszwbz/"/>
      <url>/posts/lswszwbz/</url>
      
        <content type="html"><![CDATA[<h2 id="å®‰è£…-grafana"><a href="#å®‰è£…-grafana" class="headerlink" title="å®‰è£… grafana"></a>å®‰è£… grafana</h2><p>ossï¼šå¼€æºç‰ˆæœ¬</p><p>enterprise: å•†ä¸šç‰ˆæœ¬</p><p><a href="https://grafana.com/grafana/download?pg=get&amp;plcmt=selfmanaged-box1-cta1&amp;edition=oss">https://grafana.com/grafana/download?pg=get&amp;plcmt=selfmanaged-box1-cta1&amp;edition=oss</a></p><h2 id="æ·»åŠ æ•°æ®æº"><a href="#æ·»åŠ æ•°æ®æº" class="headerlink" title="æ·»åŠ æ•°æ®æº"></a>æ·»åŠ æ•°æ®æº</h2><p>ä»¥ grafana 10.3.3 ä¸ºä¾‹ï¼Œ åœ¨ connections â€“&gt; Data sources ä¸­æ–°å¢ï¼š</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202402221351583.png" alt="image.png"></p><h2 id="é¢æ¿é…ç½®"><a href="#é¢æ¿é…ç½®" class="headerlink" title="é¢æ¿é…ç½®"></a>é¢æ¿é…ç½®</h2><p>å¯ä»¥æ‰‹åŠ¨é…ç½®ï¼Œä¹Ÿå¯ä»¥åœ¨ grafana å®˜ç½‘ä¸‹è½½åˆ«äººé…ç½®å¥½çš„æ¨¡æ¿ï¼š<a href="https://grafana.com/grafana/dashboards/">https://grafana.com/grafana/dashboards/</a>, å¤åˆ¶ ID æˆ–è€…ä¸‹è½½ json æ–‡ä»¶åˆ°æœ¬åœ°<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202402221354043.png" alt="image.png"></p><p>ç„¶ååœ¨é¢æ¿ä¸Šé¢ï¼Œç‚¹å‡» + ï¼Œ é€‰æ‹© import dashboard ä½¿ç”¨ json æ–‡ä»¶å¯¼å…¥æˆ–è€…ç›´æ¥è¾“å…¥é¢æ¿ id è¿›è¡Œå¯¼å…¥ã€‚</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202402221356021.png" alt="image.png"></p><p>å¯¼å…¥åä¾¿èƒ½çœ‹åˆ°åŸºç¡€çš„å›¾å½¢ã€‚</p><h2 id="åšå˜é‡ç­›é€‰"><a href="#åšå˜é‡ç­›é€‰" class="headerlink" title="åšå˜é‡ç­›é€‰"></a>åšå˜é‡ç­›é€‰</h2><p>æ¯”å¦‚æˆ‘ä»¬çš„ç›‘æ§ä¼šåŒºåˆ†ç¯å¢ƒï¼Œ æ¯”å¦‚å¼€å‘ç¯å¢ƒ devï¼Œç”Ÿäº§ç¯å¢ƒ prodï¼Œ ç°åœ¨éœ€è¦åœ¨ grafana çš„é¢æ¿ä¸Šåšä¸€ä¸ªç­›é€‰æ¡†ï¼Œè¿™é‡Œæ˜¯åŸå§‹çš„æ•°æ®ï¼šæ¯”å¦‚æˆ‘ä»¬éœ€è¦å– env çš„å€¼<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202402221739352.png" alt="image.png"></p><p>åœ¨é¢æ¿çš„è®¾ç½® â€“ å˜é‡ä¸­ï¼Œ æ·»åŠ ä¸€ä¸ªå˜é‡ï¼Œ å˜é‡åå¯ä»¥è‡ªå®šä¹‰ï¼Œ åœ¨æ­¤é¢æ¿çš„æŸ¥è¯¢è¯­å¥ä¸­å¯ä»¥è°ƒç”¨ã€‚ æŸ¥è¯¢é€‰é¡¹å– Label valuesï¼Œ è¦å–çš„æ ‡ç­¾ä¸º envï¼Œ è¦æŸ¥è¯¢çš„è¯­å¥ä¸º node_uname_infoï¼ˆé€‰ä¸€ä¸ªè¦†ç›–é¢æœ€å¹¿çš„è¯­å¥ï¼‰</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202402221743652.png" alt="image.png"></p><p>ç„¶å Dashboard çš„å³ä¸Šè§’å°±æœ‰äº†è¿™ä¸ªåŠ¨æ€ç­›é€‰æ¡†ã€‚<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202402221744503.png" alt="image.png"></p><h3 id="åˆ¶ä½œç¬¬äºŒä¸ªé€‰æ¡†"><a href="#åˆ¶ä½œç¬¬äºŒä¸ªé€‰æ¡†" class="headerlink" title="åˆ¶ä½œç¬¬äºŒä¸ªé€‰æ¡†"></a>åˆ¶ä½œç¬¬äºŒä¸ªé€‰æ¡†</h3><p>æ¯”å¦‚ç¬¬ä¸€ä¸ªé€‰æ¡†æ˜¯ç¯å¢ƒï¼Œç¬¬äºŒä¸ªé€‰æ¡†æ˜¯é¡¹ç›®ï¼Œç¬¬ä¸‰ä¸ªé€‰æ¡†æ˜¯æœºå™¨ ip åœ°å€ã€‚</p><p>å¦‚ä¸‹æ˜¯æ ¹æ® env é€‰æ‹© projectï¼š<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202402221821000.png" alt="image.png"></p><p>å¦‚ä¸‹æ˜¯æ ¹æ® env å’Œ project é€‰æ‹© ipï¼š</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202402221824179.png" alt="image.png"></p><p>æ‰€æœ‰å˜é‡ï¼š<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202402221842109.png" alt="image.png"></p><p>æ•ˆæœå¦‚å›¾ï¼Œé€‰æ‹© dev ç¯å¢ƒè‡ªåŠ¨å‡ºç° ip 198ï¼Œ é€‰æ‹© prod è‡ªåŠ¨å‡ºç° ip 199ï¼š<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202402221825070.png" alt="image.png"></p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202402221825184.png" alt="image.png"></p><p>é¢æ¿ä¸­çš„è°ƒç”¨æ–¹å¼ï¼š</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202402221840568.png" alt="image.png"></p><p>æ³¨æ„ï¼šä¸Šé¢æŸ¥è¯¢ CPU ä½¿ç”¨ç‡çš„ promsql è¯­å¥ä¸å¤ªå¥½ï¼Œä¼šå‡ºç°è´Ÿæ•°ï¼Œåº”è¯¥ä¿®æ”¹ä¸ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1 - (<span class="built_in">sum</span>(increase(node_cpu_seconds_total&#123;ip=<span class="string">&quot;<span class="variable">$ip</span>&quot;</span>, mode=<span class="string">&quot;idle&quot;</span>&#125;[1m])) by (instance) / <span class="built_in">sum</span>(increase(node_cpu_seconds_total&#123;ip=<span class="string">&quot;<span class="variable">$ip</span>&quot;</span>&#125;[1m])) by (instance))</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç›‘æ§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
            <tag> prometheus </tag>
            
            <tag> grafana </tag>
            
            <tag> ç›‘æ§ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Django RestFramework ä½¿ç”¨ JWT è®¤è¯</title>
      <link href="/posts/lsbj20sj/"/>
      <url>/posts/lsbj20sj/</url>
      
        <content type="html"><![CDATA[<h2 id="JWT-çš„ä¼˜ç‚¹"><a href="#JWT-çš„ä¼˜ç‚¹" class="headerlink" title="JWT çš„ä¼˜ç‚¹"></a>JWT çš„ä¼˜ç‚¹</h2><p>ä¼˜ç‚¹ï¼šæ— çŠ¶æ€ï¼ŒæœåŠ¡ç«¯ä¸ä¿å­˜ token<br>ç¼ºç‚¹ï¼šç”Ÿæˆçš„ token åœ¨æœ‰æ•ˆæœŸå†…ä¸€ç›´æœ‰æ•ˆï¼Œæ— è®ºç”¨æˆ·æ³¨é”€ã€ä¿®æ”¹å¯†ç ã€‚(å¯ä»¥é€šè¿‡å­˜ redisï¼Œé€šè¿‡ä»£ç è¿›è¡Œåˆ é™¤ redis é‡Œçš„ token è§£å†³ã€‚)</p><h2 id="å¼€å§‹ä½¿ç”¨"><a href="#å¼€å§‹ä½¿ç”¨" class="headerlink" title="å¼€å§‹ä½¿ç”¨"></a>å¼€å§‹ä½¿ç”¨</h2><h3 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><p>setting.py é‡Œé¢è®¾ç½®é»˜è®¤å€¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">REST_FRAMEWORK = &#123;</span><br><span class="line"><span class="string">&#x27;DEFAULT_AUTHENTICATION_CLASSES&#x27;</span>: (</span><br><span class="line">        <span class="string">&#x27;rest_framework_jwt.authentication.JSONWebTokenAuthentication&#x27;</span>,</span><br><span class="line">    ),</span><br><span class="line">&#125;</span><br><span class="line">JWT_AUTH = &#123;</span><br><span class="line">    <span class="string">&#x27;JWT_EXPIRATION_DELTA&#x27;</span>: datetime.timedelta(days=<span class="number">7</span>),  <span class="comment"># Token è¿‡æœŸæ—¶é—´ä¸ºä¸€å‘¨</span></span><br><span class="line">    <span class="string">&#x27;JWT_AUTH_HEADER_PREFIX&#x27;</span>: <span class="string">&#x27;JWT&#x27;</span>,  <span class="comment"># Tokençš„å¤´ä¸ºï¼šJWT</span></span><br><span class="line">    <span class="string">&#x27;JWT_ALLOW_REFRESH&#x27;</span>: <span class="literal">False</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„ DEFAULT_AUTHENTICATION_CLASSES æ˜¯é»˜è®¤è®¾ç½®ï¼Œä¹Ÿå¯ä»¥ç»™ç±»è§†å›¾è‡ªå®šä¹‰<br>views.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">XxxView</span>(<span class="title class_ inherited__">APIView</span>):</span><br><span class="line">    <span class="comment"># ä¸ç”¨è®¤è¯</span></span><br><span class="line">    <span class="comment"># authentication_classes = []</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># åŸºäºjwtéªŒè¯</span></span><br><span class="line">    <span class="comment"># authentication_classes = [JSONWebTokenAuthentication]</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># åªæœ‰ç™»å½•æ‰èƒ½è®¿é—®</span></span><br><span class="line">    <span class="comment"># permission_classes = [IsAuthenticated]</span></span><br></pre></td></tr></table></figure><p>authentication_classes &#x3D; [JSONWebTokenAuthentication]</p><p>urls.py é‡Œé¢é…ç½®ç”Ÿæˆ token çš„è·¯ç”±</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework_jwt.views <span class="keyword">import</span> obtain_jwt_token</span><br><span class="line">path(<span class="string">&#x27;api-token-auth/&#x27;</span>, obtain_jwt_token),</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><p>å…ˆè®¿é—® api-token-auth æ¥å£ï¼Œè¿™ä¸ªæ¥å£åªèƒ½é€šè¿‡ POST è®¿é—®ï¼Œå¸¦ä¸Šç”¨æˆ·åå’Œå¯†ç ï¼Œè®¤è¯æˆåŠŸåä¼šç”Ÿæˆä¸€ä¸ª token ç±»ä¼¼äºï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoxLCJ1c2VybmFtZSI6Iml1eHQiLCJleHAiOjE3MDc5MDI5MTUsImVtYWlsIjoiaXV4dEBxcS5jb20ifQ.tHc3koO95mEh_HKUc3QNge0KwBYwoRz4n4bltq4xadg&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>æ‹¿ç€è¿™ä¸ª token å»è¯·æ±‚æ¥å£ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl --location <span class="string">&#x27;http://localhost:8000/jwttest/carts/&#x27;</span> \</span><br><span class="line">--header <span class="string">&#x27;Authorization: JWT  eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoxLCJ1c2VybmFtZSI6Iml1eHQiLCJleHAiOjE3MDc5MDI5MTUsImVtYWlsIjoiaXV4dEBxcS5jb20ifQ.tHc3koO95mEh_HKUc3QNge0KwBYwoRz4n4bltq4xadg&#x27;</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å‰ç¼€è®¾ç½®çš„æ˜¯ JWTï¼Œ æ‰€ä»¥åœ¨è¯·æ±‚æ—¶åœ¨ Header é‡Œå¸¦ä¸Š <code>JWT  </code> å³å¯</p><h2 id="ä¿®æ”¹é»˜è®¤è¿”å›å€¼"><a href="#ä¿®æ”¹é»˜è®¤è¿”å›å€¼" class="headerlink" title="ä¿®æ”¹é»˜è®¤è¿”å›å€¼"></a>ä¿®æ”¹é»˜è®¤è¿”å›å€¼</h2><p>é»˜è®¤çš„è¿”å›å€¼ä»…æœ‰ tokenï¼Œé€šè¿‡ä¿®æ”¹è¯¥è§†å›¾çš„è¿”å›å€¼å¯ä»¥å®Œæˆæˆ‘ä»¬çš„éœ€æ±‚ã€‚åœ¨åº”ç”¨ä¸­æ–°å»ºä¸€ä¸ª utils.py æ–‡ä»¶ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">jwt_response_payload_handler</span>(<span class="params">token, user=<span class="literal">None</span>, request=<span class="literal">None</span></span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="string">&#x27;token&#x27;</span>: token,</span><br><span class="line">        <span class="string">&#x27;id&#x27;</span>: user.<span class="built_in">id</span>,</span><br><span class="line">        <span class="string">&#x27;username&#x27;</span>: user.username,</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>åœ¨ settings.py é‡Œé¢å¼•ç”¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">JWT_AUTH = &#123;</span><br><span class="line">    <span class="string">&#x27;JWT_EXPIRATION_DELTA&#x27;</span>: datetime.timedelta(days=<span class="number">7</span>),</span><br><span class="line">    <span class="string">&#x27;JWT_ALLOW_REFRESH&#x27;</span>: <span class="literal">False</span>,</span><br><span class="line">    <span class="string">&#x27;JWT_AUTH_HEADER_PREFIX&#x27;</span>: <span class="string">&#x27;JWT&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;JWT_RESPONSE_PAYLOAD_HANDLER&#x27;</span>: <span class="string">&#x27;&lt; appåå­— &gt;.utils.jwt_response_payload_handler&#x27;</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·è·å– token çš„æ—¶å€™è¿”å›ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoxLCJ1c2VybmFtZSI6Iml1eHQiLCJleHAiOjE3MDc5MDMwODMsImVtYWlsIjoiaXV4dEBxcS5jb20ifQ.YR0X8-b1gEPnp-xZd0wavszWVwBQVBaCnd4_LDqnGn8&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;iuxt&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h2 id="JWT-åˆ¤æ–­æƒé™"><a href="#JWT-åˆ¤æ–­æƒé™" class="headerlink" title="JWT åˆ¤æ–­æƒé™"></a>JWT åˆ¤æ–­æƒé™</h2><p>permissions.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework_jwt.authentication <span class="keyword">import</span> jwt_decode_handler</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">IsOwnOrReadOnly</span>(permissions.BasePermission):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">has_object_permission</span>(<span class="params">self, request, view, obj</span>):</span><br><span class="line">        <span class="comment"># if request.method in permissions.SAFE_METHODS:</span></span><br><span class="line">        <span class="comment">#     return True</span></span><br><span class="line"></span><br><span class="line">        token = request.META.get(<span class="string">&#x27;HTTP_AUTHORIZATION&#x27;</span>)[<span class="number">5</span>:]  <span class="comment"># ä» header ä¸­è·å– token</span></span><br><span class="line">        token_user = jwt_decode_handler(token)  <span class="comment"># è§£æå‡ºæ¥</span></span><br><span class="line">        <span class="keyword">if</span> token_user:</span><br><span class="line">            <span class="keyword">return</span> obj.user.<span class="built_in">id</span> == token_user.get(<span class="string">&#x27;user_id&#x27;</span>)  <span class="comment"># è¯æ˜ å½“å‰jwtéªŒè¯çš„ç”¨æˆ·å°±æ˜¯æ•°æ®åˆ›å»ºè€…</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure><p>åœ¨ç±»è§†å›¾é‡Œå®šä¹‰æƒé™</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> .permissions <span class="keyword">import</span> IsOwnOrReadOnly</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GameDetail</span>(generics.RetrieveUpdateDestroyAPIView):</span><br><span class="line">    queryset = Game.objects.<span class="built_in">all</span>()</span><br><span class="line">    serializer_class = GameSerializer</span><br><span class="line">    permission_classes = [IsAuthenticated, IsOwnOrReadOnly]</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> django </tag>
            
            <tag> Python </tag>
            
            <tag> drf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>fail2bané…åˆcloudflare cdnä½¿ç”¨</title>
      <link href="/posts/lrt00szc/"/>
      <url>/posts/lrt00szc/</url>
      
        <content type="html"><![CDATA[<p>Cloudflare æ˜¯ä¸€å®¶å…¨çƒæœ€è‘—åçš„ CDN åŠ é€ŸæœåŠ¡å•†ï¼Œæä¾›äº†å…è´¹å’Œä»˜è´¹çš„ç½‘ç«™åŠ é€Ÿå’Œä¿æŠ¤æœåŠ¡ã€‚å³ä½¿æ˜¯å…è´¹ç‰ˆï¼Œä¹Ÿæä¾›äº†æ¯”è¾ƒå…¨é¢å’Œå¼ºå¤§çš„åŠŸèƒ½ï¼Œéå¸¸ä¸é”™ã€‚</p><p>é€šè¿‡ä½¿ç”¨ Cloudflare CDN æœåŠ¡æä¾›çš„å…¨çƒèŠ‚ç‚¹ï¼Œä¸€æ–¹é¢å¯ä»¥æé«˜ç½‘ç«™å“åº”é€Ÿåº¦å’Œæ€§èƒ½ï¼ŒèŠ‚çœæºç«™èµ„æºï¼›å¦ä¸€æ–¹é¢ä¹Ÿå¯ä»¥ä¿æŠ¤ç«™ç‚¹æŠµå¾¡æ”»å‡»ï¼Œä¿è¯ç½‘ç«™é•¿æœŸç¨³å®šåœ¨çº¿ã€‚</p><p>fail2ban æ˜¯ä¸€ä¸ªå¼€æºå·¥å…·, å®ƒé€šè¿‡åˆ†ææ—¥å¿—, å°†ä¸æ»¡è¶³è¦æ±‚çš„è®¿é—® (æ¯”å¦‚ cc æ”»å‡»ã€å¯¹ç½‘ç«™è¿›è¡Œæ‰«æç­‰) çš„ ip è·å–åˆ°, é€šè¿‡è‡ªå¸¦é˜²ç«å¢™ (iptables ç­‰) è¿›è¡Œå°ç¦.</p><p>é—®é¢˜ä¸€: å¦‚ä½•è®© fail2ban è·å–çœŸå® IP</p><p>æƒ³è¦é€šè¿‡ fail2ban æ¥å°ç¦ ip, é‚£ä¹ˆå…ˆè¦è·å–åˆ°ç”¨æˆ· (æˆ–é»‘å®¢) çš„ ip, å¦‚æœä¸è¿›è¡Œå¤„ç†, é‚£ä¹ˆå¤§æ¦‚ç‡ä½ è·å–åˆ°çš„æ˜¯ cloudflare è¯·æ±‚ä½ ç”¨çš„ ip, å°ç¦è¿™ä¸ª ip æ˜¯æ²¡æœ‰æ„ä¹‰çš„â€¦</p><p>æˆ‘çš„æœåŠ¡æ¶æ„æ˜¯ cloudflare â€“&gt; nginx â€“&gt; åç«¯æœåŠ¡</p><p>åœ¨ nginx ä¸Šé¢é…ç½®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  # è¿™é‡Œè®¾ç½®ä¸€ä¸‹Real_IPå˜é‡, ç”¨äºå­˜å‚¨çœŸå®IP</span><br><span class="line">  set $Real_IP $http_x_forwarded_for;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  # è®¾ç½®ä»£ç† Header</span><br><span class="line">  proxy_set_header X-Real-IP $Real_IP;</span><br><span class="line"></span><br><span class="line">  location / &#123;</span><br><span class="line">    proxy_pass http://xxx;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åç«¯ä¹Ÿè¦é…ç½®æ‰“å°åœ¨æ—¥å¿—é‡Œçš„ ip å­—æ®µä¸º <code>X-Real-IP</code>, å¦‚æœè¯»å–çš„æ˜¯ Nginx æ—¥å¿—, é‚£é…ç½®ä¸€ä¸‹ Nginx çš„æ—¥å¿—æ ¼å¼å³å¯.</p><p>é—®é¢˜ 2: å°ç¦äº†ç”¨æˆ· ip, ä½†æ˜¯è¯·æ±‚æ˜¯é€šè¿‡ cloudflare è¯·æ±‚è¿‡æ¥çš„, å°ç¦æ²¡æœ‰æ•ˆæœ</p><p>å¯ä»¥ä½¿ç”¨ jail é…ç½®</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[vaultwarden]</span></span><br><span class="line"><span class="attr">enabled</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">filter</span> = vaultwarden</span><br><span class="line"><span class="attr">logpath</span> = /home/ubuntu/quickstart/vaultwarden/vaultwarden_data/vaultwarden.log</span><br><span class="line"><span class="attr">maxretry</span> = <span class="number">5</span></span><br><span class="line"><span class="attr">bantime</span> = <span class="number">1</span>d</span><br><span class="line"><span class="attr">findtime</span> = <span class="number">1</span>h</span><br><span class="line"><span class="attr">action</span> = cloudflare</span><br><span class="line">         iptables-allports<span class="section">[chain=&quot;DOCKER-USER&quot;]</span></span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ cloudflare çš„ action é…ç½®</p><p>&#x2F;etc&#x2F;fail2ban&#x2F;action.d&#x2F;cloudflare.conf</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cftoken Â =  cloudflareå…¨å±€key</span><br><span class="line">cfuser Â  =Â  ä½ çš„é‚®ç®±</span><br></pre></td></tr></table></figure><p>åç»­å°ç¦æ˜¯åœ¨ cloudflare ä¸Šå°ç¦çš„, å¯ä»¥åœ¨æ§åˆ¶å°æŸ¥çœ‹åˆ°</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202401251813392.png" alt="image.png"></p>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> fail2ban </tag>
            
            <tag> ccæ”»å‡» </tag>
            
            <tag> åå‘ä»£ç† </tag>
            
            <tag> cdn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ¶ä½œmacOSå¯åŠ¨ç›˜å’Œdmgé•œåƒ</title>
      <link href="/posts/lrrec490/"/>
      <url>/posts/lrrec490/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸‹è½½-macOS-å®‰è£…æ–‡ä»¶"><a href="#ä¸‹è½½-macOS-å®‰è£…æ–‡ä»¶" class="headerlink" title="ä¸‹è½½ macOS å®‰è£…æ–‡ä»¶"></a>ä¸‹è½½ macOS å®‰è£…æ–‡ä»¶</h2><p>å‚è€ƒè‹¹æœå®˜æ–¹æ–‡æ¡£: <a href="https://support.apple.com/zh-cn/102662">https://support.apple.com/zh-cn/102662</a>, ä½¿ç”¨ App Store ä¸‹è½½å³å¯ã€‚ä¸‹è½½å®Œæˆåä¼šæ˜¾ç¤ºåœ¨åº”ç”¨ç¨‹åºé‡Œé¢</p><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">åˆ¶ä½œdmgç£ç›˜é•œåƒ</button><button type="button" class="tab">ç›´æ¥å†™å…¥åˆ°uç›˜æˆ–ç§»åŠ¨ç¡¬ç›˜</button></div><div class="tab-contents"><div class="tab-item-content active"><p>åˆ›å»ºä¸€ä¸ªç©ºç™½çš„ dmg é•œåƒ</p><p>æ‰“å¼€ã€Œç£ç›˜å·¥å…·ã€ï¼Œåœ¨é¡¶éƒ¨èœå•é€‰æ‹©ã€Œæ–‡ä»¶ã€&gt;ã€Œæ–°å»ºæ˜ åƒã€&gt;ã€Œç©ºç™½æ˜ åƒã€ï¼Œç„¶åå¦‚ä¸‹å›¾ï¼š</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202401241427615.png" alt="52260C58-B232-452E-B8C8-FE5B35BBFA45.png"></p><p>ã€Œå¤§å°ã€çš„è®¾ç½®ï¼Œæ ¹æ®å®‰è£…é•œåƒå¤§å°, å†å¢åŠ  2GB, æˆ‘è¿™é‡Œç²—ç•¥è®¾ç½®ä¸º 15 GBï¼›<br>ã€Œæ ¼å¼ã€è®¾ç½®ä¸ºã€ŒMac OS æ‰©å±•ï¼ˆæ—¥å¿—å¼ï¼‰ã€ï¼›<br>ã€Œåˆ†åŒºã€ä¸ºè®¾ç½®ä¸ºã€Œå•ä¸ªåˆ†åŒº - GUID åˆ†åŒºå›¾ã€ï¼›<br>ã€Œæ˜ åƒæ ¼å¼ã€ä¸ºã€Œè¯»&#x2F;å†™ã€ï¼›</p><p>æŒ‚è½½è¿™ä¸ªç£ç›˜é•œåƒ, ç›´æ¥åŒå‡»å³å¯è‡ªåŠ¨æŒ‚è½½ã€‚</p><p>æ•°æ®å†™å…¥åˆ° dmg ç£ç›˜</p><p>å‚è€ƒ: <a href="https://support.apple.com/zh-cn/101578">https://support.apple.com/zh-cn/101578</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ ¹æ®ä½ çš„ç³»ç»Ÿç‰ˆæœ¬å’Œç£ç›˜æŒ‚è½½ä½ç½®è‡ªè¡Œä¿®æ”¹</span></span><br><span class="line">sudo /Applications/Install\ macOS\ Ventura.app/Contents/Resources/createinstallmedia --volume /Volumes/MyVolume</span><br></pre></td></tr></table></figure><p>å†™å…¥å®Œæˆå, æ¨å‡ºè¿™ä¸ª dmg ç£ç›˜, ä¸€èˆ¬åœ¨è®¿è¾¾ä¸­å°±èƒ½æ¨å‡º</p><p>å‹ç¼© dmg ç£ç›˜</p><p>ä¸Šé¢åˆ›å»ºçš„ dmg ç£ç›˜å¤§å°ä¸º 15G, ä¸ºäº†ä¿è¯ç©ºé—´è¶³å¤Ÿå†™å…¥, æ•°æ®é‡å…¶å®æ²¡åˆ° 15G, å¯ä»¥å‹ç¼©ä¸€ä¸‹ã€‚ æ‰“å¼€ã€Œç£ç›˜å·¥å…·ã€ï¼Œé¡¶éƒ¨èœå•é€‰æ‹©ã€Œæ˜ åƒã€&gt;ã€Œè½¬æ¢ã€ï¼Œé€‰æ‹© macOS.dmg æ–‡ä»¶å¹¶å­˜å‚¨å‘½åä¸º InstallESD åˆ°æ¡Œé¢ï¼š</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202401241508090.png" alt="B1A330BF-1FEF-48F1-948C-81CD79645DF2.png"></p><p>å†™å…¥ dmg åˆ° u ç›˜æˆ–ç§»åŠ¨ç¡¬ç›˜ (å¯é€‰)</p><p>å¯ä»¥ä½¿ç”¨ balenaEtcher(å¼€æºè·¨å¹³å°) æ¥è¿›è¡Œå†™å…¥</p></div><div class="tab-item-content"><p>ç›´æ¥å†™å…¥åˆ° u ç›˜æˆ–ç§»åŠ¨ç¡¬ç›˜</p><p>å‚è€ƒ: <a href="https://support.apple.com/zh-cn/101578">https://support.apple.com/zh-cn/101578</a></p><p>æ ¹æ®ä½ çš„ç³»ç»Ÿç‰ˆæœ¬å’Œç¡¬ç›˜æŒ‚è½½ä½ç½®å†³å®šï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Sonoma</span></span><br><span class="line">sudo /Applications/Install\ macOS\ Sonoma.app/Contents/Resources/createinstallmedia --volume /Volumes/MyVolume</span><br><span class="line"></span><br><span class="line"><span class="comment"># Ventura</span></span><br><span class="line">sudo /Applications/Install\ macOS\ Ventura.app/Contents/Resources/createinstallmedia --volume /Volumes/MyVolume</span><br><span class="line"></span><br><span class="line"><span class="comment"># Monterey</span></span><br><span class="line">sudo /Applications/Install\ macOS\ Monterey.app/Contents/Resources/createinstallmedia --volume /Volumes/MyVolume</span><br><span class="line"></span><br><span class="line"><span class="comment"># Big Sur</span></span><br><span class="line">sudo /Applications/Install\ macOS\ Big\ Sur.app/Contents/Resources/createinstallmedia --volume /Volumes/MyVolume</span><br><span class="line"></span><br><span class="line"><span class="comment"># Catalina</span></span><br><span class="line">sudo /Applications/Install\ macOS\ Catalina.app/Contents/Resources/createinstallmedia --volume /Volumes/MyVolume</span><br><span class="line"></span><br><span class="line"><span class="comment"># Mojave</span></span><br><span class="line">sudo /Applications/Install\ macOS\ Mojave.app/Contents/Resources/createinstallmedia --volume /Volumes/MyVolume</span><br><span class="line"></span><br><span class="line"><span class="comment"># High Sierra</span></span><br><span class="line">sudo /Applications/Install\ macOS\ High\ Sierra.app/Contents/Resources/createinstallmedia --volume /Volumes/MyVolume</span><br><span class="line"></span><br><span class="line"><span class="comment"># El Capitan</span></span><br><span class="line">sudo /Applications/Install\ OS\ X\ El\ Capitan.app/Contents/Resources/createinstallmedia --volume /Volumes/MyVolume --applicationpath /Applications/Install\ OS\ X\ El\ Capitan.app</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
            <tag> macOS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>macOSå¸¸ç”¨æ“ä½œè®°å½•</title>
      <link href="/posts/lrr6ze9h/"/>
      <url>/posts/lrr6ze9h/</url>
      
        <content type="html"><![CDATA[<h2 id="åœ¨ç»ˆç«¯ä¸­ä½¿ç”¨-code-å‘½ä»¤å¯åŠ¨-vscode"><a href="#åœ¨ç»ˆç«¯ä¸­ä½¿ç”¨-code-å‘½ä»¤å¯åŠ¨-vscode" class="headerlink" title="åœ¨ç»ˆç«¯ä¸­ä½¿ç”¨ code å‘½ä»¤å¯åŠ¨ vscode"></a>åœ¨ç»ˆç«¯ä¸­ä½¿ç”¨ code å‘½ä»¤å¯åŠ¨ vscode</h2><p>å…ˆå®‰è£… codeï¼šæ‰“å¼€ VSCode -&gt; æŸ¥çœ‹ -&gt; å‘½ä»¤é¢æ¿ -&gt; è¾“å…¥ shell command â€“&gt; ç‚¹å‡» <code>Shell Command: Install &#39;code&#39; command in PATH</code></p><p>ç„¶ååœ¨ç»ˆç«¯ä¸­å¯ä»¥ä½¿ç”¨ <code>code</code> å‘½ä»¤æ‰“å¼€ vscode äº†, æˆ–è€… <code>code .</code> æ‰“å¼€å½“å‰ç›®å½•</p><table><thead><tr><th>å¸¸ç”¨å‘½ä»¤</th><th>ç”¨é€”</th></tr></thead><tbody><tr><td>code</td><td>æ‰“å¼€ vscode</td></tr><tr><td>code .</td><td>vscode æ‰“å¼€å½“å‰ç›®å½•</td></tr><tr><td>code &#x2F;Users&#x2F;iuxt&#x2F;code</td><td>æ‰“å¼€æŒ‡å®šçš„ç›®å½•</td></tr></tbody></table><h2 id="é˜²æ­¢è‡ªåŠ¨ç¡çœ "><a href="#é˜²æ­¢è‡ªåŠ¨ç¡çœ " class="headerlink" title="é˜²æ­¢è‡ªåŠ¨ç¡çœ "></a>é˜²æ­¢è‡ªåŠ¨ç¡çœ </h2><p>åœ¨æ˜¾ç¤ºå™¨ é«˜çº§é‡Œé¢ æ‰“å¼€ ä½¿ç”¨ç”µæºé€‚é…å™¨ä¾›ç”µä¸”æ˜¾ç¤ºå™¨å…³é—­æ—¶, é˜²æ­¢è‡ªåŠ¨è¿›å…¥ç¡çœ é€‰é¡¹ã€‚</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202401241101946.png" alt="B7491094-21E7-4D08-9603-5D1574639FDD.png|484"></p><h2 id="æç¤º-ç¨‹åºæŸå-éœ€è¦ç§»åŠ¨åˆ°åºŸçº¸ç¯“"><a href="#æç¤º-ç¨‹åºæŸå-éœ€è¦ç§»åŠ¨åˆ°åºŸçº¸ç¯“" class="headerlink" title="æç¤º ç¨‹åºæŸå,éœ€è¦ç§»åŠ¨åˆ°åºŸçº¸ç¯“"></a>æç¤º ç¨‹åºæŸå,éœ€è¦ç§»åŠ¨åˆ°åºŸçº¸ç¯“</h2><p>æˆ–è€…æç¤ºåº”ç”¨æœªéªŒè¯ç­‰, å¯ä»¥åˆ°è®¿è¾¾é‡Œ, æ‰¾åˆ°åº”ç”¨ç¨‹åº, æŒ‰ä¸‹ control é”®ç‚¹å‡», é€‰æ‹©æ‰“å¼€</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202401241142254.png" alt="image.png|624"></p><p>æˆ–è€…å»é™¤è‹¹æœçš„ quarantine å±æ€§</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo xattr -r -d com.apple.quarantine /Applications/WebStrom.app</span><br></pre></td></tr></table></figure><h2 id="å¸¸è§çš„ç³»ç»Ÿæ–‡ä»¶ä½ç½®"><a href="#å¸¸è§çš„ç³»ç»Ÿæ–‡ä»¶ä½ç½®" class="headerlink" title="å¸¸è§çš„ç³»ç»Ÿæ–‡ä»¶ä½ç½®"></a>å¸¸è§çš„ç³»ç»Ÿæ–‡ä»¶ä½ç½®</h2><table><thead><tr><th>å†…å®¹</th><th>ä½ç½®</th></tr></thead><tbody><tr><td>å¼€æœºå¯åŠ¨é¡¹</td><td>&#x2F;Library&#x2F;LaunchDaemons&#x2F;</td></tr><tr><td>å¼€æœºå¯åŠ¨é¡¹</td><td>&#x2F;Library&#x2F;LaunchAgents&#x2F;</td></tr><tr><td>å¼€æœºå¯åŠ¨é¡¹ (ä¸ªäºº)</td><td>~&#x2F;Library&#x2F;LaunchAgents</td></tr><tr><td>å®Œå…¨ç£ç›˜è®¿é—®æƒé™</td><td>&#x2F;Library&#x2F;PrivilegedHelperTools&#x2F;</td></tr></tbody></table><h2 id="ç»ˆç«¯é…ç½®"><a href="#ç»ˆç«¯é…ç½®" class="headerlink" title="ç»ˆç«¯é…ç½®"></a>ç»ˆç«¯é…ç½®</h2><h3 id="ls-æŸ¥çœ‹çš„æ–‡ä»¶é¢œè‰²"><a href="#ls-æŸ¥çœ‹çš„æ–‡ä»¶é¢œè‰²" class="headerlink" title="ls æŸ¥çœ‹çš„æ–‡ä»¶é¢œè‰²"></a>ls æŸ¥çœ‹çš„æ–‡ä»¶é¢œè‰²</h3><p>mac çš„ ls å‘½ä»¤é»˜è®¤çš„é¢œè‰²æ¯”è¾ƒéš¾çœ‹, æ¯”å¦‚å¯æ‰§è¡Œç¨‹åºæ˜¾ç¤ºçº¢è‰², å¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼ä¿®æ”¹ä¸€ä¸‹.</p><p>ä¿®æ”¹å‰:</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202401241214412.png" alt="image.png|790"></p><p>é…ç½®åœ¨.zshrc å†…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç»ˆç«¯é…è‰² æ¯”å¦‚æ–‡ä»¶å¤¹æ˜¯ä»€ä¹ˆé¢œè‰², é“¾æ¥æ˜¯ä»€ä¹ˆé¢œè‰²ç­‰</span></span><br><span class="line"><span class="built_in">export</span> CLICOLOR=1</span><br><span class="line"><span class="built_in">export</span> LSCOLORS=ExGxFxdaCxDaDahbadeche</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹å:</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202401241215880.png" alt="image.png|799"></p><h3 id="zsh-é…ç½®"><a href="#zsh-é…ç½®" class="headerlink" title="zsh é…ç½®"></a>zsh é…ç½®</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># brew</span></span><br><span class="line">/bin/bash -c <span class="string">&quot;<span class="subst">$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…å­—ä½“</span></span><br><span class="line">brew install font-lxgw-wenkai font-meslo-for-powerlevel10k</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…Oh My Zsh</span></span><br><span class="line">sh -c <span class="string">&quot;<span class="subst">$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…powerlevel10kä¸»é¢˜</span></span><br><span class="line">git <span class="built_in">clone</span> --depth=1 https://github.com/romkatv/powerlevel10k.git <span class="variable">$&#123;ZSH_CUSTOM:-<span class="variable">$HOME</span>/.oh-my-zsh/custom&#125;</span>/themes/powerlevel10k</span><br><span class="line">sed -i <span class="string">&#x27;s#^ZSH_THEME=.*#ZSH_THEME=&quot;powerlevel10k/powerlevel10k&quot;#g&#x27;</span> ~/.zshrc</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…ä¸¤ä¸ªå¸¸ç”¨çš„æ’ä»¶</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/zsh-users/zsh-syntax-highlighting.git <span class="variable">$&#123;ZSH_CUSTOM:-~/.oh-my-zsh/custom&#125;</span>/plugins/zsh-syntax-highlighting</span><br><span class="line">git <span class="built_in">clone</span> https://github.com/zsh-users/zsh-autosuggestions <span class="variable">$&#123;ZSH_CUSTOM:-~/.oh-my-zsh/custom&#125;</span>/plugins/zsh-autosuggestions</span><br><span class="line">omz plugin <span class="built_in">enable</span> zsh-autosuggestions zsh-syntax-highlighting</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…-FZF"><a href="#å®‰è£…-FZF" class="headerlink" title="å®‰è£… FZF"></a>å®‰è£… FZF</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">brew install fzf</span><br><span class="line">$(brew --prefix)/opt/fzf/install</span><br></pre></td></tr></table></figure><h2 id="è¿œç¨‹è®¿é—®-Windows"><a href="#è¿œç¨‹è®¿é—®-Windows" class="headerlink" title="è¿œç¨‹è®¿é—® Windows"></a>è¿œç¨‹è®¿é—® Windows</h2><p>å¯ä»¥ä½¿ç”¨ parallels client (appstore å°±æœ‰) æˆ–è€…ä½¿ç”¨å¾®è½¯å®˜æ–¹çš„ microsoft remote desktop å®¢æˆ·ç«¯ (å•†åº—ç‰ˆéœ€è¦ç¾åŒº apple id), æˆ–è€…åœ¨å¾®è½¯å®˜æ–¹ä¸‹è½½</p><p><a href="https://go.microsoft.com/fwlink/?linkid=868963">æ­£å¼ç‰ˆpkgåŒ…(ç¨‹è‰²å›¾æ ‡)</a><br><a href="https://install.appcenter.ms/orgs/rdmacios-k2vy/apps/microsoft-remote-desktop-for-mac/distribution_groups/all-users-of-microsoft-remote-desktop-for-mac">betaç‰ˆzipåŒ…(è“è‰²å›¾æ ‡)</a></p><h2 id="è§£åŒ…-pkg"><a href="#è§£åŒ…-pkg" class="headerlink" title="è§£åŒ… pkg"></a>è§£åŒ… pkg</h2><p> éƒ¨åˆ† pkg åŒ…é‡Œé¢æœ‰ç§è´§, æ¯”å¦‚å¾®è½¯çš„ Edge æµè§ˆå™¨, æˆ‘ä»¬å¯ä»¥é€šè¿‡è§£åŒ… pkg ç›´æ¥æå– <code>.app</code> æ–‡ä»¶, æ‰‹åŠ¨æ‹·è´åˆ°åº”ç”¨ç¨‹åºä¸‹ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> temp &amp;&amp; <span class="built_in">cd</span> temp</span><br><span class="line">xar -xf Setup.pkg</span><br><span class="line"><span class="comment"># æˆ–è€…ä½¿ç”¨ pkgutil --expand edge.pkg ./edge</span></span><br><span class="line"><span class="built_in">cat</span> mac.pkg/Payload | cpio -i</span><br></pre></td></tr></table></figure><h2 id="vim-çš„é…ç½®"><a href="#vim-çš„é…ç½®" class="headerlink" title="vim çš„é…ç½®"></a>vim çš„é…ç½®</h2><h3 id="å®‰è£…-Plug-æ’ä»¶ç®¡ç†å·¥å…·"><a href="#å®‰è£…-Plug-æ’ä»¶ç®¡ç†å·¥å…·" class="headerlink" title="å®‰è£… Plug æ’ä»¶ç®¡ç†å·¥å…·"></a>å®‰è£… Plug æ’ä»¶ç®¡ç†å·¥å…·</h3><p><a href="https://github.com/junegunn/vim-plug">https://github.com/junegunn/vim-plug</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -fLo ~/.vim/autoload/plug.vim --create-dirs \</span><br><span class="line">    https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim</span><br></pre></td></tr></table></figure><p>Plug çš„é…ç½®æ–‡ä»¶åœ¨ <code>.vimrc</code> é‡Œé¢ï¼Œåœ¨ <code>call plug#begin()</code> å’Œ <code>call plug#end()</code> ä¹‹é—´</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">call plug<span class="comment">#begin()</span></span><br><span class="line">  Plug <span class="string">&#x27;preservim/nerdtree&#x27;</span></span><br><span class="line">call plug<span class="comment">#end()</span></span><br></pre></td></tr></table></figure><p>é…ç½®ä¿®æ”¹å®Œæˆåï¼Œåœ¨ vim å‘½ä»¤ç•Œé¢ï¼Œè¾“å…¥ PlugInstall è‡ªåŠ¨å®‰è£…æ’ä»¶ã€‚</p><h3 id="å®‰è£…-NerdTree-ç›®å½•æ ‘å·¥å…·"><a href="#å®‰è£…-NerdTree-ç›®å½•æ ‘å·¥å…·" class="headerlink" title="å®‰è£… NerdTree ç›®å½•æ ‘å·¥å…·"></a>å®‰è£… NerdTree ç›®å½•æ ‘å·¥å…·</h3><p><a href="https://github.com/preservim/nerdtree">https://github.com/preservim/nerdtree</a></p><p>ä½¿ç”¨ Plug å®‰è£…ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Plug <span class="string">&#x27;preservim/nerdtree&#x27;</span>, &#123; <span class="string">&#x27;on&#x27;</span>: <span class="string">&#x27;NERDTreeToggle&#x27;</span> &#125;</span><br></pre></td></tr></table></figure><p>é…ç½®æ–‡ä»¶ <code>~/.vimrc</code> é…ç½® F8 ä¸ºå¿«æ·é”®:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot; nerdtree</span></span><br><span class="line"><span class="string">let NERDTreeWinPos=&quot;</span>left<span class="string">&quot;</span></span><br><span class="line"><span class="string">noremap &lt;F8&gt; :NERDTreeToggle&lt;CR&gt;</span></span><br><span class="line"><span class="string">let g:NERDTreeDirArrowExpandable = &#x27;â–¸&#x27;</span></span><br><span class="line"><span class="string">let g:NERDTreeDirArrowCollapsible = &#x27;â–¾&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="å®‰è£…-airline-ä¸»é¢˜"><a href="#å®‰è£…-airline-ä¸»é¢˜" class="headerlink" title="å®‰è£… airline ä¸»é¢˜"></a>å®‰è£… airline ä¸»é¢˜</h3><p><a href="https://github.com/vim-airline/vim-airline">https://github.com/vim-airline/vim-airline</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Plug <span class="string">&#x27;vim-airline/vim-airline&#x27;</span></span><br><span class="line">Plug <span class="string">&#x27;vim-airline/vim-airline-themes&#x27;</span></span><br></pre></td></tr></table></figure><p>ä¸»é¢˜é…ç½® <code>~/.vimrc</code>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot; airline</span></span><br><span class="line"><span class="string">set laststatus=2  &quot;</span>æ°¸è¿œæ˜¾ç¤ºçŠ¶æ€æ </span><br><span class="line"><span class="built_in">let</span> g:airline_powerline_fonts = 1  <span class="string">&quot;æ”¯æŒ powerline å­—ä½“</span></span><br><span class="line"><span class="string">let g:airline#extensions#tabline#enabled = 1 &quot;</span>æ˜¾ç¤ºçª—å£tabå’Œbuffer</span><br><span class="line"><span class="built_in">let</span> g:airline_theme=<span class="string">&#x27;molokai&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> !exists(<span class="string">&#x27;g:airline_symbols&#x27;</span>)</span><br><span class="line"><span class="built_in">let</span> g:airline_symbols = &#123;&#125;</span><br><span class="line">endif</span><br><span class="line"><span class="built_in">let</span> g:airline_left_sep = <span class="string">&#x27;â–¶&#x27;</span></span><br><span class="line"><span class="built_in">let</span> g:airline_left_alt_sep = <span class="string">&#x27;â¯&#x27;</span></span><br><span class="line"><span class="built_in">let</span> g:airline_right_sep = <span class="string">&#x27;â—€&#x27;</span></span><br><span class="line"><span class="built_in">let</span> g:airline_right_alt_sep = <span class="string">&#x27;â®&#x27;</span></span><br><span class="line"><span class="built_in">let</span> g:airline_symbols.linenr = <span class="string">&#x27;Â¶&#x27;</span></span><br><span class="line"><span class="built_in">let</span> g:airline_symbols.branch = <span class="string">&#x27;â‡&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="æœ€ç»ˆçš„-vim-é…ç½®æ–‡ä»¶å¦‚ä¸‹"><a href="#æœ€ç»ˆçš„-vim-é…ç½®æ–‡ä»¶å¦‚ä¸‹" class="headerlink" title="æœ€ç»ˆçš„ vim é…ç½®æ–‡ä»¶å¦‚ä¸‹"></a>æœ€ç»ˆçš„ vim é…ç½®æ–‡ä»¶å¦‚ä¸‹</h3><p><code>vim ~/.vimrc</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">call plug<span class="comment">#begin()</span></span><br><span class="line"></span><br><span class="line">Plug <span class="string">&#x27;preservim/nerdtree&#x27;</span>, &#123; <span class="string">&#x27;on&#x27;</span>: <span class="string">&#x27;NERDTreeToggle&#x27;</span> &#125;</span><br><span class="line">Plug <span class="string">&#x27;vim-airline/vim-airline&#x27;</span></span><br><span class="line">Plug <span class="string">&#x27;vim-airline/vim-airline-themes&#x27;</span></span><br><span class="line"></span><br><span class="line">call plug<span class="comment">#end()</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> <span class="built_in">paste</span></span><br><span class="line"><span class="built_in">set</span> number</span><br><span class="line"></span><br><span class="line"><span class="string">&quot; nerdtree</span></span><br><span class="line"><span class="string">let NERDTreeWinPos=&quot;</span>left<span class="string">&quot;</span></span><br><span class="line"><span class="string">noremap &lt;F8&gt; :NERDTreeToggle&lt;CR&gt;</span></span><br><span class="line"><span class="string">let g:NERDTreeDirArrowExpandable = &#x27;â–¸&#x27;</span></span><br><span class="line"><span class="string">let g:NERDTreeDirArrowCollapsible = &#x27;â–¾&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&quot;</span> airline</span><br><span class="line"><span class="built_in">set</span> laststatus=2  <span class="string">&quot;æ°¸è¿œæ˜¾ç¤ºçŠ¶æ€æ </span></span><br><span class="line"><span class="string">let g:airline_powerline_fonts = 1  &quot;</span>æ”¯æŒ powerline å­—ä½“</span><br><span class="line"><span class="built_in">let</span> g:airline<span class="comment">#extensions#tabline#enabled = 1 &quot;æ˜¾ç¤ºçª—å£tabå’Œbuffer</span></span><br><span class="line"><span class="built_in">let</span> g:airline_theme=<span class="string">&#x27;molokai&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> !exists(<span class="string">&#x27;g:airline_symbols&#x27;</span>)</span><br><span class="line"><span class="built_in">let</span> g:airline_symbols = &#123;&#125;</span><br><span class="line">endif</span><br><span class="line"><span class="built_in">let</span> g:airline_left_sep = <span class="string">&#x27;â–¶&#x27;</span></span><br><span class="line"><span class="built_in">let</span> g:airline_left_alt_sep = <span class="string">&#x27;â¯&#x27;</span></span><br><span class="line"><span class="built_in">let</span> g:airline_right_sep = <span class="string">&#x27;â—€&#x27;</span></span><br><span class="line"><span class="built_in">let</span> g:airline_right_alt_sep = <span class="string">&#x27;â®&#x27;</span></span><br><span class="line"><span class="built_in">let</span> g:airline_symbols.linenr = <span class="string">&#x27;Â¶&#x27;</span></span><br><span class="line"><span class="built_in">let</span> g:airline_symbols.branch = <span class="string">&#x27;â‡&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="äº‘æœåŠ¡æ–‡ä»¶å¤¹"><a href="#äº‘æœåŠ¡æ–‡ä»¶å¤¹" class="headerlink" title="äº‘æœåŠ¡æ–‡ä»¶å¤¹"></a>äº‘æœåŠ¡æ–‡ä»¶å¤¹</h2><h3 id="ç¬¬ä¸‰æ–¹åŒæ­¥ç›˜ä½ç½®"><a href="#ç¬¬ä¸‰æ–¹åŒæ­¥ç›˜ä½ç½®" class="headerlink" title="ç¬¬ä¸‰æ–¹åŒæ­¥ç›˜ä½ç½®"></a>ç¬¬ä¸‰æ–¹åŒæ­¥ç›˜ä½ç½®</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$&#123;HOME&#125;</span>/Library/CloudStorage</span><br></pre></td></tr></table></figure><h3 id="åœ¨å®¶ç›®å½•åˆ›å»º-iCloud-å¿«æ·æ–¹å¼"><a href="#åœ¨å®¶ç›®å½•åˆ›å»º-iCloud-å¿«æ·æ–¹å¼" class="headerlink" title="åœ¨å®¶ç›®å½•åˆ›å»º iCloud å¿«æ·æ–¹å¼"></a>åœ¨å®¶ç›®å½•åˆ›å»º iCloud å¿«æ·æ–¹å¼</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ln</span> -s <span class="string">&quot;<span class="variable">$&#123;HOME&#125;</span>/Library/Mobile Documents/com~apple~CloudDocs&quot;</span> ~/icloud</span><br></pre></td></tr></table></figure><h2 id="é‡ç½®ç½‘å¡ä¿¡æ¯"><a href="#é‡ç½®ç½‘å¡ä¿¡æ¯" class="headerlink" title="é‡ç½®ç½‘å¡ä¿¡æ¯"></a>é‡ç½®ç½‘å¡ä¿¡æ¯</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">rm</span> -rf /Library/Preferences/SystemConfiguration/preferences.plist</span><br><span class="line">sudo <span class="built_in">rm</span> -rf /Library/Preferences/SystemConfiguration/NetworkInterfaces.plist*</span><br></pre></td></tr></table></figure><h2 id="å®‰è£…æ ¹è¯ä¹¦"><a href="#å®‰è£…æ ¹è¯ä¹¦" class="headerlink" title="å®‰è£…æ ¹è¯ä¹¦"></a>å®‰è£…æ ¹è¯ä¹¦</h2><p>æ‰“å¼€é’¥åŒ™ä¸² â€“ ç™»å½• â€“ è¯ä¹¦ å°†è¯ä¹¦æ–‡ä»¶æ‹–è¿›æ¥<br>ç„¶ååŒå‡»è¯ä¹¦, æŸ¥çœ‹ä¿¡ä»», è®¾ç½®ä¸ºå§‹ç»ˆä¿¡ä»»</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202401241306196.png" alt="0E07356E-2BBC-4C2C-BC5B-187C697CAECB.png|672"></p><h2 id="å¼€å‘ç»„ä»¶"><a href="#å¼€å‘ç»„ä»¶" class="headerlink" title="å¼€å‘ç»„ä»¶"></a>å¼€å‘ç»„ä»¶</h2><h3 id="zlib-åº“æ‰¾ä¸åˆ°"><a href="#zlib-åº“æ‰¾ä¸åˆ°" class="headerlink" title="zlib åº“æ‰¾ä¸åˆ°"></a>zlib åº“æ‰¾ä¸åˆ°</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…zlibåº“</span></span><br><span class="line">brew install zlib</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ§åˆ¶å°ä¼šè¾“å‡ºé…ç½®, æ ¹æ®éœ€è¦è´´åˆ° ~/.zshrc é‡Œ</span></span><br><span class="line"><span class="comment">#For compilers to find zlib you may need to set:</span></span><br><span class="line"><span class="built_in">export</span> LDFLAGS=<span class="string">&quot;<span class="variable">$LDFLAGS</span> -L<span class="subst">$(brew --prefix zlib)</span>/lib&quot;</span></span><br><span class="line"><span class="built_in">export</span> CPPFLAGS=<span class="string">&quot;<span class="variable">$CPPFLAGS</span> -I<span class="subst">$(brew --prefix zlib)</span>/include&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#For pkg-config to find zlib you may need to set:</span></span><br><span class="line"><span class="built_in">export</span> PKG_CONFIG_PATH=<span class="string">&quot;<span class="variable">$PKG_CONFIG_PATH</span>:<span class="subst">$(brew --prefix zlib)</span>/lib/pkgconfig&quot;</span></span><br></pre></td></tr></table></figure><h3 id="å®‰è£…-mysqlclient"><a href="#å®‰è£…-mysqlclient" class="headerlink" title="å®‰è£… mysqlclient"></a>å®‰è£… mysqlclient</h3><p><code>pip install mysqlclient</code> æŠ¥é”™ï¼Œéœ€è¦å…ˆå®‰è£…ä¾èµ–åŒ… <code>brew install mysql-client</code> ç„¶åé…ç½®ç¯å¢ƒå˜é‡, æ·»åŠ ä»¥ä¸‹ 3 è¡Œåˆ° <code>.zshrc</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> PATH=<span class="string">&quot;<span class="subst">$(brew --prefix mysql-client)</span>/bin:<span class="variable">$PATH</span>&quot;</span></span><br><span class="line"><span class="built_in">export</span> LDFLAGS=<span class="string">&quot;<span class="variable">$LDFLAGS</span> -L<span class="subst">$(brew --prefix mysql-client)</span>/lib&quot;</span></span><br><span class="line"><span class="built_in">export</span> CPPFLAGS=<span class="string">&quot;<span class="variable">$CPPFLAGS</span> -I<span class="subst">$(brew --prefix mysql-client)</span>/include&quot;</span></span><br></pre></td></tr></table></figure><p>å¦‚æœæŠ¥é”™ <code>ld: library &#39;ssl&#39; not found</code> ï¼Œéœ€è¦å®‰è£… openssl <code>brew install openssl</code> ç¯å¢ƒå˜é‡éœ€è¦å¢åŠ ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> LDFLAGS=<span class="string">&quot;<span class="variable">$LDFLAGS</span> -L<span class="subst">$(brew --prefix openssl)</span>/lib&quot;</span></span><br><span class="line"><span class="built_in">export</span> CPPFLAGS=<span class="string">&quot;<span class="variable">$CPPFLAGS</span> -I<span class="subst">$(brew --prefix openssl)</span>/include&quot;</span></span><br></pre></td></tr></table></figure><p>å¦‚æœæŠ¥é”™ <code>ld: library &#39;zstd&#39; not found</code>ï¼Œ éœ€è¦å®‰è£… zstd <code>brew install zstd</code> ç¯å¢ƒå˜é‡éœ€è¦å¢åŠ ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> LDFLAGS=<span class="string">&quot;<span class="variable">$LDFLAGS</span> -L<span class="subst">$(brew --prefix zstd)</span>/lib&quot;</span></span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨-pkg-config-æŸ¥æ‰¾å‚æ•°"><a href="#ä½¿ç”¨-pkg-config-æŸ¥æ‰¾å‚æ•°" class="headerlink" title="ä½¿ç”¨ pkg-config æŸ¥æ‰¾å‚æ•°"></a>ä½¿ç”¨ pkg-config æŸ¥æ‰¾å‚æ•°</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…pkg-config</span></span><br><span class="line">brew install pkg-config</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ‰€æœ‰çš„pkg-configè·¯å¾„ï¼Œéœ€è¦é…ç½®åˆ°å˜é‡ PKG_CONFIG_PATH ä¸­</span></span><br><span class="line"><span class="built_in">export</span> PKG_CONFIG_PATH=$(find /usr/local/Cellar -name <span class="string">&#x27;pkgconfig&#x27;</span> -<span class="built_in">type</span> d | grep lib/pkgconfig | <span class="built_in">tr</span> <span class="string">&#x27;\n&#x27;</span> <span class="string">&#x27;:&#x27;</span> | sed s/.$//)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹opensslçš„ CPPFLAGS å‚æ•°ï¼Œ éœ€è¦é…ç½®åˆ°å˜é‡ CPPFLAGS ä¸­</span></span><br><span class="line">â¯ pkg-config --cflags openssl</span><br><span class="line">-I/usr/local/Cellar/openssl@3/3.3.1/include</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹opensslçš„ LDFLAGS å‚æ•°ï¼Œ éœ€è¦é…ç½®åˆ°å˜é‡ LDFLAGS ä¸­</span></span><br><span class="line">â¯ pkg-config --libs openssl</span><br><span class="line">-L/usr/local/Cellar/openssl@3/3.3.1/lib -lssl -lcrypto</span><br></pre></td></tr></table></figure><h2 id="æŒ‚è½½-EFI"><a href="#æŒ‚è½½-EFI" class="headerlink" title="æŒ‚è½½ EFI"></a>æŒ‚è½½ EFI</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹</span></span><br><span class="line">sudo diskutil list</span><br></pre></td></tr></table></figure><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202401241434966.png" alt="image.png|652"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŒ‚è½½</span></span><br><span class="line">sudo diskutil mount disk0s1</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¸è½½</span></span><br><span class="line">sudo diskutil umount disk0s1</span><br></pre></td></tr></table></figure><h2 id="å¸è½½è¾“å…¥æ³•"><a href="#å¸è½½è¾“å…¥æ³•" class="headerlink" title="å¸è½½è¾“å…¥æ³•"></a>å¸è½½è¾“å…¥æ³•</h2><p>æœç‹—è¾“å…¥æ³• macOS ç‰ˆå®‰è£…ç¨‹åºæä¾›äº†å¸è½½é€‰é¡¹, å¯ä»¥ä½¿ç”¨å®‰è£…ç¨‹åºæ¥è¿›è¡Œå¸è½½. å¯æ˜¯å¾®ä¿¡è¾“å…¥æ³•æ²¡æœ‰, åˆ é™¤æ–¹æ³•å¦‚ä¸‹:</p><h3 id="ç³»ç»Ÿè®¾ç½®ä¸­ç§»é™¤è¾“å…¥æ³•"><a href="#ç³»ç»Ÿè®¾ç½®ä¸­ç§»é™¤è¾“å…¥æ³•" class="headerlink" title="ç³»ç»Ÿè®¾ç½®ä¸­ç§»é™¤è¾“å…¥æ³•"></a>ç³»ç»Ÿè®¾ç½®ä¸­ç§»é™¤è¾“å…¥æ³•</h3><p>åœ¨ç³»ç»Ÿè®¾ç½®ä¸­ç§»é™¤å¾®ä¿¡è¾“å…¥æ³•</p><h3 id="åœæ­¢è¾“å…¥æ³•"><a href="#åœæ­¢è¾“å…¥æ³•" class="headerlink" title="åœæ­¢è¾“å…¥æ³•"></a>åœæ­¢è¾“å…¥æ³•</h3><p>æ‰“å¼€æ´»åŠ¨ç›‘è§†å™¨, æ‰¾åˆ°å¾®ä¿¡è¾“å…¥æ³•, åœæ­¢è¿›ç¨‹</p><h3 id="åˆ é™¤è¾“å…¥æ³•"><a href="#åˆ é™¤è¾“å…¥æ³•" class="headerlink" title="åˆ é™¤è¾“å…¥æ³•"></a>åˆ é™¤è¾“å…¥æ³•</h3><p>æ‰“å¼€è®¿è¾¾, æŒ‰ä¸‹ <code>shift + command + G</code> è¾“å…¥ï¼š<code>/Library/Input Methods</code> å›è½¦<br>é€‰ä¸­ WeType ï¼Œå³é”®é€‰æ‹© ç§»åˆ°åºŸçº¸ç¯“<br><code>$&#123;HOME&#125;/Library/Application Support</code> åˆ é™¤ <code>wetype</code></p><h2 id="æŸ¥çœ‹-Bundle-ID"><a href="#æŸ¥çœ‹-Bundle-ID" class="headerlink" title="æŸ¥çœ‹ Bundle ID"></a>æŸ¥çœ‹ Bundle ID</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">codesign -dr - /Applications/Microsoft\ Edge.app</span><br><span class="line"></span><br><span class="line"><span class="comment"># æˆ–è€…ï¼š</span></span><br><span class="line">osascript -e <span class="string">&#x27;id of app &quot;iterm2&quot;&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="brew-å¸¸ç”¨æ“ä½œ"><a href="#brew-å¸¸ç”¨æ“ä½œ" class="headerlink" title="brew å¸¸ç”¨æ“ä½œ"></a>brew å¸¸ç”¨æ“ä½œ</h2><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># æ›´æ–° brew</span><br><span class="line">brew <span class="keyword">update</span></span><br><span class="line"></span><br><span class="line"># æœç´¢è½¯ä»¶åŒ…</span><br><span class="line">brew <span class="built_in">search</span> &lt;package name&gt;</span><br><span class="line"></span><br><span class="line"># æŸ¥çœ‹è½¯ä»¶åŒ…ä¿¡æ¯</span><br><span class="line">brew info &lt;package name&gt;</span><br><span class="line"></span><br><span class="line"># æŸ¥çœ‹è½¯ä»¶åŒ…ä¸»é¡µ/å®˜ç½‘</span><br><span class="line">brew home &lt;package name&gt;</span><br></pre></td></tr></table></figure><h3 id="è¿›ç¨‹ç®¡ç†"><a href="#è¿›ç¨‹ç®¡ç†" class="headerlink" title="è¿›ç¨‹ç®¡ç†"></a>è¿›ç¨‹ç®¡ç†</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å—ç®¡ç†çš„æœåŠ¡</span></span><br><span class="line">brew services</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç›´æ¥å¯åŠ¨ï¼Œä¸é…ç½®å¼€æœºè‡ªå¯åŠ¨</span></span><br><span class="line">brew services run mysql@8.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœæ­¢æœåŠ¡</span></span><br><span class="line">brew services <span class="built_in">kill</span> mysql@8.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡å¯æœåŠ¡ï¼Œé…ç½®å¼€æœºè‡ªå¯åŠ¨</span></span><br><span class="line">brew services restart mysql@8.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨å¹¶ä¸”é…ç½®å¼€æœºè‡ªå¯åŠ¨</span></span><br><span class="line">brew services start mysql@8.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœæ­¢æœåŠ¡ï¼Œå–æ¶ˆå¼€æœºè‡ªå¯åŠ¨</span></span><br><span class="line">brew services stop mysql@8.0</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…å¸è½½"><a href="#å®‰è£…å¸è½½" class="headerlink" title="å®‰è£…å¸è½½"></a>å®‰è£…å¸è½½</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹éœ€è¦å‡çº§çš„è½¯ä»¶åŒ…</span></span><br><span class="line">brew outdated</span><br><span class="line"></span><br><span class="line"><span class="comment"># é”å®šæŒ‡å®šè½¯ä»¶åŒ…çš„ç‰ˆæœ¬</span></span><br><span class="line">brew pin &lt;package name&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># è§£é™¤å¯¹æŒ‡å®šè½¯ä»¶åŒ…ç‰ˆæœ¬çš„é”å®š</span></span><br><span class="line">brew unpin &lt;package name&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ›´æ–°æŒ‡å®šçš„è½¯ä»¶åŒ…</span></span><br><span class="line">brew update &lt;package name&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ›´æ–°æ‰€æœ‰éœ€è¦å‡çº§çš„è½¯ä»¶åŒ…</span></span><br><span class="line">brew upgrade</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…è®¸ cask ä»“åº“çš„è½¯ä»¶ä¹Ÿèƒ½è¢«æ›´æ–°ï¼ˆå»ºè®®å…³é—­æ‰€æœ‰è½¯ä»¶çš„å†…ç½®æ›´æ–°ï¼Œä»…é€šè¿‡ brew æ›´æ–°ï¼‰</span></span><br><span class="line">brew upgrade --greedy</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å·²ç»å®‰è£…çš„æ‰€æœ‰åŒ…</span></span><br><span class="line">brew list</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æœ‰å“ªäº›æ—§è½¯ä»¶åŒ…ä¼šè¢«æ¸…ç†</span></span><br><span class="line">brew cleanup --dry-run</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¸…ç†æ—§è½¯ä»¶åŒ…</span></span><br><span class="line">brew cleanup</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ—å‡ºå·²ç»å®‰è£…çš„è½¯ä»¶åŒ…</span></span><br><span class="line">brew list</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ—å‡ºå·²ç»å®‰è£…çš„è½¯ä»¶åŒ…åŠç‰ˆæœ¬ä¿¡æ¯</span></span><br><span class="line">brew list --versions</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»¥æ ‘çŠ¶å›¾å±•ç¤ºã€Œå·²å®‰è£…åŒ…ã€çš„ä¾èµ–ä¿¡æ¯</span></span><br><span class="line">brew deps --installed --tree</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…æŒ‡å®šçš„ç‰ˆæœ¬</span></span><br><span class="line">brew install mysql@5.7</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¸è½½åŒ…</span></span><br><span class="line">brew uninstall font-meslo-lg-nerd-font</span><br></pre></td></tr></table></figure><h2 id="å®‰è£…å­—ä½“"><a href="#å®‰è£…å­—ä½“" class="headerlink" title="å®‰è£…å­—ä½“"></a>å®‰è£…å­—ä½“</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># brew æ·»åŠ å­—ä½“åº“</span></span><br><span class="line">brew tap homebrew/cask-fonts</span><br><span class="line"></span><br><span class="line"><span class="comment"># æœç´¢å¯ç”¨ Nerd Font å­—ä½“</span></span><br><span class="line">brew search nerd-font</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…é€‚é…äº†powerlevel10kçš„å­—ä½“</span></span><br><span class="line">brew install homebrew/cask-fonts/font-meslo-for-powerlevel10k</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…ã€Œéœé¹œæ–‡æ¥·ã€å­—ä½“</span></span><br><span class="line">brew install font-lxgw-wenkai</span><br></pre></td></tr></table></figure><h2 id="finder-è®¿è¾¾ä¸ªäººæ”¶è—å˜æˆè‹±æ–‡"><a href="#finder-è®¿è¾¾ä¸ªäººæ”¶è—å˜æˆè‹±æ–‡" class="headerlink" title="finder è®¿è¾¾ä¸ªäººæ”¶è—å˜æˆè‹±æ–‡"></a>finder è®¿è¾¾ä¸ªäººæ”¶è—å˜æˆè‹±æ–‡</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">touch</span> ~/Desktop/.localized</span><br></pre></td></tr></table></figure><p>é‡å¯ finder åå¯æ¢å¤ä¸­æ–‡ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
            <tag> å¸¸ç”¨æ“ä½œ </tag>
            
            <tag> macOS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¼€æºç»„ç½‘å·¥å…·-easytier</title>
      <link href="/posts/sq6bmc/"/>
      <url>/posts/sq6bmc/</url>
      
        <content type="html"><![CDATA[<p>è¿™ä¸ªå·¥å…·æ˜¯åˆ©ç”¨ NAT æ‰“æ´å®ç°ï¼Œéœ€è¦æœ‰ä¸€å°æœåŠ¡å™¨ï¼ˆå¯ä»¥è‡ªå»ºä¹Ÿå¯ä»¥ç”¨å®˜æ–¹æä¾›çš„ï¼‰åšä¸­ä»‹ã€‚ç»æµ‹è¯•æ‰“æ´æˆåŠŸç‡å¾ˆé«˜ï¼Œé€Ÿåº¦ä¹Ÿä¸é”™ã€‚æ‰“æ´æˆåŠŸåï¼Œå¼‚åœ°çš„æœºå™¨å°±åƒåœ¨åŒä¸€ä¸ªå†…ç½‘ä¸€æ ·æ–¹ä¾¿ï¼Œè®¿é—® smbã€å®¶é‡Œçš„ nasã€è¿œç¨‹æ¡Œé¢ç­‰ç­‰ï¼Œå¹¶ä¸”æ”¯æŒè‡ªåŠ¨å¯¹å†…ç½‘ç½‘æ®µè¿›è¡Œè½¬å‘ï¼ˆzerotier éœ€è¦é…ç½® iptables è½¬å‘ï¼‰è‡ªå»ºæœåŠ¡å™¨åæ„Ÿè§‰æ¯” zerotier å¥½ç”¨ã€‚zerotier çš„æ–‡æ¡£å¯ä»¥çœ‹ <a href="/posts/spi492/">ç¾¤æ™–NASéƒ¨ç½²zerotierå†…ç½‘ç©¿é€è®¿é—®</a></p><h2 id="è‡ªå»ºæœåŠ¡ç«¯"><a href="#è‡ªå»ºæœåŠ¡ç«¯" class="headerlink" title="è‡ªå»ºæœåŠ¡ç«¯"></a>è‡ªå»ºæœåŠ¡ç«¯</h2><p>è¿™ä¸ªæ­¥éª¤å¯ä»¥çœç•¥ï¼Œä¸è‡ªå»ºå¯ä»¥ç”¨ç¤¾åŒºæä¾›çš„å…è´¹æœåŠ¡å™¨ã€‚ä½¿ç”¨ç¤¾åŒºæœåŠ¡å™¨æŒ‡å®š <code>-p</code> å‚æ•°ï¼š <code>-p tcp://public.easytier.top:11010</code></p><p>æˆ‘å®‰è£…çš„æ˜¯ easytier çš„ docker ç‰ˆæœ¬ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">rm</span> -f easytier</span><br><span class="line">docker run --name easytier -d \</span><br><span class="line">    --network host \</span><br><span class="line">    -e TZ=Asia/Shanghai \</span><br><span class="line">    --privileged \</span><br><span class="line">    registry.cn-hangzhou.aliyuncs.com/iuxt/easytier:v2.1.2 \</span><br><span class="line">    --ipv4 10.233.233.1 --network-name iuxt --network-secret 6d062b06-e3bb-40ab-849c-a4e5bc19b7ee --vpn-portal wg://0.0.0.0:11013/10.14.14.0/24</span><br></pre></td></tr></table></figure><p>å‚æ•°è¯´æ˜ï¼š</p><ul><li>â€“ipv4 ç»™æœåŠ¡å™¨åˆ†é…çš„è™šæ‹Ÿ IP</li><li>â€“network-name ç½‘ç»œåå­—</li><li>â€“network-secret æ˜¯ç½‘ç»œå¯†é’¥ï¼Œæˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯ç”Ÿæˆçš„ uuidï¼Œè¿™ä¸ªå¯†é’¥åˆ«äººçŸ¥é“äº†ä¹Ÿå¯ä»¥åŠ å…¥ä½ çš„ç½‘ç»œå†…ï¼Œæ‰€ä»¥éœ€è¦ä¿æŠ¤å¥½ã€‚ä¸€ä¸ªæœåŠ¡å™¨å¯ä»¥è®©åŠ å…¥å¤šä¸ªç½‘ç»œã€‚</li><li>â€“vpn-portal å…è®¸ WireGuard æ¥å…¥ï¼Œ<code>0.0.0.0:11013</code> æ˜¯ç›‘å¬åœ°å€ï¼Œ<code>10.14.14.0/24</code> æ˜¯ WireGuard çš„ç½‘æ®µã€‚</li></ul><h2 id="Windows-æœºå™¨ä¸€"><a href="#Windows-æœºå™¨ä¸€" class="headerlink" title="Windows æœºå™¨ä¸€"></a>Windows æœºå™¨ä¸€</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -p å‚æ•°æŒ‡å®šçš„æ˜¯æœåŠ¡å™¨çš„å…¬ç½‘IP</span></span><br><span class="line">easytier-core.exe --ipv4 10.233.233.2 --network-name iuxt --network-secret 6d062b06-e3bb-40ab-849c-a4e5bc19b7ee -p tcp://119.45.171.27:11010</span><br></pre></td></tr></table></figure><h2 id="Windows-æœºå™¨äºŒ"><a href="#Windows-æœºå™¨äºŒ" class="headerlink" title="Windows æœºå™¨äºŒ"></a>Windows æœºå™¨äºŒ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">easytier-core.exe --ipv4 10.233.233.3 --network-name iuxt --network-secret 6d062b06-e3bb-40ab-849c-a4e5bc19b7ee -p tcp://119.45.171.27:11010</span><br></pre></td></tr></table></figure><h2 id="ç¾¤æ™–-nas-éƒ¨ç½²"><a href="#ç¾¤æ™–-nas-éƒ¨ç½²" class="headerlink" title="ç¾¤æ™– nas éƒ¨ç½²"></a>ç¾¤æ™– nas éƒ¨ç½²</h2><p>å¯ä»¥åŠ å¤šä¸ª -n å‚æ•°æŒ‡å®šå¤šä¸ªç½‘æ®µã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker run --name easytier -d \</span><br><span class="line">    --network host \</span><br><span class="line">    -e TZ=Asia/Shanghai \</span><br><span class="line">    --privileged \</span><br><span class="line">    registry.cn-hangzhou.aliyuncs.com/iuxt/easytier:v2.1.2 \</span><br><span class="line">    --ipv4 10.233.233.11 --network-name iuxt --network-secret 6d062b06-e3bb-40ab-849c-a4e5bc19b7ee -n 192.168.1.0/24 -p tcp://119.45.171.27:11010</span><br></pre></td></tr></table></figure><p>å‚æ•°è¯´æ˜ï¼š</p><ul><li>-n è¿™é‡Œå†™äº†å†…ç½‘çš„ç½‘æ®µï¼Œæ„æ€æ˜¯è¿™ä¸ªç½‘æ®µçš„ IP é€šè¿‡è¿™å°æœºå™¨æ¥ä»£ç†è½¬å‘ï¼Œåœ¨å…¶ä»–æœºå™¨ä¸Šå¯ä»¥ç›´æ¥è®¿é—®è¿™ä¸ªç½‘æ®µçš„ä»»æ„ IP</li></ul><h2 id="Windows-å®‰è£…æœåŠ¡"><a href="#Windows-å®‰è£…æœåŠ¡" class="headerlink" title="Windows å®‰è£…æœåŠ¡"></a>Windows å®‰è£…æœåŠ¡</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŒ‡å®šå‚æ•°å®‰è£…æˆæœåŠ¡</span></span><br><span class="line">easytier-cli.exe service install --ipv4 10.233.233.3 --network-name iuxt --network-secret 6d062b06-e3bb-40ab-849c-a4e5bc19b7ee -n 192.168.22.0/24 -n 192.168.1.0/24 -p tcp://119.45.171.27:11010</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¸è½½æœåŠ¡</span></span><br><span class="line">easytier-cli.exe service uninstall</span><br></pre></td></tr></table></figure><h2 id="ç”Ÿæˆ-WireGuard-é…ç½®æ–‡ä»¶"><a href="#ç”Ÿæˆ-WireGuard-é…ç½®æ–‡ä»¶" class="headerlink" title="ç”Ÿæˆ WireGuard é…ç½®æ–‡ä»¶"></a>ç”Ÿæˆ WireGuard é…ç½®æ–‡ä»¶</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œ</span></span><br><span class="line">docker <span class="built_in">exec</span> easytier easytier-cli vpn-portal &gt; wireguard.conf</span><br></pre></td></tr></table></figure><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Interface]</span></span><br><span class="line"><span class="attr">PrivateKey</span> = h3MxzS7aLWDlX6l1xAJA8wooj58N0lg6UPV+n2q7FkM=</span><br><span class="line"><span class="attr">Address</span> = <span class="number">10.14</span>.<span class="number">14.10</span>/<span class="number">32</span>    <span class="comment"># è¿™é‡Œä¿®æ”¹æˆæœ¬æœºçš„è™šæ‹ŸIP</span></span><br><span class="line"></span><br><span class="line"><span class="section">[Peer]</span></span><br><span class="line"><span class="attr">PublicKey</span> = Mp7H/sHXZW+NqxrtsPnEtHMWIbFWPYjyxEir3uWY3WA=</span><br><span class="line"><span class="attr">AllowedIPs</span> = <span class="number">10.233</span>.<span class="number">233.0</span>/<span class="number">24</span>,<span class="number">10.14</span>.<span class="number">14.0</span>/<span class="number">24</span>      <span class="comment"># è¿™äº›ç½‘æ®µèµ°wireguardè½¬å‘</span></span><br><span class="line"><span class="attr">Endpoint</span> = <span class="number">119.45</span>.<span class="number">171.27</span>:<span class="number">11013</span>                  <span class="comment"># æœåŠ¡å™¨çš„wireguardæ¥å£åœ°å€</span></span><br><span class="line"><span class="attr">PersistentKeepalive</span> = <span class="number">25</span></span><br></pre></td></tr></table></figure><h2 id="windows-é˜²ç«å¢™é…ç½®"><a href="#windows-é˜²ç«å¢™é…ç½®" class="headerlink" title="windows é˜²ç«å¢™é…ç½®"></a>windows é˜²ç«å¢™é…ç½®</h2><p>ä¸èƒ½è¿æ¥è®°å¾—é˜²ç«å¢™æ”¾é€š easytier çš„è™šæ‹Ÿç½‘æ®µå’Œ wireguard ç½‘æ®µã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">New-NetFirewallRule</span> <span class="literal">-DisplayName</span> <span class="string">&quot;Allow Subnet 10.233.233.0/24&quot;</span> <span class="literal">-Direction</span> Inbound <span class="literal">-Action</span> Allow <span class="literal">-RemoteAddress</span> <span class="number">10.233</span>.<span class="number">233.0</span>/<span class="number">24</span> <span class="literal">-Protocol</span> Any <span class="literal">-Enabled</span> True</span><br><span class="line"><span class="built_in">New-NetFirewallRule</span> <span class="literal">-DisplayName</span> <span class="string">&quot;Allow Subnet 10.14.14.0/24&quot;</span> <span class="literal">-Direction</span> Inbound <span class="literal">-Action</span> Allow <span class="literal">-RemoteAddress</span> <span class="number">10.14</span>.<span class="number">14.0</span>/<span class="number">24</span> <span class="literal">-Protocol</span> Any <span class="literal">-Enabled</span> True</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç½‘ç»œ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>shellè„šæœ¬è·å–è‡ªèº«çš„ä¿¡æ¯</title>
      <link href="/posts/lrcy3q4o/"/>
      <url>/posts/lrcy3q4o/</url>
      
        <content type="html"><![CDATA[<p>å†™ shell è„šæœ¬ï¼Œ æœ‰æ—¶å€™éœ€è¦è·å–ä¸€äº›ä¿¡æ¯ï¼Œ æ¯”å¦‚è¿™ä¸ªè„šæœ¬çš„åå­—ï¼Œè„šæœ¬æ‰€åœ¨çš„ç›®å½•ï¼Œè„šæœ¬çš„ç»å¯¹è·¯å¾„ï¼Œ è¿™ä¸ªè„šæœ¬çš„ pidï¼Œ å‚æ•°ç­‰ã€‚</p><table><thead><tr><th>å˜é‡</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>$0</td><td>è„šæœ¬è‡ªèº«çš„è·¯å¾„ï¼ˆæ‰§è¡Œçš„æ—¶å€™è°ƒç”¨è·¯å¾„ï¼‰</td></tr><tr><td>$1</td><td>ç¬¬ä¸€ä¸ªå‚æ•°</td></tr><tr><td>$?</td><td>ä¸Šä¸€ä¸ªè„šæœ¬çš„è¿”å›å€¼ï¼Œ0ä¸ºæ­£å¸¸</td></tr><tr><td>$*</td><td>æ‰€æœ‰çš„å‚æ•°</td></tr><tr><td>$#</td><td>å‚æ•°çš„ä¸ªæ•°</td></tr><tr><td>$$</td><td>å½“å‰è„šæœ¬çš„pid</td></tr><tr><td>$_</td><td>ä¸Šä¸€æ¡å‘½ä»¤çš„å‚æ•°</td></tr></tbody></table><h2 id="è·å–è„šæœ¬çš„æ–‡ä»¶å"><a href="#è·å–è„šæœ¬çš„æ–‡ä»¶å" class="headerlink" title="è·å–è„šæœ¬çš„æ–‡ä»¶å"></a>è·å–è„šæœ¬çš„æ–‡ä»¶å</h2><p><code>$0</code> æ˜¯è„šæœ¬çš„è·¯å¾„ï¼Œè¿™ä¸ªè·¯å¾„æœ‰å¯èƒ½æ˜¯ç›¸å¯¹è·¯å¾„ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ dirname å’Œ basename é…åˆæ¥è·å–è„šæœ¬ç»å¯¹è·¯å¾„</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è„šæœ¬æ‰€åœ¨çš„ç›®å½•çš„ç»å¯¹è·¯å¾„</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="subst">$(cd $(dirname $0)</span>; pwd)&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è„šæœ¬çš„æ–‡ä»¶å</span></span><br><span class="line"><span class="built_in">echo</span> $(<span class="built_in">basename</span> <span class="variable">$0</span>)</span><br></pre></td></tr></table></figure><h2 id="è·å–è„šæœ¬çš„ç»å¯¹è·¯å¾„"><a href="#è·å–è„šæœ¬çš„ç»å¯¹è·¯å¾„" class="headerlink" title="è·å–è„šæœ¬çš„ç»å¯¹è·¯å¾„"></a>è·å–è„šæœ¬çš„ç»å¯¹è·¯å¾„</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è·å–è„šæœ¬çš„ç»å¯¹è·¯å¾„</span></span><br><span class="line">DIR=$(<span class="built_in">cd</span> $(<span class="built_in">dirname</span> <span class="variable">$0</span>); <span class="built_in">pwd</span>)</span><br><span class="line">FILE=$(<span class="built_in">basename</span> <span class="variable">$0</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;DIR&#125;</span>/<span class="variable">$&#123;FILE&#125;</span>&quot;</span></span><br></pre></td></tr></table></figure><h2 id="è¿›å…¥ä¸´æ—¶ç›®å½•"><a href="#è¿›å…¥ä¸´æ—¶ç›®å½•" class="headerlink" title="è¿›å…¥ä¸´æ—¶ç›®å½•"></a>è¿›å…¥ä¸´æ—¶ç›®å½•</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># $_ æŒ‡çš„æ˜¯ä¸Šä¸€ä¸ªå‘½ä»¤çš„å‚æ•°ï¼Œè¿™ä¸ªé‡Œé¢æŒ‡çš„å°±æ˜¯temp</span></span><br><span class="line"><span class="built_in">mkdir</span> temp &amp;&amp; <span class="built_in">cd</span> <span class="variable">$_</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å‘½ä»¤è¡Œå·¥å…· </tag>
            
            <tag> cli </tag>
            
            <tag> Shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxå¤§æ–‡ä»¶åˆ†å‰²ä¸åˆå¹¶</title>
      <link href="/posts/lra06cl1/"/>
      <url>/posts/lra06cl1/</url>
      
        <content type="html"><![CDATA[<p>æœåŠ¡å™¨ä¸Šæœ‰ä¸ªæ–‡ä»¶éœ€è¦ä¸‹è½½åˆ°æœ¬åœ°, ä½†æ˜¯æ–‡ä»¶è¾ƒå¤§, æˆ‘ä»¬éƒ½æ˜¯é€šè¿‡ jumpserver è¿æ¥çš„, é€šè¿‡ jumpserver ä¸‹è½½éš¾å…ä¼šé‡åˆ°ç½‘ç»œæ³¢åŠ¨ç­‰å¯¼è‡´ä¸‹è½½å¤±è´¥, æˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ†å‰²å¤§æ–‡ä»¶æˆä¸€ä¸ªä¸ªå°æ–‡ä»¶, ç„¶åä¸‹è½½åå†åœ¨æœ¬åœ°åˆå¹¶. ç”¨åˆ°çš„å‘½ä»¤æ˜¯ split</p><h2 id="split-åˆ†å‰²å¤§æ–‡ä»¶"><a href="#split-åˆ†å‰²å¤§æ–‡ä»¶" class="headerlink" title="split åˆ†å‰²å¤§æ–‡ä»¶"></a>split åˆ†å‰²å¤§æ–‡ä»¶</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">split</span> -b 1024M -d -a 3 2023.tar.gz tmp.</span><br></pre></td></tr></table></figure><p>å‚æ•°è¯´æ˜:</p><table><thead><tr><th>å‚æ•°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>-b</td><td>æŒ‡å®šæ¯ä¸ªæ–‡ä»¶çš„å¤§å°, æ”¯æŒ K M G</td></tr><tr><td>-d</td><td>æŒ‡å®šåç¼€ç¼–ç ä¸ºæ•°å­—ï¼Œé»˜è®¤ç¼–ç ä¸ºå­—æ¯</td></tr><tr><td>-a</td><td>æŒ‡å®šåç¼€é•¿åº¦,3 è¡¨ç¤º 3 ä½æ•°, æ¯”å¦‚ä¸Šé¢çš„å‘½ä»¤, ç”Ÿæˆçš„æ–‡ä»¶å°±æ˜¯ tmp.000 â€¦</td></tr><tr><td>.&#x2F;tmp.</td><td>è¿™ä¸ªæ˜¯ç”Ÿæˆçš„æ–‡ä»¶åå‰é¢çš„éƒ¨åˆ†</td></tr></tbody></table><p>å¦‚æœæŠ¥é”™ <code>split: output file suffixes exhausted</code> è¯´æ˜åç¼€ä¸å¤Ÿç”¨äº†, æ¯”å¦‚å‚æ•° <code>-a 1 </code> æ”¯æŒçš„åç¼€ä¸º 0 - 9 , å¦‚æœæ–‡ä»¶å¤ªå¤§, è¶…è¿‡äº† 9, å°±ä¼šæŠ¥è¿™ä¸ªé”™.</p><h2 id="ä½¿ç”¨-cat-åˆå¹¶å¤§æ–‡ä»¶"><a href="#ä½¿ç”¨-cat-åˆå¹¶å¤§æ–‡ä»¶" class="headerlink" title="ä½¿ç”¨ cat åˆå¹¶å¤§æ–‡ä»¶"></a>ä½¿ç”¨ cat åˆå¹¶å¤§æ–‡ä»¶</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> tmp.* &gt; 2023.tar.gz</span><br></pre></td></tr></table></figure><p>åˆå¹¶å®Œæˆå†éªŒè¯ä¸€ä¸‹ MD5 å€¼, å’ŒæœåŠ¡å™¨åšä¸‹å¯¹æ¯”å³å¯.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">md5sum</span> 2023.tar.gz</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å‘½ä»¤è¡Œå·¥å…· </tag>
            
            <tag> cli </tag>
            
            <tag> Linux </tag>
            
            <tag> æ–‡ä»¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu 22.04 å†…æ ¸ç›¸å…³æ“ä½œ</title>
      <link href="/posts/lr8yc0vu/"/>
      <url>/posts/lr8yc0vu/</url>
      
        <content type="html"><![CDATA[<p>æ–‡ç« å†…å®¹åœ¨ Ubuntu 22.04 ç³»ç»Ÿä¸‹æµ‹è¯•æˆåŠŸ, ç‰ˆæœ¬ç›¸å·®è¿‡å¤§è¯·è‡ªæµ‹ã€‚</p><h2 id="å¼€æœºæ˜¾ç¤ºå¯åŠ¨é¡¹"><a href="#å¼€æœºæ˜¾ç¤ºå¯åŠ¨é¡¹" class="headerlink" title="å¼€æœºæ˜¾ç¤ºå¯åŠ¨é¡¹"></a>å¼€æœºæ˜¾ç¤ºå¯åŠ¨é¡¹</h2><p>æ–°ç‰ˆ Ubuntu å¥½åƒé»˜è®¤ä¸æ˜¾ç¤ºå¯åŠ¨é¡¹è€Œç›´æ¥è¿›å…¥ç³»ç»Ÿäº†ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹ <code>/etc/default/grub</code> æ¥å®ç°å¼€æœºæ˜¾ç¤ºå¯åŠ¨é€‰é¡¹åˆ—è¡¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ³¨é‡Šæ‰è¿™ä¸€è¡Œ</span></span><br><span class="line"><span class="comment"># GRUB_TIMEOUT_STYLE=hidden</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿™ä¸€è¡Œæ˜¯åœ¨grubç•Œé¢ç­‰å¾…çš„æ—¶é—´ï¼Œå•ä½s</span></span><br><span class="line">GRUB_TIMEOUT=30</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹å®Œæˆåæ‰§è¡Œ <code>sudo update-grub</code> æ›´æ–° grub é…ç½®</p><div class="note warning flat"><p>ä¸‹é¢ä¸¤ç§æ–¹å¼äºŒé€‰ä¸€å³å¯ã€‚</p></div><h2 id="æ›´æ¢ä½¿ç”¨çš„å†…æ ¸ç‰ˆæœ¬ï¼ˆé€šè¿‡å¯åŠ¨é¡¹-uuid-æŒ‡å®šæ–¹å¼ï¼‰"><a href="#æ›´æ¢ä½¿ç”¨çš„å†…æ ¸ç‰ˆæœ¬ï¼ˆé€šè¿‡å¯åŠ¨é¡¹-uuid-æŒ‡å®šæ–¹å¼ï¼‰" class="headerlink" title="æ›´æ¢ä½¿ç”¨çš„å†…æ ¸ç‰ˆæœ¬ï¼ˆé€šè¿‡å¯åŠ¨é¡¹ uuid æŒ‡å®šæ–¹å¼ï¼‰"></a>æ›´æ¢ä½¿ç”¨çš„å†…æ ¸ç‰ˆæœ¬ï¼ˆé€šè¿‡å¯åŠ¨é¡¹ uuid æŒ‡å®šæ–¹å¼ï¼‰</h2><h3 id="æŸ¥çœ‹å½“å‰åœ¨ç”¨çš„å†…æ ¸ç‰ˆæœ¬"><a href="#æŸ¥çœ‹å½“å‰åœ¨ç”¨çš„å†…æ ¸ç‰ˆæœ¬" class="headerlink" title="æŸ¥çœ‹å½“å‰åœ¨ç”¨çš„å†…æ ¸ç‰ˆæœ¬"></a>æŸ¥çœ‹å½“å‰åœ¨ç”¨çš„å†…æ ¸ç‰ˆæœ¬</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">uname</span> -r</span><br></pre></td></tr></table></figure><p>6.5.0-14-generic</p><h3 id="æŸ¥çœ‹ç³»ç»Ÿå¯åŠ¨é¡¹"><a href="#æŸ¥çœ‹ç³»ç»Ÿå¯åŠ¨é¡¹" class="headerlink" title="æŸ¥çœ‹ç³»ç»Ÿå¯åŠ¨é¡¹"></a>æŸ¥çœ‹ç³»ç»Ÿå¯åŠ¨é¡¹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹&#x27;Advanced options for Ubuntu&#x27;é€‰é¡¹çš„uuid</span></span><br><span class="line">grep <span class="string">&quot;submenu &#x27;Advanced options for Ubuntu&#x27;&quot;</span> /boot/grub/grub.cfg | awk -F\&#x27; <span class="string">&#x27;&#123;print $(NF-1)&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ å†…æ ¸ç‰ˆæœ¬é€‰é¡¹</span></span><br><span class="line">grep <span class="string">&quot;menuentry_id_option &quot;</span> /boot/grub/grub.cfg | awk -F\&#x27; <span class="string">&#x27;&#123;print $(NF-1)&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>æ¯”å¦‚ â€˜Advanced options for Ubuntuâ€™ é€‰é¡¹çš„ uuid æ˜¯ <code>gnulinux-advanced-89ee03ba-6808-4977-a4fb-9b10174744f8</code> å†…æ ¸ç‰ˆæœ¬å¯åŠ¨é¡¹æ˜¯ <code>gnulinux-5.15.0-1005-azure-advanced-89ee03ba-6808-4977-a4fb-9b10174744f8</code> é‚£ä¹ˆæœ€ç»ˆçš„å¯åŠ¨é¡¹é…ç½®å°±æ˜¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gnulinux-advanced-89ee03ba-6808-4977-a4fb-9b10174744f8&gt;gnulinux-5.15.0-1005-azure-advanced-89ee03ba-6808-4977-a4fb-9b10174744f8</span><br></pre></td></tr></table></figure><p>uuid å¯¹åº”å…³ç³»ï¼š<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202401112216030.png" alt="image.png"></p><p>å¯¹åº”çš„å¯åŠ¨ç•Œé¢ submenu:<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202401112224241.png" alt="image.png"></p><p>å¯¹åº”çš„å¯åŠ¨ç•Œé¢ menuentry:<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202401112225292.png" alt="image.png"></p><h3 id="ä¿®æ”¹é»˜è®¤å¯åŠ¨é¡¹"><a href="#ä¿®æ”¹é»˜è®¤å¯åŠ¨é¡¹" class="headerlink" title="ä¿®æ”¹é»˜è®¤å¯åŠ¨é¡¹"></a>ä¿®æ”¹é»˜è®¤å¯åŠ¨é¡¹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/default/grub</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ä¸ºä¸Šä¸€æ­¥ç”Ÿæˆçš„ å¯åŠ¨é¡¹é…ç½®</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">GRUB_DEFAULT</span>=<span class="string">&#x27;gnulinux-advanced-89ee03ba-6808-4977-a4fb-9b10174744f8&gt;gnulinux-5.15.0-1005-azure-advanced-89ee03ba-6808-4977-a4fb-9b10174744f8&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="æ›´æ–°é…ç½®"><a href="#æ›´æ–°é…ç½®" class="headerlink" title="æ›´æ–°é…ç½®"></a>æ›´æ–°é…ç½®</h3><p>æ›´æ–°é…ç½®æ–‡ä»¶åˆ° <code>/boot/grub/grub.cfg</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo update-grub</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Sourcing file `/etc/default/grub<span class="string">&#x27;</span></span><br><span class="line"><span class="string">Sourcing file `/etc/default/grub.d/init-select.cfg&#x27;</span></span><br><span class="line">Generating grub configuration file ...</span><br><span class="line">Found linux image: /boot/vmlinuz-6.5.0-14-generic</span><br><span class="line">Found initrd image: /boot/initrd.img-6.5.0-14-generic</span><br><span class="line">Found linux image: /boot/vmlinuz-5.15.0-40-generic</span><br><span class="line">Found initrd image: /boot/initrd.img-5.15.0-40-generic</span><br><span class="line">Found memtest86+ image: /boot/memtest86+.elf</span><br><span class="line">Found memtest86+ image: /boot/memtest86+.bin</span><br><span class="line">Warning: os-prober will not be executed to detect other bootable partitions.</span><br><span class="line">Systems on them will not be added to the GRUB boot configuration.</span><br><span class="line">Check GRUB_DISABLE_OS_PROBER documentation entry.</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><h2 id="æ›´æ¢ä½¿ç”¨çš„å†…æ ¸ç‰ˆæœ¬ï¼ˆé€šè¿‡è®°å½•ä¸Šä¸€æ¬¡é€‰æ‹©çš„å†…æ ¸ï¼‰"><a href="#æ›´æ¢ä½¿ç”¨çš„å†…æ ¸ç‰ˆæœ¬ï¼ˆé€šè¿‡è®°å½•ä¸Šä¸€æ¬¡é€‰æ‹©çš„å†…æ ¸ï¼‰" class="headerlink" title="æ›´æ¢ä½¿ç”¨çš„å†…æ ¸ç‰ˆæœ¬ï¼ˆé€šè¿‡è®°å½•ä¸Šä¸€æ¬¡é€‰æ‹©çš„å†…æ ¸ï¼‰"></a>æ›´æ¢ä½¿ç”¨çš„å†…æ ¸ç‰ˆæœ¬ï¼ˆé€šè¿‡è®°å½•ä¸Šä¸€æ¬¡é€‰æ‹©çš„å†…æ ¸ï¼‰</h2><p>sudo vim &#x2F;etc&#x2F;default&#x2F;grub</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®¾ç½®ä¸ºä¿å­˜è®°å½•</span></span><br><span class="line"><span class="attr">GRUB_SAVEDEFAULT</span>=<span class="literal">true</span></span><br><span class="line"><span class="attr">GRUB_DEFAULT</span>=saved</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ³¨é‡Šæ‰è¿™ä¸€è¡Œï¼Œä½¿grubé€‰é¡¹æ˜¾ç¤º</span></span><br><span class="line"><span class="comment"># GRUB_TIMEOUT_STYLE=hidden</span></span><br><span class="line"><span class="attr">GRUB_TIMEOUT</span>=<span class="number">10</span></span><br></pre></td></tr></table></figure><p>æ›´æ–° grub é…ç½®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo update-grub</span><br></pre></td></tr></table></figure><p>é‡å¯åï¼Œ é€‰æ‹©ä½ æƒ³ä½¿ç”¨çš„å†…æ ¸ï¼Œ ä¸‹æ¬¡é‡å¯å°±ä¼šè‡ªåŠ¨é€‰æ‹©æ­¤å†…æ ¸</p><div class="note danger flat"><p>æ³¨æ„ï¼š å¯ä»¥åœ¨é€‰æ‹©å¥½å†…æ ¸åï¼Œå†æŠŠ grub ç•Œé¢éšè—æ‰ã€‚é¿å…è¯¯æ“ä½œã€‚</p></div>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
            <tag> Kernel </tag>
            
            <tag> Ubuntu </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è·å–Kubernetesçš„token</title>
      <link href="/posts/lr0clio1/"/>
      <url>/posts/lr0clio1/</url>
      
        <content type="html"><![CDATA[<h2 id="è·å–-admin-çš„-token"><a href="#è·å–-admin-çš„-token" class="headerlink" title="è·å– admin çš„ token"></a>è·å– admin çš„ token</h2><p>å¦‚æœæœ‰è¿™ä¸ª secret, å¯ä»¥ç›´æ¥æŸ¥çœ‹ token</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl -n kube-system get secret admin-token-nwphb -o jsonpath=&#123;.data.token&#125; | <span class="built_in">base64</span> -d</span><br></pre></td></tr></table></figure><h2 id="æ–°ç‰ˆ-k8s-å‘½ä»¤ä¸º"><a href="#æ–°ç‰ˆ-k8s-å‘½ä»¤ä¸º" class="headerlink" title="æ–°ç‰ˆ k8s å‘½ä»¤ä¸º"></a>æ–°ç‰ˆ k8s å‘½ä»¤ä¸º</h2><p>é€‰æ‹©ä¸€ä¸ªç°æœ‰çš„ serviceaccount</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get serviceaccount</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨è¿™ä¸ª serviceaccount åˆ›å»ºä¸€ä¸ª token(å¹¶è®¾ç½®æœ‰æ•ˆæœŸ)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create token default --duration 10m</span><br></pre></td></tr></table></figure><h2 id="æ–°å»ºä¸€ä¸ªç”¨æˆ·è·å–-token"><a href="#æ–°å»ºä¸€ä¸ªç”¨æˆ·è·å–-token" class="headerlink" title="æ–°å»ºä¸€ä¸ªç”¨æˆ·è·å– token"></a>æ–°å»ºä¸€ä¸ªç”¨æˆ·è·å– token</h2><p>å¦‚æœè€ƒè™‘åˆ°æƒé™æ²¡æœ‰åˆé€‚çš„,æˆ–è€…æ²¡æœ‰ç›¸å…³çš„ secret,å¯ä»¥é€šè¿‡åˆ›å»ºä¸€ä¸ªæ–°çš„ç”¨æˆ·æ¥è·å– token</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kubectl create serviceaccount admin-sa</span><br><span class="line"></span><br><span class="line">kubectl create clusterrolebinding admin-sa-binding --clusterrole=cluster-admin --serviceaccount=default:admin-sa</span><br><span class="line"></span><br><span class="line">kubectl create token admin-sa --duration 10m</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å®¹å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
            <tag> Kubernetes </tag>
            
            <tag> è®°å½• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é˜¿é‡Œäº‘ACKä¸­Nginx ingressä½¿ç”¨CLBä¸Šçš„Httpsè¯ä¹¦</title>
      <link href="/posts/lr01lzch/"/>
      <url>/posts/lr01lzch/</url>
      
        <content type="html"><![CDATA[<p>èƒŒæ™¯: æˆ‘ä»¬åœ¨å®¢æˆ·é‚£é‡Œéƒ¨ç½²äº†ä¸€å¥—æœåŠ¡, æœåŠ¡è¿è¡Œåœ¨å®¢æˆ·æä¾›çš„ ACK é›†ç¾¤, æˆ‘ä»¬åˆ é™¤äº†å®¢æˆ· ACK è‡ªå¸¦çš„ nginx ingress, é€šè¿‡è‡ªå»ºçš„æ–¹å¼éƒ¨ç½²äº†ä¸¤å¥— ingress, ä¸€å¥—ç»‘å®šäº†å…¬ç½‘ å››å±‚ CLB, ä¸€å¥—ç»‘å®šäº†å†…ç½‘ å››å±‚ CLB, ä¹Ÿå°±æ˜¯è¯´æ˜¯ CLB è½¬å‘åˆ° ingress, ç„¶åé€šè¿‡ ingress è½¬å‘åˆ°å…¶ä»–æœåŠ¡. ç°åœ¨éœ€è¦é…ç½® Https è¯ä¹¦, å®¢æˆ·ä¸åŒæ„æˆ‘ä»¬é…ç½®è¯ä¹¦åˆ° ingress, å®¢æˆ·å°†è¯ä¹¦æ”¾åœ¨äº† CLB ä¸Š, ç»™äº†ä¸€ä¸ªè¯ä¹¦ ID</p><h2 id="æŸ¥è¯¢é˜¿é‡Œäº‘æ–‡æ¡£"><a href="#æŸ¥è¯¢é˜¿é‡Œäº‘æ–‡æ¡£" class="headerlink" title="æŸ¥è¯¢é˜¿é‡Œäº‘æ–‡æ¡£"></a>æŸ¥è¯¢é˜¿é‡Œäº‘æ–‡æ¡£</h2><p>é˜¿é‡Œäº‘çš„æ–‡æ¡£è¿˜æ˜¯å¾ˆè¯¦ç»†, é€šè¿‡ google æŸ¥è¯¢åˆ°æ–‡æ¡£åœ°å€: <a href="https://help.aliyun.com/zh/ack/ack-managed-and-ack-dedicated/user-guide/add-annotations-to-the-yaml-file-of-a-service-to-configure-clb-instances">é€šè¿‡Annotationé…ç½®ä¼ ç»Ÿå‹è´Ÿè½½å‡è¡¡CLB</a></p><p>å…·ä½“å¯ä»¥æŸ¥çœ‹è¿™é‡Œ</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202401051108111.png" alt="image.png"></p><p>HTTPS è¯·æ±‚ä¼šåœ¨ CLB å±‚è§£å¯†ï¼Œç„¶åä»¥ HTTP è¯·æ±‚çš„å½¢å¼å‘é€ç»™åç«¯çš„ Podã€‚</p><blockquote><p>è¿™ä¸ªåœ¨è…¾è®¯äº‘çš„å››å±‚è´Ÿè½½å‡è¡¡é‡Œå« TCP SSL ç›‘å¬å™¨ã€‚</p></blockquote><h2 id="é…ç½®-LoadBalancer-ç±»å‹çš„-Service"><a href="#é…ç½®-LoadBalancer-ç±»å‹çš„-Service" class="headerlink" title="é…ç½® LoadBalancer ç±»å‹çš„ Service"></a>é…ç½® LoadBalancer ç±»å‹çš„ Service</h2><p>å› ä¸ºæˆ‘ä»¬çš„ CLB æ˜¯åªç»™ ingress ä½¿ç”¨, æ‰€ä»¥ä¿®æ”¹ ingress çš„ Service é…ç½® yaml:</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">service.beta.kubernetes.io/alibaba-cloud-loadbalancer-force-override-listeners:</span> <span class="string">&#x27;true&#x27;</span></span><br><span class="line">    <span class="attr">service.beta.kubernetes.io/alibaba-cloud-loadbalancer-id:</span> <span class="string">lb-&lt;è´Ÿè½½å‡è¡¡ID&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ–°å¢äº†ä¸‹é¢ä¸¤è¡Œ</span></span><br><span class="line">    <span class="attr">service.beta.kubernetes.io/alibaba-cloud-loadbalancer-protocol-port:</span> <span class="string">&quot;https:443,http:80&quot;</span></span><br><span class="line">    <span class="attr">service.beta.kubernetes.io/alibaba-cloud-loadbalancer-cert-id:</span> <span class="string">&quot;&lt;è¯ä¹¦çš„ID&gt;&quot;</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/component:</span> <span class="string">public-controller</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/instance:</span> <span class="string">public-ingress-nginx</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/name:</span> <span class="string">public-ingress-nginx</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/part-of:</span> <span class="string">public-ingress-nginx</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/version:</span> <span class="number">1.6</span><span class="number">.4</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">public-ingress-nginx-controller</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">nginx-ingress</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ipFamilies:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">IPv4</span></span><br><span class="line">  <span class="attr">ipFamilyPolicy:</span> <span class="string">SingleStack</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">appProtocol:</span> <span class="string">http</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">http</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="string">http</span></span><br><span class="line">    <span class="attr">nodePort:</span> <span class="number">31080</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">appProtocol:</span> <span class="string">https</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">https</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">443</span></span><br><span class="line">    <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">    <span class="attr">nodePort:</span> <span class="number">31443</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="string">https</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/component:</span> <span class="string">public-controller</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/instance:</span> <span class="string">public-ingress-nginx</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/name:</span> <span class="string">public-ingress-nginx</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">LoadBalancer</span></span><br></pre></td></tr></table></figure><h2 id="CLB-åç«¯ç«¯å£é…ç½®é—®é¢˜"><a href="#CLB-åç«¯ç«¯å£é…ç½®é—®é¢˜" class="headerlink" title="CLB åç«¯ç«¯å£é…ç½®é—®é¢˜"></a>CLB åç«¯ç«¯å£é…ç½®é—®é¢˜</h2><p>ç…§ç€ä¸Šé¢æ­¥éª¤é…ç½®äº†ä»¥å, Https è®¿é—®è¯ä¹¦æ˜¯ç”Ÿæ•ˆäº†, ä½†æ˜¯æ²¡æ³•è½¬å‘åˆ°åç«¯, ä¼šæŠ¥é”™: <code>The plain HTTP request was sent to HTTPS port</code></p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202401051117258.png" alt="image.png"></p><h3 id="åŸå› åˆ†æ"><a href="#åŸå› åˆ†æ" class="headerlink" title="åŸå› åˆ†æ:"></a>åŸå› åˆ†æ:</h3><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/20250109154725382.png" alt="image.png"></p><p>è¿™é‡Œ https è¯·æ±‚åœ¨ CLB è§£å¯†å, è¯·æ±‚åé¢çš„ Ingress æ˜¯ç”¨ http åè®®æ¥è¯·æ±‚çš„, æŒ‰é“ç†æ˜¯æ‰€æœ‰è¯·æ±‚éƒ½åˆ° ingress-controller çš„ HTTP ç«¯å£ æ‰å¯¹ï¼ˆå¦‚ä¸Šå›¾ï¼‰, å¦‚æœå°† TCP SSL çš„åç«¯é…ç½®æˆäº† HTTPS å°±ä¼šå‡ºç°æŠ¥é”™: <code>The plain HTTP request was sent to HTTPS port</code></p><h3 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p>ç¬¬ä¸€ç§æ–¹æ³•ï¼Œä¿®æ”¹ CLB é…ç½®ï¼Œåç«¯æŒ‡å‘ HTTP ç«¯å£ã€‚<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/20250109155853273.png" alt="Pasted image 20250109153734.webp|910"></p><p>ç¬¬äºŒç§æ–¹æ³•ï¼šå°† service çš„ 443 ç«¯å£ä¹Ÿè½¬å‘åˆ° pod çš„ 80 ç«¯å£å³å¯. å¯¹åº”çš„ yaml æ–‡ä»¶:</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">service.beta.kubernetes.io/alibaba-cloud-loadbalancer-force-override-listeners:</span> <span class="string">&#x27;true&#x27;</span></span><br><span class="line">    <span class="attr">service.beta.kubernetes.io/alibaba-cloud-loadbalancer-id:</span> <span class="string">lb-&lt;è´Ÿè½½å‡è¡¡ID&gt;</span></span><br><span class="line">    <span class="attr">service.beta.kubernetes.io/alibaba-cloud-loadbalancer-protocol-port:</span> <span class="string">&quot;https:443,http:80&quot;</span></span><br><span class="line">    <span class="attr">service.beta.kubernetes.io/alibaba-cloud-loadbalancer-cert-id:</span> <span class="string">&quot;&lt;è¯ä¹¦çš„ID&gt;&quot;</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/component:</span> <span class="string">public-controller</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/instance:</span> <span class="string">public-ingress-nginx</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/name:</span> <span class="string">public-ingress-nginx</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/part-of:</span> <span class="string">public-ingress-nginx</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/version:</span> <span class="number">1.6</span><span class="number">.4</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">public-ingress-nginx-controller</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">nginx-ingress</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ipFamilies:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">IPv4</span></span><br><span class="line">  <span class="attr">ipFamilyPolicy:</span> <span class="string">SingleStack</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">appProtocol:</span> <span class="string">http</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">http</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="string">http</span></span><br><span class="line">    <span class="attr">nodePort:</span> <span class="number">31080</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">appProtocol:</span> <span class="string">https</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">https</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">443</span></span><br><span class="line">    <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">    <span class="attr">nodePort:</span> <span class="number">31443</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># è¿™é‡ŒæŠŠhttpsæ”¹æˆhttpå³å¯</span></span><br><span class="line">    <span class="comment"># targetPort: https</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="string">http</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/component:</span> <span class="string">public-controller</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/instance:</span> <span class="string">public-ingress-nginx</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/name:</span> <span class="string">public-ingress-nginx</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">LoadBalancer</span></span><br></pre></td></tr></table></figure><p>æŠŠè¿™é‡Œçš„ <code>targetPort: https</code> æ”¹æˆ <code>targetPort: http</code> å³å¯.</p>]]></content>
      
      
      <categories>
          
          <category> å®¹å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Nginx </tag>
            
            <tag> ingress </tag>
            
            <tag> Kubernetes </tag>
            
            <tag> é˜¿é‡Œäº‘ </tag>
            
            <tag> ACK </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Django RestFramework è‡ªå®šä¹‰æ˜¾ç¤ºå­—æ®µ</title>
      <link href="/posts/lqz1imdm/"/>
      <url>/posts/lqz1imdm/</url>
      
        <content type="html"><![CDATA[<p>æœ‰çš„æ—¶å€™åºåˆ—åŒ–å‡ºæ¥çš„å­—æ®µå¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Œ æ¯”å¦‚è¯´è¿”å›çš„ç”¨æˆ· idï¼Œè€Œæˆ‘ä»¬æƒ³è¦è¿”å›çš„æ˜¯ç”¨æˆ·åï¼Œ è¿™ä¸ªæ—¶å€™å¯ä»¥ç”¨åˆ° django rest framework çš„è‡ªå®šä¹‰å­—æ®µåŠŸèƒ½ã€‚</p><h2 id="å…ˆçœ‹ä¸€ä¸‹åŸå§‹æ•°æ®"><a href="#å…ˆçœ‹ä¸€ä¸‹åŸå§‹æ•°æ®" class="headerlink" title="å…ˆçœ‹ä¸€ä¸‹åŸå§‹æ•°æ®"></a>å…ˆçœ‹ä¸€ä¸‹åŸå§‹æ•°æ®</h2><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;desc&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sdg&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;user&quot;</span><span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;desc&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sdg&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;user&quot;</span><span class="punctuation">:</span> <span class="number">2</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œ user æ˜¾ç¤ºçš„æ˜¯ id, å¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ username</p><h2 id="å¢åŠ ä¸€ä¸ªå­—æ®µ-æ˜¾ç¤º-username"><a href="#å¢åŠ ä¸€ä¸ªå­—æ®µ-æ˜¾ç¤º-username" class="headerlink" title="å¢åŠ ä¸€ä¸ªå­—æ®µ, æ˜¾ç¤º username"></a>å¢åŠ ä¸€ä¸ªå­—æ®µ, æ˜¾ç¤º username</h2><h3 id="models"><a href="#models" class="headerlink" title="models:"></a>models:</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create your models here.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Game</span>(models.Model):</span><br><span class="line">    name = models.CharField(verbose_name=<span class="string">&#x27;æ¸¸æˆåå­—&#x27;</span>, max_length=<span class="number">10</span>)</span><br><span class="line">    desc = models.CharField(verbose_name=<span class="string">&#x27;æè¿°&#x27;</span>, max_length=<span class="number">20</span>)</span><br><span class="line">    user = models.ForeignKey(to=<span class="string">&#x27;auth.User&#x27;</span>, on_delete=models.CASCADE)</span><br></pre></td></tr></table></figure><h3 id="serializers"><a href="#serializers" class="headerlink" title="serializers:"></a>serializers:</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> serializers</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Game</span><br><span class="line"><span class="keyword">from</span> django.contrib.auth.models <span class="keyword">import</span> User</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GameSerializer</span>(serializers.ModelSerializer):</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è¿™é‡Œä½¿ç”¨StringRelatedFieldæ¥è·å–ç³»ç»Ÿè‡ªå¸¦ç”¨æˆ·çš„username(ä¾èµ–äºmodelsé‡Œé¢å®šä¹‰ä¸ª__str__æ–¹æ³•), è¯¦æƒ…è§ä¸‹å›¾</span></span><br><span class="line">    user_val = serializers.StringRelatedField(source=<span class="string">&#x27;user&#x27;</span>, read_only=<span class="literal">True</span>, )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        model = Game</span><br><span class="line">        fields = <span class="string">&#x27;__all__&#x27;</span></span><br><span class="line">        <span class="comment"># exclude = (&#x27;user&#x27;,)</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># å¦‚æœä¸éœ€è¦userå­—æ®µ, ä¸‹é¢å¯ä»¥å»æ‰, ä¸Šé¢exclude = (&#x27;user&#x27;,)</span></span><br><span class="line">        extra_kwargs = &#123;</span><br><span class="line">            <span class="string">&quot;user&quot;</span>: &#123;<span class="string">&quot;read_only&quot;</span>: <span class="literal">True</span>&#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202401041811348.png" alt="image.png"></p><h3 id="views"><a href="#views" class="headerlink" title="views:"></a>views:</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">GameList</span>(generics.ListCreateAPIView):</span><br><span class="line">    queryset = Game.objects.<span class="built_in">all</span>()</span><br><span class="line">    serializer_class = GameSerializer</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è¿™é‡Œé‡å†™äº†perform_create, ä¿å­˜æ•°æ®çš„æ—¶å€™, userä½¿ç”¨å½“å‰ç™»å½•çš„ç”¨æˆ·.</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">perform_create</span>(<span class="params">self, serializer</span>):</span><br><span class="line">        serializer.save(user=self.request.user)</span><br></pre></td></tr></table></figure><h3 id="è¿”å›ç»“æœ"><a href="#è¿”å›ç»“æœ" class="headerlink" title="è¿”å›ç»“æœ:"></a>è¿”å›ç»“æœ:</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;user_val&quot;</span><span class="punctuation">:</span> <span class="string">&quot;iuxt&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;desc&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sdg&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;user&quot;</span><span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;user_val&quot;</span><span class="punctuation">:</span> <span class="string">&quot;test&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;desc&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sdg&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;user&quot;</span><span class="punctuation">:</span> <span class="number">2</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure><h2 id="è¿”å›ç”¨æˆ·çš„å¤šä¸ªå­—æ®µ"><a href="#è¿”å›ç”¨æˆ·çš„å¤šä¸ªå­—æ®µ" class="headerlink" title="è¿”å›ç”¨æˆ·çš„å¤šä¸ªå­—æ®µ"></a>è¿”å›ç”¨æˆ·çš„å¤šä¸ªå­—æ®µ</h2><h3 id="é¦–å…ˆéœ€è¦è‡ªå®šä¹‰ä¸€ä¸ªåºåˆ—åŒ–å™¨"><a href="#é¦–å…ˆéœ€è¦è‡ªå®šä¹‰ä¸€ä¸ªåºåˆ—åŒ–å™¨" class="headerlink" title="é¦–å…ˆéœ€è¦è‡ªå®šä¹‰ä¸€ä¸ªåºåˆ—åŒ–å™¨"></a>é¦–å…ˆéœ€è¦è‡ªå®šä¹‰ä¸€ä¸ªåºåˆ—åŒ–å™¨</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> serializers</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Game</span><br><span class="line"><span class="keyword">from</span> django.contrib.auth.models <span class="keyword">import</span> User</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># è‡ªå®šä¹‰ä¸€ä¸ªåºåˆ—åŒ–, ä½¿ç”¨django è‡ªå¸¦çš„user æ¨¡å‹ç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CustomUserSerializer</span>(serializers.ModelSerializer):</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        model = User</span><br><span class="line">        fields = [<span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;email&#x27;</span>] <span class="comment"># æŒ‡å®šåºåˆ—åŒ–çš„å­—æ®µ</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GameSerializer</span>(serializers.ModelSerializer):</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        model = Game</span><br><span class="line">        fields = <span class="string">&#x27;__all__&#x27;</span></span><br><span class="line">        <span class="comment"># exclude = (&#x27;user&#x27;,)</span></span><br><span class="line"></span><br><span class="line">        extra_kwargs = &#123;</span><br><span class="line">            <span class="string">&quot;user&quot;</span>: &#123;<span class="string">&quot;read_only&quot;</span>: <span class="literal">True</span>&#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">to_representation</span>(<span class="params">self, instance</span>):</span><br><span class="line">        representation = <span class="built_in">super</span>(GameSerializer, self).to_representation(instance)</span><br><span class="line">        <span class="comment"># è¿™é‡Œä¿®æ”¹userå­—æ®µ, ä½¿ç”¨è‡ªå®šä¹‰åºåˆ—åŒ–å™¨.</span></span><br><span class="line">        <span class="comment"># è·å–å¤šä¸ªå±æ€§</span></span><br><span class="line">        representation[<span class="string">&#x27;user&#x27;</span>] = CustomUserSerializer(instance.user, context=self.context).data</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># æˆ–è€…è·å–å…¶ä¸­çš„æŸä¸€ä¸ªå€¼</span></span><br><span class="line">        <span class="comment"># representation[&#x27;user&#x27;] = CustomUserSerializer(instance.user, context=self.context).data.get(&#x27;username&#x27;)</span></span><br><span class="line">        <span class="keyword">return</span> representation</span><br></pre></td></tr></table></figure><h3 id="è¿™ä¸ªæ—¶å€™è¿”å›ç»“æœ"><a href="#è¿™ä¸ªæ—¶å€™è¿”å›ç»“æœ" class="headerlink" title="è¿™ä¸ªæ—¶å€™è¿”å›ç»“æœ:"></a>è¿™ä¸ªæ—¶å€™è¿”å›ç»“æœ:</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;desc&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sdg&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;user&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;iuxt&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span> <span class="string">&quot;iuxt@qq.com&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;desc&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sdg&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;user&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;test&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span> <span class="string">&quot;test@qq.com&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> django </tag>
            
            <tag> Python </tag>
            
            <tag> drf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>curlå¸¸ç”¨æ“ä½œè®°å½•</title>
      <link href="/posts/lqyxid2z/"/>
      <url>/posts/lqyxid2z/</url>
      
        <content type="html"><![CDATA[<p>curl æ˜¯å¸¸ç”¨çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨æ¥è¯·æ±‚ Web æœåŠ¡å™¨ã€‚å®ƒçš„åå­—å°±æ˜¯å®¢æˆ·ç«¯ï¼ˆclientï¼‰çš„ URL å·¥å…·çš„æ„æ€ã€‚</p><p>å®ƒçš„åŠŸèƒ½éå¸¸å¼ºå¤§ï¼Œå‘½ä»¤è¡Œå‚æ•°å¤šè¾¾å‡ åç§ã€‚å¦‚æœç†Ÿç»ƒçš„è¯ï¼Œå®Œå…¨å¯ä»¥å–ä»£ Postman è¿™ä¸€ç±»çš„å›¾å½¢ç•Œé¢å·¥å…·ã€‚</p><p>å‚è€ƒæ–‡ç« : <a href="https://www.ruanyifeng.com/blog/2019/09/curl-reference.html">https://www.ruanyifeng.com/blog/2019/09/curl-reference.html</a></p><h2 id="å‚æ•°"><a href="#å‚æ•°" class="headerlink" title="å‚æ•°"></a>å‚æ•°</h2><h3 id="A"><a href="#A" class="headerlink" title="-A"></a>-A</h3><p>-A å‚æ•°æŒ‡å®šå®¢æˆ·ç«¯çš„ç”¨æˆ·ä»£ç†æ ‡å¤´ï¼Œå³ <code>User-Agent</code>ã€‚curl çš„é»˜è®¤ç”¨æˆ·ä»£ç†å­—ç¬¦ä¸²æ˜¯ <code>curl/[version]</code>ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°†User-Agentæ”¹æˆ Chrome æµè§ˆå™¨</span></span><br><span class="line">curl -A <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.100 Safari/537.36&#x27;</span> https://google.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç§»é™¤User-Agent</span></span><br><span class="line">curl -A <span class="string">&#x27;&#x27;</span> https://google.com</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥é€šè¿‡ -H(æ›´æ”¹ Header) å‚æ•°ç›´æ¥æŒ‡å®š User-Agent</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -H <span class="string">&#x27;User-Agent: php/1.0&#x27;</span> https://google.com</span><br></pre></td></tr></table></figure><h3 id="b"><a href="#b" class="headerlink" title="-b"></a>-b</h3><p>-b å‚æ•°ç”¨æ¥å‘æœåŠ¡å™¨å‘é€ Cookieã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‘é€cookie</span></span><br><span class="line">curl -b <span class="string">&#x27;foo=bar&#x27;</span> https://google.com</span><br><span class="line">curl -b <span class="string">&#x27;foo1=bar;foo2=bar2&#x27;</span> https://google.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯»å–æœ¬åœ°æ–‡ä»¶cookies.txtï¼Œé‡Œé¢æ˜¯æœåŠ¡å™¨è®¾ç½®çš„ Cookieï¼ˆå‚è§-cå‚æ•°ï¼‰ï¼Œå°†å…¶å‘é€åˆ°æœåŠ¡å™¨ã€‚</span></span><br><span class="line">curl -b cookies.txt https://www.google.com</span><br></pre></td></tr></table></figure><h3 id="c"><a href="#c" class="headerlink" title="-c"></a>-c</h3><p>-c å‚æ•°å°†æœåŠ¡å™¨è®¾ç½®çš„ Cookie å†™å…¥ä¸€ä¸ªæ–‡ä»¶ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°†æœåŠ¡å™¨çš„ HTTP å›åº”æ‰€è®¾ç½® Cookie å†™å…¥æ–‡æœ¬æ–‡ä»¶cookies.txtã€‚</span></span><br><span class="line">curl -c cookies.txt https://www.google.com</span><br></pre></td></tr></table></figure><h3 id="d"><a href="#d" class="headerlink" title="-d"></a>-d</h3><p>-d å‚æ•°ç”¨äºå‘é€ POST è¯·æ±‚çš„æ•°æ®ä½“ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨-då‚æ•°ä»¥åï¼ŒHTTP è¯·æ±‚ä¼šè‡ªåŠ¨åŠ ä¸Šæ ‡å¤´Content-Type : application/x-www-form-urlencodedã€‚å¹¶ä¸”ä¼šè‡ªåŠ¨å°†è¯·æ±‚è½¬ä¸º POST æ–¹æ³•ï¼Œå› æ­¤å¯ä»¥çœç•¥-X POSTã€‚</span></span><br><span class="line">curl -d <span class="string">&#x27;login=emmaï¼†password=123&#x27;</span> -X POST https://google.com/login</span><br><span class="line">curl -d <span class="string">&#x27;login=emma&#x27;</span> -d <span class="string">&#x27;password=123&#x27;</span> -X POST https://google.com/login</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># -då‚æ•°å¯ä»¥è¯»å–æœ¬åœ°æ–‡æœ¬æ–‡ä»¶çš„æ•°æ®ï¼Œå‘æœåŠ¡å™¨å‘é€ã€‚</span></span><br><span class="line">curl -d <span class="string">&#x27;@data.txt&#x27;</span> https://google.com/login</span><br></pre></td></tr></table></figure><h3 id="e"><a href="#e" class="headerlink" title="-e"></a>-e</h3><p>-e å‚æ•°ç”¨æ¥è®¾ç½® HTTP çš„æ ‡å¤´ Refererï¼Œè¡¨ç¤ºè¯·æ±‚çš„æ¥æºã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°†Refereræ ‡å¤´è®¾ä¸ºhttps://google.com?q=example</span></span><br><span class="line">curl -e <span class="string">&#x27;https://google.com?q=example&#x27;</span> https://www.example.com</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># -Hå‚æ•°å¯ä»¥é€šè¿‡ç›´æ¥æ·»åŠ æ ‡å¤´Refererï¼Œè¾¾åˆ°åŒæ ·æ•ˆæœã€‚</span></span><br><span class="line">curl -H <span class="string">&#x27;Referer: https://google.com?q=example&#x27;</span> https://www.example.com</span><br></pre></td></tr></table></figure><h3 id="F-å’Œ-T"><a href="#F-å’Œ-T" class="headerlink" title="-F å’Œ -T"></a>-F å’Œ -T</h3><p>-F å‚æ•°ç”¨æ¥ä¸Šä¼ å¤šä¸ªæ–‡ä»¶<br>-T å‚æ•°ç”¨äºä¸Šä¼ å•ä¸ªæ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç»™ HTTP è¯·æ±‚åŠ ä¸Šæ ‡å¤´Content-Type: multipart/form-dataï¼Œç„¶åå°†æ–‡ä»¶photo.pngä½œä¸ºfileå­—æ®µä¸Šä¼ </span></span><br><span class="line">curl -F <span class="string">&#x27;file=@photo.png&#x27;</span> https://google.com/profile</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®š MIME ç±»å‹ä¸ºimage/pngï¼Œå¦åˆ™ curl ä¼šæŠŠ MIME ç±»å‹è®¾ä¸ºapplication/octet-stream</span></span><br><span class="line">curl -F <span class="string">&#x27;file=@photo.png;type=image/png&#x27;</span> https://google.com/profile</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®šæ–‡ä»¶å, åŸå§‹æ–‡ä»¶åä¸ºphoto.pngï¼Œä½†æ˜¯æœåŠ¡å™¨æ¥æ”¶åˆ°çš„æ–‡ä»¶åä¸ºme.png</span></span><br><span class="line">curl -F <span class="string">&#x27;file=@photo.png;filename=me.png&#x27;</span> https://google.com/profile</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸Šä¼ å•ä¸ªæ–‡ä»¶</span></span><br><span class="line">curl -T /path/to/file.txt http://example.com/upload</span><br></pre></td></tr></table></figure><h3 id="H"><a href="#H" class="headerlink" title="-H"></a>-H</h3><p>-H å‚æ•°æ·»åŠ  HTTP è¯·æ±‚çš„æ ‡å¤´ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">curl -H <span class="string">&#x27;Accept-Language: en-US&#x27;</span> https://google.com</span><br><span class="line">curl -H <span class="string">&#x27;Accept-Language: en-US&#x27;</span> -H <span class="string">&#x27;Secret-Message: xyzzy&#x27;</span> https://google.com</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ  HTTP è¯·æ±‚çš„æ ‡å¤´æ˜¯Content-Type: application/jsonï¼Œç„¶åç”¨-då‚æ•°å‘é€ JSON æ•°æ®ã€‚</span></span><br><span class="line">curl -d <span class="string">&#x27;&#123;&quot;login&quot;: &quot;emma&quot;, &quot;pass&quot;: &quot;123&quot;&#125;&#x27;</span> -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> https://google.com/login</span><br></pre></td></tr></table></figure><h3 id="i"><a href="#i" class="headerlink" title="-i"></a>-i</h3><p>-i å‚æ•°æ‰“å°å‡ºæœåŠ¡å™¨å›åº”çš„ HTTP æ ‡å¤´ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ”¶åˆ°æœåŠ¡å™¨å›åº”åï¼Œå…ˆè¾“å‡ºæœåŠ¡å™¨å›åº”çš„æ ‡å¤´ï¼Œç„¶åç©ºä¸€è¡Œï¼Œå†è¾“å‡ºç½‘é¡µçš„æºç </span></span><br><span class="line">curl -i https://www.example.com</span><br></pre></td></tr></table></figure><h3 id="I-â€“head"><a href="#I-â€“head" class="headerlink" title="-I(â€“head)"></a>-I(â€“head)</h3><p>-I å‚æ•°å‘æœåŠ¡å™¨å‘å‡º HEAD è¯·æ±‚ï¼Œç„¶ä¼šå°†æœåŠ¡å™¨è¿”å›çš„ HTTP æ ‡å¤´æ‰“å°å‡ºæ¥ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -I https://www.example.com</span><br></pre></td></tr></table></figure><h3 id="k"><a href="#k" class="headerlink" title="-k"></a>-k</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è·³è¿‡ SSL æ£€æµ‹</span></span><br><span class="line">curl -k https://www.example.com</span><br></pre></td></tr></table></figure><h3 id="L"><a href="#L" class="headerlink" title="-L"></a>-L</h3><p>-L å‚æ•°ä¼šè®© HTTP è¯·æ±‚è·ŸéšæœåŠ¡å™¨çš„é‡å®šå‘ã€‚curl é»˜è®¤ä¸è·Ÿéšé‡å®šå‘ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -L -d <span class="string">&#x27;tweet=hi&#x27;</span> https://api.twitter.com/tweet</span><br></pre></td></tr></table></figure><h3 id="â€“limit-rate"><a href="#â€“limit-rate" class="headerlink" title="â€“limit-rate"></a>â€“limit-rate</h3><p>â€“limit-rate ç”¨æ¥é™åˆ¶ HTTP è¯·æ±‚å’Œå›åº”çš„å¸¦å®½ï¼Œæ¨¡æ‹Ÿæ…¢ç½‘é€Ÿçš„ç¯å¢ƒã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°†å¸¦å®½é™åˆ¶åœ¨æ¯ç§’ 200K å­—èŠ‚</span></span><br><span class="line">curl --limit-rate 200k https://google.com</span><br></pre></td></tr></table></figure><h3 id="o"><a href="#o" class="headerlink" title="-o"></a>-o</h3><p>-o å‚æ•°å°†æœåŠ¡å™¨çš„å›åº”ä¿å­˜æˆæ–‡ä»¶ï¼Œç­‰åŒäº wget å‘½ä»¤ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># éœ€è¦æŒ‡å®šä¿å­˜çš„æ–‡ä»¶å</span></span><br><span class="line">curl -o example.html https://www.example.com</span><br></pre></td></tr></table></figure><h3 id="O"><a href="#O" class="headerlink" title="-O"></a>-O</h3><p>-O å‚æ•°å°†æœåŠ¡å™¨å›åº”ä¿å­˜æˆæ–‡ä»¶ï¼Œå¹¶å°† URL çš„æœ€åéƒ¨åˆ†å½“ä½œæ–‡ä»¶åã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°†æœåŠ¡å™¨å›åº”ä¿å­˜æˆæ–‡ä»¶ï¼Œæ–‡ä»¶åä¸ºbar.html</span></span><br><span class="line">curl -O https://www.example.com/foo/bar.html</span><br></pre></td></tr></table></figure><h3 id="s"><a href="#s" class="headerlink" title="-s"></a>-s</h3><p>-s å‚æ•°å°†ä¸è¾“å‡ºé”™è¯¯å’Œè¿›åº¦ä¿¡æ¯ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸€æ—¦å‘ç”Ÿé”™è¯¯ï¼Œä¸ä¼šæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ã€‚ä¸å‘ç”Ÿé”™è¯¯çš„è¯ï¼Œä¼šæ­£å¸¸æ˜¾ç¤ºè¿è¡Œç»“æœã€‚</span></span><br><span class="line">curl -s https://www.example.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœæƒ³è®© curl ä¸äº§ç”Ÿä»»ä½•è¾“å‡ºï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ã€‚</span></span><br><span class="line">curl -s -o /dev/null https://google.com</span><br></pre></td></tr></table></figure><h3 id="u"><a href="#u" class="headerlink" title="-u"></a>-u</h3><p>-u å‚æ•°ç”¨æ¥è®¾ç½®æœåŠ¡å™¨è®¤è¯çš„ç”¨æˆ·åå’Œå¯†ç ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®¾ç½®ç”¨æˆ·åä¸ºbobï¼Œå¯†ç ä¸º12345ï¼Œç„¶åå°†å…¶è½¬ä¸º HTTP æ ‡å¤´Authorization: Basic Ym9iOjEyMzQ1</span></span><br><span class="line">curl -u <span class="string">&#x27;bob:12345&#x27;</span> https://google.com/login</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯†åˆ« URL é‡Œé¢çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œå°†å…¶è½¬ä¸ºä¸Šä¸ªä¾‹å­é‡Œé¢çš„ HTTP æ ‡å¤´</span></span><br><span class="line">curl https://bob:12345@google.com/login</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®äº†ç”¨æˆ·åï¼Œæ‰§è¡Œåï¼Œcurl ä¼šæç¤ºç”¨æˆ·è¾“å…¥å¯†ç </span></span><br><span class="line">curl -u <span class="string">&#x27;bob&#x27;</span> https://google.com/login</span><br></pre></td></tr></table></figure><h3 id="v"><a href="#v" class="headerlink" title="-v"></a>-v</h3><p>-v å‚æ•°è¾“å‡ºé€šä¿¡çš„æ•´ä¸ªè¿‡ç¨‹ï¼Œç”¨äºè°ƒè¯•ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -v https://www.example.com</span><br><span class="line">curl --trace - https://www.example.com</span><br></pre></td></tr></table></figure><h3 id="x"><a href="#x" class="headerlink" title="-x"></a>-x</h3><p>-x å‚æ•°æŒ‡å®š HTTP è¯·æ±‚çš„ä»£ç†ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¯·æ±‚çš„ä»£ç†é»˜è®¤ä½¿ç”¨ HTTP åè®®</span></span><br><span class="line">curl -x socks5://james:cats@myproxy.com:8080 https://www.example.com</span><br><span class="line">curl -x james:cats@myproxy.com:8080 https://www.example.com</span><br></pre></td></tr></table></figure><h3 id="X"><a href="#X" class="headerlink" title="-X"></a>-X</h3><p>-X å‚æ•°æŒ‡å®š HTTP è¯·æ±‚çš„æ–¹æ³•ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST https://www.example.com</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
            <tag> curl </tag>
            
            <tag> å¸¸ç”¨æ“ä½œ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ£€æŸ¥åŸŸåæ”¯æŒçš„HTTPSåè®®ç‰ˆæœ¬</title>
      <link href="/posts/lqxf8k8u/"/>
      <url>/posts/lqxf8k8u/</url>
      
        <content type="html"><![CDATA[<h2 id="ä½¿ç”¨-NMAP-æ¨è"><a href="#ä½¿ç”¨-NMAP-æ¨è" class="headerlink" title="ä½¿ç”¨ NMAP(æ¨è)"></a>ä½¿ç”¨ NMAP(æ¨è)</h2><p>ä¾èµ–äº <code>nmap</code>, <code>nmap</code> éœ€è¦å®‰è£…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap --script ssl-enum-ciphers -p 443 baidu.com</span><br></pre></td></tr></table></figure><p>æ¯”å¦‚ GitHub åªæ”¯æŒ TLS1.2 å’Œ TLS1.3ï¼š<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202401031545944.png" alt="image.png"></p><h2 id="åœ¨çº¿éªŒè¯"><a href="#åœ¨çº¿éªŒè¯" class="headerlink" title="åœ¨çº¿éªŒè¯"></a>åœ¨çº¿éªŒè¯</h2><p><a href="https://myssl.com/">https://myssl.com/</a></p><p><a href="https://www.ssleye.com/ssltool/cipher_suites.html">https://www.ssleye.com/ssltool/cipher_suites.html</a></p><p><a href="https://www.site24x7.com/zhcn/tools/tls-checker.html">https://www.site24x7.com/zhcn/tools/tls-checker.html</a></p><h2 id="ä½¿ç”¨-CURL-éªŒè¯"><a href="#ä½¿ç”¨-CURL-éªŒè¯" class="headerlink" title="ä½¿ç”¨ CURL éªŒè¯"></a>ä½¿ç”¨ CURL éªŒè¯</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl --tlsv1 --tls-max 1.0  https://github.com</span><br><span class="line">curl --tlsv1 --tls-max 1.0  https://www.baidu.com</span><br></pre></td></tr></table></figure><p>æŠ¥é”™è¯´æ˜ä¸æ”¯æŒå½“å‰ç‰ˆæœ¬:</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl: (<span class="number">35</span>) LibreSSL/<span class="number">3.3</span>.<span class="number">6</span>: error:<span class="number">1404</span>B42E:SSL routine<span class="variable">s:ST_CONNECT</span>:tlsv1 alert protocol <span class="keyword">version</span></span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨-OpenSSL"><a href="#ä½¿ç”¨-OpenSSL" class="headerlink" title="ä½¿ç”¨ OpenSSL"></a>ä½¿ç”¨ OpenSSL</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># éªŒè¯TLS1.2</span></span><br><span class="line">openssl s_client -connect www.baidu.com:443 -tls1_2</span><br><span class="line"></span><br><span class="line"><span class="comment"># éªŒè¯TLS1.1</span></span><br><span class="line">openssl s_client -connect www.baidu.com:443 -tls1_1</span><br><span class="line"></span><br><span class="line"><span class="comment"># éªŒè¯TLS1.0</span></span><br><span class="line">openssl s_client -connect www.baidu.com:443 -tls1</span><br></pre></td></tr></table></figure><p>å¦‚æœæ¡æ‰‹å¤±è´¥çš„è¯ï¼Œé‚£ä¹ˆå°±æ˜¯ä¸æ”¯æŒäº†ã€‚</p><h2 id="æœåŠ¡ç«¯-TLS-ç‰ˆæœ¬é…ç½®"><a href="#æœåŠ¡ç«¯-TLS-ç‰ˆæœ¬é…ç½®" class="headerlink" title="æœåŠ¡ç«¯ TLS ç‰ˆæœ¬é…ç½®"></a>æœåŠ¡ç«¯ TLS ç‰ˆæœ¬é…ç½®</h2><p>å¯ä»¥é€šè¿‡é…ç½®æœåŠ¡ç«¯,æ¯”å¦‚ nginx æ¥è®¾ç½®æ”¯æŒçš„ TLS ç‰ˆæœ¬.</p><h3 id="Nginx-é…ç½®ä¿®æ”¹"><a href="#Nginx-é…ç½®ä¿®æ”¹" class="headerlink" title="Nginx é…ç½®ä¿®æ”¹"></a>Nginx é…ç½®ä¿®æ”¹</h3><p>é…ç½®ç”Ÿæˆåœ°å€: <a href="https://ssl-config.mozilla.org/">https://ssl-config.mozilla.org/</a></p><p>æ³¨æ„ï¼š tls ç‰ˆæœ¬çš„é…ç½®å¿…é¡»å…¨å±€ç”Ÿæ•ˆï¼Œå¦‚æœä½ æœ‰å¤šä¸ª <code>vhost</code>ï¼Œé‚£ä¹ˆæ‰€æœ‰éƒ½éœ€è¦ä¿®æ”¹ï¼Œå»ºè®®ç›´æ¥å†™åˆ°ä¸€ä¸ªæ–‡ä»¶å†…ï¼Œç„¶åé€šè¿‡ <code>include</code> çš„æ–¹å¼æ¥å¼•ç”¨ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"># generated 2024-01-03, Mozilla Guideline v5.7, nginx 1.17.7, OpenSSL 1.1.1k, intermediate configuration</span><br><span class="line"># https://ssl-config.mozilla.org/#server=nginx&amp;version=1.17.7&amp;config=intermediate&amp;openssl=1.1.1k&amp;guideline=5.7</span><br><span class="line">server &#123;</span><br><span class="line">    listen 80 default_server;</span><br><span class="line">    listen [::]:80 default_server;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        return 301 https://$host$request_uri;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen 443 ssl http2;</span><br><span class="line">    listen [::]:443 ssl http2;</span><br><span class="line"></span><br><span class="line">    ssl_certificate /path/to/signed_cert_plus_intermediates;</span><br><span class="line">    ssl_certificate_key /path/to/private_key;</span><br><span class="line">    ssl_session_timeout 1d;</span><br><span class="line">    ssl_session_cache shared:MozSSL:10m;  # about 40000 sessions</span><br><span class="line">    ssl_session_tickets off;</span><br><span class="line"></span><br><span class="line">    # curl https://ssl-config.mozilla.org/ffdhe2048.txt &gt; /path/to/dhparam</span><br><span class="line">    ssl_dhparam /path/to/dhparam;</span><br><span class="line"></span><br><span class="line">    # intermediate configuration</span><br><span class="line">    ssl_protocols TLSv1.2 TLSv1.3;</span><br><span class="line">    ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-CHACHA20-POLY1305;</span><br><span class="line">    ssl_prefer_server_ciphers off;</span><br><span class="line"></span><br><span class="line">    # HSTS (ngx_http_headers_module is required) (63072000 seconds)</span><br><span class="line">    add_header Strict-Transport-Security &quot;max-age=63072000&quot; always;</span><br><span class="line"></span><br><span class="line">    # OCSP stapling</span><br><span class="line">    ssl_stapling on;</span><br><span class="line">    ssl_stapling_verify on;</span><br><span class="line"></span><br><span class="line">    # verify chain of trust of OCSP response using Root CA and Intermediate certs</span><br><span class="line">    ssl_trusted_certificate /path/to/root_CA_cert_plus_intermediates;</span><br><span class="line"></span><br><span class="line">    # replace with the IP address of your resolver</span><br><span class="line">    resolver 127.0.0.1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å¸¸è§é—®é¢˜"><a href="#å¸¸è§é—®é¢˜" class="headerlink" title="å¸¸è§é—®é¢˜"></a>å¸¸è§é—®é¢˜</h2><h3 id="ä¸ºä»€ä¹ˆå¯ç”¨äº†-TLS1-0ï¼Œä½†æ˜¯ä¸ç”Ÿæ•ˆ"><a href="#ä¸ºä»€ä¹ˆå¯ç”¨äº†-TLS1-0ï¼Œä½†æ˜¯ä¸ç”Ÿæ•ˆ" class="headerlink" title="ä¸ºä»€ä¹ˆå¯ç”¨äº† TLS1.0ï¼Œä½†æ˜¯ä¸ç”Ÿæ•ˆ"></a>ä¸ºä»€ä¹ˆå¯ç”¨äº† TLS1.0ï¼Œä½†æ˜¯ä¸ç”Ÿæ•ˆ</h3><p>å·²ç»é…ç½®äº† <code>ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3;</code> ï¼Œä½†æ˜¯ä¸ç”Ÿæ•ˆï¼Œè¿™ä¸ªå’Œå…¶ä»–å‚æ•°æœ‰å…³ï¼Œæ¯”å¦‚ <code>ssl_ciphers</code> ,å¦‚æœä½ å¯ç”¨äº† TLSv1ï¼Œä½†æ˜¯åè®®ä¸æ”¯æŒï¼Œé‚£ä¹Ÿæ˜¯ä¸èƒ½å¯ç”¨çš„ã€‚</p><p>æ¯”å¦‚åœ¨ AlmaLinux 9 ä¸‹ï¼Œ éœ€è¦å¦‚ä¸‹é…ç½®æ‰èƒ½æ­£å¸¸å¯ç”¨ TLS1.0 ï¼ˆä¸»è¦æ˜¯ï¼š <code>ssl_ciphers DEFAULT:@SECLEVEL=0;</code> å°†å®‰å…¨çº§åˆ«è°ƒä½ ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">   server &#123;</span><br><span class="line">listen 80;</span><br><span class="line">listen [::]:80;</span><br><span class="line">   listen       443 ssl http2;</span><br><span class="line">   listen       [::]:443 ssl http2;</span><br><span class="line">   server_name   a.i.com;</span><br><span class="line">   root         /usr/share/nginx/html;</span><br><span class="line"></span><br><span class="line">   ssl_certificate &quot;i.com.crt&quot;;</span><br><span class="line">   ssl_certificate_key &quot;i.com.key&quot;;</span><br><span class="line">   ssl_session_timeout 1d;</span><br><span class="line">   ssl_session_cache shared:MozSSL:10m;  # about 40000 sessions</span><br><span class="line">   ssl_session_tickets off;</span><br><span class="line"></span><br><span class="line">   ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3;</span><br><span class="line">   ssl_ciphers DEFAULT:@SECLEVEL=0;</span><br><span class="line"></span><br><span class="line">       error_page 404 /404.html;</span><br><span class="line">           location = /40x.html &#123;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       error_page 500 502 503 504 /50x.html;</span><br><span class="line">           location = /50x.html &#123;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="ä¸ºä»€ä¹ˆç¦ç”¨äº†-TLS1-0-ï¼Œä½†æ˜¯ä¸ç”Ÿæ•ˆ"><a href="#ä¸ºä»€ä¹ˆç¦ç”¨äº†-TLS1-0-ï¼Œä½†æ˜¯ä¸ç”Ÿæ•ˆ" class="headerlink" title="ä¸ºä»€ä¹ˆç¦ç”¨äº† TLS1.0 ï¼Œä½†æ˜¯ä¸ç”Ÿæ•ˆ"></a>ä¸ºä»€ä¹ˆç¦ç”¨äº† TLS1.0 ï¼Œä½†æ˜¯ä¸ç”Ÿæ•ˆ</h3><p>åŸç†ç±»ä¼¼ä¸Šé¢ï¼Œéœ€è¦åŒæ­¥æ›´æ”¹ <code>ssl_ciphers</code> å‚æ•°ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åŠ å¯† </tag>
            
            <tag> tls </tag>
            
            <tag> https </tag>
            
            <tag> SSL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨opensslå¯¹æ–‡ä»¶è¿›è¡ŒåŠ å¯†</title>
      <link href="/posts/lqxdtb6m/"/>
      <url>/posts/lqxdtb6m/</url>
      
        <content type="html"><![CDATA[<h2 id="ä½¿ç”¨å¯†ç åŠ å¯†"><a href="#ä½¿ç”¨å¯†ç åŠ å¯†" class="headerlink" title="ä½¿ç”¨å¯†ç åŠ å¯†"></a>ä½¿ç”¨å¯†ç åŠ å¯†</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŒ‡å®šè¾“å…¥å’Œè¾“å‡ºæ–‡ä»¶æ“ä½œ</span></span><br><span class="line">openssl enc -e -aes256 -<span class="keyword">in</span> test.sh -out enc.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># æˆ–è€…ä½¿ç”¨ç®¡é“ç¬¦</span></span><br><span class="line"><span class="built_in">cat</span> test.sh | openssl enc -e -aes256 -out enc.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‹ç¼©ååŠ å¯†</span></span><br><span class="line">tar zcvf - 1.sh | openssl enc -e -aes256 -out temp</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨å¯†ç è§£å¯†"><a href="#ä½¿ç”¨å¯†ç è§£å¯†" class="headerlink" title="ä½¿ç”¨å¯†ç è§£å¯†"></a>ä½¿ç”¨å¯†ç è§£å¯†</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŒ‡å®šè¾“å…¥å’Œè¾“å‡ºæ–‡ä»¶æ“ä½œ</span></span><br><span class="line">openssl enc -d -aes256 -<span class="keyword">in</span> enc.sh -out 1.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># æˆ–è€…ä½¿ç”¨ç®¡é“ç¬¦è¿›è¡Œæ“ä½œ</span></span><br><span class="line">openssl enc -d -aes256 -<span class="keyword">in</span> enc.sh | <span class="built_in">tee</span> a.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># è§£å¯†åè¿›è¡Œè§£å‹</span></span><br><span class="line">openssl enc -d -aes256 -<span class="keyword">in</span> temp | tar zxvf -</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åŠ å¯† </tag>
            
            <tag> SSL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Django RESTframework è‡ªå®šä¹‰Response</title>
      <link href="/posts/sfz4bc/"/>
      <url>/posts/sfz4bc/</url>
      
        <content type="html"><![CDATA[<p>æ¯”å¦‚æˆ‘æƒ³ç»™è¿”å›çš„ json åŠ ä¸Š code&#x2F; msg ç­‰ä¿¡æ¯ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹ drf çš„ response æ¥å®ç°ã€‚</p><h2 id="å…¨å±€ç”Ÿæ•ˆ"><a href="#å…¨å±€ç”Ÿæ•ˆ" class="headerlink" title="å…¨å±€ç”Ÿæ•ˆ"></a>å…¨å±€ç”Ÿæ•ˆ</h2><p>å‚è€ƒï¼š<a href="https://www.cnblogs.com/henryhong/p/djangodrf-zi-ding-yi-shu-ju-fan-hui-ge-shi.html">https://www.cnblogs.com/henryhong/p/djangodrf-zi-ding-yi-shu-ju-fan-hui-ge-shi.html</a></p><h3 id="é»˜è®¤æƒ…å†µ"><a href="#é»˜è®¤æƒ…å†µ" class="headerlink" title="é»˜è®¤æƒ…å†µ"></a>é»˜è®¤æƒ…å†µ</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;count&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;next&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;previous&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;results&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://localhost:8000/api/category/2/&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;AAA&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;created&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2024-07-02T14:18:44.993194+08:00&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://localhost:8000/api/category/1/&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;AAA&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;created&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2024-07-02T14:18:00+08:00&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><code>djangorestframwork</code> å¯ä»¥é€šè¿‡è‡ªå®šä¹‰è¿”å›æ¨¡æ¿æ¥é‡æ„è¿”å›æ•°æ®çš„æ ¼å¼ï¼Œæˆ‘ä»¬æŸ¥çœ‹ <code>restframework</code> çš„é»˜è®¤è®¾ç½®å¯ä»¥çœ‹åˆ°,é»˜è®¤çš„æ¨¡æ¿æ˜¯ <code>rest_framework.renderers.JSONRenderer</code> å’Œ <code>rest_framework.renderers.BrowsableAPIRenderer</code>ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªæ˜¯ç”¨äºå‰ç«¯æ¥æ”¶æ•°æ®æ—¶çš„æ•°æ®æ ¼å¼æ¨¡æ¿ï¼Œç¬¬äºŒä¸ªæ˜¯ drf åœ¨ api æŸ¥çœ‹ç•Œé¢çš„æ•°æ®æ˜¾ç¤ºæ¨¡å¼ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;DEFAULT_RENDERER_CLASSES&#x27;</span>: [</span><br><span class="line">    <span class="string">&#x27;rest_framework.renderers.JSONRenderer&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;rest_framework.renderers.BrowsableAPIRenderer&#x27;</span>,</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹æ¨¡æ¿"><a href="#ä¿®æ”¹æ¨¡æ¿" class="headerlink" title="ä¿®æ”¹æ¨¡æ¿"></a>ä¿®æ”¹æ¨¡æ¿</h3><p>å¦‚æœæˆ‘ä»¬æƒ³è¦ä¿®æ”¹è¿”å›ç»™å‰ç«¯çš„æ•°æ®æ ¼å¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é¦–å…ˆä¿®æ”¹é…ç½®å‚æ•°ï¼ˆsettings.pyï¼‰ä¸­çš„ <code>DEFAULT_RENDERER_CLASSES</code>ï¼Œå°† <code>rest_framework.renderers.JSONRenderer</code> ä¿®æ”¹ä¸ºè‡ªå·±å®šä¹‰çš„æ¨¡æ¿ç±»ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;DEFAULT_RENDERER_CLASSES&#x27;</span>: (</span><br><span class="line">    <span class="string">&#x27;utils.custom_renderer.CustomRenderer&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;rest_framework.renderers.BrowsableAPIRenderer&#x27;</span>,</span><br><span class="line">),</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰ä¸€ä¸ªæ³¨æ„ç‚¹å°±æ˜¯åœ¨å¼€å‘æ—¶å¦‚æœéœ€è¦é€šè¿‡ drf çš„ api æŸ¥çœ‹ç•Œé¢æŸ¥çœ‹ç›¸åº”çš„ api ä¸€å®šè¦å°†è¿™ä¸ªæ¨¡æ¿åŠ ä¸Š <code>rest_framework.renderers.BrowsableAPIRenderer</code>ï¼Œå¦åˆ™çš„è¯æ— æ³•çœ‹åˆ°ç›¸åº”çš„ç•Œé¢ï¼Œç”Ÿäº§æ—¶æ— éœ€è¯¥ç•Œé¢ï¼Œä¹Ÿå¯é€šè¿‡ç›¸å…³å‘½ä»¤å…³é—­æ˜¾ç¤ºã€‚</p><p><code>utils.custom_renderer.CustomRenderer</code> å…¶ä¸­ <code>utils.custome_render</code> æ˜¯è‡ªå·±çš„æ–‡ä»¶è·¯å¾„å¯æ ¹æ®è‡ªå·±çš„å®é™…æƒ…å†µè¿›è¡Œä¿®æ”¹ï¼Œ<code>CustomRenderer</code> æ˜¯è‡ªå·±å®šä¹‰çš„è¿”å›æ¨¡æ¿ç±»çš„åç§°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.renderers <span class="keyword">import</span> JSONRenderer</span><br><span class="line"><span class="comment"># å¯¼å…¥æ§åˆ¶è¿”å›çš„JSONæ ¼å¼çš„ç±»</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CustomRenderer</span>(<span class="title class_ inherited__">JSONRenderer</span>):</span><br><span class="line">    <span class="comment"># é‡æ„renderæ–¹æ³•</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">render</span>(<span class="params">self, data, accepted_media_type=<span class="literal">None</span>, renderer_context=<span class="literal">None</span></span>):</span><br><span class="line">        <span class="keyword">if</span> renderer_context:</span><br><span class="line">            <span class="comment"># åˆ¤æ–­å®ä¾‹çš„ç±»å‹ï¼Œè¿”å›çš„æ•°æ®å¯èƒ½æ˜¯åˆ—è¡¨ä¹Ÿå¯èƒ½æ˜¯å­—å…¸</span></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">isinstance</span>(data, <span class="built_in">dict</span>):</span><br><span class="line">                <span class="comment"># å¦‚æœæ˜¯å­—å…¸çš„è¯åº”è¯¥æ˜¯è¿”å›çš„æ•°æ®ï¼Œä¼šåŒ…å«msg,code,statusç­‰å­—æ®µå¿…é¡»æŠ½ç¦»å‡ºæ¥</span></span><br><span class="line">                msg = data.pop(<span class="string">&#x27;msg&#x27;</span>, <span class="string">&#x27;success&#x27;</span>)</span><br><span class="line">                code = data.pop(<span class="string">&#x27;code&#x27;</span>, <span class="number">200</span>)</span><br><span class="line">                <span class="comment"># é‡æ–°æ„å»ºè¿”å›çš„JSONå­—å…¸</span></span><br><span class="line">                <span class="keyword">if</span> <span class="string">&#x27;status&#x27;</span> <span class="keyword">in</span> data.keys():</span><br><span class="line">                    <span class="keyword">del</span> data[<span class="string">&#x27;status&#x27;</span>]</span><br><span class="line">                    data = data[<span class="string">&#x27;data&#x27;</span>]</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    data = data</span><br><span class="line">            <span class="comment"># è‡ªå®šä¹‰è¿”å›æ•°æ®æ ¼å¼</span></span><br><span class="line">            ret = &#123;</span><br><span class="line">                <span class="string">&#x27;msg&#x27;</span>: msg,</span><br><span class="line">                <span class="string">&#x27;code&#x27;</span>: code,</span><br><span class="line">                <span class="string">&#x27;data&#x27;</span>: &#123;</span><br><span class="line">                    <span class="string">&#x27;list&#x27;</span>: data,</span><br><span class="line">                    <span class="string">&#x27;total&#x27;</span>: <span class="built_in">len</span>(data),</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment"># è¿”å›JSONæ•°æ®</span></span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">super</span>().render(ret, accepted_media_type, renderer_context)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">super</span>().render(data, accepted_media_type, renderer_context)</span><br></pre></td></tr></table></figure><h2 id="çµæ´»è°ƒç”¨"><a href="#çµæ´»è°ƒç”¨" class="headerlink" title="çµæ´»è°ƒç”¨"></a>çµæ´»è°ƒç”¨</h2><p>åˆ›å»º <code>utils/response.py</code> æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.utils <span class="keyword">import</span> six</span><br><span class="line"><span class="keyword">from</span> rest_framework.response <span class="keyword">import</span> Response</span><br><span class="line"><span class="keyword">from</span> rest_framework.serializers <span class="keyword">import</span> Serializer</span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">JsonResponse</span>(<span class="title class_ inherited__">Response</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    é‡å†™ from django.http import JsonResponse</span></span><br><span class="line"><span class="string">    An HttpResponse that allows its data to be rendered into arbitrary media types.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, data=<span class="literal">None</span>, code=<span class="number">200</span>, msg=<span class="string">&quot;success&quot;</span>, status=<span class="literal">None</span>, template_name=<span class="literal">None</span>, headers=<span class="literal">None</span>,</span></span><br><span class="line"><span class="params">                 exception=<span class="literal">False</span>, content_type=<span class="literal">None</span>, **kwargs</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Alters the init arguments slightly.</span></span><br><span class="line"><span class="string">        For example, drop &#x27;template_name&#x27;, and instead use &#x27;data&#x27;.</span></span><br><span class="line"><span class="string">        Setting &#x27;renderer&#x27; and &#x27;media_type&#x27; will typically be deferred,</span></span><br><span class="line"><span class="string">        For example being set automatically by the `APIView`.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">super</span>(Response, self).__init__(<span class="literal">None</span>, status=status)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(data, Serializer):</span><br><span class="line">            msg = (</span><br><span class="line">                <span class="string">&#x27;You passed a Serializer instance as data, but &#x27;</span></span><br><span class="line">                <span class="string">&#x27;probably meant to pass serialized `.data` or `.error`. representation.&#x27;</span></span><br><span class="line">            )</span><br><span class="line">            <span class="keyword">raise</span> AssertionError(msg)</span><br><span class="line">        self.data = &#123;<span class="string">&quot;code&quot;</span>: code, <span class="string">&quot;message&quot;</span>: msg, <span class="string">&quot;data&quot;</span>: data&#125;</span><br><span class="line">        self.data.update(kwargs)</span><br><span class="line">        self.template_name = template_name</span><br><span class="line">        self.exception = exception</span><br><span class="line">        self.content_type = content_type</span><br><span class="line">        <span class="keyword">if</span> headers:</span><br><span class="line">            <span class="keyword">for</span> name, value <span class="keyword">in</span> six.iteritems(headers):</span><br><span class="line">                self[name] = value</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åœ¨ <code>views.py</code> ä¸­è°ƒç”¨ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> JsonResponse(detail=<span class="string">&quot;æ‚¨åªèƒ½ä¿®æ”¹è‡ªå·±çš„æ•°æ®&quot;</span>, code=<span class="number">403</span>, status=status.HTTP_403_FORBIDDEN)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> django </tag>
            
            <tag> Python </tag>
            
            <tag> drf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æŸ¥çœ‹Navicatä¿å­˜çš„å¯†ç </title>
      <link href="/posts/lqoui8yg/"/>
      <url>/posts/lqoui8yg/</url>
      
        <content type="html"><![CDATA[<p>Navicat å¯†ç ä¸€æ—¦ä¿å­˜, å†æ¬¡ç¼–è¾‘å°±æ²¡æ³•æŸ¥çœ‹å¯†ç æ˜¯ä»€ä¹ˆäº†, åŒ…æ‹¬ä¹‹å‰å¯ä»¥ä½¿ç”¨çš„æ˜Ÿå·å¯†ç æŸ¥çœ‹å™¨ä¹Ÿçœ‹ä¸åˆ°å¯†ç , æˆ‘ä»¬å¯ä»¥é€šè¿‡å¯¼å‡ºé“¾æ¥æ–‡ä»¶, ç„¶åé€šè¿‡è§£å¯†è¢«åŠ å¯†çš„å¯†ç æ¥è·å–å¯†ç åŸæ–‡.</p><h2 id="å¯¼å‡ºåŠ å¯†å¯†ç "><a href="#å¯¼å‡ºåŠ å¯†å¯†ç " class="headerlink" title="å¯¼å‡ºåŠ å¯†å¯†ç "></a>å¯¼å‡ºåŠ å¯†å¯†ç </h2><p>æ‰“å¼€ Navicat â€“ æ–‡ä»¶ â€“ å¯¼å‡ºè¿æ¥<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202312281454479.png" alt="image.png|758"></p><p>æ¥ä¸‹æ¥çš„å¼¹çª—é‡Œ, å‹¾é€‰å¯¼å‡ºå¯†ç , ç„¶åå¯¼å‡ºæˆ ncx æ–‡ä»¶<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202409051736103.png" alt="image.png"></p><p>ç”¨æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€ connections.ncx æ–‡ä»¶, å¤åˆ¶ password çš„å€¼, è¿™ä¸ªå°±æ˜¯åŠ å¯†åçš„å¯†ç .</p><h2 id="ä½¿ç”¨-PHP-è§£å¯†"><a href="#ä½¿ç”¨-PHP-è§£å¯†" class="headerlink" title="ä½¿ç”¨ PHP è§£å¯†"></a>ä½¿ç”¨ PHP è§£å¯†</h2><p>ç”µè„‘æ²¡æœ‰ PHP ç¯å¢ƒ, æ‰€ä»¥é€‰æ‹©ä½¿ç”¨ Docker æ¥è¿è¡Œ PHP, æ“ä½œå¦‚ä¸‹:</p><h3 id="å‡†å¤‡è§£å¯†è„šæœ¬"><a href="#å‡†å¤‡è§£å¯†è„šæœ¬" class="headerlink" title="å‡†å¤‡è§£å¯†è„šæœ¬"></a>å‡†å¤‡è§£å¯†è„šæœ¬</h3><p>vim navicat-decode-password.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">FatSmallTools</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NavicatPassword</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$version</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$aesKey</span> = <span class="string">&#x27;libcckeylibcckey&#x27;</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$aesIv</span> = <span class="string">&#x27;libcciv libcciv &#x27;</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$blowString</span> = <span class="string">&#x27;3DC5CA39&#x27;</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$blowKey</span> = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$blowIv</span> = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$version</span> = <span class="number">12</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;version = <span class="variable">$version</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;blowKey = <span class="title function_ invoke__">sha1</span>(<span class="string">&#x27;3DC5CA39&#x27;</span>, <span class="literal">true</span>);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;blowIv = <span class="title function_ invoke__">hex2bin</span>(<span class="string">&#x27;d9c7c3c8870d64bd&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">encrypt</span>(<span class="params"><span class="variable">$string</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$result</span> = <span class="literal">FALSE</span>;</span><br><span class="line">        <span class="keyword">switch</span> (<span class="variable language_">$this</span>-&gt;version) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">11</span>:</span><br><span class="line">                <span class="variable">$result</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">encryptEleven</span>(<span class="variable">$string</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">12</span>:</span><br><span class="line">                <span class="variable">$result</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">encryptTwelve</span>(<span class="variable">$string</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$result</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">encryptEleven</span>(<span class="params"><span class="variable">$string</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$round</span> = <span class="title function_ invoke__">intval</span>(<span class="title function_ invoke__">floor</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$string</span>) / <span class="number">8</span>));</span><br><span class="line">        <span class="variable">$leftLength</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$string</span>) % <span class="number">8</span>;</span><br><span class="line">        <span class="variable">$result</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        <span class="variable">$currentVector</span> = <span class="variable language_">$this</span>-&gt;blowIv;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$round</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$temp</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">encryptBlock</span>(<span class="variable">$this</span>-&gt;<span class="title function_ invoke__">xorBytes</span>(<span class="title function_ invoke__">substr</span>(<span class="variable">$string</span>, <span class="number">8</span> * <span class="variable">$i</span>, <span class="number">8</span>), <span class="variable">$currentVector</span>));</span><br><span class="line">            <span class="variable">$currentVector</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">xorBytes</span>(<span class="variable">$currentVector</span>, <span class="variable">$temp</span>);</span><br><span class="line">            <span class="variable">$result</span> .= <span class="variable">$temp</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$leftLength</span>) &#123;</span><br><span class="line">            <span class="variable">$currentVector</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">encryptBlock</span>(<span class="variable">$currentVector</span>);</span><br><span class="line">            <span class="variable">$result</span> .= <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">xorBytes</span>(<span class="title function_ invoke__">substr</span>(<span class="variable">$string</span>, <span class="number">8</span> * <span class="variable">$i</span>, <span class="variable">$leftLength</span>), <span class="variable">$currentVector</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">strtoupper</span>(<span class="title function_ invoke__">bin2hex</span>(<span class="variable">$result</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">encryptBlock</span>(<span class="params"><span class="variable">$block</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">openssl_encrypt</span>(<span class="variable">$block</span>, <span class="string">&#x27;BF-ECB&#x27;</span>, <span class="variable">$this</span>-&gt;blowKey, OPENSSL_RAW_DATA|OPENSSL_NO_PADDING);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">decryptBlock</span>(<span class="params"><span class="variable">$block</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">openssl_decrypt</span>(<span class="variable">$block</span>, <span class="string">&#x27;BF-ECB&#x27;</span>, <span class="variable">$this</span>-&gt;blowKey, OPENSSL_RAW_DATA|OPENSSL_NO_PADDING);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">xorBytes</span>(<span class="params"><span class="variable">$str1</span>, <span class="variable">$str2</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$result</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="title function_ invoke__">strlen</span>(<span class="variable">$str1</span>); <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$result</span> .= <span class="title function_ invoke__">chr</span>(<span class="title function_ invoke__">ord</span>(<span class="variable">$str1</span>[<span class="variable">$i</span>]) ^ <span class="title function_ invoke__">ord</span>(<span class="variable">$str2</span>[<span class="variable">$i</span>]));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$result</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">encryptTwelve</span>(<span class="params"><span class="variable">$string</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$result</span> = <span class="title function_ invoke__">openssl_encrypt</span>(<span class="variable">$string</span>, <span class="string">&#x27;AES-128-CBC&#x27;</span>, <span class="variable">$this</span>-&gt;aesKey, OPENSSL_RAW_DATA, <span class="variable">$this</span>-&gt;aesIv);</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">strtoupper</span>(<span class="title function_ invoke__">bin2hex</span>(<span class="variable">$result</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">decrypt</span>(<span class="params"><span class="variable">$string</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$result</span> = <span class="literal">FALSE</span>;</span><br><span class="line">        <span class="keyword">switch</span> (<span class="variable language_">$this</span>-&gt;version) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">11</span>:</span><br><span class="line">                <span class="variable">$result</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">decryptEleven</span>(<span class="variable">$string</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">12</span>:</span><br><span class="line">                <span class="variable">$result</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">decryptTwelve</span>(<span class="variable">$string</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$result</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">decryptEleven</span>(<span class="params"><span class="variable">$upperString</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$string</span> = <span class="title function_ invoke__">hex2bin</span>(<span class="title function_ invoke__">strtolower</span>(<span class="variable">$upperString</span>));</span><br><span class="line"></span><br><span class="line">        <span class="variable">$round</span> = <span class="title function_ invoke__">intval</span>(<span class="title function_ invoke__">floor</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$string</span>) / <span class="number">8</span>));</span><br><span class="line">        <span class="variable">$leftLength</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$string</span>) % <span class="number">8</span>;</span><br><span class="line">        <span class="variable">$result</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        <span class="variable">$currentVector</span> = <span class="variable language_">$this</span>-&gt;blowIv;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$round</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$encryptedBlock</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$string</span>, <span class="number">8</span> * <span class="variable">$i</span>, <span class="number">8</span>);</span><br><span class="line">            <span class="variable">$temp</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">xorBytes</span>(<span class="variable">$this</span>-&gt;<span class="title function_ invoke__">decryptBlock</span>(<span class="variable">$encryptedBlock</span>), <span class="variable">$currentVector</span>);</span><br><span class="line">            <span class="variable">$currentVector</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">xorBytes</span>(<span class="variable">$currentVector</span>, <span class="variable">$encryptedBlock</span>);</span><br><span class="line">            <span class="variable">$result</span> .= <span class="variable">$temp</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$leftLength</span>) &#123;</span><br><span class="line">            <span class="variable">$currentVector</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">encryptBlock</span>(<span class="variable">$currentVector</span>);</span><br><span class="line">            <span class="variable">$result</span> .= <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">xorBytes</span>(<span class="title function_ invoke__">substr</span>(<span class="variable">$string</span>, <span class="number">8</span> * <span class="variable">$i</span>, <span class="variable">$leftLength</span>), <span class="variable">$currentVector</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$result</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">decryptTwelve</span>(<span class="params"><span class="variable">$upperString</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$string</span> = <span class="title function_ invoke__">hex2bin</span>(<span class="title function_ invoke__">strtolower</span>(<span class="variable">$upperString</span>));</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">openssl_decrypt</span>(<span class="variable">$string</span>, <span class="string">&#x27;AES-128-CBC&#x27;</span>, <span class="variable">$this</span>-&gt;aesKey, OPENSSL_RAW_DATA, <span class="variable">$this</span>-&gt;aesIv);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">FatSmallTools</span>\<span class="title">NavicatPassword</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// éœ€è¦æŒ‡å®šç‰ˆæœ¬ï¼Œ11 é€‚ç”¨äº11ç‰ˆæœ¬æˆ–ä»¥ä¸‹.</span></span><br><span class="line"><span class="comment">// 12 é€‚ç”¨äº12ç‰ˆæœ¬å’Œä»¥ä¸Š, ä¸ªäººæµ‹è¯•16ç‰ˆæœ¬å¯ä»¥æ­£å¸¸è§£å¯†.</span></span><br><span class="line"><span class="variable">$navicatPassword</span> = <span class="keyword">new</span> <span class="title class_">NavicatPassword</span>(<span class="number">12</span>);</span><br><span class="line"><span class="comment">//$navicatPassword = new NavicatPassword(11);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//è§£å¯†, ä»å‘½ä»¤è¡Œå‚æ•°è¯»å–</span></span><br><span class="line"><span class="variable">$encrypted_password</span> = <span class="variable">$_SERVER</span>[<span class="string">&#x27;argv&#x27;</span>][<span class="number">1</span>];</span><br><span class="line"><span class="variable">$decode</span> = <span class="variable">$navicatPassword</span>-&gt;<span class="title function_ invoke__">decrypt</span>(<span class="variable">$encrypted_password</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$decode</span>.<span class="string">&quot;\n&quot;</span>;</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨-Docker-ç‰ˆ-PHP-æ¥æ‰§è¡Œè„šæœ¬"><a href="#ä½¿ç”¨-Docker-ç‰ˆ-PHP-æ¥æ‰§è¡Œè„šæœ¬" class="headerlink" title="ä½¿ç”¨ Docker ç‰ˆ PHP æ¥æ‰§è¡Œè„šæœ¬"></a>ä½¿ç”¨ Docker ç‰ˆ PHP æ¥æ‰§è¡Œè„šæœ¬</h3><p>æ‰§è¡Œ php è„šæœ¬,ä½¿ç”¨ cli ç‰ˆæœ¬çš„é•œåƒå³å¯. è¿™é‡Œé€‰æ‹© <code>php:8.3.1-cli</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --<span class="built_in">rm</span> -v <span class="string">&quot;<span class="subst">$(pwd)</span>&quot;</span>:/data php:8.3.1-cli php /data/navicat-decode-password.php <span class="string">&quot;F0FC4E94542FF60596CC6FFA9F5F68D1&quot;</span></span><br></pre></td></tr></table></figure><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202407041653042.png" alt="image.png"></p><p>å¯†ç ä¼šæ‰“å°åœ¨æ§åˆ¶å°ä¸Š.</p><h2 id="ä¼˜åŒ–ç‰ˆè„šæœ¬"><a href="#ä¼˜åŒ–ç‰ˆè„šæœ¬" class="headerlink" title="ä¼˜åŒ–ç‰ˆè„šæœ¬"></a>ä¼˜åŒ–ç‰ˆè„šæœ¬</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">list=$(grep <span class="string">&quot;&lt;Connection ConnectionName=&quot;</span> connections.ncx)</span><br><span class="line"></span><br><span class="line">IFS=$<span class="string">&#x27;\n&#x27;</span>        <span class="comment"># æŒ‡å®šåˆ†éš”ç¬¦ä¸ºæ¢è¡Œ</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="variable">$&#123;list[*]&#125;</span>;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    name=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$i</span>&quot;</span> | awk -F <span class="string">&#x27;ConnectionName=&quot;&#x27;</span> <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | awk -F <span class="string">&#x27;&quot;&#x27;</span> <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>)</span><br><span class="line">    user=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$i</span>&quot;</span> | awk -F <span class="string">&#x27;UserName=&quot;&#x27;</span> <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | awk -F <span class="string">&#x27;&quot;&#x27;</span> <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>)</span><br><span class="line">    host=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$i</span>&quot;</span> | awk -F <span class="string">&#x27;Host=&quot;&#x27;</span> <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | awk -F <span class="string">&#x27;&quot;&#x27;</span> <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>)</span><br><span class="line">    port=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$i</span>&quot;</span> | awk -F <span class="string">&#x27;Port=&quot;&#x27;</span> <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | awk -F <span class="string">&#x27;&quot;&#x27;</span> <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>)</span><br><span class="line">    en_password=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$i</span>&quot;</span> | awk -F <span class="string">&#x27;Password=&quot;&#x27;</span> <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | awk -F <span class="string">&#x27;&quot; &#x27;</span> <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>)</span><br><span class="line">    password=$(docker run --<span class="built_in">rm</span> -v <span class="string">&quot;<span class="subst">$(pwd)</span>&quot;</span>:/data php:8.3.1-cli php /data/navicat-decode-password.php <span class="string">&quot;<span class="variable">$en_password</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$name</span>&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;åœ°å€:  <span class="variable">$host</span>&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;ç«¯å£:  <span class="variable">$port</span>&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;ç”¨æˆ·ï¼š <span class="variable">$user</span>&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;å¯†ç ï¼š <span class="variable">$password</span>&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> ----------------------------------------------------------------------------------------</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><p>è„šæœ¬ä¼šè¯»å– <code>connections.ncx</code> æ–‡ä»¶ï¼Œå¹¶æŒ‰ç…§æ ¼å¼å°†å†…å®¹è¾“å‡ºï¼š</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202407041658550.png" alt="image.png"></p>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
            <tag> MySQL </tag>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Django RestFramework ä½¿ç”¨routerç”Ÿæˆè·¯ç”±</title>
      <link href="/posts/lqmfi6wc/"/>
      <url>/posts/lqmfi6wc/</url>
      
        <content type="html"><![CDATA[<p>django ä½¿ç”¨çš„æ˜¯æ¨¡å—åŒ–ç»“æ„ï¼Œæ¯ä¸ª app éƒ½å¯ä»¥ç‹¬ç«‹æ‹†åˆ†ï¼Œé‚£ä¹ˆæ³¨å†Œè·¯ç”±çš„æ—¶å€™ä¹Ÿå¯ä»¥çµæ´»ä¸€ç‚¹ï¼Œ ä½¿ç”¨ drf æ¡†æ¶æä¾›çš„ router æ¥è‡ªåŠ¨ç”Ÿæˆè·¯ç”±</p><p>åº”ç”¨çº§ urls.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path, include</span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> routers</span><br><span class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">router = routers.DefaultRouter()</span><br><span class="line">router.register(<span class="string">r&#x27;groups&#x27;</span>, views.GroupViewSet)</span><br><span class="line">router.register(<span class="string">r&#x27;students&#x27;</span>, views.StudentViewSet)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;/&#x27;</span>, include(router.urls)),</span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™é‡Œ path è·¯å¾„æ˜¯&#x2F;ï¼Œ å¼•ç”¨äº† routerï¼Œ router æ³¨å†Œäº†ä¸¤ä¸ªè·¯ç”±ï¼Œ åˆ†åˆ«æ˜¯ groups å’Œ studentsï¼Œ ç”Ÿæˆçš„ api è·¯å¾„å°±æ˜¯ <code>/groups/</code> å’Œ <code>/students</code></p><p>æ ¹çº§è·¯ç”± urls.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path, include</span><br><span class="line"><span class="keyword">from</span> app01.urls <span class="keyword">import</span> router <span class="keyword">as</span> app01_router</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;admin/&#x27;</span>, admin.site.urls),</span><br><span class="line">    path(<span class="string">&#x27;api/&#x27;</span>, include(app01_router.urls))</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå®šä¹‰äº† api&#x2F; å¼•å…¥äº† app01 é‡Œé¢çš„ router</p><p>é‚£ä¹ˆæœ€ç»ˆçš„ url ç»“æ„å°±æ˜¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:8000/api/groups/</span><br><span class="line">http://localhost:8000/api/students/</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> django </tag>
            
            <tag> Python </tag>
            
            <tag> drf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>batå‘½ä»¤ä¿®æ”¹windowsç¯å¢ƒå˜é‡</title>
      <link href="/posts/lqgfuqik/"/>
      <url>/posts/lqgfuqik/</url>
      
        <content type="html"><![CDATA[<p>åœ¨ bat ä¸‹ä¿®æ”¹ç¯å¢ƒå˜é‡æœ‰å‡ ç§æ–¹å¼, æ¯”å¦‚ <code>set</code> <code>setx</code> <code>vmic ENVIRONMENT</code></p><h2 id="set"><a href="#set" class="headerlink" title="set"></a>set</h2><p>windows çš„ set å’Œ bash é‡Œé¢ç›´æ¥èµ‹å€¼ç±»ä¼¼, åªåœ¨å½“å‰è„šæœ¬ä¸­ç”Ÿæ•ˆ, æ¯”å¦‚</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> a=b</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">%a%</span></span><br><span class="line">b</span><br></pre></td></tr></table></figure><h2 id="setx"><a href="#setx" class="headerlink" title="setx"></a>setx</h2><p>setx å’Œ set ç±»ä¼¼, ä¸ä¸€æ ·çš„æ˜¯ setx ä¼šæŠŠè®¾ç½®æŒä¹…åŒ–ä¿å­˜èµ·æ¥</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setx a c</span><br></pre></td></tr></table></figure><p>å› ä¸º setx ç›´æ¥å°†ç¯å¢ƒå˜é‡ä¿å­˜åœ¨æ³¨å†Œè¡¨ä¸­, æ‰€ä»¥ cmd ç»ˆç«¯éœ€è¦å…³é—­é‡æ–°æ‰“å¼€æ‰èƒ½ç”Ÿæ•ˆ</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="variable">%a%</span></span><br><span class="line">c</span><br></pre></td></tr></table></figure><p>åç»­å°±ç®—é‡å¯ç”µè„‘, ä¹Ÿä¼šç”Ÿæ•ˆ, ä¸è¿‡æ•°æ®é‡æ¯”è¾ƒå¤§çš„æ—¶å€™ä¼šæŠ¥é”™ï¼š <code>WARNING: The data being saved is truncated to 1024 characters</code>ï¼Œ æœ€ç»ˆä¿®æ”¹çš„å†…å®¹ä¹Ÿæ˜¯ä¸å®Œæ•´çš„ã€‚æ‰€ä»¥ä¸å»ºè®®ä½¿ç”¨</p><h2 id="vmic"><a href="#vmic" class="headerlink" title="vmic"></a>vmic</h2><h3 id="wmic-å¸¸ç”¨å‘½ä»¤"><a href="#wmic-å¸¸ç”¨å‘½ä»¤" class="headerlink" title="wmic å¸¸ç”¨å‘½ä»¤"></a>wmic å¸¸ç”¨å‘½ä»¤</h3><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># åˆ›å»ºç³»ç»Ÿå˜é‡</span><br><span class="line">wmic ENVIRONMENT create name=&quot;PPTV_HOME&quot;,username=&quot;&lt;system&gt;&quot;,VariableValue=&quot;<span class="variable">%home%</span>&quot;</span><br><span class="line"></span><br><span class="line"># åˆ›å»ºç”¨æˆ·å˜é‡(æ›¿æ¢ä¸€ä¸‹è®¡ç®—æœºåå’Œç”¨æˆ·å)</span><br><span class="line">wmic ENVIRONMENT create name=&quot;PPTV_HOME&quot;,username=&quot;è®¡ç®—æœºå\\ç”¨æˆ·å&quot;,VariableValue=&quot;<span class="variable">%home%</span>&quot;</span><br><span class="line"></span><br><span class="line"># æŸ¥çœ‹ç¯å¢ƒå˜é‡</span><br><span class="line">wmic environment where &quot;name=&#x27;<span class="built_in">Path</span>&#x27;&quot; get UserName,VariableValue</span><br><span class="line"></span><br><span class="line"># åˆ é™¤ç¯å¢ƒå˜é‡</span><br><span class="line">wmic ENVIRONMENT where &quot;name=&#x27;PPTV_HOME&#x27;&quot; delete</span><br></pre></td></tr></table></figure><h3 id="ä¸¾ä¸ªä¾‹å­"><a href="#ä¸¾ä¸ªä¾‹å­" class="headerlink" title="ä¸¾ä¸ªä¾‹å­"></a>ä¸¾ä¸ªä¾‹å­</h3><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">REM è®¾ç½®ä¸€ä¸‹éœ€è¦æ·»åŠ ç¯å¢ƒå˜é‡çš„ç›®å½•</span></span><br><span class="line"><span class="built_in">SET</span> DestFile=&quot;<span class="variable">%USERPROFILE%</span>\bin&quot;</span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">REM å¢åŠ binç¯å¢ƒå˜é‡</span></span><br><span class="line"><span class="built_in">set</span> <span class="built_in">path</span> | <span class="built_in">findstr</span> &quot;<span class="variable">%DestFile%</span>&quot; &gt;<span class="built_in">nul</span> &amp;&amp; (</span><br><span class="line">    <span class="built_in">echo</span> ç¯å¢ƒå˜é‡å·²å­˜åœ¨</span><br><span class="line">) || (</span><br><span class="line">    <span class="built_in">echo</span> ç¯å¢ƒå˜é‡ä¸å­˜åœ¨</span><br><span class="line">    wmic ENVIRONMENT where &quot;name=&#x27;<span class="built_in">Path</span>&#x27; and username=&#x27;<span class="variable">%USERDOMAIN%</span>\\<span class="variable">%USERNAME%</span>&#x27;&quot; <span class="built_in">set</span> VariableValue=&quot;<span class="variable">%Path%</span>;<span class="variable">%DestFile%</span>&quot;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h2 id="æ³¨å†Œè¡¨æ–¹å¼"><a href="#æ³¨å†Œè¡¨æ–¹å¼" class="headerlink" title="æ³¨å†Œè¡¨æ–¹å¼"></a>æ³¨å†Œè¡¨æ–¹å¼</h2><h3 id="å½“å‰ç”¨æˆ·ç¯å¢ƒå˜é‡"><a href="#å½“å‰ç”¨æˆ·ç¯å¢ƒå˜é‡" class="headerlink" title="å½“å‰ç”¨æˆ·ç¯å¢ƒå˜é‡"></a>å½“å‰ç”¨æˆ·ç¯å¢ƒå˜é‡</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Windows Registry Editor Version 5.00</span><br><span class="line"></span><br><span class="line">[HKEY_CURRENT_USER\Environment]</span><br><span class="line">&quot;a&quot;=&quot;b&quot;</span><br></pre></td></tr></table></figure><h3 id="ç³»ç»Ÿç¯å¢ƒå˜é‡"><a href="#ç³»ç»Ÿç¯å¢ƒå˜é‡" class="headerlink" title="ç³»ç»Ÿç¯å¢ƒå˜é‡"></a>ç³»ç»Ÿç¯å¢ƒå˜é‡</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Windows Registry Editor Version 5.00</span><br><span class="line"></span><br><span class="line">[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Session Manager\Environment]</span><br><span class="line">&quot;c&quot;=&quot;d&quot;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cmd </tag>
            
            <tag> bat </tag>
            
            <tag> è„šæœ¬ </tag>
            
            <tag> Script </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨kubectlè¿›è¡Œå¤šé›†ç¾¤ç®¡ç†</title>
      <link href="/posts/lqacdmqv/"/>
      <url>/posts/lqacdmqv/</url>
      
        <content type="html"><![CDATA[<p>å¹³å¸¸ä½¿ç”¨è·³æ¿æœºæ¥ç®¡ç†, ç»å¸¸å¤šä¸ªç¯å¢ƒå¤šå¥—é›†ç¾¤, é‚£ä¹ˆå¦‚ä½•ç”¨ä¸€ä¸ª kubectl å¦‚ä½•ç®¡ç†è¿™äº›é›†ç¾¤.</p><h2 id="æ¨èæ–¹å¼"><a href="#æ¨èæ–¹å¼" class="headerlink" title="æ¨èæ–¹å¼"></a>æ¨èæ–¹å¼</h2><p>è¿™ç§æ–¹å¼å¯¹ç³»ç»Ÿçš„ä¾µå…¥æ€§æ¯”è¾ƒå°ï¼Œä¹Ÿä¸ç”¨ä¿®æ”¹ kubeconfig æ–‡ä»¶ï¼Œä¹Ÿä¸ç”¨åœ¨ linux ä¸­å¢åŠ ç”¨æˆ·ç­‰ã€‚ã€‚</p><p>å‡†å¤‡ä¸åŒçš„ kubeconfig æ–‡ä»¶ï¼Œæ¯”å¦‚ <code>prod</code> <code>uat</code></p><h3 id="è„šæœ¬ä¸€"><a href="#è„šæœ¬ä¸€" class="headerlink" title="è„šæœ¬ä¸€"></a>è„šæœ¬ä¸€</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> KUBECONFIG=./prod </span><br><span class="line">bash</span><br></pre></td></tr></table></figure><p>è¿™é‡Œ export æ˜¯å¿…é¡»çš„ï¼Œexport çš„ä½œç”¨æ˜¯å°†ç¯å¢ƒå˜é‡ä¼ é€’åˆ°å­è¿›ç¨‹ä¸­ï¼Œè€Œ bash æ˜¯è¿™ä¸ªè„šæœ¬çš„å­è¿›ç¨‹ã€‚</p><h3 id="è„šæœ¬äºŒ"><a href="#è„šæœ¬äºŒ" class="headerlink" title="è„šæœ¬äºŒ"></a>è„šæœ¬äºŒ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">KUBECONFIG=./prod</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œçš„æ—¶å€™é€šè¿‡ <code>. a.sh</code> æˆ– <code>source a.sh</code> çš„æ—¶å€™ï¼Œsource æˆ– . çš„ä½œç”¨æ˜¯å°†ç¯å¢ƒå˜é‡ä¼ é€’åˆ°å½“å‰ shell ä¸­ã€‚</p><h2 id="ä½¿ç”¨ä¸åŒçš„-kubeconfig-ç®¡ç†"><a href="#ä½¿ç”¨ä¸åŒçš„-kubeconfig-ç®¡ç†" class="headerlink" title="ä½¿ç”¨ä¸åŒçš„ kubeconfig ç®¡ç†"></a>ä½¿ç”¨ä¸åŒçš„ kubeconfig ç®¡ç†</h2><h3 id="ä½¿ç”¨ä¸åŒçš„-Linux-ç”¨æˆ·"><a href="#ä½¿ç”¨ä¸åŒçš„-Linux-ç”¨æˆ·" class="headerlink" title="ä½¿ç”¨ä¸åŒçš„ Linux ç”¨æˆ·"></a>ä½¿ç”¨ä¸åŒçš„ Linux ç”¨æˆ·</h3><p>æ¯ä¸ª Linux ç”¨æˆ·çš„ <code>~/.kube/config</code> é…ç½®ä¸åŒå³å¯, æ¯”å¦‚åˆ›å»ºä¸€ä¸ª uat ç”¨æˆ·,ä¸€ä¸ª prod ç”¨æˆ·, åˆ†åˆ«é…ç½®ä¸åŒçš„ config æ–‡ä»¶</p><h3 id="ä½¿ç”¨ç¯å¢ƒå˜é‡"><a href="#ä½¿ç”¨ç¯å¢ƒå˜é‡" class="headerlink" title="ä½¿ç”¨ç¯å¢ƒå˜é‡"></a>ä½¿ç”¨ç¯å¢ƒå˜é‡</h3><p>è®¾ç½®ä¸€ä¸ª <code>KUBECONFIG</code> æŒ‡å®šåˆ° kubeconfig æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">KUBECONFIG=config-uat kubectl get pod</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨å‚æ•°"><a href="#ä½¿ç”¨å‚æ•°" class="headerlink" title="ä½¿ç”¨å‚æ•°"></a>ä½¿ç”¨å‚æ•°</h3><p>åŒä½¿ç”¨ç¯å¢ƒå˜é‡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pod --kubeconfig=config-uat</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨ä¸€ä¸ª-kubeconfig"><a href="#ä½¿ç”¨ä¸€ä¸ª-kubeconfig" class="headerlink" title="ä½¿ç”¨ä¸€ä¸ª kubeconfig"></a>ä½¿ç”¨ä¸€ä¸ª kubeconfig</h2><p>æˆ‘è§‰å¾—è¿™ç§æ–¹æ³•å¾ˆç¹çä¸”å¤æ‚ï¼Œå¹¶ä¸”è¿˜ä¼šä¿®æ”¹ kubeconfigã€‚</p><h3 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h3><p>ç¡®ä¿æ¯ä¸ª kubeconfig é‡Œé¢éƒ¨åˆ†å‚æ•°å”¯ä¸€æ€§,å¯ä»¥æ‰‹åŠ¨ä¿®æ”¹ä¸€ä¸‹</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202312181126408.png" alt="image.png"></p><h3 id="åˆå¹¶é…ç½®æ–‡ä»¶"><a href="#åˆå¹¶é…ç½®æ–‡ä»¶" class="headerlink" title="åˆå¹¶é…ç½®æ–‡ä»¶"></a>åˆå¹¶é…ç½®æ–‡ä»¶</h3><p>å‡è®¾ä¸€ä¸ªé…ç½®æ–‡ä»¶åä¸º: uat, å¦ä¸€ä¸ªä¸º: prod</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">KUBECONFIG=uat:prod kubectl config view --flatten &gt; merged-kubeconfig</span><br></pre></td></tr></table></figure><h3 id="éªŒè¯åˆå¹¶ç»“æœ"><a href="#éªŒè¯åˆå¹¶ç»“æœ" class="headerlink" title="éªŒè¯åˆå¹¶ç»“æœ"></a>éªŒè¯åˆå¹¶ç»“æœ</h3><p>å®Œæˆåˆå¹¶åï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤éªŒè¯æ–°çš„ kubeconfig æ–‡ä»¶æ˜¯å¦åŒ…å«äº†æ‰€æœ‰çš„é›†ç¾¤ã€ç”¨æˆ·å’Œä¸Šä¸‹æ–‡å®šä¹‰, å¦‚æœä¸Šé¢æ²¡æœ‰ä¿è¯å”¯ä¸€æ€§, é‚£ä¹ˆåˆå¹¶åçš„é…ç½®å°±æ˜¯ä¸å®Œæ•´çš„.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl config view --kubeconfig=merged-kubeconfig</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨é…ç½®æ–‡ä»¶"><a href="#ä½¿ç”¨é…ç½®æ–‡ä»¶" class="headerlink" title="ä½¿ç”¨é…ç½®æ–‡ä»¶"></a>ä½¿ç”¨é…ç½®æ–‡ä»¶</h3><p>é™¤äº†æŒ‡å®šé…ç½®æ–‡ä»¶å¤– (å¦‚æœé…ç½®æ–‡ä»¶æ”¾åˆ°~&#x2F;.kube&#x2F;config å†…,ä¸éœ€è¦åŠ  â€“kubeconfig å‚æ•°)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ‡æ¢åˆ°uaté›†ç¾¤, é…ç½®ä¼šä¿å­˜åˆ°é…ç½®æ–‡ä»¶(ä¸‹æ¬¡é»˜è®¤å°±æ˜¯uaté›†ç¾¤äº†)</span></span><br><span class="line">kubectl config use-context uat --kubeconfig=merged-kubeconfig</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ‡æ¢åˆ°prodé›†ç¾¤</span></span><br><span class="line">kubectl config use-context prod --kubeconfig=merged-kubeconfig</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å®¹å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
            <tag> kubectl </tag>
            
            <tag> Kubernetes </tag>
            
            <tag> æƒé™ç®¡ç† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Kubernetesä½¿ç”¨å­˜å‚¨æŒ‚è½½å•ä¸ªæ–‡ä»¶</title>
      <link href="/posts/lq292e56/"/>
      <url>/posts/lq292e56/</url>
      
        <content type="html"><![CDATA[<p>ä¸€èˆ¬æ¥è¯´, æŒ‚è½½å­˜å‚¨éƒ½æ˜¯æŠŠä¸€ä¸ª PV æŒ‚è½½åˆ°ä¸€ä¸ªè·¯å¾„, æŒ‚è½½åæ­¤è·¯å¾„ä¸‹åŸæ¥çš„æ–‡ä»¶å°±ä¼šä¸è§, åªèƒ½çœ‹åˆ°æŒ‚è½½åçš„æ–‡ä»¶, å’Œåœ¨ Linux ä¸‹æŒ‚è½½ç£ç›˜æ˜¯ä¸€æ ·çš„. é‚£ä¹ˆç°åœ¨æœ‰ä¸ªéœ€æ±‚:</p><h2 id="éœ€æ±‚"><a href="#éœ€æ±‚" class="headerlink" title="éœ€æ±‚"></a>éœ€æ±‚</h2><p>æ­¤æœåŠ¡æ˜¯ java ç¨‹åº, æ•°æ®åº“ä½¿ç”¨çš„æ˜¯å†…åµŒçš„ h2 database, ä¸‹å›¾ä¸­çš„ä¸¤ä¸ªæ–‡ä»¶å°±æ˜¯æ•°æ®åº“çš„æ–‡ä»¶. è¿™ä¸¤ä¸ªæ–‡ä»¶æ˜¯å­˜åœ¨äºæ ¹ç›®å½•ä¸‹çš„, å‡è®¾æ­¤ç¨‹åºæ•°æ®åº“æ–‡ä»¶æ˜¯ä»£ç å†™æ­»çš„ (çœŸå®æƒ…å†µæ˜¯: æ•°æ®åº“è·¯å¾„æ˜¯å¯ä»¥æ›´æ”¹çš„), ç°åœ¨è¦éƒ¨ç½²åˆ° kubernetes ä¸­, å¹¶å¯¹æ•°æ®åº“åšæŒä¹…åŒ–.<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202312121923294.png" alt="image.png"></p><h2 id="ä½¿ç”¨-subpath"><a href="#ä½¿ç”¨-subpath" class="headerlink" title="ä½¿ç”¨ subpath"></a>ä½¿ç”¨ subpath</h2><p>æ ¹æ®ä¹‹å‰æŒ‚è½½ configmap åˆ°å•ä¸ªæ–‡ä»¶çš„ç»éªŒ, æˆ‘ä»¬åº”è¯¥ä½¿ç”¨ subpath æ¥æŒ‚è½½, å…ˆåˆ›å»ºå¥½ pvc, yml å¦‚ä¸‹</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolumeClaim</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">metabase-pvc</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">storageClassName:</span> <span class="string">managed-nfs-storage</span></span><br><span class="line">  <span class="attr">accessModes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ReadWriteOnce</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">    <span class="attr">requests:</span></span><br><span class="line">      <span class="attr">storage:</span> <span class="string">10Gi</span></span><br></pre></td></tr></table></figure><p>statefulset çš„é…ç½®</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">serviceName:</span> <span class="string">&quot;metabase&quot;</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">metabase</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">metabase</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">image:</span> <span class="string">registry.cn-hangzhou.aliyuncs.com/iuxt/metabase:test</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">metabase</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">metabase-pv</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/metabase.db.mv.db</span></span><br><span class="line">          <span class="attr">subPath:</span> <span class="string">metabase.db.mv.db</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">metabase-pv</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/metabase.db.trace.db</span></span><br><span class="line">          <span class="attr">subPath:</span> <span class="string">metabase.db.trace.db</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">metabase-pv</span></span><br><span class="line">          <span class="attr">persistentVolumeClaim:</span></span><br><span class="line">            <span class="attr">claimName:</span> <span class="string">metabase-pvc</span></span><br></pre></td></tr></table></figure><p>ä½†æ˜¯è¿™æ ·æŒ‚è½½å, å®¹å™¨å†…çš„ metabase.db.mv.db å’Œ metabase.db.trace.db æ˜¯ç›®å½•, å¹¶ä¸æ˜¯æ–‡ä»¶, ç¨‹åºä¹Ÿè‡ªç„¶æ— æ³•å¯åŠ¨.</p><h2 id="subpath-åŸç†"><a href="#subpath-åŸç†" class="headerlink" title="subpath åŸç†"></a>subpath åŸç†</h2><p>ä¸‹é¢æ˜¯ç»‘å®š subPath çš„æºç éƒ¨åˆ†ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸‹é¢çš„ <code>t.Model()&amp;os.ModeDir</code> éƒ¨åˆ†ï¼Œå¦‚æœ <code>subPath</code> æ˜¯ä¸€ä¸ªæ–‡ä»¶å¤¹çš„è¯å°±ä¼šå»åˆ›å»ºè¿™ä¸ªæ–‡ä»¶å¤¹ï¼Œå¦‚æœæ˜¯æ–‡ä»¶çš„è¯å°±è¿›è¡Œå•ç‹¬æŒ‚è½½ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">doBindSubPath</span><span class="params">(mounter Interface, subpath Subpath, kubeletPid <span class="type">int</span>)</span></span> (hostPath <span class="type">string</span>, err <span class="type">error</span>) &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">// Create target of the bind mount. A directory for directories, empty file</span></span><br><span class="line">    <span class="comment">// for everything else.</span></span><br><span class="line">    t, err := os.Lstat(subpath.Path)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>, fmt.Errorf(<span class="string">&quot;lstat %s failed: %s&quot;</span>, subpath.Path, err)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> t.Mode() &amp; os.ModeDir &gt; <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> err = os.Mkdir(bindPathTarget, <span class="number">0750</span>); err != <span class="literal">nil</span> &amp;&amp; !os.IsExist(err) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&quot;</span>, fmt.Errorf(<span class="string">&quot;error creating directory %s: %s&quot;</span>, bindPathTarget, err)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// &quot;/bin/touch &lt;bindDir&gt;&quot;.</span></span><br><span class="line">        <span class="comment">// A file is enough for all possible targets (symlink, device, pipe,</span></span><br><span class="line">        <span class="comment">// socket, ...), bind-mounting them into a file correctly changes type</span></span><br><span class="line">        <span class="comment">// of the target file.</span></span><br><span class="line">        <span class="keyword">if</span> err = ioutil.WriteFile(bindPathTarget, []<span class="type">byte</span>&#123;&#125;, <span class="number">0640</span>); err != <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&quot;</span>, fmt.Errorf(<span class="string">&quot;error creating file %s: %s&quot;</span>, bindPathTarget, err)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆæˆ‘ä»¬å¯ä¸å¯ä»¥é€šè¿‡æ‰‹åŠ¨åˆ›å»ºå¥½æ–‡ä»¶æ¥å®ç°éœ€æ±‚, ç­”æ¡ˆæ˜¯å¯ä»¥çš„. ä½ å¯ä»¥è‡ªå·±æµ‹è¯•ä¸‹, ä½†æ˜¯åœ¨å­˜å‚¨ä¸­æ‰‹åŠ¨åˆ›å»ºæ–‡ä»¶ä¹Ÿå¤ªä¸ä¼˜é›…äº†..</p><h2 id="ä½¿ç”¨-init-container-æ¥è‡ªåŠ¨åˆ›å»ºç©ºæ–‡ä»¶"><a href="#ä½¿ç”¨-init-container-æ¥è‡ªåŠ¨åˆ›å»ºç©ºæ–‡ä»¶" class="headerlink" title="ä½¿ç”¨ init container æ¥è‡ªåŠ¨åˆ›å»ºç©ºæ–‡ä»¶"></a>ä½¿ç”¨ init container æ¥è‡ªåŠ¨åˆ›å»ºç©ºæ–‡ä»¶</h2><p>init container éå¸¸é€‚åˆæ¥åšè¿™ä»¶äº‹, é‚£ä¹ˆå®Œæ•´çš„ yaml æ–‡ä»¶å¦‚ä¸‹:</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">StatefulSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">metabase-StatefulSet</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">metabase</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">serviceName:</span> <span class="string">&quot;metabase&quot;</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">metabase</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">metabase</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">initContainers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">init</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">busybox:1.28</span></span><br><span class="line">        <span class="attr">command:</span> [<span class="string">&#x27;sh&#x27;</span>, <span class="string">&#x27;-c&#x27;</span>, <span class="string">&quot;touch /metabase/metabase.db.mv.db /metabase/metabase.db.trace.db&quot;</span>]</span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">metabase-pv</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/metabase</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">metabase-pv</span></span><br><span class="line">          <span class="attr">persistentVolumeClaim:</span></span><br><span class="line">            <span class="attr">claimName:</span> <span class="string">metabase-pvc</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">image:</span> <span class="string">registry.cn-hangzhou.aliyuncs.com/iuxt/metabase:test</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">metabase</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">3000</span></span><br><span class="line">          <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line"></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">metabase-pv</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/metabase.db.mv.db</span></span><br><span class="line">          <span class="attr">subPath:</span> <span class="string">metabase.db.mv.db</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">metabase-pv</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/metabase.db.trace.db</span></span><br><span class="line">          <span class="attr">subPath:</span> <span class="string">metabase.db.trace.db</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">metabase-pv</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/metabase/plugins</span></span><br><span class="line">          <span class="attr">subPath:</span> <span class="string">plugins</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">metabase-pv</span></span><br><span class="line">          <span class="attr">persistentVolumeClaim:</span></span><br><span class="line">            <span class="attr">claimName:</span> <span class="string">metabase-pvc</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">metabase</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">metabase</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">3000</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">3000</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">metabase</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">metabase</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/ssl-redirect:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ingressClassName:</span> <span class="string">intranet</span></span><br><span class="line">  <span class="attr">tls:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">hosts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">metabase.i.com</span></span><br><span class="line">    <span class="attr">secretName:</span> <span class="string">i-com</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">metabase.i.com</span></span><br><span class="line">    <span class="attr">http:</span></span><br><span class="line">      <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/</span></span><br><span class="line">        <span class="attr">pathType:</span> <span class="string">ImplementationSpecific</span></span><br><span class="line">        <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">service:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">metabase</span></span><br><span class="line">            <span class="attr">port:</span></span><br><span class="line">              <span class="attr">number:</span> <span class="number">3000</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·å®Œç¾è§£å†³äº†é—®é¢˜, å¹¶ä¸”ä¸ä¼šå½±å“åˆ°ç›®å½•ä¸‹çš„å…¶ä»–æ–‡ä»¶.</p>]]></content>
      
      
      <categories>
          
          <category> å®¹å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
            <tag> æŒ‚è½½ </tag>
            
            <tag> Kubernetes </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨kubeadméƒ¨ç½²ä¸€å¥—é«˜å¯ç”¨k8s 1.29é›†ç¾¤ for AlmaLinux9(RHEL9)</title>
      <link href="/posts/lq0y87n5/"/>
      <url>/posts/lq0y87n5/</url>
      
        <content type="html"><![CDATA[<blockquote><p>åŸºäº AlmaLinux9 ä½¿ç”¨ kubeadm æ­å»ºé›†ç¾¤ï¼Œ <a href="/posts/526ffc9a/">ubuntuéƒ¨ç½²æ–‡æ¡£</a>, æœ‰ç–‘é—®çš„åœ°æ–¹å¯ä»¥çœ‹ <a href="https://kubernetes.io/zh/docs/setup/production-environment/tools/kubeadm/">å®˜æ–¹æ–‡æ¡£</a>, æœ¬æ•™ç¨‹éœ€è¦èƒ½è®¿é—® <strong>å›½é™…äº’è”ç½‘</strong> ã€‚ä¸èƒ½çš„è¯ï¼Œéœ€è¦è§£å†³é•œåƒæ‹‰å–é—®é¢˜ã€yum å®‰è£…ç»„ä»¶çš„é—®é¢˜ã€‚</p></blockquote><h2 id="å‡†å¤‡æœºå™¨"><a href="#å‡†å¤‡æœºå™¨" class="headerlink" title="å‡†å¤‡æœºå™¨"></a>å‡†å¤‡æœºå™¨</h2><blockquote><p>æˆ‘çš„æœºå™¨è¯¦æƒ…å¦‚ä¸‹, é…ç½®è‡³å°‘ä¸º 4C4G</p></blockquote><table><thead><tr><th>hostname</th><th>IP</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>master1</td><td>10.0.0.11</td><td>k8s master èŠ‚ç‚¹</td></tr><tr><td>master2</td><td>10.0.0.12</td><td>k8s master èŠ‚ç‚¹</td></tr><tr><td>master3</td><td>10.0.0.13</td><td>k8s master èŠ‚ç‚¹</td></tr><tr><td>worker1</td><td>10.0.0.21</td><td>k8s worker èŠ‚ç‚¹</td></tr><tr><td>worker2</td><td>10.0.0.22</td><td>k8s worker èŠ‚ç‚¹</td></tr></tbody></table><p>æ¯å°æœºå™¨éƒ½åšåŸŸåè§£æï¼Œæˆ–è€…ç»‘å®š hostsï¼ˆç›´æ¥ä½¿ç”¨ ip åœ°å€ä¼šæœ‰è­¦å‘Šï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/hosts</span><br><span class="line"></span><br><span class="line">10.0.0.10  public kube-apiserver</span><br><span class="line">10.0.0.11 master1</span><br><span class="line">10.0.0.12 master2</span><br><span class="line">10.0.0.13 master3</span><br></pre></td></tr></table></figure><p>æ¯å°æœºå™¨éƒ½å…³é—­é˜²ç«å¢™å’Œ SELinux</p><blockquote><p>è´Ÿè½½å‡è¡¡æœºå™¨å¿…é¡»è¦å…³é—­,å› ä¸º 6443 ä¸æ˜¯ nginx çš„æ ‡å‡†ç«¯å£,ä¼šè¢« selinux æ‹¦æˆª, é˜²ç«å¢™ä¹Ÿéœ€è¦æ”¾è¡Œ 6443 ç«¯å£, å¯ä»¥è€ƒè™‘ç›´æ¥å…³é—­é˜²ç«å¢™</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl <span class="built_in">disable</span> --now firewalld</span><br><span class="line">setenforce 0</span><br><span class="line">sed -i <span class="string">&quot;s/^SELINUX=.*/SELINUX=disabled/g&quot;</span> /etc/selinux/config</span><br><span class="line"></span><br><span class="line"><span class="comment"># RHEL9ç³»åˆ—å®Œå…¨å…³é—­selinuxéœ€è¦ä¿®æ”¹å†…æ ¸å¯åŠ¨å‚æ•°ï¼Œ/etc/selinux/config æ–‡ä»¶é‡Œé¢æœ‰è¯´æ˜</span></span><br></pre></td></tr></table></figure><h2 id="åŸºç¡€ç¯å¢ƒé…ç½®"><a href="#åŸºç¡€ç¯å¢ƒé…ç½®" class="headerlink" title="åŸºç¡€ç¯å¢ƒé…ç½®"></a>åŸºç¡€ç¯å¢ƒé…ç½®</h2><blockquote><p>åŸºç¡€ç¯å¢ƒæ˜¯ä¸ç®¡ master è¿˜æ˜¯ worker éƒ½éœ€è¦çš„ç¯å¢ƒ</p></blockquote><ol><li>ç¦ç”¨ swap</li><li>ç¡®ä¿æ¯ä¸ªèŠ‚ç‚¹ä¸Š MAC åœ°å€å’Œ product_uuid çš„å”¯ä¸€æ€§ <code>sudo cat /sys/class/dmi/id/product_uuid</code></li><li>ä¿®æ”¹ hostname</li></ol><h3 id="å®‰è£…-runtime"><a href="#å®‰è£…-runtime" class="headerlink" title="å®‰è£… runtime"></a>å®‰è£… runtime</h3><h4 id="è®¾ç½®å†…æ ¸å‚æ•°"><a href="#è®¾ç½®å†…æ ¸å‚æ•°" class="headerlink" title="è®¾ç½®å†…æ ¸å‚æ•°"></a>è®¾ç½®å†…æ ¸å‚æ•°</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®¾ç½®å¿…éœ€çš„ sysctl å‚æ•°ï¼Œè¿™äº›å‚æ•°åœ¨é‡æ–°å¯åŠ¨åä»ç„¶å­˜åœ¨ã€‚</span></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF | sudo tee /etc/sysctl.d/99-kubernetes-cri.conf</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-iptables  = 1</span></span><br><span class="line"><span class="string">net.ipv4.ip_forward                 = 1</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-ip6tables = 1</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åº”ç”¨ sysctl å‚æ•°è€Œæ— éœ€é‡æ–°å¯åŠ¨</span></span><br><span class="line">sudo sysctl --system</span><br></pre></td></tr></table></figure><h4 id="å¯ç”¨å†…æ ¸æ¨¡å—"><a href="#å¯ç”¨å†…æ ¸æ¨¡å—" class="headerlink" title="å¯ç”¨å†…æ ¸æ¨¡å—"></a>å¯ç”¨å†…æ ¸æ¨¡å—</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF | sudo tee /etc/modules-load.d/containerd.conf</span></span><br><span class="line"><span class="string">overlay</span></span><br><span class="line"><span class="string">br_netfilter</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">sudo modprobe overlay</span><br><span class="line">sudo modprobe br_netfilter</span><br></pre></td></tr></table></figure><h4 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¸è½½æ—§ç‰ˆæœ¬Docker</span></span><br><span class="line">sudo yum remove docker \</span><br><span class="line">              docker-client \</span><br><span class="line">              docker-client-latest \</span><br><span class="line">              docker-common \</span><br><span class="line">              docker-latest \</span><br><span class="line">              docker-latest-logrotate \</span><br><span class="line">              docker-logrotate \</span><br><span class="line">              docker-engine</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…dockerä»“åº“</span></span><br><span class="line">sudo yum install -y yum-utils</span><br><span class="line">sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…containerd</span></span><br><span class="line">sudo yum install containerd.io -y</span><br></pre></td></tr></table></figure><h4 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h4><p>ä» yum æºå®‰è£…çš„ containerd é»˜è®¤ç¦ç”¨äº† criï¼Œå¯ä»¥ä½¿ç”¨å‘½ä»¤é‡æ–°ç”Ÿæˆé»˜è®¤é…ç½®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è½¯ä»¶åŒ…ä¸­è‡ªå¸¦çš„é…ç½®æ–‡ä»¶ä¸å…¨ï¼Œä½¿ç”¨å‘½ä»¤ç”Ÿæˆã€‚</span></span><br><span class="line">containerd config default | sudo <span class="built_in">tee</span> /etc/containerd/config.toml</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»“åˆ runc ä½¿ç”¨ systemd cgroup é©±åŠ¨ï¼Œåœ¨ `/etc/containerd/config.toml` ä¸­è®¾ç½®</span></span><br><span class="line">sed -i <span class="string">&#x27;s#SystemdCgroup = .*#SystemdCgroup = true#g&#x27;</span> /etc/containerd/config.toml</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹ pauseå®¹å™¨ é•œåƒï¼Œä¸èƒ½æ‹‰å–å®˜æ–¹é•œåƒçš„å¯ä»¥ä½¿ç”¨é˜¿é‡Œäº‘é•œåƒæº</span></span><br><span class="line"><span class="comment"># sed -i &#x27;s#sandbox_image = .*#sandbox_image = &quot;registry.aliyuncs.com/google_containers/pause:3.9&quot;#g&#x27; /etc/containerd/config.toml</span></span><br><span class="line">sed -i <span class="string">&#x27;s#sandbox_image = .*#sandbox_image = &quot;registry.k8s.io/pause:3.9&quot;#g&#x27;</span> /etc/containerd/config.toml</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®å¼€æœºè‡ªå¯åŠ¨</span></span><br><span class="line">sudo systemctl <span class="built_in">enable</span> containerd</span><br><span class="line">sudo systemctl restart containerd</span><br></pre></td></tr></table></figure><h4 id="crictl-é…ç½®"><a href="#crictl-é…ç½®" class="headerlink" title="crictl é…ç½®"></a>crictl é…ç½®</h4><p>ä¹‹å‰ä½¿ç”¨ docker çš„æ—¶å€™ï¼Œdocker ç»™æˆ‘ä»¬åšäº†å¾ˆå¤šå¥½ç”¨çš„å·¥å…·ï¼Œç°åœ¨ç”¨äº† containerdï¼Œç®¡ç†å®¹å™¨æˆ‘ä»¬ç”¨ cri ç®¡ç†å·¥å…· crictlï¼Œåˆ›å»ºé…ç½®æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; /etc/crictl.yaml &lt;&lt;-<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">runtime-endpoint: unix:///run/containerd/containerd.sock</span><br><span class="line">debug: <span class="literal">false</span></span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…-kubeadmã€kubelet-å’Œ-kubectl"><a href="#å®‰è£…-kubeadmã€kubelet-å’Œ-kubectl" class="headerlink" title="å®‰è£… kubeadmã€kubelet å’Œ kubectl"></a>å®‰è£… kubeadmã€kubelet å’Œ kubectl</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF | sudo tee /etc/yum.repos.d/kubernetes.repo</span></span><br><span class="line"><span class="string">[kubernetes]</span></span><br><span class="line"><span class="string">name=Kubernetes</span></span><br><span class="line"><span class="string">baseurl=https://pkgs.k8s.io/core:/stable:/v1.29/rpm/</span></span><br><span class="line"><span class="string">enabled=1</span></span><br><span class="line"><span class="string">gpgcheck=1</span></span><br><span class="line"><span class="string">gpgkey=https://pkgs.k8s.io/core:/stable:/v1.29/rpm/repodata/repomd.xml.key</span></span><br><span class="line"><span class="string">exclude=kubelet kubeadm kubectl cri-tools kubernetes-cni</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å¯ç”¨çš„ç‰ˆæœ¬</span></span><br><span class="line">yum list kubelet kubeadm kubectl  --showduplicates --disableexcludes=kubernetes</span><br><span class="line"></span><br><span class="line">sudo yum install -y kubelet-1.29.5 kubeadm-1.29.5 kubectl-1.29.5 --disableexcludes=kubernetes</span><br><span class="line">sudo systemctl <span class="built_in">enable</span> --now kubelet</span><br></pre></td></tr></table></figure><h2 id="kube-apiserver-é«˜å¯ç”¨æ–¹æ¡ˆ"><a href="#kube-apiserver-é«˜å¯ç”¨æ–¹æ¡ˆ" class="headerlink" title="kube-apiserver é«˜å¯ç”¨æ–¹æ¡ˆ"></a>kube-apiserver é«˜å¯ç”¨æ–¹æ¡ˆ</h2><p>é«˜å¯ç”¨æ–¹æ¡ˆæœ‰å¾ˆå¤šç§ï¼Œå…¶ä»–æ–¹æ¡ˆè¯·å‚è€ƒ <a href="/posts/10cef768/">Kubernetesä¹‹masteré«˜å¯ç”¨æ–¹æ¡ˆ</a></p><p>è¿™é‡Œä½¿ç”¨<strong>æ¯å°</strong>èŠ‚ç‚¹éƒ¨ç½² nginx åä»£æ¥å®ç°é«˜å¯ç”¨ï¼Œè¿™ç§æ–¹å¼éœ€è¦<strong>æ‰€æœ‰</strong>èŠ‚ç‚¹éƒ½å®‰è£…è´Ÿè½½å‡è¡¡ (åŒ…æ‹¬ master å’Œ worker )</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /etc/kube-lb/&#123;conf,logs,sbin&#125;</span><br><span class="line"></span><br><span class="line">curl -L -C - https://file.babudiu.com/f/qjhX/kube-lb -o /etc/kube-lb/sbin/kube-lb</span><br><span class="line"><span class="built_in">chmod</span> +x /etc/kube-lb/sbin/kube-lb</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/kube-lb/conf/kube-lb.conf &lt;&lt;<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">user root;</span><br><span class="line">worker_processes 1;</span><br><span class="line"></span><br><span class="line">error_log  /etc/kube-lb/logs/error.log warn;</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  3000;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">stream &#123;</span><br><span class="line">    upstream backend &#123;</span><br><span class="line">        server 10.0.0.11:6443    max_fails=2 fail_timeout=3s;</span><br><span class="line">        server 10.0.0.12:6443    max_fails=2 fail_timeout=3s;</span><br><span class="line">        server 10.0.0.13:6443    max_fails=2 fail_timeout=3s;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen 127.0.0.1:8443;</span><br><span class="line">        proxy_connect_timeout 1s;</span><br><span class="line">        proxy_pass backend;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/systemd/system/kube-lb.service &lt;&lt;<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">[Unit]</span><br><span class="line">Description=l4 nginx proxy <span class="keyword">for</span> kube-apiservers</span><br><span class="line">After=network.target</span><br><span class="line">After=network-online.target</span><br><span class="line">Wants=network-online.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">ExecStartPre=/etc/kube-lb/sbin/kube-lb -c /etc/kube-lb/conf/kube-lb.conf -p /etc/kube-lb -t</span><br><span class="line">ExecStart=/etc/kube-lb/sbin/kube-lb -c /etc/kube-lb/conf/kube-lb.conf -p /etc/kube-lb</span><br><span class="line">ExecReload=/etc/kube-lb/sbin/kube-lb -c /etc/kube-lb/conf/kube-lb.conf -p /etc/kube-lb -s reload</span><br><span class="line">PrivateTmp=<span class="literal">true</span></span><br><span class="line">Restart=always</span><br><span class="line">RestartSec=15</span><br><span class="line">StartLimitInterval=0</span><br><span class="line">LimitNOFILE=65536</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨æœåŠ¡</span></span><br><span class="line">systemctl <span class="built_in">enable</span> --now kube-lb</span><br></pre></td></tr></table></figure><div class="note default flat"><p>kube-lb å…¶å®å°±æ˜¯è‡ªå·±ç¼–è¯‘çš„ Nginxï¼Œç²¾ç®€äº† http æ¨¡å—ï¼Œåªå¼€å¯äº† stream æ¨¡å—ç”¨ä½œ 4 å±‚è½¬å‘ï¼Œè¯¦ç»†å‚æ•°å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nginx version: nginx/1.24.0</span><br><span class="line">built by gcc 4.8.5 20150623 (Red Hat 4.8.5-44) (GCC)</span><br><span class="line">configure arguments: --with-stream --without-http --without-http_uwsgi_module --without-http_scgi_module --without-http_fastcgi_module</span><br></pre></td></tr></table></figure></div><h2 id="åˆ›å»ºé›†ç¾¤"><a href="#åˆ›å»ºé›†ç¾¤" class="headerlink" title="åˆ›å»ºé›†ç¾¤"></a>åˆ›å»ºé›†ç¾¤</h2><h3 id="æå‰æ‹‰é•œåƒï¼ˆå¯é€‰ï¼‰"><a href="#æå‰æ‹‰é•œåƒï¼ˆå¯é€‰ï¼‰" class="headerlink" title="æå‰æ‹‰é•œåƒï¼ˆå¯é€‰ï¼‰"></a>æå‰æ‹‰é•œåƒï¼ˆå¯é€‰ï¼‰</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubeadm config images pull \</span><br><span class="line">--kubernetes-version 1.29.5 \</span><br><span class="line">--image-repository registry.aliyuncs.com/google_containers</span><br></pre></td></tr></table></figure><h3 id="kubeadm-init"><a href="#kubeadm-init" class="headerlink" title="kubeadm init"></a>kubeadm init</h3><p>åœ¨ master1 ä¸Šæ‰§è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo kubeadm init \</span><br><span class="line">--control-plane-endpoint <span class="string">&quot;127.0.0.1:8443&quot;</span> \</span><br><span class="line">--kubernetes-version 1.29.5 \</span><br><span class="line">--upload-certs \</span><br><span class="line">--service-cidr=10.96.0.0/12 \</span><br><span class="line">--pod-network-cidr=10.244.0.0/16</span><br></pre></td></tr></table></figure><ul><li>ä¹Ÿå¯ä»¥ç”¨ <code>kubeadm config print init-defaults &gt; init.yaml</code> ç”Ÿæˆ kubeadm çš„é…ç½®ï¼Œå¹¶ç”¨ <code>kubeadm init --config=init.yaml</code> æ¥åˆ›å»ºé›†ç¾¤ã€‚</li><li>å¦‚æœè´Ÿè½½å‡è¡¡æ²¡æœ‰å‡†å¤‡å¥½ï¼Œä¹Ÿå¯ä»¥ä¸´æ—¶æ·»åŠ  VIP <code>ip addr add 10.0.0.10 dev eth0</code></li><li>å¦‚æœä¸èƒ½æ‹‰å®˜æ–¹é•œåƒï¼Œå¢åŠ å‚æ•°ä½¿ç”¨é˜¿é‡Œäº‘é•œåƒæº <code>--image-repository registry.aliyuncs.com/google_containers</code></li></ul><h3 id="å®‰è£…ç½‘ç»œæ’ä»¶"><a href="#å®‰è£…ç½‘ç»œæ’ä»¶" class="headerlink" title="å®‰è£…ç½‘ç»œæ’ä»¶"></a>å®‰è£…ç½‘ç»œæ’ä»¶</h3><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">å®‰è£…flannelæ’ä»¶</button><button type="button" class="tab">å®‰è£…calicoæ’ä»¶</button></div><div class="tab-contents"><div class="tab-item-content active"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¦‚æœä¿®æ”¹äº† pod-network-cidr è¿™ä¸ªymlæ–‡ä»¶ä¹Ÿéœ€è¦ä¿®æ”¹</span></span><br><span class="line">kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å¾…è¡¥å……</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div><h2 id="å¸¸è§é—®é¢˜"><a href="#å¸¸è§é—®é¢˜" class="headerlink" title="å¸¸è§é—®é¢˜"></a>å¸¸è§é—®é¢˜</h2><p><a href="/posts/sepu3k/">kubeadm éƒ¨ç½²çš„é›†ç¾¤ å¸¸è§é—®é¢˜æ±‡æ€»</a></p>]]></content>
      
      
      <categories>
          
          <category> å®¹å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
            <tag> Linux </tag>
            
            <tag> Container </tag>
            
            <tag> Kubernetes </tag>
            
            <tag> kubeadm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å‰åç«¯è·¨åŸŸé—®é¢˜</title>
      <link href="/posts/lpuzlvhd/"/>
      <url>/posts/lpuzlvhd/</url>
      
        <content type="html"><![CDATA[<h2 id="å•¥æ˜¯è·¨åŸŸ"><a href="#å•¥æ˜¯è·¨åŸŸ" class="headerlink" title="å•¥æ˜¯è·¨åŸŸ"></a>å•¥æ˜¯è·¨åŸŸ</h2><p>è·¨æºèµ„æºå…±äº«ï¼ˆCORSï¼Œæˆ–é€šä¿—åœ°è¯‘ä¸ºè·¨åŸŸèµ„æºå…±äº«ï¼‰æ˜¯ä¸€ç§åŸºäº HTTP å¤´çš„æœºåˆ¶ï¼Œè¯¥æœºåˆ¶é€šè¿‡å…è®¸æœåŠ¡å™¨æ ‡ç¤ºé™¤äº†å®ƒè‡ªå·±ä»¥å¤–çš„å…¶ä»–æºï¼ˆåŸŸã€åè®®æˆ–ç«¯å£ï¼‰ï¼Œä½¿å¾—æµè§ˆå™¨å…è®¸è¿™äº›æºè®¿é—®åŠ è½½è‡ªå·±çš„èµ„æºã€‚è·¨æºèµ„æºå…±äº«è¿˜é€šè¿‡ä¸€ç§æœºåˆ¶æ¥æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦ä¼šå…è®¸è¦å‘é€çš„çœŸå®è¯·æ±‚ï¼Œè¯¥æœºåˆ¶é€šè¿‡æµè§ˆå™¨å‘èµ·ä¸€ä¸ªåˆ°æœåŠ¡å™¨æ‰˜ç®¡çš„è·¨æºèµ„æºçš„â€œé¢„æ£€â€è¯·æ±‚ã€‚åœ¨é¢„æ£€ä¸­ï¼Œæµè§ˆå™¨å‘é€çš„å¤´ä¸­æ ‡ç¤ºæœ‰ HTTP æ–¹æ³•å’ŒçœŸå®è¯·æ±‚ä¸­ä¼šç”¨åˆ°çš„å¤´ã€‚</p><p>è·¨æº HTTP è¯·æ±‚çš„ä¸€ä¸ªä¾‹å­ï¼šè¿è¡Œåœ¨ <a href="https://domain-a.com/">https://domain-a.com</a> çš„ JavaScript ä»£ç ä½¿ç”¨ XMLHttpRequest æ¥å‘èµ·ä¸€ä¸ªåˆ° <a href="https://domain-b.com/data.json">https://domain-b.com/data.json</a> çš„è¯·æ±‚ã€‚</p><p>å‡ºäºå®‰å…¨æ€§ï¼Œæµè§ˆå™¨é™åˆ¶è„šæœ¬å†…å‘èµ·çš„è·¨æº HTTP è¯·æ±‚ã€‚ä¾‹å¦‚ï¼ŒXMLHttpRequest å’Œ Fetch API éµå¾ªåŒæºç­–ç•¥ã€‚è¿™æ„å‘³ç€ä½¿ç”¨è¿™äº› API çš„ Web åº”ç”¨ç¨‹åºåªèƒ½ä»åŠ è½½åº”ç”¨ç¨‹åºçš„åŒä¸€ä¸ªåŸŸè¯·æ±‚ HTTP èµ„æºï¼Œé™¤éå“åº”æŠ¥æ–‡åŒ…å«äº†æ­£ç¡® CORS å“åº”å¤´ã€‚<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202312061646763.png" alt="image.png"></p><h2 id="ä¸ºä»€ä¹ˆä¼šè·¨åŸŸ"><a href="#ä¸ºä»€ä¹ˆä¼šè·¨åŸŸ" class="headerlink" title="ä¸ºä»€ä¹ˆä¼šè·¨åŸŸ"></a>ä¸ºä»€ä¹ˆä¼šè·¨åŸŸ</h2><p>è¯´åˆ°è·¨åŸŸä¸å¾—ä¸è°ˆçš„å°±æ˜¯æµè§ˆå™¨çš„åŒæºç­–ç•¥ï¼Œè·¨åŸŸä¹Ÿæ˜¯å› ä¸ºæµè§ˆå™¨è¿™ä¸ªæœºåˆ¶å¼•èµ·çš„ï¼Œè¿™ä¸ªæœºåˆ¶çš„å­˜åœ¨è¿˜æ˜¯åœ¨äºå®‰å…¨ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯æº"><a href="#ä»€ä¹ˆæ˜¯æº" class="headerlink" title="ä»€ä¹ˆæ˜¯æº"></a>ä»€ä¹ˆæ˜¯æº</h3><p>Web å†…å®¹çš„æºç”±ç”¨äºè®¿é—®å®ƒçš„ URL çš„æ–¹æ¡ˆ (åè®®)ï¼Œä¸»æœº (åŸŸå) å’Œç«¯å£å®šä¹‰ã€‚åªæœ‰å½“æ–¹æ¡ˆï¼Œä¸»æœºå’Œç«¯å£éƒ½åŒ¹é…æ—¶ï¼Œä¸¤ä¸ªå¯¹è±¡å…·æœ‰ç›¸åŒçš„èµ·æºã€‚</p><p>åŒæºä¸åŒæºä¸€å¥è¯å°±å¯ä»¥åˆ¤æ–­ï¼šå°±æ˜¯ url ä¸­ scheme host port éƒ½ç›¸åŒå³ä¸ºåŒæºã€‚</p><h3 id="URL-ç»“æ„"><a href="#URL-ç»“æ„" class="headerlink" title="URL ç»“æ„"></a>URL ç»“æ„</h3><p>URL ä»£è¡¨ç€æ˜¯ç»Ÿä¸€èµ„æºå®šä½ç¬¦ï¼ˆUniform Resource Locatorï¼‰ã€‚URL æ— éå°±æ˜¯ä¸€ä¸ªç»™å®šçš„ç‹¬ç‰¹èµ„æºåœ¨ Web ä¸Šçš„åœ°å€ã€‚</p><p>URL æœ‰å¦‚ä¸‹ç»“æ„ç»„æˆï¼š</p><p>Scheme æˆ–è€… Protocol, å¸¸è§çš„å°±æ˜¯ http æˆ–è€… https<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202312061647029.png" alt="image.png"><br>Domain Name ä¹Ÿå«åš host åŸŸå<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202312061648575.png" alt="image.png"></p><p>port ç«¯å£å·<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202312061648625.png" alt="image.png"></p><p> Parameters å‚æ•°<br> <img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202312061648585.png" alt="image.png"></p><p> Anchor é”šç‚¹ï¼Œä¸€èˆ¬ç”¨äºå®šä½ä½ç½®<br> <img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202312061648639.png" alt="image.png"></p><h3 id="åŒæºä¸åŒæºä¸¾ä¾‹"><a href="#åŒæºä¸åŒæºä¸¾ä¾‹" class="headerlink" title="åŒæºä¸åŒæºä¸¾ä¾‹"></a>åŒæºä¸åŒæºä¸¾ä¾‹</h3><p><em>å°±æ˜¯ url ä¸­ scheme host port éƒ½ç›¸åŒå³ä¸ºåŒæºã€‚</em> ä¸‹é¢æ˜¯å‡ ä¸ªä¸åŒæºçš„ä¾‹å­, å¦‚æœè®¿é—®å°±ä¼šäº§ç”Ÿè·¨åŸŸé—®é¢˜.</p><table><thead><tr><th>å‰ç«¯åŸŸå</th><th>åç«¯åŸŸå</th><th>åŸå› </th></tr></thead><tbody><tr><td><a href="https://example.com/">https://example.com/</a></td><td><a href="http://example.com/api">http://example.com/api</a></td><td>åè®®ä¸ä¸€æ ·</td></tr><tr><td><a href="http://example.com/">http://example.com</a></td><td><a href="http://api.example.com/">http://api.example.com</a></td><td>host ä¸ä¸€æ ·</td></tr><tr><td><a href="http://example.com/">http://example.com</a></td><td><a href="http://example.com:8080/">http://example.com:8080</a></td><td>ç«¯å£ä¸ä¸€æ ·</td></tr></tbody></table><h2 id="è·¨åŸŸé—®é¢˜çš„ç—‡çŠ¶"><a href="#è·¨åŸŸé—®é¢˜çš„ç—‡çŠ¶" class="headerlink" title="è·¨åŸŸé—®é¢˜çš„ç—‡çŠ¶"></a>è·¨åŸŸé—®é¢˜çš„ç—‡çŠ¶</h2><h3 id="æœ‰è·¨åŸŸé—®é¢˜"><a href="#æœ‰è·¨åŸŸé—®é¢˜" class="headerlink" title="æœ‰è·¨åŸŸé—®é¢˜"></a>æœ‰è·¨åŸŸé—®é¢˜</h3><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202312061635874.png" alt="image.png"></p><h3 id="æ­£å¸¸æƒ…å†µ"><a href="#æ­£å¸¸æƒ…å†µ" class="headerlink" title="æ­£å¸¸æƒ…å†µ"></a>æ­£å¸¸æƒ…å†µ</h3><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202312061643686.png" alt="image.png"></p><h2 id="åç«¯è§£å†³æ–¹æ¡ˆ"><a href="#åç«¯è§£å†³æ–¹æ¡ˆ" class="headerlink" title="åç«¯è§£å†³æ–¹æ¡ˆ"></a>åç«¯è§£å†³æ–¹æ¡ˆ</h2><p>ä¸‰ã€åç«¯è§£å†³æ–¹æ¡ˆ<br>åç«¯æ¡†æ¶ä¹Ÿå¾ˆå¤šï¼Œå®ç°åŸç†å·®ä¸å¤šï¼Œéƒ½æ˜¯ä¿®æ”¹ä¸‹ç›¸åº”å¤´ã€‚ä»¥å¸¸ç”¨çš„ Java SpringCloud å’Œ nodejs koa æ¡†æ¶ä¸ºä¾‹ã€‚</p><p>Http åè®® CORS å¤´<br>è·¨åŸŸå…¶å®ä¹Ÿæ˜¯ http å±‚é¢ä¸Šå¯ä»¥è§£å†³çš„é—®é¢˜ï¼Œåç«¯è§£å†³ä¹Ÿæ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œä¹Ÿæ˜¯é¡¹ç›®å¸¸è§çš„è§£å†³æ‰‹æ³•ã€‚</p><p>CORS ï¼ˆCross-Origin Resource Sharingï¼Œè·¨åŸŸèµ„æºå…±äº«ï¼‰æ˜¯ä¸€ä¸ªç³»ç»Ÿï¼Œå®ƒç”±ä¸€ç³»åˆ—ä¼ è¾“çš„ HTTP å¤´ç»„æˆï¼Œè¿™äº› HTTP å¤´å†³å®šæµè§ˆå™¨æ˜¯å¦é˜»æ­¢å‰ç«¯ JavaScript ä»£ç è·å–è·¨åŸŸè¯·æ±‚çš„å“åº”ã€‚</p><p>åŒæºå®‰å…¨ç­–ç•¥ é»˜è®¤é˜»æ­¢â€œè·¨åŸŸâ€è·å–èµ„æºã€‚ä½†æ˜¯ CORS ç»™äº† web æœåŠ¡å™¨è¿™æ ·çš„æƒé™ï¼Œå³æœåŠ¡å™¨å¯ä»¥é€‰æ‹©ï¼Œå…è®¸è·¨åŸŸè¯·æ±‚è®¿é—®åˆ°å®ƒä»¬çš„èµ„æºã€‚å…¶å®å°±æ˜¯ä¸€äº› Header å¤´:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Access-Control-Allow-Origin  æŒ‡ç¤ºè¯·æ±‚çš„èµ„æºèƒ½å…±äº«ç»™å“ªäº›åŸŸã€‚</span><br><span class="line">Access-Control-Allow-Credentials   æŒ‡ç¤ºå½“è¯·æ±‚çš„å‡­è¯æ ‡è®°ä¸º <span class="literal">true</span> æ—¶ï¼Œæ˜¯å¦å“åº”è¯¥è¯·æ±‚ã€‚</span><br><span class="line">Access-Control-Allow-Headers   ç”¨åœ¨å¯¹é¢„è¯·æ±‚çš„å“åº”ä¸­ï¼ŒæŒ‡ç¤ºå®é™…çš„è¯·æ±‚ä¸­å¯ä»¥ä½¿ç”¨å“ªäº› HTTP å¤´ã€‚</span><br><span class="line">Access-Control-Allow-Methods  æŒ‡å®šå¯¹é¢„è¯·æ±‚çš„å“åº”ä¸­ï¼Œå“ªäº› HTTP æ–¹æ³•å…è®¸è®¿é—®è¯·æ±‚çš„èµ„æºã€‚</span><br><span class="line">Access-Control-Expose-Headers  æŒ‡ç¤ºå“ªäº› HTTP å¤´çš„åç§°èƒ½åœ¨å“åº”ä¸­åˆ—å‡ºã€‚</span><br><span class="line">Access-Control-Max-Age  æŒ‡ç¤ºé¢„è¯·æ±‚çš„ç»“æœèƒ½è¢«ç¼“å­˜å¤šä¹…ã€‚</span><br><span class="line">Access-Control-Request-Headers   ç”¨äºå‘èµ·ä¸€ä¸ªé¢„è¯·æ±‚ï¼Œå‘ŠçŸ¥æœåŠ¡å™¨æ­£å¼è¯·æ±‚ä¼šä½¿ç”¨é‚£äº› HTTP å¤´ã€‚</span><br><span class="line">Access-Control-Request-Method   ç”¨äºå‘èµ·ä¸€ä¸ªé¢„è¯·æ±‚ï¼Œå‘ŠçŸ¥æœåŠ¡å™¨æ­£å¼è¯·æ±‚ä¼šä½¿ç”¨å“ªä¸€ç§ HTTP è¯·æ±‚æ–¹æ³•ã€‚</span><br><span class="line">Origin    æŒ‡ç¤ºè·å–èµ„æºçš„è¯·æ±‚æ˜¯ä»ä»€ä¹ˆåŸŸå‘èµ·çš„ã€‚</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GatewayCorsConfiguation</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> CorsFilter <span class="title function_">corsFilter</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–corsé…ç½®å¯¹è±¡</span></span><br><span class="line">        <span class="type">CorsConfiguration</span> <span class="variable">configuration</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CorsConfiguration</span>();</span><br><span class="line">        configuration.setAllowCredentials(<span class="literal">true</span>); <span class="comment">// å…è®¸ä½¿ç”¨cookieï¼Œä½†æ˜¯ä½¿ç”¨cookieæ˜¯addAllowedOriginå¿…é¡»æ˜¯å…·ä½“çš„åœ°å€ï¼Œä¸èƒ½æ˜¯*</span></span><br><span class="line"><span class="comment">//        configuration.addAllowedOrigin(&quot;*&quot;);</span></span><br><span class="line">        configuration.addAllowedOrigin(<span class="string">&quot;http://manage.leyou.com&quot;</span>);</span><br><span class="line">        configuration.addAllowedMethod(<span class="string">&quot;*&quot;</span>);  <span class="comment">//å…è®¸çš„è¯·æ±‚æ–¹å¼,get,put,post,delete</span></span><br><span class="line">        configuration.addAllowedHeader(<span class="string">&quot;*&quot;</span>);<span class="comment">//å…è®¸çš„å¤´ä¿¡æ¯</span></span><br><span class="line"> </span><br><span class="line">        <span class="comment">//åˆå§‹åŒ–corsçš„æºå¯¹è±¡é…ç½®</span></span><br><span class="line">        <span class="type">UrlBasedCorsConfigurationSource</span> <span class="variable">corsConfigurationSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UrlBasedCorsConfigurationSource</span>();</span><br><span class="line">        corsConfigurationSource.registerCorsConfiguration(<span class="string">&quot;/**&quot;</span>,configuration);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//3.è¿”å›æ–°çš„CorsFilter.</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CorsFilter</span>(corsConfigurationSource);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è¿ç»´è§£å†³æ–¹æ¡ˆ"><a href="#è¿ç»´è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è¿ç»´è§£å†³æ–¹æ¡ˆ"></a>è¿ç»´è§£å†³æ–¹æ¡ˆ</h2><h3 id="Nginx-ingress-é…ç½®"><a href="#Nginx-ingress-é…ç½®" class="headerlink" title="Nginx ingress é…ç½®"></a>Nginx ingress é…ç½®</h3><p>å¢åŠ æ³¨è§£</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">nginx.ingress.kubernetes.io/cors-allow-credentials: <span class="string">&#x27;true&#x27;</span></span><br><span class="line">nginx.ingress.kubernetes.io/cors-allow-headers: &gt;-</span><br><span class="line">  DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization</span><br><span class="line">nginx.ingress.kubernetes.io/cors-allow-methods: <span class="string">&#x27;PUT, GET, POST, OPTIONS&#x27;</span></span><br><span class="line">nginx.ingress.kubernetes.io/cors-allow-origin: <span class="string">&#x27;*&#x27;</span></span><br><span class="line">nginx.ingress.kubernetes.io/enable-cors: <span class="string">&#x27;true&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="Nginx-é…ç½®"><a href="#Nginx-é…ç½®" class="headerlink" title="Nginx é…ç½®"></a>Nginx é…ç½®</h3><h4 id="ä½¿ç”¨-proxy-pass-è½¬å‘"><a href="#ä½¿ç”¨-proxy-pass-è½¬å‘" class="headerlink" title="ä½¿ç”¨ proxy_pass è½¬å‘"></a>ä½¿ç”¨ proxy_pass è½¬å‘</h4><p>æ­¤æ–¹æ³•æ˜¯å°†åç«¯åœ°å€åä»£åˆ°å‰ç«¯çš„ä¸€ä¸ª location, è¿™æ ·å°±æ˜¯åŒæºäº†.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location /api &#123;</span><br><span class="line">   proxy_pass https://b.test.com; # è®¾ç½®ä»£ç†æœåŠ¡å™¨çš„åè®®å’Œåœ°å€</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ä½¿ç”¨-Nginx-å¢åŠ -Header"><a href="#ä½¿ç”¨-Nginx-å¢åŠ -Header" class="headerlink" title="ä½¿ç”¨ Nginx å¢åŠ  Header"></a>ä½¿ç”¨ Nginx å¢åŠ  Header</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen       80;</span><br><span class="line">    server_name  www.example.com;</span><br><span class="line">    root         /usr/share/nginx/html;</span><br><span class="line">    </span><br><span class="line">    location / &#123;</span><br><span class="line">    </span><br><span class="line">        proxy_pass http://localhost:8188/;</span><br><span class="line">        # è®¾ç½®æ˜¯å¦å…è®¸ cookie ä¼ è¾“</span><br><span class="line">        add_header Access-Control-Allow-Credentials true;</span><br><span class="line">        # å…è®¸è¯·æ±‚åœ°å€è·¨åŸŸ * åšä¸ºé€šé…ç¬¦</span><br><span class="line">        add_header Access-Control-Allow-Origin * always;</span><br><span class="line">        # å…è®¸è·¨åŸŸçš„è¯·æ±‚æ–¹æ³•</span><br><span class="line">        add_header Access-Control-Allow-Methods &#x27;GET, POST, PUT, DELETE, OPTIONS&#x27;;</span><br><span class="line">        add_header Access-Control-Allow-Headers &#x27;DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization&#x27;;</span><br><span class="line"></span><br><span class="line">        if ($request_method = &#x27;OPTIONS&#x27;) &#123;</span><br><span class="line">            return 204;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="å¸¸è§é—®é¢˜"><a href="#å¸¸è§é—®é¢˜" class="headerlink" title="å¸¸è§é—®é¢˜"></a>å¸¸è§é—®é¢˜</h2><h3 id="åç«¯æœåŠ¡å’Œ-Nginx-åŒæ—¶å¤„ç†äº†è·¨åŸŸ"><a href="#åç«¯æœåŠ¡å’Œ-Nginx-åŒæ—¶å¤„ç†äº†è·¨åŸŸ" class="headerlink" title="åç«¯æœåŠ¡å’Œ Nginx åŒæ—¶å¤„ç†äº†è·¨åŸŸ"></a>åç«¯æœåŠ¡å’Œ Nginx åŒæ—¶å¤„ç†äº†è·¨åŸŸ</h3><p>è·¨åŸŸé—®é¢˜åç«¯å’Œ Nginx ä¸è¦åŒæ—¶å¤„ç†, ä¸ç„¶ä¼šæŠ¥é”™:<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202312071706036.png" alt="image.png"><br>è¿™ä¸ªæ—¶å€™åˆ é™¤ Nginx ä¸Šçš„ Access-Control-Allow-Origin é…ç½®å³å¯, å»ºè®®åç«¯å’Œ Nginx ä¸è¦åŒæ—¶é…ç½®è·¨åŸŸ.</p><h3 id="Header-ä¸åœ¨å…è®¸çš„åˆ—è¡¨ä¸­"><a href="#Header-ä¸åœ¨å…è®¸çš„åˆ—è¡¨ä¸­" class="headerlink" title="Header ä¸åœ¨å…è®¸çš„åˆ—è¡¨ä¸­"></a>Header ä¸åœ¨å…è®¸çš„åˆ—è¡¨ä¸­</h3><p>å‡ºç°è·¨åŸŸé—®é¢˜çš„æ—¶å€™, å¯ä»¥åœ¨æµè§ˆå™¨çš„æ§åˆ¶å°çœ‹åˆ°è¯¦æƒ…, æ¯”å¦‚ä¸‹å›¾æç¤º <code>x-xxx-client-version</code> è¿™ä¸ª header ä¸åœ¨ <code>Access-Control-Allow-Headers</code> ä¸­, é‚£ä½ å†æ‰‹åŠ¨åŠ ä¸€ä¸‹å°±è¡Œäº†.<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202312061638756.png" alt="image.png"></p>]]></content>
      
      
      <categories>
          
          <category> å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æµè§ˆå™¨ </tag>
            
            <tag> Nginx </tag>
            
            <tag> åå‘ä»£ç† </tag>
            
            <tag> ç¼–ç  </tag>
            
            <tag> ingress </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Windowsä¸­çš„ç¬¦å·è¿æ¥</title>
      <link href="/posts/so24vr/"/>
      <url>/posts/so24vr/</url>
      
        <content type="html"><![CDATA[<h2 id="mklink-å‘½ä»¤"><a href="#mklink-å‘½ä»¤" class="headerlink" title="mklink å‘½ä»¤"></a>mklink å‘½ä»¤</h2><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mklink /D åŸå§‹æ–‡ä»¶/ç›®å½•  é“¾æ¥æ–‡ä»¶</span><br><span class="line">/D      åˆ›å»ºç›®å½•ç¬¦å·é“¾æ¥ã€‚é»˜è®¤ä¸ºæ–‡ä»¶ç¬¦å·é“¾æ¥ã€‚</span><br><span class="line">/H      åˆ›å»ºç¡¬é“¾æ¥è€Œéç¬¦å·é“¾æ¥ã€‚</span><br><span class="line">/J      åˆ›å»ºç›®å½•è”æ¥ã€‚</span><br></pre></td></tr></table></figure><table><thead><tr><th>ç‰¹æ€§</th><th><code>/H</code>ï¼ˆç¡¬é“¾æ¥ï¼‰</th><th><code>/D</code>ï¼ˆç¬¦å·é“¾æ¥ï¼‰</th><th><code>/J</code>ï¼ˆç›®å½•é“¾æ¥ï¼‰</th></tr></thead><tbody><tr><td><strong>æ”¯æŒç›®æ ‡ç±»å‹</strong></td><td>ä»…æ–‡ä»¶</td><td>æ–‡ä»¶æˆ–ç›®å½•</td><td>ä»…ç›®å½•</td></tr><tr><td><strong>è·¨åˆ†åŒºæ”¯æŒ</strong></td><td>å¦</td><td>æ˜¯</td><td>å¦</td></tr><tr><td><strong>ç½‘ç»œè·¯å¾„æ”¯æŒ</strong></td><td>å¦</td><td>æ˜¯</td><td>å¦</td></tr><tr><td><strong>ä¸ç›®æ ‡çš„å…³ç³»</strong></td><td>å…±äº«åŒä¸€æ•°æ®ï¼Œåˆ é™¤é“¾æ¥ä¸å½±å“æ–‡ä»¶</td><td>ç›®æ ‡è¢«åˆ é™¤ï¼Œé“¾æ¥æ— æ•ˆ</td><td>ç›®æ ‡è¢«åˆ é™¤ï¼Œé“¾æ¥æ— æ•ˆ</td></tr><tr><td><strong>ç”Ÿæ•ˆèŒƒå›´</strong></td><td>æ–‡ä»¶ç³»ç»Ÿ</td><td>æ–‡ä»¶ç³»ç»Ÿ</td><td>æ–‡ä»¶ç³»ç»Ÿ</td></tr><tr><td><strong>åˆ›å»ºæ‰€éœ€æƒé™</strong></td><td>æ— </td><td>éœ€è¦ç®¡ç†å‘˜æƒé™</td><td>æ— </td></tr><tr><td><strong>æ€§èƒ½å½±å“</strong></td><td>æœ€ä½</td><td>è¾ƒä½ï¼ˆéœ€è¦é¢å¤–è§£æç¬¦å·é“¾æ¥ï¼‰</td><td>è¾ƒä½</td></tr></tbody></table><h2 id="PowerShell-ä¸­çš„-New-Item"><a href="#PowerShell-ä¸­çš„-New-Item" class="headerlink" title="PowerShell ä¸­çš„ New-Item"></a>PowerShell ä¸­çš„ New-Item</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¬¦å·é“¾æ¥</span></span><br><span class="line"><span class="built_in">New-Item</span> <span class="literal">-ItemType</span> SymbolicLink <span class="literal">-Path</span> C:\Users\iuxt\SynologyDrive <span class="literal">-Target</span> D:\SynologyDrive\</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç›®å½•è¿æ¥</span></span><br><span class="line"><span class="built_in">New-Item</span> <span class="literal">-ItemType</span> Junction</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¡¬é“¾æ¥</span></span><br><span class="line"><span class="built_in">New-Item</span> <span class="literal">-ItemType</span> HardLink</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>å°†ovaæˆ–qcow2å¯¼å…¥åˆ°PVEè™šæ‹Ÿæœº</title>
      <link href="/posts/lphwqhtr/"/>
      <url>/posts/lphwqhtr/</url>
      
        <content type="html"><![CDATA[<p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202312011531317.png" alt="Proxmox_logo_standard_hex_2000px-768x116.png"></p><p>æ¯”å¦‚æˆ‘ä»¬ä» VMware Workstation å¯¼å‡ºçš„è™šæ‹Ÿæœºé•œåƒ (ova æˆ–è€… ovf), å¦‚æœæˆ‘æƒ³è¦å¯¼å…¥åˆ° proxmox ä¸­, proxmox é»˜è®¤æ˜¯ä¸æ”¯æŒå¯¼å…¥ OVA è™šæ‹Ÿæœºçš„, å¯ä»¥é€šè¿‡è½¬æ¢è™šæ‹Ÿæœºè™šæ‹Ÿç£ç›˜çš„æ–¹æ³•å°†è™šæ‹Ÿç£ç›˜é™„åŠ åˆ°ç°æœ‰çš„ pve è™šæ‹Ÿæœºä¸­.</p><h2 id="æå–-vmdk-è™šæ‹Ÿç£ç›˜æ–‡ä»¶"><a href="#æå–-vmdk-è™šæ‹Ÿç£ç›˜æ–‡ä»¶" class="headerlink" title="æå– vmdk è™šæ‹Ÿç£ç›˜æ–‡ä»¶"></a>æå– vmdk è™šæ‹Ÿç£ç›˜æ–‡ä»¶</h2><p>è¿™ä¸€æ­¥å¦‚æœæ˜¯ ova, åˆ™éœ€è¦ç”¨è§£å‹ç¼©è½¯ä»¶è§£å‹ä¸€ä¸‹, å¦‚æœæ˜¯ ovf, ç›´æ¥å°±èƒ½çœ‹åˆ° vmdk æ–‡ä»¶</p><h2 id="è½¬æ¢è™šæ‹Ÿç£ç›˜æ–‡ä»¶"><a href="#è½¬æ¢è™šæ‹Ÿç£ç›˜æ–‡ä»¶" class="headerlink" title="è½¬æ¢è™šæ‹Ÿç£ç›˜æ–‡ä»¶"></a>è½¬æ¢è™šæ‹Ÿç£ç›˜æ–‡ä»¶</h2><p>ä½¿ç”¨å·¥å…· qemu-img è¿›è¡Œè½¬æ¢, å¦‚æœæ˜¯å¯¼å…¥åˆ° pve, å¯ä»¥ä¸è½¬æ¢, ä½¿ç”¨ qm å‘½ä»¤ä¼šè‡ªåŠ¨è½¬æ¢çš„.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä»å¦ä¸€å°PVEå¯¼å‡ºqcow2å¯ä»¥è¿™æ ·</span></span><br><span class="line">qemu-img convert -p -O qcow2 -c /dev/mapper/pve-vm--110--disk--0 VM110.qcow2</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»vmdkæ–‡ä»¶è½¬æ¢å¯ä»¥è¿™æ · -c æ˜¯å‹ç¼©</span></span><br><span class="line">qemu-img convert -c -f vmdk myvm-disk1.vmdk -O qcow2 myvm-disk1.qcow2</span><br></pre></td></tr></table></figure><h2 id="åœ¨-PVE-ä¸Šåˆ›å»ºæ–°çš„è™šæ‹Ÿæœº"><a href="#åœ¨-PVE-ä¸Šåˆ›å»ºæ–°çš„è™šæ‹Ÿæœº" class="headerlink" title="åœ¨ PVE ä¸Šåˆ›å»ºæ–°çš„è™šæ‹Ÿæœº"></a>åœ¨ PVE ä¸Šåˆ›å»ºæ–°çš„è™šæ‹Ÿæœº</h2><p>æ­¤æ­¥éª¤éœ€è¦è®°å½•ä¸€ä¸‹è™šæ‹Ÿæœºçš„ ID</p><h2 id="ä¸Šä¼ è™šæ‹Ÿç£ç›˜æ–‡ä»¶åˆ°-PVE"><a href="#ä¸Šä¼ è™šæ‹Ÿç£ç›˜æ–‡ä»¶åˆ°-PVE" class="headerlink" title="ä¸Šä¼ è™šæ‹Ÿç£ç›˜æ–‡ä»¶åˆ° PVE"></a>ä¸Šä¼ è™šæ‹Ÿç£ç›˜æ–‡ä»¶åˆ° PVE</h2><p>pve æœ¬è´¨ä¸Šå°±æ˜¯ debian linux, ä½ å¯ä»¥ç”¨ä»»ä½•æ–¹ä¾¿çš„æ–¹å¼ä¸Šä¼ , æ¯”å¦‚åœ¨æœºå™¨ä¸Šä½¿ç”¨ wget ä¸‹è½½, æˆ–è€… scp sftp rz ç­‰ä¸Šä¼ </p><h2 id="ä½¿ç”¨-qm-importdisk-å‘½ä»¤å¯¼å…¥"><a href="#ä½¿ç”¨-qm-importdisk-å‘½ä»¤å¯¼å…¥" class="headerlink" title="ä½¿ç”¨ qm importdisk å‘½ä»¤å¯¼å…¥"></a>ä½¿ç”¨ qm importdisk å‘½ä»¤å¯¼å…¥</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">qm importdisk  &lt;vmid&gt; &lt;images-name&gt; &lt;storage pool&gt;  --format=&lt;disk-fs&gt; </span><br><span class="line">vmidï¼švmçš„<span class="built_in">id</span> ä¾‹å¦‚102</span><br><span class="line">images-nameï¼šç£ç›˜é•œåƒçš„åå­—</span><br><span class="line">storage pool: å­˜å‚¨ç£ç›˜é•œåƒçš„ä½ç½®ï¼Œå¦‚lvm-thin <span class="built_in">local</span></span><br><span class="line">disk-fs: ç£ç›˜é•œåƒæ ¼å¼  raw/vmdk/qcow2</span><br></pre></td></tr></table></figure><p>å¯¼å…¥æˆåŠŸå, åœ¨è™šæ‹Ÿæœºç•Œé¢å¯ä»¥çœ‹åˆ°ä¸€ä¸ªæœªä½¿ç”¨ç£ç›˜</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202311281414540.png" alt="image.png"></p><p>åŒå‡»æœªä½¿ç”¨ç£ç›˜, ç‚¹å‡»æ·»åŠ å³å¯</p><p>æœ€åè°ƒæ•´ä¸€ä¸‹å¯åŠ¨é¡¹é¡ºåº.</p>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
            <tag> è™šæ‹ŸåŒ– </tag>
            
            <tag> æ•°æ®è¿ç§» </tag>
            
            <tag> proxmox </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Windowså‘½ä»¤è¡Œä½¿ç”¨å…¶ä»–ç”¨æˆ·èº«ä»½è¿è¡Œ</title>
      <link href="/posts/snagrk/"/>
      <url>/posts/snagrk/</url>
      
        <content type="html"><![CDATA[<p>æ¯”å¦‚è¯´æˆ‘ä¸€ä¸ªè„šæœ¬ä½¿ç”¨ç®¡ç†å‘˜æƒé™è¿è¡Œï¼Œé‚£ä¹ˆå®ƒè°ƒç”¨çš„å…¶ä»–ç¨‹åºé»˜è®¤éƒ½æ˜¯ä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œçš„ã€‚æˆ‘æƒ³è¦ä»¥æ™®é€šç”¨æˆ·ç¨‹åºæ¥è¿è¡Œï¼Œæœ‰ä»¥ä¸‹å‡ ç§æ–¹æ³•ï¼š</p><h2 id="runas-æ–¹å¼"><a href="#runas-æ–¹å¼" class="headerlink" title="runas æ–¹å¼"></a>runas æ–¹å¼</h2><h3 id="æŒ‡å®šæƒé™è¿è¡Œ"><a href="#æŒ‡å®šæƒé™è¿è¡Œ" class="headerlink" title="æŒ‡å®šæƒé™è¿è¡Œ"></a>æŒ‡å®šæƒé™è¿è¡Œ</h3><p>0x20000 æ˜¯æ ‡å‡†ç”¨æˆ·æƒé™<br>0x40000 æ˜¯ç®¡ç†å‘˜æƒé™</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">runas /trustlevel:<span class="number">0</span>x20000 &quot;wt.exe&quot;</span><br></pre></td></tr></table></figure><p>è¿™ç§æ–¹å¼æˆ‘æµ‹è¯•ä¼šé€ æˆ wsl æŠ¥é”™â€œUtilTranslatePathListâ€</p><h3 id="æŒ‡å®šç”¨æˆ·æ‰§è¡Œ"><a href="#æŒ‡å®šç”¨æˆ·æ‰§è¡Œ" class="headerlink" title="æŒ‡å®šç”¨æˆ·æ‰§è¡Œ"></a>æŒ‡å®šç”¨æˆ·æ‰§è¡Œ</h3><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">runas /user:iuxt wt.exe&quot;</span><br></pre></td></tr></table></figure><p>è¿™ç§æ–¹å¼ä¼š<strong>å¼¹çª—è®©ä½ è¾“å…¥å¯†ç </strong>ï¼ˆæ¯æ¬¡ï¼‰</p><h2 id="psexec"><a href="#psexec" class="headerlink" title="psexec"></a>psexec</h2><p>psexec æ˜¯å¾®è½¯å®˜æ–¹çš„ä¸€ç»„å°å·¥å…·ï¼š<a href="https://learn.microsoft.com/zh-cn/sysinternals/downloads/psexec">https://learn.microsoft.com/zh-cn/sysinternals/downloads/psexec</a> éœ€è¦ç”¨åˆ°é‡Œé¢çš„ <code>psexec64.exe</code> ç„¶åè°ƒç”¨æ­¤å·¥å…·ã€‚</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">psexec.exe -u iuxt -p YourPassword C:\<span class="built_in">Path</span>\To\wt.exe</span><br></pre></td></tr></table></figure><p>ç¼ºç‚¹ï¼š</p><ol><li>éœ€è¦åœ¨å‘½ä»¤è¡ŒæŒ‡å®šç”¨æˆ·åå’Œå¯†ç ï¼ˆæœ‰å®‰å…¨éšæ‚£ï¼‰</li><li>è¿è¡Œçš„æ—¶å€™ä¼šæœ‰ä¸ªé»‘æ¡†æ¡†ä¸€é—ªè€Œè¿‡ï¼Œå¹¶ä¸”ç¬¬ä¸€æ¬¡å¯åŠ¨ä¼šæœ‰ä¸ªçª—å£ï¼Œéœ€è¦ç‚¹ä¸€ä¸‹ agree</li></ol>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cmd </tag>
            
            <tag> bat </tag>
            
            <tag> è„šæœ¬ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨tailscaleæ‰“é€šå†…ç½‘</title>
      <link href="/posts/loz4xrye/"/>
      <url>/posts/loz4xrye/</url>
      
        <content type="html"><![CDATA[<p>å®¶é‡Œæœ‰ä¸€å°ç¾¤æ™– nas, é€šè¿‡ quickconnect è¿æ¥å¤ªæ…¢äº†, å¹¶ä¸”æœ‰äº›æ“ä½œä¸èƒ½é€šè¿‡ quickconnect, æ¯”å¦‚ç›´æ¥ smb æŒ‚è½½ç›®å½•</p><h2 id="ç¾¤æ™–-nas-å®‰è£…"><a href="#ç¾¤æ™–-nas-å®‰è£…" class="headerlink" title="ç¾¤æ™– nas å®‰è£…"></a>ç¾¤æ™– nas å®‰è£…</h2><p>ç¾¤æ™–å›½å†…åº”ç”¨å•†åº—å·²ç»ä¸‹æ¶äº†è¿™ä¸ª APP, ä½ å¯ä»¥å°è¯•ç€åœ¨åº”ç”¨ä¸­å¿ƒæœç´¢ tailscale, å¦‚æœå¯ä»¥æœç´¢åˆ°, å°±ç›´æ¥å®‰è£…å³å¯. æœç´¢ä¸åˆ°çš„è¯, å¯ä»¥ä½¿ç”¨ç¦»çº¿å®‰è£…çš„æ–¹å¼:<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202311151015762.png" alt="image.png"></p><p>åˆ°å®˜ç½‘ä¸‹è½½ç¦»çº¿ SPK åŒ…:<br><a href="https://pkgs.tailscale.com/stable/#spks">https://pkgs.tailscale.com/stable/#spks</a><br>æ ¹æ®ä½ çš„ç³»ç»Ÿæ¶æ„æ¥ä¸‹è½½åŒ…, intel cpu ä¸‹è½½ x86_64 æ¶æ„çš„åŒ…. ç„¶åè¿›å…¥ç¾¤æ™–è½¯ä»¶ä¸­å¿ƒ, ç‚¹å‡»æ‰‹åŠ¨å®‰è£…, ä¸Šä¼  spk åŒ…å®‰è£…</p><p>ç¬¬ä¸€æ¬¡æ‰“å¼€ tailscale éœ€è¦ç™»å½•, ç™»å½•é¡µé¢ä¸æ”¯æŒ quickconnect è¿œç¨‹è¿æ¥, æ‰€ä»¥å»ºè®®åœ¨å®¶é…ç½®å¥½ tailscale</p><h2 id="windows-å®‰è£…"><a href="#windows-å®‰è£…" class="headerlink" title="windows å®‰è£…"></a>windows å®‰è£…</h2><p>å®‰è£…æˆåŠŸåï¼Œ å³é”®ä»»åŠ¡æ å›¾æ ‡ï¼Œç‚¹å‡» login ç™»å½• tailscale è´¦å·</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202311141320528.png" alt="image.png"></p><p>ç™»å½•æˆåŠŸåï¼Œå¯ä»¥åœ¨å®˜ç½‘<a href="https://login.tailscale.com/admin/machines">https://login.tailscale.com/admin/machines</a> æŸ¥çœ‹åˆ°æ‰€æœ‰çš„è®¾å¤‡å’Œ IP åœ°å€ç­‰ä¿¡æ¯ã€‚</p><h2 id="è®¿é—®æ–¹å¼"><a href="#è®¿é—®æ–¹å¼" class="headerlink" title="è®¿é—®æ–¹å¼"></a>è®¿é—®æ–¹å¼</h2><p>tailscale å¯ä»¥ä½¿ç”¨ ip åœ°å€æ¥è®¿é—®ï¼Œæˆ–è€…ä½¿ç”¨ tailscale çš„ dns åŸŸåï¼Œæ¯”å¦‚<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202311141324348.png" alt="image.png"></p><p>å»ºè®®ç»™å¸¸ç”¨è®¾å¤‡è®¾ç½® <code>Disable key expiry</code> é˜²æ­¢ç™»å½•è¿‡æœŸ.</p><p>æˆ‘å¯ä»¥ä½¿ç”¨ mac-mini æ¥è®¿é—®æˆ‘çš„å…¶ä¸­ä¸€å°æœºè€Œä¸ç”¨è®°ä½ IP åœ°å€ã€‚</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202311141324477.png" alt="image.png"></p><h2 id="æŸ¥çœ‹æ˜¯å¦æ‰“æ´æˆåŠŸ"><a href="#æŸ¥çœ‹æ˜¯å¦æ‰“æ´æˆåŠŸ" class="headerlink" title="æŸ¥çœ‹æ˜¯å¦æ‰“æ´æˆåŠŸ"></a>æŸ¥çœ‹æ˜¯å¦æ‰“æ´æˆåŠŸ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tailscale ping zhanglikundemac-mini.tailff0c6.ts.net</span><br><span class="line">pong from zhanglikundemac-mini (100.107.120.45) via DERP(tok) <span class="keyword">in</span> 208ms</span><br><span class="line">pong from zhanglikundemac-mini (100.107.120.45) via DERP(sfo) <span class="keyword">in</span> 172ms</span><br><span class="line">pong from zhanglikundemac-mini (100.107.120.45) via DERP(tok) <span class="keyword">in</span> 1.71s</span><br></pre></td></tr></table></figure><p>ç»“æœæ˜¾ç¤º DERP å°±æ˜¯èµ°çš„ä¸­ç»§ï¼Œæ¯”è¾ƒæ…¢</p>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç½‘ç»œ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æŸ¥çœ‹kubernetesèŠ‚ç‚¹çš„ç¡¬ä»¶é…ç½®</title>
      <link href="/posts/lo57b8gx/"/>
      <url>/posts/lo57b8gx/</url>
      
        <content type="html"><![CDATA[<p><code>kubectl describe node</code> å¯ä»¥æŸ¥çœ‹åˆ°ä¿¡æ¯, è¿™é‡Œä½¿ç”¨ jq è¿›è¡Œä¸€ä¸‹æ•°æ®å¤„ç†æ ¼å¼åŒ–.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get node -o json | jq <span class="string">&#x27;.items[] | &quot;===========================================&quot;, &quot;æœºå™¨å: \(.metadata.labels.&quot;kubernetes.io/hostname&quot;) &quot;, &quot;CPU: \(.status.capacity.cpu) æ ¸&quot;,  &quot;å†…å­˜å¤§å°:  \(.status.capacity.memory)&quot;&#x27;</span></span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœç±»ä¼¼äº:</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202310251137563.png" alt="image.png"></p>]]></content>
      
      
      <categories>
          
          <category> å®¹å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¸¸ç”¨æ“ä½œ </tag>
            
            <tag> k8s </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>çˆ·çš„é’æ˜¥ç»“æŸäº†</title>
      <link href="/posts/lo4f92df/"/>
      <url>/posts/lo4f92df/</url>
      
        <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å›å¿†æ˜¯æŠ“ä¸åˆ°çš„æœˆå…‰æ¡ç´§å°±å˜é»‘æš—ï¼Œå›å¿†æ˜¯ç¾å¥½çš„ï¼Œä½†ä¸è¦æ²‰è¿·äºå›å¿†ï¼Œä¸è¦å°è¯•å®‰è£…æ¨¡æ‹Ÿå™¨å»å›å¿†ä¹‹å‰çš„è€æ¸¸æˆå•¦ï¼Œä¼šæµªè´¹ç°åœ¨çš„æ—¶é—´ï¼Œç«¥å¹´æ˜¯æ‰¾ä¸å›æ¥äº†ï¼Œè¿‡å¥½å½“ä¸‹å§ã€‚ä¸€ä¸ªåœ¨çº¿ä½“éªŒè€æ¸¸æˆçš„ç½‘å€ï¼š <a href="https://zaixianwan.app/">https://zaixianwan.app</a></p><h2 id="ä¸ºå•¥å†™è¿™ç¯‡æ–‡ç« "><a href="#ä¸ºå•¥å†™è¿™ç¯‡æ–‡ç« " class="headerlink" title="ä¸ºå•¥å†™è¿™ç¯‡æ–‡ç« "></a>ä¸ºå•¥å†™è¿™ç¯‡æ–‡ç« </h2><p>æ—¶é—´è¿‡çš„å¤ªå¿«ï¼Œ çœ‹ç€èº«è¾¹çš„ä¸œè¥¿éƒ½å˜äº†æ ·ï¼Œæœ‰æ—¶å€™çªç„¶æƒ³èµ·å¾ˆä¹…ä»¥å‰ç©è¿‡çš„æ¸¸æˆï¼Œä½†æ˜¯æ€ä¹ˆä¹Ÿæƒ³ä¸èµ·åå­—ï¼Œå°±ç®—æƒ³èµ·æ¥äº†ï¼Œæœç´¢å¼•æ“éƒ½æœä¸åˆ°ç›¸å…³çš„æ–‡ç« ï¼Œåªèƒ½å‹‰å¼ºæœåˆ°ä¸€äº›åŒ…æµ†äº†çš„å›¾ï¼Œæ‰€ä»¥è¿˜æ˜¯è®°å½•ä¸‹æ¥ï¼Œå¯¹è‡ªå·±çš„è¿‡å»åšä¸ªè®°å½•ã€‚</p><h2 id="ä¿„ç½—æ–¯æ–¹å—æœº"><a href="#ä¿„ç½—æ–¯æ–¹å—æœº" class="headerlink" title="ä¿„ç½—æ–¯æ–¹å—æœº"></a>ä¿„ç½—æ–¯æ–¹å—æœº</h2><h2 id="FC-æ¸¸æˆæœº"><a href="#FC-æ¸¸æˆæœº" class="headerlink" title="FC æ¸¸æˆæœº"></a>FC æ¸¸æˆæœº</h2><p>FC æ¸¸æˆæœºæŒ‡çš„æ˜¯ä»»å¤©å ‚çš„çº¢ç™½æœºï¼Œ ä½†æ˜¯åœ¨ä¸­å›½æ™®åŠå¼€æ¥çš„æ—¶å€™å·²ç»æ˜¯ç›—ç‰ˆéåœ°äº†ï¼Œ ä¸ä»…ä»…æ˜¯æœºå™¨ç›—ç‰ˆï¼Œ è¿˜æœ‰å¾ˆå¤šç›—ç‰ˆæ¸¸æˆï¼Œ è¿˜è®°å¾—å¤–æ˜Ÿç§‘æŠ€ç­‰ç­‰å¼€å‘çš„é‚£äº›å¡å°”è¾¾ï¼Ÿ</p><p>æ¨¡æ‹Ÿå™¨ç½‘ä¸Šåˆ°å¤„éƒ½æ˜¯, å¾ˆå¤šéƒ½æ˜¯åœ¨çº¿ç©çš„. æ¯”å¦‚ <a href="https://zaixianwan.app/">https://zaixianwan.app</a></p><p>ä¸€ä¸ªèƒŒæ™¯éŸ³ä¹ä¸‹è½½ç½‘ç«™: <a href="https://www.zophar.net/music/">https://www.zophar.net/music/</a></p><p>NSFPlay æ’­æ”¾å™¨ï¼š<a href="https://bbbradsmith.github.io/nsfplay/">https://bbbradsmith.github.io/nsfplay/</a></p><p>å¼€æº nfs ç¼–è¾‘å™¨: <a href="https://famistudio.org/">https://famistudio.org/</a></p><h3 id="å°éœ¸ç‹"><a href="#å°éœ¸ç‹" class="headerlink" title="å°éœ¸ç‹"></a>å°éœ¸ç‹</h3><p>å½“æ—¶æ‘é‡Œå·²ç»æœ‰å°ä¼™ä¼´ç”¨ä¸Šäº†ç›—ç‰ˆå°éœ¸ç‹ï¼ˆæ²¡é”™ï¼Œæ˜¯ç›—ç‰ˆçš„å°éœ¸ç‹ï¼ŒçœŸçš„å°éœ¸ç‹è¿˜æ˜¯æ¯”è¾ƒè´µçš„ï¼‰ï¼Œå’Œå°éœ¸ç‹ä¸€æ ·æ‹¥æœ‰é”®ç›˜ã€æ‰“å­—æ¸¸æˆã€å…‰æªï¼ˆç©æ‰“é¸­å­æ¸¸æˆï¼‰ï¼Œä¸¤ä¸ªæ‰‹æŸ„ï¼Œä¸¤å¼ æ¸¸æˆå¡å¸¦ï¼Œ å¤§æ¦‚é•¿è¿™ä¸ªæ ·å­ï¼š<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202310121159789.webp" alt="20200726003955_22567911932703161853315.webp"></p><p>å°å­¦çš„æ—¶å€™ï¼Œç»å¸¸å»å°ä¼™ä¼´å®¶é‡Œä¸€å—ç©ï¼Œ é‚£æ—¶å€™æ²¡æœ‰æ¸¸æˆå¡ï¼Œå°±ç©ä¸Šé¢çš„æ‰“å­—æ¸¸æˆã€‚ã€‚ã€‚åé¢çŸ¥é“äº†å¯ä»¥ç©æ¸¸æˆå°±ä¸€å‘ä¸å¯æ”¶æ‹¾äº†</p><h3 id="æœ€ä¾¿å®œçš„-FC-æ¸¸æˆæœº"><a href="#æœ€ä¾¿å®œçš„-FC-æ¸¸æˆæœº" class="headerlink" title="æœ€ä¾¿å®œçš„ FC æ¸¸æˆæœº"></a>æœ€ä¾¿å®œçš„ FC æ¸¸æˆæœº</h3><p>ç­‰æˆ‘æœ‰äº†ç¬¬ä¸€å° FC æ¸¸æˆæœºçš„æ—¶å€™ï¼Œ å¥½åƒå·²ç»ä¸Šåˆä¸­äº†ï¼ˆå½“æ—¶ä½æ ¡ï¼Œæœ‰äº†ä¸€äº›é¥­é’±ï¼‰ï¼Œæˆ‘ä»¬é‚£è¾¹å•†åº—ä¹°äº†ä¸€å° 16 å—é’±çš„å±±å¯¨æ¸¸æˆæœºï¼Œåªæœ‰ä¸¤ä¸ªæ‰‹æŸ„åŠ ä¸€ä¸ªä¸»æœºå’Œå……ç”µå™¨ã€‚ é™„ä¸Šç‰›å±å›¾ï¼ˆèŠ±å±äº†å¯ä»¥ç”¨å˜´èˆ”èˆ”ï¼‰ï¼š</p><div class="gallery-container" data-type="data" data-button="" data-limit="10" data-first="10">    <div class="gallery-items">[{"url":"https://static.zahui.fan/images/202310051410090.jpg","alt":"10001.jpg","title":""},{"url":"https://static.zahui.fan/images/202310051412370.png","alt":"image.png","title":""}]</div>  </div><p>ç±»ä¼¼äºè¿™æ ·ï¼Œ å½“æ—¶å®¶é‡Œçš„ç”µè§†è¿˜æ˜¯é»‘ç™½çš„ï¼Œ åªèƒ½ç”¨å°„é¢‘çº¿ RF æ¥è¿æ¥ï¼Œ å°±æ˜¯æŠŠçº¿æ’åˆ°ç”µè§†æœºå¤©çº¿æ’åº§ä¸Šé¢ï¼Œç„¶åè¿›è¡Œæœå°ï¼Œ å½“ç„¶ç”»è´¨ä¹Ÿæ¯”è¾ƒå·®ï¼Œ æœ‰æ—¶å€™è¿æ°”å¥½ï¼Œå¯ä»¥æœåˆ°åˆ«äººå®¶çš„æ¸¸æˆç”»é¢ã€‚åé¢æ¢äº†å½©ç”µï¼Œå¯ä»¥ç”¨ AV çº¿è¿æ¥ç”µè§†äº†ã€‚</p><h2 id="ç£å¸¦æœºå’Œ-CD-æœº"><a href="#ç£å¸¦æœºå’Œ-CD-æœº" class="headerlink" title="ç£å¸¦æœºå’Œ CD æœº"></a>ç£å¸¦æœºå’Œ CD æœº</h2><p>å°å­¦æ—¶å€™å¬çš„ç£å¸¦æœºï¼Œå¬çš„æœ€å¤šçš„å°±æ˜¯åˆ€éƒçš„æ­Œï¼Œä»€ä¹ˆã€Š2002 å¹´çš„ç¬¬ä¸€åœºé›ªã€‹å•¦ã€‚</p><div class="gallery-container" data-type="data" data-button="" data-limit="10" data-first="10">    <div class="gallery-items">[{"url":"https://static.zahui.fan/images/202406192347275.JPG","alt":"IMG_20240608_215503.JPG","title":""},{"url":"https://static.zahui.fan/images/202406192356750.JPG","alt":"IMG_20240616_215110.JPG|674","title":""},{"url":"https://static.zahui.fan/images/202406192348081.JPG","alt":"IMG_20240608_215742.JPG|657","title":""},{"url":"https://static.zahui.fan/images/202406192348606.JPG","alt":"IMG_20240608_215747.JPG|694","title":""},{"url":"https://static.zahui.fan/images/202406192349694.JPG","alt":"IMG_20240608_215952.JPG","title":""}]</div>  </div><p>CD æœºï¼Œå¬çš„ç¬¬ä¸€é¦–æ­Œæ˜¯ æ—ä¿Šæ° - å°±æ˜¯æˆ‘</p><div class="gallery-container" data-type="data" data-button="" data-limit="10" data-first="10">    <div class="gallery-items">[{"url":"https://static.zahui.fan/images/202406082223717.jpg","alt":"10003.jpg|403","title":""},{"url":"https://static.zahui.fan/images/202406082223884.jpg","alt":"10006.jpg|408","title":""},{"url":"https://static.zahui.fan/images/202406082223922.jpg","alt":"10002.jpg|408","title":""},{"url":"https://static.zahui.fan/images/202406082224807.jpg","alt":"10004.jpg|406","title":""},{"url":"https://static.zahui.fan/images/202406082224306.webp","alt":"5c404375c9bf59863.jpg_e1080.webp|411","title":""},{"url":"https://static.zahui.fan/images/202406192349314.PNG","alt":"IMG_20240608_221428.PNG|766","title":""},{"url":"https://static.zahui.fan/images/202406192350667.PNG","alt":"IMG_20240608_221335.PNG|762","title":""}]</div>  </div><h2 id="å¤è¯»æœºå’Œå½•éŸ³æœº"><a href="#å¤è¯»æœºå’Œå½•éŸ³æœº" class="headerlink" title="å¤è¯»æœºå’Œå½•éŸ³æœº"></a>å¤è¯»æœºå’Œå½•éŸ³æœº</h2><p>æ’­æ”¾ç£å¸¦çš„é‚£ç§ï¼Œéª—è‡ªå·±æ˜¯ç”¨æ¥å­¦è‹±è¯­çš„ï¼ˆåˆä¸­é«˜ä¸­è‹±è¯­è€å¸ˆä¸Šè¯¾éƒ½ä¼šæ‹ç€ä¸€ä¸ªå¤§å½•éŸ³æœºåˆ°æ•™å®¤æ’­æ”¾å¬åŠ›ç£å¸¦ï¼‰</p><h2 id="MP3-å’Œ-MP4"><a href="#MP3-å’Œ-MP4" class="headerlink" title="MP3 å’Œ MP4"></a>MP3 å’Œ MP4</h2><p>åˆä¸­çš„æ—¶å€™æµè¡Œçš„ MP3ï¼Œæ€•è€å¸ˆå‘ç°ï¼Œæœ‰äº›å¸¦å–‡å­çš„ mp3 å¯ä»¥å¡åˆ°æ‰‹å¥—é‡Œæ”¾åœ¨è€³æœµé™„è¿‘å¬æ­Œã€‚é«˜ä¸­çš„æ—¶å€™æµè¡Œçš„ MP4ï¼ŒMP3 åˆšå¼€å§‹ç¡¬ç›˜åªæœ‰ 128MBã€‚</p><div class="gallery-container" data-type="data" data-button="" data-limit="10" data-first="10">    <div class="gallery-items">[{"url":"https://static.zahui.fan/images/202407311803167.JPEG","alt":"","title":""},{"url":"https://static.zahui.fan/images/202406192351063.JPG","alt":"IMG_20240608_220430.JPG|691","title":""},{"url":"https://static.zahui.fan/images/202406192352094.JPG","alt":"IMG_20240608_220739.JPG|525","title":""},{"url":"https://static.zahui.fan/images/202406192352050.JPG","alt":"IMG_20240608_220948.JPG|525","title":""},{"url":"https://static.zahui.fan/images/202406192354750.JPG","alt":"IMG_20240608_221020.JPG","title":""}]</div>  </div><h2 id="ç”µå­è¾å…¸"><a href="#ç”µå­è¾å…¸" class="headerlink" title="ç”µå­è¾å…¸"></a>ç”µå­è¾å…¸</h2><h3 id="æ­¥æ­¥é«˜ç”µå­è¯å…¸æœ—æ–‡-4980"><a href="#æ­¥æ­¥é«˜ç”µå­è¯å…¸æœ—æ–‡-4980" class="headerlink" title="æ­¥æ­¥é«˜ç”µå­è¯å…¸æœ—æ–‡ 4980"></a>æ­¥æ­¥é«˜ç”µå­è¯å…¸æœ—æ–‡ 4980</h3><div class="gallery-container" data-type="data" data-button="" data-limit="10" data-first="10">    <div class="gallery-items">[{"url":"https://static.zahui.fan/images/202310051554583.png","alt":"image.png","title":""},{"url":"https://static.zahui.fan/images/202310051552668.png","alt":"image.png","title":""}]</div>  </div><p>åˆä¸­å’Œé«˜ä¸­æ—¶å€™ç©çš„ï¼Œå°±æ˜¯ä¸ªæ™®é€šçš„ç”µå­è¯å…¸ï¼Œä¸ä¸€æ ·çš„åœ°æ–¹æ˜¯å®ƒæœ‰ 1MB çš„ç£ç›˜ç©ºé—´ï¼Œå¯ä»¥ä¸‹è½½æ¸¸æˆï¼Œæ¯”è¾ƒæœ‰åçš„æ¸¸æˆæœ‰ï¼š ä¼é­”è®°ã€ä¸‰å›½éœ¸ä¸šã€é­”å¡”ç­‰ï¼Œ ä¸€èŠ‚ 7 å·ç”µæ± å°±èƒ½ç»­èˆªå¾ˆä¹…ã€‚</p><p>åœ¨çº¿æ¸¸ç©åœ°å€: <a href="https://bbk-games.zahui.fan/">https://bbk-games.zahui.fan/</a> å’Œ <a href="https://bbk-games.zahui.fan/bbk-games/">https://bbk-games.zahui.fan/bbk-games/</a></p><h4 id="ä¼é­”è®°"><a href="#ä¼é­”è®°" class="headerlink" title="ä¼é­”è®°"></a>ä¼é­”è®°</h4><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202310131217857.png" alt="image.png"></p><h4 id="ä¸‰å›½éœ¸ä¸š"><a href="#ä¸‰å›½éœ¸ä¸š" class="headerlink" title="ä¸‰å›½éœ¸ä¸š"></a>ä¸‰å›½éœ¸ä¸š</h4><p>ç­–ç•¥æ¸¸æˆï¼Œæœ‰å„ç§å…µç§ï¼Œè®°å¾—æ¯”è¾ƒæç¬‘çš„æ˜¯å¯ä»¥åŠé™ï¼Œä¸åœå¾—æ´¾äººå»æ‹›å®‰æ•Œæ–¹æ­¦å°†ã€‚ã€‚ã€‚</p><div class="gallery-container" data-type="data" data-button="" data-limit="10" data-first="10">    <div class="gallery-items">[{"url":"https://static.zahui.fan/images/202404242244027.png","alt":"image.png","title":""},{"url":"https://static.zahui.fan/images/202404242244619.png","alt":"image.png","title":""},{"url":"https://static.zahui.fan/images/202404242245727.png","alt":"image.png","title":""}]</div>  </div><h4 id="é­”å¡”"><a href="#é­”å¡”" class="headerlink" title="é­”å¡”"></a>é­”å¡”</h4><p>ç§»æ¤è‡ª flash æ¸¸æˆé­”å¡”</p><div class="gallery-container" data-type="data" data-button="" data-limit="10" data-first="10">    <div class="gallery-items">[{"url":"https://static.zahui.fan/images/202404242247479.png","alt":"image.png","title":""},{"url":"https://static.zahui.fan/images/202404242248180.png","alt":"image.png","title":""}]</div>  </div><h3 id="æ­¥æ­¥é«˜å­¦ä¹ æœº-s1"><a href="#æ­¥æ­¥é«˜å­¦ä¹ æœº-s1" class="headerlink" title="æ­¥æ­¥é«˜å­¦ä¹ æœº s1"></a>æ­¥æ­¥é«˜å­¦ä¹ æœº s1</h3><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202310051624647.png" alt="image.png"></p><h4 id="é›·éœ†æˆ˜æœº"><a href="#é›·éœ†æˆ˜æœº" class="headerlink" title="é›·éœ†æˆ˜æœº"></a>é›·éœ†æˆ˜æœº</h4><div class="gallery-container" data-type="data" data-button="" data-limit="10" data-first="10">    <div class="gallery-items">[{"url":"https://static.zahui.fan/images/202404242241769.png","alt":"","title":""},{"url":"https://static.zahui.fan/images/202404242240958.png","alt":"","title":""}]</div>  </div><h4 id="ä½¿å‘½"><a href="#ä½¿å‘½" class="headerlink" title="ä½¿å‘½"></a>ä½¿å‘½</h4><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202404121845999.png" alt="202404121845999.png|229"></p><h2 id="æ‰‹æœº"><a href="#æ‰‹æœº" class="headerlink" title="æ‰‹æœº"></a>æ‰‹æœº</h2><h3 id="TCl-5188"><a href="#TCl-5188" class="headerlink" title="TCl 5188"></a>TCl 5188</h3><p>å®¶é‡Œçš„ç¬¬ä¸€å°æ‰‹æœº, é‚£æ—¶å€™ç”¨çš„æ˜¯ä¸€å° TCL 5188 ç¿»ç›–æ‰‹æœº, å±å¹•æ˜¯é»‘ç™½çš„è“è‰²èƒŒå…‰, åŠŸèƒ½éå¸¸å•ä¸€ã€‚ å¼€æœºä¼šæœ‰ä¸€ä¸ªç¦å­—ï¼Œå¤–é¢çš„å±å¹•å¯ä»¥æ˜¾ç¤ºä¸€äº›å¸¸è§çš„ä¿¡æ¯ã€‚</p><div class="gallery-container" data-type="data" data-button="" data-limit="10" data-first="10">    <div class="gallery-items">[{"url":"https://static.zahui.fan/images/202310051520215.png","alt":"image.png","title":""},{"url":"https://static.zahui.fan/images/202311160017851.png","alt":"image.png","title":""}]</div>  </div><h3 id="å……è¯è´¹é€çš„æ‰‹æœº"><a href="#å……è¯è´¹é€çš„æ‰‹æœº" class="headerlink" title="å……è¯è´¹é€çš„æ‰‹æœº"></a>å……è¯è´¹é€çš„æ‰‹æœº</h3><p>å……è¯è´¹é€çš„æ‰‹æœºï¼šé¢„å­˜ 120 è¯è´¹é€ä¸€ä¸ªè”æƒ³çš„æ‰‹æœºï¼Œåˆ†è¾¨ç‡æ˜¯ 128x128ï¼Œ å½“æ—¶ä¸­å›½ç§»åŠ¨æ¨å¹¿è‡ªå·±çš„ç§»åŠ¨æ¢¦ç½‘ï¼ˆåœ¨ä»»æ„ç•Œé¢é•¿æŒ‰ 0 å°±èƒ½ç›´æ¥è·³åˆ°ç§»åŠ¨æ¢¦ç½‘ç•Œé¢ï¼Œè‡ªå¸¦æµè§ˆå™¨é»˜è®¤çš„é¦–é¡µå°±æ˜¯ç§»åŠ¨æ¢¦ç½‘ï¼Œè¿˜ä¸èƒ½æ”¹ï¼Œä¸è¿‡ä¹¦ç­¾ã€å†å²è®°å½•è¿™äº›éƒ½æ˜¯å¸¦çš„ï¼‰ï¼Œå°±è¿™ç§ä½ç«¯çš„æ‰‹æœºéƒ½å¸¦ä¸Šç½‘çš„åŠŸèƒ½ï¼Œå½“ç„¶æµé‡è´¹å¾ˆè´µï¼Œæœ€å¼€å§‹æµé‡æ˜¯ 10 å…ƒ&#x2F;MBï¼Œåæ¥æ‰æ”¹æˆ 1 å…ƒ&#x2F;MBï¼Œ å½“æ—¶å°±ç”¨å®ƒçœ‹çœ‹æ–°é—»ã€ä¸Šä¸Š 3GQQï¼ˆç½‘é¡µç‰ˆçº¯æ–‡å­—çš„ QQï¼‰è¿™ä¸ªæ‰‹æœºè¿˜ä¸èƒ½è¿è¡Œ APPï¼Œèƒ½ç½‘ä¸Šå°±ä¸é”™äº†ã€‚å¦‚å›¾ï¼š</p><div class="gallery-container" data-type="data" data-button="" data-limit="10" data-first="10">    <div class="gallery-items">[{"url":"https://static.zahui.fan/images/202310051527179.png","alt":"image.png","title":""},{"url":"https://static.zahui.fan/images/202310051524403.png","alt":"image.png","title":""}]</div>  </div><h3 id="è¯ºåŸºäºš-1600"><a href="#è¯ºåŸºäºš-1600" class="headerlink" title="è¯ºåŸºäºš 1600"></a>è¯ºåŸºäºš 1600</h3><p>çˆ¸çˆ¸ç”¨çš„æ‰‹æœºï¼Œå½“å¹´æˆ‘é«˜è€ƒçš„æ—¶å€™å¸¦è¿›è€ƒåœºçš„å°±æ˜¯è¿™ä¸ªã€‚è¿™ä¸ªæ—¶å€™çš„è¯ºåŸºäºšæ‰‹æœºå‡ ä¹éƒ½æ”¯æŒå…³é—­èƒŒå…‰ä½¿ç”¨, ä¸è®ºé»‘ç™½å±å¹•è¿˜æ˜¯å½©å±, åœ¨å…¶ä»–æœºå™¨ä¸Šä»æ¥æ²¡è§è¿‡çš„.å“ªæ€•ç°åœ¨æ”¯æŒæ¯å±æ˜¾ç¤ºçš„æœºå™¨, ä¹Ÿä¸èƒ½å…³é—­èƒŒå…‰ä½¿ç”¨.</p><p>ç‰¹ç‚¹ï¼š</p><ol><li>å½©å±ã€æ”¯æŒå…³é—­èƒŒå…‰ä½¿ç”¨</li><li>ç ¸æ ¸æ¡ƒ</li><li>å¯ä»¥ç©è´ªåƒè›‡ã€éª°å­æ¸¸æˆã€å½©çƒæ»‘æ¢¯ã€‚</li></ol><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202311212317251.png" alt="image.png"></p><p>é™„ä¸Šè¯ºåŸºäºšçš„åŠååŠé€å±å¹•ï¼š</p><div class="gallery-container" data-type="data" data-button="" data-limit="10" data-first="10">    <div class="gallery-items">[{"url":"https://static.zahui.fan/images/202311242219869.png","alt":"image.png","title":""},{"url":"https://static.zahui.fan/images/202311242219862.png","alt":"image.png|476","title":""},{"url":"https://static.zahui.fan/images/202311242220233.png","alt":"image.png|430","title":""}]</div>  </div><h3 id="ä¸­å…´-s190"><a href="#ä¸­å…´-s190" class="headerlink" title="ä¸­å…´ s190"></a>ä¸­å…´ s190</h3><p>è¿™ä¸ªæ‰‹æœºæ¯”è¾ƒç¥å¥‡ï¼Œ åŒæ ·çš„åˆ†è¾¨ç‡æ˜¯ 128x128ï¼Œä½†æ˜¯å®ƒç«Ÿç„¶è‡ªå¸¦äº†æ‰‹æœº QQ å®¢æˆ·ç«¯ï¼Œå¹¶ä¸”è¿˜æœ‰ UC æµè§ˆå™¨ï¼Œå¹¶ä¸”æ”¯æŒ brew å¹³å°ï¼ˆé«˜é€šçš„è½¯ä»¶å¹³å°ï¼Œæ”¯æŒåœ¨å•†åº—å®‰è£… appï¼Œä¸è¿‡éƒ½æ˜¯ä¸€äº›æ”¶è´¹çš„æ¸¸æˆï¼Œæ¸¸æˆæä¾›è¯•ç©æ—¶é—´ï¼‰åœ¨ä¸Šé¢ç©è¿‡åŒ—äº¬æ·é€šåå£°çš„å†›é­‚ç³»åˆ—ï¼Œè¿˜æœ‰ä¸€æ¬¾æŠ„è¢­ cs å°„å‡»æ¸¸æˆï¼Œ è¿™ä¸ªæ‰‹æœºæˆ‘åœ¨é«˜å››å¤è¯»çš„æ—¶å€™è¿˜åœ¨ç”¨ã€‚ä¹Ÿå°±æ˜¯è¿™éƒ¨æ‰‹æœºè®©æˆ‘å¯¹ä¸­å…´ç‰¹åˆ«æœ‰å¥½æ„Ÿï¼Œä¸Šå¤§å­¦åˆä¹°äº†ä¸‰æ¬¾ä¸­å…´çš„æ‰‹æœºã€‚</p><div class="gallery-container" data-type="data" data-button="" data-limit="10" data-first="10">    <div class="gallery-items">[{"url":"https://static.zahui.fan/images/202310051529730.png","alt":"image.png","title":""},{"url":"https://static.zahui.fan/images/202310051529733.png","alt":"image.png","title":""},{"url":"https://static.zahui.fan/images/202310051529081.png","alt":"image.png","title":""}]</div>  </div><h3 id="LG-BL20E"><a href="#LG-BL20E" class="headerlink" title="LG BL20E"></a>LG BL20E</h3><p>ä¸å¾—ä¸è¯´, è¿™ä¸ªæ‰‹æœºæ˜¯çœŸå¿ƒå¥½çœ‹, æ»‘ç›–åŠ é»‘çº¢çš„è®¾è®¡, æ‘„åƒå¤´æ˜¯æ–½è€å¾·çš„ 500 ä¸‡åƒç´ , åœ¨å½“æ—¶ç§’æ€å¾ˆå¤šè¯ºåŸºäºšäº†, æˆ‘ä¸€ç›´ç”¨åˆ°ä¸Šå¤§å­¦, æ‰‹æœºæ”¯æŒ java ç¨‹åºï¼Œåˆ†è¾¨ç‡æ˜¯ 240x320 ï¼Œä¸‹è½½è½¯ä»¶æˆ‘éƒ½æ˜¯é€‰æ‹©çš„è¯ºåŸºäºš</p><div class="gallery-container" data-type="data" data-button="" data-limit="10" data-first="10">    <div class="gallery-items">[{"url":"https://static.zahui.fan/images/202311212242320.png","alt":"image.png","title":""},{"url":"https://static.zahui.fan/images/202311211912539.png","alt":"image.png|614","title":""},{"url":"https://static.zahui.fan/images/202311211915393.png","alt":"image.png","title":""},{"url":"https://static.zahui.fan/images/202311212058064.png","alt":"image.png|619","title":""}]</div>  </div><h3 id="ä¸­å…´-N788"><a href="#ä¸­å…´-N788" class="headerlink" title="ä¸­å…´ N788"></a>ä¸­å…´ N788</h3><p>å½“æ—¶é¢„å­˜èŠ±è´¹èµ é€çš„æ‰‹æœº, ç”µä¿¡ç‰ˆ, å½“æ—¶æœ‰ä¸ªå£å·: ä¸€å…¥ç”µä¿¡æ·±ä¼¼æµ·ï¼Œä»æ­¤æ‰‹æœºä¸å¥½ä¹°ã€‚è¯´çš„å°±æ˜¯å½“æ—¶æ²¡æœ‰å…¨ç½‘é€šæ‰‹æœºï¼Œç§»åŠ¨æ‰‹æœºæ’ç§»åŠ¨å¡æœ‰ 3G ä¿¡å·ï¼Œæ’è”é€šå¡åªæœ‰ 2G ä¿¡å·ï¼Œè”é€šæ‰‹æœºä¹Ÿç±»ä¼¼ã€‚ä½†æ˜¯ç”µä¿¡æ‰‹æœºåªèƒ½ä½¿ç”¨ç”µä¿¡å¡ï¼Œç”µä¿¡å¡ä¹Ÿåªèƒ½ç”¨åœ¨ç”µä¿¡æ‰‹æœºä¸Šï¼Œæ‰€ä»¥å½“æ—¶éƒ½æ˜¯é¢„å­˜è¯è´¹é€æ‰‹æœºçš„å±…å¤šï¼Œå½“æ—¶çš„åä¸ºä¹Ÿè¿˜æ˜¯ä½ç«¯å……è¯è´¹é€çš„é‚£ç§ã€‚ç¥åº™é€ƒäº¡æ¯”è¾ƒæµè¡Œï¼Œä½†æ˜¯è¿™æ‰‹æœºç©ä¸äº†ï¼Œå†…å­˜åªæœ‰ 256MBï¼Œä¼šé—ªé€€ã€‚æˆ‘é‚£æ—¶å€™è¿˜ä¸ä¼šåˆ·æœºï¼Œè·Ÿç€è®ºå›æ•™ç¨‹æ€ä¹ˆä¹Ÿå­¦ä¸ä¼š rootï¼ŒèŠ±äº† 15 å—é’±å»æ‰‹æœºåº— root</p><p>æ‰‹æœºå‚æ•°ï¼š<br>ç½‘ç»œæ¨¡å¼ï¼šCDMA2000<br>å¤–è§‚è®¾è®¡ï¼šç›´æ¿<br>ä¸»å±å°ºå¯¸ï¼š3.5 è‹±å¯¸ 480x320 åƒç´ <br>è§¦æ‘¸å±ï¼šç”µå®¹å±ï¼Œå¤šç‚¹è§¦æ§<br>æ‘„åƒå¤´åƒç´ ï¼š320 ä¸‡åƒç´  CMOS<br>æ“ä½œç³»ç»Ÿï¼šAndroid OS 2.3<br>RAM å®¹é‡ï¼š256MB<br>ROM å®¹é‡ï¼š512MB<br>ç”µæ± å®¹é‡ï¼š1400mAh</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202311212343262.png" alt="image.png"></p><h3 id="ä¸­å…´-V880"><a href="#ä¸­å…´-V880" class="headerlink" title="ä¸­å…´ V880"></a>ä¸­å…´ V880</h3><p>v880 è”é€šå®šåˆ¶æœºå™¨<br>u880 ç§»åŠ¨å®šåˆ¶æœºå™¨<br>n880 ç”µä¿¡å®šåˆ¶æœºå™¨</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202404122242956.png" alt="image.png"></p><h3 id="ä¸­å…´-N881F"><a href="#ä¸­å…´-N881F" class="headerlink" title="ä¸­å…´ N881F"></a>ä¸­å…´ N881F</h3><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202311212359434.png" alt="image.png"></p><p>æ‰‹æœºé…ç½®ï¼š</p><p>960x540<br>1.2G åŒæ ¸<br>768MB + 4GB<br>Android 4.0.4</p><h3 id="ä¸­å…´-N909"><a href="#ä¸­å…´-N909" class="headerlink" title="ä¸­å…´ N909"></a>ä¸­å…´ N909</h3><p>è¿™æ¬¾æ‰‹æœºæ˜¯ç”µä¿¡å®šåˆ¶æœº (é‚£æ—¶å€™è¿˜æ²¡æœ‰å…¨ç½‘é€šè¿™ä¸ªæ¦‚å¿µ, ç”µä¿¡ç‰ˆä¸å…¼å®¹ç§»åŠ¨è”é€šç‰ˆæœ¬), è´­ä¹°äºä¸­å›½ç”µä¿¡å®˜ç½‘ï¼Œåˆ·äº† MIUI v5 ä½¿ç”¨ï¼Œè¿™ä¸ªæ—¶å€™çš„è¿è¥å•†åˆçº¦æœºé…ç½®è¿˜è¡Œï¼Œç³»ç»Ÿæ˜¯çœŸçš„å·®åŠ²ï¼Œå‡ ä¹å°±æ˜¯åŸç”Ÿçš„ Android(ä¸­å…´é¢„è£…äº† 3d è˜‘è‡å£çº¸ï¼Œåˆ’å±è˜‘è‡ä¼šè·Ÿç€è½¬)ï¼Œå¹¶ä¸”é¢„è£…äº†ä¸€å †è¿è¥å•†å®šåˆ¶è½¯ä»¶ï¼Œè¿˜ä¸èƒ½å¸è½½ã€‚æ‰‹æœºå†…å­˜ 1G</p><p>ç”µæ± ï¼š1800mAh<br>å±å¹•ï¼š4.5 è‹±å¯¸ 480Ã—854(FWVGA) åƒç´ <br>æ“ä½œç³»ç»Ÿï¼šAndroid 4.1<br>CPU å‹å·ï¼šé«˜é€š MSM8625Q å››æ ¸ 1228MHz<br>å†…å­˜ï¼š1GB + 4GB<br>æ‘„åƒå¤´ï¼š500 ä¸‡åƒç´  + 30 ä¸‡åƒç´ </p><div class="gallery-container" data-type="data" data-button="" data-limit="10" data-first="10">    <div class="gallery-items">[{"url":"https://static.zahui.fan/images/202311160027547.png","alt":"image.png","title":""},{"url":"https://static.zahui.fan/images/202311212353759.png","alt":"image.png","title":""},{"url":"https://static.zahui.fan/images/202311212353266.png","alt":"image.png","title":""},{"url":"https://static.zahui.fan/images/202311212354101.png","alt":"image.png","title":""},{"url":"https://static.zahui.fan/images/202311212352147.png","alt":"image.png","title":""}]</div>  </div><h3 id="è¯ºåŸºäºš-lumia-636"><a href="#è¯ºåŸºäºš-lumia-636" class="headerlink" title="è¯ºåŸºäºš lumia 636"></a>è¯ºåŸºäºš lumia 636</h3><p>è¿™æ˜¯ä¸€å° Windows Phone 8.1 æ‰‹æœº, è”é€š 4G(ç§»åŠ¨ 4G æ˜¯ Lumia 638), æ”¯æŒå°å¨œè¯­éŸ³åŠ©æ‰‹, å¯ä»¥é€šè¿‡è¯­éŸ³æ§åˆ¶å¾®ä¿¡å‘æ¶ˆæ¯ç­‰ (éœ€è¦æ›´æ–°å…¶ä»–åŒºåŸŸçš„å›ºä»¶). è¿™ä¸ªæ“ä½œä¹Ÿæ˜¯é¥é¥é¢†å…ˆå½“æ—¶çš„å…¶ä»–æ‰‹æœº, ä¸è¿‡æ­¤ç‰ˆæœ¬ç³»ç»Ÿç¨³å®šæ€§å ªå¿§, ä¼šä¸å®šæ—¶è‡ªåŠ¨é‡å¯, å¾®è½¯ä¹Ÿä¸è§£å†³ã€‚ä¸ºäº†ç¨³å®š, åªèƒ½ç”¨å›æ—§ç‰ˆæœ¬ç³»ç»Ÿ. wp ç±»ä¼¼ iosï¼Œæ”¯æŒæ¶ˆæ¯æ¨é€ï¼Œä¸è¿‡è½¯ä»¶åŠŸèƒ½ç¼ºå¤±ï¼Œåªèƒ½å‹‰å¼ºå®ç°åŸºæœ¬åŠŸèƒ½ã€‚<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202311242221057.png" alt="image.png|382"></p><h3 id="å¤©è¯­å¤§é»„èœ‚å°é»„èœ‚"><a href="#å¤©è¯­å¤§é»„èœ‚å°é»„èœ‚" class="headerlink" title="å¤©è¯­å¤§é»„èœ‚å°é»„èœ‚"></a>å¤©è¯­å¤§é»„èœ‚å°é»„èœ‚</h3><p>å¤©è¯­ k-touch å½“æ—¶ä¹Ÿå¾ˆç«, å¤§å°é»„èœ‚éƒ½æ˜¯é¢„å­˜è¯è´¹é€çš„, åˆ·æœºä¹Ÿå¾ˆ 6, å¯ä»¥åˆ· MIUI, å½“æ—¶ MIUI è¿˜æ˜¯å¼•é¢†æ½®æµçš„ã€‚å½“æ—¶é¢„è£…çš„æ˜¯ äº‘ OS<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202404122240898.png" alt="image.png"></p><h3 id="å°ç±³-2S"><a href="#å°ç±³-2S" class="headerlink" title="å°ç±³ 2S"></a>å°ç±³ 2S</h3><p>è¿™æ‰‹æœºå½“æ—¶æ˜¯éœ€è¦æŠ¢è´­çš„ï¼ˆé¥¥é¥¿è¥é”€ï¼‰ï¼Œå°ç±³ 2s ç¡®å®æ˜¯å°ç±³çš„ä¸€ä»£ç»å…¸æœºå™¨ã€‚é…ç½®é¡¶çº§ï¼Œå”®ä»· 1999ï¼ˆæˆ‘ä¹°çš„æ—¶å€™æ˜¯ 1299ï¼‰ï¼ŒMIUI v5 ä¹Ÿæ˜¯é¥é¥é¢†å…ˆåŒè¡Œã€‚<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202311242230287.png" alt="image.png|584"></p><h2 id="æ‰‹æœºç»å…¸æ¸¸æˆ"><a href="#æ‰‹æœºç»å…¸æ¸¸æˆ" class="headerlink" title="æ‰‹æœºç»å…¸æ¸¸æˆ"></a>æ‰‹æœºç»å…¸æ¸¸æˆ</h2><h4 id="è¯ºåŸºäºšè€æ¬¾æ‰‹æœº-ç©ºé—´å¤§æˆ˜"><a href="#è¯ºåŸºäºšè€æ¬¾æ‰‹æœº-ç©ºé—´å¤§æˆ˜" class="headerlink" title="è¯ºåŸºäºšè€æ¬¾æ‰‹æœº ç©ºé—´å¤§æˆ˜"></a>è¯ºåŸºäºšè€æ¬¾æ‰‹æœº ç©ºé—´å¤§æˆ˜</h4><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202310051648444.gif" alt="åŠ¨ç”».gif"></p><h4 id="è¯ºåŸºäºš-1600-å½©çƒæ»‘æ¢¯"><a href="#è¯ºåŸºäºš-1600-å½©çƒæ»‘æ¢¯" class="headerlink" title="è¯ºåŸºäºš 1600 å½©çƒæ»‘æ¢¯"></a>è¯ºåŸºäºš 1600 å½©çƒæ»‘æ¢¯</h4><p><a href="https://www.bilibili.com/video/BV1a84y1M7gn/?vd_source=48f94495443a524e8f8b6eaf47c94823">https://www.bilibili.com/video/BV1a84y1M7gn/?vd_source=48f94495443a524e8f8b6eaf47c94823</a></p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202311212324718.png" alt="image.png"><br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202311212326418.png" alt="image.png"></p><h4 id="è¯ºåŸºäºš-è´ªåƒè›‡"><a href="#è¯ºåŸºäºš-è´ªåƒè›‡" class="headerlink" title="è¯ºåŸºäºš è´ªåƒè›‡"></a>è¯ºåŸºäºš è´ªåƒè›‡</h4><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202311212327524.png" alt="image.png"></p><h3 id="java-å¹³å°-j2me"><a href="#java-å¹³å°-j2me" class="headerlink" title="java å¹³å° j2me"></a>java å¹³å° j2me</h3><p>è¿™ä¸ªå°±æ˜¯æ¯”è¾ƒæ­£ç»Ÿçš„éæ™ºèƒ½æœºä¸Šé¢çš„è½¯ä»¶å¹³å°äº†ï¼Œè½¯ä»¶çš„åç¼€æ˜¯ jar æˆ– jadï¼ˆç­¾åçš„ jarï¼‰ç­¾åç‰ˆä¸ä¼šæ¯æ¬¡éƒ½å¼¹å‡ºè”ç½‘çš„æç¤ºã€‚è¿™ä¸ªæ—¶å€™æ‰‹æœºæ™®éæ˜¯è¯ºåŸºäºšçš„ s40 å¹³å°ï¼ˆéæ™ºèƒ½å¹¶å…¼å®¹ javaï¼‰ï¼Œè¯ºåŸºäºšæ‰‹æœºå…¥é—¨æœºå™¨åˆ†è¾¨ç‡æ™®éä¸é«˜ï¼Œ176x208 è¿™ä¸ªæ ·å­å±…å¤šï¼Œé«˜ç«¯æœºå™¨æ˜¯ 240x320 åˆ†è¾¨ç‡ï¼Œå¸‚é¢ä¸Šçš„ java æ¸¸æˆå¤§æ¦‚éƒ½æ˜¯è¿™äº›åˆ†è¾¨ç‡ã€‚è¿™ä¸ªæ—¶å€™å¯ä»¥å®‰è£…å®˜æ–¹ç‰ˆæœ¬çš„æ‰‹æœº QQ å’Œ UC æµè§ˆå™¨äº†ã€‚ä½†æ˜¯ç¼ºç‚¹æ˜¯è½¯ä»¶ä¸æ”¯æŒåå°è¿è¡Œï¼ˆæ­¥æ­¥é«˜çš„å›½äº§æœºå¯ä»¥åå°è¿è¡Œä¸€ä¸ªè½¯ä»¶ï¼Œè¯ºåŸºäºšçš„éƒ½ä¸èƒ½åå°è¿è¡Œè½¯ä»¶ï¼‰</p><h3 id="s60v3"><a href="#s60v3" class="headerlink" title="s60v3"></a>s60v3</h3><p>è¿™ä¸ªæ˜¯ Symbian æ™ºèƒ½ç³»ç»Ÿäº†ï¼Œæ²¡å•¥å¥½è¯´çš„ï¼Œ ä¹Ÿå…¼å®¹ java è½¯ä»¶ï¼Œè½¯ä»¶åç¼€æ˜¯ sis å’Œ sisxï¼Œæ‰‹æœº qq å¯ä»¥åå°è¿è¡Œï¼Œå½“æ—¶è§‰å¾—æ¯”è¾ƒéœ‡æƒŠçš„è¿˜æœ‰æ‰‹æœºç‰ˆ 360 å®‰å…¨å«å£«ï¼Œæœ‰ä¸ªæµè§ˆæ‚¬æµ®çª—å¯ä»¥çœ‹åˆ°å®æ—¶çš„ç½‘é€Ÿã€‚</p><h4 id="çˆ±ä¸Šæ‰‹æœº-QQ"><a href="#çˆ±ä¸Šæ‰‹æœº-QQ" class="headerlink" title="çˆ±ä¸Šæ‰‹æœº QQ"></a>çˆ±ä¸Šæ‰‹æœº QQ</h4><div class="gallery-container" data-type="data" data-button="" data-limit="10" data-first="10">    <div class="gallery-items">[{"url":"https://static.zahui.fan/images/202311160024172.png","alt":"Screenshot_20231115-202451.png","title":""},{"url":"https://static.zahui.fan/images/202311160025084.png","alt":"Screenshot_20231115-202545.png","title":""}]</div>  </div><h4 id="UC-æµè§ˆå™¨"><a href="#UC-æµè§ˆå™¨" class="headerlink" title="UC æµè§ˆå™¨"></a>UC æµè§ˆå™¨</h4><div class="gallery-container" data-type="data" data-button="" data-limit="10" data-first="10">    <div class="gallery-items">[{"url":"https://static.zahui.fan/images/202311160025520.png","alt":"Screenshot_20231115-113906.png","title":""},{"url":"https://static.zahui.fan/images/202311160025985.png","alt":"Screenshot_20231115-114134.png","title":""}]</div>  </div><h4 id="é’»çŸ³ç‹‚æ½®"><a href="#é’»çŸ³ç‹‚æ½®" class="headerlink" title="é’»çŸ³ç‹‚æ½®"></a>é’»çŸ³ç‹‚æ½®</h4><p>gameloft çš„é’»çŸ³ç‹‚æ½®ï¼ˆæ®è¯´æ˜¯éƒ¨åˆ†è¯ºåŸºäºšæ‰‹æœºè‡ªå¸¦çš„æ¸¸æˆï¼‰</p><p>ç›Šæ™ºè§£å¯†ç±»æ¸¸æˆï¼Œæœ‰å¾ˆå¤šéšè—å…ƒç´ ï¼Œ å¯¹æ‰‹é€Ÿä¹Ÿæœ‰è¦æ±‚ã€‚<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202310071530545.png" alt="Screenshot_20231004-224318.png"></p><h4 id="åˆºå®¢"><a href="#åˆºå®¢" class="headerlink" title="åˆºå®¢"></a>åˆºå®¢</h4><p>ç››å¤©å ‚çš„åˆºå®¢ç³»åˆ—ï¼Œåˆºå®¢ä¹‹å…­å›½ç›¸å°ã€åˆºå®¢ä¹‹éª¨è‚‰åˆ†ç¦»</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202310071728548.png" alt="Screenshot_20231007-172451.png"></p><h4 id="å†›é­‚"><a href="#å†›é­‚" class="headerlink" title="å†›é­‚"></a>å†›é­‚</h4><p>åŒ—äº¬æ·é€šåå£°çš„å†›é­‚ç³»åˆ—ï¼Œå¦‚å†›é­‚ä¹‹äºŒæˆ˜é£äº‘, è¿™ä¸ªæ¸¸æˆçš„ç‰¹åˆ«ä¹‹å¤„åœ¨äºè·¯çº¿å¤šæ ·æ€§, æ¯”å¦‚æ¸¸æˆä¸­æœ‰æ­¥å…µ, å¦å…‹, èˆ¹, é£æœº, æ¯”å¦‚æ­¥å…µå’Œå¦å…‹ä¼šèµ°é™†åœ°, èˆ¹èµ°æ°´è·¯, é£æœºåœ¨ç©ºä¸­é£, è¿™å°±æœ‰ 3 æ¡è·¯çº¿äº†. åŒæ—¶æ­¦å™¨ä¹Ÿå…·æœ‰å¤šæ ·æ€§, æœºæªç¢‰å ¡æ‰“å°å…µæ¯”è¾ƒå¥½, ç‚®å°æ‰“å¦å…‹, æ‰“é£æœºå¿…é¡»ä½¿ç”¨é˜²ç©ºç‚®. å¦å¤–è¿˜æœ‰ä¸€ç§éšèº«å°å…µ, éœ€è¦å»ºé€ é›·è¾¾, åœ¨é›·è¾¾çš„èŒƒå›´å†…æ‰èƒ½å‘ç°.<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202310071530402.png" alt="java_20231004-193114.png"></p><h4 id="å–œç¾Šç¾Šå¤§æˆ˜è‘«èŠ¦å¨ƒ"><a href="#å–œç¾Šç¾Šå¤§æˆ˜è‘«èŠ¦å¨ƒ" class="headerlink" title="å–œç¾Šç¾Šå¤§æˆ˜è‘«èŠ¦å¨ƒ"></a>å–œç¾Šç¾Šå¤§æˆ˜è‘«èŠ¦å¨ƒ</h4><p>å–œç¾Šç¾Šå¤§æˆ˜è‘«èŠ¦å¨ƒ, ä¸€ä¸ªæ ¼æ–—æ¸¸æˆ</p><h4 id="åæç‚¸å¼¹äºº-é˜¿ç«¥æœ¨"><a href="#åæç‚¸å¼¹äºº-é˜¿ç«¥æœ¨" class="headerlink" title="åæç‚¸å¼¹äºº - é˜¿ç«¥æœ¨"></a>åæç‚¸å¼¹äºº - é˜¿ç«¥æœ¨</h4><p>ç±»ä¼¼äºç‚¸å¼¹äººçš„æ¸¸æˆï¼Œ å®ƒçš„ç‰¹ç‚¹æ˜¯é“å…·å¾ˆå¤šï¼Œ åœ°å½¢å¤æ‚ï¼Œæ¯”å¦‚æœ‰ä¸ªé‹å¯ä»¥æŠŠç‚¸å¼¹è¸¢èµ°ï¼Œ è¿˜å¯ä»¥éª‘æé¾™ã€‚<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202310131534813.png" alt="Screenshot_20231013-143221.png"></p><h4 id="æ¤ç‰©åƒµå°¸"><a href="#æ¤ç‰©åƒµå°¸" class="headerlink" title="æ¤ç‰©åƒµå°¸"></a>æ¤ç‰©åƒµå°¸</h4><p>æ²¡é”™ï¼Œ è¿™ä¸ªæ˜¯ java ç‰ˆçš„å±±å¯¨æ¤ç‰©å¤§æˆ˜åƒµå°¸ï¼Œè™½è¯´æ˜¯å±±å¯¨ï¼Œæ¸¸æˆè´¨é‡è¿˜æ˜¯å¯ä»¥çš„ã€‚æ¸¸æˆä¸­çš„åƒµå°¸è¢«æ›¿æ¢æˆäº†æ¸…æœåƒµå°¸ä¸€è·³ä¸€è·³çš„ï¼Œåˆ°æ¸¸æˆåæœŸï¼Œæœ‰çš‡åã€æˆ´å¸½å­çš„åƒµå°¸ã€çš‡ä¸Šç­‰ç­‰ï¼Œè¿™ä¸ªæ˜¯æˆ‘æœ€å¼€å§‹æ¥è§¦åˆ°çš„æ¤ç‰©å¤§æˆ˜åƒµå°¸ï¼Œä»¥è‡³äºåé¢ç©åˆ°äº†æ­£ç‰ˆçš„ï¼Œå½“æ—¶è¿˜è§‰å¾—æ˜¯ç›—ç‰ˆçš„ï¼Œå› ä¸ºåƒµå°¸å¤ªå†™å®äº†ã€‚ã€‚ã€‚</p><div class="gallery-container" data-type="data" data-button="" data-limit="10" data-first="10">    <div class="gallery-items">[{"url":"https://static.zahui.fan/images/202310242223023.png","alt":"Screenshot_20231024-220906.png","title":""},{"url":"https://static.zahui.fan/images/202310242226174.png","alt":"Screenshot_20231024-220925.png","title":""},{"url":"https://static.zahui.fan/images/202310242226041.png","alt":"Screenshot_20231024-221325.png","title":""},{"url":"https://static.zahui.fan/images/202310242226157.png","alt":"Screenshot_20231024-221321.png","title":""},{"url":"https://static.zahui.fan/images/202310242230103.png","alt":"Screenshot_20231024-221346.png","title":""}]</div>  </div><h2 id="æ‰‹æœºç³»ç»Ÿ-åˆ·æœº"><a href="#æ‰‹æœºç³»ç»Ÿ-åˆ·æœº" class="headerlink" title="æ‰‹æœºç³»ç»Ÿ &amp; åˆ·æœº"></a>æ‰‹æœºç³»ç»Ÿ &amp; åˆ·æœº</h2><h3 id="ä¸ºä»€ä¹ˆè¦åˆ·æœº"><a href="#ä¸ºä»€ä¹ˆè¦åˆ·æœº" class="headerlink" title="ä¸ºä»€ä¹ˆè¦åˆ·æœº"></a>ä¸ºä»€ä¹ˆè¦åˆ·æœº</h3><p>åˆ·æœºå°±æ˜¯ç»™æ‰‹æœºæ¢ä¸€ä¸ªæ“ä½œç³»ç»Ÿï¼Œè‡³äºä¸ºä»€ä¹ˆè¦æ¢ï¼Œç»™æ²¡ç»å†è¿‡çš„å°æœ‹å‹è¯´æ˜ä¸€ä¸‹ï¼Œä¸¾ä¸ªä¾‹å­ï¼šä¸­å…´ v880 æ‰‹æœºçš„å®˜æ–¹å®šä»·æ˜¯ 1499 å…ƒï¼Œä½†æ˜¯å¤§éƒ¨åˆ†äººæ‹¿åˆ°è¿™å°æ‰‹æœºçš„èŠ±è´¹æ˜¯ 0 å…ƒï¼Œä¹Ÿå°±æ˜¯è¿è¥å•†åˆçº¦æœºï¼Œæ¯”å¦‚ä½ åŠä¸€å¼ æ–°å¡ï¼Œæœˆç§Ÿ 39&#x2F;æœˆï¼Œç»‘å®š 1 å¹´ä¸èƒ½æ›´æ¢å¥—é¤ï¼Œæ‰‹æœºå°±å…è´¹é€ä½ äº†ï¼ˆä¹Ÿå°±æ˜¯å……è¯è´¹é€çš„æ‰‹æœºï¼‰ï¼Œè¿™ä¸ªæ‰‹æœºæ˜¯åŸç”Ÿå®‰å“ 2.x ç³»ç»Ÿï¼Œå‡ ä¹æ²¡æœ‰ä»»ä½•å‚å•†çš„ä¼˜åŒ–ï¼Œé¢„è£…äº†è¶…çº§å¤šçš„è¿è¥å•† APPï¼ˆä¸”éƒ½æ˜¯ä¸èƒ½å¸è½½çš„ï¼Œå½“æ—¶è¿˜æ²¡æœ‰é¢„è£…è½¯ä»¶ç›¸å…³çš„æ³•å¾‹æ³•è§„ï¼‰ï¼Œæƒ³å¸è½½å°±åªèƒ½ root æˆ–è€…åˆ·æœºæˆ MIUIã€Flyme ç­‰å…¶ä»–å¥½ç”¨çš„ç³»ç»Ÿã€‚</p><div class="gallery-container" data-type="data" data-button="" data-limit="10" data-first="10">    <div class="gallery-items">[{"url":"https://static.zahui.fan/images/202404122252023.png","alt":"image.png","title":""},{"url":"https://static.zahui.fan/images/202404122246899.png","alt":"image.png","title":""},{"url":"https://static.zahui.fan/images/202404122232205.png","alt":"image.png|677","title":""}]</div>  </div><h3 id="å†’æ³¡æ¸¸æˆå¹³å°"><a href="#å†’æ³¡æ¸¸æˆå¹³å°" class="headerlink" title="å†’æ³¡æ¸¸æˆå¹³å°"></a>å†’æ³¡æ¸¸æˆå¹³å°</h3><p>å‚è€ƒçŸ¥ä¹ç”¨æˆ·çš„å›ç­”ï¼š<a href="https://www.zhihu.com/question/24946202">https://www.zhihu.com/question/24946202</a></p><p>æƒ³è¦ä½“éªŒï¼Œå¯ä»¥å®‰è£… iacMrp-Mrp å†’æ³¡æ¨¡æ‹Ÿå™¨ï¼Œ æˆ–è€…ç›´æ¥åœ¨çº¿æ¸¸ç©<a href="https://vmrp.github.io/">https://vmrp.github.io/</a>ï¼Œæˆ–è€…ï¼š<a href="https://zengming00.github.io/">https://zengming00.github.io/</a> å¼€æºä½œè€…ï¼š<a href="https://github.com/vmrp">https://github.com/vmrp</a></p><p>ç©æ¸¸æˆ æˆ‘è¦å†’æ³¡ï¼</p><p>åœ¨æ™ºèƒ½æœºä¹‹å‰çš„åŠŸèƒ½æœºæ—¶ä»£ï¼Œæ­£è§„å†›æœ‰è¯ºåŸºäºšã€æ‘©æ‰˜ç½—æ‹‰ã€ç´¢å°¼çˆ±ç«‹ä¿¡ç­‰ï¼Œå®ƒä»¬æ”¯æŒ j2me ä¹Ÿå°±æ˜¯ java å¹³å°ï¼Œè½¯ä»¶æ•°é‡è‡ªç„¶ä¸ç”¨è¯´ï¼Œé‚£ä¹ˆè¿˜æœ‰ä¸€æ‰¹å±±å¯¨æœºï¼Œå®ƒä»¬ä»·æ ¼ä¾¿å®œã€ç”µæ± å¤§ã€å£°éŸ³å¤§ã€åŒå¡åŒå¾…ï¼ˆç”šè‡³ 4 å¡ 4 å¾…ï¼‰ä¸€æ‰¹å›½å†…å›¢é˜Ÿå¼€å§‹ä¸ºå±±å¯¨æœºæ‰“é€ å„ç§ä¸“ç”¨è½¯ä»¶å’Œæ¸¸æˆå¹³å°ï¼Œæ¯”å¦‚æ­å·æ–¯å‡¯çš„ MRP å¹³å°ã€è‡³å°Šå® meg å¹³å°ã€æ‚ ç±³ jraã€è‰¾å iava å¹³å°ã€é›ªé²¤é±¼ APP å¹³å°ï¼Œæ²ƒå‹¤å¹³å°ï¼Œä¸Šæµ·é…·å§å¹³å°ï¼Œä¸€æ—¶é—´å›½äº§æ‰‹æœºè½¯ä»¶å¹³å°å¦‚é›¨åæ˜¥ç¬‹ï¼Œç™¾èŠ±é½æ”¾ç™¾å®¶äº‰é¸£ï¼Œå…¶ä¸­æœ€è‘—åçš„å°±æ˜¯ MRP æ¸¸æˆå’Œå†’æ³¡ç¤¾åŒº MRP æ˜¯æ­å·æ–¯å‡¯ç½‘ç»œç§‘æŠ€å…¬å¸è‡ªä¸»ç ”å‘çš„ä¸“ç”¨è½¯ä»¶æ ¼å¼ï¼Œæ˜¯ä¸€ç§è½»é‡çº§çš„è™šæ‹Ÿå¹³å° MINIJ å¹³å°æ ¼å¼æ–‡ä»¶ï¼Œç”¨æ ‡å‡†çš„ ANSI C ç¼–å†™ã€‚å¯ä»¥è¯´å®ƒæ˜¯å›½äº§æœºä¸“ç”¨æ¸¸æˆæ ¼å¼ï¼Œæ¯” Java ç¨‹åºå®¹é‡å°ï¼Œå æ®æ›´å°‘çš„ç³»ç»Ÿå†…å­˜ï¼Œå¯ä»¥åœ¨æ¶åŠ£çš„ç¡¬ä»¶æ¡ä»¶ä¸‹æµç•…è¿è¡Œå„ç§ç¨‹åºï¼Œè¿™ä¸€ç‚¹éå¸¸é€‚åˆåŒ…æ‹¬å›½äº§çš„è´´ç‰Œã€æ‚ç‰ŒåŠæ•°é‡æå…¶åºå¤§çš„å…¶å®ƒå±±å¯¨æœºã€‚è¿™ä¸ªå…¬å¸è¿˜ä¸“é—¨æäº†ä¸ªåº”ç”¨å¹³å°ï¼Œå«åšå†’æ³¡ç¤¾åŒºï¼Œåœ¨å½“å¹´çš„å±±å¯¨æœºä¸Šä½ åªè¦åœ¨å¾…æœºç•Œé¢è¾“å…¥ä¸€ä¸²ç¥ç§˜ä»£ç ï¼š <code>*#220807#</code> ï¼Œä½ å°±èƒ½æ‰“å¼€ä¸€æ‰‡æ–°ä¸–ç•Œçš„å¤§é—¨ï¼Œè¿›å…¥ä¸€ä¸ªå ªç§°å±±å¯¨æœºä¹å›­çš„ä¸–ç•Œï¼Œé‡Œé¢æœ‰æ¸¸æˆã€å°è¯´ã€å„ç§ç¨‹åºï¼Œè¿˜æœ‰å„ç§ä½ æ„æƒ³ä¸åˆ°çš„ä¸œè¥¿é™¤äº†åƒå†’æ³¡æµè§ˆå™¨ã€å†’æ³¡ä¹¦åŸã€å†’æ³¡éŸ³ä¹æ’­æ”¾å™¨è¿™æ ·çš„åŸºç¡€åº”ç”¨å¤–ï¼Œè½¯ä»¶å•†åŸé‡Œçš„å„ç±»æ¸¸æˆæ˜¯å€¼å¾—å¤§ä¹¦ç‰¹ä¹¦çš„ï¼Œé‡Œé¢çš„æ¸¸æˆå…¨éƒ¨æ˜¯å›½äº§ï¼Œåˆ¶ä½œå…¬å¸é™¤äº†æ–¯å‡¯æœ¬å®¶ä¹‹å¤–ï¼Œè¿˜å¸å¼•äº†ä¹å ‚åŠ¨æ¼«ã€ç¾æ¸¸ã€é™†è¡Œé²¨ã€åå¨±æ— çº¿ã€FASTã€å¤§è¿æ–¯èŠ¬å…‹æ–¯ç­‰ä¼˜ç§€æ¸¸æˆåˆ¶ä½œå…¬å¸ï¼Œæ¨å‡ºäº†åŒ…æ‹¬è¡—æœºé£åŠ¨ä½œæ¸¸æˆã€é£è¡Œå°„å‡»ã€RPGã€å³æ—¶æˆ˜ç•¥ã€ç­–ç•¥ã€ç«é€Ÿç­‰å‡ ä¹å›Šæ‹¬äº†æ¸¸æˆçš„å…¨éƒ¨ç±»å‹ï¼Œå½“ç„¶ï¼Œè¿™äº›æ¸¸æˆä¸ä»…è¦ä»˜è´¹ä¸‹è½½ï¼Œé‡Œé¢è¿˜æœ‰æ°ªé‡‘é€‰é¡¹ï¼Œå¯ä»¥è¯´æ˜¯ä¸€ä¸¾å¥ å®šäº†ä¸­å›½æ‰‹æœºæ¸¸æˆçš„ç›ˆåˆ©æ¨¡å¼ï¼Œå½±å“è‡³ä»Šéšç€ç ´è§£æ‰‹æ®µçš„å¢å¤šï¼Œå†’æ³¡ç¤¾åŒºå¼€å§‹å¾€æ‰‹æœºç½‘æ¸¸æ–¹å‘å‘å±•ï¼Œå›¾å½¢æ‰‹æœºç½‘æ¸¸å“¦ï¼Œå½“å¹´æ–‡å­—ç½‘æ¸¸å¤§è¡Œå…¶é“çš„æ—¶å€™ï¼Œæ¨å‡ºå…¨éƒ¨å›¾å½¢åœ¨çº¿ç½‘æ¸¸ï¼Œé­„åŠ›ç›¸å½“å¤§ï¼Œå…¶ä¸­ä¼˜ç§€ä»£è¡¨æ˜¯å¹»æƒ³ä¸‰å›½ã€ä»™å‰‘é—®æƒ…ï¼Œè‡³ä»Šè®©æœ‰æ— æ•°ç©å®¶åšå®ˆã€æ— æ•°ç©å®¶å›å¿†ã€‚</p><div class="gallery-container" data-type="data" data-button="" data-limit="10" data-first="10">    <div class="gallery-items">[{"url":"https://static.zahui.fan/images/202311212309263.png","alt":"image.png","title":""},{"url":"https://static.zahui.fan/images/202311212309891.png","alt":"image.png","title":""},{"url":"https://static.zahui.fan/images/202311212254207.png","alt":"image.png","title":""},{"url":"https://static.zahui.fan/images/202310051534088.png","alt":"image.png","title":""},{"url":"https://static.zahui.fan/images/202310051534381.png","alt":"image.png","title":""}]</div>  </div><h3 id="MIUI"><a href="#MIUI" class="headerlink" title="MIUI"></a>MIUI</h3><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202404122235311.png" alt="image.png|557"></p><p>å•¥éƒ½ä¸è¯´äº†ï¼Œçœ‹å›¾å§</p><div class="gallery-container" data-type="data" data-button="" data-limit="10" data-first="10">    <div class="gallery-items">[{"url":"https://static.zahui.fan/images/202311242248301.png","alt":"image.png|326","title":""},{"url":"https://static.zahui.fan/images/202311242248592.png","alt":"image.png|329","title":""},{"url":"https://static.zahui.fan/images/202311242248038.png","alt":"image.png|358","title":""},{"url":"https://static.zahui.fan/images/202311242249054.png","alt":"image.png|361","title":""},{"url":"https://static.zahui.fan/images/202311242252126.png","alt":"image.png|378","title":""},{"url":"https://static.zahui.fan/images/202311242252042.png","alt":"image.png|691","title":""},{"url":"https://static.zahui.fan/images/202311242253845.png","alt":"image.png|693","title":""},{"url":"https://static.zahui.fan/images/202311242253052.png","alt":"image.png|457","title":""},{"url":"https://static.zahui.fan/images/202311242254984.png","alt":"image.png|746","title":""},{"url":"https://static.zahui.fan/images/202311242255232.png","alt":"image.png|402","title":""}]</div>  </div><h3 id="ä¹è›™"><a href="#ä¹è›™" class="headerlink" title="ä¹è›™"></a>ä¹è›™</h3><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202404122236978.png" alt="image.png|516"></p><h3 id="CyanogenMod-å’Œ-Lineage-OS"><a href="#CyanogenMod-å’Œ-Lineage-OS" class="headerlink" title="CyanogenMod å’Œ Lineage OS"></a>CyanogenMod å’Œ Lineage OS</h3><div class="gallery-container" data-type="data" data-button="" data-limit="10" data-first="10">    <div class="gallery-items">[{"url":"https://static.zahui.fan/images/202404122234154.png","alt":"image.png|525","title":""},{"url":"https://static.zahui.fan/images/202404122236329.png","alt":"image.png|471","title":""}]</div>  </div><h3 id="é­”è¶£-Mokee"><a href="#é­”è¶£-Mokee" class="headerlink" title="é­”è¶£ Mokee"></a>é­”è¶£ Mokee</h3><div class="gallery-container" data-type="data" data-button="" data-limit="10" data-first="10">    <div class="gallery-items">[{"url":"https://static.zahui.fan/images/202404122235421.png","alt":"image.png|550","title":""},{"url":"https://static.zahui.fan/images/202404122231358.png","alt":"image.png|545","title":""}]</div>  </div><h3 id="äº‘-OS-ï¼ˆé˜¿é‡Œï¼‰"><a href="#äº‘-OS-ï¼ˆé˜¿é‡Œï¼‰" class="headerlink" title="äº‘ OS ï¼ˆé˜¿é‡Œï¼‰"></a>äº‘ OS ï¼ˆé˜¿é‡Œï¼‰</h3><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202404122237448.png" alt="image.png"></p><p>é­…æ— MX4 å°±æœ‰å®‰å“ç‰ˆå’Œäº‘ OS ç‰ˆ<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202404122239585.png" alt="image.png"></p><h3 id="ç™¾åº¦äº‘-OS"><a href="#ç™¾åº¦äº‘-OS" class="headerlink" title="ç™¾åº¦äº‘ OS"></a>ç™¾åº¦äº‘ OS</h3><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202404122238942.png" alt="image.png"></p><p>ç™¾åº¦è¿˜æ”¶è´­äº†ç‚¹å¿ƒ OS</p><h3 id="è…¾è®¯-tita-æˆ–è€…-TOS"><a href="#è…¾è®¯-tita-æˆ–è€…-TOS" class="headerlink" title="è…¾è®¯ tita æˆ–è€… TOS"></a>è…¾è®¯ tita æˆ–è€… TOS</h3><p>æ²¡ç”¨è¿‡ã€‚ã€‚é€‚é…çš„æœºå™¨æ¯”è¾ƒå°‘</p><h3 id="å®‰å“"><a href="#å®‰å“" class="headerlink" title="å®‰å“"></a>å®‰å“</h3><p>é«˜ä¸­ 3 å¹´æ²¡è§è¿‡å®‰å“, å¤è¯»ç­åŒå­¦æœ‰å®‰å“æœºäº†, ä¸€ä¸ª sharp å½“æ—¶è§‰å¾—å¾ˆæƒŠè‰³. ç©é›·éœ†èµ›è½¦å¯ä»¥ä½¿ç”¨é‡åŠ›æ„Ÿåº”æ¥æ§åˆ¶è½¦è¾†è½¬å¼¯ã€‚</p><p>å¤§å­¦ä¸€ä¸ªå®¿èˆ, 5 ä¸ªéæ™ºèƒ½æ‰‹æœº, ä¸€å° oppo çš„æ™ºèƒ½æœºï¼Œè¿‡äº†åŠå¹´ï¼Œéƒ½æ¢æˆäº†æ™ºèƒ½æœº</p><h3 id="IOS-5-IOS-6"><a href="#IOS-5-IOS-6" class="headerlink" title="IOS 5 &amp; IOS 6"></a>IOS 5 &amp; IOS 6</h3><p>ç¬¬ä¸€æ¬¡è§ ios6 æ˜¯åœ¨åŒå­¦çš„ <code>iPhone 5</code> ä¸Šé¢çš„ï¼Œé»‘è‰² <code>iPhone 5</code> é…ä¸Šæ‹Ÿç‰©åŒ–ç•Œé¢ï¼Œéå¸¸æ¼‚äº®ã€‚</p><div class="gallery-container" data-type="data" data-button="" data-limit="10" data-first="10">    <div class="gallery-items">[{"url":"https://static.zahui.fan/images/202406082220437.jpg","alt":"10001 (1).jpg|533","title":""},{"url":"https://static.zahui.fan/images/202406082221158.jpg","alt":"10001 (2).jpg|530","title":""},{"url":"https://static.zahui.fan/images/202406082221594.jpg","alt":"10001 (3).jpg|599","title":""},{"url":"https://static.zahui.fan/images/202406082221666.jpg","alt":"10001.jpg|604","title":""},{"url":"https://static.zahui.fan/images/202406080907985.PNG","alt":"","title":""},{"url":"https://static.zahui.fan/images/202406080908491.JPG","alt":"202406080908491.JPG|474","title":""},{"url":"https://static.zahui.fan/images/202406080908363.JPG","alt":"202406080908363.JPG|522","title":""},{"url":"https://static.zahui.fan/images/202406200002342.jpg","alt":"","title":""},{"url":"https://static.zahui.fan/images/202406200003461.webp","alt":"10073.webp","title":""},{"url":"https://static.zahui.fan/images/202406200004119.png","alt":"10025.png","title":""},{"url":"https://static.zahui.fan/images/202406200004958.png","alt":"10027.png","title":""},{"url":"https://static.zahui.fan/images/202406200004140.png","alt":"10029.png","title":""},{"url":"https://static.zahui.fan/images/202406200006910.png","alt":"10085.png","title":""},{"url":"https://static.zahui.fan/images/202406200007027.png","alt":"10148.png","title":""},{"url":"https://static.zahui.fan/images/202406200007634.webp","alt":"10147.webp","title":""},{"url":"https://static.zahui.fan/images/202406200007238.png","alt":"10149.png","title":""},{"url":"https://static.zahui.fan/images/202406200008719.png","alt":"10152.png","title":""},{"url":"https://static.zahui.fan/images/202406200008634.webp","alt":"10151.webp","title":""},{"url":"https://static.zahui.fan/images/202406200008544.webp","alt":"10157.webp","title":""}]</div>  </div><h2 id="å…¶ä»–å°ç‰©ä»¶"><a href="#å…¶ä»–å°ç‰©ä»¶" class="headerlink" title="å…¶ä»–å°ç‰©ä»¶"></a>å…¶ä»–å°ç‰©ä»¶</h2><h3 id="çº¢ç¯æ”¶éŸ³æœº"><a href="#çº¢ç¯æ”¶éŸ³æœº" class="headerlink" title="çº¢ç¯æ”¶éŸ³æœº"></a>çº¢ç¯æ”¶éŸ³æœº</h3><p>çˆ·çˆ·å¬äº†ä¸€è¾ˆå­çš„æ”¶éŸ³æœºï¼Œåªåœç•™åœ¨ä¸€ä¸ªå°ä¸Šï¼Œæ¥ä¸‹æ¥æ˜¯æ–°é—»å’ŒæŠ¥çº¸æ‘˜è¦æ—¶é—´~<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202312011724446.png" alt="image.png"></p><h3 id="æ‰‹æœºæ¥ç”µé—ª"><a href="#æ‰‹æœºæ¥ç”µé—ª" class="headerlink" title="æ‰‹æœºæ¥ç”µé—ª"></a>æ‰‹æœºæ¥ç”µé—ª</h3><p>æ¥ç”µé—ªç¯é™¤äº†å¥½çœ‹ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸ªç”¨å¤„ï¼Œå°±æ˜¯åˆ¤æ–­ç½‘é€Ÿæƒ…å†µï¼ˆéæ™ºèƒ½æ‰‹æœºæ˜¯æ²¡æœ‰è½¯ä»¶æ”¯æŒæ‚¬æµ®çª—çš„ï¼Œä¸èƒ½åƒå¡ç­è£…ä¸ª 360 å°±å¯ä»¥æ˜¾ç¤ºæµé‡æ‚¬æµ®çª—ï¼ŒçŸ¥é“ç½‘é¡µèƒ½ä¸èƒ½æ‰“å¼€ï¼‰ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œå…ˆæ‰“å¼€ä¸ªç½‘é¡µï¼Œç„¶åç¿»è¿‡æ‰‹æœºçœ‹å®ƒé—ªå¾—å‰å®³ä¸ï¼Œå¦‚æœé—ªç€é—ªç€ä¸é—ªäº†ï¼Œè€Œç½‘é¡µè¿˜åœ¨åŠ è½½ï¼Œé‚£ä¹ˆå¤§æ¦‚ç‡ä¸€æ—¶åŠä¼šæ˜¯åŠ è½½ä¸å‡ºæ¥äº†ï¼Œå°±å–æ¶ˆç„¶åé‡æ–°ç‚¹å‡»ğŸ˜„</p><h3 id="ä¸‡èƒ½å……"><a href="#ä¸‡èƒ½å……" class="headerlink" title="ä¸‡èƒ½å……"></a>ä¸‡èƒ½å……</h3><div class="gallery-container" data-type="data" data-button="" data-limit="10" data-first="10">    <div class="gallery-items">[{"url":"https://static.zahui.fan/images/202404250117867.JPEG","alt":"IMG_0759.JPG_compressed.JPEG|314","title":""},{"url":"https://static.zahui.fan/images/202404250117868.JPEG","alt":"IMG_0759.JPG_compressed.JPEG|322","title":""}]</div>  </div><h3 id="å¤§å¤´è´´"><a href="#å¤§å¤´è´´" class="headerlink" title="å¤§å¤´è´´"></a>å¤§å¤´è´´</h3><p>åœ¨æœºå™¨ä¸Šæ‹ç…§åä¼šåƒæ‹ç«‹å¾—ä¸€æ ·å‡ºæ¥ï¼Œç„¶åå¯ä»¥è´´åœ¨æ‰‹æœºã€ä¹¦ä¸Šç­‰ï¼Œå›¾ç‰‡æœé›†è‡ªç½‘ç»œ<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202407311820527.png" alt="image.png"></p>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è®°å½• </tag>
            
            <tag> æ¸¸æˆ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ‰¾å‡ºå ç”¨KubernetesèŠ‚ç‚¹ç£ç›˜çš„Pod</title>
      <link href="/posts/lo47lj11/"/>
      <url>/posts/lo47lj11/</url>
      
        <content type="html"><![CDATA[<p>æœ‰éƒ¨åˆ†å¼€å‘ä¸è§„èŒƒå¯¼è‡´æ—¥å¿—å†™å…¥å®¹å™¨, åœ¨ k8s ç¯å¢ƒä¸‹å¯¼è‡´èŠ‚ç‚¹ç£ç›˜ç©ºé—´å ç”¨è¿‡é«˜, è§£å†³æ–¹æ¡ˆæœ‰:</p><ol><li>é€šè¿‡ç›‘æ§å‘Šè­¦æ¥æå‰é¢„é˜²</li><li>æŒ‚è½½ç£ç›˜, å®¹å™¨æ—¥å¿—å†™å…¥ç£ç›˜</li><li>ä½¿ç”¨è‡ªåŠ¨æ¸…ç†è„šæœ¬</li></ol><h2 id="kubectl-æŸ¥è¯¢æ¯ä¸ª-pod-å ç”¨ç£ç›˜ç©ºé—´"><a href="#kubectl-æŸ¥è¯¢æ¯ä¸ª-pod-å ç”¨ç£ç›˜ç©ºé—´" class="headerlink" title="kubectl æŸ¥è¯¢æ¯ä¸ª pod å ç”¨ç£ç›˜ç©ºé—´"></a>kubectl æŸ¥è¯¢æ¯ä¸ª pod å ç”¨ç£ç›˜ç©ºé—´</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get --raw /api/v1/nodes/10.20.20.12/proxy/stats/summary | jq <span class="string">&#x27;.pods[] | &quot;PodName:  \(.podRef.name)&quot;, &quot;usedBytes:   \(.containers[].rootfs.usedBytes)&quot;, &quot;======================================================&quot;&#x27;</span></span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚å›¾:<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202310241858426.png" alt="image.png"></p><h2 id="Docker-ç›¸å…³æ“ä½œ"><a href="#Docker-ç›¸å…³æ“ä½œ" class="headerlink" title="Docker ç›¸å…³æ“ä½œ"></a>Docker ç›¸å…³æ“ä½œ</h2><h3 id="æŸ¥çœ‹å®¹å™¨ç£ç›˜å ç”¨"><a href="#æŸ¥çœ‹å®¹å™¨ç£ç›˜å ç”¨" class="headerlink" title="æŸ¥çœ‹å®¹å™¨ç£ç›˜å ç”¨"></a>æŸ¥çœ‹å®¹å™¨ç£ç›˜å ç”¨</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># èŠ‚ç‚¹ä¸ŠæŸ¥çœ‹ç£ç›˜ä½¿ç”¨æƒ…å†µ,å¹¶å®‰è£…ä»å¤§åˆ°å°æ’åº,å¯ä»¥çœ‹åˆ°å„ä¸ªå®¹å™¨çš„å ç”¨ç£ç›˜ç©ºé—´ã€‚</span></span><br><span class="line">docker ps -a --format <span class="string">&quot;table &#123;&#123;.Size&#125;&#125;\t&#123;&#123;.Names&#125;&#125;&quot;</span> | <span class="built_in">sort</span> -hr</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ç£ç›˜æ€»ä½“ä½¿ç”¨æƒ…å†µ</span></span><br><span class="line">docker system <span class="built_in">df</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å®¹å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Kubernetes </tag>
            
            <tag> k8s </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxé‡Œå®‰è£…crontabå¹¶è¿è¡Œ</title>
      <link href="/posts/lnmt2t0q/"/>
      <url>/posts/lnmt2t0q/</url>
      
        <content type="html"><![CDATA[<p>å¸¸è§çš„ linux å‘è¡Œç‰ˆéƒ½è‡ªå¸¦äº† crontab æœåŠ¡, ä½†æ˜¯æˆ‘ä»¬å¸¸ç”¨çš„å®¹å™¨é•œåƒæ˜¯æ²¡æœ‰çš„, ä¸è¦é—®æˆ‘ä¸ºä»€ä¹ˆè¦åœ¨å®¹å™¨é‡Œè¿è¡Œ crontabâ€¦<br><a href="/posts/2de1df7e/">Linuxå®šæ—¶æ‰§è¡Œä»»åŠ¡crontab</a><br><a href="/posts/63d10d9c/">Linuxçš„crontabæ— æ³•æ‰§è¡Œçš„ä¸€äº›é—®é¢˜</a></p><h2 id="CentOS-RedHat-ç³»åˆ—"><a href="#CentOS-RedHat-ç³»åˆ—" class="headerlink" title="CentOS&#x2F;RedHat ç³»åˆ—"></a>CentOS&#x2F;RedHat ç³»åˆ—</h2><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y cronie</span><br></pre></td></tr></table></figure><h3 id="é…ç½®æ–‡ä»¶ä½ç½®"><a href="#é…ç½®æ–‡ä»¶ä½ç½®" class="headerlink" title="é…ç½®æ–‡ä»¶ä½ç½®"></a>é…ç½®æ–‡ä»¶ä½ç½®</h3><p>åé¢çš„ root æ˜¯ç”¨æˆ·å</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/var/spool/cron/root</span><br></pre></td></tr></table></figure><h3 id="å¯åŠ¨å‘½ä»¤"><a href="#å¯åŠ¨å‘½ä»¤" class="headerlink" title="å¯åŠ¨å‘½ä»¤"></a>å¯åŠ¨å‘½ä»¤</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åå°è¿è¡Œ</span></span><br><span class="line">crond</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‰å°è¿è¡Œ</span></span><br><span class="line">crond -f </span><br></pre></td></tr></table></figure><h2 id="Ubuntu-Debian-ç³»åˆ—"><a href="#Ubuntu-Debian-ç³»åˆ—" class="headerlink" title="Ubuntu&#x2F;Debian ç³»åˆ—"></a>Ubuntu&#x2F;Debian ç³»åˆ—</h2><h3 id="å®‰è£…-1"><a href="#å®‰è£…-1" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install -y cron</span><br></pre></td></tr></table></figure><h3 id="é…ç½®æ–‡ä»¶ä½ç½®-1"><a href="#é…ç½®æ–‡ä»¶ä½ç½®-1" class="headerlink" title="é…ç½®æ–‡ä»¶ä½ç½®"></a>é…ç½®æ–‡ä»¶ä½ç½®</h3><p>åé¢çš„ root æ˜¯ç”¨æˆ·å</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/var/spool/cron/crontabs/root</span><br></pre></td></tr></table></figure><h3 id="å¯åŠ¨å‘½ä»¤-1"><a href="#å¯åŠ¨å‘½ä»¤-1" class="headerlink" title="å¯åŠ¨å‘½ä»¤"></a>å¯åŠ¨å‘½ä»¤</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åå°è¿è¡Œ</span></span><br><span class="line">cron</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‰å°è¿è¡Œ</span></span><br><span class="line">cron -f</span><br></pre></td></tr></table></figure><h2 id="Alpine"><a href="#Alpine" class="headerlink" title="Alpine"></a>Alpine</h2><h3 id="å®‰è£…-2"><a href="#å®‰è£…-2" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><p>å®˜æ–¹é•œåƒè‡ªå¸¦äº†</p><h3 id="é…ç½®æ–‡ä»¶ä½ç½®-2"><a href="#é…ç½®æ–‡ä»¶ä½ç½®-2" class="headerlink" title="é…ç½®æ–‡ä»¶ä½ç½®"></a>é…ç½®æ–‡ä»¶ä½ç½®</h3><p>åé¢çš„ root æ˜¯ç”¨æˆ·å</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/crontabs/root</span><br></pre></td></tr></table></figure><h3 id="å¯åŠ¨å‘½ä»¤-2"><a href="#å¯åŠ¨å‘½ä»¤-2" class="headerlink" title="å¯åŠ¨å‘½ä»¤"></a>å¯åŠ¨å‘½ä»¤</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‰å°è¿è¡Œ</span></span><br><span class="line">crond -f</span><br><span class="line"></span><br><span class="line"><span class="comment"># åå°è¿è¡Œ</span></span><br><span class="line">crond</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
            <tag> Crontab </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è‡ªåŠ¨æ¸…ç†æ—¥å¿—è„šæœ¬</title>
      <link href="/posts/lnd7yqpw/"/>
      <url>/posts/lnd7yqpw/</url>
      
        <content type="html"><![CDATA[<p>å…¬å¸çš„ä¸šåŠ¡æœåŠ¡ä¼šæ‰“æ—¥å¿—åˆ°ç£ç›˜, ç¨‹åºå·²ç»åšäº†æ—¥å¿—åˆ‡å‰², æ—¶é—´ä¸€é•¿ç£ç›˜å æ»¡ä¼šå¯¼è‡´ä¸šåŠ¡å¼‚å¸¸, æ™®é€šçš„æ¸…ç†é€»è¾‘æ˜¯ä½¿ç”¨ crontab å®šæ—¶åˆ é™¤æ–‡ä»¶, æ¯”å¦‚æ¯å¤© 1 ç‚¹åˆ é™¤åˆ›å»ºæ—¥æœŸè¶…è¿‡ 30 å¤©çš„æ—¥å¿—æ–‡ä»¶, å¤§éƒ¨åˆ†æƒ…å†µä¸‹å·¥ä½œæ˜¯ OK çš„, ä½†æ˜¯æ‰§è¡Œå‘¨æœŸå¤ªé•¿, å¦‚æœå½“å¤©æ—¥å¿—æš´å¢, ä¸èƒ½åŠæ—¶åˆ é™¤æ–‡ä»¶. ä¹Ÿä¼šæœ‰éšæ‚£, ä¼˜åŒ–ç‰ˆè„šæœ¬å¦‚ä¸‹:</p><p>æ—¥å¿—æ¸…ç†åˆ†ä»¥ä¸‹å‡ ç§:</p><ol><li>å†å²æ—¥å¿—, å¹¶ä¸”æœªåœ¨å†™å…¥çš„æ—¥å¿—, è¿™ç§å¯ä»¥ç›´æ¥åˆ é™¤æ‰.</li><li>å½“å‰æ­£åœ¨å†™å…¥çš„æ—¥å¿—, éœ€è¦æ¸…ç†, è¿™ç§ä¸èƒ½åˆ é™¤, å¯ä»¥é€šè¿‡æ¸…ç©ºæ–‡ä»¶çš„æ–¹å¼æ¥é‡Šæ”¾ç©ºé—´</li></ol><blockquote><p>set -euo pipefail çš„ä½œç”¨:<br>set -e: è„šæœ¬ä¸­æœ‰ä»»ä½•ä¸€æ¡å‘½ä»¤æ‰§è¡Œå¤±è´¥, æ•´ä¸ªè„šæœ¬å°±å¤±è´¥<br>set -u: è„šæœ¬ä¸­çš„å˜é‡æœ‰ä»»ä½•ä¸€ä¸ªå˜é‡ä¸ºç©º, æ•´ä¸ªè„šæœ¬æ‰§è¡Œå¤±è´¥<br>-o pipefail: è„šæœ¬ä¸­çš„ç®¡é“ä¸­ä»»ä½•ä¸€æ¡å‘½ä»¤æ‰§è¡Œå¤±è´¥, ä¹Ÿä¼šè®¤ä¸ºè„šæœ¬æ‰§è¡Œå¤±è´¥</p></blockquote><p>è„šæœ¬å†…å®¹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">set</span> -uo pipefail</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç£ç›˜çš„æ–‡ä»¶ç³»ç»Ÿ(df -hé‡Œé¢æ˜¾ç¤ºçš„)</span></span><br><span class="line">FILESYSTEM=<span class="string">&quot;/dev/vda1&quot;</span></span><br><span class="line"><span class="comment"># ä¸šåŠ¡æ—¥å¿—ç›®å½•</span></span><br><span class="line">LOGS_FOLDER=<span class="string">&quot;/logs/&quot;</span></span><br><span class="line"><span class="comment"># è¿™é‡Œçš„æ—¥å¿—æ–‡ä»¶ä¸åšå¤„ç†, ä¸€èˆ¬æ˜¯éœ€è¦ä¿ç•™çš„å½“å¤©æ—¥å¿—.</span></span><br><span class="line">EXCLUDE_LOGS=<span class="string">&quot;a.log|b.log|c.log|d.log&quot;</span></span><br><span class="line"><span class="comment"># è¿™é‡Œçš„æ—¥å¿—åªæ¸…ç©ºï¼Œä¸åˆ é™¤</span></span><br><span class="line">EMPTY_LOGS=(</span><br><span class="line">/var/log/stdout</span><br><span class="line">/root/agent.log</span><br><span class="line">)</span><br><span class="line"><span class="comment"># æ¸…ç†æ—¥å¿—è®°å½•</span></span><br><span class="line">LOG=/root/clean.log</span><br><span class="line"><span class="comment"># å½“å‰æ—¶é—´</span></span><br><span class="line">NOW=$(<span class="built_in">date</span> +<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>)</span><br><span class="line"></span><br><span class="line">USEAGE=$(<span class="built_in">df</span> -h | grep -vE <span class="string">&#x27;tmpfs|cdrom&#x27;</span> | grep <span class="string">&quot;<span class="variable">$&#123;FILESYSTEM&#125;</span>&quot;</span> | awk <span class="string">&#x27;&#123;print $(NF-1)&#125;&#x27;</span> | <span class="built_in">cut</span> -d <span class="string">&quot;%&quot;</span> -f1)</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;NOW&#125;</span> filesystem used <span class="variable">$&#123;USEAGE&#125;</span>%&quot;</span> &gt;&gt; <span class="variable">$&#123;LOG&#125;</span> 2&gt;&amp;1</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$USEAGE</span> -ge 80 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="variable">$&#123;EMPTY_LOGS[*]&#125;</span>;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;NOW&#125;</span> clean <span class="variable">$i</span>&quot;</span> &gt;&gt; <span class="variable">$&#123;LOG&#125;</span> 2&gt;&amp;1</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;&quot;</span> &gt; <span class="variable">$i</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">    logfile=$(<span class="built_in">ls</span> -t <span class="variable">$&#123;LOGS_FOLDER&#125;</span> | grep -Ev <span class="variable">$&#123;EXCLUDE_LOGS&#125;</span> | <span class="built_in">tail</span> -1)</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;NOW&#125;</span> clean <span class="variable">$&#123;logfile&#125;</span>&quot;</span> &gt;&gt; <span class="variable">$&#123;LOG&#125;</span> 2&gt;&amp;1</span><br><span class="line">    <span class="built_in">rm</span> -f <span class="variable">$&#123;LOGS_FOLDER&#125;</span><span class="variable">$&#123;logfile&#125;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><p>ç£ç›˜ä½¿ç”¨ç‡ä½äº 80% ä¸ä¼šæ‰§è¡Œæ“ä½œ, æ‰€ä»¥å¯ä»¥ç¼©çŸ­ crontab æ‰§è¡Œçš„é—´éš”, æˆ‘ä¸€èˆ¬è®¾ç½®æˆ 5 åˆ†é’Ÿæ£€æµ‹ä¸€æ¬¡, crontab å†…å®¹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*/5 * * * * /data/tools/clean.sh &gt; /dev/null 2&gt;&amp;1</span><br></pre></td></tr></table></figure><div class="note warning modern"><p>æ³¨æ„: crontab æœ€åéœ€è¦ä¿ç•™ä¸€ä¸ªç©ºè¡Œ</p></div>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å‘½ä»¤è¡Œå·¥å…· </tag>
            
            <tag> è„šæœ¬ </tag>
            
            <tag> cli </tag>
            
            <tag> Crontab </tag>
            
            <tag> bash </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¿«é€Ÿå®‰è£…Prometheusç›‘æ§ç»„ä»¶</title>
      <link href="/posts/ln38vw8d/"/>
      <url>/posts/ln38vw8d/</url>
      
        <content type="html"><![CDATA[<p>å¤åˆ¶ç²˜è´´å°±èƒ½ç”¨ï¼Œé€‚ç”¨äºéå®¹å™¨åŒ–å®‰è£…ï¼Œ k8s ç¯å¢ƒçœ‹è¿™ä¸ªï¼Œ æ›´æ–¹ä¾¿ <a href="/posts/61baae6f/">Kubernetesä¸­ä½¿ç”¨Prometheuså¯¹é›†ç¾¤èŠ‚ç‚¹åšç›‘æ§</a></p><p>å®‰è£…æ–¹å¼ä¸ºäºŒè¿›åˆ¶å®‰è£…ï¼Œä½¿ç”¨ systemd æ¥ç®¡ç†ï¼ˆä¹Ÿå¯ä»¥ä½¿ç”¨ supervisor ç­‰è¿›ç¨‹ç®¡ç†å·¥å…·ï¼‰</p><h2 id="å®‰è£…-node-exporter"><a href="#å®‰è£…-node-exporter" class="headerlink" title="å®‰è£… node_exporter"></a>å®‰è£… node_exporter</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[ -d /data/src ] || <span class="built_in">mkdir</span> -p /data/src</span><br><span class="line"><span class="built_in">cd</span> /data/src/</span><br><span class="line">curl -OL -C - https://file.babudiu.com/f/rRi2/node_exporter-1.6.1.linux-amd64.tar.gz</span><br><span class="line">tar xf node_exporter-1.6.1.linux-amd64.tar.gz</span><br><span class="line"><span class="built_in">ln</span> -sf /data/src/node_exporter-1.6.1.linux-amd64 ../node_exporter</span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &gt;/etc/systemd/system/node_exporter.service &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">[Unit]</span></span><br><span class="line"><span class="string">Description=node_exporter</span></span><br><span class="line"><span class="string">Documentation=https://prometheus.io/</span></span><br><span class="line"><span class="string">After=network.target</span></span><br><span class="line"><span class="string">[Service]</span></span><br><span class="line"><span class="string">Type=simple</span></span><br><span class="line"><span class="string">ExecStart=/data/node_exporter/node_exporter</span></span><br><span class="line"><span class="string">Restart=on-failure</span></span><br><span class="line"><span class="string">[Install]</span></span><br><span class="line"><span class="string">WantedBy=multi-user.target</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl <span class="built_in">enable</span> --now node_exporter</span><br></pre></td></tr></table></figure><h2 id="å®‰è£…-Prometheus"><a href="#å®‰è£…-Prometheus" class="headerlink" title="å®‰è£… Prometheus"></a>å®‰è£… Prometheus</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[ -d /data/src ] || <span class="built_in">mkdir</span> -p /data/src</span><br><span class="line"><span class="built_in">cd</span> /data/src/</span><br><span class="line">curl -OL -C - https://file.babudiu.com/f/vlsA/prometheus-2.49.1.linux-amd64.tar.gz</span><br><span class="line">tar xf prometheus-2.49.1.linux-amd64.tar.gz</span><br><span class="line"><span class="built_in">ln</span> -sf /data/src/prometheus-2.49.1.linux-amd64 ../prometheus</span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &gt;/etc/systemd/system/prometheus.service &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">[Unit]</span></span><br><span class="line"><span class="string">Description=Prometheus Server</span></span><br><span class="line"><span class="string">Documentation=https://prometheus.io/docs/introduction/overview/</span></span><br><span class="line"><span class="string">After=network-online.target</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Service]</span></span><br><span class="line"><span class="string">Restart=on-failure</span></span><br><span class="line"><span class="string">ExecStart=/data/prometheus/prometheus \</span></span><br><span class="line"><span class="string">  --config.file=/data/prometheus/prometheus.yml \</span></span><br><span class="line"><span class="string">  --storage.tsdb.path=/data/prometheus/data</span></span><br><span class="line"><span class="string">ExecReload=/bin/kill -HUP $MAINPID</span></span><br><span class="line"><span class="string">[Install]</span></span><br><span class="line"><span class="string">WantedBy=multi-user.target</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl <span class="built_in">enable</span> --now prometheus</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç›‘æ§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
            <tag> prometheus </tag>
            
            <tag> ç›‘æ§ </tag>
            
            <tag> node_exporter </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dockerfileä¸­ADDæ–‡ä»¶çš„è·¯å¾„é—®é¢˜</title>
      <link href="/posts/lmucp5lg/"/>
      <url>/posts/lmucp5lg/</url>
      
        <content type="html"><![CDATA[<p>é¦–å…ˆçœ‹ä¸€ä¸ªæ¡ˆä¾‹</p><p>å½“å‰ç›®å½•çš„æ–‡ä»¶å¦‚ä¸‹:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@devops_build watcher_svr]<span class="comment"># tree</span></span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ 1</span><br><span class="line">â”œâ”€â”€ 2</span><br><span class="line">â”‚   â””â”€â”€ 3</span><br><span class="line">â””â”€â”€ Dockerfile</span><br><span class="line"></span><br><span class="line">1 directory, 3 files</span><br></pre></td></tr></table></figure><p><code>Dockerfile</code> æ–‡ä»¶å†…å®¹å¦‚ä¸‹:</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> node:<span class="number">14.20</span>.<span class="number">1</span>-buster</span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash"> * /code/</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /code</span></span><br></pre></td></tr></table></figure><p>æœ¬æ„æ˜¯æƒ³æŠŠå½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶æ”¾åˆ°å®¹å™¨å†…çš„ <code>/code</code> ç›®å½•, è¿™ä¸ªæ—¶å€™ä½¿ç”¨ <code>docker build</code> åæ— æ³•å¯åŠ¨, è¿›å…¥å®¹å™¨, æ‰“å¼€ <code>/code</code> ä¸€çœ‹:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@devops_build watcher_svr]<span class="comment"># docker run -it test bash</span></span><br><span class="line">root@cb7543054ef2:/code<span class="comment"># ls -al</span></span><br><span class="line">total 12</span><br><span class="line">drwxr-xr-x 2 root root 4096 Sep 22 08:47 .</span><br><span class="line">drwxr-xr-x 1 root root 4096 Sep 22 08:47 ..</span><br><span class="line">-rw-r--r-- 1 root root    0 Sep 22 08:45 1</span><br><span class="line">-rw-r--r-- 1 root root    0 Sep 22 08:45 3</span><br><span class="line">-rw-r--r-- 1 root root   75 Sep 22 08:46 Dockerfile</span><br><span class="line">root@cb7543054ef2:/code<span class="comment">#</span></span><br></pre></td></tr></table></figure><p>ä¼šå‘ç°, æœ¬æ¥ 3 è¿™ä¸ªæ–‡ä»¶åº”è¯¥æ˜¯åœ¨ 2 è¿™ä¸ªæ–‡ä»¶å¤¹å†…çš„, ç°åœ¨ç»Ÿä¸€éƒ½è·‘åˆ°äº†ä¸Šçº§ç›®å½•äº†, æ–‡ä»¶è·¯å¾„å®Œå…¨å˜äº†. è‡ªç„¶æ— æ³•å¯åŠ¨. å¯ä»¥åšå¦‚ä¸‹ä¿®æ”¹:</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> node:<span class="number">14.20</span>.<span class="number">1</span>-buster</span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash"> ./ /code/</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /code</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å®¹å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
            <tag> Container </tag>
            
            <tag> CICD </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Windowsä¸‹ä½¿ç”¨batè„šæœ¬æ¥æ–°å¢ç¯å¢ƒå˜é‡</title>
      <link href="/posts/lmsslh3g/"/>
      <url>/posts/lmsslh3g/</url>
      
        <content type="html"><![CDATA[<p>è‡ªå·±åˆ›å»ºäº†ä¸€ä¸ª bin ç›®å½•ç”¨äºå­˜æ”¾ä¸€äº› exe æˆ–è€… bat ç”¨äºå¿«é€Ÿè°ƒç”¨, æŠŠå®ƒåŠ åˆ° PATH ç¯å¢ƒå˜é‡ä¸­å°±å¯ä»¥åœ¨ä»»æ„è·¯å¾„æ¥è°ƒç”¨äº†.</p><h2 id="æŸ¥çœ‹ç¯å¢ƒå˜é‡"><a href="#æŸ¥çœ‹ç¯å¢ƒå˜é‡" class="headerlink" title="æŸ¥çœ‹ç¯å¢ƒå˜é‡"></a>æŸ¥çœ‹ç¯å¢ƒå˜é‡</h2><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> <span class="built_in">PATH</span></span><br></pre></td></tr></table></figure><h2 id="è®¾ç½®ç¯å¢ƒå˜é‡"><a href="#è®¾ç½®ç¯å¢ƒå˜é‡" class="headerlink" title="è®¾ç½®ç¯å¢ƒå˜é‡"></a>è®¾ç½®ç¯å¢ƒå˜é‡</h2><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setx <span class="built_in">PATH</span> &quot;<span class="variable">%PATH%</span>;<span class="variable">%USERPROFILE%</span>\bin&quot;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œéœ€è¦æ³¨æ„æŠŠåŸæœ‰çš„ <code>%PATH%</code> å¸¦ä¸Š, ä¸ç„¶å°±ä¼šè¦†ç›–æ‰ PATH å˜é‡, <code>%USERPROFILE%</code> æŒ‡çš„æ˜¯ä¸ªäººæ–‡ä»¶å¤¹, æˆ‘çš„å°±æ˜¯ <code>C:\Users\iuxt</code></p><h2 id="å®Œæ•´è„šæœ¬"><a href="#å®Œæ•´è„šæœ¬" class="headerlink" title="å®Œæ•´è„šæœ¬"></a>å®Œæ•´è„šæœ¬</h2><p>é¦–å…ˆåˆ¤æ–­ä¸€ä¸‹æœ‰æ²¡æœ‰ç¯å¢ƒå˜é‡, æ²¡æœ‰çš„è¯å°±å¢åŠ , æœ‰çš„è¯ä»€ä¹ˆéƒ½ä¸åš.</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> <span class="built_in">path</span> | <span class="built_in">findstr</span> &quot;<span class="variable">%USERPROFILE%</span>\bin&quot; &gt;<span class="built_in">nul</span> &amp;&amp; (</span><br><span class="line">    <span class="built_in">echo</span> ç¯å¢ƒå˜é‡å·²å­˜åœ¨</span><br><span class="line">) || (</span><br><span class="line">    <span class="built_in">echo</span> ç¯å¢ƒå˜é‡ä¸å­˜åœ¨</span><br><span class="line">    setx <span class="built_in">PATH</span> &quot;<span class="variable">%PATH%</span>;<span class="variable">%USERPROFILE%</span>\bin&quot;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cmd </tag>
            
            <tag> bat </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>k8sè§£é™¤serviceç«¯å£é™åˆ¶</title>
      <link href="/posts/lmri345s/"/>
      <url>/posts/lmri345s/</url>
      
        <content type="html"><![CDATA[<p>æˆ‘è‡ªå·±å†™äº†ä¸€ä¸ª svc çš„ yaml æ–‡ä»¶ï¼Œéƒ¨ç½²çš„æ—¶å€™æŠ¥é”™ï¼Œä¸åœ¨é»˜è®¤çš„èŒƒå›´å†…ï¼Œé»˜è®¤èŒƒå›´æ˜¯: <code>30000-32767</code></p><p><code>kubectl apply -f nginx-src.yaml</code></p><p>æŠ¥é”™:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The Service <span class="string">&quot;nginx&quot;</span> is invalid: spec.ports[0].nodePort: Invalid value: 80: provided port is not <span class="keyword">in</span> the valid range. The range of valid ports is 30000-32767</span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¯ kubeadm éƒ¨ç½²<br>ä¿®æ”¹é…ç½®æ–‡ä»¶ <code>vim /etc/kubernetes/manifests/kube-apiserver.yaml</code></p><p>åœ¨å¯åŠ¨å‚æ•°é‡Œé¢æ·»åŠ å¦‚ä¸‹ä¸€è¡Œ</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="string">--service-node-port-range=1-65535</span></span><br></pre></td></tr></table></figure><p>é‡å¯ kube-apiserver</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete pod -n kube-system kube-apiserver-xxx</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å®¹å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Kubernetes </tag>
            
            <tag> k8s </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQLæŸ¥è¯¢å‡ºæ‰€æœ‰æ²¡æœ‰ä¸»é”®çš„è¡¨</title>
      <link href="/posts/lmoa36fz/"/>
      <url>/posts/lmoa36fz/</url>
      
        <content type="html"><![CDATA[<p>ä½œè€…ï¼šMay22Night<br>é“¾æ¥ï¼š<a href="https://www.jianshu.com/p/f484c63e5c96">https://www.jianshu.com/p/f484c63e5c96</a></p><h2 id="å‹ç¼©ç‰ˆ"><a href="#å‹ç¼©ç‰ˆ" class="headerlink" title="å‹ç¼©ç‰ˆ:"></a>å‹ç¼©ç‰ˆ:</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> a.TABLE_SCHEMA,a.TABLE_NAME <span class="keyword">FROM</span> (<span class="keyword">SELECT</span> TABLE_SCHEMA,TABLE_NAME <span class="keyword">FROM</span> information_schema.TABLES <span class="keyword">WHERE</span> TABLE_SCHEMA <span class="keyword">NOT</span> <span class="keyword">IN</span>(<span class="string">&#x27;mysql&#x27;</span>,<span class="string">&#x27;information_schema&#x27;</span>,<span class="string">&#x27;performance_schema&#x27;</span>,<span class="string">&#x27;sys&#x27;</span>,<span class="string">&#x27;sysdb&#x27;</span>)) <span class="keyword">as</span> a <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> (<span class="keyword">SELECT</span> TABLE_SCHEMA,TABLE_NAME <span class="keyword">FROM</span> information_schema.TABLE_CONSTRAINTS <span class="keyword">WHERE</span> CONSTRAINT_TYPE<span class="operator">=</span><span class="string">&#x27;PRIMARY KEY&#x27;</span> <span class="keyword">AND</span> TABLE_SCHEMA <span class="keyword">NOT</span> <span class="keyword">IN</span>(<span class="string">&#x27;mysql&#x27;</span>,<span class="string">&#x27;information_schema&#x27;</span>,<span class="string">&#x27;performance_schema&#x27;</span>,<span class="string">&#x27;sys&#x27;</span>,<span class="string">&#x27;sysdb&#x27;</span>)) <span class="keyword">as</span> b <span class="keyword">ON</span> a.TABLE_SCHEMA<span class="operator">=</span>b.TABLE_SCHEMA <span class="keyword">AND</span> a.TABLE_NAME<span class="operator">=</span>b.TABLE_NAME <span class="keyword">WHERE</span> b.TABLE_NAME <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure><h2 id="ç¾åŒ–ç‰ˆ"><a href="#ç¾åŒ–ç‰ˆ" class="headerlink" title="ç¾åŒ–ç‰ˆ:"></a>ç¾åŒ–ç‰ˆ:</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    a.TABLE_SCHEMA,</span><br><span class="line">    a.TABLE_NAME </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    (</span><br><span class="line">    <span class="keyword">SELECT</span></span><br><span class="line">        TABLE_SCHEMA,</span><br><span class="line">        TABLE_NAME </span><br><span class="line">    <span class="keyword">FROM</span></span><br><span class="line">        information_schema.TABLES </span><br><span class="line">    <span class="keyword">WHERE</span></span><br><span class="line">    TABLE_SCHEMA <span class="keyword">NOT</span> <span class="keyword">IN</span> ( <span class="string">&#x27;mysql&#x27;</span>, <span class="string">&#x27;information_schema&#x27;</span>, <span class="string">&#x27;performance_schema&#x27;</span>, <span class="string">&#x27;sys&#x27;</span>, <span class="string">&#x27;sysdb&#x27;</span> )) <span class="keyword">AS</span> a</span><br><span class="line">    <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span></span><br><span class="line">        TABLE_SCHEMA,</span><br><span class="line">        TABLE_NAME </span><br><span class="line">    <span class="keyword">FROM</span></span><br><span class="line">        information_schema.TABLE_CONSTRAINTS </span><br><span class="line">    <span class="keyword">WHERE</span></span><br><span class="line">        CONSTRAINT_TYPE <span class="operator">=</span> <span class="string">&#x27;PRIMARY KEY&#x27;</span> </span><br><span class="line">    <span class="keyword">AND</span> TABLE_SCHEMA <span class="keyword">NOT</span> <span class="keyword">IN</span> ( <span class="string">&#x27;mysql&#x27;</span>, <span class="string">&#x27;information_schema&#x27;</span>, <span class="string">&#x27;performance_schema&#x27;</span>, <span class="string">&#x27;sys&#x27;</span>, <span class="string">&#x27;sysdb&#x27;</span> )) <span class="keyword">AS</span> b <span class="keyword">ON</span> a.TABLE_SCHEMA <span class="operator">=</span> b.TABLE_SCHEMA </span><br><span class="line">    <span class="keyword">AND</span> a.TABLE_NAME <span class="operator">=</span> b.TABLE_NAME </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">    b.TABLE_NAME <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure><h2 id="sql-è§£é‡Š"><a href="#sql-è§£é‡Š" class="headerlink" title="sql è§£é‡Š:"></a>sql è§£é‡Š:</h2><p>æŸ¥è¯¢ç»“æœä¸­ <code>TABLE_SCHEMA</code> æ˜¯åº“åï¼Œ<code>TABLE_NAME</code> å°±æ˜¯è¡¨åã€‚<br>å…¶æŸ¥è¯¢åŸç†å°±æ˜¯ <code>information_schema</code> åº“ä¸­å­˜å‚¨äº†å„ä¸ªåº“ä¸è¡¨çš„ç»“æ„ï¼Œåœ¨ <code>information_schema.TABLES</code> è¡¨ä¸­å­˜å‚¨äº†æ‰€æœ‰è¡¨ï¼Œ<code>information_schema.TABLE_CONSTRAINTS</code> è¡¨ä¸­å­˜å‚¨äº†è¡¨ç›¸å…³çš„çº¦æŸï¼Œä¸»é”®å°±æ˜¯ä¸€ç§çº¦æŸï¼Œæ‰€ä»¥ <code>CONSTRAINT_TYPE</code> å­—æ®µä¸º <code>PRIMARY KEY</code> å€¼çš„å°±æ˜¯æ‹¥æœ‰ä¸»é”®çš„è¡¨ã€‚<br>æœ‰äº†æ‰€æœ‰è¡¨çš„è¡¨åï¼Œè¿˜æœ‰äº†æ‰€æœ‰æ‹¥æœ‰ä¸»é”®çš„è¡¨ï¼Œé‚£ä¹ˆå°±ç®€å•äº†ï¼Œä»¥æŸ¥è¯¢å‡ºçš„å…¨éƒ¨è¡¨ä¸ºä¸»è¡¨ï¼Œå·¦è”ä¸€ä¸‹ï¼Œå³è¡¨ä¸ºç©ºçš„å°±æ˜¯æ²¡æœ‰ä¸»é”®çš„è¡¨ã€‚<br>SQL ä¸­æ’é™¤äº† mysql è‡ªå¸¦çš„äº”ä¸ªåº“ï¼ŒåŒæ—¶è§£å†³äº†ä¸åŒåçš„åº“æ‹¥æœ‰ç›¸åŒåçš„è¡¨çš„æƒ…å†µï¼Œè¿˜æœ‰ä¼˜åŒ–ç©ºé—´ï¼Œä¸è¿‡æˆ‘è§‰å¾—ä¸æ˜¯ä¸šåŠ¡ SQLï¼Œæ²¡å¿…è¦ä¼˜åŒ–äº†ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åœ¨Windowsä¸‹å®ç°ä¸€ä¸ªå¿«é€Ÿè½¬æ¢éŸ³ä¹æ ¼å¼çš„å°å·¥å…·</title>
      <link href="/posts/lmm46hng/"/>
      <url>/posts/lmm46hng/</url>
      
        <content type="html"><![CDATA[<p>æç‚¹æ­Œåœ¨è½¦é‡Œå¬ï¼Œä½†æ˜¯æ—©å¹´ 10w çš„åˆèµ„è½¦åªèƒ½å¬ mp3 æ ¼å¼ï¼Œæ‰€ä»¥æŠŠéœ€è¦æˆ‘çè—çš„éŸ³ä¹è½¬æ¢æˆ mp3 æ‹·è¿› U ç›˜ï¼Œ è½¬æ¢æ ¼å¼å·¥å…·å½“ç„¶æ˜¯é€‰æ‹© ffmpeg äº†ã€‚æœäº†ä¸‹å‘½ä»¤æ˜¯ï¼š</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i xxx.flac -acodec libmp3lame xxx.mp3</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥éœ€è¦åšä¸€ä¸ªç¨å¾®è‡ªåŠ¨åŒ–ä¸€ç‚¹çš„å·¥å…·ï¼Œæ¯”å¦‚æŠŠ flac æ–‡ä»¶æ‹–æ”¾åˆ° bat è„šæœ¬ä¸Šï¼Œå°±èƒ½å®ç°è‡ªåŠ¨è½¬æ¢æ ¼å¼ã€‚</p><p>å®Œæ•´è„šæœ¬å¦‚ä¸‹ï¼š</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chcp</span> <span class="number">65001</span></span><br><span class="line">ffmpeg -i &quot;%~s1&quot; -acodec libmp3lame &quot;<span class="variable">%~dp0%</span>~n1.mp3&quot;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ chcp 65001 æ˜¯ä¸ºäº†é˜²æ­¢ bat è„šæœ¬ä¸­åŒ…å«ä¸­æ–‡å¯¼è‡´çš„ä¹±ç ã€‚ç”³æ˜è„šæœ¬ç¼–ç ä¸º UTF-8ï¼Œ è„šæœ¬ä¿å­˜çš„æ—¶å€™ä¹Ÿè¦ä»¥ UTF-8 ç¼–ç ä¿å­˜ï¼Œ å¦‚æœä¸åŠ  <code>chcp 65001</code>, é‚£ä¹ˆéœ€è¦ä½¿ç”¨ windows è®°äº‹æœ¬æ‰“å¼€é‡æ–°ä¿å­˜ç¼–ç é€‰æ‹© <code>ANSI</code>ï¼Œ å› ä¸º cmd é»˜è®¤çš„ç¼–ç å°±æ˜¯ GBK<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202309162228582.png" alt="image.png"></p><p>ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„ä»£ç é¡µã€‚</p><table><thead><tr><th>ä»£ç é¡µ</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>65001</td><td>UTF-8 ä»£ç é¡µ</td></tr><tr><td>950</td><td>ç¹ä½“ä¸­æ–‡</td></tr><tr><td>936</td><td>ç®€ä½“ä¸­æ–‡é»˜è®¤ GBK</td></tr><tr><td>437</td><td>MS-DOS ç¾å›½è‹±è¯­</td></tr></tbody></table><p>å¦å¤–è„šæœ¬é‡Œç”¨åˆ°çš„å˜é‡è¯´æ˜ï¼š</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chcp</span> <span class="number">65001</span></span><br><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line"><span class="built_in">echo</span> æ— åç¼€åï¼š %~n1</span><br><span class="line"><span class="built_in">echo</span> æœ‰åç¼€åï¼š %~nx1</span><br><span class="line"><span class="built_in">echo</span> ç»å¯¹è·¯å¾„ï¼š %<span class="number">1</span></span><br><span class="line"><span class="built_in">echo</span> çŸ­è·¯å¾„åçš„ç»å¯¹è·¯å¾„ï¼š %~s1</span><br><span class="line"><span class="built_in">echo</span> é©±åŠ¨å™¨å’Œè·¯å¾„ï¼š %~dp1</span><br><span class="line"><span class="built_in">echo</span> é©±åŠ¨å™¨ï¼š %~d1</span><br><span class="line"><span class="built_in">echo</span> è·¯å¾„ï¼š %~p1</span><br><span class="line"><span class="built_in">echo</span> æ–‡ä»¶å±æ€§ï¼š %~a1</span><br><span class="line"><span class="built_in">echo</span> æ—¥æœŸ/æ—¶é—´ï¼š %~t1</span><br><span class="line"><span class="built_in">echo</span> æ–‡ä»¶å¤§å°ï¼š %~z1@<span class="built_in">echo</span> off</span><br><span class="line"><span class="built_in">echo</span> å½“å‰çš„batæ–‡ä»¶ï¼š&quot;%~<span class="number">0</span>&quot;</span><br><span class="line"><span class="built_in">echo</span> å½“å‰ç›˜ç¬¦ï¼š&quot;%~d0&quot;</span><br><span class="line"><span class="built_in">echo</span> å½“å‰ç›˜ç¬¦å’Œè·¯å¾„ï¼š&quot;%~dp0&quot;</span><br><span class="line"><span class="built_in">echo</span> å½“å‰æ‰¹å¤„ç†å…¨è·¯å¾„ï¼š&quot;%~f0&quot;</span><br><span class="line"><span class="built_in">echo</span> å½“å‰ç›˜ç¬¦å’Œè·¯å¾„çš„çŸ­æ–‡ä»¶åæ ¼å¼ï¼š&quot;%~sdp0&quot;</span><br><span class="line"><span class="built_in">echo</span> å½“å‰<span class="built_in">CMD</span>é»˜è®¤ç›®å½•ï¼š&quot;<span class="variable">%cd%</span>&quot;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„è„šæœ¬ç”¨åˆ°äº†çŸ­è·¯å¾„ï¼Œ çŸ­è·¯å¾„çš„å¥½å¤„æ˜¯å¯ä»¥è§£å†³è·¯å¾„ä¸­å¸¦æœ‰ç©ºæ ¼çš„é—®é¢˜ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å‘½ä»¤è¡Œå·¥å…· </tag>
            
            <tag> cmd </tag>
            
            <tag> bat </tag>
            
            <tag> cli </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>WSL2 - Ubuntué…ç½®è®°å½•</title>
      <link href="/posts/lmeiruso/"/>
      <url>/posts/lmeiruso/</url>
      
        <content type="html"><![CDATA[<h2 id="WSL-é˜²ç«å¢™è§„åˆ™"><a href="#WSL-é˜²ç«å¢™è§„åˆ™" class="headerlink" title="WSL é˜²ç«å¢™è§„åˆ™"></a>WSL é˜²ç«å¢™è§„åˆ™</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Get-NetAdapter</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">New-NetFirewallRule</span> <span class="literal">-DisplayName</span> <span class="string">&quot;WSL&quot;</span> <span class="literal">-Direction</span> Inbound  <span class="literal">-InterfaceAlias</span> <span class="string">&quot;vEthernet (WSL)&quot;</span>  <span class="literal">-Action</span> Allow</span><br></pre></td></tr></table></figure><h2 id="åŸºç¡€ç¯å¢ƒé…ç½®"><a href="#åŸºç¡€ç¯å¢ƒé…ç½®" class="headerlink" title="åŸºç¡€ç¯å¢ƒé…ç½®"></a>åŸºç¡€ç¯å¢ƒé…ç½®</h2><h3 id="æ›´æ¢æº"><a href="#æ›´æ¢æº" class="headerlink" title="æ›´æ¢æº"></a>æ›´æ¢æº</h3><p>ä½¿ç”¨ä¸­ç§‘å¤§çš„æº: <a href="https://mirrors.ustc.edu.cn/help/ubuntu.html">https://mirrors.ustc.edu.cn/help/ubuntu.html</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è€ç‰ˆæœ¬Ubuntu</span></span><br><span class="line"><span class="comment"># sudo sed -i &#x27;s@//.*.ubuntu.com@//mirrors.ustc.edu.cn@g&#x27; /etc/apt/sources.list</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Ubuntu 24 åŠä»¥ä¸Š</span></span><br><span class="line">sudo sed -i <span class="string">&#x27;s@//.*.ubuntu.com@//mirrors.ustc.edu.cn@g&#x27;</span> /etc/apt/sources.list.d/ubuntu.sources</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…å¸¸ç”¨çš„åŒ…"><a href="#å®‰è£…å¸¸ç”¨çš„åŒ…" class="headerlink" title="å®‰è£…å¸¸ç”¨çš„åŒ…"></a>å®‰è£…å¸¸ç”¨çš„åŒ…</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update &amp;&amp; sudo apt upgrade -y</span><br><span class="line">sudo apt install -y zip libmysqlclient-dev build-essential libssl-dev zlib1g-dev libbz2-dev libreadline-dev libsqlite3-dev libncursesw5-dev xz-utils tk-dev libxml2-dev libxmlsec1-dev libffi-dev liblzma-dev lrzsz</span><br></pre></td></tr></table></figure><h3 id="å½“å‰ç”¨æˆ·å…-sudo-å¯†ç "><a href="#å½“å‰ç”¨æˆ·å…-sudo-å¯†ç " class="headerlink" title="å½“å‰ç”¨æˆ·å… sudo å¯†ç "></a>å½“å‰ç”¨æˆ·å… sudo å¯†ç </h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">tee</span> /etc/sudoers.d/iuxt &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">%sudo   ALL=(ALL:ALL) NOPASSWD:ALL</span></span><br><span class="line"><span class="string">$USER   ALL=(ALL:ALL) NOPASSWD:ALL</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><h3 id="WSL-å¼€å¯-systemd-æ”¯æŒ-ä»…æ”¯æŒ-WSL2"><a href="#WSL-å¼€å¯-systemd-æ”¯æŒ-ä»…æ”¯æŒ-WSL2" class="headerlink" title="WSL å¼€å¯ systemd æ”¯æŒ (ä»…æ”¯æŒ WSL2)"></a>WSL å¼€å¯ systemd æ”¯æŒ (ä»…æ”¯æŒ WSL2)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">touch</span> /etc/startup.sh</span><br><span class="line">sudo <span class="built_in">chmod</span> +x /etc/startup.sh</span><br><span class="line">sudo <span class="built_in">tee</span> /etc/wsl.conf &lt;&lt;-<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">[boot]</span><br><span class="line">systemd=<span class="literal">true</span></span><br><span class="line"><span class="built_in">command</span>=/etc/startup.sh</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h2 id="git-é…ç½®"><a href="#git-é…ç½®" class="headerlink" title="git é…ç½®"></a>git é…ç½®</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install -y git git-lfs</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">tee</span> ~/.gitconfig &lt;&lt;-<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">[user]</span><br><span class="line">        name = zhanglikun</span><br><span class="line">        email = x@zahui.fan</span><br><span class="line">        signingkey = zhanglikun</span><br><span class="line">[credential]</span><br><span class="line">        helper = store</span><br><span class="line">[core]</span><br><span class="line">        autocrlf = <span class="literal">false</span></span><br><span class="line">        quotepath = <span class="literal">false</span></span><br><span class="line">[init]</span><br><span class="line">        defaultBranch = master</span><br><span class="line">[pull]</span><br><span class="line">        rebase = <span class="literal">false</span></span><br><span class="line">[commit]</span><br><span class="line">        gpgsign = <span class="literal">false</span></span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h2 id="zsh-é…ç½®"><a href="#zsh-é…ç½®" class="headerlink" title="zsh é…ç½®"></a>zsh é…ç½®</h2><h3 id="å®‰è£…-zsh"><a href="#å®‰è£…-zsh" class="headerlink" title="å®‰è£… zsh"></a>å®‰è£… zsh</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install -y zsh</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…-oh-my-zsh"><a href="#å®‰è£…-oh-my-zsh" class="headerlink" title="å®‰è£… oh my zsh"></a>å®‰è£… oh my zsh</h3><p><a href="https://ohmyz.sh/#install">https://ohmyz.sh/#install</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh -c <span class="string">&quot;<span class="subst">$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)</span>&quot;</span></span><br></pre></td></tr></table></figure><h3 id="å®‰è£…ä¸»é¢˜"><a href="#å®‰è£…ä¸»é¢˜" class="headerlink" title="å®‰è£…ä¸»é¢˜"></a>å®‰è£…ä¸»é¢˜</h3><p><a href="https://github.com/romkatv/powerlevel10k">https://github.com/romkatv/powerlevel10k</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> --depth=1 https://github.com/romkatv/powerlevel10k.git <span class="variable">$&#123;ZSH_CUSTOM:-<span class="variable">$HOME</span>/.oh-my-zsh/custom&#125;</span>/themes/powerlevel10k</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹ä¸»é¢˜é…ç½®</span></span><br><span class="line">sed -i <span class="string">&#x27;s#^ZSH_THEME=.*#ZSH_THEME=&quot;powerlevel10k/powerlevel10k&quot;#g&#x27;</span> ~/.zshrc</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…ä¸€äº›æ’ä»¶"><a href="#å®‰è£…ä¸€äº›æ’ä»¶" class="headerlink" title="å®‰è£…ä¸€äº›æ’ä»¶"></a>å®‰è£…ä¸€äº›æ’ä»¶</h3><p><a href="https://github.com/zsh-users/zsh-autosuggestions">https://github.com/zsh-users/zsh-autosuggestions</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install -y fzf</span><br><span class="line">git <span class="built_in">clone</span> https://github.com/zsh-users/zsh-autosuggestions <span class="variable">$&#123;ZSH_CUSTOM:-~/.oh-my-zsh/custom&#125;</span>/plugins/zsh-autosuggestions</span><br><span class="line">git <span class="built_in">clone</span> https://github.com/zsh-users/zsh-syntax-highlighting.git <span class="variable">$&#123;ZSH_CUSTOM:-~/.oh-my-zsh/custom&#125;</span>/plugins/zsh-syntax-highlighting</span><br><span class="line">omz plugin <span class="built_in">enable</span> z git sudo zsh-autosuggestions zsh-syntax-highlighting fzf</span><br></pre></td></tr></table></figure><h2 id="vim"><a href="#vim" class="headerlink" title="vim"></a>vim</h2><h3 id="ä¿®æ”¹é»˜è®¤ç¼–è¾‘å™¨"><a href="#ä¿®æ”¹é»˜è®¤ç¼–è¾‘å™¨" class="headerlink" title="ä¿®æ”¹é»˜è®¤ç¼–è¾‘å™¨"></a>ä¿®æ”¹é»˜è®¤ç¼–è¾‘å™¨</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sudo update-alternatives --config editor</span></span><br><span class="line">sudo <span class="built_in">ln</span> -sf /usr/bin/vim.basic /etc/alternatives/editor</span><br><span class="line"></span><br><span class="line"><span class="comment"># select-editor</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;SELECTED_EDITOR=&quot;/usr/bin/vim.basic&quot;&#x27;</span> &gt; ~/.selected_editor</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…-vim-plug-æ’ä»¶ç®¡ç†å·¥å…·"><a href="#å®‰è£…-vim-plug-æ’ä»¶ç®¡ç†å·¥å…·" class="headerlink" title="å®‰è£… vim plug æ’ä»¶ç®¡ç†å·¥å…·"></a>å®‰è£… vim plug æ’ä»¶ç®¡ç†å·¥å…·</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -fLo ~/.vim/autoload/plug.vim --create-dirs \</span><br><span class="line">    https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim</span><br></pre></td></tr></table></figure><p>é…ç½®æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">tee</span> ~/.vimrc &lt;&lt;-<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">call plug<span class="comment">#begin()</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot; On-demand loading</span></span><br><span class="line"><span class="string">Plug &#x27;preservim/nerdtree&#x27;, &#123; &#x27;on&#x27;: &#x27;NERDTreeToggle&#x27; &#125;</span></span><br><span class="line"><span class="string">Plug &#x27;vim-airline/vim-airline&#x27;</span></span><br><span class="line"><span class="string">Plug &#x27;vim-airline/vim-airline-themes&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">call plug#end()</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">set paste</span></span><br><span class="line"><span class="string">&quot;</span><span class="built_in">set</span> number</span><br><span class="line"></span><br><span class="line"><span class="string">&quot; nerdtree</span></span><br><span class="line"><span class="string">let NERDTreeWinPos=&quot;</span>left<span class="string">&quot;</span></span><br><span class="line"><span class="string">noremap &lt;F8&gt; :NERDTreeToggle&lt;CR&gt;</span></span><br><span class="line"><span class="string">let g:NERDTreeDirArrowExpandable = &#x27;â–¸&#x27;</span></span><br><span class="line"><span class="string">let g:NERDTreeDirArrowCollapsible = &#x27;â–¾&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&quot;</span> airline</span><br><span class="line"><span class="built_in">set</span> laststatus=2  <span class="string">&quot;æ°¸è¿œæ˜¾ç¤ºçŠ¶æ€æ </span></span><br><span class="line"><span class="string">let g:airline_powerline_fonts = 1  &quot;</span>æ”¯æŒ powerline å­—ä½“</span><br><span class="line"><span class="built_in">let</span> g:airline<span class="comment">#extensions#tabline#enabled = 1 &quot;æ˜¾ç¤ºçª—å£tabå’Œbuffer</span></span><br><span class="line"><span class="built_in">let</span> g:airline_theme=<span class="string">&#x27;molokai&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> !exists(<span class="string">&#x27;g:airline_symbols&#x27;</span>)</span><br><span class="line"><span class="built_in">let</span> g:airline_symbols = &#123;&#125;</span><br><span class="line">endif</span><br><span class="line"><span class="built_in">let</span> g:airline_left_sep = <span class="string">&#x27;â–¶&#x27;</span></span><br><span class="line"><span class="built_in">let</span> g:airline_left_alt_sep = <span class="string">&#x27;â¯&#x27;</span></span><br><span class="line"><span class="built_in">let</span> g:airline_right_sep = <span class="string">&#x27;â—€&#x27;</span></span><br><span class="line"><span class="built_in">let</span> g:airline_right_alt_sep = <span class="string">&#x27;â®&#x27;</span></span><br><span class="line"><span class="built_in">let</span> g:airline_symbols.linenr = <span class="string">&#x27;Â¶&#x27;</span></span><br><span class="line"><span class="built_in">let</span> g:airline_symbols.branch = <span class="string">&#x27;â‡&#x27;</span></span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><p>è¿›å…¥ vim å‘½ä»¤ç•Œé¢, è¾“å…¥ <code>:PlugInstall</code> å®‰è£…æ’ä»¶</p><h2 id="å¸¸ç”¨ç¯å¢ƒå®‰è£…"><a href="#å¸¸ç”¨ç¯å¢ƒå®‰è£…" class="headerlink" title="å¸¸ç”¨ç¯å¢ƒå®‰è£…"></a>å¸¸ç”¨ç¯å¢ƒå®‰è£…</h2><p>å®‰è£… golang python nodejs æŸ¥çœ‹ <a href="/posts/5e168f7e">å¿«é€Ÿæ­å»ºç¯å¢ƒè®°å½•</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">curl -fsSL get.docker.com | bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹ä¸€äº›é…ç½®</span></span><br><span class="line">sudo <span class="built_in">mkdir</span> -p /etc/docker &amp;&amp; sudo <span class="built_in">tee</span> /etc/docker/daemon.json &lt;&lt;-<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;exec-opts&quot;</span>: [<span class="string">&quot;native.cgroupdriver=systemd&quot;</span>],</span><br><span class="line">  <span class="string">&quot;log-driver&quot;</span>: <span class="string">&quot;json-file&quot;</span>,</span><br><span class="line">  <span class="string">&quot;log-opts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;max-size&quot;</span>: <span class="string">&quot;100m&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;storage-driver&quot;</span>: <span class="string">&quot;overlay2&quot;</span>,</span><br><span class="line">  <span class="string">&quot;iptables&quot;</span>: <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># å½“å‰ç”¨æˆ·æ‰§è¡Œdockerå‘½ä»¤ï¼Œéœ€è¦æ³¨é”€ç”¨æˆ·</span></span><br><span class="line">sudo usermod -aG docker <span class="variable">$USER</span></span><br></pre></td></tr></table></figure><p>å®‰è£… zssh, æŸ¥çœ‹ <a href="/posts/e48170f8">æ”¹é€ windows-terminalæ”¯æŒlrzsz</a></p><h2 id="å¸¸ç”¨-alias"><a href="#å¸¸ç”¨-alias" class="headerlink" title="å¸¸ç”¨ alias"></a>å¸¸ç”¨ alias</h2><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># æ¨¡ä»¿macOSæ‰“å¼€è®¿è¾¾ï¼Œä½¿ç”¨ <span class="keyword">open</span> . åœ¨æ­¤å¤„æ‰“å¼€æ–‡ä»¶ç®¡ç†å™¨ã€‚</span><br><span class="line">alias <span class="keyword">open</span>=<span class="string">&#x27;explorer.exe&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="å¸¸ç”¨è½¯é“¾æ¥"><a href="#å¸¸ç”¨è½¯é“¾æ¥" class="headerlink" title="å¸¸ç”¨è½¯é“¾æ¥"></a>å¸¸ç”¨è½¯é“¾æ¥</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ln</span> -sf /mnt/c/Users/iuxt/Desktop ~</span><br><span class="line"><span class="built_in">ln</span> -sf /mnt/c/Users/iuxt/Documents ~</span><br><span class="line"><span class="built_in">ln</span> -sf /mnt/c/Users/iuxt/Downloads ~</span><br><span class="line"><span class="built_in">ln</span> -sf /mnt/c/Users/iuxt/OneDrive ~</span><br></pre></td></tr></table></figure><h2 id="tssh"><a href="#tssh" class="headerlink" title="tssh"></a>tssh</h2><p><a href="/posts/shqeci/">trzsz ä½¿ç”¨è®°å½•</a></p><h2 id="å…¶ä»–é—®é¢˜"><a href="#å…¶ä»–é—®é¢˜" class="headerlink" title="å…¶ä»–é—®é¢˜"></a>å…¶ä»–é—®é¢˜</h2><p>å¦‚æœ wsl ä¸­çš„æœåŠ¡ï¼Œåœ¨ Windows ä¸Šé€šè¿‡ localhost è®¿é—®å¤ªæ…¢ï¼Œæ¯”å¦‚ windows ä¸Šçš„ navicat è¿æ¥ wsl é‡Œ docker è·‘çš„ wsl æ—¶ï¼Œå¯ä»¥å°è¯•ä½¿ç”¨ 127.0.0.1 æ¥æ›¿ä»£ localhostï¼Œå¯èƒ½ä¼šæœ‰å¥‡æ•ˆã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows </tag>
            
            <tag> WSL </tag>
            
            <tag> wsl2 </tag>
            
            <tag> é…ç½®è®°å½• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxç»ˆç«¯å¤ç”¨å™¨Screenå’Œtmux</title>
      <link href="/posts/lm9yw00q/"/>
      <url>/posts/lm9yw00q/</url>
      
        <content type="html"><![CDATA[<p>å‚è€ƒé˜®ä¸€å³°çš„åšå®¢<a href="https://www.ruanyifeng.com/blog/2019/10/tmux.html">https://www.ruanyifeng.com/blog/2019/10/tmux.html</a></p><h2 id="ä½œç”¨"><a href="#ä½œç”¨" class="headerlink" title="ä½œç”¨"></a>ä½œç”¨</h2><p>æƒ³è±¡ä¸€ä¸‹, æˆ‘åœ¨è‡ªå·±ç”µè„‘è¿œç¨‹ SSH è¿æ¥æœåŠ¡å™¨, æ­£åœ¨å‘½ä»¤è¡Œæ‰§è¡Œ mysqldump, çªç„¶ (æ–­ç½‘\ç”µè„‘è“å±) äº†, é‚£ä¹ˆç»ˆç«¯å°±æ–­äº†, mysqldump ä¹Ÿå°±æ–­äº†, å°±éœ€è¦é‡æ–°æ¥è¿‡. ç»ˆç«¯å¤ç”¨å™¨å°±æ˜¯åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿçš„ç»ˆç«¯, å¯ä»¥æŒ‚åœ¨åå°, éšæ—¶æƒ³è¿›å°±è¿›, è¿˜æœ‰å…¶ä»–å¥½ç”¨çš„åŠŸèƒ½, æ¯”å¦‚å°†ç»ˆç«¯æ—¥å¿—ä¿å­˜åˆ°æ–‡ä»¶å†….</p><p>å¸¸ç”¨çš„å·¥å…·æœ‰ tmux å’Œ screen, tmux ç±»ä¼¼äº screen, ä½†æ˜¯åŠŸèƒ½æ›´å¼ºå¤§, screen çš„è®°å½•æ—¥å¿—åŠŸèƒ½å¾ˆå¥½ç”¨, ä¸¤è€…å„æœ‰åƒç§‹. å¦å¤–ç»ˆç«¯å¤ç”¨å™¨å¯¹ <code>rz/sz</code> è¿™ç§å·¥å…·çš„å…¼å®¹æ€§éƒ½ä¸å¥½, å»ºè®®ä¸è¦ç”¨æ¥è¿›è¡Œ <code>rz/sz</code> ä¼ æ–‡ä»¶</p><h2 id="tmux"><a href="#tmux" class="headerlink" title="tmux"></a>tmux</h2><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># centos</span></span><br><span class="line">yum install -y tmux</span><br><span class="line"></span><br><span class="line"><span class="comment"># ubuntu</span></span><br><span class="line">apt-get install -y tmux</span><br></pre></td></tr></table></figure><h2 id="å¿«é€Ÿä½¿ç”¨"><a href="#å¿«é€Ÿä½¿ç”¨" class="headerlink" title="å¿«é€Ÿä½¿ç”¨"></a>å¿«é€Ÿä½¿ç”¨</h2><p>è¾“å…¥ <code>tmux</code> å³å¯å¯åŠ¨, åœ¨ç»ˆç«¯ä¸‹é¢æœ‰ä¸€æ¡çŠ¶æ€æ , æ˜¾ç¤ºå½“å‰çš„ç»ˆç«¯ç¼–å·.<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202309081022830.png"></p><p>é€€å‡ºè¾“å…¥: <code>exit</code> æˆ–è€…æŒ‰ä¸‹ <code>Ctrl + d</code> æˆ–è€…ç›´æ¥å…³é—­çª—å£<br>æŸ¥çœ‹åå°è¿è¡Œçš„ä¼šè¯: <code>tmux ls</code><br>è¿›å…¥ä¼šè¯: <code>tmux a -t 0</code></p><h3 id="å¸¸ç”¨æ“ä½œ"><a href="#å¸¸ç”¨æ“ä½œ" class="headerlink" title="å¸¸ç”¨æ“ä½œ"></a>å¸¸ç”¨æ“ä½œ</h3><table><thead><tr><th>æ“ä½œ</th><th>å‘½ä»¤æˆ–å¿«æ·é”®</th></tr></thead><tbody><tr><td>æ‰“å¼€ tmux</td><td>tmux</td></tr><tr><td>æ–°å»º tmux å¹¶èµ·åå­—</td><td>tmux new -s ä¼šè¯çš„åå­—</td></tr><tr><td>åˆ†ç¦»ä¼šè¯ (æ”¾åœ¨åå°)</td><td>Ctrl+b d</td></tr><tr><td>æŸ¥çœ‹æ‰€æœ‰ä¼šè¯åˆ—è¡¨</td><td>tmux ls</td></tr><tr><td>è¿›å…¥ä¼šè¯ (ç¼–å·æˆ–åå­—éƒ½å¯ä»¥)</td><td>tmux attach -t 0&#x2F;ä¼šè¯åå­—</td></tr><tr><td>æ€æ­»ä¼šè¯</td><td>tmux kill-session -t 0&#x2F;ä¼šè¯åå­—</td></tr><tr><td>åˆ‡æ¢ä¼šè¯</td><td>tmux switch -t 0&#x2F;ä¼šè¯åå­—</td></tr><tr><td>é‡å‘½åä¼šè¯</td><td>tmux rename-session -t 0 ä¼šè¯æ–°åå­—</td></tr></tbody></table><h2 id="screen"><a href="#screen" class="headerlink" title="screen"></a>screen</h2><h3 id="å®‰è£…-1"><a href="#å®‰è£…-1" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ubuntu</span></span><br><span class="line">apt-get install screen</span><br><span class="line"></span><br><span class="line"><span class="comment"># centos</span></span><br><span class="line">yum install screen</span><br></pre></td></tr></table></figure><h2 id="åŸºæœ¬ä½¿ç”¨"><a href="#åŸºæœ¬ä½¿ç”¨" class="headerlink" title="åŸºæœ¬ä½¿ç”¨"></a>åŸºæœ¬ä½¿ç”¨</h2><table><thead><tr><th>æ“ä½œ</th><th>å‘½ä»¤æˆ–å¿«æ·é”®</th></tr></thead><tbody><tr><td>æ‰“å¼€ screen</td><td>screen</td></tr><tr><td>æ”¾åœ¨åå°</td><td>Ctrl + a d</td></tr><tr><td>æŸ¥çœ‹åå°çš„ä¼šè¯</td><td>screen -ls</td></tr><tr><td>è¿›å…¥åå°ä¼šè¯</td><td>screen -r pid å· (screen -ls å¯ä»¥æŸ¥çœ‹åˆ°)</td></tr><tr><td>åˆ›å»ºä¸€ä¸ªæ”¶é›†æ—¥å¿—çš„ä¼šè¯</td><td>screen -L (æ—¥å¿—åœ¨å½“å‰ç›®å½•, screen å¼€å¤´çš„ log æ–‡ä»¶)</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cli </tag>
            
            <tag> Linux </tag>
            
            <tag> Shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Jenkins pipelineä¸­æ­£ç¡®ä½¿ç”¨git</title>
      <link href="/posts/lm8t2usn/"/>
      <url>/posts/lm8t2usn/</url>
      
        <content type="html"><![CDATA[<p>çœ‹åˆ°å¾ˆå¤š jenkins ä½¿ç”¨éƒ½æ˜¯ç›´æ¥æ‰§è¡Œ git clone å‘½ä»¤, è¿™ä¹ˆåšæœ‰ä»¥ä¸‹å‡ ä¸ªç¼ºç‚¹.</p><ol><li>éœ€è¦è€—è´¹æ—¶é—´å»å¤„ç† git åˆ†æ”¯, ä»£ç å†²çªç­‰å·¥ä½œ, è¿˜éœ€è¦åˆ¤æ–­æ˜¯ä½¿ç”¨ git clone è¿˜æ˜¯ git pull</li><li>è´¦å·å¯†ç  (æˆ–è€… ssh ç§˜é’¥) éœ€è¦å­˜å‚¨åœ¨æ„å»ºæœºå™¨ä¸Š, å¦‚æœæ›´æ¢äº†æ„å»ºèŠ‚ç‚¹, é‚£ä¹ˆéœ€è¦é‡æ–°é…ç½®, å³å¯¹æ„å»ºç¯å¢ƒæœ‰ä¾èµ–, æ„å»ºç¯å¢ƒæ˜¯ä¸ªé»‘ç›’å­, å› ä¸ºä½ ä¸çŸ¥é“ä¸Šä¸ªç»´æŠ¤è€…åœ¨è¿™å°æ„å»ºæœºå™¨ä¸Šåšäº†ä»€ä¹ˆ.</li><li>ä¸å— jenkins ç®¡ç†, æ¯”å¦‚åˆ é™¤æµæ°´çº¿, æ‹‰å–çš„ä»£ç ä»»ç„¶å­˜åœ¨æœºå™¨ä¸Š</li><li>åšä¸ªåˆ†æ”¯é€‰é¡¹æ¡†æ˜¯ä¸ªç—›è‹¦çš„äº‹æƒ…<br>å°†ä»£ç äº¤ç»™ jenkins ç®¡ç†åˆ™çœå»äº†è¿™äº›æ“ä½œ.</li></ol><h2 id="ä½¿ç”¨å‡­æ®ç®¡ç†è´¦å·å¯†ç "><a href="#ä½¿ç”¨å‡­æ®ç®¡ç†è´¦å·å¯†ç " class="headerlink" title="ä½¿ç”¨å‡­æ®ç®¡ç†è´¦å·å¯†ç "></a>ä½¿ç”¨å‡­æ®ç®¡ç†è´¦å·å¯†ç </h2><p>åœ¨ ç³»ç»Ÿç®¡ç† â€“ å‡­æ® â€“ ç³»ç»Ÿ â€“ å…¨å±€å‡­æ® é‡Œé¢å¢åŠ ä¸€ä¸ªæ–°çš„å‡­æ®</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202309071447808.png" alt="å‡­æ®"><br>æˆåŠŸåè®°å½•ä¸€ä¸‹ ID</p><h2 id="ç¼–å†™æµæ°´çº¿"><a href="#ç¼–å†™æµæ°´çº¿" class="headerlink" title="ç¼–å†™æµæ°´çº¿"></a>ç¼–å†™æµæ°´çº¿</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent any</span><br><span class="line">    parameters &#123;</span><br><span class="line">      gitParameter branch: &#x27;&#x27;, branchFilter: &#x27;.*&#x27;, defaultValue: &#x27;&#x27;, name: &#x27;BRANCH&#x27;, quickFilterEnabled: true, selectedValue: &#x27;NONE&#x27;, sortMode: &#x27;NONE&#x27;, tagFilter: &#x27;*&#x27;, type: &#x27;GitParameterDefinition&#x27;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    stages &#123;</span><br><span class="line">        stage(&#x27;Hello&#x27;) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                git branch: &quot;$&#123;BRANCH&#125;&quot;.split(&#x27;/&#x27;)[-1], credentialsId: &#x27;test&#x27;, url: &#x27;https://gitlab.i.com/devops/auppus_wfe.git&#x27;</span><br><span class="line">                sh &#x27;ls -al&#x27;</span><br><span class="line">                sh &#x27;git log&#x27;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>branch ä¸æ”¯æŒ origin&#x2F;master è¿™ç§æ ¼å¼, æ‰€ä»¥éœ€è¦ç”¨ split å¤„ç†ä¸€ä¸‹</p><h2 id="å¦‚ä½•ç”Ÿæˆæµæ°´çº¿"><a href="#å¦‚ä½•ç”Ÿæˆæµæ°´çº¿" class="headerlink" title="å¦‚ä½•ç”Ÿæˆæµæ°´çº¿"></a>å¦‚ä½•ç”Ÿæˆæµæ°´çº¿</h2><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202309071527237.png"></p>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
            <tag> jenkins </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Jenkinså‡çº§æ’ä»¶å¼•å‘çš„è¡€æ¡ˆ</title>
      <link href="/posts/lm784jlv/"/>
      <url>/posts/lm784jlv/</url>
      
        <content type="html"><![CDATA[<p>æˆ‘ä»¬å…¬å¸ç”¨çš„ jenkins æ˜¯è€ç‰ˆæœ¬, ä¸çŸ¥é“ä»€ä¹ˆæ—¶å€™è°ç‚¹äº†å‡çº§æ’ä»¶, ä½†æ˜¯æ²¡æœ‰é‡å¯ jenkins, ä¸€ç›´ç”¨è€…å¥½å¥½çš„, çªç„¶æœ‰ä¸€å¤©æœ‰ä¸ªå€’éœ‰è›‹é‡å¯äº† jenkins,ç„¶åå°±æŠ¥é”™äº†.<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202309061002748.png"></p><p>æœç´¢äº†ä¸€åœˆçš„è§£å†³æ–¹æ¡ˆ:<br>å…³é—­è®¤è¯, é…ç½®æ–‡ä»¶åœ¨ <code>.jenkins/config.xml</code> ç›®å½•ä¸­, éœ€è¦å…ˆåˆ‡æ¢åˆ° jenkins ç”¨æˆ·, å…ˆå¤‡ä»½ <code>cp .jenkins/config.xml&#123;,.bak&#125;</code> ç„¶åå†ä¿®æ”¹</p><p>å°† authorizationStrategy è¿™ä¸€å—æ”¹ä¸º</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">authorizationStrategy</span> <span class="attr">class</span>=<span class="string">&quot;hudson.security.FullControlOnceLoggedInAuthorizationStrategy&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">denyAnonymousReadAccess</span>&gt;</span>false<span class="tag">&lt;/<span class="name">denyAnonymousReadAccess</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">authorizationStrategy</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å°† securityRealm å— åˆ é™¤, ä¿å­˜åé‡å¯ jenkins, æ—¥å¿—é‡Œä¼šæ‰“å°è´¦å·å¯†ç , ç”¨è¿™ä¸ªç™»é™†.</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202309061119937.png"></p><p>ç™»é™†å, å¯ä»¥çœ‹åˆ°å„ç§ä¸å…¼å®¹çš„æ’ä»¶äº†.<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202309061126649.png"></p><p>ç°åœ¨å‡çº§ jenkins ç‰ˆæœ¬, å‡çº§åå¯ä»¥çœ‹åˆ°æ’ä»¶éƒ½å…¼å®¹äº†, ç„¶åå°†æœ‰æ›´æ–°çš„æ’ä»¶éƒ½æ›´æ–°ä¸€ä¸‹.</p><p>å¦‚æœæ— æ³•å¯åŠ¨, æ³¨æ„æŸ¥çœ‹ jenkins å¯åŠ¨æ—¥å¿—, æˆ‘å…¬å¸å‡çº§åæç¤º java ç‰ˆæœ¬ä¸å…¼å®¹, éœ€è¦å°† java 8 å‡çº§åˆ° java 11 æ‰å¯å¯åŠ¨æ–°ç‰ˆ jenkins, ä¸ºäº†ä¸å½±å“ç°æœ‰æµæ°´çº¿æ„å»º, æ‰€ä»¥ä¸ä¿®æ”¹ç¯å¢ƒå˜é‡äº†, æŒ‡å®š java ç‰ˆæœ¬æ¥è¿è¡Œæ–°ç‰ˆ jenkins</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./jdk-11.0.19/bin/java -jar jenkins.war</span><br></pre></td></tr></table></figure><p>æœ€åå°† config.xml.bak å¤åˆ¶ä¸º config.xml, æ›¿æ¢æ—§çš„ config.xml</p>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> jenkins </tag>
            
            <tag> å‡çº§ç‰ˆæœ¬ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®°å½•ä¸€æ¬¡ç”Ÿäº§ç¯å¢ƒæ•°æ®åº“è¿ç§»</title>
      <link href="/posts/73848ed5/"/>
      <url>/posts/73848ed5/</url>
      
        <content type="html"><![CDATA[<h2 id="è¿ç§»è¦æ±‚"><a href="#è¿ç§»è¦æ±‚" class="headerlink" title="è¿ç§»è¦æ±‚"></a>è¿ç§»è¦æ±‚</h2><p>ä¸è¦æ¸…ç†ç›®æ ‡æ•°æ®</p><p>è¿ç§»æ˜¯è€ç¯å¢ƒè¿ç§»åˆ°æ–°ç¯å¢ƒï¼Œ æ–°ç¯å¢ƒä¹‹å‰æœ‰è¿‡ä½¿ç”¨è®°å½•äº†ï¼Œ è¦æ±‚ä¸åˆ é™¤ç°æœ‰çš„æ•°æ®ï¼Œ å°†è€æ•°æ®å¯¼å…¥ã€‚æœ‰ä»¥ä¸‹å‡ ä¸ªé—®é¢˜ï¼š</p><ol><li>å¯¼å‡ºçš„ sql é‡Œé¢ä¸èƒ½å¸¦ drop table è¯­å¥ï¼Œæ‰€ä»¥åœ¨ mysqldump çš„æ—¶å€™éœ€è¦åŠ ä¸Š <code>--skip-add-drop-table</code> å‚æ•°</li><li>ä¸»é”®æˆ–å”¯ä¸€é”®é‡å¤çš„é—®é¢˜ï¼Œéœ€è¦å¢åŠ å‚æ•° <code>--skip-extended-insert</code></li><li>sql æ‰§è¡Œå¤±è´¥äº†éœ€è¦ç»§ç»­ï¼Œ å› ä¸ºç°æœ‰æ•°æ®å¯èƒ½å’Œè€ç¯å¢ƒå†²çªï¼Œ æ‰€ä»¥æ’å…¥å¤±è´¥ä¸èƒ½å½±å“å…¶ä»–æ•°æ®çš„æ’å…¥ï¼Œ è¿™é‡Œé€‰æ‹©åœ¨ mysql æ§åˆ¶å°æ‰§è¡Œ source å‘½ä»¤ã€‚</li></ol><h2 id="å¤‡ä»½æºæ•°æ®åº“"><a href="#å¤‡ä»½æºæ•°æ®åº“" class="headerlink" title="å¤‡ä»½æºæ•°æ®åº“"></a>å¤‡ä»½æºæ•°æ®åº“</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -h192.168.21.26 -P3306 -uroot -p&lt;password&gt; --skip-add-drop-table --skip-extended-insert --databases test_database &gt; test.sql</span><br></pre></td></tr></table></figure><blockquote><p>â€“skip-add-drop-table è¿™ä¸ªå‚æ•°ä¸ºäº†ä¸åœ¨ sql æ–‡ä»¶é‡Œé¢å¢åŠ  drop è¯­å¥ï¼Œä¸åŠ çš„è¯ï¼Œæ‰§è¡Œè¿™ä¸ª sql ä¼šå…ˆå°†è¡¨åˆ æ‰ï¼Œå†é‡æ–°åˆ›å»ºã€‚<br>â€“skip-extended-insert å¯¼å‡ºçš„ sql ä¸€ä¸ª insert å¯¹åº”ä¸€æ¡æ•°æ®ã€‚</p></blockquote><h2 id="å¦‚ä½•å°†å¤‡ä»½çš„-sql-å‘é€åˆ°ç›®æ ‡æœºå™¨"><a href="#å¦‚ä½•å°†å¤‡ä»½çš„-sql-å‘é€åˆ°ç›®æ ‡æœºå™¨" class="headerlink" title="å¦‚ä½•å°†å¤‡ä»½çš„ sql å‘é€åˆ°ç›®æ ‡æœºå™¨"></a>å¦‚ä½•å°†å¤‡ä»½çš„ sql å‘é€åˆ°ç›®æ ‡æœºå™¨</h2><p>æ•°æ®é‡è¾ƒå¤§ï¼Œåˆå—é™äºç½‘ç»œæƒ…å†µï¼Œ æ‰€ä»¥ç›´æ¥åœ¨æœåŠ¡å™¨ä¸Šå¯¼å‡ºåï¼Œä½¿ç”¨ tar å‹ç¼©ï¼Œ ç„¶åé€šè¿‡ nginx å°†æ–‡ä»¶æš´éœ²å‡ºæ¥ï¼Œåœ¨ç›®æ ‡æœºå™¨ä¸Šä½¿ç”¨ wget ä¸‹è½½ã€‚</p><h2 id="é‡åˆ°çš„ä¸€äº›é—®é¢˜"><a href="#é‡åˆ°çš„ä¸€äº›é—®é¢˜" class="headerlink" title="é‡åˆ°çš„ä¸€äº›é—®é¢˜"></a>é‡åˆ°çš„ä¸€äº›é—®é¢˜</h2><h3 id="è¿ç§»åæ•°æ®é‡ç›¸å·®è¿‡å¤§"><a href="#è¿ç§»åæ•°æ®é‡ç›¸å·®è¿‡å¤§" class="headerlink" title="è¿ç§»åæ•°æ®é‡ç›¸å·®è¿‡å¤§"></a>è¿ç§»åæ•°æ®é‡ç›¸å·®è¿‡å¤§</h3><p>å› ä¸ºç›®æ ‡æ•°æ®åº“ä¸éœ€è¦æ¸…ç©ºï¼Œæ‰€ä»¥å¢åŠ äº† <code>--skip-add-drop-table</code> å‚æ•°ï¼Œå¯¼å‡ºçš„ sql æ˜¯ä¸å¸¦ drop è¯­å¥çš„ï¼Œ é»˜è®¤æƒ…å†µä¸‹ mysqldump å¯¼å‡ºçš„ sql ä¸ºä¸‹å›¾å³è¾¹è¿™ç§ï¼Œå³ä¼šæŠŠå¾ˆå¤šæ¡æ•°æ®æ•´åˆæˆä¸€æ¡ insert è¯­å¥ï¼Œé‚£ä¹ˆå¦‚æœé‡Œé¢æœ‰ä¸€æ¡æ•°æ®å­˜åœ¨ä¸»é”®å†²çªï¼Œæ•´æ¡ insert å°±ä¼šå¤±è´¥ï¼Œè¿™å°±æ˜¯é€ æˆæ•°æ®é‡ç›¸å·®è¿‡å¤§çš„åŸå› ã€‚æ‰€ä»¥è¿™ç§æƒ…å†µéœ€è¦å¢åŠ  <code>--skip-extended-insert</code> å‚æ•°ã€‚</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202402071656925.png" alt="image.png"></p><h3 id="åº“åä¸ä¸€è‡´å¦‚ä½•ä¿®æ”¹"><a href="#åº“åä¸ä¸€è‡´å¦‚ä½•ä¿®æ”¹" class="headerlink" title="åº“åä¸ä¸€è‡´å¦‚ä½•ä¿®æ”¹"></a>åº“åä¸ä¸€è‡´å¦‚ä½•ä¿®æ”¹</h3><p>ä¸¤ä¸ªç¯å¢ƒåº“åä¸ä¸€è‡´ï¼Œ éœ€è¦ä¿®æ”¹ sql é‡Œé¢çš„åº“åï¼Œ sql æ–‡ä»¶åˆå¤ªå¤§ï¼Œ é€‰æ‹©ä½¿ç”¨ sed å‘½ä»¤æ¥ä¿®æ”¹ (ä¸è¦å°ç§è¿™ä¸€æ­¥ï¼Œæˆ‘ä»¬ä¸€ä¸ª 24G çš„ sql æ–‡ä»¶ä¿®æ”¹è€—æ—¶ 15 åˆ†é’Ÿå·¦å³)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -e <span class="string">&#x27;s/USE `idk_base`;/USE `db_idk_base`;/g;&#x27;</span> -i test.sql</span><br></pre></td></tr></table></figure><h3 id="ä¸‹è½½ä¸Šä¼ å¤ªæ…¢çš„é—®é¢˜"><a href="#ä¸‹è½½ä¸Šä¼ å¤ªæ…¢çš„é—®é¢˜" class="headerlink" title="ä¸‹è½½ä¸Šä¼ å¤ªæ…¢çš„é—®é¢˜"></a>ä¸‹è½½ä¸Šä¼ å¤ªæ…¢çš„é—®é¢˜</h3><p>é€‰æ‹©æœåŠ¡å™¨ä½¿ç”¨å…¬ç½‘ç›´æ¥ä¼ è¾“ï¼Œä¸å†é€šè¿‡è‡ªå·±çš„ç”µè„‘ä¸­è½¬ã€‚</p><h3 id="è·³æ¿æœºè¶…æ—¶è¢«å…³é—­çš„é—®é¢˜"><a href="#è·³æ¿æœºè¶…æ—¶è¢«å…³é—­çš„é—®é¢˜" class="headerlink" title="è·³æ¿æœºè¶…æ—¶è¢«å…³é—­çš„é—®é¢˜"></a>è·³æ¿æœºè¶…æ—¶è¢«å…³é—­çš„é—®é¢˜</h3><p>åœ¨ mysql å‘½ä»¤è¡Œç•Œé¢æ‰§è¡Œ source å‘½ä»¤ï¼Œ å¦‚æœçª—å£è¢«å…³é—­ï¼Œé‚£ä¹ˆæ‰§è¡Œå°±åœæ­¢äº†ï¼Œ ä½¿ç”¨ nohup åˆæ— æ³•åšåˆ°äº¤äº’å¼æ‰§è¡Œï¼Œ äºæ˜¯é€‰æ‹© screen</p><p>ä½¿ç”¨ screen -L æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„è™šæ‹Ÿçª—å£ï¼ˆ-L å‚æ•°å¯ä»¥å°†æ§åˆ¶å°çš„æ‰€æœ‰è¾“å‡ºè®°å½•åˆ°å½“å‰ç›®å½•ä¸‹çš„ä¸€ä¸ªæ–‡ä»¶å†…ï¼‰ï¼Œ åœ¨é‡Œé¢æ‰§è¡Œ mysql å‘½ä»¤ source å‘½ä»¤åï¼ŒæŒ‰ä¸‹ ctrl +a d å°±å¯ä»¥æ”¾åˆ°åå°æ‰§è¡Œï¼Œ æ‰§è¡Œ screen -r æ¢å¤è¿æ¥ä¹‹å‰çš„ screen ç•Œé¢ã€‚</p><p>screen è¯¦ç»†ä½¿ç”¨æ•™ç¨‹å¯ä»¥æŸ¥çœ‹ <a href="/posts/lm9yw00q">Linuxç»ˆç«¯å¤ç”¨å™¨Screenå’Œtmux</a></p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
            <tag> æ•°æ®è¿ç§» </tag>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>macä¸‹å®ç°å¿«é€Ÿç™»é™†å¸¦æœ‰ä¸¤æ­¥éªŒè¯çš„sshè·³æ¿æœº</title>
      <link href="/posts/ee380870/"/>
      <url>/posts/ee380870/</url>
      
        <content type="html"><![CDATA[<p>æˆ‘ä»¬æœ‰ä¸ªå ¡å’æœºå½“å‰çš„ç™»é™†æµç¨‹æ˜¯ï¼š ssh username@ip -p port â€“&gt; è¾“å…¥å¯†ç  â€“&gt; æ‰“å¼€æ‰‹æœº â€“&gt; æŸ¥çœ‹ä¸¤éƒ¨éªŒè¯ç  â€“&gt; è¾“å…¥ â€“&gt; è¿æ¥æˆåŠŸ</p><h2 id="è§£å†³è¾“å…¥å¯†ç çš„é—®é¢˜"><a href="#è§£å†³è¾“å…¥å¯†ç çš„é—®é¢˜" class="headerlink" title="è§£å†³è¾“å…¥å¯†ç çš„é—®é¢˜"></a>è§£å†³è¾“å…¥å¯†ç çš„é—®é¢˜</h2><p>mac å› ä¸ºå®‰å…¨é—®é¢˜ä½¿ç”¨ brew å·²ç»æ— æ³•å®‰è£… sshpass è¿™ä¸ªåŒ…äº†ï¼Œ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ ssh key æ¥è¿›è¡Œå…å¯†ç™»é™†å¹¶æé«˜å®‰å…¨æ€§ã€‚ä¸åŒçš„è·³æ¿æœºå¹³å°è®¾ç½®æ–¹å¼ä¸å¤ªä¸€æ ·ï¼Œä¸€èˆ¬éƒ½æ˜¯åœ¨ä¸ªäººä¿¡æ¯è®¾ç½®é‡Œé¢å¢åŠ  ssh å…¬é’¥ã€‚</p><p>è¾“å…¥å¯†ç è¿˜å¯ä»¥ç”¨ä¸€ä¸ªå« tssh çš„å¼€æºå·¥å…·æ¥å®ç°ï¼ˆå…¼å®¹ openssh ä¸”æ”¯æŒ lrzszï¼‰</p><h2 id="è§£å†³è¾“å…¥ä¸¤æ­¥éªŒè¯ç çš„é—®é¢˜"><a href="#è§£å†³è¾“å…¥ä¸¤æ­¥éªŒè¯ç çš„é—®é¢˜" class="headerlink" title="è§£å†³è¾“å…¥ä¸¤æ­¥éªŒè¯ç çš„é—®é¢˜"></a>è§£å†³è¾“å…¥ä¸¤æ­¥éªŒè¯ç çš„é—®é¢˜</h2><p>ä¸¤æ­¥éªŒè¯ç å°±æ˜¯ TOTPï¼ŒåŸºäºç”Ÿæˆçš„ 6 ä½æ•°å­—ï¼Œ 30s æ›´æ¢ä¸€æ¬¡ï¼Œ æˆ‘ä»¬éœ€è¦å…ˆæ‹¿åˆ° TOTP çš„ seedï¼Œ ä¸€èˆ¬éƒ½ä¼šç»™ä¸€ä¸ªäºŒç»´ç ï¼Œç”¨äºŒç»´ç è§£æå·¥å…·è§£æï¼Œ è§£æå‡ºæ¥çš„å†…å®¹å¤§è‡´ç±»ä¼¼äºï¼š</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">otpauth://totp/Microsof<span class="variable">t:iuxt</span>@outlook.<span class="keyword">com</span>?secret=XUHHW5TKKTYGMJYM&amp;issuer=Microsoft</span><br></pre></td></tr></table></figure><p>secret&#x3D; åé¢çš„å†…å®¹å°±æ˜¯ TOTP çš„ seed</p><h3 id="ä½¿ç”¨è„šæœ¬æ¥ç”Ÿæˆä¸¤æ­¥éªŒè¯ç "><a href="#ä½¿ç”¨è„šæœ¬æ¥ç”Ÿæˆä¸¤æ­¥éªŒè¯ç " class="headerlink" title="ä½¿ç”¨è„šæœ¬æ¥ç”Ÿæˆä¸¤æ­¥éªŒè¯ç "></a>ä½¿ç”¨è„šæœ¬æ¥ç”Ÿæˆä¸¤æ­¥éªŒè¯ç </h3><p>å¯ä»¥ä½¿ç”¨ python çš„ pyotp åŒ…</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pyotp</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">totp = pyotp.TOTP(sys.argv[<span class="number">1</span>])</span><br><span class="line">totp_password = totp.now()</span><br><span class="line"><span class="built_in">print</span>(totp_password)</span><br></pre></td></tr></table></figure><h3 id="å†™å…¥å‰ªåˆ‡æ¿"><a href="#å†™å…¥å‰ªåˆ‡æ¿" class="headerlink" title="å†™å…¥å‰ªåˆ‡æ¿"></a>å†™å…¥å‰ªåˆ‡æ¿</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 ~/code/tools/totp.py XUHHW5TKKTYGMJYM | pbcopy</span><br></pre></td></tr></table></figure><p>ç„¶åç™»é™†çš„æ—¶å€™ç›´æ¥ç²˜è´´å°±å¯ä»¥äº†ã€‚</p><h2 id="æœ€ç»ˆæ•ˆæœ"><a href="#æœ€ç»ˆæ•ˆæœ" class="headerlink" title="æœ€ç»ˆæ•ˆæœ"></a>æœ€ç»ˆæ•ˆæœ</h2><p>~&#x2F;.zshrc é‡Œé¢çš„å†…å®¹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">alias</span> <span class="built_in">test</span>=<span class="string">&#x27;python3 ~/code/tools/totp.py XUHHW5TKKTYGMJYM | pbcopy &amp;&amp; ssh xxx@x.x.x.x -p 60022&#x27;</span></span><br></pre></td></tr></table></figure><p>éœ€è¦è¿æ¥è·³æ¿æœºçš„æ—¶å€™ï¼Œ ç›´æ¥æ‰§è¡Œ testï¼Œ ç„¶åç²˜è´´å³å¯ã€‚ è™½ç„¶æ²¡æœ‰å®Œå…¨è‡ªåŠ¨åŒ–ï¼Œ ä½†æ˜¯ä¹Ÿä¸ç”¨ä½å¤´æ‰“å¼€æ‰‹æœºæŸ¥çœ‹éªŒè¯ç äº†ã€‚</p><p>iterm2 å¸¦æœ‰ actionï¼Œ å¯ä»¥æ ¹æ®å±å¹•æ˜¾ç¤ºæ¥æ‰§è¡Œå‘½ä»¤ï¼Œ ç†è®ºä¸Šå¯ä»¥è‡ªåŠ¨å¡«å…… TOTPï¼Œæš‚æ—¶æ²¡æœ‰æ—¶é—´æµ‹è¯•ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•ˆç‡å·¥å…· </tag>
            
            <tag> mac </tag>
            
            <tag> python </tag>
            
            <tag> pyotp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨echo serveræµ‹è¯•ingress-nginxæœåŠ¡</title>
      <link href="/posts/635c073a/"/>
      <url>/posts/635c073a/</url>
      
        <content type="html"><![CDATA[<p>è¿™ä¸ªæ˜¯ <a href="/posts/c86b58e3">ç°åº¦çš„æ–¹æ¡ˆ</a></p><h2 id="åˆ›å»ºæ­£å¼ç¯å¢ƒçš„æœåŠ¡"><a href="#åˆ›å»ºæ­£å¼ç¯å¢ƒçš„æœåŠ¡" class="headerlink" title="åˆ›å»ºæ­£å¼ç¯å¢ƒçš„æœåŠ¡"></a>åˆ›å»ºæ­£å¼ç¯å¢ƒçš„æœåŠ¡</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Deployment</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">production</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">production</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">production</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">production</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">production</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">registry.k8s.io/ingress-nginx/e2e-test-echo@sha256:6fc5aa2994c86575975bb20a5203651207029a0d28e3f491d8a127d08baadab4</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">NODE_NAME</span></span><br><span class="line">            <span class="attr">valueFrom:</span></span><br><span class="line">              <span class="attr">fieldRef:</span></span><br><span class="line">                <span class="attr">fieldPath:</span> <span class="string">spec.nodeName</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">POD_NAME</span></span><br><span class="line">            <span class="attr">valueFrom:</span></span><br><span class="line">              <span class="attr">fieldRef:</span></span><br><span class="line">                <span class="attr">fieldPath:</span> <span class="string">metadata.name</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">POD_NAMESPACE</span></span><br><span class="line">            <span class="attr">valueFrom:</span></span><br><span class="line">              <span class="attr">fieldRef:</span></span><br><span class="line">                <span class="attr">fieldPath:</span> <span class="string">metadata.namespace</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">POD_IP</span></span><br><span class="line">            <span class="attr">valueFrom:</span></span><br><span class="line">              <span class="attr">fieldRef:</span></span><br><span class="line">                <span class="attr">fieldPath:</span> <span class="string">status.podIP</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># Service</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">production</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">production</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">http</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">production</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># Ingress</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">production</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ingressClassName:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">echo.prod.mydomain.com</span></span><br><span class="line">    <span class="attr">http:</span></span><br><span class="line">      <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">pathType:</span> <span class="string">Prefix</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">/</span></span><br><span class="line">        <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">service:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">production</span></span><br><span class="line">            <span class="attr">port:</span></span><br><span class="line">              <span class="attr">number:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure><h2 id="åˆ›å»ºç°åº¦ç¯å¢ƒçš„æœåŠ¡"><a href="#åˆ›å»ºç°åº¦ç¯å¢ƒçš„æœåŠ¡" class="headerlink" title="åˆ›å»ºç°åº¦ç¯å¢ƒçš„æœåŠ¡"></a>åˆ›å»ºç°åº¦ç¯å¢ƒçš„æœåŠ¡</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># Deployment</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">canary</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">canary</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">canary</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">canary</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">canary</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">registry.k8s.io/ingress-nginx/e2e-test-echo@sha256:6fc5aa2994c86575975bb20a5203651207029a0d28e3f491d8a127d08baadab4</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">NODE_NAME</span></span><br><span class="line">            <span class="attr">valueFrom:</span></span><br><span class="line">              <span class="attr">fieldRef:</span></span><br><span class="line">                <span class="attr">fieldPath:</span> <span class="string">spec.nodeName</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">POD_NAME</span></span><br><span class="line">            <span class="attr">valueFrom:</span></span><br><span class="line">              <span class="attr">fieldRef:</span></span><br><span class="line">                <span class="attr">fieldPath:</span> <span class="string">metadata.name</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">POD_NAMESPACE</span></span><br><span class="line">            <span class="attr">valueFrom:</span></span><br><span class="line">              <span class="attr">fieldRef:</span></span><br><span class="line">                <span class="attr">fieldPath:</span> <span class="string">metadata.namespace</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">POD_IP</span></span><br><span class="line">            <span class="attr">valueFrom:</span></span><br><span class="line">              <span class="attr">fieldRef:</span></span><br><span class="line">                <span class="attr">fieldPath:</span> <span class="string">status.podIP</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># Service</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">canary</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">canary</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">http</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">canary</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># Ingress</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">canary</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/canary:</span> <span class="string">\&quot;true\&quot;</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/canary-weight:</span> <span class="string">\&quot;50\&quot;</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ingressClassName:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">echo.prod.mydomain.com</span></span><br><span class="line">    <span class="attr">http:</span></span><br><span class="line">      <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">pathType:</span> <span class="string">Prefix</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">/</span></span><br><span class="line">        <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">service:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">canary</span></span><br><span class="line">            <span class="attr">port:</span></span><br><span class="line">              <span class="attr">number:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure><h2 id="å¯¹ç°åº¦è¿›è¡Œæµ‹è¯•"><a href="#å¯¹ç°åº¦è¿›è¡Œæµ‹è¯•" class="headerlink" title="å¯¹ç°åº¦è¿›è¡Œæµ‹è¯•"></a>å¯¹ç°åº¦è¿›è¡Œæµ‹è¯•</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨åŸŸåè®¿é—®</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(<span class="built_in">seq</span> 1 10); <span class="keyword">do</span> curl -s --resolve echo.prod.mydomain.com:80:<span class="variable">$INGRESS_CONTROLLER_IP</span> echo.prod.mydomain.com  | grep <span class="string">&quot;Hostname&quot;</span>; <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¸¦ä¸Šheaderè®¿é—®</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(<span class="built_in">seq</span> 1 100); <span class="keyword">do</span> curl -s -H <span class="string">&quot;gray:never&quot;</span> https://test.i.com  -k | grep <span class="string">&quot;Hostname&quot;</span>; <span class="keyword">done</span> | grep -c canary</span><br></pre></td></tr></table></figure><p>è¾“å‡ºå¤§æ¦‚ç±»ä¼¼äºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Hostname: production-5c5f65d859-phqzc</span><br><span class="line">Hostname: canary-6697778457-zkfjf</span><br><span class="line">Hostname: canary-6697778457-zkfjf</span><br><span class="line">Hostname: production-5c5f65d859-phqzc</span><br><span class="line">Hostname: canary-6697778457-zkfjf</span><br><span class="line">Hostname: production-5c5f65d859-phqzc</span><br><span class="line">Hostname: production-5c5f65d859-phqzc</span><br><span class="line">Hostname: production-5c5f65d859-phqzc</span><br><span class="line">Hostname: canary-6697778457-zkfjf</span><br><span class="line">Hostname: production-5c5f65d859-phqzc</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å®¹å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æµ‹è¯• </tag>
            
            <tag> echo-server </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Prometheusæ ‡ç­¾å¤„ç†</title>
      <link href="/posts/prometheus_tag/"/>
      <url>/posts/prometheus_tag/</url>
      
        <content type="html"><![CDATA[<h2 id="å…ƒæ ‡ç­¾"><a href="#å…ƒæ ‡ç­¾" class="headerlink" title="å…ƒæ ‡ç­¾"></a>å…ƒæ ‡ç­¾</h2><p>åœ¨è¢«ç›‘æ§ç«¯çº³å…¥æ™®ç½—ç±³ä¿®æ–¯é‡Œé¢å®šä¹‰äº†ä¸€äº›å…ƒæ•°æ®æ ‡ç­¾<br>åœ¨ Prometheus æ‰€æœ‰çš„ Target å®ä¾‹ä¸­ï¼Œéƒ½åŒ…å«ä¸€äº›é»˜è®¤çš„ Metadata æ ‡ç­¾ä¿¡æ¯ã€‚å¯ä»¥é€šè¿‡ Prometheus UI çš„ Status é‡Œé¢çš„ Service Discovery æŸ¥çœ‹</p><table><thead><tr><th>Metadata æ ‡ç­¾</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>address</strong></td><td>å½“å‰ Target å®ä¾‹çš„è®¿é—®åœ°å€ host:port</td></tr><tr><td><strong>scheme</strong></td><td>é‡‡é›†ç›®æ ‡æœåŠ¡è®¿é—®åœ°å€çš„ HTTP Schemeï¼ŒHTTP æˆ–è€… HTTPS</td></tr><tr><td><strong>metrics_path</strong></td><td>é‡‡é›†ç›®æ ‡æœåŠ¡è®¿é—®åœ°å€çš„è®¿é—®è·¯å¾„</td></tr></tbody></table><p>ä¸Šé¢è¿™äº›æ ‡ç­¾å°†ä¼šå‘Šè¯‰ Prometheus å¦‚ä½•ä»è¯¥ Target å®ä¾‹ä¸­è·å–ç›‘æ§æ•°æ®ã€‚é™¤äº†è¿™äº›é»˜è®¤çš„æ ‡ç­¾ä»¥å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä¸º Target æ·»åŠ è‡ªå®šä¹‰çš„æ ‡ç­¾ã€‚</p><p>å…ƒæ ‡ç­¾æ˜¯ä¸ä¼šå†™åˆ°æ•°æ®åº“å½“ä¸­çš„ï¼Œä½¿ç”¨ promql æ˜¯æŸ¥è¯¢ä¸åˆ°è¿™äº›æ ‡ç­¾çš„ï¼Œå¦‚æœéœ€è¦æºæ ‡ç­¾çš„æ•°æ®ï¼ˆæ¯”å¦‚ k8s éƒ¨ç½²çš„ Prometheus ä½¿ç”¨è‡ªåŠ¨å‘ç°è·å– pod ç›‘æ§ï¼‰ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦æŠŠä¸€äº›å…ƒæ ‡ç­¾é‡æ–°æ‰“æ ‡ç­¾æ¥ä½¿ç”¨ã€‚</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202307311829414.png"></p><p>æ¯”å¦‚ä¸Šå›¾ï¼Œç›‘æ§ k8s çš„ pod çŠ¶æ€ï¼Œ å› ä¸º pod æ˜¯åŠ¨æ€çš„ï¼Œæ‰€ä»¥éœ€è¦ pod åå­—å’Œ pod çš„ namespace ä¿¡æ¯ï¼Œå°±å¯ä»¥ä»å…ƒæ ‡ç­¾ä¸­å–å€¼ã€‚</p><h2 id="è‡ªå®šä¹‰æ ‡ç­¾"><a href="#è‡ªå®šä¹‰æ ‡ç­¾" class="headerlink" title="è‡ªå®šä¹‰æ ‡ç­¾"></a>è‡ªå®šä¹‰æ ‡ç­¾</h2><p>å¯ä»¥é’ˆå¯¹ç‰¹å®šçš„æ ‡ç­¾å»æŸ¥è¯¢ï¼Œæ¯”å¦‚æ ¹æ®å‚å•†ã€é¡¹ç›®ç­‰æ¥åŒºåˆ†ã€‚</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;Beijing Linux Server&#x27;</span></span><br><span class="line">  <span class="attr">static_configs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;192.168.179.99:9100&#x27;</span>]</span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">address:</span> <span class="string">beijing</span></span><br><span class="line">      <span class="attr">project:</span> <span class="string">mysql</span></span><br><span class="line"> </span><br><span class="line"><span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;Shanghai Linux Server&#x27;</span></span><br><span class="line">  <span class="attr">static_configs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;192.168.179.99:9100&#x27;</span>]</span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">address:</span> <span class="string">shanghai</span></span><br><span class="line">      <span class="attr">project:</span> <span class="string">www</span></span><br></pre></td></tr></table></figure><h2 id="é‡æ–°æ ‡è®°æ ‡ç­¾"><a href="#é‡æ–°æ ‡è®°æ ‡ç­¾" class="headerlink" title="é‡æ–°æ ‡è®°æ ‡ç­¾"></a>é‡æ–°æ ‡è®°æ ‡ç­¾</h2><p>action é‡æ–°æ ‡è®°æ ‡ç­¾åŠ¨ä½œ, å¯ä»¥å–çš„å€¼æœ‰ï¼š</p><table><thead><tr><th>åŠ¨ä½œ</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>replace</td><td>é»˜è®¤ï¼Œé€šè¿‡ regex åŒ¹é… source_label çš„å€¼ï¼Œä½¿ç”¨ replacement æ¥å¼•ç”¨è¡¨è¾¾å¼åŒ¹é…çš„åˆ†ç»„ï¼Œåˆ†ç»„ä½¿ç”¨ $1,$2â€¦å¼•ç”¨ï¼ˆæ­£åˆ™åŒ¹é…ï¼Œæå–å­—æ®µåˆ›å»ºæ–°æ ‡ç­¾ï¼‰</td></tr><tr><td>keep</td><td>åˆ é™¤ regex ä¸è¿æ¥ä¸åŒ¹é…çš„ç›®æ ‡ source_labels ï¼Œ keep drop å°±æ˜¯è®©æ™®ç½—ç±³ä¿®æ–¯é‡‡é›†å’Œä¸é‡‡é›†å“ªäº›ç›®æ ‡</td></tr><tr><td>drop</td><td>åˆ é™¤ regex ä¸è¿æ¥åŒ¹é…çš„ç›®æ ‡ source_labels</td></tr><tr><td>labeldrop</td><td>åˆ é™¤ regex åŒ¹é…çš„æ ‡ç­¾</td></tr><tr><td>labelkeep</td><td>åˆ é™¤ regex ä¸åŒ¹é…çš„æ ‡ç­¾</td></tr><tr><td>labelmap</td><td>åŒ¹é… regex æ‰€æœ‰æ ‡ç­¾åç§°ï¼Œå¹¶å°†æ•è·çš„å†…å®¹åˆ†ç»„ï¼Œç”¨ç¬¬ä¸€ä¸ªåˆ†ç»„å†…å®¹ä½œä¸ºæ–°çš„æ ‡ç­¾åï¼ˆä½¿ç”¨æ­£åˆ™æå–å‡ºå¤šä¸ªå­—æ®µï¼Œä½¿ç”¨åŒ¹é…åˆ°çš„ä½œä¸ºæ–°æ ‡ç­¾åï¼Œä½†æ˜¯æ ‡ç­¾çš„å†…å®¹ä¸ä¼šæ”¹å˜ï¼Œç›¸å¯¹äºå¯¹åŸæœ‰æ ‡ç­¾æ¢äº†ä¸ªåå­—ï¼‰</td></tr></tbody></table><h2 id="ä¸¾ä¾‹"><a href="#ä¸¾ä¾‹" class="headerlink" title="ä¸¾ä¾‹"></a>ä¸¾ä¾‹</h2><h3 id="åŠ¨æ€ç”Ÿæˆæ·»åŠ æ ‡ç­¾ï¼ˆå¯¹å·²æœ‰çš„æ ‡ç­¾é‡æ–°æ ‡è®°ï¼‰"><a href="#åŠ¨æ€ç”Ÿæˆæ·»åŠ æ ‡ç­¾ï¼ˆå¯¹å·²æœ‰çš„æ ‡ç­¾é‡æ–°æ ‡è®°ï¼‰" class="headerlink" title="åŠ¨æ€ç”Ÿæˆæ·»åŠ æ ‡ç­¾ï¼ˆå¯¹å·²æœ‰çš„æ ‡ç­¾é‡æ–°æ ‡è®°ï¼‰"></a>åŠ¨æ€ç”Ÿæˆæ·»åŠ æ ‡ç­¾ï¼ˆå¯¹å·²æœ‰çš„æ ‡ç­¾é‡æ–°æ ‡è®°ï¼‰</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;Linux Server&#x27;</span></span><br><span class="line">  <span class="attr">static_configs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;192.168.179.99:9100&#x27;</span>]</span><br><span class="line">  <span class="attr">metric_relabel_configs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">action:</span> <span class="string">replace</span></span><br><span class="line">    <span class="attr">source_labels:</span> [<span class="string">&quot;instance&quot;</span>]</span><br><span class="line">    <span class="attr">regex:</span> <span class="string">(.*):([0-9]+)</span>  <span class="comment"># æ­£åˆ™åŒ¹é…æ ‡ç­¾å€¼ï¼Œ( )åˆ†ç»„</span></span><br><span class="line">    <span class="attr">replacement:</span> <span class="string">$1</span>       <span class="comment"># å¼•ç”¨åˆ†ç»„åŒ¹é…çš„å†…å®¹</span></span><br><span class="line">    <span class="attr">target_label:</span> <span class="string">&quot;ip&quot;</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°è¯¥æ ‡ç­¾å·²ç»è¿›å…¥æ•°æ®åº“é‡Œé¢äº†ï¼Œè¿™æ ·å°±æ ¹æ®æºæ ‡ç­¾é€šè¿‡æ­£åˆ™åŒ¹é…åŠ¨æ€ç”Ÿæˆäº†æ–°çš„æ ‡ç­¾</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202307311816271.png"></p><h3 id="é€‰æ‹©é‡‡é›†çš„ç›®æ ‡"><a href="#é€‰æ‹©é‡‡é›†çš„ç›®æ ‡" class="headerlink" title="é€‰æ‹©é‡‡é›†çš„ç›®æ ‡"></a>é€‰æ‹©é‡‡é›†çš„ç›®æ ‡</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;Linux Server&#x27;</span></span><br><span class="line">  <span class="attr">static_configs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;192.168.179.99:9100&#x27;</span>]</span><br><span class="line">  <span class="attr">relabel_configs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">action:</span> <span class="string">drop</span></span><br><span class="line">    <span class="attr">regex:</span> <span class="string">&quot;192.168.179.99:9100&quot;</span>   <span class="comment"># æ­£åˆ™åŒ¹é…æ ‡ç­¾å€¼</span></span><br><span class="line">    <span class="attr">source_labels:</span> [<span class="string">&quot;_address_&quot;</span>]</span><br></pre></td></tr></table></figure><p>åœ¨ target é‡Œé¢å°±æ²¡æœ‰äº†ï¼Œåœ¨æ™®ç½—ç±³ä¿®æ–¯é‡Œé¢å°±çœ‹ä¸åˆ°è¯¥å°æœºå™¨ï¼ŒåŒæ—¶ exporter ä¹Ÿä¸ä¼šè¢«åœæ­¢.</p><h3 id="åˆ é™¤æ ‡ç­¾"><a href="#åˆ é™¤æ ‡ç­¾" class="headerlink" title="åˆ é™¤æ ‡ç­¾"></a>åˆ é™¤æ ‡ç­¾</h3><p>æœ‰äº›æ ‡ç­¾ä¸å¸Œæœ›è¢«å­˜å‚¨ä¸Šï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ labeldrop, åˆ é™¤ regex åŒ¹é…çš„æ ‡ç­¾å»å®Œæˆä¸éœ€è¦å…¥åº“ å°†é‡Œé¢çš„æ ‡ç­¾åˆ é™¤æ‰ï¼Œåœ¨å…¥åº“ä¹‹å‰åˆ é™¤</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;Linux Server&#x27;</span></span><br><span class="line">  <span class="attr">static_configs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;192.168.179.99:9100&#x27;</span>]</span><br><span class="line">  <span class="attr">relabel_configs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">action:</span> <span class="string">labeldrop</span></span><br><span class="line">    <span class="attr">regex:</span> <span class="string">&quot;job&quot;</span>   <span class="comment">#æ­£åˆ™åŒ¹é…æ ‡ç­¾åç§°</span></span><br></pre></td></tr></table></figure><h3 id="keep"><a href="#keep" class="headerlink" title="keep"></a>keep</h3><p>Keep åªæœ‰åŒ¹é…çš„æ‰ä¼šå»é‡‡é›†æ•°æ®ï¼Œä¸åŒ¹é…çš„å°±ä¸é‡‡é›†ã€‚ä¸‹é¢æ„æ€å°±æ˜¯ pod å½“ä¸­æœ‰äº›æ³¨è§£ä¸­å£°æ˜äº† prometheus_io_scrape è¿™ä¸ªå­—æ®µï¼Œé‚£ä¹ˆå°±ä¼šæŠŠä½ çº³å…¥ç›‘æ§ï¼Œå¦‚æœæ²¡æœ‰å£°æ˜å°±ä¸ä¼šçº³å…¥ç›‘æ§ã€‚ä¹Ÿå°±æ˜¯ k8s å½“ä¸­éƒ¨ç½²äº†è¿™ä¹ˆå¤š podï¼Œè°è¦ç›‘æ§ï¼Œè°ä¸è¦è¢«ç›‘æ§ï¼Œåœ¨éƒ¨ç½² service å¯ä»¥æŒ‡å®šæ˜¯å¦éœ€è¦é‡‡é›†ï¼Œå¦‚æœéœ€è¦é‡‡é›†éœ€è¦åœ¨æ³¨è§£å½“ä¸­å£°æ˜ prometheus_io_scrape: true</p><p>åœ¨ service é‡Œé¢å£°æ˜é…ç½®æ³¨è§£ï¼Œé‚£ä¹ˆå°±ä¼šé‡‡é›†æ³¨è§£é‡Œé¢å«æœ‰è¿™ä¸ªå€¼çš„</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">annotations:</span></span><br><span class="line">  <span class="attr">prometheus.io/scrape:</span> <span class="string">&#x27;true&#x27;</span></span><br></pre></td></tr></table></figure><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># å¸¦æ³¨è§£  prometheus.io/scrape: true  çš„æ‰ä¼šè¢«é‡‡é›†ï¼Œä¸ç„¶ä¸é‡‡é›†ï¼Œä¸å…¥åº“</span><br><span class="line">- source_labels: [__meta_kubernetes_service_annotation_prometheus_io_scrape]</span><br><span class="line">  action: keep</span><br><span class="line">  regex: true</span><br></pre></td></tr></table></figure><h3 id="replace"><a href="#replace" class="headerlink" title="replace"></a>replace</h3><p>å¤„ç†ç›‘æ§ pod è¿æ¥çš„ ip åœ°å€ï¼Œapi æ¥å£ï¼Œè¿˜æœ‰åè®®éƒ½éœ€è¦é‡æ–°æ ‡è®°é»˜è®¤çš„å­—æ®µ</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é‡å‘½åé‡‡é›†ç›®æ ‡åè®®</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">action:</span> <span class="string">replace</span></span><br><span class="line">  <span class="attr">regex:</span> <span class="string">(https?)</span></span><br><span class="line">  <span class="attr">source_labels:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">__meta_kubernetes_service_annotation_prometheus_io_scheme</span></span><br><span class="line">  <span class="attr">target_label:</span> <span class="string">__scheme__</span></span><br><span class="line"><span class="comment"># é‡å‘½åé‡‡é›†ç›®æ ‡æŒ‡æ ‡URLè·¯å¾„</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">action:</span> <span class="string">replace</span></span><br><span class="line">  <span class="attr">regex:</span> <span class="string">(.+)</span></span><br><span class="line">  <span class="attr">source_labels:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">__meta_kubernetes_service_annotation_prometheus_io_path</span></span><br><span class="line">  <span class="attr">target_label:</span> <span class="string">__metrics_path__</span></span><br><span class="line"><span class="comment"># é‡å‘½åé‡‡é›†ç›®æ ‡åœ°å€</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">action:</span> <span class="string">replace</span></span><br><span class="line">  <span class="attr">regex:</span> <span class="string">([^:]+)(?::\d+)?;(\d+)</span></span><br><span class="line">  <span class="attr">replacement:</span> <span class="string">$1:$2</span></span><br><span class="line">  <span class="attr">source_labels:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">__address__</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">__meta_kubernetes_service_annotation_prometheus_io_port</span></span><br><span class="line">  <span class="attr">target_label:</span> <span class="string">__address__</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œå°±å¯ä»¥ä½¿ç”¨æ–°çš„æ ‡ç­¾ kubernetes_namespace åœ¨ promql é‡Œé¢åŸºäºå‘½åç©ºé—´è¿™ä¸ªæ ‡ç­¾å»æŸ¥è¯¢äº†ï¼Œå› ä¸º __meta_kubernetes_namespace è¿™ä¸ªæ ‡ç­¾æ˜¯ä¸ä¼šè¢«å­˜å‚¨çš„</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç”Ÿæˆå‘½åç©ºé—´æ ‡ç­¾</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">action:</span> <span class="string">replace</span></span><br><span class="line">  <span class="attr">source_labels:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">__meta_kubernetes_namespace</span></span><br><span class="line">  <span class="attr">target_label:</span> <span class="string">kubernetes_namespace</span></span><br></pre></td></tr></table></figure><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¿®æ”¹NodeIP:10250ä¸ºAPIServerIP:6443</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">action:</span> <span class="string">replace</span></span><br><span class="line">  <span class="attr">regex:</span> <span class="string">(.*)</span></span><br><span class="line">  <span class="attr">source_labels:</span> [<span class="string">&quot;__address__&quot;</span>]  <span class="string">æºæ ‡ç­¾é…åŒ¹ä¸ºaddress</span></span><br><span class="line">  <span class="attr">target_label:</span> <span class="string">__address__</span></span><br><span class="line">  <span class="attr">replacement:</span> <span class="number">192.168</span><span class="number">.31</span><span class="number">.61</span><span class="string">:6443</span></span><br></pre></td></tr></table></figure><h3 id="labelmap"><a href="#labelmap" class="headerlink" title="labelmap"></a>labelmap</h3><p>åšä¸Šé¢è¿™äº›äº‹æƒ…æ˜¯æœ‰ä¸¤ä¸ªé˜¶æ®µçš„ï¼Œä¸€ä¸ªæ˜¯é‡‡é›†ä¹‹å‰ï¼Œä¸€ä¸ªæ˜¯é‡‡é›†ä¹‹åï¼Œå¦‚æœåœ¨é‡‡é›†ä¹‹å‰é‡æ–°å®šä¹‰æ ‡ç­¾æ²¡ç”Ÿæ•ˆï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨é‡‡é›†ä¹‹åçš„æ ‡ç­¾ï¼ˆå› ä¸ºä½¿ç”¨çš„æ˜¯ k8s çš„æœåŠ¡å‘ç°ï¼Œä¸ç®¡ç”¨çš„æ˜¯å“ªä¸ªæœåŠ¡å‘ç°ï¼Œé»˜è®¤å¸¦çš„éƒ½æ˜¯æºæ ‡ç­¾ __meta_kubernetes_node_label æ¯”å¦‚ consul é‚£ä¹ˆå°±æ˜¯ä»¥ consul å¼€å¤´çš„ï¼Œè¿™äº›ä¸åŒæœåŠ¡å‘ç°çš„æ ‡ç­¾å°±æ˜¯ä¸ºäº†æ–°æ ‡ç­¾çš„ç”Ÿæˆï¼Œå°±æ˜¯ä¸ºäº†æ›´åŠ å¥½çš„æ ‡è¯†ç›‘æ§æŒ‡æ ‡ï¼Œæºæ ‡ç­¾æ˜¯ä¸ä¼šå…¥åº“çš„ï¼‰</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">relabel_configs:</span></span><br><span class="line">  <span class="comment"># å°†æ ‡ç­¾(.*)ä½œä¸ºæ–°æ ‡ç­¾åï¼ŒåŸæœ‰å€¼ä¸å˜ï¼ˆæ–°çš„æ ‡ç­¾åå­—ä¼šè¢«å…¥åº“æŸ¥è¯¢ï¼‰</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">action:</span> <span class="string">labelmap</span></span><br><span class="line">    <span class="attr">regex:</span> <span class="string">__meta_kubernetes_node_label_(.*)</span> </span><br></pre></td></tr></table></figure><p>(.<em>) ä»¥å…¶å¼€å¤´æ‰€æœ‰å€¼åŒ¹é…åˆ°ï¼Œç”¨è¿™ä¸ªåŒ¹é…çš„å€¼ä½œä¸ºæ–°çš„æ ‡ç­¾åå­—ï¼Œæ–°çš„æ ‡ç­¾åå­—å°±å¯ä»¥å…¥åº“ï¼Œå°±ä¼šè¢«æŸ¥è¯¢ï¼Œå› ä¸ºå…ƒæ ‡ç­¾ä»¥ä¸‹åˆ’çº¿å¼€å¤´çš„æ˜¯ä¸ä¼šå…¥åº“çš„ï¼Œåé¢æ˜¯ç”¨ä¸äº†çš„&#x2F;è¿™æ ·åšçš„ç›®çš„å°±æ˜¯å°†åé¢ (.</em>) åŒ¹é…çš„å€¼ä½œä¸ºä¸€ä¸ªæ–°æ ‡ç­¾ï¼Œå¹¶ä¸”å°†åŸæœ‰å€¼èµ‹äºˆæ–°æ ‡ç­¾ï¼Œåé¢å¯ä»¥åŸºäºè¿™ä¸ªæ–°æ ‡ç­¾æŸ¥è¯¢æ•°æ®äº†</p><p>åŸæ–‡é“¾æ¥ï¼š<a href="https://blog.csdn.net/qq_34556414/article/details/113503945">https://blog.csdn.net/qq_34556414/article/details/113503945</a></p>]]></content>
      
      
      <categories>
          
          <category> ç›‘æ§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> prometheus </tag>
            
            <tag> ç›‘æ§ </tag>
            
            <tag> Prometheus </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åœ¨Windowsä¸‹ä»¥æœåŠ¡æ–¹å¼è¿è¡ŒMySQL</title>
      <link href="/posts/c1f1096a/"/>
      <url>/posts/c1f1096a/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸‹è½½"><a href="#ä¸‹è½½" class="headerlink" title="ä¸‹è½½"></a>ä¸‹è½½</h2><p>æœ¬æ–‡å®‰è£…çš„æ˜¯ zip åŒ…, å®‰è£…æ–¹å¼æ›´çµæ´»</p><p>ä¸‹è½½åœ°å€: <a href="https://dev.mysql.com/downloads/mysql/">https://dev.mysql.com/downloads/mysql/</a></p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202307242242296.png" alt="ä¸‹è½½é¡µé¢"></p><h2 id="åˆ›å»ºé…ç½®æ–‡ä»¶"><a href="#åˆ›å»ºé…ç½®æ–‡ä»¶" class="headerlink" title="åˆ›å»ºé…ç½®æ–‡ä»¶"></a>åˆ›å»ºé…ç½®æ–‡ä»¶</h2><p>åœ¨ mysql æ ¹ç›®å½•ä¸‹åˆ›å»º <code>my.ini</code> æ–‡ä»¶,è¾“å…¥ä»¥ä¸‹å†…å®¹ (æ ¹æ®è‡ªå·±éœ€æ±‚è°ƒæ•´):</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[mysql]</span></span><br><span class="line"><span class="comment"># è®¾ç½®mysqlå®¢æˆ·ç«¯é»˜è®¤å­—ç¬¦é›†</span></span><br><span class="line"><span class="attr">default-character-set</span> = utf8mb4</span><br><span class="line"></span><br><span class="line"><span class="section">[mysqld]</span></span><br><span class="line"><span class="comment"># è®¾ç½®ç«¯å£</span></span><br><span class="line"><span class="attr">port</span> = <span class="number">3306</span></span><br><span class="line"><span class="comment"># è®¾ç½®mysqlæ•°æ®åº“çš„æ•°æ®çš„å­˜æ”¾ç›®å½•, ä¹Ÿå¯ä»¥ç”¨ç›¸å¯¹è·¯å¾„,é»˜è®¤ä¸ºå½“å‰ç›®å½•ä¸‹çš„dataç›®å½•</span></span><br><span class="line"><span class="attr">datadir</span> = C:/Users/iuxt/<span class="literal">On</span>eDrive/<span class="number">1</span>/mysqld/data</span><br><span class="line"><span class="comment"># å…è®¸æœ€å¤§è¿æ¥æ•°</span></span><br><span class="line"><span class="attr">max_connections</span> = <span class="number">200</span></span><br><span class="line"><span class="comment"># è®¾ç½®æœåŠ¡ç«¯ä½¿ç”¨çš„å­—ç¬¦é›†</span></span><br><span class="line"><span class="attr">character-set-server</span> = utf8mb4</span><br><span class="line"><span class="comment"># åˆ›å»ºæ–°è¡¨æ—¶å°†ä½¿ç”¨çš„é»˜è®¤å­˜å‚¨å¼•æ“</span></span><br><span class="line"><span class="attr">default-storage-engine</span> = INNODB</span><br><span class="line"><span class="comment"># è®¾ç½®redologæ—¥å¿—æ–‡ä»¶å¤§å°</span></span><br><span class="line"><span class="attr">innodb_log_file_size</span> = <span class="number">256</span>M</span><br><span class="line"><span class="comment"># å…³é—­binlog</span></span><br><span class="line">disable-log-bin</span><br><span class="line"><span class="comment"># è¡¨åä¸åŒºåˆ†å¤§å°å†™</span></span><br><span class="line"><span class="attr">lower_case_table_names</span> = <span class="number">1</span></span><br></pre></td></tr></table></figure><h2 id="åˆå§‹åŒ–æ•°æ®åº“"><a href="#åˆå§‹åŒ–æ•°æ®åº“" class="headerlink" title="åˆå§‹åŒ–æ•°æ®åº“"></a>åˆå§‹åŒ–æ•°æ®åº“</h2><p>æ²¡æœ‰ data ç›®å½•çš„è¯, éœ€è¦å…ˆåˆå§‹åŒ–æ‰èƒ½ç»§ç»­å…¶ä»–æ“ä½œ.</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.\bin\mysqld.exe --initialize</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨ data ç›®å½•ä¸‹, æœ‰ä¸ª <code>&lt;è®¡ç®—æœºå&gt;.err</code> æ–‡ä»¶, è¿™ä¸ªæ–‡ä»¶é‡Œé¢å°±åŒ…å«äº†ä¸´æ—¶å¯†ç .</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.\bin\mysql.exe -h127.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span> -uroot -p</span><br></pre></td></tr></table></figure><p>è¾“å…¥åˆšæ‰çœ‹åˆ°çš„ä¸´æ—¶å¯†ç , ç™»å½•æˆåŠŸåæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä¿®æ”¹é»˜è®¤ root å¯†ç , åˆ›å»ºè¿œç¨‹ root ç”¨æˆ·</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">user</span> <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">WITH</span> mysql_native_password <span class="keyword">BY</span> <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line"><span class="keyword">Grant</span> <span class="keyword">all</span> privileges <span class="keyword">on</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">to</span> <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;%&#x27;</span> <span class="keyword">with</span> <span class="keyword">grant</span> option;</span><br></pre></td></tr></table></figure><h2 id="ç›´æ¥å¯åŠ¨-ä¸æ¨è"><a href="#ç›´æ¥å¯åŠ¨-ä¸æ¨è" class="headerlink" title="ç›´æ¥å¯åŠ¨ (ä¸æ¨è)"></a>ç›´æ¥å¯åŠ¨ (ä¸æ¨è)</h2><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.\bin\mysqld.exe</span><br></pre></td></tr></table></figure><h2 id="é€šè¿‡æœåŠ¡å¯åŠ¨"><a href="#é€šè¿‡æœåŠ¡å¯åŠ¨" class="headerlink" title="é€šè¿‡æœåŠ¡å¯åŠ¨"></a>é€šè¿‡æœåŠ¡å¯åŠ¨</h2><p>é€šè¿‡æœåŠ¡èµ·çš„çš„è¯, <code>my.ini</code> é…ç½®æ–‡ä»¶é‡Œé¢å°±ä¸èƒ½å†™ç›¸å¯¹è·¯å¾„äº†.</p><h3 id="å®‰è£…æœåŠ¡"><a href="#å®‰è£…æœåŠ¡" class="headerlink" title="å®‰è£…æœåŠ¡"></a>å®‰è£…æœåŠ¡</h3><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqld.exe install mysqld</span><br></pre></td></tr></table></figure><h3 id="å¯åŠ¨æœåŠ¡"><a href="#å¯åŠ¨æœåŠ¡" class="headerlink" title="å¯åŠ¨æœåŠ¡"></a>å¯åŠ¨æœåŠ¡</h3><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">net</span> <span class="built_in">start</span> mysqld</span><br></pre></td></tr></table></figure><h3 id="åœæ­¢æœåŠ¡"><a href="#åœæ­¢æœåŠ¡" class="headerlink" title="åœæ­¢æœåŠ¡"></a>åœæ­¢æœåŠ¡</h3><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">net</span> stop mysqld</span><br></pre></td></tr></table></figure><h3 id="åˆ é™¤æœåŠ¡"><a href="#åˆ é™¤æœåŠ¡" class="headerlink" title="åˆ é™¤æœåŠ¡"></a>åˆ é™¤æœåŠ¡</h3><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sc delete mysqld</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
            <tag> æœåŠ¡ </tag>
            
            <tag> mysqld </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Kubernetesçš„3ä¸­æ¢é’ˆreadinessProbeã€livenessProbeå’ŒstartupProbe</title>
      <link href="/posts/af97998/"/>
      <url>/posts/af97998/</url>
      
        <content type="html"><![CDATA[<h2 id="æ¢é’ˆ"><a href="#æ¢é’ˆ" class="headerlink" title="æ¢é’ˆ"></a>æ¢é’ˆ</h2><p>K8S æä¾›äº† 3 ç§æ¢é’ˆ</p><p>startupProbe å¯åŠ¨æ£€æŸ¥ï¼ˆ1.16 ç‰ˆæœ¬æ–°å¢ï¼‰<br>livenessProbe å­˜æ´»æ£€æŸ¥<br>readinessProbe å°±ç»ªæ£€æŸ¥</p><h3 id="startupProbe"><a href="#startupProbe" class="headerlink" title="startupProbe"></a>startupProbe</h3><p>kubernetes 1.16 ç‰ˆæœ¬æ–°å¢åŠŸèƒ½ï¼Œç”¨äºåˆ¤æ–­å®¹å™¨å†…åº”ç”¨ç¨‹åºæ˜¯å¦å·²ç»å¯åŠ¨ï¼Œå¦‚æœé…ç½®äº† startuprobeï¼Œå°±ä¼šå…ˆç¦ç”¨å…¶ä»–çš„æ¢æµ‹ï¼Œç›´åˆ°å®ƒæˆåŠŸä¸ºæ­¢ï¼ŒæˆåŠŸåå°†ä¸å†è¿›è¡Œæ¢æµ‹ã€‚</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">startupProbe:</span>                     <span class="comment"># å¥åº·æ£€æŸ¥æ–¹å¼ï¼š[readinessProbe,livenessProbe,StartupProbe]</span></span><br><span class="line">  <span class="attr">failureThreshold:</span> <span class="number">3</span>             <span class="comment"># æ£€æµ‹å¤±è´¥3æ¬¡è¡¨ç¤ºæœªå°±ç»ª</span></span><br><span class="line">  <span class="attr">httpGet:</span>                        <span class="comment"># è¯·æ±‚æ–¹å¼</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/health</span>                 <span class="comment"># è¯·æ±‚è·¯å¾„</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">8080</span>                    <span class="comment"># è¯·æ±‚ç«¯å£</span></span><br><span class="line">    <span class="attr">scheme:</span> <span class="string">HTTP</span>                  <span class="comment"># è¯·æ±‚åè®®</span></span><br><span class="line">  <span class="attr">initialDelaySeconds:</span> <span class="number">20</span>         <span class="comment"># å®¹å™¨å¯åŠ¨åè¦ç­‰å¾…å¤šå°‘ç§’åå­˜æ´»å’Œå°±ç»ªæ¢æµ‹å™¨æ‰è¢«åˆå§‹åŒ–ï¼Œé»˜è®¤æ˜¯ 0 ç§’ï¼Œæœ€å°å€¼æ˜¯ 0ã€‚</span></span><br><span class="line">  <span class="attr">periodSeconds:</span> <span class="number">10</span>               <span class="comment"># æ‰§è¡Œæ¢æµ‹çš„æ—¶é—´é—´éš”ï¼ˆå•ä½æ˜¯ç§’ï¼‰ã€‚é»˜è®¤æ˜¯ 10 ç§’ã€‚æœ€å°å€¼æ˜¯ 1ã€‚ </span></span><br><span class="line">  <span class="attr">successThreshold:</span> <span class="number">1</span>             <span class="comment"># æ¢æµ‹å™¨åœ¨å¤±è´¥åï¼Œè¢«è§†ä¸ºæˆåŠŸçš„æœ€å°è¿ç»­æˆåŠŸæ•°ã€‚é»˜è®¤å€¼æ˜¯ 1 å­˜æ´»å’Œå¯åŠ¨æ¢æµ‹çš„è¿™ä¸ªå€¼å¿…é¡»æ˜¯1 æœ€å°å€¼æ˜¯ 1</span></span><br><span class="line">  <span class="attr">failureThreshold:</span> <span class="number">2</span>             <span class="comment"># å½“æ¢æµ‹å¤±è´¥æ—¶ï¼ŒKubernetes çš„é‡è¯•æ¬¡æ•°ã€‚ å­˜æ´»æ¢æµ‹æƒ…å†µä¸‹çš„æ”¾å¼ƒå°±æ„å‘³ç€é‡æ–°å¯åŠ¨å®¹å™¨ã€‚ å°±ç»ªæ¢æµ‹æƒ…å†µä¸‹çš„æ”¾å¼ƒ Pod ä¼šè¢«æ‰“ä¸Šæœªå°±ç»ªçš„æ ‡ç­¾ã€‚é»˜è®¤å€¼æ˜¯ 3ã€‚æœ€å°å€¼æ˜¯ 1ã€‚</span></span><br><span class="line">  <span class="attr">timeoutSeconds:</span> <span class="number">1</span>               <span class="comment"># æ¢æµ‹çš„è¶…æ—¶åç­‰å¾…å¤šå°‘ç§’ã€‚é»˜è®¤å€¼æ˜¯ 1 ç§’ã€‚æœ€å°å€¼æ˜¯ 1ã€‚</span></span><br></pre></td></tr></table></figure><h3 id="readinessProbe"><a href="#readinessProbe" class="headerlink" title="readinessProbe"></a>readinessProbe</h3><p>ä¸€èˆ¬ç”¨äºæ¢æµ‹å®¹å™¨å†…çš„ç¨‹åºæ˜¯å¦å¥åº·ï¼Œå®ƒçš„è¿”å›å€¼å¦‚æœä¸º successï¼Œé‚£ä¹ˆå°±ä»£è¡¨è¿™ä¸ªå®¹å™¨å·²ç»å®Œæˆå¯åŠ¨ï¼Œå¹¶ä¸”ç¨‹åºå·²ç»æ˜¯å¯ä»¥æ¥å—æµé‡çš„çŠ¶æ€. è¿™ä¸ªæ—¶å€™å°±ä¼šè¢«åŠ åˆ° service çš„åç«¯åˆ—è¡¨ä¸­ï¼Œå³å¯ä»¥å¯¹å¤–æä¾›æœåŠ¡ã€‚</p><h3 id="livenessProbe"><a href="#livenessProbe" class="headerlink" title="livenessProbe"></a>livenessProbe</h3><p>ç”¨äºæ¢æµ‹å®¹å™¨æ˜¯å¦è¿è¡Œï¼Œå¦‚æœæ¢æµ‹å¤±è´¥ï¼Œkubelet ä¼šæ ¹æ®é…ç½®çš„é‡å¯ç­–ç•¥è¿›è¡Œç›¸åº”çš„å¤„ç†ï¼Œå¦‚æœæ²¡æœ‰é…ç½®è¯¥æ¢é’ˆï¼Œé»˜è®¤å°±æ˜¯ success</p><h2 id="æ£€æŸ¥æ–¹å¼"><a href="#æ£€æŸ¥æ–¹å¼" class="headerlink" title="æ£€æŸ¥æ–¹å¼"></a>æ£€æŸ¥æ–¹å¼</h2><h3 id="httpget"><a href="#httpget" class="headerlink" title="httpget"></a>httpget</h3><p>kubelet ä¼šå‘å®¹å™¨å†…è¿è¡Œçš„æœåŠ¡ï¼ˆæœåŠ¡åœ¨ç›‘å¬ 8080 ç«¯å£ï¼‰å‘é€ä¸€ä¸ª HTTP GET è¯·æ±‚æ¥æ‰§è¡Œæ¢æµ‹ã€‚ å¦‚æœæœåŠ¡å™¨ä¸Š &#x2F;healthz è·¯å¾„ä¸‹çš„å¤„ç†ç¨‹åºè¿”å›æˆåŠŸä»£ç ï¼Œåˆ™ kubelet è®¤ä¸ºå®¹å™¨æ˜¯å¥åº·å­˜æ´»çš„ã€‚ å¦‚æœå¤„ç†ç¨‹åºè¿”å›å¤±è´¥ä»£ç ï¼Œåˆ™ kubelet ä¼šæ€æ­»è¿™ä¸ªå®¹å™¨å¹¶å°†å…¶é‡å¯ã€‚</p><p>è¿”å›å¤§äºæˆ–ç­‰äº 200 å¹¶ä¸”å°äº 400 çš„ä»»ä½•ä»£ç éƒ½æ ‡ç¤ºæˆåŠŸï¼Œå…¶å®ƒè¿”å›ä»£ç éƒ½æ ‡ç¤ºå¤±è´¥ã€‚</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">livenessProbe:</span></span><br><span class="line">  <span class="attr">httpGet:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/healthz</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">    <span class="attr">httpHeaders:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Custom-Header</span></span><br><span class="line">      <span class="attr">value:</span> <span class="string">Awesome</span></span><br></pre></td></tr></table></figure><h3 id="tcp-ç«¯å£"><a href="#tcp-ç«¯å£" class="headerlink" title="tcp ç«¯å£"></a>tcp ç«¯å£</h3><p>ç«¯å£é€šäº†åˆ™æˆåŠŸï¼Œä¸é€šåˆ™å¤±è´¥</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">startupProbe:</span></span><br><span class="line">  <span class="attr">tcpSocket:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">  <span class="attr">initialDelaySeconds:</span> <span class="number">20</span></span><br><span class="line">  <span class="attr">periodSeconds:</span> <span class="number">5</span></span><br><span class="line">  <span class="attr">successThreshold:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">failureThreshold:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">timeoutSeconds:</span> <span class="number">3</span></span><br></pre></td></tr></table></figure><h3 id="æ‰§è¡Œå‘½ä»¤"><a href="#æ‰§è¡Œå‘½ä»¤" class="headerlink" title="æ‰§è¡Œå‘½ä»¤"></a>æ‰§è¡Œå‘½ä»¤</h3><p>å¦‚æœå‘½ä»¤æ‰§è¡ŒæˆåŠŸå¹¶ä¸”è¿”å›å€¼ä¸º 0ï¼Œkubelet å°±ä¼šè®¤ä¸ºè¿™ä¸ªå®¹å™¨æ˜¯å¥åº·å­˜æ´»çš„ã€‚ å¦‚æœè¿™ä¸ªå‘½ä»¤è¿”å›é 0 å€¼ï¼Œkubelet ä¼šæ€æ­»è¿™ä¸ªå®¹å™¨å¹¶é‡æ–°å¯åŠ¨å®ƒã€‚</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">livenessProbe:</span></span><br><span class="line">  <span class="attr">exec:</span></span><br><span class="line">    <span class="attr">command:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">cat</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/tmp/healthy</span></span><br><span class="line">  <span class="attr">initialDelaySeconds:</span> <span class="number">5</span></span><br><span class="line">  <span class="attr">timeoutSeconds:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">successThreshold:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">failureThreshold:</span> <span class="number">2</span>          <span class="comment"># å½“æ¢æµ‹å¤±è´¥æ—¶ï¼ŒKubernetes çš„é‡è¯•æ¬¡æ•°ã€‚ å­˜æ´»æ¢æµ‹æƒ…å†µä¸‹çš„æ”¾å¼ƒå°±æ„å‘³ç€é‡æ–°å¯åŠ¨å®¹å™¨ã€‚ å°±ç»ªæ¢æµ‹æƒ…å†µä¸‹çš„æ”¾å¼ƒ Pod ä¼šè¢«æ‰“ä¸Šæœªå°±ç»ªçš„æ ‡ç­¾ã€‚é»˜è®¤å€¼æ˜¯ 3ã€‚æœ€å°å€¼æ˜¯ 1ã€‚</span></span><br><span class="line">  <span class="attr">periodSeconds:</span> <span class="number">5</span></span><br></pre></td></tr></table></figure><h2 id="ä¸€ä¸ªçº¿ä¸Šçš„é…ç½®"><a href="#ä¸€ä¸ªçº¿ä¸Šçš„é…ç½®" class="headerlink" title="ä¸€ä¸ªçº¿ä¸Šçš„é…ç½®"></a>ä¸€ä¸ªçº¿ä¸Šçš„é…ç½®</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">livenessProbe:</span></span><br><span class="line">  <span class="attr">failureThreshold:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">httpGet:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/actuator/info</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">    <span class="attr">scheme:</span> <span class="string">HTTP</span></span><br><span class="line">  <span class="attr">initialDelaySeconds:</span> <span class="number">60</span></span><br><span class="line">  <span class="attr">periodSeconds:</span> <span class="number">10</span></span><br><span class="line">  <span class="attr">successThreshold:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">timeoutSeconds:</span> <span class="number">5</span></span><br><span class="line"><span class="attr">readinessProbe:</span></span><br><span class="line">  <span class="attr">failureThreshold:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">httpGet:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/actuator/info</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">    <span class="attr">scheme:</span> <span class="string">HTTP</span></span><br><span class="line">  <span class="attr">initialDelaySeconds:</span> <span class="number">60</span></span><br><span class="line">  <span class="attr">periodSeconds:</span> <span class="number">10</span></span><br><span class="line">  <span class="attr">successThreshold:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">timeoutSeconds:</span> <span class="number">5</span></span><br><span class="line"><span class="attr">startupProbe:</span></span><br><span class="line">  <span class="attr">failureThreshold:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">tcpSocket:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">  <span class="attr">initialDelaySeconds:</span> <span class="number">20</span></span><br><span class="line">  <span class="attr">periodSeconds:</span> <span class="number">5</span></span><br><span class="line">  <span class="attr">successThreshold:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">timeoutSeconds:</span> <span class="number">3</span></span><br><span class="line"><span class="attr">resources:</span></span><br><span class="line">  <span class="attr">limits:</span></span><br><span class="line">    <span class="attr">cpu:</span> <span class="string">&quot;1&quot;</span></span><br><span class="line">    <span class="attr">memory:</span> <span class="string">2560Mi</span></span><br><span class="line">  <span class="attr">requests:</span></span><br><span class="line">    <span class="attr">cpu:</span> <span class="string">&quot;1&quot;</span></span><br><span class="line">    <span class="attr">memory:</span> <span class="string">2560Mi</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å®¹å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Kubernetes </tag>
            
            <tag> k8s </tag>
            
            <tag> ç”Ÿå‘½å‘¨æœŸ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQLæ…¢æŸ¥è¯¢æ—¥å¿—</title>
      <link href="/posts/d7f12bf0/"/>
      <url>/posts/d7f12bf0/</url>
      
        <content type="html"><![CDATA[<p>æ…¢ SQL ä¸€èˆ¬éƒ½æ˜¯æŒ‡æ…¢æŸ¥è¯¢</p><p>å¼€å¯æ…¢æŸ¥è¯¢ä¼šå¸¦æ¥ä¸€å®šçš„æ€§èƒ½å½±å“ã€‚<br>å‚è€ƒ: <a href="http://c.biancheng.net/view/7782.html">http://c.biancheng.net/view/7782.html</a></p><h2 id="æŸ¥è¯¢æ…¢æŸ¥è¯¢æ—¥å¿—åŠŸèƒ½çŠ¶æ€"><a href="#æŸ¥è¯¢æ…¢æŸ¥è¯¢æ—¥å¿—åŠŸèƒ½çŠ¶æ€" class="headerlink" title="æŸ¥è¯¢æ…¢æŸ¥è¯¢æ—¥å¿—åŠŸèƒ½çŠ¶æ€"></a>æŸ¥è¯¢æ…¢æŸ¥è¯¢æ—¥å¿—åŠŸèƒ½çŠ¶æ€</h2><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ…¢æŸ¥è¯¢æ—¥å¿—åŠŸèƒ½æ˜¯å…³é—­çš„ã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹æ˜¯å¦å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—åŠŸèƒ½ã€‚å‘½ä»¤å’Œæ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;slow_query%&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------+---------------------------------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name       <span class="operator">|</span> <span class="keyword">Value</span>                                                               <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------+---------------------------------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> slow_query_log      <span class="operator">|</span> OFF                                                                 <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> slow_query_log_file <span class="operator">|</span> C:\ProgramData\MySQL\MySQL Server <span class="number">5.7</span>\Data\LAPTOP<span class="operator">-</span>UHQ6V8KP<span class="operator">-</span>slow.log <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------+---------------------------------------------------------------------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">1</span> warning (<span class="number">0.02</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;long_query_time&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------+-----------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name   <span class="operator">|</span> <span class="keyword">Value</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------+-----------+</span></span><br><span class="line"><span class="operator">|</span> long_query_time <span class="operator">|</span> <span class="number">10.000000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------+-----------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">1</span> warning (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure><p>slow_query_logï¼š æ…¢æŸ¥è¯¢å¼€å¯çŠ¶æ€<br>slow_query_log_fileï¼š æ…¢æŸ¥è¯¢æ—¥å¿—å­˜æ”¾çš„ä½ç½®ï¼ˆä¸€èˆ¬è®¾ç½®ä¸º MySQL çš„æ•°æ®å­˜æ”¾ç›®å½•ï¼‰<br>long_query_timeï¼š æŸ¥è¯¢è¶…è¿‡å¤šå°‘ç§’æ‰è®°å½•</p><h2 id="å¯åŠ¨å’Œè®¾ç½®æ…¢æŸ¥è¯¢æ—¥å¿—"><a href="#å¯åŠ¨å’Œè®¾ç½®æ…¢æŸ¥è¯¢æ—¥å¿—" class="headerlink" title="å¯åŠ¨å’Œè®¾ç½®æ…¢æŸ¥è¯¢æ—¥å¿—"></a>å¯åŠ¨å’Œè®¾ç½®æ…¢æŸ¥è¯¢æ—¥å¿—</h2><p>å¯ä»¥é€šè¿‡ log-slow-queries é€‰é¡¹å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—ã€‚é€šè¿‡ long_query_time é€‰é¡¹æ¥è®¾ç½®æ—¶é—´å€¼ï¼Œæ—¶é—´ä»¥ç§’ä¸ºå•ä½ã€‚å¦‚æœæŸ¥è¯¢æ—¶é—´è¶…è¿‡äº†è¿™ä¸ªæ—¶é—´å€¼ï¼Œè¿™ä¸ªæŸ¥è¯¢è¯­å¥å°†è¢«è®°å½•åˆ°æ…¢æŸ¥è¯¢æ—¥å¿—ã€‚</p><h3 id="ä¿®æ”¹é…ç½®æ–‡ä»¶æ–¹å¼"><a href="#ä¿®æ”¹é…ç½®æ–‡ä»¶æ–¹å¼" class="headerlink" title="ä¿®æ”¹é…ç½®æ–‡ä»¶æ–¹å¼"></a>ä¿®æ”¹é…ç½®æ–‡ä»¶æ–¹å¼</h3><p>å°† log_slow_queries é€‰é¡¹å’Œ long_query_time é€‰é¡¹åŠ å…¥åˆ°é…ç½®æ–‡ä»¶çš„ [mysqld] ç»„ä¸­ã€‚æ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[mysqld]</span></span><br><span class="line"><span class="attr">log-slow-queries</span>=/data/mysql/slow.log</span><br><span class="line"><span class="attr">long_query_time</span>=<span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># log-slow-queries å‚æ•°æŒ‡å®šæ…¢æŸ¥è¯¢æ—¥å¿—çš„å­˜å‚¨è·¯å¾„ï¼Œå¦‚æœæ˜¯ç›¸å¯¹è·¯å¾„ï¼Œæ…¢æŸ¥è¯¢æ—¥å¿—å°†å­˜å‚¨åˆ° MySQL æ•°æ®åº“çš„æ•°æ®æ–‡ä»¶å¤¹ä¸‹ã€‚å¦‚æœä¸æŒ‡å®šæ–‡ä»¶åï¼Œé»˜è®¤æ–‡ä»¶åä¸º hostname-slow.logï¼Œhostname æ˜¯ MySQL æœåŠ¡å™¨çš„ä¸»æœºåã€‚</span></span><br><span class="line"><span class="comment"># long_query_time å‚æ•°æ˜¯è®¾å®šçš„æ—¶é—´å€¼ï¼Œè¯¥å€¼çš„å•ä½æ˜¯ç§’ã€‚å¦‚æœä¸è®¾ç½® long_query_time é€‰é¡¹ï¼Œé»˜è®¤æ—¶é—´ä¸º 10 ç§’ã€‚</span></span><br></pre></td></tr></table></figure><h3 id="æ‰§è¡Œ-sql-å‘½ä»¤æ–¹å¼"><a href="#æ‰§è¡Œ-sql-å‘½ä»¤æ–¹å¼" class="headerlink" title="æ‰§è¡Œ sql å‘½ä»¤æ–¹å¼"></a>æ‰§è¡Œ sql å‘½ä»¤æ–¹å¼</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> slow_query_log<span class="operator">=</span><span class="keyword">ON</span><span class="operator">/</span>OFF;</span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> long_query_time<span class="operator">=</span><span class="number">5</span>;</span><br></pre></td></tr></table></figure><h2 id="åˆ é™¤æ…¢æŸ¥è¯¢æ—¥å¿—"><a href="#åˆ é™¤æ…¢æŸ¥è¯¢æ—¥å¿—" class="headerlink" title="åˆ é™¤æ…¢æŸ¥è¯¢æ—¥å¿—"></a>åˆ é™¤æ…¢æŸ¥è¯¢æ—¥å¿—</h2><p>æ…¢æŸ¥è¯¢æ—¥å¿—çš„åˆ é™¤æ–¹æ³•ä¸é€šç”¨æ—¥å¿—çš„åˆ é™¤æ–¹æ³•æ˜¯ä¸€æ ·çš„ã€‚å¯ä»¥ä½¿ç”¨ mysqladmin å‘½ä»¤æ¥åˆ é™¤ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨æ‰‹å·¥æ–¹å¼æ¥åˆ é™¤ã€‚mysqladmin å‘½ä»¤çš„è¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqladmin -uroot -p flush-logs</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œè¯¥å‘½ä»¤åï¼Œå‘½ä»¤è¡Œä¼šæç¤ºè¾“å…¥å¯†ç ã€‚è¾“å…¥æ­£ç¡®å¯†ç åï¼Œå°†æ‰§è¡Œåˆ é™¤æ“ä½œã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>webdavä½¿ç”¨è®°å½•</title>
      <link href="/posts/1e91b84d/"/>
      <url>/posts/1e91b84d/</url>
      
        <content type="html"><![CDATA[<h2 id="åœ¨-windows-æŒ‚è½½åˆ°-z-ç›˜"><a href="#åœ¨-windows-æŒ‚è½½åˆ°-z-ç›˜" class="headerlink" title="åœ¨ windows æŒ‚è½½åˆ° z ç›˜"></a>åœ¨ windows æŒ‚è½½åˆ° z ç›˜</h2><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">:: æ˜ å°„åšæœäº‘webdav, PERSISTENT:noè¡¨ç¤ºä¸ä¼šè®°å¿†æ˜ å°„, é‡å¯ä¼šä¸¢å¤±.</span><br><span class="line"><span class="built_in">net</span> use Z: https://dav.jianguoyun.com/dav/ /user:iuxt@qq.com &lt;å¯†ç &gt; /PERSISTENT:no</span><br></pre></td></tr></table></figure><h2 id="é€šè¿‡-curl-ä½¿ç”¨-webdav"><a href="#é€šè¿‡-curl-ä½¿ç”¨-webdav" class="headerlink" title="é€šè¿‡ curl ä½¿ç”¨ webdav"></a>é€šè¿‡ curl ä½¿ç”¨ webdav</h2><h3 id="ä¸Šä¼ æ–‡ä»¶"><a href="#ä¸Šä¼ æ–‡ä»¶" class="headerlink" title="ä¸Šä¼ æ–‡ä»¶"></a>ä¸Šä¼ æ–‡ä»¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æœ¬åœ°çš„test-new.zipæ–‡ä»¶ä¸Šä¼ åˆ°è¿œç¨‹ä¸ºtest.zip</span></span><br><span class="line">curl --user x@zahui.fan:&lt;å¯†ç &gt; https://file.babudiu.com/dav/test.zip -T ./test-new.zip </span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿ç•™æ–‡ä»¶åä¸å˜</span></span><br><span class="line">curl --user x@zahui.fan:&lt;å¯†ç &gt; https://file.babudiu.com/dav/ -T ./test-new.zip </span><br></pre></td></tr></table></figure><h3 id="åˆ›å»ºç›®å½•"><a href="#åˆ›å»ºç›®å½•" class="headerlink" title="åˆ›å»ºç›®å½•"></a>åˆ›å»ºç›®å½•</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºæ ¹ç›®å½• xxxxxxx</span></span><br><span class="line">curl --user x@zahui.fan:&lt;å¯†ç &gt; -X MKCOL https://file.babudiu.com/dav/xxxxxxx/</span><br></pre></td></tr></table></figure><h3 id="é‡å‘½åæ–‡ä»¶ï¼ˆç§»åŠ¨æ–‡ä»¶ï¼‰"><a href="#é‡å‘½åæ–‡ä»¶ï¼ˆç§»åŠ¨æ–‡ä»¶ï¼‰" class="headerlink" title="é‡å‘½åæ–‡ä»¶ï¼ˆç§»åŠ¨æ–‡ä»¶ï¼‰"></a>é‡å‘½åæ–‡ä»¶ï¼ˆç§»åŠ¨æ–‡ä»¶ï¼‰</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°†è¿œç¨‹çš„ç›®å½•å 1 æ”¹ä¸º 2</span></span><br><span class="line">curl --user x@zahui.fan:&lt;å¯†ç &gt; -X MOVE --header <span class="string">&#x27;Destination:https://file.babudiu.com/dav/2/&#x27;</span> https://file.babudiu.com/dav/1/</span><br></pre></td></tr></table></figure><h3 id="åˆ é™¤æ–‡ä»¶"><a href="#åˆ é™¤æ–‡ä»¶" class="headerlink" title="åˆ é™¤æ–‡ä»¶"></a>åˆ é™¤æ–‡ä»¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl --user x@zahui.fan:&lt;å¯†ç &gt; -X DELETE https://file.babudiu.com/dav/2/</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å‘½ä»¤è¡Œå·¥å…· </tag>
            
            <tag> cli </tag>
            
            <tag> curl </tag>
            
            <tag> webdav </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pythonå¤„ç†å­—ç¬¦ä¸²</title>
      <link href="/posts/5d196648/"/>
      <url>/posts/5d196648/</url>
      
        <content type="html"><![CDATA[<h2 id="è¯»å–å¤šè¡Œå­—ç¬¦ä¸²"><a href="#è¯»å–å¤šè¡Œå­—ç¬¦ä¸²" class="headerlink" title="è¯»å–å¤šè¡Œå­—ç¬¦ä¸²"></a>è¯»å–å¤šè¡Œå­—ç¬¦ä¸²</h2><p>ä½¿ç”¨å­—ç¬¦ä¸²çš„ splitlines æ–¹æ³•</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">data = <span class="string">&#x27;&#x27;&#x27;1 2 3</span></span><br><span class="line"><span class="string">4 5 6</span></span><br><span class="line"><span class="string">7 8 9&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># data.splitlines()  --&gt;  [&#x27;1 2 3&#x27;, &#x27;4 5 6&#x27;, &#x27;7 8 9&#x27;]</span></span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> data.splitlines():</span><br><span class="line">    i = [i <span class="keyword">for</span> i <span class="keyword">in</span> line.split(<span class="string">&#x27; &#x27;</span>) <span class="keyword">if</span> i] <span class="comment"># å»é™¤åˆ—è¡¨ä¸­çš„ç©ºå€¼</span></span><br><span class="line">    <span class="built_in">print</span>(i)</span><br></pre></td></tr></table></figure><h2 id="å­—ç¬¦ä¸²æ ¼å¼åŒ–"><a href="#å­—ç¬¦ä¸²æ ¼å¼åŒ–" class="headerlink" title="å­—ç¬¦ä¸²æ ¼å¼åŒ–"></a>å­—ç¬¦ä¸²æ ¼å¼åŒ–</h2><p>ä½¿ç”¨ <code>%</code> è¿™ç§æ ¼å¼åŒ–æ–¹å¼å³å°†è¢«åºŸå¼ƒ, å¯ä»¥ä½¿ç”¨ <code>&#123;&#125;</code> è¿™ç§å ä½ç¬¦, æ›´ç›´è§‚</p><h3 id="ä½¿ç”¨ä½ç½®æ›¿æ¢"><a href="#ä½¿ç”¨ä½ç½®æ›¿æ¢" class="headerlink" title="ä½¿ç”¨ä½ç½®æ›¿æ¢"></a>ä½¿ç”¨ä½ç½®æ›¿æ¢</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&#x27;&#123;0&#125;, &#123;1&#125;, &#123;2&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;a, b, c&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&#x27;&#123;&#125;, &#123;&#125;, &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>)  <span class="comment"># 3.1+ only</span></span><br><span class="line"><span class="string">&#x27;a, b, c&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&#x27;&#123;2&#125;, &#123;1&#125;, &#123;0&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;c, b, a&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&#x27;&#123;2&#125;, &#123;1&#125;, &#123;0&#125;&#x27;</span>.<span class="built_in">format</span>(*<span class="string">&#x27;abc&#x27;</span>)      <span class="comment"># unpacking argument sequence</span></span><br><span class="line"><span class="string">&#x27;c, b, a&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&#x27;&#123;0&#125;&#123;1&#125;&#123;0&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="string">&#x27;abra&#x27;</span>, <span class="string">&#x27;cad&#x27;</span>)   <span class="comment"># arguments&#x27; indices can be repeated</span></span><br><span class="line"><span class="string">&#x27;abracadabra&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="æŒ‰åç§°æ›¿æ¢å‚æ•°"><a href="#æŒ‰åç§°æ›¿æ¢å‚æ•°" class="headerlink" title="æŒ‰åç§°æ›¿æ¢å‚æ•°"></a>æŒ‰åç§°æ›¿æ¢å‚æ•°</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&#x27;Coordinates: &#123;latitude&#125;, &#123;longitude&#125;&#x27;</span>.<span class="built_in">format</span>(latitude=<span class="string">&#x27;37.24N&#x27;</span>, longitude=<span class="string">&#x27;-115.81W&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;Coordinates: 37.24N, -115.81W&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>coord = &#123;<span class="string">&#x27;latitude&#x27;</span>: <span class="string">&#x27;37.24N&#x27;</span>, <span class="string">&#x27;longitude&#x27;</span>: <span class="string">&#x27;-115.81W&#x27;</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&#x27;Coordinates: &#123;latitude&#125;, &#123;longitude&#125;&#x27;</span>.<span class="built_in">format</span>(**coord)</span><br><span class="line"><span class="string">&#x27;Coordinates: 37.24N, -115.81W&#x27;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> å­—ç¬¦ä¸² </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åœ¨ubuntu22.04æˆ–LinuxMint21ä¸Šå®‰è£…æ·±ä¿¡æœEasyconnect</title>
      <link href="/posts/6f69bd6/"/>
      <url>/posts/6f69bd6/</url>
      
        <content type="html"><![CDATA[<p>æ­£å¸¸åœ¨ ubuntu22.04 æˆ–è€… linuxmint21 ä¸Šå®‰è£… Easyconnect, å¯ä»¥å®‰è£…, ä½†æ˜¯æ— æ³•å¯åŠ¨.</p><p>æ˜¯å› ä¸º pango è¿™ä¸ªåº“ç‰ˆæœ¬è¾ƒé«˜å¯¼è‡´. éœ€è¦æ‰‹åŠ¨å°†ä½ç‰ˆæœ¬çš„åŠ¨æ€é“¾æ¥åº“æ”¾åˆ° easyconnect ç¨‹åºç›®å½•ä¸‹.</p><h2 id="æŸ¥çœ‹é“¾æ¥åº“"><a href="#æŸ¥çœ‹é“¾æ¥åº“" class="headerlink" title="æŸ¥çœ‹é“¾æ¥åº“"></a>æŸ¥çœ‹é“¾æ¥åº“</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/share/sangfor/EasyConnect</span><br><span class="line">ldd EasyConnect | grep pango</span><br></pre></td></tr></table></figure><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202306281905022.png"></p><h2 id="ä¸‹è½½å¯¹åº”çš„-deb-åŒ…"><a href="#ä¸‹è½½å¯¹åº”çš„-deb-åŒ…" class="headerlink" title="ä¸‹è½½å¯¹åº”çš„ deb åŒ…"></a>ä¸‹è½½å¯¹åº”çš„ deb åŒ…</h2><p>ä¸‹è½½åœ°å€: <a href="http://kr.archive.ubuntu.com/ubuntu/pool/main/p/pango1.0/">http://kr.archive.ubuntu.com/ubuntu/pool/main/p/pango1.0/</a></p><p>amd64 æ¶æ„éœ€è¦ä¸‹è½½å¦‚ä¸‹å‡ ä¸ªæ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">libpangocairo-1.0-0_1.40.14-1_amd64.deb</span><br><span class="line">libpangoft2-1.0-0_1.40.14-1_amd64.deb</span><br><span class="line">libpango-1.0-0_1.40.14-1_amd64.deb</span><br></pre></td></tr></table></figure><h2 id="è§£å‹-deb-åŒ…"><a href="#è§£å‹-deb-åŒ…" class="headerlink" title="è§£å‹ deb åŒ…"></a>è§£å‹ deb åŒ…</h2><p>è¿™ 3 ä¸ª deb åŒ…ä¸éœ€è¦å®‰è£…, è§£å‹æŠŠç›¸å…³æ–‡ä»¶æ”¾åˆ° easyconnect å®‰è£…ç›®å½•å³å¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ar -vx libpangocairo-1.0-0_1.40.14-1_amd64.deb &amp;&amp; tar xf data.tar.xz</span><br><span class="line">ar -vx libpangoft2-1.0-0_1.40.14-1_amd64.deb &amp;&amp; tar xf data.tar.xz</span><br><span class="line">ar -vx libpango-1.0-0_1.40.14-1_amd64.deb &amp;&amp; tar xf data.tar.xz</span><br></pre></td></tr></table></figure><p>å°†è§£å‹åçš„ <code>usr/lib/x86_64-linux-gnu</code> é‡Œé¢çš„æ‰€æœ‰æ–‡ä»¶å¤åˆ¶åˆ° <code>/usr/share/sangfor/EasyConnect</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">cp</span> usr/lib/x86_64-linux-gnu/* /usr/share/sangfor/EasyConnect/</span><br></pre></td></tr></table></figure><h2 id="æ£€æŸ¥"><a href="#æ£€æŸ¥" class="headerlink" title="æ£€æŸ¥"></a>æ£€æŸ¥</h2><p>å†æ¬¡æ£€æŸ¥é“¾æ¥åº“, å‘ç°å·²ç»æŒ‡å‘å®‰è£…ç›®å½•äº†</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202306281923022.png"></p>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ·±ä¿¡æœ </tag>
            
            <tag> ubuntu </tag>
            
            <tag> linuxmint </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pythonåˆ—è¡¨æ“ä½œ</title>
      <link href="/posts/e367d008/"/>
      <url>/posts/e367d008/</url>
      
        <content type="html"><![CDATA[<h2 id="åˆ—è¡¨å»é™¤ç©ºå€¼"><a href="#åˆ—è¡¨å»é™¤ç©ºå€¼" class="headerlink" title="åˆ—è¡¨å»é™¤ç©ºå€¼"></a>åˆ—è¡¨å»é™¤ç©ºå€¼</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">i = [ <span class="string">&quot;a&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;c&quot;</span>, <span class="string">&quot;&quot;</span> ]</span><br><span class="line">i = [ tmp <span class="keyword">for</span> tmp <span class="keyword">in</span> i <span class="keyword">if</span> tmp ]</span><br><span class="line"><span class="built_in">print</span>(i)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¸¸ç”¨æ“ä½œ </tag>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>kubernetesèŠ‚ç‚¹ç»´æŠ¤æµç¨‹</title>
      <link href="/posts/52feaa76/"/>
      <url>/posts/52feaa76/</url>
      
        <content type="html"><![CDATA[<blockquote><p>èŠ‚ç‚¹è®¾ç½®ä¸º <code>SchedulingDisabled</code> å…¶å®å°±æ˜¯æ‰“ä¸Šæ±¡ç‚¹ <code>node.kubernetes.io/unschedulable:NoSchedule</code></p></blockquote><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>kubectl cordon <node></td><td>å°† node è®¾ç½®ä¸º SchedulingDisabled, ä¸å…è®¸æ–°çš„ pod è°ƒåº¦ä¸Šæ¥, æ—§çš„ pod ä¸å—å½±å“</td></tr><tr><td>kubectl drain <node></td><td>å…ˆé©±é€ node ä¸Šçš„ pod, k8s ä¼šåœ¨å…¶ä»–èŠ‚ç‚¹é‡æ–°åˆ›å»º, ç„¶åå°†èŠ‚ç‚¹è®¾ç½®ä¸º SchedulingDisabled</td></tr><tr><td>kubectl uncordon <node></td><td>æ¢å¤è°ƒåº¦, åˆ é™¤ SchedulingDisabled æ±¡ç‚¹</td></tr></tbody></table><h2 id="æ“ä½œæµç¨‹"><a href="#æ“ä½œæµç¨‹" class="headerlink" title="æ“ä½œæµç¨‹"></a>æ“ä½œæµç¨‹</h2><h3 id="å¸¸è§„æ“ä½œ"><a href="#å¸¸è§„æ“ä½œ" class="headerlink" title="å¸¸è§„æ“ä½œ"></a>å¸¸è§„æ“ä½œ</h3><p>å°†èŠ‚ç‚¹ä¸Šç°æœ‰çš„ pod é©±é€, ä¸è¿½æ±‚ä¼˜é›…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl drain &lt;node&gt; --delete-local-data=<span class="literal">true</span> --ignore-daemonsets=<span class="literal">true</span> --force</span><br></pre></td></tr></table></figure><p>æ“ä½œå®Œæ¯•å, å°†èŠ‚ç‚¹æ¢å¤è°ƒåº¦</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl uncordon &lt;node&gt;</span><br></pre></td></tr></table></figure><h3 id="å¯¹é›†ç¾¤æ— å½±å“çš„æ“ä½œ"><a href="#å¯¹é›†ç¾¤æ— å½±å“çš„æ“ä½œ" class="headerlink" title="å¯¹é›†ç¾¤æ— å½±å“çš„æ“ä½œ"></a>å¯¹é›†ç¾¤æ— å½±å“çš„æ“ä½œ</h3><p>å…ˆé’ˆå¯¹èŠ‚ç‚¹æ‰§è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl cordon &lt;node&gt;</span><br></pre></td></tr></table></figure><p>ç„¶åç­‰å¾…èŠ‚ç‚¹ä¸Šçš„ pod è‡ªç„¶è½¬ç§» (æ¯”å¦‚ç‰ˆæœ¬å‘å¸ƒç­‰)</p><p>ç„¶åå°†èŠ‚ç‚¹ä¸‹çº¿</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete node &lt;node&gt;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å®¹å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Kubernetes </tag>
            
            <tag> k8s </tag>
            
            <tag> kubernetes </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>äºŒè¿›åˆ¶éƒ¨ç½²Kuberntes</title>
      <link href="/posts/67853ccb/"/>
      <url>/posts/67853ccb/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€äº›åŸºæœ¬ä¿¡æ¯"><a href="#ä¸€äº›åŸºæœ¬ä¿¡æ¯" class="headerlink" title="ä¸€äº›åŸºæœ¬ä¿¡æ¯"></a>ä¸€äº›åŸºæœ¬ä¿¡æ¯</h2><p>æˆ‘è¿™é‡Œä»¥ AlmaLinux9 ç³»ç»Ÿä¸ºä¾‹ï¼Œç±»ä¼¼ CentOS9 æˆ– RHEL9 ï¼Œå…¶ä»–ç³»ç»Ÿéƒ¨åˆ†æ“ä½œéœ€è¦æ ¹æ®æƒ…å†µä¿®æ”¹ã€‚</p><table><thead><tr><th>ä¸»æœºåç§°</th><th>IP åœ°å€</th><th>è¯´æ˜</th><th>Kubernetes ç»„ä»¶</th><th>å…¶ä»–è½¯ä»¶</th></tr></thead><tbody><tr><td>master1</td><td>10.0.0.11</td><td>master èŠ‚ç‚¹</td><td>kube-apiserverã€kube-controller-managerã€kube-schedulerã€etcdã€kubeletã€kube-proxy</td><td>haproxyã€keepalivedã€containerd</td></tr><tr><td>master2</td><td>10.0.0.12</td><td>master èŠ‚ç‚¹</td><td>kube-apiserverã€kube-controller-managerã€kube-schedulerã€etcdã€kubeletã€kube-proxy</td><td>haproxyã€keepalivedã€containerd</td></tr><tr><td>master3</td><td>10.0.0.13</td><td>master èŠ‚ç‚¹</td><td>kube-apiserverã€kube-controller-managerã€kube-schedulerã€etcdã€kubeletã€kube-proxy</td><td>haproxyã€keepalivedã€containerd</td></tr><tr><td>worker1</td><td>10.0.0.21</td><td>node èŠ‚ç‚¹</td><td>kubeletã€kube-proxy</td><td>containerd</td></tr><tr><td>worker2</td><td>10.0.0.22</td><td>node èŠ‚ç‚¹</td><td>kubeletã€kube-proxy</td><td>containerd</td></tr></tbody></table><table><thead><tr><th>åç§°</th><th>IP åœ°å€</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>SERVICE_CIDR</td><td>10.96.0.0&#x2F;12</td><td></td></tr><tr><td>CLUSTER_CIDR &#x2F; Pod CIDR</td><td>10.244.0.0&#x2F;16</td><td>è¿™ä¸ªé…ç½®éœ€è¦å’Œç½‘ç»œæ’ä»¶ä¸­çš„é…ç½®ä¿æŒä¸€è‡´</td></tr><tr><td>é›†ç¾¤ DNS kube-dns çš„ Cluster IP</td><td>10.96.0.10</td><td></td></tr></tbody></table><p>æœ¬æ–‡ä½¿ç”¨åˆ°çš„æ‰€æœ‰åŒ…ï¼Œå¯ä»¥åœ¨è¿™é‡Œä¸‹è½½åˆ°ï¼š<a href="https://www.123pan.com/s/fjQkjv-MCUJH.html">https://www.123pan.com/s/fjQkjv-MCUJH.html</a> æå–ç :4zyF</p><h2 id="æœåŠ¡å™¨åŸºç¡€é…ç½®"><a href="#æœåŠ¡å™¨åŸºç¡€é…ç½®" class="headerlink" title="æœåŠ¡å™¨åŸºç¡€é…ç½®"></a>æœåŠ¡å™¨åŸºç¡€é…ç½®</h2><p>è¿™é‡Œçš„æ­¥éª¤åœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šéƒ½éœ€è¦æ‰§è¡Œã€‚</p><h3 id="å…³é—­é˜²ç«å¢™"><a href="#å…³é—­é˜²ç«å¢™" class="headerlink" title="å…³é—­é˜²ç«å¢™"></a>å…³é—­é˜²ç«å¢™</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">disable</span> --now firewalld</span><br></pre></td></tr></table></figure><h3 id="å…³é—­-SELinux"><a href="#å…³é—­-SELinux" class="headerlink" title="å…³é—­ SELinux"></a>å…³é—­ SELinux</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">setenforce 0</span><br><span class="line">sed -i <span class="string">&quot;s/^SELINUX=.*/SELINUX=disabled/g&quot;</span> /etc/selinux/config</span><br></pre></td></tr></table></figure><h3 id="å…³é—­äº¤æ¢åˆ†åŒº"><a href="#å…³é—­äº¤æ¢åˆ†åŒº" class="headerlink" title="å…³é—­äº¤æ¢åˆ†åŒº"></a>å…³é—­äº¤æ¢åˆ†åŒº</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sed -ri <span class="string">&#x27;s/.*swap.*/#&amp;/&#x27;</span> /etc/fstab</span><br><span class="line">swapoff -a</span><br></pre></td></tr></table></figure><h3 id="é…ç½®-ulimit-é™åˆ¶"><a href="#é…ç½®-ulimit-é™åˆ¶" class="headerlink" title="é…ç½® ulimit é™åˆ¶"></a>é…ç½® ulimit é™åˆ¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ulimit</span> -SHn 65535</span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/security/limits.d/k8s-limits.conf &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">* soft nofile 65535</span></span><br><span class="line"><span class="string">* hard nofile 65535</span></span><br><span class="line"><span class="string">* soft nproc 65535</span></span><br><span class="line"><span class="string">* hard nproc 65535</span></span><br><span class="line"><span class="string">* soft memlock unlimited</span></span><br><span class="line"><span class="string">* hard memlock unlimited</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><div class="note success flat"><p>å‚æ•°è§£é‡Š</p><p>soft nofile 655360<br>soft è¡¨ç¤ºè½¯é™åˆ¶ï¼Œnofile è¡¨ç¤ºä¸€ä¸ªè¿›ç¨‹å¯æ‰“å¼€çš„æœ€å¤§æ–‡ä»¶æ•°ï¼Œé»˜è®¤å€¼ä¸º 1024ã€‚è¿™é‡Œçš„è½¯é™åˆ¶è®¾ç½®ä¸º 655360ï¼Œå³ä¸€ä¸ªè¿›ç¨‹å¯æ‰“å¼€çš„æœ€å¤§æ–‡ä»¶æ•°ä¸º 655360ã€‚</p><p>hard nofile 131072<br>hard è¡¨ç¤ºç¡¬é™åˆ¶ï¼Œå³ç³»ç»Ÿè®¾ç½®çš„æœ€å¤§å€¼ã€‚nofile è¡¨ç¤ºä¸€ä¸ªè¿›ç¨‹å¯æ‰“å¼€çš„æœ€å¤§æ–‡ä»¶æ•°ï¼Œé»˜è®¤å€¼ä¸º 4096ã€‚è¿™é‡Œçš„ç¡¬é™åˆ¶è®¾ç½®ä¸º 131072ï¼Œå³ç³»ç»Ÿè®¾ç½®çš„æœ€å¤§æ–‡ä»¶æ•°ä¸º 131072ã€‚</p><p>soft nproc 655350<br>soft è¡¨ç¤ºè½¯é™åˆ¶ï¼Œnproc è¡¨ç¤ºä¸€ä¸ªç”¨æˆ·å¯åˆ›å»ºçš„æœ€å¤§è¿›ç¨‹æ•°ï¼Œé»˜è®¤å€¼ä¸º 30720ã€‚è¿™é‡Œçš„è½¯é™åˆ¶è®¾ç½®ä¸º 655350ï¼Œå³ä¸€ä¸ªç”¨æˆ·å¯åˆ›å»ºçš„æœ€å¤§è¿›ç¨‹æ•°ä¸º 655350ã€‚</p><p>hard nproc 655350<br>hard è¡¨ç¤ºç¡¬é™åˆ¶ï¼Œå³ç³»ç»Ÿè®¾ç½®çš„æœ€å¤§å€¼ã€‚nproc è¡¨ç¤ºä¸€ä¸ªç”¨æˆ·å¯åˆ›å»ºçš„æœ€å¤§è¿›ç¨‹æ•°ï¼Œé»˜è®¤å€¼ä¸º 4096ã€‚è¿™é‡Œçš„ç¡¬é™åˆ¶è®¾ç½®ä¸º 655350ï¼Œå³ç³»ç»Ÿè®¾ç½®çš„æœ€å¤§è¿›ç¨‹æ•°ä¸º 655350ã€‚</p><p>soft memlock unlimited<br>seft è¡¨ç¤ºè½¯é™åˆ¶ï¼Œmemlock è¡¨ç¤ºä¸€ä¸ªè¿›ç¨‹å¯é”å®šåœ¨ RAM ä¸­çš„æœ€å¤§å†…å­˜ï¼Œé»˜è®¤å€¼ä¸º 64 KBã€‚è¿™é‡Œçš„è½¯é™åˆ¶è®¾ç½®ä¸º unlimitedï¼Œå³ä¸€ä¸ªè¿›ç¨‹å¯é”å®šçš„æœ€å¤§å†…å­˜ä¸ºæ— é™åˆ¶ã€‚</p><p>hard memlock unlimited<br>hard è¡¨ç¤ºç¡¬é™åˆ¶ï¼Œå³ç³»ç»Ÿè®¾ç½®çš„æœ€å¤§å€¼ã€‚memlock è¡¨ç¤ºä¸€ä¸ªè¿›ç¨‹å¯é”å®šåœ¨ RAM ä¸­çš„æœ€å¤§å†…å­˜ï¼Œé»˜è®¤å€¼ä¸º 64 KBã€‚è¿™é‡Œçš„ç¡¬é™åˆ¶è®¾ç½®ä¸º unlimitedï¼Œå³ç³»ç»Ÿè®¾ç½®çš„æœ€å¤§å†…å­˜é”å®šä¸ºæ— é™åˆ¶ã€‚</p></div><h3 id="å†…æ ¸æ¨¡å—é…ç½®"><a href="#å†…æ ¸æ¨¡å—é…ç½®" class="headerlink" title="å†…æ ¸æ¨¡å—é…ç½®"></a>å†…æ ¸æ¨¡å—é…ç½®</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">yum install ipvsadm ipset sysstat conntrack libseccomp -y</span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/modules-load.d/ipvs.conf &lt;&lt;<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">ip_vs</span><br><span class="line">ip_vs_rr</span><br><span class="line">ip_vs_wrr</span><br><span class="line">ip_vs_sh</span><br><span class="line">nf_conntrack</span><br><span class="line">ip_tables</span><br><span class="line">ip_set</span><br><span class="line">xt_set</span><br><span class="line">ipt_set</span><br><span class="line">ipt_rpfilter</span><br><span class="line">ipt_REJECT</span><br><span class="line">ipip</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡æ–°åŠ è½½å†…æ ¸æ¨¡å—</span></span><br><span class="line">systemctl restart systemd-modules-load.service</span><br><span class="line"></span><br><span class="line"><span class="comment"># éªŒè¯é…ç½®ç»“æœ</span></span><br><span class="line">lsmod | grep -e ip_vs -e nf_conntrack</span><br><span class="line"><span class="comment"># ip_vs_sh               16384  0</span></span><br><span class="line"><span class="comment"># ip_vs_wrr              16384  0</span></span><br><span class="line"><span class="comment"># ip_vs_rr               16384  0</span></span><br><span class="line"><span class="comment"># ip_vs                 180224  6 ip_vs_rr,ip_vs_sh,ip_vs_wrr</span></span><br><span class="line"><span class="comment"># nf_conntrack          176128  1 ip_vs</span></span><br><span class="line"><span class="comment"># nf_defrag_ipv6         24576  2 nf_conntrack,ip_vs</span></span><br><span class="line"><span class="comment"># nf_defrag_ipv4         16384  1 nf_conntrack</span></span><br><span class="line"><span class="comment"># libcrc32c              16384  3 nf_conntrack,xfs,ip_vs</span></span><br></pre></td></tr></table></figure><div class="note success flat"><p>å‚æ•°è§£é‡Š</p><p>ip_vs<br>IPVS æ˜¯ Linux å†…æ ¸ä¸­çš„ä¸€ä¸ªæ¨¡å—ï¼Œç”¨äºå®ç°è´Ÿè½½å‡è¡¡å’Œé«˜å¯ç”¨æ€§ã€‚å®ƒé€šè¿‡åœ¨å‰ç«¯ä»£ç†æœåŠ¡å™¨ä¸Šåˆ†å‘ä¼ å…¥è¯·æ±‚åˆ°åç«¯å®é™…æœåŠ¡å™¨ä¸Šï¼Œæä¾›äº†é«˜æ€§èƒ½å’Œå¯æ‰©å±•çš„ç½‘ç»œæœåŠ¡ã€‚</p><p>ip_vs_rr<br>IPVS çš„ä¸€ç§è°ƒåº¦ç®—æ³•ä¹‹ä¸€ï¼Œä½¿ç”¨è½®è¯¢æ–¹å¼åˆ†å‘è¯·æ±‚åˆ°åç«¯æœåŠ¡å™¨ï¼Œæ¯ä¸ªè¯·æ±‚æŒ‰é¡ºåºä¾æ¬¡åˆ†å‘ã€‚</p><p>ip_vs_wrr<br>IPVS çš„ä¸€ç§è°ƒåº¦ç®—æ³•ä¹‹ä¸€ï¼Œä½¿ç”¨åŠ æƒè½®è¯¢æ–¹å¼åˆ†å‘è¯·æ±‚åˆ°åç«¯æœåŠ¡å™¨ï¼Œæ¯ä¸ªè¯·æ±‚æŒ‰ç…§æŒ‡å®šçš„æƒé‡æ¯”ä¾‹åˆ†å‘ã€‚</p><p>ip_vs_sh<br>IPVS çš„ä¸€ç§è°ƒåº¦ç®—æ³•ä¹‹ä¸€ï¼Œä½¿ç”¨å“ˆå¸Œæ–¹å¼æ ¹æ®æº IP åœ°å€å’Œç›®æ ‡ IP åœ°å€æ¥åˆ†å‘è¯·æ±‚ã€‚</p><p>nf_conntrack<br>è¿™æ˜¯ä¸€ä¸ªå†…æ ¸æ¨¡å—ï¼Œç”¨äºè·Ÿè¸ªå’Œç®¡ç†ç½‘ç»œè¿æ¥ï¼ŒåŒ…æ‹¬ TCPã€UDP å’Œ ICMP ç­‰åè®®ã€‚å®ƒæ˜¯å®ç°é˜²ç«å¢™çŠ¶æ€è·Ÿè¸ªçš„åŸºç¡€ã€‚</p><p>ip_tables<br>è¿™æ˜¯ä¸€ä¸ªå†…æ ¸æ¨¡å—ï¼Œæä¾›äº†å¯¹ Linux ç³»ç»Ÿ IP æ•°æ®åŒ…è¿‡æ»¤å’Œç½‘ç»œåœ°å€è½¬æ¢ï¼ˆNATï¼‰åŠŸèƒ½çš„æ”¯æŒã€‚</p><p>ip_set<br>è¿™æ˜¯ä¸€ä¸ªå†…æ ¸æ¨¡å—ï¼Œæ‰©å±•äº† iptables çš„åŠŸèƒ½ï¼Œæ”¯æŒæ›´é«˜æ•ˆçš„ IP åœ°å€é›†åˆæ“ä½œã€‚</p><p>xt_set<br>è¿™æ˜¯ä¸€ä¸ªå†…æ ¸æ¨¡å—ï¼Œæ‰©å±•äº† iptables çš„åŠŸèƒ½ï¼Œæ”¯æŒæ›´é«˜æ•ˆçš„æ•°æ®åŒ…åŒ¹é…å’Œæ“ä½œã€‚</p><p>ipt_set<br>è¿™æ˜¯ä¸€ä¸ªç”¨æˆ·ç©ºé—´å·¥å…·ï¼Œç”¨äºé…ç½®å’Œç®¡ç† xt_set å†…æ ¸æ¨¡å—ã€‚</p><p>ipt_rpfilter<br>è¿™æ˜¯ä¸€ä¸ªå†…æ ¸æ¨¡å—ï¼Œç”¨äºå®ç°åå‘è·¯å¾„è¿‡æ»¤ï¼Œç”¨äºé˜²æ­¢ IP æ¬ºéª—å’Œ DDoS æ”»å‡»ã€‚</p><p>ipt_REJECT<br>è¿™æ˜¯ä¸€ä¸ª iptables ç›®æ ‡ï¼Œç”¨äºæ‹’ç» IP æ•°æ®åŒ…ï¼Œå¹¶å‘å‘é€æ–¹å‘é€å“åº”ï¼ŒæŒ‡ç¤ºæ•°æ®åŒ…è¢«æ‹’ç»ã€‚</p><p>ipip<br>è¿™æ˜¯ä¸€ä¸ªå†…æ ¸æ¨¡å—ï¼Œç”¨äºå®ç° IP å°è£…åœ¨ IPï¼ˆIP-over-IPï¼‰çš„éš§é“åŠŸèƒ½ã€‚å®ƒå¯ä»¥åœ¨ä¸åŒç½‘ç»œä¹‹é—´åˆ›å»ºè™šæ‹Ÿéš§é“æ¥ä¼ è¾“ IP æ•°æ®åŒ…ã€‚</p></div><h3 id="å†…æ ¸å‚æ•°é…ç½®"><a href="#å†…æ ¸å‚æ•°é…ç½®" class="headerlink" title="å†…æ ¸å‚æ•°é…ç½®"></a>å†…æ ¸å‚æ•°é…ç½®</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; /etc/sysctl.d/k8s.conf &lt;&lt;<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">net.ipv4.ip_forward = 1</span><br><span class="line">net.bridge.bridge-nf-call-iptables = 1</span><br><span class="line">fs.may_detach_mounts = 1</span><br><span class="line">vm.overcommit_memory=1</span><br><span class="line">vm.panic_on_oom=0</span><br><span class="line">fs.inotify.max_user_watches=89100</span><br><span class="line">fs.file-max=52706963</span><br><span class="line">fs.nr_open=52706963</span><br><span class="line">net.netfilter.nf_conntrack_max=2310720</span><br><span class="line"></span><br><span class="line">net.ipv4.tcp_keepalive_time = 600</span><br><span class="line">net.ipv4.tcp_keepalive_probes = 3</span><br><span class="line">net.ipv4.tcp_keepalive_intvl =15</span><br><span class="line">net.ipv4.tcp_max_tw_buckets = 36000</span><br><span class="line">net.ipv4.tcp_tw_reuse = 1</span><br><span class="line">net.ipv4.tcp_max_orphans = 327680</span><br><span class="line">net.ipv4.tcp_orphan_retries = 3</span><br><span class="line">net.ipv4.tcp_syncookies = 1</span><br><span class="line">net.ipv4.tcp_max_syn_backlog = 16384</span><br><span class="line">net.ipv4.ip_conntrack_max = 65536</span><br><span class="line">net.ipv4.tcp_max_syn_backlog = 16384</span><br><span class="line">net.ipv4.tcp_timestamps = 0</span><br><span class="line">net.core.somaxconn = 16384</span><br><span class="line"></span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">sysctl --system</span><br></pre></td></tr></table></figure><div class="note success flat"><ol><li><p>net.ipv4.ip_forward &#x3D; 1</p><ul><li>è¿™ä¸ªå‚æ•°å¯ç”¨äº† IPv4 çš„ IP è½¬å‘åŠŸèƒ½ï¼Œå…è®¸æœåŠ¡å™¨ä½œä¸ºç½‘ç»œè·¯ç”±å™¨è½¬å‘æ•°æ®åŒ…ã€‚</li></ul></li><li><p>net.bridge.bridge-nf-call-iptables &#x3D; 1</p><ul><li>å½“ä½¿ç”¨ç½‘ç»œæ¡¥æ¥æŠ€æœ¯æ—¶ï¼Œå°†æ•°æ®åŒ…ä¼ é€’åˆ° iptables è¿›è¡Œå¤„ç†ã€‚</li></ul></li><li><p>fs.may_detach_mounts &#x3D; 1</p><ul><li>å…è®¸åœ¨æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿæ—¶ï¼Œå…è®¸è¢«å…¶ä»–è¿›ç¨‹ä½¿ç”¨ã€‚</li></ul></li><li><p>vm.overcommit_memory&#x3D;1</p><ul><li>è¯¥è®¾ç½®å…è®¸åŸå§‹çš„å†…å­˜è¿‡é‡åˆ†é…ç­–ç•¥ï¼Œå½“ç³»ç»Ÿçš„å†…å­˜å·²ç»è¢«å®Œå…¨ä½¿ç”¨æ—¶ï¼Œç³»ç»Ÿä»ç„¶ä¼šåˆ†é…é¢å¤–çš„å†…å­˜ã€‚</li></ul></li><li><p>vm.panic_on_oom&#x3D;0</p><ul><li>å½“ç³»ç»Ÿå†…å­˜ä¸è¶³ï¼ˆOOMï¼‰æ—¶ï¼Œç¦ç”¨ç³»ç»Ÿå´©æºƒå’Œé‡å¯ã€‚</li></ul></li><li><p>fs.inotify.max_user_watches&#x3D;89100</p><ul><li>è®¾ç½®ç³»ç»Ÿå…è®¸ä¸€ä¸ªç”¨æˆ·çš„ inotify å®ä¾‹å¯ä»¥ç›‘æ§çš„æ–‡ä»¶æ•°ç›®çš„ä¸Šé™ã€‚</li></ul></li><li><p>fs.file-max&#x3D;52706963</p><ul><li>è®¾ç½®ç³»ç»ŸåŒæ—¶æ‰“å¼€çš„æ–‡ä»¶æ•°çš„ä¸Šé™ã€‚</li></ul></li><li><p>fs.nr_open&#x3D;52706963</p><ul><li>è®¾ç½®ç³»ç»ŸåŒæ—¶æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦æ•°çš„ä¸Šé™ã€‚</li></ul></li><li><p>net.netfilter.nf_conntrack_max&#x3D;2310720</p><ul><li>è®¾ç½®ç³»ç»Ÿå¯ä»¥åˆ›å»ºçš„ç½‘ç»œè¿æ¥è·Ÿè¸ªè¡¨é¡¹çš„æœ€å¤§æ•°é‡ã€‚</li></ul></li><li><p>net.ipv4.tcp_keepalive_time &#x3D; 600</p><ul><li>è®¾ç½® TCP å¥—æ¥å­—çš„ç©ºé—²è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œè¶…è¿‡è¯¥æ—¶é—´æ²¡æœ‰æ´»åŠ¨æ•°æ®æ—¶ï¼Œå†…æ ¸ä¼šå‘é€å¿ƒè·³åŒ…ã€‚</li></ul></li><li><p>net.ipv4.tcp_keepalive_probes &#x3D; 3</p><ul><li>è®¾ç½®æœªæ”¶åˆ°å“åº”çš„ TCP å¿ƒè·³æ¢æµ‹æ¬¡æ•°ã€‚</li></ul></li><li><p>net.ipv4.tcp_keepalive_intvl &#x3D; 15</p><ul><li>è®¾ç½® TCP å¿ƒè·³æ¢æµ‹çš„æ—¶é—´é—´éš”ï¼ˆç§’ï¼‰ã€‚</li></ul></li><li><p>net.ipv4.tcp_max_tw_buckets &#x3D; 36000</p><ul><li>è®¾ç½®ç³»ç»Ÿå¯ä»¥ä½¿ç”¨çš„ TIME_WAIT å¥—æ¥å­—çš„æœ€å¤§æ•°é‡ã€‚</li></ul></li><li><p>net.ipv4.tcp_tw_reuse &#x3D; 1</p><ul><li>å¯ç”¨ TIME_WAIT å¥—æ¥å­—çš„é‡æ–°åˆ©ç”¨ï¼Œå…è®¸æ–°çš„å¥—æ¥å­—ä½¿ç”¨æ—§çš„ TIME_WAIT å¥—æ¥å­—ã€‚</li></ul></li><li><p>net.ipv4.tcp_max_orphans &#x3D; 327680</p><ul><li>è®¾ç½®ç³»ç»Ÿå¯ä»¥åŒæ—¶å­˜åœ¨çš„ TCP å¥—æ¥å­—åƒåœ¾å›æ”¶åŒ…è£¹æ•°çš„æœ€å¤§æ•°é‡ã€‚</li></ul></li><li><p>net.ipv4.tcp_orphan_retries &#x3D; 3</p><ul><li>è®¾ç½®ç³»ç»Ÿå¯¹äºå­¤ç«‹çš„ TCP å¥—æ¥å­—çš„é‡è¯•æ¬¡æ•°ã€‚</li></ul></li><li><p>net.ipv4.tcp_syncookies &#x3D; 1</p><ul><li>å¯ç”¨ TCP SYN cookies ä¿æŠ¤ï¼Œç”¨äºé˜²æ­¢ SYN æ´ªæ³›æ”»å‡»ã€‚</li></ul></li><li><p>net.ipv4.tcp_max_syn_backlog &#x3D; 16384</p><ul><li>è®¾ç½®æ–°çš„ TCP è¿æ¥çš„åŠè¿æ¥æ•°ï¼ˆåŠè¿æ¥é˜Ÿåˆ—ï¼‰çš„æœ€å¤§é•¿åº¦ã€‚</li></ul></li><li><p>net.ipv4.ip_conntrack_max &#x3D; 65536</p><ul><li>è®¾ç½®ç³»ç»Ÿå¯ä»¥åˆ›å»ºçš„ç½‘ç»œè¿æ¥è·Ÿè¸ªè¡¨é¡¹çš„æœ€å¤§æ•°é‡ã€‚</li></ul></li><li><p>net.ipv4.tcp_timestamps &#x3D; 0</p><ul><li>å…³é—­ TCP æ—¶é—´æˆ³åŠŸèƒ½ï¼Œç”¨äºæä¾›æ›´å¥½çš„å®‰å…¨æ€§ã€‚</li></ul></li><li><p>net.core.somaxconn &#x3D; 16384</p><ul><li>è®¾ç½®ç³»ç»Ÿæ ¸å¿ƒå±‚çš„è¿æ¥é˜Ÿåˆ—çš„æœ€å¤§å€¼ã€‚</li></ul></li></ol></div><h3 id="é…ç½®-hosts"><a href="#é…ç½®-hosts" class="headerlink" title="é…ç½® hosts"></a>é…ç½® hosts</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; /etc/hosts &lt;&lt;<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</span><br><span class="line">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</span><br><span class="line"></span><br><span class="line">10.0.0.11 master1</span><br><span class="line">10.0.0.12 master2</span><br><span class="line">10.0.0.13 master3</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h2 id="å®¹å™¨è¿è¡Œæ—¶"><a href="#å®¹å™¨è¿è¡Œæ—¶" class="headerlink" title="å®¹å™¨è¿è¡Œæ—¶"></a>å®¹å™¨è¿è¡Œæ—¶</h2><p>å®¹å™¨è¿è¡Œæ—¶å¸¸ç”¨çš„æœ‰ <code>Docker</code> å’Œ <code>containerd</code>ï¼Œè¿™é‡Œå®‰è£… <code>containerd</code></p><p>CNI æ’ä»¶åœ°å€ï¼š <a href="https://github.com/containernetworking/plugins/">https://github.com/containernetworking/plugins/</a><br>Containerd åœ°å€ï¼š <a href="https://github.com/containerd/containerd/releases/">https://github.com/containerd/containerd/releases/</a><br>runc åœ°å€ï¼š <a href="https://github.com/opencontainers/runc/releases">https://github.com/opencontainers/runc/releases</a></p><p>å®¹å™¨è¿è¡Œæ—¶æ‰€æœ‰èŠ‚ç‚¹éƒ½è¦å®‰è£…</p><h3 id="é…ç½®-Containerd-æ‰€éœ€çš„å†…æ ¸æ¨¡å—"><a href="#é…ç½®-Containerd-æ‰€éœ€çš„å†…æ ¸æ¨¡å—" class="headerlink" title="é…ç½® Containerd æ‰€éœ€çš„å†…æ ¸æ¨¡å—"></a>é…ç½® Containerd æ‰€éœ€çš„å†…æ ¸æ¨¡å—</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; /etc/modules-load.d/containerd.conf &lt;&lt;<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">overlay</span><br><span class="line">br_netfilter</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">systemctl restart systemd-modules-load.service</span><br></pre></td></tr></table></figure><div class="note success flat"><p> å‚æ•°è§£é‡Šï¼š</p><ol><li>overlayï¼šoverlay æ˜¯å®¹å™¨ d é»˜è®¤ä½¿ç”¨çš„å­˜å‚¨é©±åŠ¨ï¼Œå®ƒæä¾›äº†ä¸€ç§è½»é‡çº§çš„ã€å¯å †å çš„ã€é€å±‚å¢é‡çš„æ–‡ä»¶ç³»ç»Ÿã€‚å®ƒé€šè¿‡åœ¨ç°æœ‰æ–‡ä»¶ç³»ç»Ÿä¸Šå åŠ æ–‡ä»¶ç³»ç»Ÿå±‚æ¥åˆ›å»ºå®¹å™¨çš„æ–‡ä»¶ç³»ç»Ÿè§†å›¾ã€‚æ¯ä¸ªå®¹å™¨å¯ä»¥æœ‰è‡ªå·±çš„ä¸€ç»„æ–‡ä»¶ç³»ç»Ÿå±‚ï¼Œè¿™äº›å±‚å¯ä»¥å…±äº«åŸºç¡€é•œåƒä¸­çš„æ–‡ä»¶ï¼Œå¹¶åœ¨å®¹å™¨å†…éƒ¨è¿›è¡Œä¿®æ”¹ã€‚ä½¿ç”¨ overlay å¯ä»¥æœ‰æ•ˆåœ°ä½¿ç”¨ç£ç›˜ç©ºé—´ï¼Œå¹¶ä½¿å®¹å™¨æ›´åŠ è½»é‡çº§ã€‚</li><li>br_netfilterï¼šbr_netfilter æ˜¯ Linux å†…æ ¸æä¾›çš„ä¸€ä¸ªç½‘ç»œè¿‡æ»¤å™¨æ¨¡å—ï¼Œç”¨äºåœ¨å®¹å™¨ç½‘ç»œä¸­è¿›è¡Œç½‘ç»œè¿‡æ»¤å’Œ NAT è½¬å‘ã€‚å½“å®¹å™¨å’Œä¸»æœºä¹‹é—´çš„ç½‘ç»œé€šä¿¡éœ€è¦è¿›è¡Œ DNAT æˆ–è€… SNAT æ—¶ï¼Œbr_netfilter æ¨¡å—å¯ä»¥å°† IP åœ°å€è¿›è¡Œè½¬æ¢ã€‚å®ƒè¿˜å¯ä»¥æä¾›åŸºäº iptables è§„åˆ™çš„ç½‘ç»œè¿‡æ»¤åŠŸèƒ½ï¼Œç”¨äºé™åˆ¶å®¹å™¨ä¹‹é—´æˆ–å®¹å™¨ä¸å¤–éƒ¨ç½‘ç»œä¹‹é—´çš„é€šä¿¡ã€‚</li></ol></div><h3 id="é…ç½®-Containerd-æ‰€éœ€çš„å†…æ ¸å‚æ•°"><a href="#é…ç½®-Containerd-æ‰€éœ€çš„å†…æ ¸å‚æ•°" class="headerlink" title="é…ç½® Containerd æ‰€éœ€çš„å†…æ ¸å‚æ•°"></a>é…ç½® Containerd æ‰€éœ€çš„å†…æ ¸å‚æ•°</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; /etc/sysctl.d/99-kubernetes-cri.conf &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">net.bridge.bridge-nf-call-iptables  = 1</span><br><span class="line">net.ipv4.ip_forward                 = 1</span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">sysctl --system</span><br></pre></td></tr></table></figure><div class="note success flat"><p>å‚æ•°è§£é‡Šï¼š</p><ul><li>net.bridge.bridge-nf-call-iptablesï¼šè¿™ä¸ªå‚æ•°æ§åˆ¶ç½‘ç»œæ¡¥æ¥è®¾å¤‡æ˜¯å¦è°ƒç”¨ iptables è§„åˆ™å¤„ç†ç½‘ç»œæ•°æ®åŒ…ã€‚å½“è¯¥å‚æ•°è®¾ç½®ä¸º 1 æ—¶ï¼Œç½‘ç»œæ•°æ®åŒ…å°†è¢«ä¼ é€’åˆ° iptables è¿›è¡Œå¤„ç†ï¼›å½“è¯¥å‚æ•°è®¾ç½®ä¸º 0 æ—¶ï¼Œç½‘ç»œæ•°æ®åŒ…å°†ç»•è¿‡ iptables ç›´æ¥ä¼ é€’ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¸ªå‚æ•°çš„å€¼æ˜¯ 1ï¼Œå³å¯ç”¨ iptables è§„åˆ™å¤„ç†ç½‘ç»œæ•°æ®åŒ…ã€‚</li><li>net.ipv4.ip_forwardï¼šè¿™ä¸ªå‚æ•°ç”¨äºæ§åˆ¶æ˜¯å¦å¯ç”¨ IP è½¬å‘åŠŸèƒ½ã€‚IP è½¬å‘ä½¿å¾—æ“ä½œç³»ç»Ÿå¯ä»¥å°†æ¥æ”¶åˆ°çš„æ•°æ®åŒ…ä»ä¸€ä¸ªç½‘ç»œæ¥å£è½¬å‘åˆ°å¦ä¸€ä¸ªç½‘ç»œæ¥å£ã€‚å½“è¯¥å‚æ•°è®¾ç½®ä¸º 1 æ—¶ï¼Œå¯ç”¨ IP è½¬å‘åŠŸèƒ½ï¼›å½“è¯¥å‚æ•°è®¾ç½®ä¸º 0 æ—¶ï¼Œç¦ç”¨ IP è½¬å‘åŠŸèƒ½ã€‚åœ¨ç½‘ç»œç¯å¢ƒä¸­ï¼Œé€šå¸¸éœ€è¦å¯ç”¨ IP è½¬å‘åŠŸèƒ½æ¥å®ç°ä¸åŒç½‘ç»œä¹‹é—´çš„é€šä¿¡ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¸ªå‚æ•°çš„å€¼æ˜¯ 0ï¼Œå³ç¦ç”¨ IP è½¬å‘åŠŸèƒ½ã€‚</li><li>net.bridge.bridge-nf-call-ip6tablesï¼šè¿™ä¸ªå‚æ•°ä¸ net.bridge.bridge-nf-call-iptables ç±»ä¼¼ï¼Œä½†æ˜¯å®ƒç”¨äº IPv6 æ•°æ®åŒ…çš„å¤„ç†ã€‚å½“è¯¥å‚æ•°è®¾ç½®ä¸º 1 æ—¶ï¼ŒIPv6 æ•°æ®åŒ…å°†è¢«ä¼ é€’åˆ° ip6tables è¿›è¡Œå¤„ç†ï¼›å½“è¯¥å‚æ•°è®¾ç½®ä¸º 0 æ—¶ï¼ŒIPv6 æ•°æ®åŒ…å°†ç»•è¿‡ ip6tables ç›´æ¥ä¼ é€’ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¸ªå‚æ•°çš„å€¼æ˜¯ 1ï¼Œå³å¯ç”¨ ip6tables è§„åˆ™å¤„ç† IPv6 æ•°æ®åŒ…ã€‚</li></ul></div><h3 id="å®‰è£…-Containerd"><a href="#å®‰è£…-Containerd" class="headerlink" title="å®‰è£… Containerd"></a>å®‰è£… Containerd</h3><p><code>cri-containerd-cni-*-linux-amd64.tar.gz</code> é‡Œé¢åŒ…å«äº† cni æ’ä»¶å’Œ runc</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># https://github.com/containerd/containerd/releases/</span></span><br><span class="line"><span class="comment"># https://github.com/containerd/containerd/releases/download/v1.7.13/cri-containerd-cni-1.7.13-linux-amd64.tar.gz</span></span><br><span class="line"></span><br><span class="line">tar -xzf cri-containerd-cni-*-linux-amd64.tar.gz -C /</span><br><span class="line"><span class="built_in">rm</span> -rf /etc/cni/net.d/10-containerd-net.conflist</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºæœåŠ¡å¯åŠ¨æ–‡ä»¶</span></span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/systemd/system/containerd.service &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">[Unit]</span><br><span class="line">Description=containerd container runtime</span><br><span class="line">Documentation=https://containerd.io</span><br><span class="line">After=network.target local-fs.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">ExecStartPre=-/sbin/modprobe overlay</span><br><span class="line">ExecStart=/usr/local/bin/containerd</span><br><span class="line">Type=notify</span><br><span class="line">Delegate=<span class="built_in">yes</span></span><br><span class="line">KillMode=process</span><br><span class="line">Restart=always</span><br><span class="line">RestartSec=5</span><br><span class="line">LimitNPROC=infinity</span><br><span class="line">LimitCORE=infinity</span><br><span class="line">LimitNOFILE=infinity</span><br><span class="line">TasksMax=infinity</span><br><span class="line">OOMScoreAdjust=-999</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line">EOF</span><br><span class="line"></span><br></pre></td></tr></table></figure><div class="note success flat"><p>å‚æ•°è§£é‡Šï¼š</p><p>è¿™æ˜¯ä¸€ä¸ªç”¨äºå¯åŠ¨ containerd å®¹å™¨è¿è¡Œæ—¶çš„ systemd unit æ–‡ä»¶ã€‚ä¸‹é¢æ˜¯å¯¹è¯¥æ–‡ä»¶ä¸åŒéƒ¨åˆ†çš„è¯¦ç»†è§£é‡Šï¼š</p><p>[Unit]<br>Description&#x3D;containerd container runtime<br>æè¿°è¯¥ unit çš„ä½œç”¨æ˜¯ä½œä¸º containerd å®¹å™¨è¿è¡Œæ—¶ã€‚</p><p>Documentation&#x3D;<a href="https://containerd.io/">https://containerd.io</a><br>æŒ‡å‘å®¹å™¨è¿è¡Œæ—¶çš„æ–‡æ¡£çš„ URLã€‚</p><p>After&#x3D;network.target local-fs.target<br>å®šä¹‰äº†åœ¨å“ªäº›ä¾èµ–é¡¹ä¹‹åè¯¥ unit åº”è¯¥è¢«å¯åŠ¨ã€‚åœ¨ç½‘ç»œå’Œæœ¬åœ°æ–‡ä»¶ç³»ç»ŸåŠ è½½å®Œæˆåå¯åŠ¨ï¼Œç¡®ä¿äº†å®¹å™¨è¿è¡Œæ—¶åœ¨è¿™äº›ä¾èµ–é¡¹å¯ç”¨æ—¶æ‰ä¼šå¯åŠ¨ã€‚</p><p>[Service]<br>ExecStartPre&#x3D;-&#x2F;sbin&#x2F;modprobe overlay<br>åœ¨å¯åŠ¨ containerd ä¹‹å‰æ‰§è¡Œçš„å‘½ä»¤ã€‚è¿™é‡Œçš„å‘½ä»¤æ˜¯å°è¯•åŠ è½½å†…æ ¸çš„ overlay æ¨¡å—ï¼Œå¦‚æœå¤±è´¥åˆ™å¿½ç•¥é”™è¯¯ç»§ç»­æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ã€‚</p><p>ExecStart&#x3D;&#x2F;usr&#x2F;local&#x2F;bin&#x2F;containerd<br>å®é™…æ‰§è¡Œçš„å‘½ä»¤ï¼Œç”¨äºå¯åŠ¨ containerd å®¹å™¨è¿è¡Œæ—¶ã€‚</p><p>Type&#x3D;notify<br>æŒ‡å®šæœåŠ¡çš„é€šçŸ¥ç±»å‹ã€‚è¿™é‡Œä½¿ç”¨ notify ç±»å‹ï¼Œè¡¨ç¤ºå½“æœåŠ¡å°±ç»ªæ—¶ä¼šé€šè¿‡é€šçŸ¥çš„æ–¹å¼å‘ŠçŸ¥ systemdã€‚</p><p>Delegate&#x3D;yes<br>å…è®¸ systemd å¯¹æ­¤æœåŠ¡è¿›è¡Œé‡å¯å’Œåœæ­¢æ“ä½œã€‚</p><p>KillMode&#x3D;process<br>åœ¨ç»ˆæ­¢å®¹å™¨è¿è¡Œæ—¶æ—¶ä½¿ç”¨çš„ kill æ¨¡å¼ã€‚è¿™é‡Œä½¿ç”¨ process æ¨¡å¼ï¼Œè¡¨ç¤ºé€šè¿‡ç»ˆæ­¢è¿›ç¨‹æ¥åœæ­¢å®¹å™¨è¿è¡Œæ—¶ã€‚</p><p>Restart&#x3D;always<br>å®šä¹‰äº†å½“å®¹å™¨è¿è¡Œæ—¶ç»ˆæ­¢åçš„é‡å¯ç­–ç•¥ã€‚è¿™é‡Œè®¾ç½®ä¸º alwaysï¼Œè¡¨ç¤ºæ— è®ºä½•æ—¶ç»ˆæ­¢å®¹å™¨è¿è¡Œæ—¶ï¼Œéƒ½ä¼šè‡ªåŠ¨é‡æ–°å¯åŠ¨ã€‚</p><p>RestartSec&#x3D;5<br>åœ¨å®¹å™¨è¿è¡Œæ—¶ç»ˆæ­¢åé‡æ–°å¯åŠ¨ä¹‹å‰ç­‰å¾…çš„ç§’æ•°ã€‚</p><p>LimitNPROC&#x3D;infinity<br>æŒ‡å®šå®¹å™¨è¿è¡Œæ—¶å¯ä»¥ä½¿ç”¨çš„æœ€å¤§è¿›ç¨‹æ•°é‡ã€‚è¿™é‡Œè®¾ç½®ä¸ºæ— é™åˆ¶ã€‚</p><p>LimitCORE&#x3D;infinity<br>æŒ‡å®šå®¹å™¨è¿è¡Œæ—¶å¯ä»¥ä½¿ç”¨çš„æœ€å¤§ CPU æ ¸å¿ƒæ•°é‡ã€‚è¿™é‡Œè®¾ç½®ä¸ºæ— é™åˆ¶ã€‚</p><p>LimitNOFILE&#x3D;infinity<br>æŒ‡å®šå®¹å™¨è¿è¡Œæ—¶å¯ä»¥æ‰“å¼€çš„æœ€å¤§æ–‡ä»¶æ•°ã€‚è¿™é‡Œè®¾ç½®ä¸ºæ— é™åˆ¶ã€‚</p><p>TasksMax&#x3D;infinity<br>æŒ‡å®šå®¹å™¨è¿è¡Œæ—¶å¯ä»¥åˆ›å»ºçš„æœ€å¤§ä»»åŠ¡æ•°ã€‚è¿™é‡Œè®¾ç½®ä¸ºæ— é™åˆ¶ã€‚</p><p>OOMScoreAdjust&#x3D;-999<br>æŒ‡å®šå®¹å™¨è¿è¡Œæ—¶çš„ OOMï¼ˆOut-Of-Memoryï¼‰åˆ†æ•°è°ƒæ•´å€¼ã€‚è´Ÿæ•°å€¼è¡¨ç¤ºå®¹å™¨è¿è¡Œæ—¶çš„ä¼˜å…ˆçº§è¾ƒé«˜ã€‚</p><p>[Install]<br>WantedBy&#x3D;multi-user.target<br>å®šä¹‰äº†æœåŠ¡çš„å®‰è£…ä½ç½®ã€‚è¿™é‡ŒæŒ‡å®šä¸º multi-user.targetï¼Œè¡¨ç¤ºå°†æœåŠ¡å®‰è£…ä¸ºå¤šç”¨æˆ·æ¨¡å¼ä¸‹çš„å¯åŠ¨é¡¹ã€‚</p></div><p>å¦‚æœ containerd å®˜æ–¹ä¸ç»´æŠ¤å¸¦ cni æ’ä»¶å’Œ runc çš„åŒ…äº†ï¼Œå¯ä»¥è¿™æ ·æ‰‹åŠ¨å®‰è£…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸‹è½½cniæ’ä»¶ https://github.com/containernetworking/plugins/</span></span><br><span class="line"><span class="comment"># mkdir -p /etc/cni/net.d /opt/cni/bin </span></span><br><span class="line"><span class="comment"># tar xf cni-plugins-linux-amd64-v*.tgz -C /opt/cni/bin/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸‹è½½runc https://github.com/opencontainers/runc/releases</span></span><br><span class="line"><span class="comment"># install -m 755 runc.amd64 /usr/local/sbin/runc</span></span><br></pre></td></tr></table></figure><h3 id="Containerd-é…ç½®æ–‡ä»¶"><a href="#Containerd-é…ç½®æ–‡ä»¶" class="headerlink" title="Containerd é…ç½®æ–‡ä»¶"></a>Containerd é…ç½®æ–‡ä»¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºé»˜è®¤é…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="built_in">mkdir</span> -p /etc/containerd</span><br><span class="line">containerd config default | <span class="built_in">tee</span> /etc/containerd/config.toml</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹Containerdçš„é…ç½®æ–‡ä»¶</span></span><br><span class="line">sed -i <span class="string">&#x27;s#SystemdCgroup = .*#SystemdCgroup = true#g&#x27;</span> /etc/containerd/config.toml</span><br><span class="line">sed -i <span class="string">&quot;s#registry.k8s.io#m.daocloud.io/registry.k8s.io#g&quot;</span> /etc/containerd/config.toml</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="å¯åŠ¨å¹¶è®¾ç½®ä¸ºå¼€æœºå¯åŠ¨"><a href="#å¯åŠ¨å¹¶è®¾ç½®ä¸ºå¼€æœºå¯åŠ¨" class="headerlink" title="å¯åŠ¨å¹¶è®¾ç½®ä¸ºå¼€æœºå¯åŠ¨"></a>å¯åŠ¨å¹¶è®¾ç½®ä¸ºå¼€æœºå¯åŠ¨</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é‡æ–°åŠ è½½systemdç®¡ç†çš„å•ä½æ–‡ä»¶ã€‚å½“ä½ ä¿®æ”¹äº†æŸä¸ªå•ä½æ–‡ä»¶ï¼ˆå¦‚.serviceæ–‡ä»¶ã€.socketæ–‡ä»¶ç­‰ï¼‰ï¼Œéœ€è¦è¿è¡Œè¯¥å‘½ä»¤æ¥åˆ·æ–°systemdå¯¹è¯¥æ–‡ä»¶çš„é…ç½®ã€‚</span></span><br><span class="line"><span class="comment"># systemctl daemon-reload</span></span><br><span class="line"></span><br><span class="line">systemctl <span class="built_in">enable</span> --now containerd.service</span><br><span class="line">systemctl status containerd.service</span><br><span class="line">journalctl -u containerd -f</span><br></pre></td></tr></table></figure><h3 id="é…ç½®-crictl-å®¢æˆ·ç«¯"><a href="#é…ç½®-crictl-å®¢æˆ·ç«¯" class="headerlink" title="é…ç½® crictl å®¢æˆ·ç«¯"></a>é…ç½® crictl å®¢æˆ·ç«¯</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># https://github.com/kubernetes-sigs/cri-tools/releases/</span></span><br><span class="line"><span class="comment"># https://github.com/kubernetes-sigs/cri-tools/releases/download/v1.29.0/crictl-v1.29.0-linux-amd64.tar.gz</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è§£å‹</span></span><br><span class="line">tar xf crictl-v*-linux-amd64.tar.gz -C /usr/local/bin/</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”Ÿæˆé…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/crictl.yaml &lt;&lt;<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">runtime-endpoint: unix:///run/containerd/containerd.sock</span><br><span class="line">image-endpoint: unix:///run/containerd/containerd.sock</span><br><span class="line"><span class="built_in">timeout</span>: 10</span><br><span class="line">debug: <span class="literal">false</span></span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># æµ‹è¯•</span></span><br><span class="line">crictl info</span><br></pre></td></tr></table></figure><h2 id="ApiServer-é«˜å¯ç”¨æ–¹æ¡ˆ"><a href="#ApiServer-é«˜å¯ç”¨æ–¹æ¡ˆ" class="headerlink" title="ApiServer é«˜å¯ç”¨æ–¹æ¡ˆ"></a>ApiServer é«˜å¯ç”¨æ–¹æ¡ˆ</h2><p>é«˜å¯ç”¨æ–¹æ¡ˆæœ‰å¾ˆå¤šç§ï¼Œå…¶ä»–æ–¹æ¡ˆè¯·å‚è€ƒ <a href="/posts/10cef768/">Kubernetesä¹‹masteré«˜å¯ç”¨æ–¹æ¡ˆ</a><br>è¿™é‡Œä½¿ç”¨<strong>æ¯å°</strong>èŠ‚ç‚¹éƒ¨ç½² nginx åä»£æ¥å®ç°é«˜å¯ç”¨ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /etc/kube-lb/&#123;conf,logs,sbin&#125;</span><br><span class="line"></span><br><span class="line">curl -L -C - https://file.babudiu.com/f/qjhX/kube-lb -o /etc/kube-lb/sbin/kube-lb</span><br><span class="line"><span class="built_in">chmod</span> +x /etc/kube-lb/sbin/kube-lb</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/kube-lb/conf/kube-lb.conf &lt;&lt;<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">user root;</span><br><span class="line">worker_processes 1;</span><br><span class="line"></span><br><span class="line">error_log  /etc/kube-lb/logs/error.log warn;</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  3000;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">stream &#123;</span><br><span class="line">    upstream backend &#123;</span><br><span class="line">        server 10.0.0.11:6443    max_fails=2 fail_timeout=3s;</span><br><span class="line">        server 10.0.0.12:6443    max_fails=2 fail_timeout=3s;</span><br><span class="line">        server 10.0.0.13:6443    max_fails=2 fail_timeout=3s;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen 127.0.0.1:6443;</span><br><span class="line">        proxy_connect_timeout 1s;</span><br><span class="line">        proxy_pass backend;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/systemd/system/kube-lb.service &lt;&lt;<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">[Unit]</span><br><span class="line">Description=l4 nginx proxy <span class="keyword">for</span> kube-apiservers</span><br><span class="line">After=network.target</span><br><span class="line">After=network-online.target</span><br><span class="line">Wants=network-online.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">ExecStartPre=/etc/kube-lb/sbin/kube-lb -c /etc/kube-lb/conf/kube-lb.conf -p /etc/kube-lb -t</span><br><span class="line">ExecStart=/etc/kube-lb/sbin/kube-lb -c /etc/kube-lb/conf/kube-lb.conf -p /etc/kube-lb</span><br><span class="line">ExecReload=/etc/kube-lb/sbin/kube-lb -c /etc/kube-lb/conf/kube-lb.conf -p /etc/kube-lb -s reload</span><br><span class="line">PrivateTmp=<span class="literal">true</span></span><br><span class="line">Restart=always</span><br><span class="line">RestartSec=15</span><br><span class="line">StartLimitInterval=0</span><br><span class="line">LimitNOFILE=65536</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨æœåŠ¡</span></span><br><span class="line">systemctl <span class="built_in">enable</span> --now kube-lb</span><br></pre></td></tr></table></figure><div class="note default flat"><p>kube-lb å…¶å®å°±æ˜¯è‡ªå·±ç¼–è¯‘çš„ Nginxï¼Œç²¾ç®€äº† http æ¨¡å—ï¼Œåªå¼€å¯äº† stream æ¨¡å—ç”¨ä½œ 4 å±‚è½¬å‘ï¼Œè¯¦ç»†å‚æ•°å¦‚ä¸‹ï¼š</p><p>nginx version: nginx&#x2F;1.24.0<br>built by gcc 4.8.5 20150623 (Red Hat 4.8.5-44) (GCC)<br>configure arguments: â€“with-stream â€“without-http â€“without-http_uwsgi_module â€“without-http_scgi_module â€“without-http_fastcgi_module</p></div><h2 id="å‡†å¤‡è¯ä¹¦å’Œ-kubeconfig-æ–‡ä»¶"><a href="#å‡†å¤‡è¯ä¹¦å’Œ-kubeconfig-æ–‡ä»¶" class="headerlink" title="å‡†å¤‡è¯ä¹¦å’Œ kubeconfig æ–‡ä»¶"></a>å‡†å¤‡è¯ä¹¦å’Œ kubeconfig æ–‡ä»¶</h2><h3 id="å®‰è£…-cfssl"><a href="#å®‰è£…-cfssl" class="headerlink" title="å®‰è£… cfssl"></a>å®‰è£… cfssl</h3><p>ä¹Ÿå¯ä»¥ä½¿ç”¨ opensslï¼Œä½† openssl ç›¸å¯¹è¦ç¨å¾®éº»çƒ¦ä¸€ç‚¹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># master1èŠ‚ç‚¹ä¸‹è½½è¯ä¹¦ç”Ÿæˆå·¥å…·</span></span><br><span class="line"><span class="comment"># wget &quot;https://github.com/cloudflare/cfssl/releases/download/v1.6.4/cfssl_1.6.4_linux_amd64&quot; -O /usr/local/bin/cfssl</span></span><br><span class="line"><span class="comment"># wget &quot;https://github.com/cloudflare/cfssl/releases/download/v1.6.4/cfssljson_1.6.4_linux_amd64&quot; -O /usr/local/bin/cfssljson</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è½¯ä»¶åŒ…å†…æœ‰</span></span><br><span class="line"><span class="built_in">cp</span> cfssl_*_linux_amd64 /usr/local/bin/cfssl</span><br><span class="line"><span class="built_in">cp</span> cfssljson_*_linux_amd64 /usr/local/bin/cfssljson</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ æ‰§è¡Œæƒé™</span></span><br><span class="line"><span class="built_in">chmod</span> +x /usr/local/bin/cfssl /usr/local/bin/cfssljson</span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> -p ~/kubernetes/ssl/ &amp;&amp; <span class="built_in">cd</span> ~/kubernetes/</span><br></pre></td></tr></table></figure><h3 id="è§£å‹-k8s-å¯æ‰§è¡Œæ–‡ä»¶"><a href="#è§£å‹-k8s-å¯æ‰§è¡Œæ–‡ä»¶" class="headerlink" title="è§£å‹ k8s å¯æ‰§è¡Œæ–‡ä»¶"></a>è§£å‹ k8s å¯æ‰§è¡Œæ–‡ä»¶</h3><p>å®˜æ–¹å¼€æºåœ°å€ï¼š <a href="https://github.com/kubernetes/kubernetes/">https://github.com/kubernetes/kubernetes/</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># https://dl.k8s.io/v1.29.2/kubernetes-server-linux-amd64.tar.gz</span></span><br><span class="line">tar -xf kubernetes-server-linux-amd64.tar.gz  --strip-components=3 -C /usr/local/bin kubernetes/server/bin/kube&#123;<span class="built_in">let</span>,ctl,-apiserver,-controller-manager,-scheduler,-proxy&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿™æ˜¯ä¸€ä¸ªtarå‘½ä»¤ï¼Œç”¨äºè§£å‹æŒ‡å®šçš„kubernetes-server-linux-amd64.tar.gzæ–‡ä»¶ï¼Œå¹¶å°†å…¶ä¸­çš„ç‰¹å®šæ–‡ä»¶æå–åˆ°/usr/local/binç›®å½•ä¸‹ã€‚</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment"># å‘½ä»¤çš„è§£é‡Šå¦‚ä¸‹ï¼š</span></span><br><span class="line"><span class="comment"># - tarï¼šç”¨äºå¤„ç†tarå‹ç¼©æ–‡ä»¶çš„å‘½ä»¤ã€‚</span></span><br><span class="line"><span class="comment"># - -xfï¼šè¡¨ç¤ºè§£å‹æ“ä½œã€‚</span></span><br><span class="line"><span class="comment"># - kubernetes-server-linux-amd64.tar.gzï¼šè¦è§£å‹çš„æ–‡ä»¶åã€‚</span></span><br><span class="line"><span class="comment"># - --strip-components=3ï¼šè¡¨ç¤ºè§£å‹æ—¶å¿½ç•¥å‹ç¼©æ–‡ä»¶ä¸­çš„å‰3çº§ç›®å½•ç»“æ„ï¼Œæå–æ–‡ä»¶æ—¶ç›´æ¥æ”¾åˆ°ç›®æ ‡ç›®å½•ä¸­ã€‚</span></span><br><span class="line"><span class="comment"># - -C /usr/local/binï¼šæŒ‡å®šæå–æ–‡ä»¶çš„ç›®æ ‡ç›®å½•ä¸º/usr/local/binã€‚</span></span><br><span class="line"><span class="comment"># - kubernetes/server/bin/kube&#123;let,ctl,-apiserver,-controller-manager,-scheduler,-proxy&#125;ï¼šè¦è§£å‹å’Œæå–çš„æ–‡ä»¶åæ¨¡å¼ï¼Œç”¨èŠ±æ‹¬å·æ‹¬èµ·æ¥è¡¨ç¤ºæ¨¡å¼ä¸­çš„å¤šä¸ªå¯èƒ½çš„æ–‡ä»¶åã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†ç»„ä»¶å‘é€åˆ°å…¶ä»–èŠ‚ç‚¹</span></span><br><span class="line">Master=<span class="string">&#x27;master1 master2 master3&#x27;</span></span><br><span class="line">Worker=<span class="string">&#x27;worker1 worker2&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‹·è´masterç»„ä»¶</span></span><br><span class="line"><span class="keyword">for</span> NODE <span class="keyword">in</span> <span class="variable">$Master</span>; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$NODE</span></span><br><span class="line">    scp /usr/local/bin/kube&#123;<span class="built_in">let</span>,ctl,-apiserver,-controller-manager,-scheduler,-proxy&#125; <span class="variable">$NODE</span>:/usr/local/bin/</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‹·è´workerç»„ä»¶</span></span><br><span class="line"><span class="keyword">for</span> NODE <span class="keyword">in</span> <span class="variable">$Worker</span>; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$NODE</span></span><br><span class="line">    scp /usr/local/bin/kube&#123;<span class="built_in">let</span>,-proxy&#125; <span class="variable">$NODE</span>:/usr/local/bin/</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><h3 id="å‡†å¤‡-Etcd-è¯ä¹¦é…ç½®æ–‡ä»¶ã€è¯ä¹¦ç­¾åè¯·æ±‚"><a href="#å‡†å¤‡-Etcd-è¯ä¹¦é…ç½®æ–‡ä»¶ã€è¯ä¹¦ç­¾åè¯·æ±‚" class="headerlink" title="å‡†å¤‡ Etcd è¯ä¹¦é…ç½®æ–‡ä»¶ã€è¯ä¹¦ç­¾åè¯·æ±‚"></a>å‡†å¤‡ Etcd è¯ä¹¦é…ç½®æ–‡ä»¶ã€è¯ä¹¦ç­¾åè¯·æ±‚</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¯ä¹¦åœ¨éšä¾¿ä¸€å°æœºå™¨ä¸Šç”Ÿæˆ</span></span><br><span class="line"><span class="built_in">cat</span> &gt; ca-config.json &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;signing&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;default&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;expiry&quot;</span>: <span class="string">&quot;876000h&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;profiles&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;kubernetes&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;usages&quot;</span>: [</span><br><span class="line">            <span class="string">&quot;signing&quot;</span>,</span><br><span class="line">            <span class="string">&quot;key encipherment&quot;</span>,</span><br><span class="line">            <span class="string">&quot;server auth&quot;</span>,</span><br><span class="line">            <span class="string">&quot;client auth&quot;</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&quot;expiry&quot;</span>: <span class="string">&quot;876000h&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># CAè¯ä¹¦è®¾ç½®è¿‡æœŸæ—¶é—´ä¸º100å¹´</span></span><br><span class="line"><span class="comment"># `profiles`éƒ¨åˆ†å®šä¹‰äº†ä¸åŒçš„è¯ä¹¦é…ç½®æ–‡ä»¶ã€‚</span></span><br><span class="line"><span class="comment"># åœ¨è¿™é‡Œï¼Œåªæœ‰ä¸€ä¸ªé…ç½®æ–‡ä»¶`kubernetes`ã€‚å®ƒåŒ…å«äº†ä»¥ä¸‹`usages`å’Œè¿‡æœŸæ—¶é—´`expiry`ï¼š</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment"># 1. `signing`ï¼šç”¨äºå¯¹å…¶ä»–è¯ä¹¦è¿›è¡Œç­¾å</span></span><br><span class="line"><span class="comment"># 2. `key encipherment`ï¼šç”¨äºåŠ å¯†å’Œè§£å¯†ä¼ è¾“æ•°æ®</span></span><br><span class="line"><span class="comment"># 3. `server auth`ï¼šç”¨äºæœåŠ¡å™¨èº«ä»½éªŒè¯</span></span><br><span class="line"><span class="comment"># 4. `client auth`ï¼šç”¨äºå®¢æˆ·ç«¯èº«ä»½éªŒè¯</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &gt; etcd-ca-csr.json  &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;CN&quot;</span>: <span class="string">&quot;etcd&quot;</span>,</span><br><span class="line">  <span class="string">&quot;key&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;algo&quot;</span>: <span class="string">&quot;rsa&quot;</span>,</span><br><span class="line">    <span class="string">&quot;size&quot;</span>: 2048</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;names&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;C&quot;</span>: <span class="string">&quot;CN&quot;</span>,</span><br><span class="line">      <span class="string">&quot;ST&quot;</span>: <span class="string">&quot;Shanghai&quot;</span>,</span><br><span class="line">      <span class="string">&quot;L&quot;</span>: <span class="string">&quot;Shanghai&quot;</span>,</span><br><span class="line">      <span class="string">&quot;O&quot;</span>: <span class="string">&quot;etcd&quot;</span>,</span><br><span class="line">      <span class="string">&quot;OU&quot;</span>: <span class="string">&quot;Etcd Security&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&quot;ca&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;expiry&quot;</span>: <span class="string">&quot;876000h&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿™æ˜¯ä¸€ä¸ªç”¨äºç”Ÿæˆè¯ä¹¦ç­¾åè¯·æ±‚ï¼ˆCertificate Signing Requestï¼ŒCSRï¼‰çš„JSONé…ç½®æ–‡ä»¶ã€‚JSONé…ç½®æ–‡ä»¶æŒ‡å®šäº†ç”Ÿæˆè¯ä¹¦ç­¾åè¯·æ±‚æ‰€éœ€çš„æ•°æ®ã€‚</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment"># - &quot;CN&quot;: &quot;etcd&quot; æŒ‡å®šäº†å¸Œæœ›ç”Ÿæˆçš„è¯ä¹¦çš„CNå­—æ®µï¼ˆCommon Nameï¼‰ï¼Œå³è¯ä¹¦çš„ä¸»é¢˜ï¼Œé€šå¸¸æ˜¯è¯¥è¯ä¹¦æ ‡è¯†çš„å®ä½“çš„åç§°ã€‚</span></span><br><span class="line"><span class="comment"># - &quot;key&quot;: &#123;&#125; æŒ‡å®šäº†ç”Ÿæˆè¯ä¹¦æ‰€ä½¿ç”¨çš„å¯†é’¥çš„é…ç½®ä¿¡æ¯ã€‚&quot;algo&quot;: &quot;rsa&quot; æŒ‡å®šäº†å¯†é’¥çš„ç®—æ³•ä¸ºRSAï¼Œ&quot;size&quot;: 2048 æŒ‡å®šäº†å¯†é’¥çš„é•¿åº¦ä¸º2048ä½ã€‚</span></span><br><span class="line"><span class="comment"># - &quot;names&quot;: [] åŒ…å«äº†ç”Ÿæˆè¯ä¹¦æ—¶æ‰€éœ€çš„å®ä½“ä¿¡æ¯ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒåªåŒ…å«äº†ä¸€ä¸ªå®ä½“ï¼Œå…¶ç›¸å…³ä¿¡æ¯å¦‚ä¸‹ï¼š</span></span><br><span class="line"><span class="comment">#   - &quot;C&quot;: &quot;CN&quot; æŒ‡å®šäº†å®ä½“çš„å›½å®¶/åœ°åŒºä»£ç ï¼Œè¿™é‡Œæ˜¯ä¸­å›½ã€‚</span></span><br><span class="line"><span class="comment">#   - &quot;ST&quot;: &quot;Shanghai&quot; æŒ‡å®šäº†å®ä½“æ‰€åœ¨çš„çœ/å·ã€‚</span></span><br><span class="line"><span class="comment">#   - &quot;L&quot;: &quot;Shanghai&quot; æŒ‡å®šäº†å®ä½“æ‰€åœ¨çš„åŸå¸‚ã€‚</span></span><br><span class="line"><span class="comment">#   - &quot;O&quot;: &quot;etcd&quot; æŒ‡å®šäº†å®ä½“çš„ç»„ç»‡åç§°ã€‚</span></span><br><span class="line"><span class="comment">#   - &quot;OU&quot;: &quot;Etcd Security&quot; æŒ‡å®šäº†å®ä½“æ‰€å±çš„ç»„ç»‡å•ä½ã€‚</span></span><br><span class="line"><span class="comment"># - &quot;ca&quot;: &#123;&#125; æŒ‡å®šäº†ç”Ÿæˆè¯ä¹¦æ—¶æ‰€éœ€çš„CAï¼ˆCertificate Authorityï¼‰é…ç½®ä¿¡æ¯ã€‚</span></span><br><span class="line"><span class="comment">#   - &quot;expiry&quot;: &quot;876000h&quot; æŒ‡å®šäº†è¯ä¹¦çš„æœ‰æ•ˆæœŸï¼Œè¿™é‡Œæ˜¯876000å°æ—¶ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”Ÿæˆäº†Etcdçš„CAè¯ä¹¦</span></span><br><span class="line">cfssl gencert -initca etcd-ca-csr.json | cfssljson -bare ssl/etcd-ca</span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &gt; etcd-csr.json &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;CN&quot;</span>: <span class="string">&quot;etcd&quot;</span>,</span><br><span class="line">  <span class="string">&quot;key&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;algo&quot;</span>: <span class="string">&quot;rsa&quot;</span>,</span><br><span class="line">    <span class="string">&quot;size&quot;</span>: 2048</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;names&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;C&quot;</span>: <span class="string">&quot;CN&quot;</span>,</span><br><span class="line">      <span class="string">&quot;ST&quot;</span>: <span class="string">&quot;Shanghai&quot;</span>,</span><br><span class="line">      <span class="string">&quot;L&quot;</span>: <span class="string">&quot;Shanghai&quot;</span>,</span><br><span class="line">      <span class="string">&quot;O&quot;</span>: <span class="string">&quot;etcd&quot;</span>,</span><br><span class="line">      <span class="string">&quot;OU&quot;</span>: <span class="string">&quot;Etcd Security&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨etcdçš„caè¯ä¹¦å’Œè¯ä¹¦ç­¾åè¯·æ±‚æ¥ç”Ÿæˆetcdçš„è¯ä¹¦</span></span><br><span class="line">cfssl gencert \</span><br><span class="line">   -ca=ssl/etcd-ca.pem \</span><br><span class="line">   -ca-key=ssl/etcd-ca-key.pem \</span><br><span class="line">   -config=ca-config.json \</span><br><span class="line">   -hostname=127.0.0.1,master1,master2,master3,10.0.0.11,10.0.0.12,10.0.0.13 \</span><br><span class="line">   -profile=kubernetes \</span><br><span class="line">   etcd-csr.json | cfssljson -bare ssl/etcd</span><br></pre></td></tr></table></figure><h3 id="ç”Ÿæˆ-apiserver-è¯ä¹¦"><a href="#ç”Ÿæˆ-apiserver-è¯ä¹¦" class="headerlink" title="ç”Ÿæˆ apiserver è¯ä¹¦"></a>ç”Ÿæˆ apiserver è¯ä¹¦</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨éšä¾¿ä¸€å°æœºå™¨ä¸Šæ‰§è¡Œ</span></span><br><span class="line"><span class="built_in">cat</span> &gt; ca-csr.json &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;CN&quot;</span>: <span class="string">&quot;kubernetes&quot;</span>,</span><br><span class="line">  <span class="string">&quot;key&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;algo&quot;</span>: <span class="string">&quot;rsa&quot;</span>,</span><br><span class="line">    <span class="string">&quot;size&quot;</span>: 2048</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;names&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;C&quot;</span>: <span class="string">&quot;CN&quot;</span>,</span><br><span class="line">      <span class="string">&quot;ST&quot;</span>: <span class="string">&quot;Shanghai&quot;</span>,</span><br><span class="line">      <span class="string">&quot;L&quot;</span>: <span class="string">&quot;Shanghai&quot;</span>,</span><br><span class="line">      <span class="string">&quot;O&quot;</span>: <span class="string">&quot;Kubernetes&quot;</span>,</span><br><span class="line">      <span class="string">&quot;OU&quot;</span>: <span class="string">&quot;Kubernetes-manual&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&quot;ca&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;expiry&quot;</span>: <span class="string">&quot;876000h&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”ŸæˆCAè¯ä¹¦ï¼ŒKubernetesä½¿ç”¨</span></span><br><span class="line">cfssl gencert -initca ca-csr.json | cfssljson -bare ssl/ca</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &gt; apiserver-csr.json &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;CN&quot;</span>: <span class="string">&quot;kube-apiserver&quot;</span>,</span><br><span class="line">  <span class="string">&quot;key&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;algo&quot;</span>: <span class="string">&quot;rsa&quot;</span>,</span><br><span class="line">    <span class="string">&quot;size&quot;</span>: 2048</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;names&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;C&quot;</span>: <span class="string">&quot;CN&quot;</span>,</span><br><span class="line">      <span class="string">&quot;ST&quot;</span>: <span class="string">&quot;Shanghai&quot;</span>,</span><br><span class="line">      <span class="string">&quot;L&quot;</span>: <span class="string">&quot;Shanghai&quot;</span>,</span><br><span class="line">      <span class="string">&quot;O&quot;</span>: <span class="string">&quot;Kubernetes&quot;</span>,</span><br><span class="line">      <span class="string">&quot;OU&quot;</span>: <span class="string">&quot;Kubernetes-manual&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨CAç”Ÿæˆapiserverè¯ä¹¦</span></span><br><span class="line">cfssl gencert \</span><br><span class="line">  -ca=ssl/ca.pem   \</span><br><span class="line">  -ca-key=ssl/ca-key.pem   \</span><br><span class="line">  -config=ca-config.json   \</span><br><span class="line">  -hostname=10.96.0.1,127.0.0.1,kubernetes,kubernetes.default,kubernetes.default.svc,kubernetes.default.svc.cluster,kubernetes.default.svc.cluster.local,10.0.0.10,10.0.0.11,10.0.0.12,10.0.0.13,10.0.0.14,10.0.0.15 \</span><br><span class="line">  -profile=kubernetes apiserver-csr.json | cfssljson -bare ssl/apiserver</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="ç”Ÿæˆ-apiserver-èšåˆè¯ä¹¦"><a href="#ç”Ÿæˆ-apiserver-èšåˆè¯ä¹¦" class="headerlink" title="ç”Ÿæˆ apiserver èšåˆè¯ä¹¦"></a>ç”Ÿæˆ apiserver èšåˆè¯ä¹¦</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; front-proxy-ca-csr.json  &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;CN&quot;</span>: <span class="string">&quot;kubernetes&quot;</span>,</span><br><span class="line">  <span class="string">&quot;key&quot;</span>: &#123;</span><br><span class="line">     <span class="string">&quot;algo&quot;</span>: <span class="string">&quot;rsa&quot;</span>,</span><br><span class="line">     <span class="string">&quot;size&quot;</span>: 2048</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;ca&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;expiry&quot;</span>: <span class="string">&quot;876000h&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cfssl gencert -initca front-proxy-ca-csr.json | cfssljson -bare ssl/front-proxy-ca </span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &gt; front-proxy-client-csr.json  &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;CN&quot;</span>: <span class="string">&quot;front-proxy-client&quot;</span>,</span><br><span class="line">  <span class="string">&quot;key&quot;</span>: &#123;</span><br><span class="line">     <span class="string">&quot;algo&quot;</span>: <span class="string">&quot;rsa&quot;</span>,</span><br><span class="line">     <span class="string">&quot;size&quot;</span>: 2048</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">cfssl gencert  \</span><br><span class="line">    -ca=ssl/front-proxy-ca.pem   \</span><br><span class="line">    -ca-key=ssl/front-proxy-ca-key.pem   \</span><br><span class="line">    -config=ca-config.json   \</span><br><span class="line">    -profile=kubernetes front-proxy-client-csr.json | cfssljson -bare ssl/front-proxy-client</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="ç”Ÿæˆ-kube-controller-manager-è¯ä¹¦"><a href="#ç”Ÿæˆ-kube-controller-manager-è¯ä¹¦" class="headerlink" title="ç”Ÿæˆ kube-controller-manager è¯ä¹¦"></a>ç”Ÿæˆ kube-controller-manager è¯ä¹¦</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; kube-controller-manager-csr.json &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;CN&quot;</span>: <span class="string">&quot;system:kube-controller-manager&quot;</span>,</span><br><span class="line">  <span class="string">&quot;key&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;algo&quot;</span>: <span class="string">&quot;rsa&quot;</span>,</span><br><span class="line">    <span class="string">&quot;size&quot;</span>: 2048</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;names&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;C&quot;</span>: <span class="string">&quot;CN&quot;</span>,</span><br><span class="line">      <span class="string">&quot;ST&quot;</span>: <span class="string">&quot;Shanghai&quot;</span>,</span><br><span class="line">      <span class="string">&quot;L&quot;</span>: <span class="string">&quot;Shanghai&quot;</span>,</span><br><span class="line">      <span class="string">&quot;O&quot;</span>: <span class="string">&quot;system:kube-controller-manager&quot;</span>,</span><br><span class="line">      <span class="string">&quot;OU&quot;</span>: <span class="string">&quot;Kubernetes-manual&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cfssl gencert \</span><br><span class="line">   -ca=ssl/ca.pem \</span><br><span class="line">   -ca-key=ssl/ca-key.pem \</span><br><span class="line">   -config=ca-config.json \</span><br><span class="line">   -profile=kubernetes \</span><br><span class="line">   kube-controller-manager-csr.json | cfssljson -bare ssl/controller-manager</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="ç”Ÿæˆ-controller-manager-kubeconfig"><a href="#ç”Ÿæˆ-controller-manager-kubeconfig" class="headerlink" title="ç”Ÿæˆ controller-manager.kubeconfig"></a>ç”Ÿæˆ controller-manager.kubeconfig</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">kubectl config set-cluster kubernetes \</span><br><span class="line">     --certificate-authority=ssl/ca.pem \</span><br><span class="line">     --embed-certs=<span class="literal">true</span> \</span><br><span class="line">     --server=https://127.0.0.1:6443 \</span><br><span class="line">     --kubeconfig=controller-manager.kubeconfig</span><br><span class="line"></span><br><span class="line">kubectl config set-context system:kube-controller-manager@kubernetes \</span><br><span class="line">    --cluster=kubernetes \</span><br><span class="line">    --user=system:kube-controller-manager \</span><br><span class="line">    --kubeconfig=controller-manager.kubeconfig</span><br><span class="line"></span><br><span class="line">kubectl config set-credentials system:kube-controller-manager \</span><br><span class="line">      --client-certificate=ssl/controller-manager.pem \</span><br><span class="line">      --client-key=ssl/controller-manager-key.pem \</span><br><span class="line">      --embed-certs=<span class="literal">true</span> \</span><br><span class="line">      --kubeconfig=controller-manager.kubeconfig</span><br><span class="line"></span><br><span class="line">kubectl config use-context system:kube-controller-manager@kubernetes \</span><br><span class="line">     --kubeconfig=controller-manager.kubeconfig</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="ç”Ÿæˆ-scheduler-çš„è¯ä¹¦"><a href="#ç”Ÿæˆ-scheduler-çš„è¯ä¹¦" class="headerlink" title="ç”Ÿæˆ scheduler çš„è¯ä¹¦"></a>ç”Ÿæˆ scheduler çš„è¯ä¹¦</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; scheduler-csr.json &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;CN&quot;</span>: <span class="string">&quot;system:kube-scheduler&quot;</span>,</span><br><span class="line">  <span class="string">&quot;key&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;algo&quot;</span>: <span class="string">&quot;rsa&quot;</span>,</span><br><span class="line">    <span class="string">&quot;size&quot;</span>: 2048</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;names&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;C&quot;</span>: <span class="string">&quot;CN&quot;</span>,</span><br><span class="line">      <span class="string">&quot;ST&quot;</span>: <span class="string">&quot;Shanghai&quot;</span>,</span><br><span class="line">      <span class="string">&quot;L&quot;</span>: <span class="string">&quot;Shanghai&quot;</span>,</span><br><span class="line">      <span class="string">&quot;O&quot;</span>: <span class="string">&quot;system:kube-scheduler&quot;</span>,</span><br><span class="line">      <span class="string">&quot;OU&quot;</span>: <span class="string">&quot;Kubernetes-manual&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">cfssl gencert \</span><br><span class="line">  -ca=ssl/ca.pem \</span><br><span class="line">  -ca-key=ssl/ca-key.pem \</span><br><span class="line">  -config=ca-config.json \</span><br><span class="line">  -profile=kubernetes \</span><br><span class="line">  scheduler-csr.json | cfssljson -bare ssl/scheduler</span><br></pre></td></tr></table></figure><h3 id="ç”Ÿæˆ-scheduler-kubeconfig"><a href="#ç”Ÿæˆ-scheduler-kubeconfig" class="headerlink" title="ç”Ÿæˆ scheduler.kubeconfig"></a>ç”Ÿæˆ scheduler.kubeconfig</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">kubectl config set-cluster kubernetes \</span><br><span class="line">  --certificate-authority=ssl/ca.pem \</span><br><span class="line">  --embed-certs=<span class="literal">true</span> \</span><br><span class="line">  --server=https://127.0.0.1:6443 \</span><br><span class="line">  --kubeconfig=scheduler.kubeconfig</span><br><span class="line"></span><br><span class="line">kubectl config set-credentials system:kube-scheduler \</span><br><span class="line">  --client-certificate=ssl/scheduler.pem \</span><br><span class="line">  --client-key=ssl/scheduler-key.pem \</span><br><span class="line">  --embed-certs=<span class="literal">true</span> \</span><br><span class="line">  --kubeconfig=scheduler.kubeconfig</span><br><span class="line"></span><br><span class="line">kubectl config set-context system:kube-scheduler@kubernetes \</span><br><span class="line">  --cluster=kubernetes \</span><br><span class="line">  --user=system:kube-scheduler \</span><br><span class="line">  --kubeconfig=scheduler.kubeconfig</span><br><span class="line"></span><br><span class="line">kubectl config use-context system:kube-scheduler@kubernetes \</span><br><span class="line">  --kubeconfig=scheduler.kubeconfig</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="ç”Ÿæˆ-kubectl-çš„è¯ä¹¦é…ç½®"><a href="#ç”Ÿæˆ-kubectl-çš„è¯ä¹¦é…ç½®" class="headerlink" title="ç”Ÿæˆ kubectl çš„è¯ä¹¦é…ç½®"></a>ç”Ÿæˆ kubectl çš„è¯ä¹¦é…ç½®</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; admin-csr.json &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;CN&quot;</span>: <span class="string">&quot;admin&quot;</span>,</span><br><span class="line">  <span class="string">&quot;key&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;algo&quot;</span>: <span class="string">&quot;rsa&quot;</span>,</span><br><span class="line">    <span class="string">&quot;size&quot;</span>: 2048</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;names&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;C&quot;</span>: <span class="string">&quot;CN&quot;</span>,</span><br><span class="line">      <span class="string">&quot;ST&quot;</span>: <span class="string">&quot;Shanghai&quot;</span>,</span><br><span class="line">      <span class="string">&quot;L&quot;</span>: <span class="string">&quot;Shanghai&quot;</span>,</span><br><span class="line">      <span class="string">&quot;O&quot;</span>: <span class="string">&quot;system:masters&quot;</span>,</span><br><span class="line">      <span class="string">&quot;OU&quot;</span>: <span class="string">&quot;Kubernetes-manual&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">cfssl gencert \</span><br><span class="line">   -ca=ssl/ca.pem \</span><br><span class="line">   -ca-key=ssl/ca-key.pem \</span><br><span class="line">   -config=ca-config.json \</span><br><span class="line">   -profile=kubernetes \</span><br><span class="line">   admin-csr.json | cfssljson -bare ssl/admin</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="ç”Ÿæˆ-kubectl-çš„-admin-kubeconfig"><a href="#ç”Ÿæˆ-kubectl-çš„-admin-kubeconfig" class="headerlink" title="ç”Ÿæˆ kubectl çš„ admin.kubeconfig"></a>ç”Ÿæˆ kubectl çš„ admin.kubeconfig</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">kubectl config set-cluster kubernetes     \</span><br><span class="line">  --certificate-authority=ssl/ca.pem     \</span><br><span class="line">  --embed-certs=<span class="literal">true</span>     \</span><br><span class="line">  --server=https://127.0.0.1:6443     \</span><br><span class="line">  --kubeconfig=admin.kubeconfig</span><br><span class="line"></span><br><span class="line">kubectl config set-credentials kubernetes-admin  \</span><br><span class="line">  --client-certificate=ssl/admin.pem     \</span><br><span class="line">  --client-key=ssl/admin-key.pem     \</span><br><span class="line">  --embed-certs=<span class="literal">true</span>     \</span><br><span class="line">  --kubeconfig=admin.kubeconfig</span><br><span class="line"></span><br><span class="line">kubectl config set-context kubernetes-admin@kubernetes    \</span><br><span class="line">  --cluster=kubernetes     \</span><br><span class="line">  --user=kubernetes-admin     \</span><br><span class="line">  --kubeconfig=admin.kubeconfig</span><br><span class="line"></span><br><span class="line">kubectl config use-context kubernetes-admin@kubernetes --kubeconfig=admin.kubeconfig</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;export KUBECONFIG=&#x27;/etc/kubernetes/admin.kubeconfig&#x27;&quot;</span> &gt;&gt; ~/.bashrc &amp;&amp; <span class="built_in">source</span> ~/.bashrc</span><br></pre></td></tr></table></figure><h3 id="åˆ›å»º-kube-proxy-è¯ä¹¦"><a href="#åˆ›å»º-kube-proxy-è¯ä¹¦" class="headerlink" title="åˆ›å»º kube-proxy è¯ä¹¦"></a>åˆ›å»º kube-proxy è¯ä¹¦</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; kube-proxy-csr.json  &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;CN&quot;</span>: <span class="string">&quot;system:kube-proxy&quot;</span>,</span><br><span class="line">  <span class="string">&quot;key&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;algo&quot;</span>: <span class="string">&quot;rsa&quot;</span>,</span><br><span class="line">    <span class="string">&quot;size&quot;</span>: 2048</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;names&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;C&quot;</span>: <span class="string">&quot;CN&quot;</span>,</span><br><span class="line">      <span class="string">&quot;ST&quot;</span>: <span class="string">&quot;Shanghai&quot;</span>,</span><br><span class="line">      <span class="string">&quot;L&quot;</span>: <span class="string">&quot;Shanghai&quot;</span>,</span><br><span class="line">      <span class="string">&quot;O&quot;</span>: <span class="string">&quot;system:kube-proxy&quot;</span>,</span><br><span class="line">      <span class="string">&quot;OU&quot;</span>: <span class="string">&quot;Kubernetes-manual&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">cfssl gencert \</span><br><span class="line">   -ca=ssl/ca.pem \</span><br><span class="line">   -ca-key=ssl/ca-key.pem \</span><br><span class="line">   -config=ca-config.json \</span><br><span class="line">   -profile=kubernetes \</span><br><span class="line">   kube-proxy-csr.json | cfssljson -bare ssl/kube-proxy</span><br></pre></td></tr></table></figure><h3 id="åˆ›å»º-kube-proxy-kubeconfig"><a href="#åˆ›å»º-kube-proxy-kubeconfig" class="headerlink" title="åˆ›å»º kube-proxy.kubeconfig"></a>åˆ›å»º kube-proxy.kubeconfig</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">kubectl config set-cluster kubernetes     \</span><br><span class="line">  --certificate-authority=ssl/ca.pem     \</span><br><span class="line">  --embed-certs=<span class="literal">true</span>     \</span><br><span class="line">  --server=https://127.0.0.1:6443     \</span><br><span class="line">  --kubeconfig=kube-proxy.kubeconfig</span><br><span class="line"></span><br><span class="line">kubectl config set-credentials kube-proxy  \</span><br><span class="line">  --client-certificate=ssl/kube-proxy.pem     \</span><br><span class="line">  --client-key=ssl/kube-proxy-key.pem     \</span><br><span class="line">  --embed-certs=<span class="literal">true</span>     \</span><br><span class="line">  --kubeconfig=kube-proxy.kubeconfig</span><br><span class="line"></span><br><span class="line">kubectl config set-context kube-proxy@kubernetes    \</span><br><span class="line">  --cluster=kubernetes     \</span><br><span class="line">  --user=kube-proxy     \</span><br><span class="line">  --kubeconfig=kube-proxy.kubeconfig</span><br><span class="line"></span><br><span class="line">kubectl config use-context kube-proxy@kubernetes --kubeconfig=kube-proxy.kubeconfig</span><br></pre></td></tr></table></figure><h3 id="åˆ›å»º-ServiceAccount-Key"><a href="#åˆ›å»º-ServiceAccount-Key" class="headerlink" title="åˆ›å»º ServiceAccount Key"></a>åˆ›å»º ServiceAccount Key</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">openssl genrsa -out ssl/sa.key 2048</span><br><span class="line">openssl rsa -<span class="keyword">in</span> ssl/sa.key -pubout -out ssl/sa.pub</span><br></pre></td></tr></table></figure><h3 id="å°†è¯ä¹¦å‘é€åˆ°å…¶ä»–-master-èŠ‚ç‚¹"><a href="#å°†è¯ä¹¦å‘é€åˆ°å…¶ä»–-master-èŠ‚ç‚¹" class="headerlink" title="å°†è¯ä¹¦å‘é€åˆ°å…¶ä»– master èŠ‚ç‚¹"></a>å°†è¯ä¹¦å‘é€åˆ°å…¶ä»– master èŠ‚ç‚¹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> NODE <span class="keyword">in</span> master1 master2 master3; <span class="keyword">do</span></span><br><span class="line">    ssh <span class="variable">$&#123;NODE&#125;</span> <span class="string">&quot;mkdir /etc/kubernetes/pki/ -p&quot;</span></span><br><span class="line">    ssh <span class="variable">$&#123;NODE&#125;</span> <span class="string">&quot;mkdir /etc/etcd/ssl/ -p&quot;</span></span><br><span class="line">    <span class="keyword">for</span> FILE <span class="keyword">in</span> etcd-ca-key.pem etcd-ca.pem etcd-key.pem etcd.pem; <span class="keyword">do</span> scp ~/kubernetes/ssl/<span class="variable">$&#123;FILE&#125;</span> <span class="variable">$NODE</span>:/etc/etcd/ssl/<span class="variable">$&#123;FILE&#125;</span>; <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> FILE <span class="keyword">in</span> admin.pem admin-key.pem apiserver.pem apiserver-key.pem front-proxy-ca.pem front-proxy-client-key.pem sa.pub sa.key ca.pem ca-key.pem front-proxy-ca-key.pem front-proxy-client.pem; <span class="keyword">do</span></span><br><span class="line">        scp ~/kubernetes/ssl/<span class="variable">$&#123;FILE&#125;</span> <span class="variable">$NODE</span>:/etc/kubernetes/pki/<span class="variable">$&#123;FILE&#125;</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> FILE <span class="keyword">in</span> kube-proxy.kubeconfig admin.kubeconfig controller-manager.kubeconfig scheduler.kubeconfig; <span class="keyword">do</span></span><br><span class="line">        scp ~/kubernetes/<span class="variable">$&#123;FILE&#125;</span> <span class="variable">$NODE</span>:/etc/kubernetes/<span class="variable">$&#123;FILE&#125;</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><h2 id="Etcd-éƒ¨ç½²"><a href="#Etcd-éƒ¨ç½²" class="headerlink" title="Etcd éƒ¨ç½²"></a>Etcd éƒ¨ç½²</h2><p>ä¸‹è½½åœ°å€ï¼š <a href="https://github.com/etcd-io/etcd/releases/">https://github.com/etcd-io/etcd/releases/</a></p><h3 id="å‡†å¤‡å¯æ‰§è¡Œæ–‡ä»¶"><a href="#å‡†å¤‡å¯æ‰§è¡Œæ–‡ä»¶" class="headerlink" title="å‡†å¤‡å¯æ‰§è¡Œæ–‡ä»¶"></a>å‡†å¤‡å¯æ‰§è¡Œæ–‡ä»¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># https://github.com/etcd-io/etcd/releases/download/v3.5.12/etcd-v3.5.12-linux-amd64.tar.gz</span></span><br><span class="line">tar -xf etcd*.tar.gz</span><br><span class="line"></span><br><span class="line">Master=<span class="string">&#x27;master1 master2 master3&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‹·è´masterç»„ä»¶</span></span><br><span class="line"><span class="keyword">for</span> NODE <span class="keyword">in</span> <span class="variable">$Master</span>; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$NODE</span></span><br><span class="line">    scp etcd-*/etcd* <span class="variable">$NODE</span>:/usr/local/bin/</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><h3 id="Etcd-master1-é…ç½®"><a href="#Etcd-master1-é…ç½®" class="headerlink" title="Etcd master1 é…ç½®"></a>Etcd master1 é…ç½®</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; /etc/etcd/etcd.config.yml &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">name: <span class="string">&#x27;master1&#x27;</span></span><br><span class="line">data-dir: /var/lib/etcd</span><br><span class="line">wal-dir: /var/lib/etcd/wal</span><br><span class="line">snapshot-count: 5000</span><br><span class="line">heartbeat-interval: 100</span><br><span class="line">election-timeout: 1000</span><br><span class="line">quota-backend-bytes: 0</span><br><span class="line">listen-peer-urls: <span class="string">&#x27;https://10.0.0.11:2380&#x27;</span></span><br><span class="line">listen-client-urls: <span class="string">&#x27;https://10.0.0.11:2379,http://127.0.0.1:2379&#x27;</span></span><br><span class="line">max-snapshots: 3</span><br><span class="line">max-wals: 5</span><br><span class="line">cors:</span><br><span class="line">initial-advertise-peer-urls: <span class="string">&#x27;https://10.0.0.11:2380&#x27;</span></span><br><span class="line">advertise-client-urls: <span class="string">&#x27;https://10.0.0.11:2379&#x27;</span></span><br><span class="line">discovery:</span><br><span class="line">discovery-fallback: <span class="string">&#x27;proxy&#x27;</span></span><br><span class="line">discovery-proxy:</span><br><span class="line">discovery-srv:</span><br><span class="line">initial-cluster: <span class="string">&#x27;master1=https://10.0.0.11:2380,master2=https://10.0.0.12:2380,master3=https://10.0.0.13:2380&#x27;</span></span><br><span class="line">initial-cluster-token: <span class="string">&#x27;etcd-k8s-cluster&#x27;</span></span><br><span class="line">initial-cluster-state: <span class="string">&#x27;new&#x27;</span></span><br><span class="line">strict-reconfig-check: <span class="literal">false</span></span><br><span class="line">enable-v2: <span class="literal">true</span></span><br><span class="line">enable-pprof: <span class="literal">true</span></span><br><span class="line">proxy: <span class="string">&#x27;off&#x27;</span></span><br><span class="line">proxy-failure-wait: 5000</span><br><span class="line">proxy-refresh-interval: 30000</span><br><span class="line">proxy-dial-timeout: 1000</span><br><span class="line">proxy-write-timeout: 5000</span><br><span class="line">proxy-read-timeout: 0</span><br><span class="line">client-transport-security:</span><br><span class="line">  cert-file: <span class="string">&#x27;/etc/etcd/ssl/etcd.pem&#x27;</span></span><br><span class="line">  key-file: <span class="string">&#x27;/etc/etcd/ssl/etcd-key.pem&#x27;</span></span><br><span class="line">  client-cert-auth: <span class="literal">true</span></span><br><span class="line">  trusted-ca-file: <span class="string">&#x27;/etc/etcd/ssl/etcd-ca.pem&#x27;</span></span><br><span class="line">  auto-tls: <span class="literal">true</span></span><br><span class="line">peer-transport-security:</span><br><span class="line">  cert-file: <span class="string">&#x27;/etc/etcd/ssl/etcd.pem&#x27;</span></span><br><span class="line">  key-file: <span class="string">&#x27;/etc/etcd/ssl/etcd-key.pem&#x27;</span></span><br><span class="line">  peer-client-cert-auth: <span class="literal">true</span></span><br><span class="line">  trusted-ca-file: <span class="string">&#x27;/etc/etcd/ssl/etcd-ca.pem&#x27;</span></span><br><span class="line">  auto-tls: <span class="literal">true</span></span><br><span class="line">debug: <span class="literal">false</span></span><br><span class="line">log-package-levels:</span><br><span class="line">log-outputs: [default]</span><br><span class="line">force-new-cluster: <span class="literal">false</span></span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h3 id="Etcd-master2-é…ç½®"><a href="#Etcd-master2-é…ç½®" class="headerlink" title="Etcd master2 é…ç½®"></a>Etcd master2 é…ç½®</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; /etc/etcd/etcd.config.yml &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">name: <span class="string">&#x27;master2&#x27;</span></span><br><span class="line">data-dir: /var/lib/etcd</span><br><span class="line">wal-dir: /var/lib/etcd/wal</span><br><span class="line">snapshot-count: 5000</span><br><span class="line">heartbeat-interval: 100</span><br><span class="line">election-timeout: 1000</span><br><span class="line">quota-backend-bytes: 0</span><br><span class="line">listen-peer-urls: <span class="string">&#x27;https://10.0.0.12:2380&#x27;</span></span><br><span class="line">listen-client-urls: <span class="string">&#x27;https://10.0.0.12:2379,http://127.0.0.1:2379&#x27;</span></span><br><span class="line">max-snapshots: 3</span><br><span class="line">max-wals: 5</span><br><span class="line">cors:</span><br><span class="line">initial-advertise-peer-urls: <span class="string">&#x27;https://10.0.0.12:2380&#x27;</span></span><br><span class="line">advertise-client-urls: <span class="string">&#x27;https://10.0.0.12:2379&#x27;</span></span><br><span class="line">discovery:</span><br><span class="line">discovery-fallback: <span class="string">&#x27;proxy&#x27;</span></span><br><span class="line">discovery-proxy:</span><br><span class="line">discovery-srv:</span><br><span class="line">initial-cluster: <span class="string">&#x27;master1=https://10.0.0.11:2380,master2=https://10.0.0.12:2380,master3=https://10.0.0.13:2380&#x27;</span></span><br><span class="line">initial-cluster-token: <span class="string">&#x27;etcd-k8s-cluster&#x27;</span></span><br><span class="line">initial-cluster-state: <span class="string">&#x27;new&#x27;</span></span><br><span class="line">strict-reconfig-check: <span class="literal">false</span></span><br><span class="line">enable-v2: <span class="literal">true</span></span><br><span class="line">enable-pprof: <span class="literal">true</span></span><br><span class="line">proxy: <span class="string">&#x27;off&#x27;</span></span><br><span class="line">proxy-failure-wait: 5000</span><br><span class="line">proxy-refresh-interval: 30000</span><br><span class="line">proxy-dial-timeout: 1000</span><br><span class="line">proxy-write-timeout: 5000</span><br><span class="line">proxy-read-timeout: 0</span><br><span class="line">client-transport-security:</span><br><span class="line">  cert-file: <span class="string">&#x27;/etc/etcd/ssl/etcd.pem&#x27;</span></span><br><span class="line">  key-file: <span class="string">&#x27;/etc/etcd/ssl/etcd-key.pem&#x27;</span></span><br><span class="line">  client-cert-auth: <span class="literal">true</span></span><br><span class="line">  trusted-ca-file: <span class="string">&#x27;/etc/etcd/ssl/etcd-ca.pem&#x27;</span></span><br><span class="line">  auto-tls: <span class="literal">true</span></span><br><span class="line">peer-transport-security:</span><br><span class="line">  cert-file: <span class="string">&#x27;/etc/etcd/ssl/etcd.pem&#x27;</span></span><br><span class="line">  key-file: <span class="string">&#x27;/etc/etcd/ssl/etcd-key.pem&#x27;</span></span><br><span class="line">  peer-client-cert-auth: <span class="literal">true</span></span><br><span class="line">  trusted-ca-file: <span class="string">&#x27;/etc/etcd/ssl/etcd-ca.pem&#x27;</span></span><br><span class="line">  auto-tls: <span class="literal">true</span></span><br><span class="line">debug: <span class="literal">false</span></span><br><span class="line">log-package-levels:</span><br><span class="line">log-outputs: [default]</span><br><span class="line">force-new-cluster: <span class="literal">false</span></span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h3 id="Etcd-master3-é…ç½®"><a href="#Etcd-master3-é…ç½®" class="headerlink" title="Etcd master3 é…ç½®"></a>Etcd master3 é…ç½®</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; /etc/etcd/etcd.config.yml &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">name: <span class="string">&#x27;master3&#x27;</span></span><br><span class="line">data-dir: /var/lib/etcd</span><br><span class="line">wal-dir: /var/lib/etcd/wal</span><br><span class="line">snapshot-count: 5000</span><br><span class="line">heartbeat-interval: 100</span><br><span class="line">election-timeout: 1000</span><br><span class="line">quota-backend-bytes: 0</span><br><span class="line">listen-peer-urls: <span class="string">&#x27;https://10.0.0.13:2380&#x27;</span></span><br><span class="line">listen-client-urls: <span class="string">&#x27;https://10.0.0.13:2379,http://127.0.0.1:2379&#x27;</span></span><br><span class="line">max-snapshots: 3</span><br><span class="line">max-wals: 5</span><br><span class="line">cors:</span><br><span class="line">initial-advertise-peer-urls: <span class="string">&#x27;https://10.0.0.13:2380&#x27;</span></span><br><span class="line">advertise-client-urls: <span class="string">&#x27;https://10.0.0.13:2379&#x27;</span></span><br><span class="line">discovery:</span><br><span class="line">discovery-fallback: <span class="string">&#x27;proxy&#x27;</span></span><br><span class="line">discovery-proxy:</span><br><span class="line">discovery-srv:</span><br><span class="line">initial-cluster: <span class="string">&#x27;master1=https://10.0.0.11:2380,master2=https://10.0.0.12:2380,master3=https://10.0.0.13:2380&#x27;</span></span><br><span class="line">initial-cluster-token: <span class="string">&#x27;etcd-k8s-cluster&#x27;</span></span><br><span class="line">initial-cluster-state: <span class="string">&#x27;new&#x27;</span></span><br><span class="line">strict-reconfig-check: <span class="literal">false</span></span><br><span class="line">enable-v2: <span class="literal">true</span></span><br><span class="line">enable-pprof: <span class="literal">true</span></span><br><span class="line">proxy: <span class="string">&#x27;off&#x27;</span></span><br><span class="line">proxy-failure-wait: 5000</span><br><span class="line">proxy-refresh-interval: 30000</span><br><span class="line">proxy-dial-timeout: 1000</span><br><span class="line">proxy-write-timeout: 5000</span><br><span class="line">proxy-read-timeout: 0</span><br><span class="line">client-transport-security:</span><br><span class="line">  cert-file: <span class="string">&#x27;/etc/etcd/ssl/etcd.pem&#x27;</span></span><br><span class="line">  key-file: <span class="string">&#x27;/etc/etcd/ssl/etcd-key.pem&#x27;</span></span><br><span class="line">  client-cert-auth: <span class="literal">true</span></span><br><span class="line">  trusted-ca-file: <span class="string">&#x27;/etc/etcd/ssl/etcd-ca.pem&#x27;</span></span><br><span class="line">  auto-tls: <span class="literal">true</span></span><br><span class="line">peer-transport-security:</span><br><span class="line">  cert-file: <span class="string">&#x27;/etc/etcd/ssl/etcd.pem&#x27;</span></span><br><span class="line">  key-file: <span class="string">&#x27;/etc/etcd/ssl/etcd-key.pem&#x27;</span></span><br><span class="line">  peer-client-cert-auth: <span class="literal">true</span></span><br><span class="line">  trusted-ca-file: <span class="string">&#x27;/etc/etcd/ssl/etcd-ca.pem&#x27;</span></span><br><span class="line">  auto-tls: <span class="literal">true</span></span><br><span class="line">debug: <span class="literal">false</span></span><br><span class="line">log-package-levels:</span><br><span class="line">log-outputs: [default]</span><br><span class="line">force-new-cluster: <span class="literal">false</span></span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h3 id="åˆ›å»º-Etcd-çš„-Systemd-service"><a href="#åˆ›å»º-Etcd-çš„-Systemd-service" class="headerlink" title="åˆ›å»º Etcd çš„ Systemd service"></a>åˆ›å»º Etcd çš„ Systemd service</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ‰€æœ‰çš„masterèŠ‚ç‚¹éƒ½éœ€è¦æ‰§è¡Œ</span></span><br><span class="line"><span class="built_in">cat</span> &gt; /usr/lib/systemd/system/etcd.service &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line"></span><br><span class="line">[Unit]</span><br><span class="line">Description=Etcd Service</span><br><span class="line">Documentation=https://coreos.com/etcd/docs/latest/</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=notify</span><br><span class="line">ExecStart=/usr/local/bin/etcd --config-file=/etc/etcd/etcd.config.yml</span><br><span class="line">Restart=on-failure</span><br><span class="line">RestartSec=10</span><br><span class="line">LimitNOFILE=65536</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line">Alias=etcd3.service</span><br><span class="line"></span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨Etcdï¼Œ etcdéœ€è¦åªè¦ä¸¤ä¸ªèŠ‚ç‚¹æ‰èƒ½å¯åŠ¨ï¼Œå°½é‡è¿™å‡ ä¸ªèŠ‚ç‚¹ä¸€å—å¯åŠ¨ã€‚</span></span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl <span class="built_in">enable</span> --now etcd</span><br><span class="line">systemctl status etcd</span><br><span class="line">journalctl -u etcd -f</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹-Etcd-çŠ¶æ€"><a href="#æŸ¥çœ‹-Etcd-çŠ¶æ€" class="headerlink" title="æŸ¥çœ‹ Etcd çŠ¶æ€"></a>æŸ¥çœ‹ Etcd çŠ¶æ€</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> ETCDCTL_API=3</span><br><span class="line">etcdctl --endpoints=<span class="string">&quot;10.0.0.13:2379,10.0.0.12:2379,10.0.0.11:2379&quot;</span> --cacert=/etc/etcd/ssl/etcd-ca.pem --cert=/etc/etcd/ssl/etcd.pem --key=/etc/etcd/ssl/etcd-key.pem endpoint status --write-out=table</span><br></pre></td></tr></table></figure><h2 id="master-èŠ‚ç‚¹ç»„ä»¶å®‰è£…"><a href="#master-èŠ‚ç‚¹ç»„ä»¶å®‰è£…" class="headerlink" title="master èŠ‚ç‚¹ç»„ä»¶å®‰è£…"></a>master èŠ‚ç‚¹ç»„ä»¶å®‰è£…</h2><h3 id="å®‰è£…-Apiserver"><a href="#å®‰è£…-Apiserver" class="headerlink" title="å®‰è£… Apiserver"></a>å®‰è£… Apiserver</h3><h4 id="master1-èŠ‚ç‚¹é…ç½®"><a href="#master1-èŠ‚ç‚¹é…ç½®" class="headerlink" title="master1 èŠ‚ç‚¹é…ç½®"></a>master1 èŠ‚ç‚¹é…ç½®</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; /usr/lib/systemd/system/kube-apiserver.service &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line"></span><br><span class="line">[Unit]</span><br><span class="line">Description=Kubernetes API Server</span><br><span class="line">Documentation=https://github.com/kubernetes/kubernetes</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">ExecStart=/usr/local/bin/kube-apiserver \</span><br><span class="line">      --v=2  \</span><br><span class="line">      --allow-privileged=<span class="literal">true</span>  \</span><br><span class="line">      --bind-address=10.0.0.11  \</span><br><span class="line">      --secure-port=6443  \</span><br><span class="line">      --advertise-address=10.0.0.11 \</span><br><span class="line">      --service-cluster-ip-range=10.96.0.0/12 \</span><br><span class="line">      --service-node-port-range=30000-32767  \</span><br><span class="line">      --etcd-servers=https://10.0.0.11:2379,https://10.0.0.12:2379,https://10.0.0.13:2379 \</span><br><span class="line">      --etcd-cafile=/etc/etcd/ssl/etcd-ca.pem  \</span><br><span class="line">      --etcd-certfile=/etc/etcd/ssl/etcd.pem  \</span><br><span class="line">      --etcd-keyfile=/etc/etcd/ssl/etcd-key.pem  \</span><br><span class="line">      --client-ca-file=/etc/kubernetes/pki/ca.pem  \</span><br><span class="line">      --tls-cert-file=/etc/kubernetes/pki/apiserver.pem  \</span><br><span class="line">      --tls-private-key-file=/etc/kubernetes/pki/apiserver-key.pem  \</span><br><span class="line">      --kubelet-client-certificate=/etc/kubernetes/pki/apiserver.pem  \</span><br><span class="line">      --kubelet-client-key=/etc/kubernetes/pki/apiserver-key.pem  \</span><br><span class="line">      --service-account-key-file=/etc/kubernetes/pki/sa.pub  \</span><br><span class="line">      --service-account-signing-key-file=/etc/kubernetes/pki/sa.key  \</span><br><span class="line">      --service-account-issuer=https://kubernetes.default.svc.cluster.local \</span><br><span class="line">      --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname  \</span><br><span class="line">      --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,NodeRestriction,ResourceQuota  \</span><br><span class="line">      --authorization-mode=Node,RBAC  \</span><br><span class="line">      --enable-bootstrap-token-auth=<span class="literal">true</span>  \</span><br><span class="line">      --requestheader-client-ca-file=/etc/kubernetes/pki/front-proxy-ca.pem  \</span><br><span class="line">      --proxy-client-cert-file=/etc/kubernetes/pki/front-proxy-client.pem  \</span><br><span class="line">      --proxy-client-key-file=/etc/kubernetes/pki/front-proxy-client-key.pem  \</span><br><span class="line">      --requestheader-allowed-names=aggregator  \</span><br><span class="line">      --requestheader-group-headers=X-Remote-Group  \</span><br><span class="line">      --requestheader-extra-headers-prefix=X-Remote-Extra-  \</span><br><span class="line">      --requestheader-username-headers=X-Remote-User \</span><br><span class="line">      --enable-aggregator-routing=<span class="literal">true</span></span><br><span class="line">Restart=on-failure</span><br><span class="line">RestartSec=10s</span><br><span class="line">LimitNOFILE=65535</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h4 id="master2-èŠ‚ç‚¹é…ç½®"><a href="#master2-èŠ‚ç‚¹é…ç½®" class="headerlink" title="master2 èŠ‚ç‚¹é…ç½®"></a>master2 èŠ‚ç‚¹é…ç½®</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; /usr/lib/systemd/system/kube-apiserver.service &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">[Unit]</span><br><span class="line">Description=Kubernetes API Server</span><br><span class="line">Documentation=https://github.com/kubernetes/kubernetes</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">ExecStart=/usr/local/bin/kube-apiserver \</span><br><span class="line">      --v=2  \</span><br><span class="line">      --allow-privileged=<span class="literal">true</span>  \</span><br><span class="line">      --bind-address=10.0.0.12  \</span><br><span class="line">      --secure-port=6443  \</span><br><span class="line">      --advertise-address=10.0.0.12 \</span><br><span class="line">      --service-cluster-ip-range=10.96.0.0/12  \</span><br><span class="line">      --service-node-port-range=30000-32767  \</span><br><span class="line">      --etcd-servers=https://10.0.0.11:2379,https://10.0.0.12:2379,https://10.0.0.13:2379 \</span><br><span class="line">      --etcd-cafile=/etc/etcd/ssl/etcd-ca.pem  \</span><br><span class="line">      --etcd-certfile=/etc/etcd/ssl/etcd.pem  \</span><br><span class="line">      --etcd-keyfile=/etc/etcd/ssl/etcd-key.pem  \</span><br><span class="line">      --client-ca-file=/etc/kubernetes/pki/ca.pem  \</span><br><span class="line">      --tls-cert-file=/etc/kubernetes/pki/apiserver.pem  \</span><br><span class="line">      --tls-private-key-file=/etc/kubernetes/pki/apiserver-key.pem  \</span><br><span class="line">      --kubelet-client-certificate=/etc/kubernetes/pki/apiserver.pem  \</span><br><span class="line">      --kubelet-client-key=/etc/kubernetes/pki/apiserver-key.pem  \</span><br><span class="line">      --service-account-key-file=/etc/kubernetes/pki/sa.pub  \</span><br><span class="line">      --service-account-signing-key-file=/etc/kubernetes/pki/sa.key  \</span><br><span class="line">      --service-account-issuer=https://kubernetes.default.svc.cluster.local \</span><br><span class="line">      --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname  \</span><br><span class="line">      --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,NodeRestriction,ResourceQuota  \</span><br><span class="line">      --authorization-mode=Node,RBAC  \</span><br><span class="line">      --enable-bootstrap-token-auth=<span class="literal">true</span>  \</span><br><span class="line">      --requestheader-client-ca-file=/etc/kubernetes/pki/front-proxy-ca.pem  \</span><br><span class="line">      --proxy-client-cert-file=/etc/kubernetes/pki/front-proxy-client.pem  \</span><br><span class="line">      --proxy-client-key-file=/etc/kubernetes/pki/front-proxy-client-key.pem  \</span><br><span class="line">      --requestheader-allowed-names=aggregator  \</span><br><span class="line">      --requestheader-group-headers=X-Remote-Group  \</span><br><span class="line">      --requestheader-extra-headers-prefix=X-Remote-Extra-  \</span><br><span class="line">      --requestheader-username-headers=X-Remote-User \</span><br><span class="line">      --enable-aggregator-routing=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line">Restart=on-failure</span><br><span class="line">RestartSec=10s</span><br><span class="line">LimitNOFILE=65535</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h4 id="master3-èŠ‚ç‚¹é…ç½®"><a href="#master3-èŠ‚ç‚¹é…ç½®" class="headerlink" title="master3 èŠ‚ç‚¹é…ç½®"></a>master3 èŠ‚ç‚¹é…ç½®</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; /usr/lib/systemd/system/kube-apiserver.service  &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line"></span><br><span class="line">[Unit]</span><br><span class="line">Description=Kubernetes API Server</span><br><span class="line">Documentation=https://github.com/kubernetes/kubernetes</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">ExecStart=/usr/local/bin/kube-apiserver \</span><br><span class="line">      --v=2  \</span><br><span class="line">      --allow-privileged=<span class="literal">true</span>  \</span><br><span class="line">      --bind-address=10.0.0.13  \</span><br><span class="line">      --secure-port=6443  \</span><br><span class="line">      --advertise-address=10.0.0.13 \</span><br><span class="line">      --service-cluster-ip-range=10.96.0.0/12 \</span><br><span class="line">      --service-node-port-range=30000-32767  \</span><br><span class="line">      --etcd-servers=https://10.0.0.11:2379,https://10.0.0.12:2379,https://10.0.0.13:2379 \</span><br><span class="line">      --etcd-cafile=/etc/etcd/ssl/etcd-ca.pem  \</span><br><span class="line">      --etcd-certfile=/etc/etcd/ssl/etcd.pem  \</span><br><span class="line">      --etcd-keyfile=/etc/etcd/ssl/etcd-key.pem  \</span><br><span class="line">      --client-ca-file=/etc/kubernetes/pki/ca.pem  \</span><br><span class="line">      --tls-cert-file=/etc/kubernetes/pki/apiserver.pem  \</span><br><span class="line">      --tls-private-key-file=/etc/kubernetes/pki/apiserver-key.pem  \</span><br><span class="line">      --kubelet-client-certificate=/etc/kubernetes/pki/apiserver.pem  \</span><br><span class="line">      --kubelet-client-key=/etc/kubernetes/pki/apiserver-key.pem  \</span><br><span class="line">      --service-account-key-file=/etc/kubernetes/pki/sa.pub  \</span><br><span class="line">      --service-account-signing-key-file=/etc/kubernetes/pki/sa.key  \</span><br><span class="line">      --service-account-issuer=https://kubernetes.default.svc.cluster.local \</span><br><span class="line">      --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname  \</span><br><span class="line">      --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,NodeRestriction,ResourceQuota  \</span><br><span class="line">      --authorization-mode=Node,RBAC  \</span><br><span class="line">      --enable-bootstrap-token-auth=<span class="literal">true</span>  \</span><br><span class="line">      --requestheader-client-ca-file=/etc/kubernetes/pki/front-proxy-ca.pem  \</span><br><span class="line">      --proxy-client-cert-file=/etc/kubernetes/pki/front-proxy-client.pem  \</span><br><span class="line">      --proxy-client-key-file=/etc/kubernetes/pki/front-proxy-client-key.pem  \</span><br><span class="line">      --requestheader-allowed-names=aggregator  \</span><br><span class="line">      --requestheader-group-headers=X-Remote-Group  \</span><br><span class="line">      --requestheader-extra-headers-prefix=X-Remote-Extra-  \</span><br><span class="line">      --requestheader-username-headers=X-Remote-User \</span><br><span class="line">      --enable-aggregator-routing=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line">Restart=on-failure</span><br><span class="line">RestartSec=10s</span><br><span class="line">LimitNOFILE=65535</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h4 id="å¯åŠ¨-apiserverï¼ˆæ‰€æœ‰-master-èŠ‚ç‚¹ï¼‰"><a href="#å¯åŠ¨-apiserverï¼ˆæ‰€æœ‰-master-èŠ‚ç‚¹ï¼‰" class="headerlink" title="å¯åŠ¨ apiserverï¼ˆæ‰€æœ‰ master èŠ‚ç‚¹ï¼‰"></a>å¯åŠ¨ apiserverï¼ˆæ‰€æœ‰ master èŠ‚ç‚¹ï¼‰</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl <span class="built_in">enable</span> --now kube-apiserver.service</span><br><span class="line">systemctl status kube-apiserver.service</span><br><span class="line">journalctl -u kube-apiserver -f</span><br></pre></td></tr></table></figure><h3 id="é…ç½®-kube-controller-manager-service"><a href="#é…ç½®-kube-controller-manager-service" class="headerlink" title="é…ç½® kube-controller-manager service"></a>é…ç½® kube-controller-manager service</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ‰€æœ‰masterèŠ‚ç‚¹é…ç½®ï¼Œä¸”é…ç½®ç›¸åŒ</span></span><br><span class="line"><span class="comment"># 10.244.0.0/16ä¸ºpodç½‘æ®µï¼ŒæŒ‰éœ€æ±‚è®¾ç½®ä½ è‡ªå·±çš„ç½‘æ®µ</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &gt; /usr/lib/systemd/system/kube-controller-manager.service &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line"></span><br><span class="line">[Unit]</span><br><span class="line">Description=Kubernetes Controller Manager</span><br><span class="line">Documentation=https://github.com/kubernetes/kubernetes</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">ExecStart=/usr/local/bin/kube-controller-manager \</span><br><span class="line">      --v=2 \</span><br><span class="line">      --bind-address=0.0.0.0 \</span><br><span class="line">      --root-ca-file=/etc/kubernetes/pki/ca.pem \</span><br><span class="line">      --cluster-signing-cert-file=/etc/kubernetes/pki/ca.pem \</span><br><span class="line">      --cluster-signing-key-file=/etc/kubernetes/pki/ca-key.pem \</span><br><span class="line">      --service-account-private-key-file=/etc/kubernetes/pki/sa.key \</span><br><span class="line">      --kubeconfig=/etc/kubernetes/controller-manager.kubeconfig \</span><br><span class="line">      --leader-elect=<span class="literal">true</span> \</span><br><span class="line">      --use-service-account-credentials=<span class="literal">true</span> \</span><br><span class="line">      --node-monitor-grace-period=40s \</span><br><span class="line">      --node-monitor-period=5s \</span><br><span class="line">      --controllers=*,bootstrapsigner,tokencleaner \</span><br><span class="line">      --allocate-node-cidrs=<span class="literal">true</span> \</span><br><span class="line">      --service-cluster-ip-range=10.96.0.0/12 \</span><br><span class="line">      --cluster-cidr=10.244.0.0/16 \</span><br><span class="line">      --requestheader-client-ca-file=/etc/kubernetes/pki/front-proxy-ca.pem</span><br><span class="line"></span><br><span class="line">Restart=always</span><br><span class="line">RestartSec=10s</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h4 id="å¯åŠ¨-kube-controller-managerï¼Œå¹¶æŸ¥çœ‹çŠ¶æ€"><a href="#å¯åŠ¨-kube-controller-managerï¼Œå¹¶æŸ¥çœ‹çŠ¶æ€" class="headerlink" title="å¯åŠ¨ kube-controller-managerï¼Œå¹¶æŸ¥çœ‹çŠ¶æ€"></a>å¯åŠ¨ kube-controller-managerï¼Œå¹¶æŸ¥çœ‹çŠ¶æ€</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl <span class="built_in">enable</span> --now kube-controller-manager.service</span><br><span class="line">systemctl status kube-controller-manager.service</span><br><span class="line">journalctl -u kube-controller-manager.service -f</span><br></pre></td></tr></table></figure><h3 id="é…ç½®-kube-scheduler-service"><a href="#é…ç½®-kube-scheduler-service" class="headerlink" title="é…ç½® kube-scheduler service"></a>é…ç½® kube-scheduler service</h3><h4 id="æ‰€æœ‰-master-èŠ‚ç‚¹é…ç½®ï¼Œä¸”é…ç½®ç›¸åŒ"><a href="#æ‰€æœ‰-master-èŠ‚ç‚¹é…ç½®ï¼Œä¸”é…ç½®ç›¸åŒ" class="headerlink" title="æ‰€æœ‰ master èŠ‚ç‚¹é…ç½®ï¼Œä¸”é…ç½®ç›¸åŒ"></a>æ‰€æœ‰ master èŠ‚ç‚¹é…ç½®ï¼Œä¸”é…ç½®ç›¸åŒ</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; /usr/lib/systemd/system/kube-scheduler.service &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line"></span><br><span class="line">[Unit]</span><br><span class="line">Description=Kubernetes Scheduler</span><br><span class="line">Documentation=https://github.com/kubernetes/kubernetes</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">ExecStart=/usr/local/bin/kube-scheduler \</span><br><span class="line">      --v=2 \</span><br><span class="line">      --bind-address=0.0.0.0 \</span><br><span class="line">      --leader-elect=<span class="literal">true</span> \</span><br><span class="line">      --kubeconfig=/etc/kubernetes/scheduler.kubeconfig</span><br><span class="line"></span><br><span class="line">Restart=always</span><br><span class="line">RestartSec=10s</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h4 id="å¯åŠ¨å¹¶æŸ¥çœ‹æœåŠ¡çŠ¶æ€"><a href="#å¯åŠ¨å¹¶æŸ¥çœ‹æœåŠ¡çŠ¶æ€" class="headerlink" title="å¯åŠ¨å¹¶æŸ¥çœ‹æœåŠ¡çŠ¶æ€"></a>å¯åŠ¨å¹¶æŸ¥çœ‹æœåŠ¡çŠ¶æ€</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl <span class="built_in">enable</span> --now kube-scheduler.service</span><br><span class="line">systemctl status kube-scheduler.service</span><br><span class="line">journalctl -u kube-scheduler -f</span><br></pre></td></tr></table></figure><h3 id="TLS-Bootstrapping-é…ç½®"><a href="#TLS-Bootstrapping-é…ç½®" class="headerlink" title="TLS Bootstrapping é…ç½®"></a>TLS Bootstrapping é…ç½®</h3><h4 id="åœ¨-master1-ä¸Šé…ç½®"><a href="#åœ¨-master1-ä¸Šé…ç½®" class="headerlink" title="åœ¨ master1 ä¸Šé…ç½®"></a>åœ¨ master1 ä¸Šé…ç½®</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># name token-id token-secret å¦‚è¦ä¿®æ”¹ä¸€å—ä¿®æ”¹</span></span><br><span class="line"><span class="built_in">cat</span> &gt; bootstrap.secret.yaml &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Secret</span><br><span class="line">metadata:</span><br><span class="line">  name: bootstrap-token-g1yhn5</span><br><span class="line">  namespace: kube-system</span><br><span class="line"><span class="built_in">type</span>: bootstrap.kubernetes.io/token</span><br><span class="line">stringData:</span><br><span class="line">  description: <span class="string">&quot;The default bootstrap token generated by &#x27;kubelet &#x27;.&quot;</span></span><br><span class="line">  token-id: g1yhn5</span><br><span class="line">  token-secret: vqvd8tenyvtjn7lq</span><br><span class="line">  usage-bootstrap-authentication: <span class="string">&quot;true&quot;</span></span><br><span class="line">  usage-bootstrap-signing: <span class="string">&quot;true&quot;</span></span><br><span class="line">  auth-extra-groups:  system:bootstrappers:default-node-token,system:bootstrappers:worker,system:bootstrappers:ingress</span><br><span class="line"> </span><br><span class="line">---</span><br><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line">kind: ClusterRoleBinding</span><br><span class="line">metadata:</span><br><span class="line">  name: kubelet-bootstrap</span><br><span class="line">roleRef:</span><br><span class="line">  apiGroup: rbac.authorization.k8s.io</span><br><span class="line">  kind: ClusterRole</span><br><span class="line">  name: system:node-bootstrapper</span><br><span class="line">subjects:</span><br><span class="line">- apiGroup: rbac.authorization.k8s.io</span><br><span class="line">  kind: Group</span><br><span class="line">  name: system:bootstrappers:default-node-token</span><br><span class="line">---</span><br><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line">kind: ClusterRoleBinding</span><br><span class="line">metadata:</span><br><span class="line">  name: node-autoapprove-bootstrap</span><br><span class="line">roleRef:</span><br><span class="line">  apiGroup: rbac.authorization.k8s.io</span><br><span class="line">  kind: ClusterRole</span><br><span class="line">  name: system:certificates.k8s.io:certificatesigningrequests:nodeclient</span><br><span class="line">subjects:</span><br><span class="line">- apiGroup: rbac.authorization.k8s.io</span><br><span class="line">  kind: Group</span><br><span class="line">  name: system:bootstrappers:default-node-token</span><br><span class="line">---</span><br><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line">kind: ClusterRoleBinding</span><br><span class="line">metadata:</span><br><span class="line">  name: node-autoapprove-certificate-rotation</span><br><span class="line">roleRef:</span><br><span class="line">  apiGroup: rbac.authorization.k8s.io</span><br><span class="line">  kind: ClusterRole</span><br><span class="line">  name: system:certificates.k8s.io:certificatesigningrequests:selfnodeclient</span><br><span class="line">subjects:</span><br><span class="line">- apiGroup: rbac.authorization.k8s.io</span><br><span class="line">  kind: Group</span><br><span class="line">  name: system:nodes</span><br><span class="line">---</span><br><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line">kind: ClusterRole</span><br><span class="line">metadata:</span><br><span class="line">  annotations:</span><br><span class="line">    rbac.authorization.kubernetes.io/autoupdate: <span class="string">&quot;true&quot;</span></span><br><span class="line">  labels:</span><br><span class="line">    kubernetes.io/bootstrapping: rbac-defaults</span><br><span class="line">  name: system:kube-apiserver-to-kubelet</span><br><span class="line">rules:</span><br><span class="line">  - apiGroups:</span><br><span class="line">      - <span class="string">&quot;&quot;</span></span><br><span class="line">    resources:</span><br><span class="line">      - nodes/proxy</span><br><span class="line">      - nodes/stats</span><br><span class="line">      - nodes/log</span><br><span class="line">      - nodes/spec</span><br><span class="line">      - nodes/metrics</span><br><span class="line">    verbs:</span><br><span class="line">      - <span class="string">&quot;*&quot;</span></span><br><span class="line">---</span><br><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line">kind: ClusterRoleBinding</span><br><span class="line">metadata:</span><br><span class="line">  name: system:kube-apiserver</span><br><span class="line">  namespace: <span class="string">&quot;&quot;</span></span><br><span class="line">roleRef:</span><br><span class="line">  apiGroup: rbac.authorization.k8s.io</span><br><span class="line">  kind: ClusterRole</span><br><span class="line">  name: system:kube-apiserver-to-kubelet</span><br><span class="line">subjects:</span><br><span class="line">  - apiGroup: rbac.authorization.k8s.io</span><br><span class="line">    kind: User</span><br><span class="line">    name: kube-apiserver</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">kubectl config set-cluster kubernetes     \</span><br><span class="line">    --certificate-authority=/etc/kubernetes/pki/ca.pem     \</span><br><span class="line">    --embed-certs=<span class="literal">true</span>     --server=https://127.0.0.1:6443     \</span><br><span class="line">    --kubeconfig=bootstrap-kubelet.kubeconfig</span><br><span class="line"></span><br><span class="line"><span class="comment"># å’Œä¸Šé¢çš„tokenä¿æŒä¸€è‡´</span></span><br><span class="line">kubectl config set-credentials tls-bootstrap-token-user     \</span><br><span class="line">    --token=g1yhn5.vqvd8tenyvtjn7lq \</span><br><span class="line">    --kubeconfig=bootstrap-kubelet.kubeconfig</span><br><span class="line"></span><br><span class="line">kubectl config set-context tls-bootstrap-token-user@kubernetes     \</span><br><span class="line">    --cluster=kubernetes     \</span><br><span class="line">    --user=tls-bootstrap-token-user     \</span><br><span class="line">    --kubeconfig=bootstrap-kubelet.kubeconfig</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">kubectl config use-context tls-bootstrap-token-user@kubernetes     \</span><br><span class="line">    --kubeconfig=bootstrap-kubelet.kubeconfig</span><br><span class="line"></span><br><span class="line">kubectl create -f bootstrap.secret.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># bootstrap-kubelet.kubeconfig æ–‡ä»¶åˆ†å‘åˆ°å…¶ä»–æ‰€æœ‰èŠ‚ç‚¹ï¼ŒåŒ…æ‹¬masterå’Œworker</span></span><br><span class="line">scp bootstrap-kubelet.kubeconfig master1:/etc/kubernetes/</span><br><span class="line">scp bootstrap-kubelet.kubeconfig master2:/etc/kubernetes/</span><br><span class="line">scp bootstrap-kubelet.kubeconfig master3:/etc/kubernetes/</span><br></pre></td></tr></table></figure><h4 id="æŸ¥çœ‹é›†ç¾¤çŠ¶æ€"><a href="#æŸ¥çœ‹é›†ç¾¤çŠ¶æ€" class="headerlink" title="æŸ¥çœ‹é›†ç¾¤çŠ¶æ€"></a>æŸ¥çœ‹é›†ç¾¤çŠ¶æ€</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">kubectl get cs</span><br><span class="line">Warning: v1 ComponentStatus is deprecated <span class="keyword">in</span> v1.19+</span><br><span class="line">NAME                 STATUS    MESSAGE   ERROR</span><br><span class="line">scheduler            Healthy   ok        </span><br><span class="line">controller-manager   Healthy   ok        </span><br><span class="line">etcd-0               Healthy   ok </span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="worker-èŠ‚ç‚¹é…ç½®ï¼ˆæ–°å¢-worker-èŠ‚ç‚¹ï¼‰"><a href="#worker-èŠ‚ç‚¹é…ç½®ï¼ˆæ–°å¢-worker-èŠ‚ç‚¹ï¼‰" class="headerlink" title="worker èŠ‚ç‚¹é…ç½®ï¼ˆæ–°å¢ worker èŠ‚ç‚¹ï¼‰"></a>worker èŠ‚ç‚¹é…ç½®ï¼ˆæ–°å¢ worker èŠ‚ç‚¹ï¼‰</h2><p>master èŠ‚ç‚¹ä¸Šä¹Ÿå¯ä»¥éƒ¨ç½² <code>kubelet</code> å’Œ <code>kube-proxy</code> ï¼Œå¦‚æœ <code>master</code> èŠ‚ç‚¹ä»…åšç®¡ç†ï¼Œä¸è¿›è¡Œè°ƒåº¦ä¸è®¿é—®ï¼Œå¯ä»¥ä¸å®‰è£… <code>kubelet</code> å’Œ <code>kube-proxy</code>, ä¸å®‰è£… <code>kubelet</code>ï¼Œé‚£ä¹ˆ <code>kubectl get node</code> ä¸æ˜¾ç¤ºã€‚</p><h3 id="åœ¨-master1-ä¸Šå°†è¯ä¹¦å¤åˆ¶åˆ°-node-èŠ‚ç‚¹"><a href="#åœ¨-master1-ä¸Šå°†è¯ä¹¦å¤åˆ¶åˆ°-node-èŠ‚ç‚¹" class="headerlink" title="åœ¨ master1 ä¸Šå°†è¯ä¹¦å¤åˆ¶åˆ° node èŠ‚ç‚¹"></a>åœ¨ master1 ä¸Šå°†è¯ä¹¦å¤åˆ¶åˆ° node èŠ‚ç‚¹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/kubernetes/</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> NODE <span class="keyword">in</span> worker1 worker2; <span class="keyword">do</span></span><br><span class="line">    ssh <span class="variable">$NODE</span> <span class="built_in">mkdir</span> -p /etc/kubernetes/pki</span><br><span class="line">    scp ssl/ca.pem <span class="variable">$NODE</span>:/etc/kubernetes/pki/</span><br><span class="line">    scp bootstrap-kubelet.kubeconfig kube-proxy.kubeconfig <span class="variable">$NODE</span>:/etc/kubernetes/</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><h3 id="kubelet-é…ç½®"><a href="#kubelet-é…ç½®" class="headerlink" title="kubelet é…ç½®"></a>kubelet é…ç½®</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /var/lib/kubelet /var/log/kubernetes /etc/systemd/system/kubelet.service.d /etc/kubernetes/manifests/</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰€æœ‰k8sèŠ‚ç‚¹é…ç½®kubelet service</span></span><br><span class="line"><span class="built_in">cat</span> &gt; /usr/lib/systemd/system/kubelet.service &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line"></span><br><span class="line">[Unit]</span><br><span class="line">Description=Kubernetes Kubelet</span><br><span class="line">Documentation=https://github.com/kubernetes/kubernetes</span><br><span class="line">After=network-online.target firewalld.service containerd.service</span><br><span class="line">Wants=network-online.target</span><br><span class="line">Requires=containerd.service</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">ExecStart=/usr/local/bin/kubelet \</span><br><span class="line">    --bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.kubeconfig  \</span><br><span class="line">    --kubeconfig=/etc/kubernetes/kubelet.kubeconfig \</span><br><span class="line">    --config=/etc/kubernetes/kubelet-conf.yml \</span><br><span class="line">    --container-runtime-endpoint=unix:///run/containerd/containerd.sock  \</span><br><span class="line">    --node-labels=node.kubernetes.io/node=</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ‰€æœ‰k8sèŠ‚ç‚¹åˆ›å»ºkubeletçš„é…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/kubernetes/kubelet-conf.yml &lt;&lt;<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">apiVersion: kubelet.config.k8s.io/v1beta1</span><br><span class="line">kind: KubeletConfiguration</span><br><span class="line">address: 0.0.0.0</span><br><span class="line">port: 10250</span><br><span class="line">readOnlyPort: 10255</span><br><span class="line">authentication:</span><br><span class="line">  anonymous:</span><br><span class="line">    enabled: <span class="literal">false</span></span><br><span class="line">  webhook:</span><br><span class="line">    cacheTTL: 2m0s</span><br><span class="line">    enabled: <span class="literal">true</span></span><br><span class="line">  x509:</span><br><span class="line">    clientCAFile: /etc/kubernetes/pki/ca.pem</span><br><span class="line">authorization:</span><br><span class="line">  mode: Webhook</span><br><span class="line">  webhook:</span><br><span class="line">    cacheAuthorizedTTL: 5m0s</span><br><span class="line">    cacheUnauthorizedTTL: 30s</span><br><span class="line">cgroupDriver: systemd</span><br><span class="line">cgroupsPerQOS: <span class="literal">true</span></span><br><span class="line">clusterDNS:</span><br><span class="line">- 10.96.0.10</span><br><span class="line">clusterDomain: cluster.local</span><br><span class="line">containerLogMaxFiles: 5</span><br><span class="line">containerLogMaxSize: 10Mi</span><br><span class="line">contentType: application/vnd.kubernetes.protobuf</span><br><span class="line">cpuCFSQuota: <span class="literal">true</span></span><br><span class="line">cpuManagerPolicy: none</span><br><span class="line">cpuManagerReconcilePeriod: 10s</span><br><span class="line">enableControllerAttachDetach: <span class="literal">true</span></span><br><span class="line">enableDebuggingHandlers: <span class="literal">true</span></span><br><span class="line">enforceNodeAllocatable:</span><br><span class="line">- pods</span><br><span class="line">eventBurst: 10</span><br><span class="line">eventRecordQPS: 5</span><br><span class="line">evictionHard:</span><br><span class="line">  imagefs.available: 15%</span><br><span class="line">  memory.available: 100Mi</span><br><span class="line">  nodefs.available: 10%</span><br><span class="line">  nodefs.inodesFree: 5%</span><br><span class="line">evictionPressureTransitionPeriod: 5m0s</span><br><span class="line">failSwapOn: <span class="literal">true</span></span><br><span class="line">fileCheckFrequency: 20s</span><br><span class="line">hairpinMode: promiscuous-bridge</span><br><span class="line">healthzBindAddress: 127.0.0.1</span><br><span class="line">healthzPort: 10248</span><br><span class="line">httpCheckFrequency: 20s</span><br><span class="line">imageGCHighThresholdPercent: 85</span><br><span class="line">imageGCLowThresholdPercent: 80</span><br><span class="line">imageMinimumGCAge: 2m0s</span><br><span class="line">iptablesDropBit: 15</span><br><span class="line">iptablesMasqueradeBit: 14</span><br><span class="line">kubeAPIBurst: 10</span><br><span class="line">kubeAPIQPS: 5</span><br><span class="line">makeIPTablesUtilChains: <span class="literal">true</span></span><br><span class="line">maxOpenFiles: 1000000</span><br><span class="line">maxPods: 110</span><br><span class="line">nodeStatusUpdateFrequency: 10s</span><br><span class="line">oomScoreAdj: -999</span><br><span class="line">podPidsLimit: -1</span><br><span class="line">registryBurst: 10</span><br><span class="line">registryPullQPS: 5</span><br><span class="line">resolvConf: /etc/resolv.conf</span><br><span class="line">rotateCertificates: <span class="literal">true</span></span><br><span class="line">runtimeRequestTimeout: 2m0s</span><br><span class="line">serializeImagePulls: <span class="literal">true</span></span><br><span class="line">staticPodPath: /etc/kubernetes/manifests</span><br><span class="line">streamingConnectionIdleTimeout: 4h0m0s</span><br><span class="line">syncFrequency: 1m0s</span><br><span class="line">volumeStatsAggPeriod: 1m0s</span><br><span class="line">EOF</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯åŠ¨kubelet</span></span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl <span class="built_in">enable</span> --now kubelet.service</span><br><span class="line">systemctl status kubelet.service</span><br><span class="line">journalctl -u kubelet -f</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹é›†ç¾¤</span></span><br><span class="line">[root@master1 ~]<span class="comment"># kubectl  get node</span></span><br><span class="line">NAME           STATUS   ROLES    AGE   VERSION</span><br><span class="line">master1   Ready    &lt;none&gt;   16s   v1.29.2</span><br><span class="line">master2   Ready    &lt;none&gt;   13s   v1.29.2</span><br><span class="line">master3   Ready    &lt;none&gt;   12s   v1.29.2</span><br><span class="line">worker1   Ready    &lt;none&gt;   10s   v1.29.2</span><br><span class="line">worker2   Ready    &lt;none&gt;   9s    v1.29.2</span><br><span class="line"></span><br><span class="line">[root@master1 ~]<span class="comment"># kubectl describe node | grep Runtime</span></span><br><span class="line">  Container Runtime Version:  containerd://1.7.13</span><br><span class="line">  Container Runtime Version:  containerd://1.7.13</span><br><span class="line">  Container Runtime Version:  containerd://1.7.13</span><br><span class="line">  Container Runtime Version:  containerd://1.7.13</span><br><span class="line">  Container Runtime Version:  containerd://1.7.13</span><br></pre></td></tr></table></figure><h3 id="kube-proxy-é…ç½®"><a href="#kube-proxy-é…ç½®" class="headerlink" title="kube-proxy é…ç½®"></a>kube-proxy é…ç½®</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ‰€æœ‰èŠ‚ç‚¹æ‰§è¡Œ</span></span><br><span class="line"><span class="built_in">cat</span> &gt;  /usr/lib/systemd/system/kube-proxy.service &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">[Unit]</span><br><span class="line">Description=Kubernetes Kube Proxy</span><br><span class="line">Documentation=https://github.com/kubernetes/kubernetes</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">ExecStart=/usr/local/bin/kube-proxy \</span><br><span class="line">  --config=/etc/kubernetes/kube-proxy.yaml \</span><br><span class="line">  --v=2</span><br><span class="line">Restart=always</span><br><span class="line">RestartSec=10s</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line">EOF</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ‰€æœ‰k8sèŠ‚ç‚¹æ·»åŠ kube-proxyçš„é…ç½®</span></span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/kubernetes/kube-proxy.yaml &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">apiVersion: kubeproxy.config.k8s.io/v1alpha1</span></span><br><span class="line"><span class="string">bindAddress: 0.0.0.0</span></span><br><span class="line"><span class="string">clientConnection:</span></span><br><span class="line"><span class="string">  acceptContentTypes: &quot;&quot;</span></span><br><span class="line"><span class="string">  burst: 10</span></span><br><span class="line"><span class="string">  contentType: application/vnd.kubernetes.protobuf</span></span><br><span class="line"><span class="string">  kubeconfig: /etc/kubernetes/kube-proxy.kubeconfig</span></span><br><span class="line"><span class="string">  qps: 5</span></span><br><span class="line"><span class="string">clusterCIDR: 10.244.0.0/16</span></span><br><span class="line"><span class="string">configSyncPeriod: 15m0s</span></span><br><span class="line"><span class="string">conntrack:</span></span><br><span class="line"><span class="string">  max: null</span></span><br><span class="line"><span class="string">  maxPerCore: 32768</span></span><br><span class="line"><span class="string">  min: 131072</span></span><br><span class="line"><span class="string">  tcpCloseWaitTimeout: 1h0m0s</span></span><br><span class="line"><span class="string">  tcpEstablishedTimeout: 24h0m0s</span></span><br><span class="line"><span class="string">enableProfiling: false</span></span><br><span class="line"><span class="string">healthzBindAddress: 0.0.0.0:10256</span></span><br><span class="line"><span class="string">hostnameOverride: &quot;&quot;</span></span><br><span class="line"><span class="string">iptables:</span></span><br><span class="line"><span class="string">  masqueradeAll: false</span></span><br><span class="line"><span class="string">  masqueradeBit: 14</span></span><br><span class="line"><span class="string">  minSyncPeriod: 0s</span></span><br><span class="line"><span class="string">  syncPeriod: 30s</span></span><br><span class="line"><span class="string">ipvs:</span></span><br><span class="line"><span class="string">  masqueradeAll: true</span></span><br><span class="line"><span class="string">  minSyncPeriod: 5s</span></span><br><span class="line"><span class="string">  scheduler: &quot;rr&quot;</span></span><br><span class="line"><span class="string">  syncPeriod: 30s</span></span><br><span class="line"><span class="string">kind: KubeProxyConfiguration</span></span><br><span class="line"><span class="string">metricsBindAddress: 127.0.0.1:10249</span></span><br><span class="line"><span class="string">mode: &quot;ipvs&quot;</span></span><br><span class="line"><span class="string">nodePortAddresses: null</span></span><br><span class="line"><span class="string">oomScoreAdj: -999</span></span><br><span class="line"><span class="string">portRange: &quot;&quot;</span></span><br><span class="line"><span class="string">udpIdleTimeout: 250ms</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯åŠ¨kube-proxy</span></span><br><span class="line">systemctl <span class="built_in">enable</span> --now kube-proxy.service</span><br><span class="line">systemctl status kube-proxy.service</span><br><span class="line">journalctl -u kube-proxy -f</span><br></pre></td></tr></table></figure><h2 id="æ–°å¢-master-èŠ‚ç‚¹"><a href="#æ–°å¢-master-èŠ‚ç‚¹" class="headerlink" title="æ–°å¢ master èŠ‚ç‚¹"></a>æ–°å¢ master èŠ‚ç‚¹</h2><p>æœªå®Œå¾…ç»­</p><h3 id="æ–°å¢-Etcd-èŠ‚ç‚¹"><a href="#æ–°å¢-Etcd-èŠ‚ç‚¹" class="headerlink" title="æ–°å¢ Etcd èŠ‚ç‚¹"></a>æ–°å¢ Etcd èŠ‚ç‚¹</h3><p>ç•¥</p><h3 id="æ–°å¢-kube-apiserver-å’Œ-kube-scheduler-å’Œ-kube-controller-manager"><a href="#æ–°å¢-kube-apiserver-å’Œ-kube-scheduler-å’Œ-kube-controller-manager" class="headerlink" title="æ–°å¢ kube-apiserver å’Œ kube-scheduler å’Œ kube-controller-manager"></a>æ–°å¢ kube-apiserver å’Œ kube-scheduler å’Œ kube-controller-manager</h3><p>ç•¥</p><h2 id="å®‰è£…ç½‘ç»œæ’ä»¶"><a href="#å®‰è£…ç½‘ç»œæ’ä»¶" class="headerlink" title="å®‰è£…ç½‘ç»œæ’ä»¶"></a>å®‰è£…ç½‘ç»œæ’ä»¶</h2><h3 id="éƒ¨ç½²-flannel-ç½‘ç»œæ’ä»¶"><a href="#éƒ¨ç½²-flannel-ç½‘ç»œæ’ä»¶" class="headerlink" title="éƒ¨ç½² flannel ç½‘ç»œæ’ä»¶"></a>éƒ¨ç½² flannel ç½‘ç»œæ’ä»¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># wget https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml</span></span><br><span class="line"><span class="comment"># net-conf.json:  è¿™é‡Œéœ€è¦ä¿®æ”¹ä¸ºPodç½‘æ®µ</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &gt; kube-flannel.yml &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">---</span><br><span class="line">kind: Namespace</span><br><span class="line">apiVersion: v1</span><br><span class="line">metadata:</span><br><span class="line">  name: kube-flannel</span><br><span class="line">  labels:</span><br><span class="line">    k8s-app: flannel</span><br><span class="line">    pod-security.kubernetes.io/enforce: privileged</span><br><span class="line">---</span><br><span class="line">kind: ClusterRole</span><br><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    k8s-app: flannel</span><br><span class="line">  name: flannel</span><br><span class="line">rules:</span><br><span class="line">- apiGroups:</span><br><span class="line">  - <span class="string">&quot;&quot;</span></span><br><span class="line">  resources:</span><br><span class="line">  - pods</span><br><span class="line">  verbs:</span><br><span class="line">  - get</span><br><span class="line">- apiGroups:</span><br><span class="line">  - <span class="string">&quot;&quot;</span></span><br><span class="line">  resources:</span><br><span class="line">  - nodes</span><br><span class="line">  verbs:</span><br><span class="line">  - get</span><br><span class="line">  - list</span><br><span class="line">  - watch</span><br><span class="line">- apiGroups:</span><br><span class="line">  - <span class="string">&quot;&quot;</span></span><br><span class="line">  resources:</span><br><span class="line">  - nodes/status</span><br><span class="line">  verbs:</span><br><span class="line">  - patch</span><br><span class="line">---</span><br><span class="line">kind: ClusterRoleBinding</span><br><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    k8s-app: flannel</span><br><span class="line">  name: flannel</span><br><span class="line">roleRef:</span><br><span class="line">  apiGroup: rbac.authorization.k8s.io</span><br><span class="line">  kind: ClusterRole</span><br><span class="line">  name: flannel</span><br><span class="line">subjects:</span><br><span class="line">- kind: ServiceAccount</span><br><span class="line">  name: flannel</span><br><span class="line">  namespace: kube-flannel</span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: ServiceAccount</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    k8s-app: flannel</span><br><span class="line">  name: flannel</span><br><span class="line">  namespace: kube-flannel</span><br><span class="line">---</span><br><span class="line">kind: ConfigMap</span><br><span class="line">apiVersion: v1</span><br><span class="line">metadata:</span><br><span class="line">  name: kube-flannel-cfg</span><br><span class="line">  namespace: kube-flannel</span><br><span class="line">  labels:</span><br><span class="line">    tier: node</span><br><span class="line">    k8s-app: flannel</span><br><span class="line">    app: flannel</span><br><span class="line">data:</span><br><span class="line">  cni-conf.json: |</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;name&quot;</span>: <span class="string">&quot;cbr0&quot;</span>,</span><br><span class="line">      <span class="string">&quot;cniVersion&quot;</span>: <span class="string">&quot;0.3.1&quot;</span>,</span><br><span class="line">      <span class="string">&quot;plugins&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;flannel&quot;</span>,</span><br><span class="line">          <span class="string">&quot;delegate&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;hairpinMode&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="string">&quot;isDefaultGateway&quot;</span>: <span class="literal">true</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;portmap&quot;</span>,</span><br><span class="line">          <span class="string">&quot;capabilities&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;portMappings&quot;</span>: <span class="literal">true</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  net-conf.json: |</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;Network&quot;</span>: <span class="string">&quot;10.244.0.0/16&quot;</span>,</span><br><span class="line">      <span class="string">&quot;EnableNFTables&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="string">&quot;Backend&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;Type&quot;</span>: <span class="string">&quot;vxlan&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">---</span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: DaemonSet</span><br><span class="line">metadata:</span><br><span class="line">  name: kube-flannel-ds</span><br><span class="line">  namespace: kube-flannel</span><br><span class="line">  labels:</span><br><span class="line">    tier: node</span><br><span class="line">    app: flannel</span><br><span class="line">    k8s-app: flannel</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: flannel</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        tier: node</span><br><span class="line">        app: flannel</span><br><span class="line">    spec:</span><br><span class="line">      affinity:</span><br><span class="line">        nodeAffinity:</span><br><span class="line">          requiredDuringSchedulingIgnoredDuringExecution:</span><br><span class="line">            nodeSelectorTerms:</span><br><span class="line">            - matchExpressions:</span><br><span class="line">              - key: kubernetes.io/os</span><br><span class="line">                operator: In</span><br><span class="line">                values:</span><br><span class="line">                - linux</span><br><span class="line">      hostNetwork: <span class="literal">true</span></span><br><span class="line">      priorityClassName: system-node-critical</span><br><span class="line">      tolerations:</span><br><span class="line">      - operator: Exists</span><br><span class="line">        effect: NoSchedule</span><br><span class="line">      serviceAccountName: flannel</span><br><span class="line">      initContainers:</span><br><span class="line">      - name: install-cni-plugin</span><br><span class="line">        image: registry.cn-hangzhou.aliyuncs.com/iuxt/flannel-cni-plugin:v1.4.1-flannel1</span><br><span class="line">        <span class="built_in">command</span>:</span><br><span class="line">        - <span class="built_in">cp</span></span><br><span class="line">        args:</span><br><span class="line">        - -f</span><br><span class="line">        - /flannel</span><br><span class="line">        - /opt/cni/bin/flannel</span><br><span class="line">        volumeMounts:</span><br><span class="line">        - name: cni-plugin</span><br><span class="line">          mountPath: /opt/cni/bin</span><br><span class="line">      - name: install-cni</span><br><span class="line">        image: registry.cn-hangzhou.aliyuncs.com/iuxt/flannel:v0.25.2</span><br><span class="line">        <span class="built_in">command</span>:</span><br><span class="line">        - <span class="built_in">cp</span></span><br><span class="line">        args:</span><br><span class="line">        - -f</span><br><span class="line">        - /etc/kube-flannel/cni-conf.json</span><br><span class="line">        - /etc/cni/net.d/10-flannel.conflist</span><br><span class="line">        volumeMounts:</span><br><span class="line">        - name: cni</span><br><span class="line">          mountPath: /etc/cni/net.d</span><br><span class="line">        - name: flannel-cfg</span><br><span class="line">          mountPath: /etc/kube-flannel/</span><br><span class="line">      containers:</span><br><span class="line">      - name: kube-flannel</span><br><span class="line">        image: registry.cn-hangzhou.aliyuncs.com/iuxt/flannel:v0.25.2</span><br><span class="line">        <span class="built_in">command</span>:</span><br><span class="line">        - /opt/bin/flanneld</span><br><span class="line">        args:</span><br><span class="line">        - --ip-masq</span><br><span class="line">        - --kube-subnet-mgr</span><br><span class="line">        resources:</span><br><span class="line">          requests:</span><br><span class="line">            cpu: <span class="string">&quot;100m&quot;</span></span><br><span class="line">            memory: <span class="string">&quot;50Mi&quot;</span></span><br><span class="line">        securityContext:</span><br><span class="line">          privileged: <span class="literal">false</span></span><br><span class="line">          capabilities:</span><br><span class="line">            add: [<span class="string">&quot;NET_ADMIN&quot;</span>, <span class="string">&quot;NET_RAW&quot;</span>]</span><br><span class="line">        <span class="built_in">env</span>:</span><br><span class="line">        - name: POD_NAME</span><br><span class="line">          valueFrom:</span><br><span class="line">            fieldRef:</span><br><span class="line">              fieldPath: metadata.name</span><br><span class="line">        - name: POD_NAMESPACE</span><br><span class="line">          valueFrom:</span><br><span class="line">            fieldRef:</span><br><span class="line">              fieldPath: metadata.namespace</span><br><span class="line">        - name: EVENT_QUEUE_DEPTH</span><br><span class="line">          value: <span class="string">&quot;5000&quot;</span></span><br><span class="line">        volumeMounts:</span><br><span class="line">        - name: run</span><br><span class="line">          mountPath: /run/flannel</span><br><span class="line">        - name: flannel-cfg</span><br><span class="line">          mountPath: /etc/kube-flannel/</span><br><span class="line">        - name: xtables-lock</span><br><span class="line">          mountPath: /run/xtables.lock</span><br><span class="line">      volumes:</span><br><span class="line">      - name: run</span><br><span class="line">        hostPath:</span><br><span class="line">          path: /run/flannel</span><br><span class="line">      - name: cni-plugin</span><br><span class="line">        hostPath:</span><br><span class="line">          path: /opt/cni/bin</span><br><span class="line">      - name: cni</span><br><span class="line">        hostPath:</span><br><span class="line">          path: /etc/cni/net.d</span><br><span class="line">      - name: flannel-cfg</span><br><span class="line">        configMap:</span><br><span class="line">          name: kube-flannel-cfg</span><br><span class="line">      - name: xtables-lock</span><br><span class="line">        hostPath:</span><br><span class="line">          path: /run/xtables.lock</span><br><span class="line">          <span class="built_in">type</span>: FileOrCreate</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºflannelæ’ä»¶</span></span><br><span class="line">kubectl apply -f kube-flannel.yml</span><br></pre></td></tr></table></figure><h2 id="é™„åŠ ç»„ä»¶éƒ¨ç½²"><a href="#é™„åŠ ç»„ä»¶éƒ¨ç½²" class="headerlink" title="é™„åŠ ç»„ä»¶éƒ¨ç½²"></a>é™„åŠ ç»„ä»¶éƒ¨ç½²</h2><h3 id="éƒ¨ç½²-coreDNS"><a href="#éƒ¨ç½²-coreDNS" class="headerlink" title="éƒ¨ç½² coreDNS"></a>éƒ¨ç½² coreDNS</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; coredns.yaml &lt;&lt;<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: ServiceAccount</span><br><span class="line">metadata:</span><br><span class="line">  name: coredns</span><br><span class="line">  namespace: kube-system</span><br><span class="line">---</span><br><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line">kind: ClusterRole</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    kubernetes.io/bootstrapping: rbac-defaults</span><br><span class="line">  name: system:coredns</span><br><span class="line">rules:</span><br><span class="line">  - apiGroups:</span><br><span class="line">    - <span class="string">&quot;&quot;</span></span><br><span class="line">    resources:</span><br><span class="line">    - endpoints</span><br><span class="line">    - services</span><br><span class="line">    - pods</span><br><span class="line">    - namespaces</span><br><span class="line">    verbs:</span><br><span class="line">    - list</span><br><span class="line">    - watch</span><br><span class="line">  - apiGroups:</span><br><span class="line">    - discovery.k8s.io</span><br><span class="line">    resources:</span><br><span class="line">    - endpointslices</span><br><span class="line">    verbs:</span><br><span class="line">    - list</span><br><span class="line">    - watch</span><br><span class="line">---</span><br><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line">kind: ClusterRoleBinding</span><br><span class="line">metadata:</span><br><span class="line">  annotations:</span><br><span class="line">    rbac.authorization.kubernetes.io/autoupdate: <span class="string">&quot;true&quot;</span></span><br><span class="line">  labels:</span><br><span class="line">    kubernetes.io/bootstrapping: rbac-defaults</span><br><span class="line">  name: system:coredns</span><br><span class="line">roleRef:</span><br><span class="line">  apiGroup: rbac.authorization.k8s.io</span><br><span class="line">  kind: ClusterRole</span><br><span class="line">  name: system:coredns</span><br><span class="line">subjects:</span><br><span class="line">- kind: ServiceAccount</span><br><span class="line">  name: coredns</span><br><span class="line">  namespace: kube-system</span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: ConfigMap</span><br><span class="line">metadata:</span><br><span class="line">  name: coredns</span><br><span class="line">  namespace: kube-system</span><br><span class="line">data:</span><br><span class="line">  Corefile: |</span><br><span class="line">    .:53 &#123;</span><br><span class="line">        errors</span><br><span class="line">        health &#123;</span><br><span class="line">          lameduck 5s</span><br><span class="line">        &#125;</span><br><span class="line">        ready</span><br><span class="line">        kubernetes cluster.local in-addr.arpa ip6.arpa &#123;</span><br><span class="line">          fallthrough in-addr.arpa ip6.arpa</span><br><span class="line">        &#125;</span><br><span class="line">        prometheus :9153</span><br><span class="line">        forward . /etc/resolv.conf &#123;</span><br><span class="line">          max_concurrent 1000</span><br><span class="line">        &#125;</span><br><span class="line">        cache 30</span><br><span class="line">        loop</span><br><span class="line">        reload</span><br><span class="line">        loadbalance</span><br><span class="line">    &#125;</span><br><span class="line">---</span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: coredns</span><br><span class="line">  namespace: kube-system</span><br><span class="line">  labels:</span><br><span class="line">    k8s-app: kube-dns</span><br><span class="line">    kubernetes.io/name: <span class="string">&quot;CoreDNS&quot;</span></span><br><span class="line">    app.kubernetes.io/name: coredns</span><br><span class="line">spec:</span><br><span class="line">  <span class="comment"># replicas: not specified here:</span></span><br><span class="line">  <span class="comment"># 1. Default is 1.</span></span><br><span class="line">  <span class="comment"># 2. Will be tuned in real time if DNS horizontal auto-scaling is turned on.</span></span><br><span class="line">  strategy:</span><br><span class="line">    <span class="built_in">type</span>: RollingUpdate</span><br><span class="line">    rollingUpdate:</span><br><span class="line">      maxUnavailable: 1</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      k8s-app: kube-dns</span><br><span class="line">      app.kubernetes.io/name: coredns</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        k8s-app: kube-dns</span><br><span class="line">        app.kubernetes.io/name: coredns</span><br><span class="line">    spec:</span><br><span class="line">      priorityClassName: system-cluster-critical</span><br><span class="line">      serviceAccountName: coredns</span><br><span class="line">      tolerations:</span><br><span class="line">        - key: <span class="string">&quot;CriticalAddonsOnly&quot;</span></span><br><span class="line">          operator: <span class="string">&quot;Exists&quot;</span></span><br><span class="line">      nodeSelector:</span><br><span class="line">        kubernetes.io/os: linux</span><br><span class="line">      affinity:</span><br><span class="line">         podAntiAffinity:</span><br><span class="line">           requiredDuringSchedulingIgnoredDuringExecution:</span><br><span class="line">           - labelSelector:</span><br><span class="line">               matchExpressions:</span><br><span class="line">               - key: k8s-app</span><br><span class="line">                 operator: In</span><br><span class="line">                 values: [<span class="string">&quot;kube-dns&quot;</span>]</span><br><span class="line">             topologyKey: kubernetes.io/hostname</span><br><span class="line">      containers:</span><br><span class="line">      - name: coredns</span><br><span class="line">        image: registry.cn-hangzhou.aliyuncs.com/iuxt/coredns:1.9.4</span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br><span class="line">        resources:</span><br><span class="line">          limits:</span><br><span class="line">            memory: 170Mi</span><br><span class="line">          requests:</span><br><span class="line">            cpu: 100m</span><br><span class="line">            memory: 70Mi</span><br><span class="line">        args: [ <span class="string">&quot;-conf&quot;</span>, <span class="string">&quot;/etc/coredns/Corefile&quot;</span> ]</span><br><span class="line">        volumeMounts:</span><br><span class="line">        - name: config-volume</span><br><span class="line">          mountPath: /etc/coredns</span><br><span class="line">          readOnly: <span class="literal">true</span></span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 53</span><br><span class="line">          name: dns</span><br><span class="line">          protocol: UDP</span><br><span class="line">        - containerPort: 53</span><br><span class="line">          name: dns-tcp</span><br><span class="line">          protocol: TCP</span><br><span class="line">        - containerPort: 9153</span><br><span class="line">          name: metrics</span><br><span class="line">          protocol: TCP</span><br><span class="line">        securityContext:</span><br><span class="line">          allowPrivilegeEscalation: <span class="literal">false</span></span><br><span class="line">          capabilities:</span><br><span class="line">            add:</span><br><span class="line">            - NET_BIND_SERVICE</span><br><span class="line">            drop:</span><br><span class="line">            - all</span><br><span class="line">          readOnlyRootFilesystem: <span class="literal">true</span></span><br><span class="line">        livenessProbe:</span><br><span class="line">          httpGet:</span><br><span class="line">            path: /health</span><br><span class="line">            port: 8080</span><br><span class="line">            scheme: HTTP</span><br><span class="line">          initialDelaySeconds: 60</span><br><span class="line">          timeoutSeconds: 5</span><br><span class="line">          successThreshold: 1</span><br><span class="line">          failureThreshold: 5</span><br><span class="line">        readinessProbe:</span><br><span class="line">          httpGet:</span><br><span class="line">            path: /ready</span><br><span class="line">            port: 8181</span><br><span class="line">            scheme: HTTP</span><br><span class="line">      dnsPolicy: Default</span><br><span class="line">      volumes:</span><br><span class="line">        - name: config-volume</span><br><span class="line">          configMap:</span><br><span class="line">            name: coredns</span><br><span class="line">            items:</span><br><span class="line">            - key: Corefile</span><br><span class="line">              path: Corefile</span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: kube-dns</span><br><span class="line">  namespace: kube-system</span><br><span class="line">  annotations:</span><br><span class="line">    prometheus.io/port: <span class="string">&quot;9153&quot;</span></span><br><span class="line">    prometheus.io/scrape: <span class="string">&quot;true&quot;</span></span><br><span class="line">  labels:</span><br><span class="line">    k8s-app: kube-dns</span><br><span class="line">    kubernetes.io/cluster-service: <span class="string">&quot;true&quot;</span></span><br><span class="line">    kubernetes.io/name: <span class="string">&quot;CoreDNS&quot;</span></span><br><span class="line">    app.kubernetes.io/name: coredns</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    k8s-app: kube-dns</span><br><span class="line">    app.kubernetes.io/name: coredns</span><br><span class="line">  clusterIP: 10.96.0.10</span><br><span class="line">  ports:</span><br><span class="line">  - name: dns</span><br><span class="line">    port: 53</span><br><span class="line">    protocol: UDP</span><br><span class="line">  - name: dns-tcp</span><br><span class="line">    port: 53</span><br><span class="line">    protocol: TCP</span><br><span class="line">  - name: metrics</span><br><span class="line">    port: 9153</span><br><span class="line">    protocol: TCP</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create -f coredns.yaml</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹çŠ¶æ€"><a href="#æŸ¥çœ‹çŠ¶æ€" class="headerlink" title="æŸ¥çœ‹çŠ¶æ€"></a>æŸ¥çœ‹çŠ¶æ€</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get po -n kube-system -l k8s-app=kube-dns</span><br></pre></td></tr></table></figure><h3 id="éªŒè¯-CoreDNS"><a href="#éªŒè¯-CoreDNS" class="headerlink" title="éªŒè¯ CoreDNS"></a>éªŒè¯ CoreDNS</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dig @10.96.0.10 kubernetes.default.svc.cluster.local +short</span><br></pre></td></tr></table></figure><h2 id="å¸¸è§é—®é¢˜"><a href="#å¸¸è§é—®é¢˜" class="headerlink" title="å¸¸è§é—®é¢˜"></a>å¸¸è§é—®é¢˜</h2><p><a href="/posts/sepu3k/">kubeadm éƒ¨ç½²çš„é›†ç¾¤ å¸¸è§é—®é¢˜æ±‡æ€»</a></p><h3 id="Ubuntu-é‡Œé¢æ— æ³•å¯åŠ¨-CoreDNS"><a href="#Ubuntu-é‡Œé¢æ— æ³•å¯åŠ¨-CoreDNS" class="headerlink" title="Ubuntu é‡Œé¢æ— æ³•å¯åŠ¨ CoreDNS"></a>Ubuntu é‡Œé¢æ— æ³•å¯åŠ¨ CoreDNS</h3><p><a href="https://kubernetes.io/zh-cn/docs/tasks/administer-cluster/dns-debugging-resolution/#known-issues">https://kubernetes.io/zh-cn/docs/tasks/administer-cluster/dns-debugging-resolution/#known-issues</a></p><p>æœ‰äº› Linux å‘è¡Œç‰ˆæœ¬ï¼ˆæ¯”å¦‚ Ubuntuï¼‰é»˜è®¤ä½¿ç”¨ä¸€ä¸ªæœ¬åœ°çš„ DNS è§£æå™¨ï¼ˆsystemd-resolvedï¼‰ã€‚ systemd-resolved ä¼šç”¨ä¸€ä¸ªå­˜æ ¹æ–‡ä»¶ï¼ˆStub Fileï¼‰æ¥è¦†ç›– &#x2F;etc&#x2F;resolv.conf å†…å®¹ï¼Œ ä»è€Œå¯èƒ½åœ¨ä¸Šæ¸¸æœåŠ¡å™¨ä¸­è§£æåŸŸåäº§ç”Ÿè½¬å‘ç¯ï¼ˆforwarding loopï¼‰ã€‚ è¿™ä¸ªé—®é¢˜å¯ä»¥é€šè¿‡æ‰‹åŠ¨æŒ‡å®š kubelet çš„ â€“resolv-conf æ ‡å¿—ä¸ºæ­£ç¡®çš„ resolv.confï¼ˆå¦‚æœæ˜¯ systemd-resolvedï¼Œ åˆ™è¿™ä¸ªæ–‡ä»¶è·¯å¾„ä¸º &#x2F;run&#x2F;systemd&#x2F;resolve&#x2F;resolv.confï¼‰æ¥è§£å†³ã€‚ kubeadm ä¼šè‡ªåŠ¨æ£€æµ‹ systemd-resolved å¹¶å¯¹åº”çš„æ›´æ”¹ kubelet çš„å‘½ä»¤è¡Œæ ‡å¿—ã€‚</p><p>Kubernetes çš„å®‰è£…å¹¶ä¸ä¼šé»˜è®¤é…ç½®èŠ‚ç‚¹çš„ resolv.conf æ–‡ä»¶æ¥ä½¿ç”¨é›†ç¾¤çš„ DNS æœåŠ¡ï¼Œå› ä¸ºè¿™ä¸ªé…ç½®å¯¹äºä¸åŒçš„å‘è¡Œç‰ˆæœ¬æ˜¯ä¸ä¸€æ ·çš„ã€‚è¿™ä¸ªé—®é¢˜åº”è¯¥è¿Ÿæ—©ä¼šè¢«è§£å†³çš„ã€‚</p><p>Linux çš„ libcï¼ˆåˆå glibcï¼‰é»˜è®¤å°† DNS nameserver è®°å½•é™åˆ¶ä¸º 3ï¼Œ è€Œ Kubernetes éœ€è¦ä½¿ç”¨ 1 æ¡ nameserver è®°å½•ã€‚ è¿™æ„å‘³ç€å¦‚æœæœ¬åœ°çš„å®‰è£…å·²ç»ä½¿ç”¨äº† 3 ä¸ª nameserverï¼Œé‚£ä¹ˆå…¶ä¸­æœ‰äº›æ¡ç›®å°†ä¼šä¸¢å¤±ã€‚ è¦è§£å†³æ­¤é™åˆ¶ï¼ŒèŠ‚ç‚¹å¯ä»¥è¿è¡Œ dnsmasqï¼Œä»¥æä¾›æ›´å¤š nameserver æ¡ç›®ã€‚ ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ kubelet çš„ â€“resolv-conf æ ‡å¿—æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><p>å¦‚æœä½ ä½¿ç”¨ Alpine 3.17 æˆ–æ›´æ—©ç‰ˆæœ¬ä½œä¸ºä½ çš„åŸºç¡€é•œåƒï¼ŒDNS å¯èƒ½ä¼šç”±äº Alpine çš„è®¾è®¡é—®é¢˜è€Œæ— æ³•å·¥ä½œã€‚ åœ¨ musl 1.24 ç‰ˆæœ¬ä¹‹å‰ï¼ŒDNS å­˜æ ¹è§£æå™¨éƒ½æ²¡æœ‰åŒ…æ‹¬ TCP å›é€€ï¼Œ è¿™æ„å‘³ç€ä»»ä½•è¶…è¿‡ 512 å­—èŠ‚çš„ DNS è°ƒç”¨éƒ½ä¼šå¤±è´¥ã€‚è¯·å°†ä½ çš„é•œåƒå‡çº§åˆ° Alpine 3.18 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> å®¹å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
            <tag> keepalived </tag>
            
            <tag> HA </tag>
            
            <tag> Kubernetes </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è‡ªå»ºdnsè§£ææœåŠ¡bind9</title>
      <link href="/posts/sf0bjv/"/>
      <url>/posts/sf0bjv/</url>
      
        <content type="html"><![CDATA[<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install <span class="built_in">bind</span></span><br></pre></td></tr></table></figure><p>æˆ‘æ˜¯ <code>AlmaLinux 9</code> å®‰è£…çš„æ˜¯ <code>9.16.23</code> ç‰ˆæœ¬</p><h2 id="ä¿®æ”¹ä¸»é…ç½®æ–‡ä»¶"><a href="#ä¿®æ”¹ä¸»é…ç½®æ–‡ä»¶" class="headerlink" title="ä¿®æ”¹ä¸»é…ç½®æ–‡ä»¶"></a>ä¿®æ”¹ä¸»é…ç½®æ–‡ä»¶</h2><h3 id="ä¿®æ”¹ç›‘å¬åœ°å€"><a href="#ä¿®æ”¹ç›‘å¬åœ°å€" class="headerlink" title="ä¿®æ”¹ç›‘å¬åœ°å€"></a>ä¿®æ”¹ç›‘å¬åœ°å€</h3><p>é»˜è®¤ç›‘å¬åœ°å€ä¸º <code>127.0.0.1</code> éœ€è¦å¯¹å¤–æä¾›æœåŠ¡ï¼Œä¿®æ”¹ç›‘å¬åœ°å€ï¼Œå¯ä»¥æ”¹æˆæœ¬æœºå†…ç½‘ ipï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä¿®æ”¹æˆ anyï¼Œ è¡¨ç¤ºä»»æ„æ¥å£éƒ½ç›‘å¬ã€‚</p><p><code>vim /etc/named.conf</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">listen-on port 53 &#123; any; &#125;;</span><br><span class="line">...</span><br><span class="line">allow-query     &#123; any; &#125;;</span><br></pre></td></tr></table></figure><h3 id="å»æ‰é»˜è®¤é…ç½®"><a href="#å»æ‰é»˜è®¤é…ç½®" class="headerlink" title="å»æ‰é»˜è®¤é…ç½®"></a>å»æ‰é»˜è®¤é…ç½®</h3><p><code>vim /etc/named.conf</code></p><p>ä¸‹é¢è¿™å‡ è¡Œé…ç½®æˆ‘æ˜¯ç›´æ¥æ³¨é‡Šæ‰çš„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line">zone &quot;.&quot; IN &#123;</span><br><span class="line">      type hint;</span><br><span class="line">      file &quot;named.ca&quot;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">include &quot;/etc/named.rfc1912.zones&quot;;</span><br><span class="line">include &quot;/etc/named.root.key&quot;;</span><br><span class="line">*/</span><br></pre></td></tr></table></figure><h3 id="å¢åŠ -zone-é…ç½®"><a href="#å¢åŠ -zone-é…ç½®" class="headerlink" title="å¢åŠ  zone é…ç½®"></a>å¢åŠ  zone é…ç½®</h3><p>æ”¾åœ¨ <code>/etc/named.conf</code> æ–‡ä»¶æœ€åé¢</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">/* è®¾ç½®é»˜è®¤ä¸Šæ¸¸DNSï¼Œæœ¬åœ°è§£æä¸äº†çš„åŸŸåä»ä¸Šæ¸¸è·å– */</span><br><span class="line">zone &quot;.&quot; &#123;</span><br><span class="line">    type forward;</span><br><span class="line">    forwarders &#123; 114.114.114.114; 119.29.29.29; &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">/* æ­£å‘æŸ¥æ‰¾ i.com ä» i.com è¿™ä¸ªæ–‡ä»¶é‡ŒæŸ¥æ‰¾ */</span><br><span class="line">zone &quot;i.com&quot; IN &#123;</span><br><span class="line">type master;</span><br><span class="line">    file &quot;i.com&quot;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">/* åå‘æŸ¥æ‰¾ ipåœ°å€ 10 å¼€å¤´çš„ ä» i.loopback é‡ŒæŸ¥æ‰¾ */</span><br><span class="line">zone &quot;10.IN-ADDR.ARPA&quot; &#123;</span><br><span class="line">    type master;</span><br><span class="line">    file &quot;i.loopback&quot;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="zone-é…ç½®"><a href="#zone-é…ç½®" class="headerlink" title="zone é…ç½®"></a>zone é…ç½®</h2><p><code>vim /var/named/i.com</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ORIGIN i.com.</span><br><span class="line">$TTL 4h</span><br><span class="line"></span><br><span class="line">i.com.    IN      SOA     ns1.i.com. admin.i.com. (</span><br><span class="line">                                2022021101  ; serial number YYMMDDNN</span><br><span class="line">                                1d          ; Slave Refresh</span><br><span class="line">                                1h          ; Slave Retry Time in case of a problem</span><br><span class="line">                                4w          ; Slave Expire Time</span><br><span class="line">                                2h          ; Maximum Caching Time in case of failed lookups</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">@                  IN  NS      ns1.i.com.</span><br><span class="line">@                  IN  NS      ns2.i.com.</span><br><span class="line">ns1                IN  A       10.0.0.10</span><br><span class="line">ns2                IN  A       10.0.0.20</span><br><span class="line"></span><br><span class="line">a                  IN  A       9.9.9.9</span><br></pre></td></tr></table></figure><p>è¯´æ˜ï¼š</p><ul><li>TTL ç”Ÿå­˜å‘¨æœŸ</li><li>IN SOA æˆæƒä¿¡æ¯å¼€å§‹</li><li>ns1.i.com. dns åŒºåŸŸçš„åœ°å€</li><li>admin.i.com. åŸŸåç®¡ç†å‘˜é‚®ç®±ï¼ˆä¸è¦ç”¨@ç¬¦å·ï¼‰</li><li>10.0.0.30 10.0.0.35 è¿™æ—¶ä¸¤ä¸ª dns æœåŠ¡å™¨çš„ ip åœ°å€</li><li>a è¡¨ç¤º a.i.com è§£æåˆ° 9.9.9.9</li></ul><h2 id="åå‘è§£æé…ç½®"><a href="#åå‘è§£æé…ç½®" class="headerlink" title="åå‘è§£æé…ç½®"></a>åå‘è§£æé…ç½®</h2><p><code>vim /var/named/i.loopback</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ORIGIN 10.IN-ADDR.ARPA.</span><br><span class="line">$TTL 4h</span><br><span class="line">@       IN      SOA     ns1.i.com. admin.i.com. (</span><br><span class="line">                            2022021001  ; serial number YYMMDDNN</span><br><span class="line">                            1d          ; Slave Refresh</span><br><span class="line">                            1h          ; Slave Retry Time in case of a problem</span><br><span class="line">                            4w          ; Slave Expire Time</span><br><span class="line">                            2h          ; Maximum Caching Time in case of failed lookups</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@       IN      NS      ns1.i.com.</span><br><span class="line">@       IN      NS      ns2.i.com.</span><br><span class="line"></span><br><span class="line">; PTR RR maps an IPv4 address to a host name</span><br><span class="line">2.0.0   IN      PTR     shanghai.i.com.</span><br><span class="line">3.0.0   IN      PTR     beijing.i.com.</span><br></pre></td></tr></table></figure><p>è¯´æ˜ï¼š<br>åå‘è§£æ è®°å½• ip ä¹Ÿæ˜¯åå†™çš„ï¼Œ 2.0.0 è¡¨ç¤º 0.0.2 ï¼Œå®Œæ•´çš„ ip å°±æ˜¯ 10.0.0.2</p><p>åœ¨ <code>/etc/named.conf</code> ä¸­ï¼Œ <code>zone &quot;10.IN-ADDR.ARPA&quot; &#123;</code> ä¹Ÿå¯ä»¥æ”¹æˆ <code>&quot;0.0.10.IN-ADDR.ARPA&quot; &#123;</code> è¡¨ç¤ºåŒ¹é… 10.0.0 å¼€å¤´çš„ ip åæŸ¥ï¼Œé‚£ä¹ˆ i.loopback ä¸­çš„ 2.0.0 å°±å¯ä»¥å†™æˆ 2</p><h2 id="å¢åŠ ä»æœåŠ¡å™¨"><a href="#å¢åŠ ä»æœåŠ¡å™¨" class="headerlink" title="å¢åŠ ä»æœåŠ¡å™¨"></a>å¢åŠ ä»æœåŠ¡å™¨</h2><table><thead><tr><th>æœåŠ¡å™¨</th><th>ip</th></tr></thead><tbody><tr><td>ä¸» DNS æœåŠ¡å™¨</td><td>10.0.0.10</td></tr><tr><td>ä» DNS æœåŠ¡å™¨</td><td>10.0.0.20</td></tr></tbody></table><h3 id="ä¸»æœåŠ¡å™¨é…ç½®"><a href="#ä¸»æœåŠ¡å™¨é…ç½®" class="headerlink" title="ä¸»æœåŠ¡å™¨é…ç½®"></a>ä¸»æœåŠ¡å™¨é…ç½®</h3><p>åœ¨ä¸»æœåŠ¡å™¨çš„åŒºåŸŸé…ç½®æ–‡ä»¶ä¸­å…è®¸è¯¥ä»æœåŠ¡å™¨çš„æ›´æ–°è¯·æ±‚ï¼Œå³ä¿®æ”¹ allow-update {å…è®¸æ›´æ–°åŒºåŸŸä¿¡æ¯çš„ä¸»æœºåœ°å€;}; å‚æ•°ï¼Œç„¶åé‡å¯ä¸»æœåŠ¡å™¨çš„ DNS æœåŠ¡ç¨‹åºã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">/* æ­£å‘æŸ¥æ‰¾ i.com ä» i.com è¿™ä¸ªæ–‡ä»¶é‡ŒæŸ¥æ‰¾ */</span><br><span class="line">zone &quot;i.com&quot; IN &#123;</span><br><span class="line">type master;</span><br><span class="line">    file &quot;i.com&quot;;</span><br><span class="line">    allow-update &#123; 10.0.0.20; &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">/* åå‘æŸ¥æ‰¾ ipåœ°å€ 10 å¼€å¤´çš„ ä» i.loopback é‡ŒæŸ¥æ‰¾ */</span><br><span class="line">zone &quot;10.IN-ADDR.ARPA&quot; &#123;</span><br><span class="line">    type master;</span><br><span class="line">    file &quot;i.loopback&quot;;</span><br><span class="line">    allow-update &#123; 10.0.0.20; &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><div class="note warning flat"><p>å¢åŠ äº†ä»æœåŠ¡å™¨ï¼Œæ¯æ¬¡æ›´æ–°ä¸»é…ç½®æ–‡ä»¶ï¼Œéœ€è¦åŒæ­¥æ›´æ–° serial number</p></div><h3 id="ä»æœåŠ¡å™¨é…ç½®"><a href="#ä»æœåŠ¡å™¨é…ç½®" class="headerlink" title="ä»æœåŠ¡å™¨é…ç½®"></a>ä»æœåŠ¡å™¨é…ç½®</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">/* æ­£å‘æŸ¥æ‰¾ i.com ä» i.com è¿™ä¸ªæ–‡ä»¶é‡ŒæŸ¥æ‰¾ */</span><br><span class="line">zone &quot;i.com&quot; IN &#123;</span><br><span class="line">    type slave;</span><br><span class="line">    file &quot;i.com&quot;;</span><br><span class="line">    masters &#123; 10.0.0.10; &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">/* åå‘æŸ¥æ‰¾ ipåœ°å€ 10 å¼€å¤´çš„ ä» i.loopback é‡ŒæŸ¥æ‰¾ */</span><br><span class="line">zone &quot;10.IN-ADDR.ARPA&quot; &#123;</span><br><span class="line">    type slave;</span><br><span class="line">    file &quot;i.loopback&quot;;</span><br><span class="line">    masters &#123; 10.0.0.10; &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ç­‰å¾…åŒæ­¥å®Œæˆåï¼Œ åœ¨ <code>/var/named/</code> ç›®å½•é‡Œé¢å°±èƒ½çœ‹åˆ°æ–‡ä»¶ã€‚</p><h4 id="æ‰‹åŠ¨åŒæ­¥"><a href="#æ‰‹åŠ¨åŒæ­¥" class="headerlink" title="æ‰‹åŠ¨åŒæ­¥"></a>æ‰‹åŠ¨åŒæ­¥</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä»æœåŠ¡å™¨ä¸Šæ‰§è¡Œ</span></span><br><span class="line">rndc retransfer &lt;zone&gt;</span><br></pre></td></tr></table></figure><h2 id="éªŒè¯"><a href="#éªŒè¯" class="headerlink" title="éªŒè¯"></a>éªŒè¯</h2><p><a href="/posts/ae8cd9d9/">æ£€æŸ¥åŸŸåè§£æ</a></p>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
            <tag> DNS </tag>
            
            <tag> å¼€æºè½¯ä»¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>opensshé…ç½®è®°å½•</title>
      <link href="/posts/658a72d5/"/>
      <url>/posts/658a72d5/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¼˜åŒ–ç™»å½•é€Ÿåº¦"><a href="#ä¼˜åŒ–ç™»å½•é€Ÿåº¦" class="headerlink" title="ä¼˜åŒ–ç™»å½•é€Ÿåº¦"></a>ä¼˜åŒ–ç™»å½•é€Ÿåº¦</h2><p>å…³é—­ UseDNS å’Œ GSSAPIAuthentication å¯ä»¥åŠ é€Ÿ SSH ç™»å½•, UseDNS å’Œ GSSAPIAuthentication æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>æ¯æ¬¡ç™»å½• SSH æ—¶æ€»æ˜¯è¦åœé¡¿ç­‰å¾…ä¸€ä¸‹æ‰èƒ½è¿æ¥ä¸Šï¼Œ,è¿™æ˜¯å› ä¸º OpenSSH æœåŠ¡å™¨æœ‰ä¸€ä¸ª DNS æŸ¥æ‰¾é€‰é¡¹ UseDNS é»˜è®¤æƒ…å†µä¸‹æ˜¯æ‰“å¼€çš„ã€‚</p><blockquote><p>UseDNS é€‰é¡¹æ‰“å¼€çŠ¶æ€ä¸‹ï¼Œå½“å®¢æˆ·ç«¯è¯•å›¾ç™»å½• SSH æœåŠ¡å™¨æ—¶ï¼ŒæœåŠ¡å™¨ç«¯å…ˆæ ¹æ®å®¢æˆ·ç«¯çš„ IP åœ°å€è¿›è¡Œ DNSï¼ŒPTR åå‘æŸ¥è¯¢å‡ºå®¢æˆ·ç«¯çš„ä¸»æœºåï¼Œç„¶åæ ¹æ®æŸ¥è¯¢å‡ºçš„å®¢æˆ·ç«¯ä¸»æœºåè¿›è¡Œ DNS æ­£å‘ A è®°å½•æŸ¥è¯¢ï¼ŒéªŒè¯ä¸å…¶åŸå§‹ IP åœ°å€æ˜¯å¦ä¸€è‡´ï¼Œè¿™æ˜¯é˜²æ­¢å®¢æˆ·ç«¯æ¬ºéª—çš„ä¸€ç§æªæ–½ï¼Œä½†ä¸€èˆ¬æˆ‘ä»¬çš„æ˜¯åŠ¨æ€ IP ä¸ä¼šæœ‰ PTR è®°å½•ï¼Œæ‰“å¼€è¿™ä¸ªé€‰é¡¹ä¸è¿‡æ˜¯åœ¨ç™½ç™½æµªè´¹æ—¶é—´è€Œå·²ï¼Œä¸å¦‚å°†å…¶å…³é—­ã€‚</p><p>GSSAPI ( Generic Security Services Application Programming Interface) æ˜¯ä¸€å¥—ç±»ä¼¼ Kerberos 5 çš„é€šç”¨ç½‘ç»œå®‰å…¨ç³»ç»Ÿæ¥å£ã€‚è¯¥æ¥å£æ˜¯å¯¹å„ç§ä¸åŒçš„å®¢æˆ·ç«¯æœåŠ¡å™¨å®‰å…¨æœºåˆ¶çš„å°è£…ï¼Œä»¥æ¶ˆé™¤å®‰å…¨æ¥å£çš„ä¸åŒï¼Œé™ä½ç¼–ç¨‹éš¾åº¦ã€‚ä½†è¯¥æ¥å£åœ¨ç›®æ ‡æœºå™¨æ— åŸŸåè§£ææ—¶ä¼šæœ‰é—®é¢˜</p></blockquote><p>ç¼–è¾‘é…ç½®æ–‡ä»¶ <code>vim /etc/ssh/sshd_config</code></p><p>æ‰¾åˆ° UseDNS é€‰é¡¹ï¼Œå»æ‰æ³¨é‡Š <code>#UseDNS yes</code> æ”¹ä¸º <code>UseDNS no</code><br>æ‰¾åˆ° GSSAPIAuthentication é€‰é¡¹ï¼Œå»æ‰æ³¨é‡Š <code>#GSSAPIAuthentication yes</code> æ”¹ä¸º <code>GSSAPIAuthentication no</code><br>ä¿å­˜é…ç½®æ–‡ä»¶</p><p>é‡å¯ OpenSSH æœåŠ¡å™¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart sshd</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
            <tag> OpenSSH </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxçš„ulimité™åˆ¶</title>
      <link href="/posts/c1a3cdd/"/>
      <url>/posts/c1a3cdd/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸´æ—¶è®¾ç½®"><a href="#ä¸´æ—¶è®¾ç½®" class="headerlink" title="ä¸´æ—¶è®¾ç½®"></a>ä¸´æ—¶è®¾ç½®</h2><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>ulimit -a</td><td>æŸ¥çœ‹æ‰€æœ‰é™åˆ¶å€¼</td></tr><tr><td>ulimit -n 65535</td><td>ä¸´æ—¶è°ƒæ•´ open files é™åˆ¶å€¼</td></tr></tbody></table><h2 id="æ°¸ä¹…è®¾ç½®"><a href="#æ°¸ä¹…è®¾ç½®" class="headerlink" title="æ°¸ä¹…è®¾ç½®"></a>æ°¸ä¹…è®¾ç½®</h2><p>é…ç½®æ–‡ä»¶:<br>&#x2F;etc&#x2F;security&#x2F;limits.conf</p><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">Ubuntuå’ŒDebian</button><button type="button" class="tab">CentOSå’ŒFedora</button></div><div class="tab-contents"><div class="tab-item-content active"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">*               soft    nofile          65535</span><br><span class="line">*               hard    nofile          65535</span><br><span class="line">*               hard    <span class="built_in">nproc</span>           65535</span><br><span class="line">*               soft    <span class="built_in">nproc</span>           65535</span><br><span class="line">root            soft    nofile          65535</span><br><span class="line">root            hard    nofile          65535</span><br><span class="line">root            hard    <span class="built_in">nproc</span>           65535</span><br><span class="line">root            soft    <span class="built_in">nproc</span>           65535</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">*               soft    nofile          65535</span><br><span class="line">*               hard    nofile          65535</span><br><span class="line">*               hard    <span class="built_in">nproc</span>           65535</span><br><span class="line">*               soft    <span class="built_in">nproc</span>           65535</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>WSLgé…ç½®å›¾å½¢æ”¯æŒå’Œé…ç½®rimeè¾“å…¥æ³•</title>
      <link href="/posts/81886814/"/>
      <url>/posts/81886814/</url>
      
        <content type="html"><![CDATA[<p>WSLg æ˜¯å¾®è½¯çš„ wsl2 ä¸­è‡ªå¸¦çš„æ˜¾ç¤ºå›¾å½¢ç•Œé¢çš„åŠŸèƒ½ï¼Œå¯ä»¥å’Œ windows å®Œç¾èåˆåœ¨ä¸€å—ï¼Œä¸è¿‡ç”±äº wsl ç³»ç»Ÿæ¯”è¾ƒç²¾ç®€ï¼Œä¼šç¼ºå°‘ä¸€äº›å›¾å½¢åŒ…å’Œè¾“å…¥æ³•ç­‰ã€‚</p><h2 id="è®¾ç½®ä¸­æ–‡æ˜¾ç¤º"><a href="#è®¾ç½®ä¸­æ–‡æ˜¾ç¤º" class="headerlink" title="è®¾ç½®ä¸­æ–‡æ˜¾ç¤º"></a>è®¾ç½®ä¸­æ–‡æ˜¾ç¤º</h2><h3 id="å®‰è£…ä¾èµ–åŒ…"><a href="#å®‰è£…ä¾èµ–åŒ…" class="headerlink" title="å®‰è£…ä¾èµ–åŒ…"></a>å®‰è£…ä¾èµ–åŒ…</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…ä¸­æ–‡å­—ä½“</span></span><br><span class="line">sudo apt install language-pack-zh-hans fonts-noto-cjk fonts-noto-cjk-extra</span><br><span class="line"></span><br><span class="line"><span class="comment"># locales é…ç½® en_US.UTF-8 å’Œ zh_CN.UTF-8 </span></span><br><span class="line">sudo sed -i <span class="string">&#x27;s/^# en_US.UTF-8 UTF-8/en_US.UTF-8 UTF-8/g&#x27;</span> /etc/locale.gen</span><br><span class="line">sudo sed -i <span class="string">&#x27;s/^# zh_CN.UTF-8 UTF-8/zh_CN.UTF-8 UTF-8/g&#x27;</span> /etc/locale.gen</span><br><span class="line"></span><br><span class="line">sudo locale-gen</span><br></pre></td></tr></table></figure><h3 id="è®¾ç½®æ˜¾ç¤ºè¯­è¨€ä¸ºä¸­æ–‡"><a href="#è®¾ç½®æ˜¾ç¤ºè¯­è¨€ä¸ºä¸­æ–‡" class="headerlink" title="è®¾ç½®æ˜¾ç¤ºè¯­è¨€ä¸ºä¸­æ–‡"></a>è®¾ç½®æ˜¾ç¤ºè¯­è¨€ä¸ºä¸­æ–‡</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">tee</span> /etc/default/locale &lt;&lt;-<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">LANG=zh_CN.UTF-8</span><br><span class="line">LANGUAGE=<span class="string">&quot;zh_CN:zh:en_US:en&quot;</span></span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h2 id="é…ç½®ä¸­æ–‡è¾“å…¥æ³•"><a href="#é…ç½®ä¸­æ–‡è¾“å…¥æ³•" class="headerlink" title="é…ç½®ä¸­æ–‡è¾“å…¥æ³•"></a>é…ç½®ä¸­æ–‡è¾“å…¥æ³•</h2><h3 id="å®‰è£…-im-config"><a href="#å®‰è£…-im-config" class="headerlink" title="å®‰è£… im-config"></a>å®‰è£… im-config</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install zenity im-config</span><br><span class="line">im-config</span><br><span class="line"><span class="comment"># é€‰æ‹©fcitx5ï¼Œå…¶ä½™éƒ½é€‰OK</span></span><br></pre></td></tr></table></figure><h3 id="å®‰è£…ä¸­æ–‡è¾“å…¥æ³•"><a href="#å®‰è£…ä¸­æ–‡è¾“å…¥æ³•" class="headerlink" title="å®‰è£…ä¸­æ–‡è¾“å…¥æ³•"></a>å®‰è£…ä¸­æ–‡è¾“å…¥æ³•</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install fcitx5 fcitx5-chinese-addons fcitx5-frontend-gtk4 fcitx5-frontend-gtk3 fcitx5-frontend-gtk2 fcitx5-frontend-qt5 fcitx5-config-qt</span><br></pre></td></tr></table></figure><h3 id="é…ç½®ç¯å¢ƒå˜é‡"><a href="#é…ç½®ç¯å¢ƒå˜é‡" class="headerlink" title="é…ç½®ç¯å¢ƒå˜é‡"></a>é…ç½®ç¯å¢ƒå˜é‡</h3><p>éœ€è¦ä¿®æ”¹ profile æ–‡ä»¶ï¼Œ å¼€æœºè‡ªå¯åŠ¨ fcitx5 å’Œè®¾ç½®ç¯å¢ƒå˜é‡ï¼Œ æ³¨æ„ä»¥ä¸‹é€‚ç”¨äº bashï¼Œå¦‚æœæ˜¯ zshï¼Œåˆ™å¯¹åº”çš„è·¯å¾„æ˜¯ <code>/etc/zsh/zprofile</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">tee</span> -a /etc/profile &lt;&lt;-<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">/usr/bin/fcitx5 --<span class="built_in">disable</span>=wayland -d --verbose <span class="string">&#x27;*&#x27;</span>=0</span><br><span class="line"><span class="built_in">export</span> INPUT_METHOD=fcitx</span><br><span class="line"><span class="built_in">export</span> GTK_IM_MODULE=fcitx</span><br><span class="line"><span class="built_in">export</span> QT_IM_MODULE=fcitx</span><br><span class="line"><span class="built_in">export</span> XMODIFIERS=@im=fcitx</span><br><span class="line"><span class="built_in">export</span> SDL_IM_MODULE=fcitx</span><br><span class="line"><span class="built_in">export</span> GLFW_IM_MODULE=ibus</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><p>é‡å¯ä¸€ä¸‹ wsl</p><h3 id="å¢åŠ è¾“å…¥æ³•"><a href="#å¢åŠ è¾“å…¥æ³•" class="headerlink" title="å¢åŠ è¾“å…¥æ³•"></a>å¢åŠ è¾“å…¥æ³•</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fcitx5-configtool</span><br></pre></td></tr></table></figure><p>åœ¨ç•Œé¢ä¸­å»æ‰é»˜è®¤è¾“å…¥æ³•ï¼Œå¢åŠ ä¸­æ–‡è¾“å…¥æ³•</p><h3 id="é…ç½®å¸¸ç”¨è„šæœ¬"><a href="#é…ç½®å¸¸ç”¨è„šæœ¬" class="headerlink" title="é…ç½®å¸¸ç”¨è„šæœ¬"></a>é…ç½®å¸¸ç”¨è„šæœ¬</h3><p>ç”±äº wsl çš„å›¾å½¢ç•Œé¢ä¸å®Œæ•´ï¼Œæ²¡åŠæ³•åœ¨ä»»åŠ¡æ å³å‡»è¾“å…¥æ³•å›¾æ ‡çš„æ–¹å¼æ¥æ‰§è¡Œ éƒ¨ç½² æˆ– åŒæ­¥ ä»»åŠ¡ï¼Œæ‰€ä»¥é€šè¿‡è„šæœ¬æ¥å®ç°ã€‚</p><p>åŒæ­¥è„šæœ¬ï¼š</p><blockquote><p>åŒæ­¥ä½ç½®é…ç½®åœ¨ <code>~/.local/share/fcitx5/rime/installation.yaml</code> å†…çš„ <code>sync_dir: &quot;/mnt/c/Users/iuxt/OneDrive/sync/rime_sync</code>â€œ</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">pkill fcitx5</span><br><span class="line"><span class="built_in">cd</span> ~/.local/share/fcitx5/rime/</span><br><span class="line">rime_dict_manager -s</span><br><span class="line">/usr/bin/fcitx5 --<span class="built_in">disable</span>=wayland -d --verbose <span class="string">&#x27;*&#x27;</span>=0</span><br></pre></td></tr></table></figure><p>éƒ¨ç½²è„šæœ¬ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">pkill fcitx5</span><br><span class="line">rime_deployer --build ~/.local/share/fcitx5/rime/ /usr/share/rime-data ~/.local/share/fcitx5/rime/build</span><br><span class="line">/usr/bin/fcitx5 --<span class="built_in">disable</span>=wayland -d --verbose <span class="string">&#x27;*&#x27;</span>=0</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows </tag>
            
            <tag> WSL </tag>
            
            <tag> é…ç½®è®°å½• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨inkscapeåˆ¶ä½œsvgå°é¢å›¾</title>
      <link href="/posts/sel6im/"/>
      <url>/posts/sel6im/</url>
      
        <content type="html"><![CDATA[<p>æ³¨æ„ï¼šæœ¬æ–‡ä¸é€‚ç”¨äºå°†å…¶ä»–æ ¼å¼è½¬æ¢æˆ svg ï¼Œåªé€‚ç”¨äºåŸç”Ÿ svg</p><p>svg å…¨åå«å¯ç¼©æ”¾çŸ¢é‡å›¾å½¢ï¼Œå°±ç®—æ”¾å¤§ä¹Ÿä¸ä¼šå¤±çœŸï¼Œä¸‹é¢æ˜¯ä¸ªå¯¹æ¯”ï¼š</p><h2 id="svg-ç¤ºä¾‹"><a href="#svg-ç¤ºä¾‹" class="headerlink" title="svg ç¤ºä¾‹"></a>svg ç¤ºä¾‹</h2><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/public/elasticsearch.svg" alt="svgç¤ºä¾‹å›¾|472"></p><h2 id="png-ç¤ºä¾‹"><a href="#png-ç¤ºä¾‹" class="headerlink" title="png ç¤ºä¾‹"></a>png ç¤ºä¾‹</h2><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/elasticsearch.webp" alt="elasticsearch.webp|471"></p><h2 id="ä½¿ç”¨-inkscape-è°ƒæ•´-svg-å±æ€§"><a href="#ä½¿ç”¨-inkscape-è°ƒæ•´-svg-å±æ€§" class="headerlink" title="ä½¿ç”¨ inkscape è°ƒæ•´ svg å±æ€§"></a>ä½¿ç”¨ inkscape è°ƒæ•´ svg å±æ€§</h2><h3 id="è°ƒæ•´ç”»å¸ƒå¤§å°"><a href="#è°ƒæ•´ç”»å¸ƒå¤§å°" class="headerlink" title="è°ƒæ•´ç”»å¸ƒå¤§å°"></a>è°ƒæ•´ç”»å¸ƒå¤§å°</h3><p>ä½œç”¨æ˜¯è®¾ç½®æˆ 3:2 çš„åˆ†è¾¨ç‡</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202405300829087.png" alt="image.png|830"></p><p>å¤§å° è°ƒæ•´å¥½åï¼Œè°ƒæ•´ç¼©æ”¾ï¼Œè°ƒæ•´åˆ°è‡ªå·±è§‰å¾— ok å°±è¡Œï¼Œå¯ä»¥å¤šæµ‹è¯•æ•ˆæœã€‚</p><h3 id="è°ƒæ•´å…ƒç´ çš„ä½ç½®"><a href="#è°ƒæ•´å…ƒç´ çš„ä½ç½®" class="headerlink" title="è°ƒæ•´å…ƒç´ çš„ä½ç½®"></a>è°ƒæ•´å…ƒç´ çš„ä½ç½®</h3><p>æ¯”å¦‚æˆ‘æƒ³è¦è®©å›¾æ ‡åœ¨æ–‡å­—çš„ä¸Šæ–¹</p><p>åˆ°å›¾å±‚é‡Œï¼Œé€‰æ‹©è¦æ“ä½œçš„å›¾å±‚ï¼Œä½¿ç”¨é¼ æ ‡ä¸Šä¸‹è°ƒæ•´ä½ç½®ï¼ˆå·¦å³ä½ç½®é€šè¿‡å±…ä¸­æ¥è‡ªåŠ¨è°ƒæ•´ï¼‰</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202405300834196.png" alt="image.png|829"></p><p>è¿™é‡Œå¦‚æœè°ƒæ•´ä¸€ä¸ªå…ƒç´ ï¼Œå…¶ä»–çš„å…ƒç´ è·Ÿç€ä¸€å—åŠ¨äº†ï¼Œä½ éœ€è¦åˆ°å›¾å±‚é‡Œé¢çœ‹çœ‹æœ‰æ²¡æœ‰åˆ†ç»„ï¼Œè¦å…ˆå–æ¶ˆåˆ†ç»„æ‰èƒ½ç»§ç»­è°ƒæ•´ã€‚</p><p>ä¸€ä¸ªæ•´ä½“æƒ³è¦ä¸€å—è°ƒæ•´ï¼Œ é‚£éœ€è¦å…ˆæ”¾åˆ°ä¸€ä¸ªåˆ†ç»„é‡Œé¢ï¼Œå¿«æ·é”® <code>Ctrl + G</code></p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202405300839850.png" alt="image.png|828"></p><p>åœ¨å¯¹é½ä¸åˆ†å¸ƒé‡Œé¢ï¼Œç›¸è¾ƒäº<strong>é¡µé¢</strong>é€‰æ‹©æ°´å¹³å±…ä¸­</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202405300840422.png" alt="image.png|823"></p><h2 id="ä½¿ç”¨-VSCode-æ’ä»¶æ¥å‹ç¼©-svg"><a href="#ä½¿ç”¨-VSCode-æ’ä»¶æ¥å‹ç¼©-svg" class="headerlink" title="ä½¿ç”¨ VSCode æ’ä»¶æ¥å‹ç¼© svg"></a>ä½¿ç”¨ VSCode æ’ä»¶æ¥å‹ç¼© svg</h2><p>svg æœ¬è´¨ä¸Šå°±æ˜¯ xml æ–‡æœ¬æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡ VSCode æ’ä»¶æ¥å‹ç¼©å¤§å°ï¼ˆçŸ¢é‡å›¾å½¢ï¼Œå‹ç¼©ä¸ä¼šæŸå¤±ç”»è´¨ï¼‰</p><p>å®‰è£…ä¸€ä¸ª svg æ‰©å±•ï¼Œæˆ‘ç”¨çš„æ˜¯è¿™ä¸ªï¼š<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202405300848735.png" alt="image.png"></p><p>ç„¶åæ‰“å¼€ svg æ–‡ä»¶ï¼Œå³é”®ä¼šæœ‰ä¸ª å‹ç¼© svg çš„é€‰é¡¹ã€‚</p><h3 id="å‹ç¼©å‰åæ–‡ä»¶å†…å®¹å¯¹æ¯”"><a href="#å‹ç¼©å‰åæ–‡ä»¶å†…å®¹å¯¹æ¯”" class="headerlink" title="å‹ç¼©å‰åæ–‡ä»¶å†…å®¹å¯¹æ¯”"></a>å‹ç¼©å‰åæ–‡ä»¶å†…å®¹å¯¹æ¯”</h3><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202405300850919.png" alt="image.png|804"></p><h3 id="å‹ç¼©å‰åæ–‡ä»¶å¤§å°å¯¹æ¯”"><a href="#å‹ç¼©å‰åæ–‡ä»¶å¤§å°å¯¹æ¯”" class="headerlink" title="å‹ç¼©å‰åæ–‡ä»¶å¤§å°å¯¹æ¯”"></a>å‹ç¼©å‰åæ–‡ä»¶å¤§å°å¯¹æ¯”</h3><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202405300851886.png" alt="image.png"></p><p>æ³¨æ„ï¼š ä½¿ç”¨å…¶ä»–å›¾ç‰‡è½¬æ¢æˆçš„ svg ä¸è¡Œï¼Œå¹¶ä¸æ˜¯çœŸçš„åŸç”Ÿ svg</p>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å›¾åƒå¤„ç† </tag>
            
            <tag> svg </tag>
            
            <tag> çŸ¢é‡å›¾ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åœ¨Kubernetesé›†ç¾¤ä¸­æŒ‚è½½configmapåˆ°podä¸­</title>
      <link href="/posts/75a76e3b/"/>
      <url>/posts/75a76e3b/</url>
      
        <content type="html"><![CDATA[<h2 id="æŒ‚è½½æ•´ä¸ª-configmap"><a href="#æŒ‚è½½æ•´ä¸ª-configmap" class="headerlink" title="æŒ‚è½½æ•´ä¸ª configmap"></a>æŒ‚è½½æ•´ä¸ª configmap</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">busybox-configmap</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">1.txt:</span> <span class="string">|</span></span><br><span class="line"><span class="string">    11111111111111111</span></span><br><span class="line"><span class="string"></span>  <span class="attr">2.txt:</span> <span class="string">|</span></span><br><span class="line"><span class="string">    22222222222222222</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">busybox</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">busybox</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">busybox-volume</span></span><br><span class="line">        <span class="attr">configMap:</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">busybox-configmap</span></span><br><span class="line"></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">busybox</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">registry.cn-hangzhou.aliyuncs.com/iuxt/busybox:1.36.1</span></span><br><span class="line">        <span class="attr">args:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">/bin/sh</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">-c</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">sleep</span> <span class="string">infinity</span></span><br><span class="line"></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">busybox-volume</span>                 <span class="comment"># volumesçš„åå­—</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/var/</span>                     <span class="comment"># å®¹å™¨å†…çš„ç›®å½•</span></span><br></pre></td></tr></table></figure><p>æ­¤æ—¶ pod å†… <code>/var</code> ç›®å½•ä¸‹ä¼šæœ‰ä¸¤ä¸ªæ–‡ä»¶ 1.txt å’Œ 2.txtã€‚å¦å¤–ï¼Œå¦‚æœ <code>/var</code> ç›®å½•åŸæ¥æ˜¯æœ‰æ•°æ®çš„ï¼Œé‚£ä¹ˆæŒ‚è½½åé‡Œé¢ä¹Ÿå°±åªæœ‰ 1.txt å’Œ 2.txtï¼Œ çœ‹ä¸åˆ°åŸæ¥çš„æ–‡ä»¶äº†ã€‚ï¼ˆå’ŒæŒ‚è½½ç±»ä¼¼ï¼‰</p><h2 id="æŒ‚è½½æŒ‡å®šçš„-key-åˆ°ç›®å½•"><a href="#æŒ‚è½½æŒ‡å®šçš„-key-åˆ°ç›®å½•" class="headerlink" title="æŒ‚è½½æŒ‡å®šçš„ key åˆ°ç›®å½•"></a>æŒ‚è½½æŒ‡å®šçš„ key åˆ°ç›®å½•</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">busybox-configmap</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">1.txt:</span> <span class="string">|</span></span><br><span class="line"><span class="string">    11111111111111111</span></span><br><span class="line"><span class="string"></span>  <span class="attr">2.txt:</span> <span class="string">|</span></span><br><span class="line"><span class="string">    22222222222222222</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">busybox</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">busybox</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">busybox-volume</span></span><br><span class="line">        <span class="attr">configMap:</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">busybox-configmap</span></span><br><span class="line">          <span class="attr">items:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">key:</span> <span class="number">1.</span><span class="string">txt</span>                      <span class="comment"># å¯¹åº”çš„configmapçš„key</span></span><br><span class="line">              <span class="attr">path:</span> <span class="string">logstash.yml</span>              <span class="comment"># æŒ‚è½½åˆ°å®¹å™¨å†…çš„æ–‡ä»¶å</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">key:</span> <span class="number">2.</span><span class="string">txt</span></span><br><span class="line">              <span class="attr">path:</span> <span class="string">jvm.options</span></span><br><span class="line"></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">busybox</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">registry.cn-hangzhou.aliyuncs.com/iuxt/busybox:1.36.1</span></span><br><span class="line">        <span class="attr">args:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">/bin/sh</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">-c</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">sleep</span> <span class="string">infinity</span></span><br><span class="line"></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">busybox-volume</span>                 <span class="comment"># volumesçš„åå­—</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/var/</span>                     <span class="comment"># å®¹å™¨å†…çš„ç›®å½•</span></span><br></pre></td></tr></table></figure><p>å¦‚ä¸Šé…ç½®ï¼Œ åœ¨å®¹å™¨ä¸­æ–‡ä»¶å³ä¸ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/var/logstash.yml     --&gt;    11111111111111111</span><br><span class="line">/var/jvm.options      --&gt;    22222222222222222</span><br></pre></td></tr></table></figure><p>è¿™ç§æŒ‚è½½æ–¹å¼ ä¼šå½±å“åˆ°åŸ &#x2F;var&#x2F; ç›®å½•ä¸­çš„æ–‡ä»¶å’Œç›®å½•ã€‚</p><p>å¢åŠ  item æœ‰ä¸¤ä¸ªä½œç”¨ï¼š</p><ul><li>å¯ä»¥è‡ªå®šä¹‰æŒ‚è½½åçš„æ–‡ä»¶å</li><li>å¯ä»¥é€‰æ‹© configmap é‡Œé¢å“ªäº› key æŒ‚è½½ï¼Œå“ªäº› key ä¸æŒ‚è½½</li></ul><h2 id="ä½¿ç”¨-subpath-æŒ‚è½½-configmap"><a href="#ä½¿ç”¨-subpath-æŒ‚è½½-configmap" class="headerlink" title="ä½¿ç”¨ subpath æŒ‚è½½ configmap"></a>ä½¿ç”¨ subpath æŒ‚è½½ configmap</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">busybox-configmap</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">1.txt:</span> <span class="string">|</span></span><br><span class="line"><span class="string">    11111111111111111</span></span><br><span class="line"><span class="string"></span>  <span class="attr">2.txt:</span> <span class="string">|</span></span><br><span class="line"><span class="string">    22222222222222222</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">busybox</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">busybox</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">busybox-volume</span></span><br><span class="line">        <span class="attr">configMap:</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">busybox-configmap</span></span><br><span class="line"></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">busybox</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">registry.cn-hangzhou.aliyuncs.com/iuxt/busybox:1.36.1</span></span><br><span class="line">        <span class="attr">args:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">/bin/sh</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">-c</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">sleep</span> <span class="string">infinity</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">busybox-volume</span>                      <span class="comment"># volumeçš„åå­—</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/var/1.txt</span>                     <span class="comment"># å®¹å™¨å†…çš„è·¯å¾„</span></span><br><span class="line">          <span class="attr">subPath:</span> <span class="number">1.</span><span class="string">txt</span>                            <span class="comment"># æŒ‡å®šconfigmapé‡Œé¢çš„key</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">busybox-volume</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/var/2.txt</span></span><br><span class="line">          <span class="attr">subPath:</span> <span class="number">2.</span><span class="string">txt</span></span><br></pre></td></tr></table></figure><p>è¿™ç§æŒ‚è½½æ–¹å¼ä¸ä¼šå½±å“åˆ° &#x2F;var ç›®å½•å†…åŸå§‹çš„æ–‡ä»¶ï¼Œåªæ˜¯å¢åŠ äº†è¿™ä¸¤ä¸ªæ–‡ä»¶ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> å®¹å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æŒ‚è½½ </tag>
            
            <tag> configmap </tag>
            
            <tag> volume </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åœ¨Kubernetesé›†ç¾¤ä¸­éƒ¨ç½²å¤šä¸ªNginx Ingress Controller</title>
      <link href="/posts/c4b9bd31/"/>
      <url>/posts/c4b9bd31/</url>
      
        <content type="html"><![CDATA[<p>ä¸ºä»€ä¹ˆè¦åœ¨é›†ç¾¤ä¸­éƒ¨ç½²ä¸¤ä¸ª Nginx Ingress Controllerï¼Ÿ å› ä¸ºå…¬å¸çš„å…¥å£ç›®å‰æ˜¯åœ¨ä¸€ä¸ª Ingress ä¸Šï¼Œ å…¬ç½‘åŸŸåä¹Ÿè§£æåˆ°äº†è¿™ä¸ª Ingress Controller ä¸Šé¢ï¼Œä¸è¿‡æœ‰äº›å†…ç½‘çš„æœåŠ¡ï¼Œæˆ‘ä»¬å¹¶ä¸æƒ³è®©å®ƒæš´éœ²åœ¨å¤–ï¼Œé‚£ä¹ˆå¯ä»¥å†éƒ¨ç½²ä¸€ä¸ªå†…ç½‘ä½¿ç”¨çš„ Ingress Controllerã€‚</p><p>å®˜æ–¹ä»‹ç»åœ°å€ï¼š<a href="https://kubernetes.github.io/ingress-nginx/user-guide/multiple-ingress/">https://kubernetes.github.io/ingress-nginx/user-guide/multiple-ingress/</a></p><p>æˆ‘å‡†å¤‡å°†è¿™ä¸¤ä¸ª ingressclass æ”¾åœ¨ä¸¤ä¸ª namespace é‡Œé¢ã€‚</p><h2 id="å…ˆæŠ½å‡º-clusterrole-å’Œ-clusterrolebinding"><a href="#å…ˆæŠ½å‡º-clusterrole-å’Œ-clusterrolebinding" class="headerlink" title="å…ˆæŠ½å‡º clusterrole å’Œ clusterrolebinding"></a>å…ˆæŠ½å‡º clusterrole å’Œ clusterrolebinding</h2><p>å› ä¸ºå¯ä»¥ä½¿ç”¨ä¸€ä¸ª clusterroleï¼Œæ²¡å¿…è¦æ¯ä¸ª ingress controller éƒ½åˆ›å»º clusterrole</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/instance:</span> <span class="string">ingress-nginx</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/name:</span> <span class="string">ingress-nginx</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/part-of:</span> <span class="string">ingress-nginx</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/version:</span> <span class="number">1.3</span><span class="number">.1</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ingress-nginx</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">configmaps</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">endpoints</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">nodes</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">pods</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">secrets</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">namespaces</span></span><br><span class="line">  <span class="attr">verbs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">list</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">watch</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">coordination.k8s.io</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">leases</span></span><br><span class="line">  <span class="attr">verbs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">list</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">watch</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">nodes</span></span><br><span class="line">  <span class="attr">verbs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">services</span></span><br><span class="line">  <span class="attr">verbs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">list</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">watch</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">networking.k8s.io</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">ingresses</span></span><br><span class="line">  <span class="attr">verbs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">list</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">watch</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">events</span></span><br><span class="line">  <span class="attr">verbs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">create</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">patch</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">networking.k8s.io</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">ingresses/status</span></span><br><span class="line">  <span class="attr">verbs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">update</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">networking.k8s.io</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">ingressclasses</span></span><br><span class="line">  <span class="attr">verbs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">list</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">watch</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/component:</span> <span class="string">admission-webhook</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/instance:</span> <span class="string">ingress-nginx</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/name:</span> <span class="string">ingress-nginx</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/part-of:</span> <span class="string">ingress-nginx</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/version:</span> <span class="number">1.3</span><span class="number">.1</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ingress-nginx-admission</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">admissionregistration.k8s.io</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">validatingwebhookconfigurations</span></span><br><span class="line">  <span class="attr">verbs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">update</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/instance:</span> <span class="string">ingress-nginx</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/name:</span> <span class="string">ingress-nginx</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/part-of:</span> <span class="string">ingress-nginx</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/version:</span> <span class="number">1.3</span><span class="number">.1</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ingress-nginx</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ingress-nginx</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line"><span class="comment"># è¿™é‡Œç»‘å®šäº†ä¸¤ä¸ªServiceAccount</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">internet-ingress-nginx</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">internet-ingress-nginx</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">intranet-ingress-nginx</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">intranet-ingress-nginx</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/component:</span> <span class="string">admission-webhook</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/instance:</span> <span class="string">ingress-nginx</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/name:</span> <span class="string">ingress-nginx</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/part-of:</span> <span class="string">ingress-nginx</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/version:</span> <span class="number">1.3</span><span class="number">.1</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ingress-nginx-admission</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ingress-nginx-admission</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line"><span class="comment"># è¿™é‡Œç»‘å®šäº†ä¸¤ä¸ªServiceAccount</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">intranet-ingress-nginx-admission</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">intranet-ingress-nginx</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">internet-ingress-nginx-admission</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">internet-ingress-nginx</span></span><br></pre></td></tr></table></figure><h2 id="ä¿®æ”¹-namespace"><a href="#ä¿®æ”¹-namespace" class="headerlink" title="ä¿®æ”¹ namespace"></a>ä¿®æ”¹ namespace</h2><p>æ‰€æœ‰ namespace éƒ½éœ€è¦ä¿®æ”¹æˆæ–°çš„</p><h2 id="ä¿®æ”¹-ingressclass"><a href="#ä¿®æ”¹-ingressclass" class="headerlink" title="ä¿®æ”¹ ingressclass"></a>ä¿®æ”¹ ingressclass</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">IngressClass</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/component:</span> <span class="string">controller</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/instance:</span> <span class="string">internet-ingress-nginx</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/name:</span> <span class="string">internet-ingress-nginx</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/part-of:</span> <span class="string">ingress-nginx</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/version:</span> <span class="number">1.3</span><span class="number">.1</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">internet</span>                                        <span class="comment"># ingressclass åå­—ï¼Œå’Œcontrollerçš„å¯åŠ¨å‚æ•°éœ€è¦ä¿æŒä¸€è‡´</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">controller:</span> <span class="string">k8s.io/internet-ingress-nginx</span>             <span class="comment"># controller åå­—ï¼Œå’Œcontrollerçš„å¯åŠ¨å‚æ•°éœ€è¦ä¿æŒä¸€è‡´</span></span><br></pre></td></tr></table></figure><h2 id="ä¿®æ”¹å¯åŠ¨å‚æ•°"><a href="#ä¿®æ”¹å¯åŠ¨å‚æ•°" class="headerlink" title="ä¿®æ”¹å¯åŠ¨å‚æ•°"></a>ä¿®æ”¹å¯åŠ¨å‚æ•°</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/component:</span> <span class="string">controller</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/instance:</span> <span class="string">internet-ingress-nginx</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/name:</span> <span class="string">internet-ingress-nginx</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/part-of:</span> <span class="string">ingress-nginx</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/version:</span> <span class="number">1.3</span><span class="number">.1</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ingress-nginx-controller</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">internet-ingress-nginx</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">minReadySeconds:</span> <span class="number">0</span></span><br><span class="line">  <span class="attr">revisionHistoryLimit:</span> <span class="number">10</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app.kubernetes.io/component:</span> <span class="string">controller</span></span><br><span class="line">      <span class="attr">app.kubernetes.io/instance:</span> <span class="string">internet-ingress-nginx</span></span><br><span class="line">      <span class="attr">app.kubernetes.io/name:</span> <span class="string">internet-ingress-nginx</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app.kubernetes.io/component:</span> <span class="string">controller</span></span><br><span class="line">        <span class="attr">app.kubernetes.io/instance:</span> <span class="string">internet-ingress-nginx</span></span><br><span class="line">        <span class="attr">app.kubernetes.io/name:</span> <span class="string">internet-ingress-nginx</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">args:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">/nginx-ingress-controller</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">--election-id=ingress-controller-leader</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">--controller-class=k8s.io/internet-ingress-nginx</span>            <span class="comment"># å’Œä¸Šé¢çš„controllerä¿æŒä¸€è‡´</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">--ingress-class=internet</span>                                    <span class="comment"># å’Œä¸Šé¢çš„ingressclassä¿æŒä¸€è‡´</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">--configmap=$(POD_NAMESPACE)/ingress-nginx-controller</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">--validating-webhook=:8443</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">--validating-webhook-certificate=/usr/local/certificates/cert</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">--validating-webhook-key=/usr/local/certificates/key</span></span><br></pre></td></tr></table></figure><h2 id="ä¸€ä¸ªä¾‹å­"><a href="#ä¸€ä¸ªä¾‹å­" class="headerlink" title="ä¸€ä¸ªä¾‹å­"></a>ä¸€ä¸ªä¾‹å­</h2><p>è¿™æ˜¯æˆ‘ä¿®æ”¹å¥½çš„ yaml æ–‡ä»¶ï¼Œå¯ä»¥ç›´æ¥ apply å³å¯åˆ›å»º ingress controller</p><p><a href="https://github.com/iuxt/ops/tree/master/kubernetes/infra/nginx-ingress/nginx-ingress-dual">https://github.com/iuxt/ops/tree/master/kubernetes/infra/nginx-ingress/nginx-ingress-dual</a></p>]]></content>
      
      
      <categories>
          
          <category> å®¹å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Nginx </tag>
            
            <tag> Ingress </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxä¸‹tmpç›®å½•çš„ç®¡ç†</title>
      <link href="/posts/23ada041/"/>
      <url>/posts/23ada041/</url>
      
        <content type="html"><![CDATA[<h2 id="ç”Ÿæˆä¸´æ—¶æ–‡ä»¶"><a href="#ç”Ÿæˆä¸´æ—¶æ–‡ä»¶" class="headerlink" title="ç”Ÿæˆä¸´æ—¶æ–‡ä»¶"></a>ç”Ÿæˆä¸´æ—¶æ–‡ä»¶</h2><p>å¯ä»¥ä½¿ç”¨ mktemp å‘½ä»¤ç”Ÿæˆ tmp æ–‡ä»¶ï¼Œmktemp -d ç”Ÿæˆä¸´æ—¶ç›®å½•ï¼Œé¿å…ä¸´æ—¶ç›®å½•é‡å¤ä½¿ç”¨çš„é—®é¢˜</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">tmp_file=<span class="string">&quot;<span class="subst">$(mktemp)</span>&quot;</span></span><br><span class="line">tmp_folder=<span class="string">&quot;<span class="subst">$(mktemp -d)</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$tmp_file</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$tmp_folder</span></span><br></pre></td></tr></table></figure><h2 id="tmp-ç›®å½•å®šæ—¶æ¸…ç†"><a href="#tmp-ç›®å½•å®šæ—¶æ¸…ç†" class="headerlink" title="tmp ç›®å½•å®šæ—¶æ¸…ç†"></a>tmp ç›®å½•å®šæ—¶æ¸…ç†</h2><p>è¿™ä¸ªæ˜¯ç”± systemd çš„å‡ ä¸ªæ¨¡å—å®ç°çš„ï¼Œ åœ¨ centos7 ä¸­ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemd-tmpfiles-setup.service  ï¼šCreate Volatile Files and Directories</span><br><span class="line">systemd-tmpfiles-setup-dev.serviceï¼šCreate static device nodes <span class="keyword">in</span> /dev</span><br><span class="line">systemd-tmpfiles-clean.service ï¼šCleanup of Temporary Directories</span><br></pre></td></tr></table></figure><p>é…ç½®æ–‡ä»¶ä¹Ÿæœ‰ 3 ä¸ªåœ°æ–¹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/etc/tmpfiles.d/*.conf</span><br><span class="line">/run/tmpfiles.d/*.conf</span><br><span class="line">/usr/lib/tmpfiles.d/*.conf</span><br></pre></td></tr></table></figure><p>&#x2F;tmp ç›®å½•çš„æ¸…ç†è§„åˆ™ä¸»è¦å–å†³äº <code>/usr/lib/tmpfiles.d/tmp.conf</code> æ–‡ä»¶çš„è®¾å®šï¼Œé»˜è®¤çš„é…ç½®å†…å®¹ä¸ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  This file is part of systemd.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#  systemd is free software; you can redistribute it and/or modify it</span></span><br><span class="line"><span class="comment">#  under the terms of the GNU Lesser General Public License as published by</span></span><br><span class="line"><span class="comment">#  the Free Software Foundation; either version 2.1 of the License, or</span></span><br><span class="line"><span class="comment">#  (at your option) any later version.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># See tmpfiles.d(5) for details</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Clear tmp directories separately, to make them easier to override</span></span><br><span class="line">v /tmp 1777 root root 10d</span><br><span class="line">v /var/tmp 1777 root root 30d</span><br><span class="line"></span><br><span class="line"><span class="comment"># Exclude namespace mountpoints created with PrivateTmp=yes</span></span><br><span class="line">x /tmp/systemd-private-%b-*</span><br><span class="line">X /tmp/systemd-private-%b-*/tmp</span><br><span class="line">x /var/tmp/systemd-private-%b-*</span><br><span class="line">X /var/tmp/systemd-private-%b-*/tmp</span><br></pre></td></tr></table></figure><p>å¦‚ä½ ä¸æƒ³è®©ç³»ç»Ÿè‡ªåŠ¨æ¸…ç†&#x2F;tmp ä¸‹ä»¥ tomcat å¼€å¤´çš„ç›®å½•ï¼Œé‚£ä¹ˆå¢åŠ ä¸‹é¢è¿™æ¡å†…å®¹åˆ°é…ç½®æ–‡ä»¶ä¸­å³å¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x /tmp/tomcat.*</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¦»çº¿å®‰è£…Docker</title>
      <link href="/posts/b4ed6a46/"/>
      <url>/posts/b4ed6a46/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸‹è½½è§£å‹"><a href="#ä¸‹è½½è§£å‹" class="headerlink" title="ä¸‹è½½è§£å‹"></a>ä¸‹è½½è§£å‹</h2><p>ç¦»çº¿äºŒè¿›åˆ¶åŒ…ä¸‹è½½åœ°å€</p><ul><li>å®˜æ–¹åœ°å€ï¼š<a href="https://downrload.docker.com/linux/static/stable/x86_64/">https://downrload.docker.com/linux/static/stable/x86_64/</a></li><li>é˜¿é‡Œäº‘é•œåƒåœ°å€ï¼š<a href="https://mirrors.aliyun.com/docker-ce/linux/static/stable/x86_64/">https://mirrors.aliyun.com/docker-ce/linux/static/stable/x86_64/</a></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wget https://mirrors.aliyun.com/docker-ce/linux/static/stable/x86_64/docker-24.0.9.tgz</span><br><span class="line"></span><br><span class="line">tar xf docker-24.0.9.tgz</span><br><span class="line"><span class="built_in">mv</span> docker/* /usr/bin/</span><br></pre></td></tr></table></figure><h2 id="åˆ›å»º-systemd-é…ç½®"><a href="#åˆ›å»º-systemd-é…ç½®" class="headerlink" title="åˆ›å»º systemd é…ç½®"></a>åˆ›å»º systemd é…ç½®</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; /usr/lib/systemd/system/containerd.service &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">[Unit]</span></span><br><span class="line"><span class="string">Description=containerd container runtime</span></span><br><span class="line"><span class="string">Documentation=https://containerd.io</span></span><br><span class="line"><span class="string">After=network.target local-fs.target</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Service]</span></span><br><span class="line"><span class="string">ExecStartPre=-/sbin/modprobe overlay</span></span><br><span class="line"><span class="string">ExecStart=/usr/local/bin/containerd</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Type=notify</span></span><br><span class="line"><span class="string">Delegate=yes</span></span><br><span class="line"><span class="string">KillMode=process</span></span><br><span class="line"><span class="string">Restart=always</span></span><br><span class="line"><span class="string">RestartSec=5</span></span><br><span class="line"><span class="string">LimitNPROC=infinity</span></span><br><span class="line"><span class="string">LimitCORE=infinity</span></span><br><span class="line"><span class="string">LimitNOFILE=infinity</span></span><br><span class="line"><span class="string">TasksMax=infinity</span></span><br><span class="line"><span class="string">OOMScoreAdjust=-999</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Install]</span></span><br><span class="line"><span class="string">WantedBy=multi-user.target</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &gt; /usr/lib/systemd/system/docker.service &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">[Unit]</span></span><br><span class="line"><span class="string">Description=Docker Application Container Engine</span></span><br><span class="line"><span class="string">Documentation=https://docs.docker.com</span></span><br><span class="line"><span class="string">After=network.target</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Service]</span></span><br><span class="line"><span class="string">Type=notify</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ExecStart=/usr/bin/dockerd -H unix:///var/run/docker.sock</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ExecReload=/bin/kill -s HUP $MAINPID</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">LimitNOFILE=infinity</span></span><br><span class="line"><span class="string">LimitNPROC=infinity</span></span><br><span class="line"><span class="string">LimitCORE=infinity</span></span><br><span class="line"><span class="string">TimeoutStartSec=0</span></span><br><span class="line"><span class="string">Delegate=yes</span></span><br><span class="line"><span class="string">KillMode=process</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Install]</span></span><br><span class="line"><span class="string">WantedBy=multi-user.target</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &gt; /usr/lib/systemd/system/docker.socket &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">[Unit]</span></span><br><span class="line"><span class="string">Description=Docker Socket for the API</span></span><br><span class="line"><span class="string">PartOf=docker.service</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Socket]</span></span><br><span class="line"><span class="string">ListenStream=/var/run/docker.sock</span></span><br><span class="line"><span class="string">SocketMode=0660</span></span><br><span class="line"><span class="string">SocketUser=root</span></span><br><span class="line"><span class="string">SocketGroup=docker</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Install]</span></span><br><span class="line"><span class="string">WantedBy=sockets.target</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">sudo systemctl daemon-reload</span><br></pre></td></tr></table></figure><h2 id="åˆ›å»ºé…ç½®æ–‡ä»¶"><a href="#åˆ›å»ºé…ç½®æ–‡ä»¶" class="headerlink" title="åˆ›å»ºé…ç½®æ–‡ä»¶"></a>åˆ›å»ºé…ç½®æ–‡ä»¶</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">mkdir</span> /etc/docker</span><br><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF | sudo tee /etc/docker/daemon.json</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  &quot;exec-opts&quot;: [&quot;native.cgroupdriver=systemd&quot;],</span></span><br><span class="line"><span class="string">  &quot;log-driver&quot;: &quot;json-file&quot;,</span></span><br><span class="line"><span class="string">  &quot;log-opts&quot;: &#123;</span></span><br><span class="line"><span class="string">    &quot;max-size&quot;: &quot;1g&quot;</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">  &quot;storage-driver&quot;: &quot;overlay2&quot;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><h2 id="è®¾ç½®å¼€æœºè‡ªå¯åŠ¨"><a href="#è®¾ç½®å¼€æœºè‡ªå¯åŠ¨" class="headerlink" title="è®¾ç½®å¼€æœºè‡ªå¯åŠ¨"></a>è®¾ç½®å¼€æœºè‡ªå¯åŠ¨</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl <span class="built_in">enable</span> --now docker</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>harboræ¥å…¥å¤–éƒ¨trivyé•œåƒæ¼æ´æ‰«æ</title>
      <link href="/posts/8b932a1b/"/>
      <url>/posts/8b932a1b/</url>
      
        <content type="html"><![CDATA[<p>harbor æ¥å…¥ trivy æ¼æ´æ‰«æ, ç”¨åˆ°çš„å¼€æºå·¥å…· <a href="https://github.com/aquasecurity/harbor-scanner-trivy">harbor-scanner-trivy</a></p><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>éœ€è¦ä¾èµ– Redis, å…ˆå®‰è£… Redis</p><h3 id="å®‰è£…-trivy"><a href="#å®‰è£…-trivy" class="headerlink" title="å®‰è£… trivy"></a>å®‰è£… trivy</h3><p>trivy æ˜¯æ‰«ææ ¸å¿ƒç»„ä»¶ï¼Œ éœ€è¦å®‰è£…ï¼Œå‚è€ƒ trivy å®˜ç½‘å®‰è£…æ–‡æ¡£</p><p><a href="https://aquasecurity.github.io/trivy/v0.41/getting-started/installation/">https://aquasecurity.github.io/trivy/v0.41/getting-started/installation/</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">RELEASE_VERSION=$(grep -Po <span class="string">&#x27;(?&lt;=VERSION_ID=&quot;)[0-9]&#x27;</span> /etc/os-release)</span><br><span class="line"><span class="built_in">cat</span> &lt;&lt; <span class="string">EOF | sudo tee -a /etc/yum.repos.d/trivy.repo</span></span><br><span class="line"><span class="string">[trivy]</span></span><br><span class="line"><span class="string">name=Trivy repository</span></span><br><span class="line"><span class="string">baseurl=https://aquasecurity.github.io/trivy-repo/rpm/releases/$RELEASE_VERSION/\$basearch/</span></span><br><span class="line"><span class="string">gpgcheck=1</span></span><br><span class="line"><span class="string">enabled=1</span></span><br><span class="line"><span class="string">gpgkey=https://aquasecurity.github.io/trivy-repo/rpm/public.key</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">sudo yum -y install trivy</span><br></pre></td></tr></table></figure><p>trivy é¦–æ¬¡è¿è¡Œä¼šä» github ä¸‹è½½æ¼æ´æ•°æ®åº“ï¼Œéœ€è¦ç¡®ä¿æœºå™¨å¯ä»¥è¿æ¥ GitHubï¼Œæ‰§è¡Œ <code>trivy image --download-db-only</code> ä¼šä¸‹è½½ dbï¼Œdb æ•°æ®å­˜å‚¨åœ¨ <code>~/.cache/trivy</code></p><h3 id="å®‰è£…-scanner-trivy"><a href="#å®‰è£…-scanner-trivy" class="headerlink" title="å®‰è£… scanner-trivy"></a>å®‰è£… scanner-trivy</h3><p>å¼€æºåœ°å€ï¼š<a href="https://github.com/aquasecurity/harbor-scanner-trivy">https://github.com/aquasecurity/harbor-scanner-trivy</a></p><p>scanner-trivy æ˜¯é€šè¿‡ç¯å¢ƒå˜é‡è¯»å–é…ç½®</p><p>å¯åŠ¨å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SCANNER_API_SERVER_ADDR=:8181 SCANNER_REDIS_URL=redis://localhost:6379 ./scanner-trivy</span><br></pre></td></tr></table></figure><p>æˆ–è€…é€šè¿‡ supervisor è¿è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[program:trivy]</span><br><span class="line">numprocs=1</span><br><span class="line">user=root</span><br><span class="line"><span class="built_in">command</span>=/data/server/trivy/scanner-trivy</span><br><span class="line">directory=/data/server/trivy/</span><br><span class="line">redirect_stderr=<span class="literal">true</span></span><br><span class="line">stdout_logfile=/data/logs/trivy.log</span><br><span class="line">autostart=<span class="literal">true</span></span><br><span class="line">autorestart=<span class="literal">true</span></span><br><span class="line">startsecs=10</span><br><span class="line">environment=SCANNER_API_SERVER_ADDR=:8181,SCANNER_REDIS_URL=redis://localhost:6379</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><p>harbor ç³»ç»Ÿç®¡ç† å®¡æŸ¥æœåŠ¡ æ‰«æå™¨ é‡Œé¢æ·»åŠ  trivy åœ°å€ï¼š</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202305121619236.png" alt="trivyæ‰«æå™¨"></p><p>ç„¶åå°±å¯ä»¥æ­£å¸¸æ‰«æé•œåƒäº†</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202305121624912.png" alt="æ‰«æç»“æœ"></p><h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><h3 id="ä½¿ç”¨å›½å†…é•œåƒæ›´æ–°"><a href="#ä½¿ç”¨å›½å†…é•œåƒæ›´æ–°" class="headerlink" title="ä½¿ç”¨å›½å†…é•œåƒæ›´æ–°"></a>ä½¿ç”¨å›½å†…é•œåƒæ›´æ–°</h3><p>å€ŸåŠ© <a href="https://github.com/oras-project/oras">oras</a> æ¥æ‹‰å–é•œåƒï¼Œ éœ€è¦å…ˆå®‰è£… <a href="https://github.com/oras-project/oras">oras</a></p><p>æ›´æ–°æ•°æ®åº“çš„è„šæœ¬ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /tmp</span><br><span class="line"></span><br><span class="line"><span class="built_in">rm</span> -rf /tmp/trivy &amp;&amp; <span class="built_in">rm</span> -rf /tmp/db.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ! /usr/local/bin/oras  pull ghcr.nju.edu.cn/aquasecurity/trivy-db:2 -v --insecure ;<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;pull trivy-db failed&quot;</span> &gt;&gt; /tmp/trivy.log</span><br><span class="line">    <span class="built_in">exit</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> /tmp/trivy &amp;&amp; tar -zxvf /tmp/db.tar.gz -C /tmp/trivy</span><br><span class="line">/bin/cp -rfp /tmp/trivy/* /root/.cache/trivy/db/</span><br><span class="line"><span class="built_in">rm</span> -rf /tmp/trivy &amp;&amp; <span class="built_in">rm</span> -rf /tmp/db.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="built_in">rm</span> -rf /tmp/trivy-java &amp;&amp; <span class="built_in">rm</span> -rf /tmp/javadb.tar.gz</span><br><span class="line"><span class="keyword">if</span> ! /usr/local/bin/oras  pull ghcr.nju.edu.cn/aquasecurity/trivy-java-db:1  -v --insecure ;<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;pull trivy-java-db failed&quot;</span> &gt;&gt; /tmp/trivy.log</span><br><span class="line">    <span class="built_in">exit</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> /tmp/trivy-java  &amp;&amp; tar -zxvf /tmp/javadb.tar.gz -C /tmp/trivy-java</span><br><span class="line">/bin/cp -rfp /tmp/trivy-java/* /root/.cache/trivy/java-db</span><br><span class="line"><span class="built_in">rm</span> -rf /tmp/trivy-java &amp;&amp; <span class="built_in">rm</span> -rf /tmp/javadb.tar.gz</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ <code>crontab</code> æ‰§è¡Œæ­¤è„šæœ¬ï¼Œ ä¸€å¤©ä¸€æ¬¡å³å¯ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é•œåƒ </tag>
            
            <tag> harbor </tag>
            
            <tag> å®¹å™¨ </tag>
            
            <tag> æ¼æ´æ‰«æ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pythonå¸¸ç”¨é…ç½®</title>
      <link href="/posts/b19de2c2/"/>
      <url>/posts/b19de2c2/</url>
      
        <content type="html"><![CDATA[<h2 id="pip"><a href="#pip" class="headerlink" title="pip"></a>pip</h2><h3 id="å‡çº§-pip-ç‰ˆæœ¬"><a href="#å‡çº§-pip-ç‰ˆæœ¬" class="headerlink" title="å‡çº§ pip ç‰ˆæœ¬"></a>å‡çº§ pip ç‰ˆæœ¬</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install -i https://mirrors.ustc.edu.cn/pypi/web/simple pip -U</span><br></pre></td></tr></table></figure><h2 id="é•œåƒæº"><a href="#é•œåƒæº" class="headerlink" title="é•œåƒæº"></a>é•œåƒæº</h2><p>ä¸­ç§‘å¤§æºé…ç½®è¯´æ˜ï¼š <a href="https://mirrors.ustc.edu.cn/help/pypi.html">https://mirrors.ustc.edu.cn/help/pypi.html</a></p><h3 id="ä¸´æ—¶ä½¿ç”¨"><a href="#ä¸´æ—¶ä½¿ç”¨" class="headerlink" title="ä¸´æ—¶ä½¿ç”¨"></a>ä¸´æ—¶ä½¿ç”¨</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install -i https://mirrors.ustc.edu.cn/pypi/web/simple package</span><br></pre></td></tr></table></figure><h3 id="è®¾ä¸ºé»˜è®¤"><a href="#è®¾ä¸ºé»˜è®¤" class="headerlink" title="è®¾ä¸ºé»˜è®¤"></a>è®¾ä¸ºé»˜è®¤</h3><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">é€šè¿‡pipå‘½ä»¤æ¥é…ç½®</button><button type="button" class="tab">é€šè¿‡é…ç½®æ–‡ä»¶æ¥é…ç½®</button></div><div class="tab-contents"><div class="tab-item-content active"><p>å‡çº§ pip åˆ°æœ€æ–°çš„ç‰ˆæœ¬ (&gt;&#x3D;10.0.0) åè¿›è¡Œé…ç½®ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip config <span class="built_in">set</span> global.index-url https://mirrors.ustc.edu.cn/pypi/web/simple</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><p>vim ~&#x2F;.config&#x2F;pip&#x2F;pip.conf</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[global]</span></span><br><span class="line"><span class="attr">index-url</span> = https://mirrors.ustc.edu.cn/pypi/web/simple</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div><h2 id="windows-è°ƒç”¨è™šæ‹Ÿç¯å¢ƒ"><a href="#windows-è°ƒç”¨è™šæ‹Ÿç¯å¢ƒ" class="headerlink" title="windows è°ƒç”¨è™šæ‹Ÿç¯å¢ƒ"></a>windows è°ƒç”¨è™šæ‹Ÿç¯å¢ƒ</h2><p>åœ¨ bat è„šæœ¬ä¸­è°ƒç”¨ Python è™šæ‹Ÿç¯å¢ƒï¼Œå¯ä»¥ä½¿ç”¨</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line">.\venv\Scripts\python.exe ocr.py</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨Nginxåå‘ä»£ç†åŸŸå</title>
      <link href="/posts/bad354d3/"/>
      <url>/posts/bad354d3/</url>
      
        <content type="html"><![CDATA[<p>éœ€æ±‚å¦‚ä¸‹ï¼šç ”å‘ä»£ç é‡Œå†™æ­»äº†åœ°å€ <a href="https://b.com/">https://b.com</a> ç°åœ¨åœ¨ä¸æƒ³å‘å¸ƒæ–°ä»£ç çš„æƒ…å†µä¸‹ä¿®æ”¹åœ°å€ä¸º <a href="https://a.com/">https://a.com</a></p><h2 id="æ‰‹åŠ¨å¢åŠ åå‘ä»£ç†çš„-header"><a href="#æ‰‹åŠ¨å¢åŠ åå‘ä»£ç†çš„-header" class="headerlink" title="æ‰‹åŠ¨å¢åŠ åå‘ä»£ç†çš„ header"></a>æ‰‹åŠ¨å¢åŠ åå‘ä»£ç†çš„ header</h2><p>å…ˆ <code>ping a.com</code> è·å–åˆ°æœåŠ¡å™¨çš„ ip</p><p>æ‰€ä»¥ä¸´æ—¶åœ¨ pod é‡Œé¢æ–°å¢äº† nginx æœåŠ¡ï¼Œé…ç½®å¦‚ä¸‹ï¼Œç”±äºæ˜¯ä»£ç† https æœåŠ¡ï¼Œè¿˜éœ€è¦é…ç½® ssl è¯ä¹¦ï¼Œåˆšå¥½æœ‰è¯ä¹¦ã€‚ã€‚ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">  listen 80;</span><br><span class="line">  listen [::]:80;</span><br><span class="line">  listen 443 ssl;</span><br><span class="line">  listen [::]:443 ssl;</span><br><span class="line">  ssl_certificate   /etc/nginx/ssl.crt;</span><br><span class="line">  ssl_certificate_key /etc/nginx/ssl.key;</span><br><span class="line">  ssl_session_timeout 5m;</span><br><span class="line">  ssl_ciphers HIGH:!aNULL:!MD5;</span><br><span class="line">  ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</span><br><span class="line">  ssl_prefer_server_ciphers on;</span><br><span class="line">  server_name b.com;</span><br><span class="line">  client_max_body_size 1024m;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  location / &#123;</span><br><span class="line">    proxy_pass https://139.224.186.170;                        # ping å‡ºæ¥çš„åŸŸåIP</span><br><span class="line">    proxy_set_header HOST a.com;                  # å¢åŠ header HOST: a.com</span><br><span class="line">    proxy_set_header X-Forwarded-Proto $scheme;</span><br><span class="line">    proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä¼˜åŒ–å†™æ³•"><a href="#ä¼˜åŒ–å†™æ³•" class="headerlink" title="ä¼˜åŒ–å†™æ³•"></a>ä¼˜åŒ–å†™æ³•</h2><p>nginx æä¾›äº†å†…ç½®å˜é‡ $proxy_hostï¼Œä¼˜åŒ–å†™æ³•ä¸ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">  listen 80;</span><br><span class="line">  listen [::]:80;</span><br><span class="line">  listen 443 ssl;</span><br><span class="line">  listen [::]:443 ssl;</span><br><span class="line">  ssl_certificate   /etc/nginx/ssl.crt;</span><br><span class="line">  ssl_certificate_key /etc/nginx/ssl.key;</span><br><span class="line">  ssl_session_timeout 5m;</span><br><span class="line">  ssl_ciphers HIGH:!aNULL:!MD5;</span><br><span class="line">  ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</span><br><span class="line">  ssl_prefer_server_ciphers on;</span><br><span class="line">  server_name b.com;</span><br><span class="line">  client_max_body_size 1024m;</span><br><span class="line"></span><br><span class="line">  location / &#123;</span><br><span class="line">    proxy_pass https://a.com;</span><br><span class="line">    proxy_set_header HOST $proxy_host;</span><br><span class="line">    proxy_set_header X-Forwarded-Proto $scheme;</span><br><span class="line">    proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æœ¬åœ°ç»‘å®š-hosts"><a href="#æœ¬åœ°ç»‘å®š-hosts" class="headerlink" title="æœ¬åœ°ç»‘å®š hosts"></a>æœ¬åœ°ç»‘å®š hosts</h2><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1   b.com</span><br></pre></td></tr></table></figure><h2 id="æµ‹è¯•æ•ˆæœ"><a href="#æµ‹è¯•æ•ˆæœ" class="headerlink" title="æµ‹è¯•æ•ˆæœ"></a>æµ‹è¯•æ•ˆæœ</h2><p>è¿™ä¸ªæ—¶å€™ä¸¤ä¸ªåŸŸåè®¿é—®æ•ˆæœä¸€æ¨¡ä¸€æ ·äº†.</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202304181941595.png" alt="è®¿é—®æ•ˆæœ"></p>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Nginx </tag>
            
            <tag> åå‘ä»£ç† </tag>
            
            <tag> nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨Pythonè§£æxml</title>
      <link href="/posts/9f75a5fc/"/>
      <url>/posts/9f75a5fc/</url>
      
        <content type="html"><![CDATA[<p>xml æ˜¯ä¸€ç§å›ºæœ‰çš„åˆ†å±‚æ•°æ®æ ¼å¼ï¼Œæœ€è‡ªç„¶çš„è¡¨ç¤ºæ–¹å¼æ˜¯è§£ææˆæ ‘çŠ¶ã€‚ ElementTree å°†æ•´ä¸ª xml æ–‡æ¡£è§£ææˆæ ‘çŠ¶ç»“æ„ï¼Œ Element å°±è¡¨ç¤ºè¿™ä¸ªæ ‘çŠ¶ç»“æ„ä¸­çš„å•èŠ‚ç‚¹ã€‚æ•´ä¸ª xml æ–‡æ¡£ä¸ Python äº¤äº’ï¼ˆè¯»å–å’Œå†™å…¥æ–‡ä»¶ï¼‰æ˜¯åœ¨ ElementTreeï¼ˆç›¸å½“äºæ•´æ£µæ ‘ï¼‰ä¸Šå®Œæˆã€‚å•ä¸ª xml å…ƒç´ åŠå…¶å­å…ƒç´ çš„äº¤äº’æ˜¯åœ¨ Elementï¼ˆç›¸å½“äº leafï¼‰ä¸Šå®Œæˆã€‚</p><h2 id="XML-è¯­æ³•"><a href="#XML-è¯­æ³•" class="headerlink" title="XML è¯­æ³•"></a>XML è¯­æ³•</h2><h3 id="æ–‡æ¡£å£°æ˜"><a href="#æ–‡æ¡£å£°æ˜" class="headerlink" title="æ–‡æ¡£å£°æ˜"></a>æ–‡æ¡£å£°æ˜</h3><p>ä» XML 1.1 å¼€å§‹ï¼Œåœ¨ä¸€ä¸ªå®Œæ•´çš„ XML æ–‡æ¡£ä¸­ï¼Œå¿…é¡»åŒ…å«ä¸€ä¸ª XML æ–‡æ¡£çš„å£°æ˜ï¼Œå¹¶ä¸”è¯¥å£°æ˜å¿…é¡»ä½äºæ–‡æ¡£çš„ç¬¬ä¸€è¡Œã€‚XML æ–‡æ¡£å£°æ˜çš„è¯­æ³•æ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;version&quot;</span> encoding=<span class="string">&quot;value&quot;</span> standalone=<span class="string">&quot;value&quot;</span> ?&gt;</span></span><br></pre></td></tr></table></figure><ul><li>versionï¼šç”¨äºæŒ‡å®šéµå¾ª XML è§„èŒƒçš„ç‰ˆæœ¬å·ã€‚åœ¨ XML å£°æ˜ä¸­å¿…é¡»åŒ…å« version å±æ€§ï¼Œä¸”è¯¥å±æ€§å¿…é¡»æ”¾åœ¨ XML å£°æ˜ä¸­å…¶ä»–å±æ€§ä¹‹å‰ã€‚</li><li>encodingï¼šç”¨æ¥æŒ‡å®š XML æ–‡æ¡£æ‰€ä½¿ç”¨çš„ç¼–ç é›†ã€‚</li><li>standaloneï¼šç”¨æ¥æŒ‡å®šè¯¥ XML æ–‡æ¡£æ˜¯å¦å’Œä¸€ä¸ªå¤–éƒ¨æ–‡æ¡£åµŒå¥—ä½¿ç”¨ï¼Œå–å€¼ä¸º yes æˆ– noã€‚å¦‚æœè®¾ç½®å±æ€§å€¼ä¸º yesï¼Œè¯´æ˜æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ XML æ–‡æ¡£ï¼Œä¸å¤–éƒ¨æ–‡ä»¶æ— å…³è”ï¼›å¦‚æœè®¾ç½®å±æ€§å€¼ä¸º noï¼Œè¯´æ˜ XML æ–‡æ¡£ä¸ç‹¬ç«‹ã€‚</li></ul><h3 id="å…ƒç´ å®šä¹‰"><a href="#å…ƒç´ å®šä¹‰" class="headerlink" title="å…ƒç´ å®šä¹‰"></a>å…ƒç´ å®šä¹‰</h3><p>XML æ–‡æ¡£ä¸­çš„ä¸»ä½“å†…å®¹éƒ½æ˜¯ç”±å…ƒç´ ï¼ˆElementï¼‰ç»„æˆçš„ï¼Œå…ƒç´ æ˜¯ä»¥æ ‘å½¢åˆ†å±‚ç»“æ„æ’åˆ—çš„ï¼Œä¸€ä¸ªå…ƒç´ å¯ä»¥åµŒå¥—åœ¨å¦ä¸€ä¸ªå…ƒç´ ä¸­ã€‚XML æ–‡æ¡£ä¸­æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªé¡¶å±‚å…ƒç´ ï¼Œç§°ä¸ºæ–‡æ¡£å…ƒç´ æˆ–æ ¹å…ƒç´ ã€‚å…ƒç´ ä¸€èˆ¬æ˜¯ç”±å¼€å§‹æ ‡ç­¾ã€å±æ€§ã€å…ƒç´ å†…å®¹å’Œç»“æŸæ ‡ç­¾æ„æˆï¼Œå…·ä½“ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">åŸå¸‚</span>&gt;</span>åŒ—äº¬<span class="tag">&lt;/<span class="name">åŸå¸‚</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å¦‚æœä¸€ä¸ªå…ƒç´ ä¸­æ²¡æœ‰åµŒå¥—å­å…ƒç´ ï¼Œä¹Ÿæ²¡æœ‰åŒ…å«æ–‡æœ¬å†…å®¹ï¼Œç§°ä¸ºç©ºå…ƒç´ ï¼Œæ¯”å¦‚ <code>&lt; img &gt;&lt; /img &gt;</code> å¯ä»¥ç®€å†™ä¸º <code>&lt; img/ &gt;</code></p><h3 id="å±æ€§å®šä¹‰"><a href="#å±æ€§å®šä¹‰" class="headerlink" title="å±æ€§å®šä¹‰"></a>å±æ€§å®šä¹‰</h3><p>åœ¨ XML æ–‡æ¡£ä¸­ï¼Œå¯ä»¥ä¸ºå…ƒç´ å®šä¹‰å±æ€§ã€‚å±æ€§æ˜¯å¯¹å…ƒç´ çš„è¿›ä¸€æ­¥æè¿°å’Œè¯´æ˜ã€‚åœ¨ä¸€ä¸ªå…ƒç´ ä¸­ï¼Œå¯ä»¥è‡ªå®šä¹‰å¤šä¸ªå±æ€§ï¼Œå±æ€§æ˜¯ä¾é™„äºå…ƒç´ å­˜åœ¨çš„ï¼Œå¹¶ä¸”æ¯ä¸ªå±æ€§éƒ½æœ‰è‡ªå·±çš„åç§°å’Œå–å€¼ï¼Œå…·ä½“ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">å”®ä»·</span> <span class="attr">å•ä½</span>=<span class="string">&quot;å…ƒ&quot;</span>&gt;</span>68<span class="tag">&lt;/<span class="name">å”®ä»·</span>&gt;</span></span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ XML æ–‡æ¡£ä¸­ï¼Œå±æ€§çš„å‘½åè§„èŒƒä¸å…ƒç´ ç›¸åŒï¼Œå±æ€§å€¼å¿…é¡»è¦ç”¨åŒå¼•å·ï¼ˆâ€â€ï¼‰æˆ–è€…å•å¼•å·ï¼ˆâ€™â€™ï¼‰å¼•èµ·æ¥ï¼Œå¦åˆ™è¢«è§†ä¸ºé”™è¯¯ã€‚</p><h3 id="æ³¨é‡Š"><a href="#æ³¨é‡Š" class="headerlink" title="æ³¨é‡Š"></a>æ³¨é‡Š</h3><p>æ³¨é‡Šæ˜¯ä¸ºäº†ä¾¿äºé˜…è¯»å’Œç†è§£ï¼Œå¦‚æœæƒ³åœ¨ XML æ–‡æ¡£ä¸­æ’å…¥ä¸€äº›é™„åŠ ä¿¡æ¯ï¼Œæ¯”å¦‚ä½œè€…å§“åã€åœ°å€æˆ–ç”µè¯ç­‰ï¼Œè¿™äº›ä¿¡æ¯æ˜¯å¯¹æ–‡æ¡£ç»“æ„æˆ–æ–‡æ¡£å†…å®¹çš„è§£é‡Šï¼Œä¸å±äº XML æ–‡æ¡£çš„å†…å®¹ï¼Œå› æ­¤ XML è§£æå™¨ä¸ä¼šå¤„ç†æ³¨é‡Šå†…å®¹ã€‚å…·ä½“è¯­æ³•æ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- æ³¨é‡Šä¿¡æ¯ --&gt;</span></span><br></pre></td></tr></table></figure><h3 id="è„šæœ¬ä¸¾ä¾‹"><a href="#è„šæœ¬ä¸¾ä¾‹" class="headerlink" title="è„šæœ¬ä¸¾ä¾‹"></a>è„šæœ¬ä¸¾ä¾‹</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> xml.etree.ElementTree <span class="keyword">as</span> ET</span><br><span class="line"></span><br><span class="line">xml_text = <span class="string">&#x27;&#x27;&#x27;&lt;?xml version=&quot;1.0&quot;?&gt;</span></span><br><span class="line"><span class="string">&lt;namesilo&gt;</span></span><br><span class="line"><span class="string">    &lt;request&gt;</span></span><br><span class="line"><span class="string">        &lt;operation&gt;dnsListRecords&lt;/operation&gt;</span></span><br><span class="line"><span class="string">        &lt;ip&gt;111.111.111.111&lt;/ip&gt;</span></span><br><span class="line"><span class="string">    &lt;/request&gt;</span></span><br><span class="line"><span class="string">    &lt;reply&gt;</span></span><br><span class="line"><span class="string">        &lt;code&gt;300&lt;/code&gt;</span></span><br><span class="line"><span class="string">        &lt;detail&gt;success&lt;/detail&gt;</span></span><br><span class="line"><span class="string">        &lt;resource_record&gt;</span></span><br><span class="line"><span class="string">            &lt;type&gt;A&lt;/type&gt;</span></span><br><span class="line"><span class="string">            &lt;host&gt;xxxx.com&lt;/host&gt;</span></span><br><span class="line"><span class="string">            &lt;value&gt;111.111.111.111&lt;/value&gt;</span></span><br><span class="line"><span class="string">            &lt;distance&gt;0&lt;/distance&gt;</span></span><br><span class="line"><span class="string">        &lt;/resource_record&gt;</span></span><br><span class="line"><span class="string">        &lt;resource_record&gt;</span></span><br><span class="line"><span class="string">            &lt;type&gt;A&lt;/type&gt;</span></span><br><span class="line"><span class="string">            &lt;host&gt;guanyu.xxxx.com&lt;/host&gt;</span></span><br><span class="line"><span class="string">            &lt;value&gt;111.111.111.111&lt;/value&gt;</span></span><br><span class="line"><span class="string">            &lt;distance&gt;0&lt;/distance&gt;</span></span><br><span class="line"><span class="string">        &lt;/resource_record&gt;</span></span><br><span class="line"><span class="string">        &lt;resource_record a=&quot;b&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;type&gt;CNAME&lt;/type&gt;</span></span><br><span class="line"><span class="string">            &lt;host&gt;www.xxxx.com&lt;/host&gt;</span></span><br><span class="line"><span class="string">            &lt;value&gt;guanyu.xxxx.com&lt;/value&gt;</span></span><br><span class="line"><span class="string">            &lt;distance&gt;0&lt;/distance&gt;</span></span><br><span class="line"><span class="string">        &lt;/resource_record&gt;</span></span><br><span class="line"><span class="string">    &lt;/reply&gt;</span></span><br><span class="line"><span class="string">&lt;/namesilo&gt;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">root = ET.XML(xml_text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(root.tag)                         <span class="comment"># namesilo </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> resource_record <span class="keyword">in</span> root.<span class="built_in">iter</span>(<span class="string">&#x27;resource_record&#x27;</span>):    <span class="comment"># å…¨å±€éå†</span></span><br><span class="line">    <span class="built_in">print</span>(resource_record.attrib)               <span class="comment"># è¿™é‡Œåˆ†åˆ«è¾“å‡º3ä¸ª &#123;&#125; &#123;&#125; &#123;&#x27;a&#x27;: &#x27;b&#x27;&#125;</span></span><br><span class="line">    <span class="built_in">print</span>(resource_record.find(<span class="string">&quot;host&quot;</span>).text)    <span class="comment"># è¿™é‡Œåˆ†åˆ«è¾“å‡º3ä¸ª host</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># findtext å’Œ find(&quot;xxx&quot;).text æ˜¯ä¸€æ ·çš„</span></span><br><span class="line">    <span class="built_in">print</span>(resource_record.findtext(<span class="string">&quot;type&quot;</span>))     <span class="comment"># è¿™é‡Œè¾“å‡º3ä¸ª type</span></span><br></pre></td></tr></table></figure><h2 id="æŸ¥æ‰¾æ–¹æ³•"><a href="#æŸ¥æ‰¾æ–¹æ³•" class="headerlink" title="æŸ¥æ‰¾æ–¹æ³•"></a>æŸ¥æ‰¾æ–¹æ³•</h2><ul><li><code>iter(tag=None)</code> éå† Element çš„ childï¼Œå¯ä»¥æŒ‡å®š tag ç²¾ç¡®æŸ¥æ‰¾</li><li><code>findall(match)</code> æŸ¥æ‰¾å½“å‰å…ƒç´  tag æˆ– path èƒ½åŒ¹é…çš„ child èŠ‚ç‚¹</li><li><code>find(match)</code> æŸ¥æ‰¾å½“å‰å…ƒç´  tag æˆ– path èƒ½åŒ¹é…çš„ç¬¬ä¸€ä¸ª child èŠ‚ç‚¹</li><li><code>get(key, default=None)</code> è·å–å…ƒç´ æŒ‡å®š key å¯¹åº”çš„ attribï¼Œå¦‚æœæ²¡æœ‰ attribï¼Œè¿”å› defaultã€‚</li></ul><h2 id="ä¿®æ”¹æ–¹æ³•"><a href="#ä¿®æ”¹æ–¹æ³•" class="headerlink" title="ä¿®æ”¹æ–¹æ³•"></a>ä¿®æ”¹æ–¹æ³•</h2><ul><li><code>Element.text</code> ç›´æ¥ä¿®æ”¹å­—æ®µ</li><li><code>Element.remove()</code> åˆ é™¤å­—æ®µ</li><li><code>Element.set()</code> æ·»åŠ æˆ–ä¿®æ”¹å±æ€§ attrib</li><li><code>with Element.append()</code> æ·»åŠ æ–°çš„ child</li></ul>]]></content>
      
      
      <categories>
          
          <category> å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> xml </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Debianå¸¸ç”¨é…ç½®</title>
      <link href="/posts/8c4ff9d2/"/>
      <url>/posts/8c4ff9d2/</url>
      
        <content type="html"><![CDATA[<p>è¿™é‡Œä»¥ Debian12 ä¸ºä¾‹</p><h2 id="ä¿®æ”¹å›½å†…æº"><a href="#ä¿®æ”¹å›½å†…æº" class="headerlink" title="ä¿®æ”¹å›½å†…æº"></a>ä¿®æ”¹å›½å†…æº</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i <span class="string">&#x27;s@//.*debian.org@//mirrors.ustc.edu.cn@g&#x27;</span> /etc/apt/sources.list</span><br></pre></td></tr></table></figure><h2 id="é…ç½®ç½‘ç»œ"><a href="#é…ç½®ç½‘ç»œ" class="headerlink" title="é…ç½®ç½‘ç»œ"></a>é…ç½®ç½‘ç»œ</h2><p>vim &#x2F;etc&#x2F;network&#x2F;interfaces</p><h3 id="å›ºå®š-ip-é…ç½®"><a href="#å›ºå®š-ip-é…ç½®" class="headerlink" title="å›ºå®š ip é…ç½®"></a>å›ºå®š ip é…ç½®</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">auto enp0s3</span><br><span class="line">iface enp0s3 inet static</span><br><span class="line">    address 192.168.1.240/24</span><br><span class="line">    network 192.168.1.0</span><br><span class="line">    broadcast 192.168.1.255</span><br><span class="line">    gateway 192.168.1.1</span><br><span class="line">    dns-nameservers 8.8.8.8</span><br><span class="line"># å…¶ä¸­ network\broadcast å¯ä»¥çœç•¥ä¸å†™</span><br></pre></td></tr></table></figure><h3 id="DHCP-é…ç½®"><a href="#DHCP-é…ç½®" class="headerlink" title="DHCP é…ç½®"></a>DHCP é…ç½®</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iface enp0s3 inet dhcp</span><br></pre></td></tr></table></figure><h3 id="é‡å¯ç½‘ç»œæœåŠ¡"><a href="#é‡å¯ç½‘ç»œæœåŠ¡" class="headerlink" title="é‡å¯ç½‘ç»œæœåŠ¡"></a>é‡å¯ç½‘ç»œæœåŠ¡</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart networking.service</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ”¹é€ windows terminalæ”¯æŒlrzsz</title>
      <link href="/posts/e48170f8/"/>
      <url>/posts/e48170f8/</url>
      
        <content type="html"><![CDATA[<p>åœ¨ windows ä¸‹ä½¿ç”¨ xshellï¼Œå¦‚æœæ‰§è¡Œ rz æˆ–è€… sz æ˜¯å¯ä»¥å¿«æ·ä¸Šä¼ &#x2F;ä¸‹è½½æ–‡ä»¶åˆ°æœ¬åœ°çš„ï¼Œè¿™åœ¨ä½¿ç”¨å ¡å’æœºç™»å½•æœåŠ¡å™¨ä¼šå¾ˆæœ‰ç”¨ï¼Œæˆ–è€…å¤šå±‚ ssh åµŒå¥—çš„æ—¶å€™ï¼ŒæŸç§æç«¯çš„åœºæ™¯ä¸‹ï¼Œè¿™å¯èƒ½æ˜¯å”¯ä¸€çš„è§£å†³æ–¹æ¡ˆäº†ã€‚åœ¨ windows ä¸‹ä½¿ç”¨ xshell è¿æ¥æœåŠ¡å™¨ï¼Œè¿™æ—¶å€™è¾“å…¥ rzï¼Œä¼šå¼¹å‡ºä¸€ä¸ªæ–‡ä»¶é€‰æ‹©æ¡†ï¼š</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202304122017543.png" alt="xshell æ–‡ä»¶é€‰æ¡†"></p><p>ä½†æ˜¯åœ¨ windows terminal ä¸‹ï¼Œæ˜¯è¿™æ ·çš„ï¼š</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202304122018087.png" alt="Windows Terminalä¹±ç "></p><p>æ— æ„ä¸­å‘ç°äº†ä¸€ä¸ªå¼€æºå·¥å…·ï¼Œå¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¼€æºåœ°å€æ˜¯ï¼š<a href="https://github.com/qingyunha/zssh">https://github.com/qingyunha/zssh</a></p><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><h3 id="é€šè¿‡æºç å®‰è£…"><a href="#é€šè¿‡æºç å®‰è£…" class="headerlink" title="é€šè¿‡æºç å®‰è£…"></a>é€šè¿‡æºç å®‰è£…</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/qingyunha/zssh.git</span><br><span class="line"><span class="built_in">cd</span> zssh</span><br><span class="line">go get zssh</span><br></pre></td></tr></table></figure><p>é»˜è®¤å¯æ‰§è¡Œæ–‡ä»¶æ˜¯åœ¨ GOBIN ä¸­, éœ€è¦æ”¾åˆ°ç³»ç»Ÿçš„ PATH ç›®å½•ä¸­ã€‚</p><h3 id="äºŒè¿›åˆ¶å®‰è£…"><a href="#äºŒè¿›åˆ¶å®‰è£…" class="headerlink" title="äºŒè¿›åˆ¶å®‰è£…"></a>äºŒè¿›åˆ¶å®‰è£…</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo curl -L https://github.com/qingyunha/zssh/releases/download/v0.1.0/zssh_linux_amd64 -o /usr/local/bin/zssh</span><br><span class="line">sudo <span class="built_in">chmod</span> +x /usr/local/bin/zssh</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨æ–¹æ³•ï¼š ä½¿ç”¨ <code>zssh</code> æ›¿ä»£ <code>ssh</code> å‘½ä»¤å³å¯ã€‚</p><p>æ•ˆæœå¦‚ä¸‹ï¼š</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202304131056437.png" alt="rzä¸Šä¼ "></p><p>å¦å¤–è¿˜æœ‰ <a href="https://github.com/trzsz/trzsz">trzsz</a> è¿™æ ·çš„ç±»ä¼¼å¼€æºå·¥å…·ï¼Œéœ€è¦æœåŠ¡å™¨ä¸Šå®‰è£… trzsz è½¯ä»¶</p>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows </tag>
            
            <tag> WSL </tag>
            
            <tag> lrzsz </tag>
            
            <tag> zmodem </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>jenkinsä¼˜é›…çš„å¢åŠ ä¸€ä¸ªwindowsèŠ‚ç‚¹</title>
      <link href="/posts/288e897b/"/>
      <url>/posts/288e897b/</url>
      
        <content type="html"><![CDATA[<h2 id="é…ç½®-windows"><a href="#é…ç½®-windows" class="headerlink" title="é…ç½® windows"></a>é…ç½® windows</h2><p>è¿™é‡Œæˆ‘é€‰æ‹©ä½¿ç”¨ ssh æ¥è¿æ¥ windowsï¼Œè¿™æ ·å¯ä»¥å®Œå…¨ç”± jenkins æ¥ç®¡ç† windows èŠ‚ç‚¹ï¼Œæ¯”å¦‚ agent çš„å¯åŠ¨ä¸åœæ­¢ã€agent çš„æ›´æ–°ç­‰éƒ½ä¸éœ€è¦ç™»å½• windows æ¥æ“ä½œäº†ã€‚</p><h3 id="å®‰è£…-openssh-server"><a href="#å®‰è£…-openssh-server" class="headerlink" title="å®‰è£… openssh server"></a>å®‰è£… openssh server</h3><p><del>è¿™é‡Œé€‰æ‹© moba ssh serverï¼Œ ä¸‹è½½åœ°å€ï¼š<a href="https://mobassh.mobatek.net/download.html">https://mobassh.mobatek.net/download.html</a></del> moba ssh server åŸºäº cygwin å’ŒåŸç”Ÿ windows æœ‰å·®åˆ«ï¼Œç‰¹æ®Šæƒ…å†µä¸‹æ‰§è¡Œç»“æœä¸ä¸€è‡´ï¼Œæˆ‘æ”¾å¼ƒäº†ï¼Œè½¬è€Œä½¿ç”¨åŸç”Ÿ openssh æœåŠ¡</p><p>GitHub åœ°å€ï¼š<a href="https://github.com/PowerShell/Win32-OpenSSH/releases">https://github.com/PowerShell/Win32-OpenSSH/releases</a></p><p>æœ€æ–°ç‰ˆå’Œ jenkins å…¼å®¹æ€§æœ‰äº›é—®é¢˜ï¼Œæˆ‘ç”¨çš„æ˜¯ v8.1.0.0p1-Beta ç‰ˆï¼Œ ä¸‹è½½ OpenSSH-Win64.zip è§£å‹åˆ° windows çš„ <code>C:\Program Files\OpenSSH</code> ç›®å½•ä¸‹ï¼Œç„¶åæ‰§è¡Œ (ç®¡ç†å‘˜æƒé™è¿è¡Œ powershell)</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> <span class="string">&quot;C:\Program Files\OpenSSH&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…sshdæœåŠ¡</span></span><br><span class="line">powershell <span class="literal">-ExecutionPolicy</span> Bypass <span class="operator">-File</span> <span class="built_in">install-sshd</span>.ps1</span><br><span class="line"></span><br><span class="line"><span class="comment"># é˜²ç«å¢™æ‰“å¼€22ç«¯å£</span></span><br><span class="line">netsh advfirewall firewall add rule name=sshd <span class="built_in">dir</span>=<span class="keyword">in</span> action=allow protocol=TCP localport=<span class="number">22</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®å¼€æœºè‡ªå¯åŠ¨</span></span><br><span class="line"><span class="built_in">Set-Service</span> sshd <span class="literal">-StartupType</span> Automatic</span><br><span class="line"><span class="built_in">Set-Service</span> ssh<span class="literal">-agent</span> <span class="literal">-StartupType</span> Automatic</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨æœåŠ¡</span></span><br><span class="line"><span class="built_in">Start-Service</span> sshd</span><br><span class="line"><span class="built_in">Start-Service</span> ssh<span class="literal">-agent</span></span><br></pre></td></tr></table></figure><h3 id="é…ç½®-java-ç¯å¢ƒ"><a href="#é…ç½®-java-ç¯å¢ƒ" class="headerlink" title="é…ç½® java ç¯å¢ƒ"></a>é…ç½® java ç¯å¢ƒ</h3><p>jenkins é»˜è®¤ä¸ä¼šè¯»å–ç¯å¢ƒå˜é‡ï¼Œ æ‰€ä»¥æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨å¤åˆ¶ java çš„æ–‡ä»¶å¤¹åˆ°å·¥ä½œç›®å½•ï¼Œå‡è®¾å·¥ä½œç›®å½•è®¾å®šä¸º <code>C:\jenkins-agent</code>, é‚£ä¹ˆ java è·¯å¾„å°±æ˜¯ <code>C:\jenkins-agent\jdk\bin\java.exe</code></p><h3 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><p>ä½¿ç”¨ jenkins æœºå™¨ï¼ˆä¸»èŠ‚ç‚¹ï¼‰æ‰§è¡Œï¼š<code>ssh user@&lt;windows ip&gt;</code> è¿æ¥æˆåŠŸå³å¯ã€‚</p><h2 id="é…ç½®-jenkins"><a href="#é…ç½®-jenkins" class="headerlink" title="é…ç½® jenkins"></a>é…ç½® jenkins</h2><p>jenkins ç³»ç»Ÿç®¡ç† â€“&gt; èŠ‚ç‚¹ç®¡ç†</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202304111530133.png" alt="é…ç½®ä»èŠ‚ç‚¹"></p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202304111531143.png" alt="æ·»åŠ å‡­æ®"></p><h2 id="æ„å»ºæµæ°´çº¿"><a href="#æ„å»ºæµæ°´çº¿" class="headerlink" title="æ„å»ºæµæ°´çº¿"></a>æ„å»ºæµæ°´çº¿</h2><p>ç¡®è®¤èŠ‚ç‚¹ä¸Šçº¿äº†ã€‚<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202304111546325.png" alt="èŠ‚ç‚¹çŠ¶æ€"></p><p>è¿™é‡Œé™åˆ¶æ„å»ºæ‰€åœ¨çš„èŠ‚ç‚¹<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202304111546102.png" alt="æŒ‡å®šæ„å»ºèŠ‚ç‚¹"></p><p>æ„å»ºè¿‡ç¨‹é€‰æ‹© æ‰§è¡Œ Windows æ‰¹å¤„ç†å‘½ä»¤<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202304111547029.png" alt="æ„å»ºæ­¥éª¤"></p><p>å·²ç»å¯ä»¥æ­£å¸¸æ„å»ºäº†<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202304111728884.png" alt="æ„å»ºè¾“å‡º"></p><h2 id="å¸¸è§é—®é¢˜"><a href="#å¸¸è§é—®é¢˜" class="headerlink" title="å¸¸è§é—®é¢˜"></a>å¸¸è§é—®é¢˜</h2><p>åœ¨ windows é‡Œé¢å¯ä»¥æ­£å¸¸æ‰§è¡Œï¼Œåœ¨ jenkins æç¤ºå‘½ä»¤ä¸å­˜åœ¨ï¼Œ åŸå› æ˜¯ jenkins ä¸ä¼šåŠ è½½ windows è‡ªå¸¦çš„é…ç½®æ–‡ä»¶ï¼Œè§£å†³æ–¹æ³•ï¼š</p><ol><li>ä½¿ç”¨ç»å¯¹è·¯å¾„</li><li>é…ç½® PATH ç¯å¢ƒå˜é‡åˆ° jenkins</li><li>æ‰‹åŠ¨é…ç½®ä½ éœ€è¦çš„å·¥å…·çš„è·¯å¾„</li></ol><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202304111819597.png" alt="å‘½ä»¤ä¸å­˜åœ¨"></p><p>æˆ‘æ›´å–œæ¬¢ç¬¬äºŒç§æ–¹æ³•ï¼š</p><p>åˆ° windows é‡Œé¢ cmd æ‰§è¡Œ path å‘½ä»¤ï¼Œå°† path åé¢çš„å€¼å¤åˆ¶</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202304111821871.png" alt="pathç»“æœ"></p><p>é…ç½®åœ¨ jenkins â€“&gt; èŠ‚ç‚¹åˆ—è¡¨ â€“&gt; ç›¸å…³èŠ‚ç‚¹çš„ç¯å¢ƒå˜é‡ä¸­ã€‚</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202304111822648.png" alt="é…ç½®ç¯å¢ƒå˜é‡"></p>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> jenkins </tag>
            
            <tag> windows </tag>
            
            <tag> agnet </tag>
            
            <tag> cygwin </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iTerm2é…ç½®è®°å½•</title>
      <link href="/posts/ltqmt2r2/"/>
      <url>/posts/ltqmt2r2/</url>
      
        <content type="html"><![CDATA[<h2 id="å¿«æ·é”®"><a href="#å¿«æ·é”®" class="headerlink" title="å¿«æ·é”®"></a>å¿«æ·é”®</h2><p>macOS çš„å¿«æ·é”®å›¾æ ‡è¡¨ç¤º</p><table><thead><tr><th>æ§åˆ¶é”®</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>âŒ˜</td><td>command</td></tr><tr><td>âŒƒ</td><td>control</td></tr><tr><td>âŒ¥</td><td>option</td></tr><tr><td>â‡§</td><td>shift</td></tr></tbody></table><p>å…¶ä¸­ control å¼€å¤´çš„å¿«æ·é”®ä¸æ­¢åœ¨ iTerm2 ä¸­å¯ç”¨ï¼Œåœ¨æ‰€æœ‰ shell ç»ˆç«¯ä¸­éƒ½æ˜¯å¯ç”¨çš„ã€‚</p><h3 id="æ ‡ç­¾ï¼ˆtabï¼‰"><a href="#æ ‡ç­¾ï¼ˆtabï¼‰" class="headerlink" title="æ ‡ç­¾ï¼ˆtabï¼‰"></a>æ ‡ç­¾ï¼ˆtabï¼‰</h3><table><thead><tr><th>åŠŸèƒ½</th><th>å¿«æ·é”®</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>æ–°å»ºæ ‡ç­¾</td><td>command + t</td><td></td></tr><tr><td>å…³é—­æ ‡ç­¾</td><td>command + w</td><td></td></tr><tr><td>åˆ‡æ¢æ ‡ç­¾</td><td>command + â† æˆ– â†’</td><td>å¯ä»¥ç”¨ command + æ•°å­—é”®ï¼Œåˆ‡æ¢åˆ°æŒ‡å®šçš„ tab ä¸Š</td></tr><tr><td>åˆ‡æ¢å…¨å±</td><td>command + enter</td><td>ç­‰åŒäº fn + f, fn + f åœ¨æ‰€æœ‰ macOS è½¯ä»¶ä¸­éƒ½å¯ç”¨</td></tr></tbody></table><h3 id="åˆ†å±"><a href="#åˆ†å±" class="headerlink" title="åˆ†å±"></a>åˆ†å±</h3><table><thead><tr><th>åŠŸèƒ½</th><th>å¿«æ·é”®</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>å‚ç›´åˆ†å±</td><td>command + d</td><td></td></tr><tr><td>æ°´å¹³åˆ†å±</td><td>command + shift + d</td><td></td></tr><tr><td>åˆ‡æ¢åˆ°ä¸åŒçš„åˆ†å±</td><td>command + option + ä¸Šä¸‹å·¦å³</td><td></td></tr><tr><td>åŒæ—¶æ“ä½œæ‰€æœ‰çª—å£</td><td>command + shift + i</td><td>æ“ä½œæ‰“å¼€çš„æ‰€æœ‰ tab å’Œåˆ†å±, åŠŸèƒ½ç”Ÿæ•ˆæ—¶ï¼Œå³ä¸Šè§’æœ‰ä¸ªå›¾æ ‡æç¤º</td></tr></tbody></table><h3 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h3><table><thead><tr><th>åŠŸèƒ½</th><th>å¿«æ·é”®</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>å¿«é€Ÿå®šä½å…‰æ ‡</td><td>option + é¼ æ ‡ç‚¹å‡»</td><td>å¾ˆå¸¸ç”¨çš„åŠŸèƒ½</td></tr><tr><td>æŸ¥æ‰¾</td><td>command + f</td><td></td></tr><tr><td>æ¸…å±</td><td>control + l</td><td></td></tr><tr><td>æœç´¢å‘½ä»¤å†å²</td><td>control + r</td><td></td></tr><tr><td>æ¸…é™¤å½“å‰è¡Œ</td><td>control + u</td><td>æ¸…é™¤å½“å‰è¡Œï¼Œæ— è®ºå…‰æ ‡åœ¨å“ªé‡Œã€‚</td></tr><tr><td>åˆ°è¡Œé¦–</td><td>control + a</td><td></td></tr><tr><td>åˆ°è¡Œå°¾</td><td>control + e</td><td></td></tr></tbody></table><h3 id="ä¸å¸¸ç”¨æˆ–ä¸å»ºè®®ä½¿ç”¨çš„å¿«æ·é”®"><a href="#ä¸å¸¸ç”¨æˆ–ä¸å»ºè®®ä½¿ç”¨çš„å¿«æ·é”®" class="headerlink" title="ä¸å¸¸ç”¨æˆ–ä¸å»ºè®®ä½¿ç”¨çš„å¿«æ·é”®"></a>ä¸å¸¸ç”¨æˆ–ä¸å»ºè®®ä½¿ç”¨çš„å¿«æ·é”®</h3><table><thead><tr><th>åŠŸèƒ½</th><th>å¿«æ·é”®</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>å‰è¿›åé€€</td><td>control + f&#x2F;b</td><td>ç›¸å½“äº â† â†’</td></tr><tr><td>æŸ¥çœ‹å‰ªè´´æ¿å†å²</td><td>command + shift + h</td><td></td></tr><tr><td>ä¸Šä¸€æ¡å‘½ä»¤</td><td>control + p</td><td>ç›¸å½“äºæŒ‰ â†‘</td></tr><tr><td>åˆ é™¤å½“å‰å…‰æ ‡çš„ä¸€ä¸ªå­—ç¬¦</td><td>control + d</td><td>ç­‰åŒäº fn + âŒ« æˆ– DEL é”®</td></tr><tr><td>åˆ é™¤å…‰æ ‡ä¹‹å‰çš„ä¸€ä¸ªå­—ç¬¦</td><td>control + h</td><td>ç­‰åŒäº âŒ«</td></tr><tr><td>åˆ é™¤å…‰æ ‡ä¹‹å‰çš„å•è¯</td><td>control + w</td><td></td></tr><tr><td>åˆ é™¤åˆ°æ–‡æœ¬æœ«å°¾</td><td>control + k</td><td></td></tr></tbody></table><h2 id="å¤‡ä»½è¿˜åŸé…ç½®"><a href="#å¤‡ä»½è¿˜åŸé…ç½®" class="headerlink" title="å¤‡ä»½è¿˜åŸé…ç½®"></a>å¤‡ä»½è¿˜åŸé…ç½®</h2><h3 id="å¤‡ä»½"><a href="#å¤‡ä»½" class="headerlink" title="å¤‡ä»½"></a>å¤‡ä»½</h3><p>åœ¨ Profiles â€“&gt; Other Actions é‡Œé¢ï¼Œå¯¼å‡º json æ–‡ä»¶å¤‡ä»½</p><h3 id="è¿˜åŸ"><a href="#è¿˜åŸ" class="headerlink" title="è¿˜åŸ"></a>è¿˜åŸ</h3><p>åŒæ ·çš„ä½ç½® import jsonï¼Œ æˆ–è€…æ”¾åˆ° <code>~/Library/Application Support/iTerm2/DynamicProfiles</code></p>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•ˆç‡å·¥å…· </tag>
            
            <tag> å¸¸ç”¨æ“ä½œ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ingress Nginx é…ç½®sslåŒå‘è®¤è¯</title>
      <link href="/posts/lefqq7f4/"/>
      <url>/posts/lefqq7f4/</url>
      
        <content type="html"><![CDATA[<p>è®°å½•ä¸€ä¸‹åœ¨ kuberentes ä¸‹ä½¿ç”¨ ingress-nginx æ¥é…ç½® ssl åŒå‘è®¤è¯ï¼Œå¯ä»¥å‚è€ƒå…¶ä»–å‡ ç¯‡æ–‡ç« ï¼š<br><a href="/posts/28c679c3">ä½¿ç”¨certbotè‡ªåŠ¨ç”³è¯·sslè¯ä¹¦</a></p><p><a href="/posts/1e777b9e">ä½¿ç”¨acme.shæ¥è‡ªåŠ¨æ›´æ–°httpsè¯ä¹¦</a></p><p><a href="/posts/097e5b7c">åˆ¶ä½œå’Œä½¿ç”¨è‡ªç­¾åè¯ä¹¦</a></p><p><a href="/posts/b78a00fa">Nginxé…ç½®SSLåŒå‘è®¤è¯</a></p><h2 id="åˆ›å»º-CA-è¯ä¹¦"><a href="#åˆ›å»º-CA-è¯ä¹¦" class="headerlink" title="åˆ›å»º CA è¯ä¹¦"></a>åˆ›å»º CA è¯ä¹¦</h2><p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œåˆ›å»ºè‡ªç­¾çš„ CA è¯ä¹¦ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl req -x509 -sha256 -newkey rsa:4096 -keyout ca.key -out ca.crt -days 3650 -nodes -subj <span class="string">&#x27;/CN=Fern Cert Authority&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="ç”Ÿæˆ-server-è¯ä¹¦"><a href="#ç”Ÿæˆ-server-è¯ä¹¦" class="headerlink" title="ç”Ÿæˆ server è¯ä¹¦"></a>ç”Ÿæˆ server è¯ä¹¦</h2><blockquote><p>è¿™é‡Œå¯ä»¥ä½¿ç”¨å…¬å…±çš„ CA ç­¾å‘çš„è¯ä¹¦ï¼Œ æ¯”å¦‚å„å¤§äº‘æœåŠ¡å•†è´­ä¹°çš„è¯ä¹¦ã€‚ä¸‹é¢æ˜¯è‡ªç­¾è¯ä¹¦çš„æ­¥éª¤ã€‚</p></blockquote><h3 id="ç”Ÿæˆ-Server-ç«¯è¯ä¹¦çš„è¯·æ±‚æ–‡ä»¶"><a href="#ç”Ÿæˆ-Server-ç«¯è¯ä¹¦çš„è¯·æ±‚æ–‡ä»¶" class="headerlink" title="ç”Ÿæˆ Server ç«¯è¯ä¹¦çš„è¯·æ±‚æ–‡ä»¶"></a>ç”Ÿæˆ Server ç«¯è¯ä¹¦çš„è¯·æ±‚æ–‡ä»¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl req -new -newkey rsa:4096 -keyout server.key -out server.csr -nodes -subj <span class="string">&#x27;/CN=foo.bar.com&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨æ ¹è¯ä¹¦ç­¾å‘-Server-ç«¯è¯·æ±‚æ–‡ä»¶ï¼Œç”Ÿæˆ-Server-ç«¯è¯ä¹¦"><a href="#ä½¿ç”¨æ ¹è¯ä¹¦ç­¾å‘-Server-ç«¯è¯·æ±‚æ–‡ä»¶ï¼Œç”Ÿæˆ-Server-ç«¯è¯ä¹¦" class="headerlink" title="ä½¿ç”¨æ ¹è¯ä¹¦ç­¾å‘ Server ç«¯è¯·æ±‚æ–‡ä»¶ï¼Œç”Ÿæˆ Server ç«¯è¯ä¹¦"></a>ä½¿ç”¨æ ¹è¯ä¹¦ç­¾å‘ Server ç«¯è¯·æ±‚æ–‡ä»¶ï¼Œç”Ÿæˆ Server ç«¯è¯ä¹¦</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -req -sha256 -days 365 -<span class="keyword">in</span> server.csr -CA ca.crt -CAkey ca.key -set_serial 01 -out server.crt</span><br></pre></td></tr></table></figure><h3 id="é…ç½®åˆ°-ingress-é‡Œ"><a href="#é…ç½®åˆ°-ingress-é‡Œ" class="headerlink" title="é…ç½®åˆ° ingress é‡Œ"></a>é…ç½®åˆ° ingress é‡Œ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create secret tls foo-bar-com --cert=server.crt --key=server.key</span><br></pre></td></tr></table></figure><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-test</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">foo.bar.com</span></span><br><span class="line">    <span class="attr">http:</span></span><br><span class="line">      <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">serviceName:</span> <span class="string">http-svc</span></span><br><span class="line">          <span class="attr">servicePort:</span> <span class="number">80</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">/</span></span><br><span class="line">  <span class="attr">tls:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">hosts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">foo.bar.com</span></span><br><span class="line">    <span class="attr">secretName:</span> <span class="string">tls-secret</span></span><br></pre></td></tr></table></figure><h2 id="ç”Ÿæˆ-client-è¯ä¹¦"><a href="#ç”Ÿæˆ-client-è¯ä¹¦" class="headerlink" title="ç”Ÿæˆ client è¯ä¹¦"></a>ç”Ÿæˆ client è¯ä¹¦</h2><h3 id="ç”Ÿæˆ-Client-ç«¯è¯ä¹¦çš„è¯·æ±‚æ–‡ä»¶"><a href="#ç”Ÿæˆ-Client-ç«¯è¯ä¹¦çš„è¯·æ±‚æ–‡ä»¶" class="headerlink" title="ç”Ÿæˆ Client ç«¯è¯ä¹¦çš„è¯·æ±‚æ–‡ä»¶"></a>ç”Ÿæˆ Client ç«¯è¯ä¹¦çš„è¯·æ±‚æ–‡ä»¶</h3><blockquote><p>åŒå‘è®¤è¯ä¸€èˆ¬éƒ½æ˜¯åˆ«äººä½¿ç”¨è‡ªå·±çš„ key ç”Ÿæˆ csr ç»™åˆ°æˆ‘ä»¬ï¼Œ ç„¶åæˆ‘ä»¬ç”¨ CA ç­¾åè¯ä¹¦ï¼Œç„¶åå°†ç­¾ååçš„è¯ä¹¦ç»™åˆ°åˆ«äººï¼Œåç»­åˆ«äººä½¿ç”¨è¯ä¹¦å’Œè‡ªå·±çš„ç§é’¥å°±å¯ä»¥è®¿é—®æœåŠ¡ã€‚</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl req -new -newkey rsa:4096 -keyout client.key -out client.csr -nodes -subj <span class="string">&#x27;/CN=Fern&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="ç”Ÿæˆ-client-ç«¯è¯ä¹¦"><a href="#ç”Ÿæˆ-client-ç«¯è¯ä¹¦" class="headerlink" title="ç”Ÿæˆ client ç«¯è¯ä¹¦"></a>ç”Ÿæˆ client ç«¯è¯ä¹¦</h3><p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œä½¿ç”¨æ ¹è¯ä¹¦ç­¾å‘ Client ç«¯è¯·æ±‚æ–‡ä»¶ï¼Œç”Ÿæˆ Client ç«¯è¯ä¹¦ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -req -sha256 -days 365 -<span class="keyword">in</span> client.csr -CA ca.crt -CAkey ca.key -set_serial 02 -out client.crt </span><br></pre></td></tr></table></figure><h3 id="é…ç½®åŒå‘è®¤è¯"><a href="#é…ç½®åŒå‘è®¤è¯" class="headerlink" title="é…ç½®åŒå‘è®¤è¯"></a>é…ç½®åŒå‘è®¤è¯</h3><p>åˆ›å»º secret</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create secret generic ca-secret --from-file=ca.crt=ca.crt</span><br></pre></td></tr></table></figure><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/auth-tls-verify-client:</span> <span class="string">&quot;on&quot;</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/auth-tls-secret:</span> <span class="string">&quot;default/ca-secret&quot;</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/auth-tls-verify-depth:</span> <span class="string">&quot;1&quot;</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/auth-tls-pass-certificate-to-upstream:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-test</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">foo.bar.com</span></span><br><span class="line">    <span class="attr">http:</span></span><br><span class="line">      <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">serviceName:</span> <span class="string">http-svc</span></span><br><span class="line">          <span class="attr">servicePort:</span> <span class="number">80</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">/</span></span><br><span class="line">  <span class="attr">tls:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">hosts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">foo.bar.com</span></span><br><span class="line">    <span class="attr">secretName:</span> <span class="string">tls-secret</span></span><br></pre></td></tr></table></figure><h2 id="æµ‹è¯•è®¿é—®"><a href="#æµ‹è¯•è®¿é—®" class="headerlink" title="æµ‹è¯•è®¿é—®"></a>æµ‹è¯•è®¿é—®</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è‡ªç­¾serverè¯ä¹¦ä¹Ÿå¯ä»¥å¢åŠ  --cacert ca.crt å‚æ•°æŒ‡å®šcaè¯ä¹¦ï¼Œå®¢æˆ·ç«¯ä¹Ÿæ˜¯ä¿¡ä»»çš„</span></span><br><span class="line">curl --cert ./client.crt --key ./client.key https://foo.bar.com/actuator/info -k</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å®¹å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nginx </tag>
            
            <tag> Ingress </tag>
            
            <tag> ssl </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Kubernetesåˆ›å»ºä¸€ä¸ªåªè¯»ç”¨æˆ·</title>
      <link href="/posts/lefa6qhl/"/>
      <url>/posts/lefa6qhl/</url>
      
        <content type="html"><![CDATA[<p>å…¶å®ç”¨åˆ°çš„æ˜¯ RBAC æˆæƒï¼Œå®˜æ–¹æ–‡æ¡£åœ¨ï¼š<a href="https://kubernetes.io/zh-cn/docs/reference/access-authn-authz/rbac/">https://kubernetes.io/zh-cn/docs/reference/access-authn-authz/rbac/</a></p><h2 id="ç”Ÿæˆè¯ä¹¦"><a href="#ç”Ÿæˆè¯ä¹¦" class="headerlink" title="ç”Ÿæˆè¯ä¹¦"></a>ç”Ÿæˆè¯ä¹¦</h2><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># ç”Ÿæˆç§é’¥</span><br><span class="line">openssl genrsa -out dev.key <span class="number">2048</span></span><br><span class="line"></span><br><span class="line"># åŸºäºè¿™ä¸ªç§é’¥ç”Ÿæˆè¯ä¹¦è¯·æ±‚</span><br><span class="line">openssl req -<span class="keyword">new</span> -key dev.key -out dev.csr -subj <span class="string">&quot;/CN=dev&quot;</span></span><br><span class="line"></span><br><span class="line"># ä½¿ç”¨CAè¯ä¹¦ç­¾å‘</span><br><span class="line">openssl  x509 -req -in dev.csr -CA /etc/kubernetes/pki/<span class="keyword">ca</span>.crt -CAkey /etc/kubernetes/pki/<span class="keyword">ca</span>.key -CAcreateserial -out dev.crt -days <span class="number">3000</span></span><br></pre></td></tr></table></figure><h2 id="é€šè¿‡è¯ä¹¦ç”Ÿæˆ-kubeconfig-é…ç½®æ–‡ä»¶"><a href="#é€šè¿‡è¯ä¹¦ç”Ÿæˆ-kubeconfig-é…ç½®æ–‡ä»¶" class="headerlink" title="é€šè¿‡è¯ä¹¦ç”Ÿæˆ kubeconfig é…ç½®æ–‡ä»¶"></a>é€šè¿‡è¯ä¹¦ç”Ÿæˆ kubeconfig é…ç½®æ–‡ä»¶</h2><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"># ç”Ÿæˆç”¨æˆ·kubeconfig</span><br><span class="line">kubectl config <span class="keyword">set</span>-cluster  kubernetes \</span><br><span class="line">  --kubeconfig=dev.<span class="keyword">conf</span> \</span><br><span class="line">  --server=<span class="string">&quot;https://10.0.0.3:6443&quot;</span> \</span><br><span class="line">  --certificate-authority=/etc/kubernetes/pki/<span class="keyword">ca</span>.crt \</span><br><span class="line">  --embed-certs=true</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># users è®¾ç½®ç”¨æˆ·ä¿¡æ¯</span><br><span class="line">kubectl config <span class="keyword">set</span>-credentials dev \</span><br><span class="line">    --certificate-authority=/etc/kubernetes/pki/<span class="keyword">ca</span>.crt \</span><br><span class="line">    --embed-certs=true \</span><br><span class="line">    --client-key=dev.key \</span><br><span class="line">    --client-certificate=dev.crt \</span><br><span class="line">    --kubeconfig=dev.<span class="keyword">conf</span></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">#  æ ¹æ® config åˆ›å»º  contexts  </span><br><span class="line">kubectl config <span class="keyword">set</span>-context dev \</span><br><span class="line">    --cluster=kubernetes \</span><br><span class="line">    --user=dev \</span><br><span class="line">    --kubeconfig=dev.<span class="keyword">conf</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># è®¾ç½®å½“å‰çš„ä¸Šä¸‹æ–‡ -- æ›´æ”¹ç”¨æˆ·</span><br><span class="line">kubectl config use-context dev --kubeconfig=dev.<span class="keyword">conf</span></span><br></pre></td></tr></table></figure><h2 id="åˆ›å»º-clusterrole-å’Œ-clusterrolebinding"><a href="#åˆ›å»º-clusterrole-å’Œ-clusterrolebinding" class="headerlink" title="åˆ›å»º clusterrole å’Œ clusterrolebinding"></a>åˆ›å»º clusterrole å’Œ clusterrolebinding</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æä¾›åŸºæœ¬æƒé™</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">cluster-dev-readonly</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">dev-readonly</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">User</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">dev</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">dev-readonly</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;metrics.k8s.io&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span> [<span class="string">&quot;pods&quot;</span>, <span class="string">&quot;nodes&quot;</span>]</span><br><span class="line">    <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;watch&quot;</span>, <span class="string">&quot;list&quot;</span>]</span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span> [<span class="string">&quot;nodes&quot;</span>]</span><br><span class="line">    <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;watch&quot;</span>, <span class="string">&quot;list&quot;</span>]</span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span> [<span class="string">&quot;pods&quot;</span>, <span class="string">&quot;pods/exec&quot;</span>]</span><br><span class="line">    <span class="attr">verbs:</span> [<span class="string">&quot;create&quot;</span>, <span class="string">&quot;get&quot;</span>, <span class="string">&quot;list&quot;</span>, <span class="string">&quot;watch&quot;</span>]</span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span> [<span class="string">&quot;pods&quot;</span>]</span><br><span class="line">    <span class="attr">verbs:</span> [<span class="string">&quot;delete&quot;</span>]</span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span> [<span class="string">&quot;configmaps&quot;</span>]</span><br><span class="line">    <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;list&quot;</span>, <span class="string">&quot;watch&quot;</span>]</span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span> [<span class="string">&quot;endpoints&quot;</span>, <span class="string">&quot;services&quot;</span>]</span><br><span class="line">    <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;watch&quot;</span>, <span class="string">&quot;list&quot;</span>]</span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      [</span><br><span class="line">        <span class="string">&quot;resourcequotas/status&quot;</span>,</span><br><span class="line">        <span class="string">&quot;resourcequotas&quot;</span>,</span><br><span class="line">        <span class="string">&quot;bindings&quot;</span>,</span><br><span class="line">        <span class="string">&quot;events&quot;</span>,</span><br><span class="line">        <span class="string">&quot;limitranges&quot;</span>,</span><br><span class="line">        <span class="string">&quot;namespaces/status&quot;</span>,</span><br><span class="line">        <span class="string">&quot;pods/log&quot;</span>,</span><br><span class="line">        <span class="string">&quot;pods/status&quot;</span>,</span><br><span class="line">        <span class="string">&quot;replicationcontrollers/status&quot;</span>,</span><br><span class="line">      ]</span><br><span class="line">    <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;watch&quot;</span>, <span class="string">&quot;list&quot;</span>]</span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span> [<span class="string">&quot;namespaces&quot;</span>]</span><br><span class="line">    <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;watch&quot;</span>, <span class="string">&quot;list&quot;</span>]</span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;apps&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      [</span><br><span class="line">        <span class="string">&quot;deployments&quot;</span>,</span><br><span class="line">        <span class="string">&quot;deployments/rollback&quot;</span>,</span><br><span class="line">        <span class="string">&quot;deployments/scale&quot;</span>,</span><br><span class="line">        <span class="string">&quot;deployments/rollout&quot;</span>,</span><br><span class="line">        <span class="string">&quot;statefulsets&quot;</span>,</span><br><span class="line">      ]</span><br><span class="line">    <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;watch&quot;</span>, <span class="string">&quot;list&quot;</span>,<span class="string">&quot;patch&quot;</span>]</span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;autoscaling&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span> [<span class="string">&quot;horizontalpodautoscalers&quot;</span>]</span><br><span class="line">    <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;watch&quot;</span>, <span class="string">&quot;list&quot;</span>]</span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;batch&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span> [<span class="string">&quot;cronjobs&quot;</span>, <span class="string">&quot;jobs&quot;</span>, <span class="string">&quot;scheduledjobs&quot;</span>]</span><br><span class="line">    <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;watch&quot;</span>, <span class="string">&quot;list&quot;</span>]</span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;extensions&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span> [<span class="string">&quot;daemonsets&quot;</span>, <span class="string">&quot;deployments&quot;</span>, <span class="string">&quot;ingresses&quot;</span>, <span class="string">&quot;replicasets&quot;</span>]</span><br><span class="line">    <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;watch&quot;</span>, <span class="string">&quot;list&quot;</span>]</span><br></pre></td></tr></table></figure><h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl --kubeconfig=./dev.conf get pod</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å®¹å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> k8s </tag>
            
            <tag> æƒé™ç®¡ç† </tag>
            
            <tag> RBAC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨image-synceræ¥å®ç°å®¹å™¨é•œåƒåŒæ­¥</title>
      <link href="/posts/le5lzctq/"/>
      <url>/posts/le5lzctq/</url>
      
        <content type="html"><![CDATA[<p><code>image-syncer</code> æ˜¯ä¸€ä¸ª docker é•œåƒåŒæ­¥å·¥å…·ï¼Œå¯ç”¨æ¥è¿›è¡Œå¤šå¯¹å¤šçš„é•œåƒä»“åº“åŒæ­¥ï¼Œæ”¯æŒç›®å‰ç»å¤§å¤šæ•°ä¸»æµçš„ docker é•œåƒä»“åº“æœåŠ¡</p><ul><li>æ”¯æŒå¤šå¯¹å¤šé•œåƒä»“åº“åŒæ­¥</li><li>æ”¯æŒåŸºäº Docker Registry V2 æ­å»ºçš„ docker é•œåƒä»“åº“æœåŠ¡ (å¦‚ Docker Hubã€ Quayã€ é˜¿é‡Œäº‘é•œåƒæœåŠ¡ ACRã€ Harbor ç­‰)</li><li>åŒæ­¥åªç»è¿‡å†…å­˜å’Œç½‘ç»œï¼Œä¸ä¾èµ–ç£ç›˜å­˜å‚¨ï¼ŒåŒæ­¥é€Ÿåº¦å¿«</li><li>å¢é‡åŒæ­¥, é€šè¿‡å¯¹åŒæ­¥è¿‡çš„é•œåƒ blob ä¿¡æ¯è½ç›˜ï¼Œä¸é‡å¤åŒæ­¥å·²åŒæ­¥çš„é•œåƒ</li><li>å¹¶å‘åŒæ­¥ï¼Œå¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶è°ƒæ•´å¹¶å‘æ•°</li><li>è‡ªåŠ¨é‡è¯•å¤±è´¥çš„åŒæ­¥ä»»åŠ¡ï¼Œå¯ä»¥è§£å†³å¤§éƒ¨åˆ†é•œåƒåŒæ­¥ä¸­çš„ç½‘ç»œæŠ–åŠ¨é—®é¢˜</li><li>ä¸ä¾èµ– docker ä»¥åŠå…¶ä»–ç¨‹åº</li></ul><p>image-syncer çš„å®˜æ–¹åœ°å€æ˜¯ï¼š<a href="https://github.com/AliyunContainerService/image-syncer">https://github.com/AliyunContainerService/image-syncer</a>, æ˜¯ golang å¼€å‘çš„ï¼Œ å®˜æ–¹æ²¡æœ‰ç»™æ‰“åŒ…æˆ windows ç‰ˆï¼Œ æ‰€ä»¥ windows å’Œ mac ç”¨æˆ·éœ€è¦è‡ªå·±ç¼–è¯‘ä¸€ä¸‹ã€‚</p><h2 id="ç¼–è¯‘"><a href="#ç¼–è¯‘" class="headerlink" title="ç¼–è¯‘"></a>ç¼–è¯‘</h2><h3 id="å®‰è£…-golang-ç¯å¢ƒ"><a href="#å®‰è£…-golang-ç¯å¢ƒ" class="headerlink" title="å®‰è£… golang ç¯å¢ƒ"></a>å®‰è£… golang ç¯å¢ƒ</h3><p>ç•¥</p><h3 id="å¼€å§‹æ„å»º"><a href="#å¼€å§‹æ„å»º" class="headerlink" title="å¼€å§‹æ„å»º"></a>å¼€å§‹æ„å»º</h3><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go build main.go</span><br></pre></td></tr></table></figure><p>ä¼šåœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆ main.exe, é‡å‘½åä¸º image-syncer.exe</p><h2 id="ä½¿ç”¨æ–¹æ³•"><a href="#ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h2><p>ç”±äºæˆ‘ä»¬éœ€æ±‚æ˜¯è¿›è¡Œå•é•œåƒåŒæ­¥ï¼Œæ‰€ä»¥ç”¨ä¸åˆ° image-syncer çš„ä»“åº“åŒæ­¥åŠŸèƒ½ï¼Œä»“åº“åŒæ­¥é…ç½®æ³¨é‡Šåœ¨äº†é…ç½®æ–‡ä»¶ä¸­ã€‚</p><h3 id="è´¦å·å¯†ç é…ç½®ï¼š-auth-json"><a href="#è´¦å·å¯†ç é…ç½®ï¼š-auth-json" class="headerlink" title="è´¦å·å¯†ç é…ç½®ï¼š auth.json"></a>è´¦å·å¯†ç é…ç½®ï¼š auth.json</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;registry.cn-hangzhou.aliyuncs.com&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;dk&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;password&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xxxxxxxx&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;insecure&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;registry.k8s.io&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;admin&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;password&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xxxxxxxx&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;insecure&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><ul><li>ä»“åº“åæ”¯æŒ â€œregistryâ€ å’Œ â€œregistry&#x2F;namespaceâ€ï¼ˆv1.0.3 ä¹‹åçš„ç‰ˆæœ¬ï¼‰ çš„å½¢å¼ï¼Œéœ€è¦è·Ÿä¸‹é¢ images ä¸­çš„ registry(registry&#x2F;namespace) å¯¹åº” ,images ä¸­è¢«åŒ¹é…åˆ°çš„çš„ url ä¼šä½¿ç”¨å¯¹åº”è´¦å·å¯†ç è¿›è¡Œé•œåƒåŒæ­¥, ä¼˜å…ˆåŒ¹é… â€œregistry&#x2F;namespaceâ€ çš„å½¢å¼</li><li>â€œusernameâ€: â€œxxxâ€, &#x2F;&#x2F; ç”¨æˆ·åï¼Œå¯é€‰ï¼Œï¼ˆv1.3.1 ä¹‹åæ”¯æŒï¼‰valuse ä½¿ç”¨ â€œ<code>$&#123;env&#125;</code>â€œ æˆ–è€… â€œ$envâ€ ç±»å‹çš„å­—ç¬¦ä¸²å¯ä»¥å¼•ç”¨ç¯å¢ƒå˜é‡</li><li>â€œpasswordâ€: â€œxxxxxxxxxâ€, &#x2F;&#x2F; å¯†ç ï¼Œå¯é€‰ï¼Œï¼ˆv1.3.1 ä¹‹åæ”¯æŒï¼‰valuse ä½¿ç”¨ â€œ${env}â€ æˆ–è€… â€œ$envâ€ ç±»å‹çš„å­—ç¬¦ä¸²å¯ä»¥å¼•ç”¨ç¯å¢ƒå˜é‡</li><li>â€œinsecureâ€: true &#x2F;&#x2F; registry æ˜¯å¦æ˜¯ http æœåŠ¡ï¼Œå¦‚æœæ˜¯ï¼Œinsecure å­—æ®µéœ€è¦ä¸º trueï¼Œé»˜è®¤æ˜¯ falseï¼Œå¯é€‰ï¼Œæ”¯æŒè¿™ä¸ªé€‰é¡¹éœ€è¦ image-syncer ç‰ˆæœ¬ &gt; v1.0.1</li></ul><h3 id="é•œåƒé…ç½®-image-json"><a href="#é•œåƒé…ç½®-image-json" class="headerlink" title="é•œåƒé…ç½® image.json"></a>é•œåƒé…ç½® image.json</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;registry.k8s.io/pause:3.9&quot;</span><span class="punctuation">:</span><span class="string">&quot;registry.cn-hangzhou.aliyuncs.com/iuxt/pause&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">åŒæ­¥é•œåƒè§„åˆ™å­—æ®µï¼Œå…¶ä¸­æ¡è§„åˆ™åŒ…æ‹¬ä¸€ä¸ªæºä»“åº“ï¼ˆé”®ï¼‰å’Œä¸€ä¸ªç›®æ ‡ä»“åº“ï¼ˆå€¼ï¼‰</span><br><span class="line">åŒæ­¥çš„æœ€å¤§å•ä½æ˜¯ä»“åº“ï¼ˆrepoï¼‰ï¼Œä¸æ”¯æŒé€šè¿‡ä¸€æ¡è§„åˆ™åŒæ­¥æ•´ä¸ªnamespaceä»¥åŠregistry</span><br><span class="line">æºä»“åº“å’Œç›®æ ‡ä»“åº“çš„æ ¼å¼ä¸docker pull/pushå‘½ä»¤ä½¿ç”¨çš„é•œåƒurlç±»ä¼¼ï¼ˆregistry/namespace/repository:tagï¼‰</span><br><span class="line">æºä»“åº“å’Œç›®æ ‡ä»“åº“ï¼ˆå¦‚æœç›®æ ‡ä»“åº“ä¸ä¸ºç©ºå­—ç¬¦ä¸²ï¼‰éƒ½è‡³å°‘åŒ…å«registry/namespace/repository</span><br><span class="line">æºä»“åº“å­—æ®µä¸èƒ½ä¸ºç©ºï¼Œå¦‚æœéœ€è¦å°†ä¸€ä¸ªæºä»“åº“åŒæ­¥åˆ°å¤šä¸ªç›®æ ‡ä»“åº“éœ€è¦é…ç½®å¤šæ¡è§„åˆ™</span><br><span class="line">ç›®æ ‡ä»“åº“åå¯ä»¥å’Œæºä»“åº“åä¸åŒï¼ˆtagä¹Ÿå¯ä»¥ä¸åŒï¼‰ï¼Œæ­¤æ—¶åŒæ­¥åŠŸèƒ½ç±»ä¼¼äºï¼šdocker pull + docker tag + docker push</span><br><span class="line"></span><br><span class="line">&quot;quay.io/coreos/kube-rbac-proxy&quot;: &quot;quay.io/ruohe/kube-rbac-proxy&quot;,</span><br><span class="line">&quot;xxxx&quot;:&quot;xxxxx&quot;,</span><br><span class="line">&quot;xxx/xxx/xx:tag1,tag2,tag3&quot;:&quot;xxx/xxx/xx&quot;</span><br><span class="line"></span><br><span class="line">å½“æºä»“åº“å­—æ®µä¸­ä¸åŒ…å«tagæ—¶ï¼Œè¡¨ç¤ºå°†è¯¥ä»“åº“æ‰€æœ‰tagåŒæ­¥åˆ°ç›®æ ‡ä»“åº“ï¼Œæ­¤æ—¶ç›®æ ‡ä»“åº“ä¸èƒ½åŒ…å«tag</span><br><span class="line">å½“æºä»“åº“å­—æ®µä¸­åŒ…å«tagæ—¶ï¼Œè¡¨ç¤ºåªåŒæ­¥æºä»“åº“ä¸­çš„ä¸€ä¸ªtagåˆ°ç›®æ ‡ä»“åº“ï¼Œå¦‚æœç›®æ ‡ä»“åº“ä¸­ä¸åŒ…å«tagï¼Œåˆ™é»˜è®¤ä½¿ç”¨æºtag</span><br><span class="line">æºä»“åº“å­—æ®µä¸­çš„tagå¯ä»¥åŒæ—¶åŒ…å«å¤šä¸ªï¼ˆæ¯”å¦‚&quot;a/b/c:1,2,3&quot;ï¼‰ï¼Œtagä¹‹é—´é€šè¿‡&quot;,&quot;éš”å¼€ï¼Œæ­¤æ—¶ç›®æ ‡ä»“åº“ä¸èƒ½åŒ…å«tagï¼Œå¹¶ä¸”é»˜è®¤ä½¿ç”¨åŸæ¥çš„tag</span><br><span class="line">å½“ç›®æ ‡ä»“åº“ä¸ºç©ºå­—ç¬¦ä¸²æ—¶ï¼Œä¼šå°†æºé•œåƒåŒæ­¥åˆ°é»˜è®¤registryçš„é»˜è®¤namespaceä¸‹ï¼Œå¹¶ä¸”repoä»¥åŠtagä¸æºä»“åº“ç›¸åŒï¼Œé»˜è®¤registryå’Œé»˜è®¤namespaceå¯ä»¥é€šè¿‡å‘½ä»¤è¡Œå‚æ•°ä»¥åŠç¯å¢ƒå˜é‡é…ç½®ï¼Œå‚è€ƒä¸‹é¢çš„æè¿°</span><br></pre></td></tr></table></figure><h3 id="åŒæ­¥å‘½ä»¤"><a href="#åŒæ­¥å‘½ä»¤" class="headerlink" title="åŒæ­¥å‘½ä»¤"></a>åŒæ­¥å‘½ä»¤</h3><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">image-syncer.exe --proc=<span class="number">6</span> --auth=auth.json --images=image.json --retries=<span class="number">3</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å®¹å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é•œåƒ </tag>
            
            <tag> å®¹å™¨ </tag>
            
            <tag> åŒæ­¥ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>shellè„šæœ¬æ¡ä»¶åˆ¤æ–­ä¸æ¯”è¾ƒè¿ç®—</title>
      <link href="/posts/le2ugemu/"/>
      <url>/posts/le2ugemu/</url>
      
        <content type="html"><![CDATA[<h2 id="if-çš„åŸºæœ¬è¯­æ³•"><a href="#if-çš„åŸºæœ¬è¯­æ³•" class="headerlink" title="if çš„åŸºæœ¬è¯­æ³•:"></a>if çš„åŸºæœ¬è¯­æ³•:</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> [ -f /tmp ];<span class="keyword">then</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;æ˜¯ä¸€ä¸ªæ™®é€šæ–‡ä»¶&quot;</span></span><br><span class="line"><span class="keyword">elif</span> [ -d /tmp ];<span class="keyword">then</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;æ˜¯ä¸€ä¸ªç›®å½•&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;å…¶ä»–ç±»å‹&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><h2 id="æ–‡ä»¶-ç›®å½•-åˆ¤æ–­"><a href="#æ–‡ä»¶-ç›®å½•-åˆ¤æ–­" class="headerlink" title="æ–‡ä»¶&#x2F;ç›®å½• åˆ¤æ–­"></a>æ–‡ä»¶&#x2F;ç›®å½• åˆ¤æ–­</h2><p>å¸¸ç”¨çš„</p><table><thead><tr><th>è¿ç®—ç¬¦</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>-d</td><td>æµ‹è¯•æ–‡ä»¶æ˜¯å¦ä¸ºç›®å½•</td></tr><tr><td>-e</td><td>æµ‹è¯•æ–‡ä»¶æ˜¯å¦å­˜åœ¨</td></tr><tr><td>-f</td><td>åˆ¤æ–­æ˜¯å¦ä¸ºä¸€èˆ¬æ–‡ä»¶</td></tr><tr><td>-r</td><td>æµ‹è¯•å½“å‰ç”¨æˆ·æ˜¯å¦æœ‰æƒé™è¯»å–</td></tr><tr><td>-w</td><td>æµ‹è¯•å½“å‰ç”¨æˆ·æ˜¯å¦æœ‰æƒé™å†™å…¥</td></tr><tr><td>-x</td><td>æµ‹è¯•å½“å‰ç”¨æˆ·æ˜¯å¦æœ‰æƒé™æ‰§è¡Œ</td></tr><tr><td>-s</td><td>æ–‡ä»¶é•¿åº¦ä¸ä¸ºé›¶</td></tr></tbody></table><table><thead><tr><th>é€‰é¡¹</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>[ -b FILE ]</td><td>å¦‚æœ FILE å­˜åœ¨ä¸”æ˜¯ä¸€ä¸ªå—ç‰¹æ®Šæ–‡ä»¶åˆ™ä¸ºçœŸã€‚</td></tr><tr><td>[ -c FILE ]</td><td>å¦‚æœ FILE å­˜åœ¨ä¸”æ˜¯ä¸€ä¸ªå­—ç‰¹æ®Šæ–‡ä»¶åˆ™ä¸ºçœŸã€‚</td></tr><tr><td>[ -d DIR ]</td><td>å¦‚æœ FILE å­˜åœ¨ä¸”æ˜¯ä¸€ä¸ªç›®å½•åˆ™ä¸ºçœŸã€‚</td></tr><tr><td>[ -e FILE ]</td><td>å¦‚æœ FILE å­˜åœ¨åˆ™ä¸ºçœŸã€‚</td></tr><tr><td>[ -f FILE ]</td><td>å¦‚æœ FILE å­˜åœ¨ä¸”æ˜¯ä¸€ä¸ªæ™®é€šæ–‡ä»¶åˆ™ä¸ºçœŸã€‚</td></tr><tr><td>[ -g FILE ]</td><td>å¦‚æœ FILE å­˜åœ¨ä¸”å·²ç»è®¾ç½®äº† SGID åˆ™ä¸ºçœŸã€‚</td></tr><tr><td>[ -k FILE ]</td><td>å¦‚æœ FILE å­˜åœ¨ä¸”å·²ç»è®¾ç½®äº†ç²˜åˆ¶ä½åˆ™ä¸ºçœŸã€‚</td></tr><tr><td>[ -p FILE ]</td><td>å¦‚æœ FILE å­˜åœ¨ä¸”æ˜¯ä¸€ä¸ªåå­—ç®¡é“ (F å¦‚æœ O) åˆ™ä¸ºçœŸã€‚</td></tr><tr><td>[ -r FILE ]</td><td>å¦‚æœ FILE å­˜åœ¨ä¸”æ˜¯å¯è¯»çš„åˆ™ä¸ºçœŸã€‚</td></tr><tr><td>[ -s FILE ]</td><td>å¦‚æœ FILE å­˜åœ¨ä¸”å¤§å°ä¸ä¸º 0 åˆ™ä¸ºçœŸã€‚</td></tr><tr><td>[ -t FD ]</td><td>å¦‚æœæ–‡ä»¶æè¿°ç¬¦ FD æ‰“å¼€ä¸”æŒ‡å‘ä¸€ä¸ªç»ˆç«¯åˆ™ä¸ºçœŸã€‚</td></tr><tr><td>[ -u FILE ]</td><td>å¦‚æœ FILE å­˜åœ¨ä¸”è®¾ç½®äº† SUID (set user ID) åˆ™ä¸ºçœŸã€‚</td></tr><tr><td>[ -w FILE ]</td><td>å¦‚æœ FILE å­˜åœ¨ä¸”æ˜¯å¯å†™çš„åˆ™ä¸ºçœŸã€‚</td></tr><tr><td>[ -x FILE ]</td><td>å¦‚æœ FILE å­˜åœ¨ä¸”æ˜¯å¯æ‰§è¡Œçš„åˆ™ä¸ºçœŸã€‚</td></tr><tr><td>[ -O FILE ]</td><td>å¦‚æœ FILE å­˜åœ¨ä¸”å±æœ‰æ•ˆç”¨æˆ· ID åˆ™ä¸ºçœŸã€‚</td></tr><tr><td>[ -G FILE ]</td><td>å¦‚æœ FILE å­˜åœ¨ä¸”å±æœ‰æ•ˆç”¨æˆ·ç»„åˆ™ä¸ºçœŸã€‚</td></tr><tr><td>[ -L FILE ]</td><td>å¦‚æœ FILE å­˜åœ¨ä¸”æ˜¯ä¸€ä¸ªç¬¦å·è¿æ¥åˆ™ä¸ºçœŸã€‚</td></tr><tr><td>[ -N FILE ]</td><td>å¦‚æœ FILE å­˜åœ¨ and has been mod å¦‚æœ ied since it was last read åˆ™ä¸ºçœŸã€‚</td></tr><tr><td>[ -S FILE ]</td><td>å¦‚æœ FILE å­˜åœ¨ä¸”æ˜¯ä¸€ä¸ªå¥—æ¥å­—åˆ™ä¸ºçœŸã€‚</td></tr><tr><td>[ FILE1 -nt FILE2 ]</td><td>å¦‚æœ FILE1 has been changed more recently than FILE2, or å¦‚æœ FILE1 exists and FILE2 does not åˆ™ä¸ºçœŸã€‚</td></tr><tr><td>[ FILE1 -ot FILE2 ]</td><td>å¦‚æœ FILE1 æ¯” FILE2 è¦è€, æˆ–è€… FILE2 å­˜åœ¨ä¸” FILE1 ä¸å­˜åœ¨åˆ™ä¸ºçœŸã€‚</td></tr><tr><td>[ FILE1 -ef FILE2 ]</td><td>å¦‚æœ FILE1 å’Œ FILE2 æŒ‡å‘ç›¸åŒçš„è®¾å¤‡å’ŒèŠ‚ç‚¹å·åˆ™ä¸ºçœŸã€‚</td></tr></tbody></table><h2 id="å­—ç¬¦ä¸²åˆ¤æ–­"><a href="#å­—ç¬¦ä¸²åˆ¤æ–­" class="headerlink" title="å­—ç¬¦ä¸²åˆ¤æ–­"></a>å­—ç¬¦ä¸²åˆ¤æ–­</h2><table><thead><tr><th>é€‰é¡¹</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>[ -z str ]</td><td>å¦‚æœ STRING çš„é•¿åº¦ä¸ºé›¶åˆ™ä¸ºçœŸ ï¼Œå³åˆ¤æ–­æ˜¯å¦ä¸ºç©ºï¼Œç©ºå³æ˜¯çœŸï¼›</td></tr><tr><td>[ -n str ]</td><td>å¦‚æœ STRING çš„é•¿åº¦éé›¶åˆ™ä¸ºçœŸ ï¼Œå³åˆ¤æ–­æ˜¯å¦ä¸ºéç©ºï¼Œéç©ºå³æ˜¯çœŸï¼›</td></tr><tr><td>[ str1 &#x3D; str2 ]</td><td>å¦‚æœä¸¤ä¸ªå­—ç¬¦ä¸²ç›¸åŒåˆ™ä¸ºçœŸ</td></tr><tr><td>[ str1 !&#x3D; str2 ]</td><td>å¦‚æœå­—ç¬¦ä¸²ä¸ç›¸åŒåˆ™ä¸ºçœŸ</td></tr><tr><td>[ str ]</td><td>å¦‚æœå­—ç¬¦ä¸²ä¸ä¸ºç©ºåˆ™ä¸ºçœŸ,ä¸ -n ç±»ä¼¼</td></tr></tbody></table><div class="note warning flat"><p>åœ¨ shell è„šæœ¬ä¸­ï¼Œå¦‚æœè¦åˆ¤æ–­ä¸€ä¸ªå˜é‡æ˜¯å¦ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œ<strong>ä¸èƒ½</strong>è¿™æ ·ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">a=</span><br><span class="line"><span class="keyword">if</span> [ -n <span class="variable">$&#123;a&#125;</span> ];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;1&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;2&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·æ— è®º a æ˜¯å¦ä¸ºç©ºï¼Œéƒ½ä¼šè¾“å‡º 1. å› ä¸º a ä¸ºç©ºï¼Œå°±å˜æˆäº† <code>if [ -n ]</code> ï¼Œbash æŠŠ -n å½“ä½œä¸€ä¸ªè¦åˆ¤æ–­çš„å­—ç¬¦ä¸²ï¼Œ<code>if [ å­—ç¬¦ä¸² ]</code> æ’å®šä¸ºçœŸã€‚æ­£ç¡®å†™æ³•çš„æ˜¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">a=</span><br><span class="line"><span class="keyword">if</span> [ -n <span class="string">&quot;<span class="variable">$&#123;a&#125;</span>&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;1&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;2&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure></div><h2 id="æ•°å€¼åˆ¤æ–­"><a href="#æ•°å€¼åˆ¤æ–­" class="headerlink" title="æ•°å€¼åˆ¤æ–­"></a>æ•°å€¼åˆ¤æ–­</h2><table><thead><tr><th>é€‰é¡¹</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>int1 -eq int2</td><td>int1 å’Œ int2 ä¸¤æ•°ç›¸ç­‰ä¸ºçœŸ ,&#x3D;</td></tr><tr><td>int1 -ne int2</td><td>int1 å’Œ int2 ä¸¤æ•°ä¸ç­‰ä¸ºçœŸ ,&lt;&gt;</td></tr><tr><td>int1 -gt int2</td><td>int1 å¤§äº int1 ä¸ºçœŸ ,&gt;</td></tr><tr><td>int1 -ge int2</td><td>int1 å¤§äºç­‰äº int2 ä¸ºçœŸ,&gt;&#x3D;</td></tr><tr><td>int1 -lt int2</td><td>int1 å°äº int2 ä¸ºçœŸ ,&lt;</td></tr><tr><td>int1 -le int2</td><td>int1 å°äºç­‰äº int2 ä¸ºçœŸ,&lt;&#x3D;</td></tr></tbody></table><h2 id="å…¶ä»–é€»è¾‘åˆ¤æ–­"><a href="#å…¶ä»–é€»è¾‘åˆ¤æ–­" class="headerlink" title="å…¶ä»–é€»è¾‘åˆ¤æ–­"></a>å…¶ä»–é€»è¾‘åˆ¤æ–­</h2><table><thead><tr><th>é€‰é¡¹</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>-a</td><td>ä¸</td></tr><tr><td>-o</td><td>æˆ–</td></tr><tr><td>!</td><td>é</td></tr></tbody></table><h2 id="å’Œ"><a href="#å’Œ" class="headerlink" title="|| å’Œ &amp;&amp;"></a>|| å’Œ &amp;&amp;</h2><blockquote><p>|| å‰é¢æ‰§è¡Œä¸é€šè¿‡æ‰æ‰§è¡Œåé¢çš„ï¼Œä¹Ÿå°±æ˜¯æˆ–ï¼Œ &amp;&amp; æ˜¯ä¸ï¼Œå‰é¢æ‰§è¡Œé€šè¿‡ä¼šæ¥ç€æ‰§è¡Œåé¢çš„</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ -d /tmp/111 ] || &#123; <span class="built_in">mkdir</span> /tmp/111; <span class="built_in">cd</span> /tmp/111; <span class="built_in">pwd</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸‰å…ƒåˆ¤æ–­</span></span><br><span class="line">[ -e .env.exampl ] &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;æ–‡ä»¶å­˜åœ¨&quot;</span> || <span class="built_in">echo</span> <span class="string">&quot;æ–‡ä»¶ä¸å­˜åœ¨&quot;</span></span><br></pre></td></tr></table></figure><h3 id="æ¨¡ç³Šåˆ¤æ–­"><a href="#æ¨¡ç³Šåˆ¤æ–­" class="headerlink" title="æ¨¡ç³Šåˆ¤æ–­"></a>æ¨¡ç³Šåˆ¤æ–­</h3><p>åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦åŒ…å«æŒ‡å®šå­—æ®µã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">NAMESPACE=prod-zahuifan</span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$NAMESPACE</span> =~ prod ]] || [[ <span class="variable">$NAMESPACE</span> =~ dr ]]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;æ˜¯ç”Ÿäº§ç¯å¢ƒæˆ–ç¾å¤‡ç¯å¢ƒ&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;éç”Ÿäº§ç¯å¢ƒ&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ©ç”¨Nginxçš„rewriteæ¥å®ç°è‡ªåŠ¨è·³è½¬</title>
      <link href="/posts/ldsv2ssw/"/>
      <url>/posts/ldsv2ssw/</url>
      
        <content type="html"><![CDATA[<h2 id="ä»»æ„é“¾æ¥éƒ½è·³è½¬åˆ°æŒ‡å®šé¡µé¢"><a href="#ä»»æ„é“¾æ¥éƒ½è·³è½¬åˆ°æŒ‡å®šé¡µé¢" class="headerlink" title="ä»»æ„é“¾æ¥éƒ½è·³è½¬åˆ°æŒ‡å®šé¡µé¢"></a>ä»»æ„é“¾æ¥éƒ½è·³è½¬åˆ°æŒ‡å®šé¡µé¢</h2><blockquote><p>éœ€è¦éƒ¨ç½²ä¸€ä¸ªæœåŠ¡åœ¨ Kubernetes å†…ï¼Œ éœ€è¦å®ç°é€šè¿‡ ingress å¯ä»¥è®¿é—®åˆ°ï¼Œ æœ¬æ¥æ˜¯å¾ˆç®€å•çš„äº‹æƒ…ï¼Œ ä½†æ˜¯ç”±äºè®¿é—®æ¥æºçš„ location ä¸ç¡®å®šï¼Œä¸ºäº†é¿å…æŠ¥é”™ 404ï¼Œæ‰€ä»¥ç”¨ Nginx çš„ rewrite æ¥å®ç°</p></blockquote><p>Nginx é…ç½®å¦‚ä¸‹ï¼ˆæ‰€æœ‰ location è½¬å‘åˆ° index.htmlï¼‰ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">        listen 80 default_server;</span><br><span class="line">        listen [::]:80 default_server;</span><br><span class="line">        server_name _;</span><br><span class="line">        root /var/www/html;</span><br><span class="line"></span><br><span class="line">        index index.html index.htm index.nginx-debian.html;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">                rewrite ^(.*) /index.html break;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è‡ªåŠ¨è·³è½¬-https"><a href="#è‡ªåŠ¨è·³è½¬-https" class="headerlink" title="è‡ªåŠ¨è·³è½¬ https"></a>è‡ªåŠ¨è·³è½¬ https</h2><p>é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š</p><h3 id="ä½¿ç”¨-return"><a href="#ä½¿ç”¨-return" class="headerlink" title="ä½¿ç”¨ return"></a>ä½¿ç”¨ return</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">server &#123; </span><br><span class="line">      listen  80;</span><br><span class="line">      server_name    example.qcloud.com;</span><br><span class="line">      return  301 https://$server_name$request_uri;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">      listen  443 ssl;</span><br><span class="line">     server_name    example.qcloud.com;</span><br><span class="line">    [....]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨-rewrite"><a href="#ä½¿ç”¨-rewrite" class="headerlink" title="ä½¿ç”¨ rewrite"></a>ä½¿ç”¨ rewrite</h3><p><code>rewrite</code> æ€§èƒ½æ¶ˆè€—æ›´å¤§ï¼Œä½†æ˜¯æ”¯æŒæ›´å¤æ‚çš„è§„åˆ™ï¼Œåªæ˜¯è·³è½¬åˆ° https å»ºè®®ä½¿ç”¨ <code>return 301</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if ( $scheme = http )&#123;</span><br><span class="line">     rewrite ^(/.*)$ https://$host$1 permanent;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h2 id="åˆ¤æ–­-Header"><a href="#åˆ¤æ–­-Header" class="headerlink" title="åˆ¤æ–­ Header"></a>åˆ¤æ–­ Header</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if ($http_user_agent !~* &quot;(Go-http-client/.*|.*Safari.*)&quot;) &#123; </span><br><span class="line">    return 404;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç›´æ¥è¿”å›å†…å®¹"><a href="#ç›´æ¥è¿”å›å†…å®¹" class="headerlink" title="ç›´æ¥è¿”å›å†…å®¹"></a>ç›´æ¥è¿”å›å†…å®¹</h2><p>æ¯”å¦‚å¤‡æ¡ˆã€æˆ–è€…å„ç§è®¤è¯ï¼Œ è¯æ˜ç½‘ç«™å±äºè‡ªå·±ï¼Œé€šå¸¸ä¼šç»™ä¸€ä¸ª txt æ–‡ä»¶è®©æ”¾åœ¨ç½‘ç«™æ ¹ç›®å½•ï¼Œå…¶å®å¯ä»¥ä½¿ç”¨è¿™ç§æ–¹æ³•æ¥å®ç°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">location /098x6OP2Qq.txt &#123;</span><br><span class="line">    default_type text/plain;</span><br><span class="line">    return 200 &quot;123456qqqqq&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è¿”å›è¯·æ±‚è€…-IP"><a href="#è¿”å›è¯·æ±‚è€…-IP" class="headerlink" title="è¿”å›è¯·æ±‚è€… IP"></a>è¿”å›è¯·æ±‚è€… IP</h2><p>å®ç°ä¸€ä¸ªè·å–å…¬ç½‘ ip çš„å°å·¥å…·ï¼Œç±»ä¼¼äº <code>curl ip.sb</code> å¯ä»¥ç›´æ¥åœ¨ç»ˆç«¯è·å¾—å…¬ç½‘ ipã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">location /ip &#123;</span><br><span class="line">    default_type text/plain;</span><br><span class="line">    return 200 $remote_addr\n;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨Obsidiané…åˆHexoå†™åšå®¢</title>
      <link href="/posts/ldle4xfe/"/>
      <url>/posts/ldle4xfe/</url>
      
        <content type="html"><![CDATA[<p>obsidian æ˜¯ä¸€æ¬¾å¥½ç”¨çš„ markdown ç¼–è¾‘å™¨ï¼Œ ç”¨æ¥è®°ç¬”è®°è¿˜æ˜¯ä¸é”™çš„ã€‚ å¹¶ä¸”æ”¯æŒæ’ä»¶ç³»ç»Ÿï¼Œå¯ä»¥é€šè¿‡æ¨¡æ¿æ¥ç”Ÿæˆåšå®¢çš„ frontmatterï¼Œ çœå»äº† <code>hexo new</code> çš„æ“ä½œ æ‰€ä»¥å‡†å¤‡é…ç½®ä¸€ä¸‹ç”¨ obsidian æ¥å†™åšå®¢ã€‚</p><p>ç›¸å…³æ–‡ç« ï¼š<br><a href="/posts/ab21860c">é™æ€åšå®¢ç”Ÿæˆå·¥å…·hexo</a><br><a href="/posts/b4cf69c3">ä½¿ç”¨typoraæ›´å¥½æ›´å¿«åœ°å†™hugoåšå®¢</a><br><a href="/posts/2a39e018">ä½¿ç”¨vscodeæ¥å†™hugoåšå®¢å¹¶å¤„ç†å›¾ç‰‡æ’å…¥é—®é¢˜</a></p><h2 id="æ‰“å¼€ä»“åº“"><a href="#æ‰“å¼€ä»“åº“" class="headerlink" title="æ‰“å¼€ä»“åº“"></a>æ‰“å¼€ä»“åº“</h2><p>é¦–å…ˆä½¿ç”¨ obsidian æ‰“å¼€ <code>source/_posts</code> ç›®å½•ï¼Œ ç„¶åä¼šç”Ÿæˆä¸€äº›é…ç½®æ–‡ä»¶ã€‚è¿›å…¥ <code>_posts</code> ç›®å½•</p><p>åˆ›å»º.gitignore å°†ä¸€äº›ä¸´æ—¶æ–‡ä»¶æ’é™¤æ‰ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.obsidian/workspace.json</span><br></pre></td></tr></table></figure><h2 id="é…ç½®æ¨¡æ¿"><a href="#é…ç½®æ¨¡æ¿" class="headerlink" title="é…ç½®æ¨¡æ¿"></a>é…ç½®æ¨¡æ¿</h2><p>è‡ªå¸¦çš„æ¨¡æ¿æ’ä»¶åŠŸèƒ½å¤ªå•ä¸€äº†ï¼Œ æˆ‘ä»¬å…³é—­å®‰å…¨æ¨¡å¼ï¼Œ å®‰è£…ç¬¬ä¸‰æ–¹æ’ä»¶ <code>Templater</code></p><p>åˆ›å»º <code>Templates</code> ç›®å½•ï¼Œä¿®æ”¹é…ç½®æŒ‡å®š Template çš„ç›®å½•ã€‚ä¿®æ”¹é…ç½®é¡¹ <code>Template folder location</code> ä¸º <code>Templates</code></p><p>ç„¶åå†æ­¤ç›®å½•ä¸‹åˆ›å»º <code>Front-matter.md</code> æ–‡ä»¶ï¼Œæ­¤æ–‡ä»¶ç”¨ä½œ hexo çš„ frontmatter æ¨¡æ¿ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">title:</span> &lt;%<span class="language-ruby"> tp.file.title </span>%&gt;</span><br><span class="line"><span class="attr">categories:</span></span><br><span class="line">  <span class="bullet">-</span> &lt;%<span class="language-ruby"> tp.file.folder(relative=<span class="literal">true</span>) </span>%&gt;</span><br><span class="line"><span class="attr">tags:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="attr">abbrlink:</span> &lt;%<span class="language-ruby"> tp.user.get_url() </span>%&gt;</span><br><span class="line"><span class="attr">date:</span> &lt;%<span class="language-ruby"> tp.date.now(format=<span class="string">&quot;YYYY-MM-DD HH:mm:ss&quot;</span>) </span>%&gt;</span><br><span class="line"><span class="attr">cover:</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="meta">---</span></span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼š</p><table><thead><tr><th>æ¨¡æ¿</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>tp.file.title</td><td>è·å–åˆ°çš„å°±æ˜¯æ–‡ä»¶å</td></tr><tr><td>tp.file.folder(relative&#x3D;true)</td><td>æ˜¯è·å–æ–‡ä»¶æ‰€åœ¨çš„ç›¸å¯¹è·¯å¾„ï¼Œå°±æ˜¯æ‰€åœ¨ç›®å½•åå­—</td></tr><tr><td>tp.user.get_url()</td><td>æ˜¯è‡ªå®šä¹‰æ–¹æ³•ï¼Œè„šæœ¬åé¢å±•ç¤ºï¼Œç”¨äºè‡ªåŠ¨ç”Ÿæˆåšå®¢çš„ url</td></tr><tr><td>tp.date.now(format&#x3D;â€YYYY-MM-DD HH:mm:ssâ€)</td><td>ä»¥æŒ‡å®šæ ¼å¼æ ¼å¼åŒ–æ—¶é—´</td></tr></tbody></table><p>è¯¦ç»†çš„å˜é‡ä½¿ç”¨è¯·æŸ¥çœ‹ <code>Templater</code> å®˜æ–¹æ–‡æ¡£<a href="https://silentvoid13.github.io/Templater/">https://silentvoid13.github.io/Templater/</a></p><h3 id="è‡ªå®šä¹‰è„šæœ¬"><a href="#è‡ªå®šä¹‰è„šæœ¬" class="headerlink" title="è‡ªå®šä¹‰è„šæœ¬"></a>è‡ªå®šä¹‰è„šæœ¬</h3><p>åˆ›å»ºç›®å½• <code>Scripts</code>ï¼Œ ç„¶ååœ¨è®¾ç½®é‡Œé…ç½® <code>Script files folder location</code> ä¸º <code>Scripts</code></p><p>è·å– GUID è„šæœ¬ <code>Scripts/get_url.js</code> è¿™é‡Œæ˜¯å–å‡ºå½“å‰æ—¶é—´æˆ³ï¼Œç„¶åå»æ‰æ¯«ç§’ï¼Œå†æŒ‰ç…§ <code>0-9</code> + <code>a-z</code> ä¸€å…± 36 ä¸ªå­—ç¬¦æ¥è¡¨ç¤ºï¼Œå¾—åˆ°ä¸€ä¸ª 6 ä½ä¸é‡å¤çš„å­—ç¬¦ä¸²ï¼Œç”¨ä½œæ–‡ç« çš„é“¾æ¥ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">generateTimestampUrl</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> timestamp = <span class="title class_">Math</span>.<span class="title function_">round</span>(<span class="keyword">new</span> <span class="title class_">Date</span>() / <span class="number">1000</span>);</span><br><span class="line">  <span class="keyword">var</span> url = timestamp.<span class="title function_">toString</span>(<span class="number">36</span>)</span><br><span class="line">  <span class="keyword">return</span> url;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = generateTimestampUrl;</span><br></pre></td></tr></table></figure><p>ç„¶åæ¯æ¬¡åˆ›å»ºæ–° markdown æ–‡ä»¶çš„æ—¶å€™ï¼Œåªéœ€è¦ç‚¹å‡» templater æŒ‰é’®ï¼Œ ç„¶åå°±ä¼šè‡ªåŠ¨ç”Ÿæˆæˆ‘ä»¬éœ€è¦çš„ frontmatterï¼Œ å°±ä¸ç”¨ hexo new äº†</p><h3 id="éšè—-Templates-å’Œ-Scripts-ç›®å½•"><a href="#éšè—-Templates-å’Œ-Scripts-ç›®å½•" class="headerlink" title="éšè— Templates å’Œ Scripts ç›®å½•"></a>éšè— Templates å’Œ Scripts ç›®å½•</h3><p>å®‰è£… Hidden Folder æ’ä»¶ï¼Œå¯ä»¥éšè—è¿™ä¸¤ä¸ªç›®å½•ã€‚</p><h2 id="æ¸²æŸ“æ—¶æ’é™¤è¿™äº›ç›®å½•"><a href="#æ¸²æŸ“æ—¶æ’é™¤è¿™äº›ç›®å½•" class="headerlink" title="æ¸²æŸ“æ—¶æ’é™¤è¿™äº›ç›®å½•"></a>æ¸²æŸ“æ—¶æ’é™¤è¿™äº›ç›®å½•</h2><p>åœ¨ä¸»é…ç½®æ–‡ä»¶ä¸­ <code>_config.yml</code></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">skip_render:</span> </span><br><span class="line"><span class="comment"># è¿™é‡Œæ’é™¤çš„æ˜¯obsidianç¼–è¾‘å™¨éœ€è¦çš„æ–‡ä»¶</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;_posts/.obsidian/*&#x27;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;_posts/Scripts/*&#x27;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;_posts/Templates/*&#x27;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;**/README.md&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨-git-æ’ä»¶è¿›è¡ŒåŒæ­¥"><a href="#ä½¿ç”¨-git-æ’ä»¶è¿›è¡ŒåŒæ­¥" class="headerlink" title="ä½¿ç”¨ git æ’ä»¶è¿›è¡ŒåŒæ­¥"></a>ä½¿ç”¨ git æ’ä»¶è¿›è¡ŒåŒæ­¥</h2><p>å®‰è£… <code>Obsidian GIT</code> æ’ä»¶<br>æŒ‰ä¸‹å¿«æ·é”® <code>CTRL + P</code> é€‰æ‹© commit all changes ï¼Œ ç„¶åé€‰æ‹© <code>push</code> å³å¯å‘å¸ƒã€‚</p><h2 id="ä½¿ç”¨-image-auto-upload-plugin-æ¥å¤„ç†å›¾ç‰‡"><a href="#ä½¿ç”¨-image-auto-upload-plugin-æ¥å¤„ç†å›¾ç‰‡" class="headerlink" title="ä½¿ç”¨ image-auto-upload-plugin æ¥å¤„ç†å›¾ç‰‡"></a>ä½¿ç”¨ image-auto-upload-plugin æ¥å¤„ç†å›¾ç‰‡</h2><p>é»˜è®¤æƒ…å†µä¸‹ obsidian æ’å…¥å›¾ç‰‡ä¼šæ’å…¥åˆ°é™„ä»¶æ–‡ä»¶å¤¹, å®‰è£…æ­¤æ’ä»¶ä¼šè‡ªåŠ¨è°ƒç”¨ picgo æˆ–è€… piclist æ¥è¿›è¡Œæ–‡ä»¶ä¸Šä¼ å¹¶å¤åˆ¶ markdown è¯­æ³•åˆ°æ–‡ä»¶ä¸­.</p>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Blog </tag>
            
            <tag> ç¼–è¾‘å™¨ </tag>
            
            <tag> markdown </tag>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ArchLinuxå®‰è£…è®°å½•</title>
      <link href="/posts/5a1b6f71/"/>
      <url>/posts/5a1b6f71/</url>
      
        <content type="html"><![CDATA[<p>å®˜æ–¹æ–‡æ¡£ <a href="https://wiki.archlinuxcn.org/wiki/%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97">ArchWiki</a> å·²ç»å†™çš„å¾ˆå¥½äº†ï¼Œä½†æ˜¯æ¯æ¬¡å®‰è£…çš„æ—¶å€™éƒ½è¦è¸©å‘ï¼Œæ‰€ä»¥å¼€ä¸ªæ–‡ç« è®°å½•ä¸€ä¸‹ã€‚</p><h2 id="ç£ç›˜åˆ†åŒºä¸æ ¼å¼åŒ–"><a href="#ç£ç›˜åˆ†åŒºä¸æ ¼å¼åŒ–" class="headerlink" title="ç£ç›˜åˆ†åŒºä¸æ ¼å¼åŒ–"></a>ç£ç›˜åˆ†åŒºä¸æ ¼å¼åŒ–</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">parted /dev/sda mklabel gpt mkpart ESP fat32 1M 513M <span class="built_in">set</span> 1 boot on mkpart primary ext4 513M 100% <span class="built_in">print</span></span><br><span class="line">mkfs.fat -F 32 /dev/sda1</span><br><span class="line">mkfs.ext4 /dev/sda2</span><br></pre></td></tr></table></figure><h2 id="é…ç½®ä¸­ç§‘å¤§çš„æº"><a href="#é…ç½®ä¸­ç§‘å¤§çš„æº" class="headerlink" title="é…ç½®ä¸­ç§‘å¤§çš„æº"></a>é…ç½®ä¸­ç§‘å¤§çš„æº</h2><p>é…ç½®æ–‡æ¡£ï¼š <a href="https://mirrors.ustc.edu.cn/help/archlinux.html">https://mirrors.ustc.edu.cn/help/archlinux.html</a></p><h2 id="æŒ‚è½½ä¸-chroot-æ“ä½œ"><a href="#æŒ‚è½½ä¸-chroot-æ“ä½œ" class="headerlink" title="æŒ‚è½½ä¸ chroot æ“ä½œ"></a>æŒ‚è½½ä¸ chroot æ“ä½œ</h2><p>chroot åç›¸å½“äºè¿›å…¥äº†å®‰è£…åçš„ç³»ç»Ÿå†…è¿›è¡Œæ“ä½œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mount /dev/sda2 /mnt</span><br><span class="line">mount --<span class="built_in">mkdir</span> /dev/sda1 /mnt/boot</span><br><span class="line">pacstrap -K /mnt base linux linux-firmware</span><br><span class="line">genfstab -U /mnt &gt;&gt; /mnt/etc/fstab</span><br><span class="line"></span><br><span class="line">arch-chroot /mnt</span><br></pre></td></tr></table></figure><h2 id="å¸¸ç”¨é…ç½®"><a href="#å¸¸ç”¨é…ç½®" class="headerlink" title="å¸¸ç”¨é…ç½®"></a>å¸¸ç”¨é…ç½®</h2><h3 id="é…ç½®æ—¶åŒº"><a href="#é…ç½®æ—¶åŒº" class="headerlink" title="é…ç½®æ—¶åŒº"></a>é…ç½®æ—¶åŒº</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ln</span> -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span><br><span class="line">hwclock --systohc</span><br></pre></td></tr></table></figure><h3 id="é…ç½®-locale"><a href="#é…ç½®-locale" class="headerlink" title="é…ç½® locale"></a>é…ç½® locale</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pacman -S vim vi</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sed -e <span class="string">&#x27;s/#en_US.UTF-8/en_US.UTF-8/&#x27;</span> \</span><br><span class="line">    -e <span class="string">&#x27;s/#zh_CN.UTF-8/zh_CN.UTF-8/&#x27;</span> \</span><br><span class="line">    -i /etc/locale.gen</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">locale-gen</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;LANG=en_US.UTF-8&quot;</span> &gt;&gt; /etc/locale.conf</span><br><span class="line"><span class="built_in">echo</span> <span class="built_in">arch</span> &gt;&gt; /etc/hostname</span><br></pre></td></tr></table></figure><h3 id="é…ç½®ç½‘ç»œ"><a href="#é…ç½®ç½‘ç»œ" class="headerlink" title="é…ç½®ç½‘ç»œ"></a>é…ç½®ç½‘ç»œ</h3><p>è¿™é‡Œä½¿ç”¨çš„æ˜¯ systemd å…¨å®¶æ¡¶</p><p>vim &#x2F;etc&#x2F;systemd&#x2F;network&#x2F;20-wired.network</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[Match]</span><br><span class="line">Name=ens33</span><br><span class="line"></span><br><span class="line">[Network]</span><br><span class="line">DHCP=ipv4</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> systemd-networkd systemd-resolved</span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹-root-å¯†ç "><a href="#ä¿®æ”¹-root-å¯†ç " class="headerlink" title="ä¿®æ”¹ root å¯†ç "></a>ä¿®æ”¹ root å¯†ç </h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">passwd root</span><br></pre></td></tr></table></figure><h3 id="åˆ›å»ºæ™®é€šç”¨æˆ·"><a href="#åˆ›å»ºæ™®é€šç”¨æˆ·" class="headerlink" title="åˆ›å»ºæ™®é€šç”¨æˆ·"></a>åˆ›å»ºæ™®é€šç”¨æˆ·</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">pacman -S sudo</span><br><span class="line">groupadd sudo</span><br><span class="line">useradd -s /bin/bash -m iuxt</span><br><span class="line">usermod  -aG sudo iuxt</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;iuxt ALL=(ALL:ALL) NOPASSWD: ALL&quot;</span> &gt; /etc/sudoers.d/iuxt</span><br><span class="line">passwd iuxt</span><br></pre></td></tr></table></figure><h2 id="å®‰è£…-grub"><a href="#å®‰è£…-grub" class="headerlink" title="å®‰è£… grub"></a>å®‰è£… grub</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pacman -S efibootmgr grub</span><br><span class="line">grub-install --target=x86_64-efi --efi-directory=/boot --bootloader-id=GRUB</span><br><span class="line">grub-mkconfig -o /boot/grub/grub.cfg</span><br></pre></td></tr></table></figure><h2 id="å®‰è£…å¸¸ç”¨å·¥å…·"><a href="#å®‰è£…å¸¸ç”¨å·¥å…·" class="headerlink" title="å®‰è£…å¸¸ç”¨å·¥å…·"></a>å®‰è£…å¸¸ç”¨å·¥å…·</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pacman -S openssh</span><br><span class="line">systemctl <span class="built_in">enable</span> sshd</span><br></pre></td></tr></table></figure><h2 id="å®Œæˆå®‰è£…"><a href="#å®Œæˆå®‰è£…" class="headerlink" title="å®Œæˆå®‰è£…"></a>å®Œæˆå®‰è£…</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">exit</span></span><br><span class="line">umount -R /mnt</span><br><span class="line">reboot</span><br></pre></td></tr></table></figure><p>åˆ°æ­¤ä¸ºæ­¢ï¼Œä¸å¸¦å›¾å½¢ç•Œé¢çš„ ArchLinux å·²ç»å®‰è£…å¥½äº†ã€‚</p><h2 id="ArchInstall"><a href="#ArchInstall" class="headerlink" title="ArchInstall"></a>ArchInstall</h2><p>åŸºæœ¬ç³»ç»Ÿå®‰è£…, ä¹Ÿå¯ä»¥ä½¿ç”¨ archinstall, è¿™ä¸ªæ˜¯åœ¨è™šæ‹Ÿæœºç¯å¢ƒä¸‹, æˆ‘çš„å®‰è£…é…ç½®.</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202307300923540.png"></p><h2 id="å›¾å½¢ç•Œé¢"><a href="#å›¾å½¢ç•Œé¢" class="headerlink" title="å›¾å½¢ç•Œé¢"></a>å›¾å½¢ç•Œé¢</h2><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">ä½¿ç”¨i3-wm</button><button type="button" class="tab">ä½¿ç”¨KDE</button></div><div class="tab-contents"><div class="tab-item-content active"><p>å®‰è£…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -S xorg xorg-xinit</span><br><span class="line">sudo pacman -S i3 dmenu</span><br><span class="line">sudo pacman -S ttf-droid wqy-microhei wqy-zenhei noto-fonts-emoji ttf-font-awesome</span><br><span class="line">sudo pacman -S alacritty</span><br></pre></td></tr></table></figure><p>è®¾ç½® archlinux ä¸ºæ–‡æœ¬æ¨¡å¼å¯åŠ¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl set-default multi-user.target</span><br></pre></td></tr></table></figure><p>åœ¨ ~&#x2F;.xinitrc ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹è¿è¡Œ i3</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">exec</span> dbus-launch i3</span><br></pre></td></tr></table></figure><p>é…ç½® ~&#x2F;.bash_profile ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹è¿è¡Œ startx</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> [ -z <span class="string">&quot;<span class="variable">$DISPLAY</span>&quot;</span> ] &amp;&amp; [ -n <span class="string">&quot;<span class="variable">$XDG_VTNR</span>&quot;</span> ] &amp;&amp; [ <span class="string">&quot;<span class="variable">$XDG_VTNR</span>&quot;</span> -eq 1 ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">exec</span> startx</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">pacman -S xorg-server xorg-drivers xorg-xinit</span><br><span class="line">pacman -S sddm</span><br><span class="line">systemctl <span class="built_in">enable</span> --now sddm.service</span><br><span class="line">pacman -S plasma konsole dolphin kwalletmanager</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸ºäº†æ”¯æŒkdeçš„åº”ç”¨å•†åº—</span></span><br><span class="line">sudo pacman -S archlinux-appstream-data  packagekit-qt5  flatpak fwupd</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div><h2 id="ä½¿ç”¨-aur"><a href="#ä½¿ç”¨-aur" class="headerlink" title="ä½¿ç”¨ aur"></a>ä½¿ç”¨ aur</h2><h3 id="å®‰è£…-yay"><a href="#å®‰è£…-yay" class="headerlink" title="å®‰è£… yay"></a>å®‰è£… yay</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -S base-devel git</span><br><span class="line">git <span class="built_in">clone</span> https://aur.archlinux.org/yay.git</span><br><span class="line"><span class="built_in">cd</span> yay</span><br><span class="line">makepkg -si</span><br></pre></td></tr></table></figure><h2 id="é…ç½®ä¸­æ–‡"><a href="#é…ç½®ä¸­æ–‡" class="headerlink" title="é…ç½®ä¸­æ–‡"></a>é…ç½®ä¸­æ–‡</h2><h3 id="ä¸­æ–‡å­—ä½“"><a href="#ä¸­æ–‡å­—ä½“" class="headerlink" title="ä¸­æ–‡å­—ä½“"></a>ä¸­æ–‡å­—ä½“</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -Sy wqy-zenhei wqy-microhei \</span><br><span class="line">    noto-fonts-emoji ttf-dejavu \</span><br><span class="line">    adobe-source-han-sans-cn-fonts \</span><br><span class="line">    adobe-source-han-sans-tw-fonts \</span><br><span class="line">    adobe-source-han-sans-jp-fonts \</span><br><span class="line">    adobe-source-han-sans-kr-fonts \</span><br><span class="line">    ttf-sarasa-gothic</span><br></pre></td></tr></table></figure><h3 id="ä¸­æ–‡è¾“å…¥æ³•"><a href="#ä¸­æ–‡è¾“å…¥æ³•" class="headerlink" title="ä¸­æ–‡è¾“å…¥æ³•"></a>ä¸­æ–‡è¾“å…¥æ³•</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -Sy fcitx5-im fcitx5-qt fcitx5-gtk</span><br><span class="line"><span class="comment"># fcitx5-imæ˜¯ä¸€ä¸ªåŒ…ç»„ï¼ŒåŒ…æ‹¬fcitx5ã€fcitx5-configtoolã€fcitx5-gtkã€fcitx5-qt</span></span><br><span class="line">yay fcitx5-input-support</span><br></pre></td></tr></table></figure><h2 id="è™šæ‹Ÿæœºé…ç½®"><a href="#è™šæ‹Ÿæœºé…ç½®" class="headerlink" title="è™šæ‹Ÿæœºé…ç½®"></a>è™šæ‹Ÿæœºé…ç½®</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pacman -S gtkmm3</span><br><span class="line">pacman -S open-vm-tools</span><br><span class="line">pacman -S xf86-video-vmware</span><br><span class="line">systemctl <span class="built_in">enable</span> --now vmtoolsd vmware-vmblock-fuse</span><br></pre></td></tr></table></figure><h2 id="é…ç½®-zsh"><a href="#é…ç½®-zsh" class="headerlink" title="é…ç½® zsh"></a>é…ç½® zsh</h2><p>å®‰è£… zsh</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -S zsh</span><br></pre></td></tr></table></figure><p>å®‰è£… oh my zsh å®˜ç½‘ <a href="https://github.com/ohmyzsh/ohmyzsh">https://github.com/ohmyzsh/ohmyzsh</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sh -c <span class="string">&quot;<span class="subst">$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)</span>&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å®‰è£… powerlevel10k ä¸»é¢˜</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> --depth=1 https://github.com/romkatv/powerlevel10k.git <span class="variable">$&#123;ZSH_CUSTOM:-<span class="variable">$HOME</span>/.oh-my-zsh/custom&#125;</span>/themes/powerlevel10k</span><br><span class="line">sed -i <span class="string">&#x27;s#^ZSH_THEME=.*#ZSH_THEME=&quot;powerlevel10k/powerlevel10k&quot;#g&#x27;</span> ~/.zshrc</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…nerd fontå­—ä½“</span></span><br><span class="line">yay -S ttf-meslo-nerd-font-powerlevel10k</span><br></pre></td></tr></table></figure><p>å®‰è£…å¸¸ç”¨æ’ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/zsh-users/zsh-autosuggestions <span class="variable">$&#123;ZSH_CUSTOM:-~/.oh-my-zsh/custom&#125;</span>/plugins/zsh-autosuggestions</span><br><span class="line">zsh -ic <span class="string">&quot;omz plugin enable zsh-autosuggestions&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/zsh-users/zsh-syntax-highlighting.git <span class="variable">$&#123;ZSH_CUSTOM:-~/.oh-my-zsh/custom&#125;</span>/plugins/zsh-syntax-highlighting</span><br><span class="line">zsh -ic <span class="string">&quot;omz plugin enable zsh-syntax-highlighting&quot;</span></span><br><span class="line"></span><br><span class="line">sudo pacman -S fzf</span><br><span class="line">zsh -ic <span class="string">&quot;omz plugin enable fzf&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯ç”¨ä¸€äº›è‡ªå¸¦æ’ä»¶</span></span><br><span class="line">zsh -ic <span class="string">&quot;omz plugin enable sudo z git&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
            <tag> ArchLinux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxç¥å¥‡çš„procç›®å½•</title>
      <link href="/posts/sqkrxr/"/>
      <url>/posts/sqkrxr/</url>
      
        <content type="html"><![CDATA[<p>è®©æˆ‘ä»¬çœ‹çœ‹&#x2F;proc é‡Œé¢éƒ½æœ‰ä»€ä¹ˆ<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/20250116150653346.png" alt="image.png"></p><h2 id="æŸ¥çœ‹è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶"><a href="#æŸ¥çœ‹è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶" class="headerlink" title="æŸ¥çœ‹è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶"></a>æŸ¥çœ‹è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹æ‰“å¼€äº†ä»€ä¹ˆæ–‡ä»¶</span></span><br><span class="line"><span class="comment"># é€šè¿‡è¿›ç¨‹å</span></span><br><span class="line">lsof -c more</span><br><span class="line"></span><br><span class="line"><span class="comment"># é€šè¿‡PID</span></span><br><span class="line">lsof -p 30149</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¹Ÿå¯ä»¥é€šè¿‡/procæŸ¥çœ‹</span></span><br><span class="line"><span class="built_in">ls</span> -al /proc/30149/fd</span><br></pre></td></tr></table></figure><h2 id="æŸ¥çœ‹è¿›ç¨‹çš„ç¯å¢ƒå˜é‡"><a href="#æŸ¥çœ‹è¿›ç¨‹çš„ç¯å¢ƒå˜é‡" class="headerlink" title="æŸ¥çœ‹è¿›ç¨‹çš„ç¯å¢ƒå˜é‡"></a>æŸ¥çœ‹è¿›ç¨‹çš„ç¯å¢ƒå˜é‡</h2><p>å’Œ env å‘½ä»¤æŸ¥çœ‹åˆ°çš„ä¸åŒï¼Œenv æŸ¥çœ‹çš„æ˜¯ç³»ç»Ÿçš„ç¯å¢ƒå˜é‡ï¼Œå¯ä»¥ç†è§£ä¸ºé»˜è®¤ç¯å¢ƒå˜é‡ï¼Œä½†æ˜¯è¿›ç¨‹çš„ç¯å¢ƒå˜é‡å¯èƒ½ä¸ä¸€æ ·ï¼Œæ¯”å¦‚è¯´ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">A=B vim a.log</span><br></pre></td></tr></table></figure><p>è¿™ç§æƒ…å†µä¸‹ vim è¿›ç¨‹æ˜¯æœ‰ A è¿™ä¸ªç¯å¢ƒå˜é‡çš„ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /proc/39564/environ |  <span class="built_in">tr</span> <span class="string">&#x27;\0&#x27;</span> <span class="string">&#x27;\n&#x27;</span>  </span><br></pre></td></tr></table></figure><h2 id="å†…æ ¸å¯åŠ¨å‚æ•°"><a href="#å†…æ ¸å¯åŠ¨å‚æ•°" class="headerlink" title="å†…æ ¸å¯åŠ¨å‚æ•°"></a>å†…æ ¸å¯åŠ¨å‚æ•°</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /proc/cmdline | <span class="built_in">tr</span> <span class="string">&#x27;\0&#x27;</span> <span class="string">&#x27; &#x27;</span></span><br></pre></td></tr></table></figure><h2 id="å¯æ‰§è¡Œæ–‡ä»¶"><a href="#å¯æ‰§è¡Œæ–‡ä»¶" class="headerlink" title="å¯æ‰§è¡Œæ–‡ä»¶"></a>å¯æ‰§è¡Œæ–‡ä»¶</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exeæ˜¯è¿è¡Œçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå’Œä¸Šé¢æœ‰ä¸€äº›åŒºåˆ«ã€‚</span><br></pre></td></tr></table></figure><h2 id="limits"><a href="#limits" class="headerlink" title="limits"></a>limits</h2><p>è¿›ç¨‹æ‰€å—åˆ°çš„é™åˆ¶ï¼Œæ¯”å¦‚æœ€å¤§æ–‡ä»¶æ‰“å¼€æ•°ç­‰ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Fail2bané…åˆDockerä½¿ç”¨è§£å†³æš´åŠ›ç ´è§£</title>
      <link href="/posts/7b28cbbc/"/>
      <url>/posts/7b28cbbc/</url>
      
        <content type="html"><![CDATA[<p>fail2ban æ­£å¸¸ä½¿ç”¨å¯ä»¥å‚è€ƒ <a href="/posts/c0880a78">ä½¿ç”¨Fail2banæŠµå¾¡æš´åŠ›ç ´è§£å’Œccæ”»å‡»</a>ï¼Œä½†æ˜¯å¯¹äºä½¿ç”¨äº† Docker host ç½‘ç»œçš„å®¹å™¨æ¥è¯´æ˜¯ä¸ç”Ÿæ•ˆçš„ã€‚åŸå› æœ€åè¯´ï¼Œ æˆ‘ä»¬å…ˆå¤åŸä¸€ä¸‹éƒ¨ç½²æƒ…å†µ</p><h2 id="ç¯å¢ƒç°çŠ¶"><a href="#ç¯å¢ƒç°çŠ¶" class="headerlink" title="ç¯å¢ƒç°çŠ¶"></a>ç¯å¢ƒç°çŠ¶</h2><p>æœåŠ¡å™¨æ˜¯æˆ‘è‡ªå·±çš„æœåŠ¡å™¨ï¼Œä½¿ç”¨ Nginx åšå…¥å£ï¼Œåå‘ä»£ç†åˆ°ä¸åŒçš„åç«¯ï¼Œåç«¯æœåŠ¡å’Œ Nginx éƒ½æ˜¯è¿è¡Œåœ¨ Docker é‡Œï¼Œä½¿ç”¨ Docker çš„è‡ªå®šä¹‰ç½‘ç»œè¿›è¡Œäº’è”ã€‚å…¶ä¸­ Nginx å®¹å™¨ä½¿ç”¨çš„æ˜¯ Host ç½‘ç»œ</p><h2 id="é…ç½®-fail2ban"><a href="#é…ç½®-fail2ban" class="headerlink" title="é…ç½® fail2ban"></a>é…ç½® fail2ban</h2><h3 id="ç¡®å®š-Docker-ç‰ˆ-Nginx-æ—¥å¿—è·¯å¾„"><a href="#ç¡®å®š-Docker-ç‰ˆ-Nginx-æ—¥å¿—è·¯å¾„" class="headerlink" title="ç¡®å®š Docker ç‰ˆ Nginx æ—¥å¿—è·¯å¾„"></a>ç¡®å®š Docker ç‰ˆ Nginx æ—¥å¿—è·¯å¾„</h3><p>Linux å†…ä¸€åˆ‡çš†æ–‡ä»¶ï¼ŒDocker ä¼šå°†æ—¥å¿—å†™å…¥åˆ°ä¸»æœºçš„ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ä¸­ã€‚é€šè¿‡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker inspect nginx --format <span class="string">&quot;&#123;&#123;.LogPath&#125;&#125;&quot;</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥æŸ¥çœ‹åˆ°å®¹å™¨çš„æ—¥å¿—ä½ç½®</p><h3 id="åˆ›å»ºé…ç½®æ–‡ä»¶-etc-fail2ban-jail-d-nginx-cc-conf"><a href="#åˆ›å»ºé…ç½®æ–‡ä»¶-etc-fail2ban-jail-d-nginx-cc-conf" class="headerlink" title="åˆ›å»ºé…ç½®æ–‡ä»¶ /etc/fail2ban/jail.d/nginx-cc.conf"></a>åˆ›å»ºé…ç½®æ–‡ä»¶ <code>/etc/fail2ban/jail.d/nginx-cc.conf</code></h3><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[nginx-cc]</span></span><br><span class="line"><span class="attr">enabled</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">port</span> = http,https</span><br><span class="line"><span class="attr">filter</span> = nginx-cc</span><br><span class="line"><span class="attr">action</span> = %(action_)s</span><br><span class="line"><span class="attr">maxretry</span> = <span class="number">50</span></span><br><span class="line"><span class="attr">findtime</span> = <span class="number">10</span></span><br><span class="line"><span class="attr">bantime</span> = <span class="number">86400</span></span><br><span class="line"><span class="attr">logpath</span> = /var/lib/docker/containers/<span class="number">6</span>fb54f7558d2c7f3c9cb9ce2928f746abd2ce5cd1a3f56fe4889ea3f336b08ff/<span class="number">6</span>fb54f7558d2c7f3c9cb9ce2928f746abd2ce5cd1a3f56fe4889ea3f336b08ff-json.log</span><br></pre></td></tr></table></figure><h3 id="åˆ›å»ºé…ç½®æ–‡ä»¶-etc-fail2ban-filter-d-nginx-cc-conf"><a href="#åˆ›å»ºé…ç½®æ–‡ä»¶-etc-fail2ban-filter-d-nginx-cc-conf" class="headerlink" title="åˆ›å»ºé…ç½®æ–‡ä»¶ /etc/fail2ban/filter.d/nginx-cc.conf"></a>åˆ›å»ºé…ç½®æ–‡ä»¶ <code>/etc/fail2ban/filter.d/nginx-cc.conf</code></h3><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Definition]</span></span><br><span class="line"><span class="attr">failregex</span> = ^\&#123;\<span class="string">&quot;log\&quot;:\&quot;&lt;HOST&gt; -.*- .*HTTP/1.* .* .*$</span></span><br><span class="line"><span class="string">ignoreregex =</span></span><br></pre></td></tr></table></figure><h2 id="å¤ç°é—®é¢˜"><a href="#å¤ç°é—®é¢˜" class="headerlink" title="å¤ç°é—®é¢˜"></a>å¤ç°é—®é¢˜</h2><p>ç…§æ­¤é…ç½®åï¼Œå¤šæ¬¡è®¿é—®åï¼ŒæŸ¥çœ‹ <code>fail2ban-client status nginx-cc</code>ï¼Œæ­¤æ—¶ fail2ban å·²ç»æ˜¾ç¤º ip è¢« ban äº†ï¼š</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202301161607539.png" alt="fail2banæ˜¾ç¤º"></p><p>æŸ¥çœ‹ iptables è§„åˆ™ï¼š</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202301161608061.png" alt="iptables"></p><p>ä¹Ÿå·²ç» REJECT äº†ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰æ•ˆæœã€‚</p><h3 id="åŸå› åˆ†æ"><a href="#åŸå› åˆ†æ" class="headerlink" title="åŸå› åˆ†æ"></a>åŸå› åˆ†æ</h3><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202301161608560.png" alt="æ¶æ„å›¾"></p><p>åŸå› æ˜¯ fail2ban ä½œç”¨äº INPUT é“¾ï¼Œè€Œ Docker Host èµ°çš„æ˜¯ Forward é“¾ã€‚</p><h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><p>åœ¨ <code>/etc/fail2ban/jail.d/nginx-cc.conf</code> é‡Œå¢åŠ ä¸€è¡Œé…ç½®ï¼ŒæŒ‡å®šä½œç”¨äºå“ªä¸ªé“¾ã€‚</p><p>å®Œæ•´é…ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[nginx-cc]</span></span><br><span class="line"><span class="attr">enabled</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">chain</span> = DOCKER-USER</span><br><span class="line"><span class="attr">port</span> = http,https</span><br><span class="line"><span class="attr">filter</span> = nginx-cc</span><br><span class="line"><span class="attr">action</span> = %(action_)s</span><br><span class="line"><span class="attr">maxretry</span> = <span class="number">50</span></span><br><span class="line"><span class="attr">findtime</span> = <span class="number">10</span></span><br><span class="line"><span class="attr">bantime</span> = <span class="number">86400</span></span><br><span class="line"><span class="attr">logpath</span> = /var/lib/docker/containers/<span class="number">6</span>fb54f7558d2c7f3c9cb9ce2928f746abd2ce5cd1a3f56fe4889ea3f336b08ff/<span class="number">6</span>fb54f7558d2c7f3c9cb9ce2928f746abd2ce5cd1a3f56fe4889ea3f336b08ff-json.log</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fail2ban-client reload</span><br></pre></td></tr></table></figure><p>é‡æ–°åŠ è½½é…ç½®ã€‚æ­¤æ—¶å‘ç”Ÿ ban ipï¼Œå†æ¬¡æŸ¥çœ‹ iptables è§„åˆ™ï¼š</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202301161632308.png" alt="æ›´æ”¹å"></p><p>å·²ç»ä½œç”¨äº DOCKER-USER é“¾</p><h2 id="allport-å°ç¦ä¸ç”Ÿæ•ˆ"><a href="#allport-å°ç¦ä¸ç”Ÿæ•ˆ" class="headerlink" title="allport å°ç¦ä¸ç”Ÿæ•ˆ"></a>allport å°ç¦ä¸ç”Ÿæ•ˆ</h2><p>åœ¨ docker ç¯å¢ƒä¸‹, éœ€è¦å¯¹é€šè¿‡ docker è½¬å‘çš„æ‰€æœ‰ç«¯å£è¿›è¡Œå°ç¦çš„æ“ä½œ, å¯ä»¥æŒ‡å®šä½œç”¨äº forward é“¾</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[gitea-docker]</span><br><span class="line">enabled = true</span><br><span class="line">filter = gitea</span><br><span class="line">logpath = /var/lib/gitea/log/gitea.log</span><br><span class="line">maxretry = 10</span><br><span class="line">findtime = 3600</span><br><span class="line">bantime = 900</span><br><span class="line">action = iptables-allports[chain=&quot;FORWARD&quot;]</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> fail2ban </tag>
            
            <tag> ccæ”»å‡» </tag>
            
            <tag> iptables </tag>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨Fail2banæŠµå¾¡æš´åŠ›ç ´è§£å’Œccæ”»å‡»</title>
      <link href="/posts/c0880a78/"/>
      <url>/posts/c0880a78/</url>
      
        <content type="html"><![CDATA[<p>fail2ban æ˜¯ä¸€æ¬¾é˜²æ­¢æš´åŠ›ç ´è§£å’Œ cc æ”»å‡»çš„å¼€æºå·¥å…·ï¼Œé‡‡ç”¨ Python ç¼–å†™ã€‚</p><h2 id="å¸¸ç”¨ç»„ä»¶"><a href="#å¸¸ç”¨ç»„ä»¶" class="headerlink" title="å¸¸ç”¨ç»„ä»¶"></a>å¸¸ç”¨ç»„ä»¶</h2><table><thead><tr><th>å·¥å…·</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>fail2ban-client</td><td>å®¢æˆ·ç«¯å·¥å…·</td></tr><tr><td>fail2ban-regex</td><td>éªŒè¯æ­£åˆ™åŒ¹é…</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å¯ç”¨çš„è§„åˆ™</span></span><br><span class="line">fail2ban-client status</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹è§„åˆ™è¯¦æƒ…</span></span><br><span class="line">fail2ban-client status sshd</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡æ–°åŠ è½½é…ç½®</span></span><br><span class="line">fail2ban-client reload</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰‹åŠ¨è§£ç¦IP</span></span><br><span class="line">fail2ban-client <span class="built_in">set</span> sshd unbanip 192.168.1.1</span><br></pre></td></tr></table></figure><table><thead><tr><th>é…ç½®æ–‡ä»¶ç›®å½•</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>&#x2F;etc&#x2F;fail2ban&#x2F;jail.d</td><td>ban çš„è§„åˆ™ï¼Œå¦‚å¤šå°‘æ¬¡è§¦å‘ï¼Œè§¦å‘åå°ç¦å¤šä¹…ç­‰</td></tr><tr><td>&#x2F;etc&#x2F;fail2ban&#x2F;filter.d</td><td>è¿‡æ»¤è§„åˆ™ï¼ŒåŒ¹é…æ—¥å¿—çš„æ­£åˆ™é…ç½®</td></tr></tbody></table><h2 id="è§„åˆ™æµ‹è¯•"><a href="#è§„åˆ™æµ‹è¯•" class="headerlink" title="è§„åˆ™æµ‹è¯•"></a>è§„åˆ™æµ‹è¯•</h2><p>åˆ›å»ºé…ç½®æ–‡ä»¶ <code>/etc/fail2ban/jail.d/nginx-cc.conf</code></p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[nginx-cc]</span></span><br><span class="line"><span class="attr">enabled</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">port</span> = http,https</span><br><span class="line"><span class="attr">filter</span> = nginx-cc</span><br><span class="line"><span class="attr">action</span> = %(action_mwl)s</span><br><span class="line"><span class="attr">maxretry</span> = <span class="number">20</span></span><br><span class="line"><span class="attr">findtime</span> = <span class="number">10</span>m</span><br><span class="line"><span class="attr">bantime</span> = <span class="number">2</span>h</span><br><span class="line"><span class="attr">logpath</span> = /var/log/nginx/access.log</span><br></pre></td></tr></table></figure><table><thead><tr><th>é…ç½®</th><th align="left">è¯´æ˜</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>enabled</td><td align="left">æ˜¯å¦å¼€å¯æ£€æµ‹</td><td></td></tr><tr><td>port</td><td align="left">æ£€æŸ¥çš„ç«¯å£</td><td>å¤šä¸ªç«¯å£ , åˆ†éš”</td></tr><tr><td>ignoreip</td><td align="left">å¿½ç•¥ IP åœ°å€ï¼ˆCIDR æ ¼å¼ï¼‰æˆ–æœºå™¨åï¼Œä»¥ç©ºæ ¼åˆ†éš”ã€‚</td><td></td></tr><tr><td>bantime</td><td align="left">ä¸»æœºè¢«ç¦æ­¢æ—¶é•¿ï¼Œé»˜è®¤ 600 ç§’ã€‚</td><td>é«˜ç‰ˆæœ¬ Fail2ban æ”¯æŒ s ï¼ˆç§’ï¼‰, m ï¼ˆåˆ†ï¼‰å’Œ d ï¼ˆå¤©ï¼‰ä½œä¸ºæ—¶é—´å•ä½ï¼Œå¦‚ 10m å’Œ 1d</td></tr><tr><td>maxretry</td><td align="left">åœ¨ findtime æ—¶é—´çª—å£ä¸­ï¼Œå…è®¸ä¸»æœºè®¤è¯å¤±è´¥æ¬¡æ•°ã€‚è¾¾åˆ°æœ€å¤§æ¬¡æ•°ï¼Œä¸»æœºå°†è¢«ç¦æ­¢ã€‚</td><td>åœ¨ findtime æ—¶é—´æ®µå†…ï¼Œå‘ç”Ÿ maxretry æ¬¡ï¼Œå°±ä¼šè§¦å‘å°ç¦ã€‚</td></tr><tr><td>findtime</td><td align="left">æŸ¥æ‰¾ä¸»æœºè®¤è¯å¤±è´¥çš„æ—¶é—´é—´éš”ã€‚ ä¸æ„å‘³ç€æ¯éš” findtime æ—¶é—´æ‰«æä¸€æ¬¡æ—¥å¿—ã€‚</td><td>é«˜ç‰ˆæœ¬ Fail2ban æ”¯æŒ s ï¼ˆç§’ï¼‰, m ï¼ˆåˆ†ï¼‰å’Œ d ï¼ˆå¤©ï¼‰ä½œä¸ºæ—¶é—´å•ä½ï¼Œå¦‚ 10m å’Œ 1d</td></tr><tr><td>logpath</td><td align="left">æ‰«æçš„æ—¥å¿—æ–‡ä»¶</td><td>fail2ban æŒ‰è¡Œæ‰«ææ­¤æ–‡ä»¶ï¼Œæ ¹æ® filter è§„åˆ™åŒ¹é…å¤±è´¥çš„é¡¹ç›®å¹¶ç»Ÿè®¡</td></tr><tr><td>action</td><td align="left">ç”¨ä»€ä¹ˆæ–¹å¼æ¥å°ç¦, iptables æˆ– ufw æˆ– firewalld ç­‰</td><td></td></tr><tr><td>action &#x3D; %(action_)s</td><td align="left">åªå°ç¦, ä¸å‘é€é‚®ä»¶</td><td></td></tr><tr><td>action &#x3D; %(action_mw)s</td><td align="left">å‘é‚®ä»¶é€šçŸ¥</td><td></td></tr><tr><td>action &#x3D; %(action_mwl)s</td><td align="left">å‘é‚®ä»¶é€šçŸ¥å¹¶å¸¦ä¸Šæ—¥å¿—</td><td></td></tr></tbody></table><p>åˆ›å»ºé…ç½®æ–‡ä»¶ <code>/etc/fail2ban/filter.d/nginx-cc.conf</code></p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Definition]</span></span><br><span class="line"><span class="attr">failregex</span> = &lt;HOST&gt; -.*- .*HTTP/<span class="number">1</span>.* .* .*$</span><br><span class="line">ignoreregex =</span><br></pre></td></tr></table></figure><h3 id="fail2ban-regex-æµ‹è¯•"><a href="#fail2ban-regex-æµ‹è¯•" class="headerlink" title="fail2ban-regex æµ‹è¯•"></a>fail2ban-regex æµ‹è¯•</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ­£åˆ™è§„åˆ™æ£€æŸ¥</span></span><br><span class="line">fail2ban-regex /var/log/nginx/access.log <span class="string">&quot;&lt;HOST&gt; -.*- .*HTTP/1.* .* .*$&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ ¹æ®é…ç½®æ–‡ä»¶æ£€æŸ¥</span></span><br><span class="line">fail2ban-regex /var/log/nginx/access.log /etc/fail2ban/filter.d/nginx-cc.conf</span><br></pre></td></tr></table></figure><h2 id="å¸¸è§é—®é¢˜"><a href="#å¸¸è§é—®é¢˜" class="headerlink" title="å¸¸è§é—®é¢˜"></a>å¸¸è§é—®é¢˜</h2><h3 id="ubuntu-å¯åŠ¨æŠ¥é”™"><a href="#ubuntu-å¯åŠ¨æŠ¥é”™" class="headerlink" title="ubuntu å¯åŠ¨æŠ¥é”™"></a>ubuntu å¯åŠ¨æŠ¥é”™</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ERROR   Failed during configuration: Have not found any <span class="built_in">log</span> file <span class="keyword">for</span> sshd jail</span><br></pre></td></tr></table></figure><p>åŸå› åº”è¯¥æ˜¯ fail2ban é»˜è®¤å¼€å¯ ssh ç›‘æ§ï¼Œä½†æ˜¯æ‰¾ä¸åˆ° ssh çš„æ—¥å¿—ã€‚<br>ç½‘ä¸Šæœç´¢å‘ç°æœ‰äººåœ¨ GitHub ä¸Šç»™å‡ºäº†è§£å†³æ–¹æ¡ˆã€‚åœ¨ jail è®¾ç½®é‡Œé¢åŠ ä¸Šä»¥ä¸‹å†…å®¹å³å¯é¡ºåˆ©å¯åŠ¨ï¼š</p><p><code>vim /etc/fail2ban/jail.d/defaults-debian.conf</code> åœ¨æœ€ä¸Šé¢åŠ ä¸Š:</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[DEFAULT]</span></span><br><span class="line"><span class="attr">backend</span> = systemd</span><br></pre></td></tr></table></figure><p>æˆ–è€…å®‰è£… <code>rsyslog</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install -y rsyslog</span><br></pre></td></tr></table></figure><h3 id="SSH-é”™è¯¯å¯†é’¥ä¸å°ç¦"><a href="#SSH-é”™è¯¯å¯†é’¥ä¸å°ç¦" class="headerlink" title="SSH é”™è¯¯å¯†é’¥ä¸å°ç¦"></a>SSH é”™è¯¯å¯†é’¥ä¸å°ç¦</h3><p>fail2ban å®‰è£…å®Œæˆåé»˜è®¤å°±ä¼šå¯¹ ssh è¿›è¡Œå°ç¦ï¼ˆdebian ç³»ï¼‰ï¼Œé…ç½®æ–‡ä»¶è§ <code>/etc/fail2ban/jail.d/defaults-debian.conf</code>, é»˜è®¤å¯¹å¯†ç é”™è¯¯ã€å¯†é’¥ç™»é™†çš„ç”¨æˆ·åé”™è¯¯éƒ½æœ‰å°ç¦æ•ˆæœï¼Œä½†æ˜¯ç”¨æˆ·åæ˜¯æ­£ç¡®çš„ä½†æ˜¯ key é”™äº†æ˜¯ä¸å°ç¦çš„ï¼Œ å¯ä»¥é€šè¿‡ä¿®æ”¹ <code>/etc/fail2ban/jail.d/defaults-debian.conf</code></p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[sshd]</span></span><br><span class="line"><span class="attr">mode</span>   = aggressive</span><br><span class="line"><span class="attr">enabled</span> = <span class="literal">true</span></span><br></pre></td></tr></table></figure><p>é…ç½® <code>mode   = aggressive</code> å¯è§£å†³æ­¤é—®é¢˜</p>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> fail2ban </tag>
            
            <tag> ccæ”»å‡» </tag>
            
            <tag> iptables </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hyper-V è‡ªåŠ¨åˆ›å»ºè™šæ‹Ÿæœºå¿«ç…§</title>
      <link href="/posts/sq3s3x/"/>
      <url>/posts/sq3s3x/</url>
      
        <content type="html"><![CDATA[<p>é¦–å…ˆè¦å…è®¸ PowerShell æ‰§è¡Œæœ¬åœ°è„šæœ¬æ–‡ä»¶ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Set-ExecutionPolicy</span> RemoteSigned</span><br></pre></td></tr></table></figure><p>PowerShell è„šæœ¬å†…å®¹ï¼šï¼ˆæ–‡ä»¶éœ€è¦ä¿å­˜æˆ GB2312 ç¼–ç ï¼Œä¸ç„¶ä¸­æ–‡ä¹±ç ï¼Œæ‰§è¡ŒæŠ¥é”™ã€‚ï¼‰</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$isAdmin</span> = ([<span class="type">Security.Principal.WindowsPrincipal</span>] [<span class="type">Security.Principal.WindowsIdentity</span>]::GetCurrent()).IsInRole([<span class="type">Security.Principal.WindowsBuiltInRole</span>]::Administrator)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœä¸æ˜¯ç®¡ç†å‘˜ï¼Œä»¥ç®¡ç†å‘˜èº«ä»½é‡æ–°è¿è¡Œè„šæœ¬</span></span><br><span class="line"><span class="keyword">if</span> (<span class="operator">-not</span> <span class="variable">$isAdmin</span>) &#123;</span><br><span class="line">    <span class="built_in">Start-Process</span> powershell <span class="literal">-ArgumentList</span> <span class="string">&quot;-NoProfile -ExecutionPolicy Bypass -File `&quot;<span class="variable">$PSCommandPath</span>`&quot;&quot;</span> <span class="literal">-Verb</span> RunAs</span><br><span class="line">    <span class="keyword">Exit</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ­¤å¤„æ”¾ç½®ä½ çš„è„šæœ¬çš„å…¶ä½™éƒ¨åˆ†</span></span><br><span class="line"><span class="built_in">Write-Output</span> <span class="string">&quot;è„šæœ¬ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿ç•™çš„æœ€å¤§å¿«ç…§æ•°é‡</span></span><br><span class="line"><span class="variable">$maxSnapshots</span> = <span class="number">14</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–æ‰€æœ‰è™šæ‹Ÿæœºçš„åç§°</span></span><br><span class="line"><span class="variable">$vms</span> = <span class="built_in">Get-VM</span></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$vm</span> <span class="keyword">in</span> <span class="variable">$vms</span>) &#123;</span><br><span class="line">    <span class="built_in">Write-Output</span> <span class="string">&quot;ä¸ºè™šæ‹Ÿæœº <span class="variable">$</span>(<span class="variable">$vm</span>.Name) åˆ›å»ºå®šæ—¶å¿«ç…§&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="variable">$datetime</span> = <span class="built_in">Get-Date</span> <span class="literal">-Format</span> <span class="string">&#x27;yyyy-MM-dd tt hh:mm:ss&#x27;</span></span><br><span class="line">    <span class="comment"># åˆ›å»ºå¿«ç…§</span></span><br><span class="line">    <span class="built_in">Checkpoint-VM</span> <span class="literal">-VM</span> <span class="variable">$vm</span> <span class="literal">-SnapshotName</span> <span class="string">&quot;å®šæ—¶å¿«ç…§ (<span class="variable">$datetime</span>)&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># è·å–æ‰€æœ‰å¿«ç…§</span></span><br><span class="line">    <span class="variable">$snapshots</span> = <span class="built_in">Get-VMSnapshot</span> <span class="literal">-VM</span> <span class="variable">$vm</span> | <span class="built_in">Where-Object</span> &#123; <span class="variable">$_</span>.Name <span class="operator">-like</span> <span class="string">&#x27;å®šæ—¶å¿«ç…§*&#x27;</span> &#125;</span><br><span class="line">    <span class="built_in">Write-Output</span> <span class="string">&quot;å…±æœ‰ <span class="variable">$</span>(<span class="variable">$snapshots</span>.Count) ä¸ªå®šæ—¶å¿«ç…§&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¦‚æœå¿«ç…§æ•°é‡è¶…è¿‡é™åˆ¶ï¼Œåˆ™åˆ é™¤è¾ƒæ—§çš„å¿«ç…§</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$snapshots</span>.Count <span class="operator">-gt</span> <span class="variable">$maxSnapshots</span>) &#123;</span><br><span class="line">        <span class="variable">$snapshotsToDelete</span> = <span class="variable">$snapshots</span> | <span class="built_in">Sort-Object</span> CreationTime | <span class="built_in">Select-Object</span> <span class="literal">-First</span> (<span class="variable">$snapshots</span>.Count - <span class="variable">$maxSnapshots</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$snapshot</span> <span class="keyword">in</span> <span class="variable">$snapshotsToDelete</span>) &#123;</span><br><span class="line">            <span class="built_in">Write-Output</span> <span class="string">&quot;åˆ é™¤å¿«ç…§ <span class="variable">$</span>(<span class="variable">$snapshot</span>.Name)&quot;</span></span><br><span class="line">            <span class="built_in">Remove-VMSnapshot</span> <span class="literal">-VM</span> <span class="variable">$vm</span> <span class="literal">-Name</span> <span class="variable">$snapshot</span>.Name</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®šæ—¶æ‰§è¡Œéœ€è¦é…ç½®ä»»åŠ¡è®¡åˆ’ï¼š</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell -File è„šæœ¬è·¯å¾„</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è™šæ‹Ÿæœº </tag>
            
            <tag> Hyper-V </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Windowsä¸‹è¿è¡ŒæœåŠ¡çš„å‡ ç§æ–¹å¼</title>
      <link href="/posts/5d4cbfad/"/>
      <url>/posts/5d4cbfad/</url>
      
        <content type="html"><![CDATA[<h2 id="åŸç”Ÿå‘½ä»¤-sc"><a href="#åŸç”Ÿå‘½ä»¤-sc" class="headerlink" title="åŸç”Ÿå‘½ä»¤ sc"></a>åŸç”Ÿå‘½ä»¤ sc</h2><p>å¾®è½¯å®˜æ–¹æ–‡æ¡£ï¼š <a href="https://learn.microsoft.com/zh-cn/windows-server/administration/windows-commands/sc-create">https://learn.microsoft.com/zh-cn/windows-server/administration/windows-commands/sc-create</a></p><h2 id="ç¬¬ä¸‰æ–¹å·¥å…·-winsw-2-x"><a href="#ç¬¬ä¸‰æ–¹å·¥å…·-winsw-2-x" class="headerlink" title="ç¬¬ä¸‰æ–¹å·¥å…· winsw 2.x"></a>ç¬¬ä¸‰æ–¹å·¥å…· winsw 2.x</h2><p><a href="https://github.com/winsw/winsw/releases/tag/v2.11.0">https://github.com/winsw/winsw/releases/tag/v2.11.0</a></p><p>éœ€è¦å°† winsw å¯æ‰§è¡Œæ–‡ä»¶å’Œé…ç½®æ–‡ä»¶æ”¾åœ¨åŒä¸€ç›®å½•, ä¸€èˆ¬æ”¾åœ¨ç¨‹åºåŒçº§ç›®å½•. åŒæ ·ä»¥ frpc ä¸ºä¾‹:</p><p>service.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">service</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span>&gt;</span>frpc<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- Display name of the service --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>frpc Service (powered by WinSW)<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- Service description --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>frpc å¼€æºå†…ç½‘ç©¿é€å·¥å…·<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">&lt;!-- Path to the executable, which should be started --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">executable</span>&gt;</span>%BASE%\frpc.exe<span class="tag">&lt;/<span class="name">executable</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">serviceaccount</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">domain</span>&gt;</span>.<span class="tag">&lt;/<span class="name">domain</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">user</span>&gt;</span>your windows user<span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">password</span>&gt;</span>your windows password<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">allowservicelogon</span>&gt;</span>true<span class="tag">&lt;/<span class="name">allowservicelogon</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">serviceaccount</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">onfailure</span> <span class="attr">action</span>=<span class="string">&quot;restart&quot;</span> <span class="attr">delay</span>=<span class="string">&quot;10 sec&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">onfailure</span> <span class="attr">action</span>=<span class="string">&quot;restart&quot;</span> <span class="attr">delay</span>=<span class="string">&quot;20 sec&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">onfailure</span> <span class="attr">action</span>=<span class="string">&quot;restart&quot;</span> <span class="attr">delay</span>=<span class="string">&quot;60 sec&quot;</span>/&gt;</span> </span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">resetfailure</span>&gt;</span>4 hour<span class="tag">&lt;/<span class="name">resetfailure</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">  <span class="tag">&lt;<span class="name">arguments</span>&gt;</span>--config %BASE%\frpc.ini<span class="tag">&lt;/<span class="name">arguments</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">priority</span>&gt;</span>Normal<span class="tag">&lt;/<span class="name">priority</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">stoptimeout</span>&gt;</span>15 sec<span class="tag">&lt;/<span class="name">stoptimeout</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">stopparentprocessfirst</span>&gt;</span>true<span class="tag">&lt;/<span class="name">stopparentprocessfirst</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">startmode</span>&gt;</span>Automatic<span class="tag">&lt;/<span class="name">startmode</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">delayedAutoStart</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">waithint</span>&gt;</span>15 sec<span class="tag">&lt;/<span class="name">waithint</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sleeptime</span>&gt;</span>1 sec<span class="tag">&lt;/<span class="name">sleeptime</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">logpath</span>&gt;</span>%BASE%\logs<span class="tag">&lt;/<span class="name">logpath</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">log</span> <span class="attr">mode</span>=<span class="string">&quot;append&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    &lt;setting1/&gt;</span></span><br><span class="line"><span class="comment">    &lt;setting2/&gt;</span></span><br><span class="line"><span class="comment">  --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">log</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">service</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ç„¶åå°† winsw.exe é‡å‘½åæˆ service.exe(å’Œ xml æ–‡ä»¶ä¿æŒä¸€è‡´),ç„¶åæ‰§è¡Œ</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service.exe install</span><br></pre></td></tr></table></figure><h3 id="å…¶ä»–å‘½ä»¤"><a href="#å…¶ä»–å‘½ä»¤" class="headerlink" title="å…¶ä»–å‘½ä»¤"></a>å…¶ä»–å‘½ä»¤</h3><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">service.exe -h</span><br><span class="line">service.exe uninstall</span><br><span class="line">service.exe <span class="built_in">start</span></span><br><span class="line">service.exe stop</span><br><span class="line">service.exe restart</span><br></pre></td></tr></table></figure><h2 id="ç¬¬ä¸‰æ–¹å·¥å…·-winsw-3-x-beta"><a href="#ç¬¬ä¸‰æ–¹å·¥å…·-winsw-3-x-beta" class="headerlink" title="ç¬¬ä¸‰æ–¹å·¥å…· winsw 3.x beta"></a>ç¬¬ä¸‰æ–¹å·¥å…· winsw 3.x beta</h2><p><a href="https://github.com/winsw/winsw">https://github.com/winsw/winsw</a></p><p>æ³¨æ„: 2.x ç‰ˆæœ¬ å’Œ 3.x ç‰ˆæœ¬ä¼šæœ‰ä¸€äº›ä¸åŒ, æˆ‘ç”¨çš„æ˜¯ 3.x beta ç‰ˆæœ¬, ä»¥ frpc è¿™ä¸ªå†…ç½‘ç©¿é€æœåŠ¡ä¸ºä¾‹, 3.x å½“å‰æŒ‡å®šç”¨æˆ·æ‰§è¡Œçš„åŠŸèƒ½æœ‰ bug</p><h3 id="å®‰è£…-winsw"><a href="#å®‰è£…-winsw" class="headerlink" title="å®‰è£… winsw"></a>å®‰è£… winsw</h3><p>ç¡®ä¿å¯æ‰§è¡Œæ–‡ä»¶æ‰€åœ¨çš„ç›®å½•åœ¨ç³»ç»Ÿç¯å¢ƒå˜é‡ <code>PATH</code> ä¸­</p><h3 id="å‡†å¤‡é…ç½®æ–‡ä»¶"><a href="#å‡†å¤‡é…ç½®æ–‡ä»¶" class="headerlink" title="å‡†å¤‡é…ç½®æ–‡ä»¶"></a>å‡†å¤‡é…ç½®æ–‡ä»¶</h3><p>åœ¨å¯æ‰§è¡Œæ–‡ä»¶ä¸‹ä¿å­˜ä¸€ä»½é…ç½®æ–‡ä»¶ <code>winsw.xml</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">service</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span>&gt;</span>frpc<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>frpc Service (powered by WinSW)<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>å†…ç½‘ç©¿é€æœåŠ¡<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">executable</span>&gt;</span>%BASE%\frpc.exe<span class="tag">&lt;/<span class="name">executable</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">arguments</span>&gt;</span>--config %BASE%\frpc.ini<span class="tag">&lt;/<span class="name">arguments</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">workingdirectory</span>&gt;</span>%BASE%<span class="tag">&lt;/<span class="name">workingdirectory</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">onfailure</span> <span class="attr">action</span>=<span class="string">&quot;restart&quot;</span> <span class="attr">delay</span>=<span class="string">&quot;10 sec&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">onfailure</span> <span class="attr">action</span>=<span class="string">&quot;restart&quot;</span> <span class="attr">delay</span>=<span class="string">&quot;20 sec&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">onfailure</span> <span class="attr">action</span>=<span class="string">&quot;restart&quot;</span> <span class="attr">delay</span>=<span class="string">&quot;1 hour&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">resetfailure</span>&gt;</span>2 hour<span class="tag">&lt;/<span class="name">resetfailure</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">stoptimeout</span>&gt;</span>15 sec<span class="tag">&lt;/<span class="name">stoptimeout</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">priority</span>&gt;</span>Normal<span class="tag">&lt;/<span class="name">priority</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">startmode</span>&gt;</span>Automatic<span class="tag">&lt;/<span class="name">startmode</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">delayedAutoStart</span>&gt;</span>true<span class="tag">&lt;/<span class="name">delayedAutoStart</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">logpath</span>&gt;</span>%BASE%\logs<span class="tag">&lt;/<span class="name">logpath</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">log</span> <span class="attr">mode</span>=<span class="string">&quot;append&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    &lt;setting1/&gt;</span></span><br><span class="line"><span class="comment">    &lt;setting2/&gt;</span></span><br><span class="line"><span class="comment">  --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">log</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">service</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="æœåŠ¡æ“ä½œ"><a href="#æœåŠ¡æ“ä½œ" class="headerlink" title="æœåŠ¡æ“ä½œ"></a>æœåŠ¡æ“ä½œ</h3><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">æŸ¥çœ‹å¸®åŠ©</span><br><span class="line">winsw.exe -h</span><br><span class="line"></span><br><span class="line">å®‰è£…æœåŠ¡</span><br><span class="line">winsw.exe install winsw.xml</span><br><span class="line"></span><br><span class="line">é‡å¯æœåŠ¡, å½“ç„¶åˆ°ç³»ç»Ÿçš„æœåŠ¡é‡Œé¢é‡å¯ä¹Ÿå¯ä»¥</span><br><span class="line">winsw.exe restart winsw.xml</span><br><span class="line"></span><br><span class="line">ä¿®æ”¹äº†xmlé…ç½®æ–‡ä»¶, é‡æ–°åŠ è½½</span><br><span class="line">winsw.exe refresh winsw.xml</span><br><span class="line"></span><br><span class="line">å¸è½½æœåŠ¡</span><br><span class="line">winsw.exe uninstall winsw.xml</span><br></pre></td></tr></table></figure><h2 id="ç¬¬ä¸‰æ–¹å·¥å…·-nssm"><a href="#ç¬¬ä¸‰æ–¹å·¥å…·-nssm" class="headerlink" title="ç¬¬ä¸‰æ–¹å·¥å…· nssm"></a>ç¬¬ä¸‰æ–¹å·¥å…· nssm</h2><p>å®˜ç½‘: <a href="https://nssm.cc/download">https://nssm.cc/download</a></p><p>ä¸‹è½½å¥½å¯æ‰§è¡Œæ–‡ä»¶, å»ºè®®æ”¾åœ¨ç³»ç»Ÿç¯å¢ƒå˜é‡ PATH ä¸­, è¿™æ ·åœ¨ä»»ä½•åœ°æ–¹éƒ½å¯ä»¥æ‰§è¡Œ <code>nssm</code> å‘½ä»¤</p><h3 id="å¸¸ç”¨æ“ä½œ"><a href="#å¸¸ç”¨æ“ä½œ" class="headerlink" title="å¸¸ç”¨æ“ä½œ"></a>å¸¸ç”¨æ“ä½œ</h3><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">å®‰è£…æœåŠ¡, ä¼šå¼¹å‡ºå›¾å½¢ç•Œé¢, å®Œå…¨ç•Œé¢æ“ä½œ.</span><br><span class="line">nssm install frpc</span><br><span class="line"></span><br><span class="line">ä¿®æ”¹æœåŠ¡</span><br><span class="line">nssm edit frpc</span><br><span class="line"></span><br><span class="line">å¸è½½æœåŠ¡</span><br><span class="line">nssm remove frpc</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æœåŠ¡ </tag>
            
            <tag> service </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pythonéå†æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹</title>
      <link href="/posts/950d73ef/"/>
      <url>/posts/950d73ef/</url>
      
        <content type="html"><![CDATA[<h2 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h2><p>root: å½“å‰éå†åˆ°çš„ç›®å½•, ä¹Ÿå°±æ˜¯æ‰€åœ¨çš„ç›®å½•, å­—ç¬¦ä¸²<br>dirs: å½“å‰ç›®å½•ä¸‹çš„å­ç›®å½•åˆ—è¡¨<br>files: å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶åˆ—è¡¨</p><p>æ¯”å¦‚æ–‡ä»¶ç»“æ„ <code>/tmp/1/</code> :</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1</span><br><span class="line">â”œâ”€â”€ file1</span><br><span class="line">â”œâ”€â”€ file2</span><br><span class="line">â”œâ”€â”€ folder1</span><br><span class="line">â””â”€â”€ folder2</span><br></pre></td></tr></table></figure><p>è„šæœ¬å†…å®¹:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> root, dirs, files <span class="keyword">in</span> os.walk(<span class="string">&quot;/tmp/1/&quot;</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;root&quot;</span>, root)</span><br><span class="line">    <span class="built_in">print</span>(dirs)</span><br><span class="line">    <span class="built_in">print</span>(files)</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å½“å‰çš„rootæ˜¯</span></span><br><span class="line">/tmp/1/</span><br><span class="line"></span><br><span class="line"><span class="comment"># rootä¸‹çš„ç›®å½•åˆ—è¡¨ä¸º:</span></span><br><span class="line">[<span class="string">&#x27;folder2&#x27;</span>, <span class="string">&#x27;folder1&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># rootä¸‹çš„æ–‡ä»¶åˆ—è¡¨ä¸º</span></span><br><span class="line">[<span class="string">&#x27;file2&#x27;</span>, <span class="string">&#x27;file1&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># éå†åˆ°çš„ä¸‹ä¸€ä¸ªroot, é‡Œé¢çš„æ–‡ä»¶å’Œç›®å½•éƒ½ä¸ºç©º.</span></span><br><span class="line">/tmp/1/folder2</span><br><span class="line">[]</span><br><span class="line">[]</span><br><span class="line"></span><br><span class="line"><span class="comment"># éå†åˆ°çš„ä¸‹ä¸€ä¸ªroot</span></span><br><span class="line">/tmp/1/folder1</span><br><span class="line">[]</span><br><span class="line">[]</span><br></pre></td></tr></table></figure><h2 id="éå†æ‰€æœ‰æ–‡ä»¶å¤¹"><a href="#éå†æ‰€æœ‰æ–‡ä»¶å¤¹" class="headerlink" title="éå†æ‰€æœ‰æ–‡ä»¶å¤¹"></a>éå†æ‰€æœ‰æ–‡ä»¶å¤¹</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line">path=<span class="string">r&quot;c:\users\iuxt\desktop\&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># è·å–åˆ°å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰å­ç›®å½•çš„ç»å¯¹è·¯å¾„</span></span><br><span class="line"><span class="string">for root,dirs,files in os.walk(path):</span></span><br><span class="line"><span class="string">    for dir in dirs:</span></span><br><span class="line"><span class="string">        print(os.path.join(root, dir))</span></span><br></pre></td></tr></table></figure><h2 id="éå†æ‰€æœ‰æ–‡ä»¶"><a href="#éå†æ‰€æœ‰æ–‡ä»¶" class="headerlink" title="éå†æ‰€æœ‰æ–‡ä»¶"></a>éå†æ‰€æœ‰æ–‡ä»¶</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line">path=<span class="string">r&quot;C:\users\iuxt\desktop\&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># è·å–åˆ°çš„æ˜¯æ­¤ç›®å½•ä¸‹å’Œå­ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶çš„ç»å¯¹è·¯å¾„</span></span><br><span class="line"><span class="string">for root,dirs,files in os.walk(path):</span></span><br><span class="line"><span class="string">    for file in files:</span></span><br><span class="line"><span class="string">        print(os.path.join(root, file))</span></span><br></pre></td></tr></table></figure><h2 id="éå†åˆ°æœ€æ·±çš„æ–‡ä»¶å¤¹"><a href="#éå†åˆ°æœ€æ·±çš„æ–‡ä»¶å¤¹" class="headerlink" title="éå†åˆ°æœ€æ·±çš„æ–‡ä»¶å¤¹"></a>éå†åˆ°æœ€æ·±çš„æ–‡ä»¶å¤¹</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">path=<span class="string">r&quot;/tmp/1/&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> root, dirs, files <span class="keyword">in</span> os.walk(path):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(dirs) == <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(root)</span><br></pre></td></tr></table></figure><h2 id="ä¸€ä¸ªä¾‹å­-è‡ªåŠ¨æ¸…ç†-MySQL-å¤‡ä»½æ–‡ä»¶"><a href="#ä¸€ä¸ªä¾‹å­-è‡ªåŠ¨æ¸…ç†-MySQL-å¤‡ä»½æ–‡ä»¶" class="headerlink" title="ä¸€ä¸ªä¾‹å­, è‡ªåŠ¨æ¸…ç† MySQL å¤‡ä»½æ–‡ä»¶"></a>ä¸€ä¸ªä¾‹å­, è‡ªåŠ¨æ¸…ç† MySQL å¤‡ä»½æ–‡ä»¶</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> glob</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">keep_file_num = <span class="number">60</span></span><br><span class="line">clean_folder = <span class="string">&quot;/data/backup/mysql/&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delete_files</span>(<span class="params">files</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    files: æ–‡ä»¶ç»å¯¹è·¯å¾„åˆ—è¡¨</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> file <span class="keyword">in</span> files:</span><br><span class="line">        os.remove(file)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;clean  &quot;</span> + file)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> root, dirs, files <span class="keyword">in</span> os.walk(clean_folder):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    root: å½“å‰éå†åˆ°çš„ç›®å½•, ä¹Ÿå°±æ˜¯æ‰€åœ¨çš„ç›®å½•, å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="string">    dirs: å½“å‰ç›®å½•ä¸‹çš„å­ç›®å½•åˆ—è¡¨</span></span><br><span class="line"><span class="string">    files: å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(dirs) == <span class="number">0</span>:</span><br><span class="line"></span><br><span class="line">        <span class="comment"># æ‰€æœ‰æ–‡ä»¶åˆ—è¡¨,ç»å¯¹è·¯å¾„</span></span><br><span class="line">        files = glob.glob(os.path.join(root, <span class="string">&#x27;*&#x27;</span>))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># æŒ‰ç…§æ—¶é—´æ’åº, æ—¶é—´æ—©çš„åœ¨å‰</span></span><br><span class="line">        files.sort(key=os.path.getmtime)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># é™¤å»ä¿ç•™çš„, å…¶ä½™çš„åˆ é™¤</span></span><br><span class="line">        clean_num = <span class="built_in">len</span>(files) - keep_file_num</span><br><span class="line">        <span class="keyword">if</span> clean_num &lt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            files = files[:clean_num]</span><br><span class="line">            delete_files(files)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pythonè¯»å†™æ–‡ä»¶</title>
      <link href="/posts/fe29bf0b/"/>
      <url>/posts/fe29bf0b/</url>
      
        <content type="html"><![CDATA[<p>ä½¿ç”¨ Python è¯»å†™æ–‡ä»¶å¾ˆæ–¹ä¾¿ï¼Œæœ‰å¤šç§æ–¹æ³•ï¼Œä½†æ˜¯è¯»å†™å¤§æ–‡ä»¶è¿˜æ˜¯éœ€è¦ä¼˜åŒ–çš„ã€‚</p><p>python open æ–‡ä»¶çš„æ¨¡å¼ï¼š</p><table><thead><tr><th>æ¨¡å¼</th><th>æè¿°</th></tr></thead><tbody><tr><td>r</td><td>ä»¥åªè¯»æ–¹å¼æ‰“å¼€æ–‡ä»¶ã€‚æ–‡ä»¶çš„æŒ‡é’ˆå°†ä¼šæ”¾åœ¨æ–‡ä»¶çš„å¼€å¤´ã€‚è¿™æ˜¯é»˜è®¤æ¨¡å¼ã€‚</td></tr><tr><td>rb</td><td>ä»¥äºŒè¿›åˆ¶æ ¼å¼æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ç”¨äºåªè¯»ã€‚æ–‡ä»¶æŒ‡é’ˆå°†ä¼šæ”¾åœ¨æ–‡ä»¶çš„å¼€å¤´ã€‚è¿™æ˜¯é»˜è®¤æ¨¡å¼ã€‚</td></tr><tr><td>r+</td><td>æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ç”¨äºè¯»å†™ã€‚æ–‡ä»¶æŒ‡é’ˆå°†ä¼šæ”¾åœ¨æ–‡ä»¶çš„å¼€å¤´ã€‚</td></tr><tr><td>rb+</td><td>ä»¥äºŒè¿›åˆ¶æ ¼å¼æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ç”¨äºè¯»å†™ã€‚æ–‡ä»¶æŒ‡é’ˆå°†ä¼šæ”¾åœ¨æ–‡ä»¶çš„å¼€å¤´ã€‚</td></tr><tr><td>w</td><td>æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶åªç”¨äºå†™å…¥ã€‚å¦‚æœè¯¥æ–‡ä»¶å·²å­˜åœ¨åˆ™å°†å…¶è¦†ç›–ã€‚å¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°æ–‡ä»¶ã€‚</td></tr><tr><td>wb</td><td>ä»¥äºŒè¿›åˆ¶æ ¼å¼æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶åªç”¨äºå†™å…¥ã€‚å¦‚æœè¯¥æ–‡ä»¶å·²å­˜åœ¨åˆ™å°†å…¶è¦†ç›–ã€‚å¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°æ–‡ä»¶ã€‚</td></tr><tr><td>w+</td><td>æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ç”¨äºè¯»å†™ã€‚å¦‚æœè¯¥æ–‡ä»¶å·²å­˜åœ¨åˆ™å°†å…¶è¦†ç›–ã€‚å¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°æ–‡ä»¶ã€‚</td></tr><tr><td>wb+</td><td>ä»¥äºŒè¿›åˆ¶æ ¼å¼æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ç”¨äºè¯»å†™ã€‚å¦‚æœè¯¥æ–‡ä»¶å·²å­˜åœ¨åˆ™å°†å…¶è¦†ç›–ã€‚å¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°æ–‡ä»¶ã€‚</td></tr><tr><td>a</td><td>æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ç”¨äºè¿½åŠ ã€‚å¦‚æœè¯¥æ–‡ä»¶å·²å­˜åœ¨ï¼Œæ–‡ä»¶æŒ‡é’ˆå°†ä¼šæ”¾åœ¨æ–‡ä»¶çš„ç»“å°¾ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ–°çš„å†…å®¹å°†ä¼šè¢«å†™å…¥åˆ°å·²æœ‰å†…å®¹ä¹‹åã€‚å¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°æ–‡ä»¶è¿›è¡Œå†™å…¥ã€‚</td></tr><tr><td>ab</td><td>ä»¥äºŒè¿›åˆ¶æ ¼å¼æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ç”¨äºè¿½åŠ ã€‚å¦‚æœè¯¥æ–‡ä»¶å·²å­˜åœ¨ï¼Œæ–‡ä»¶æŒ‡é’ˆå°†ä¼šæ”¾åœ¨æ–‡ä»¶çš„ç»“å°¾ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ–°çš„å†…å®¹å°†ä¼šè¢«å†™å…¥åˆ°å·²æœ‰å†…å®¹ä¹‹åã€‚å¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°æ–‡ä»¶è¿›è¡Œå†™å…¥ã€‚</td></tr><tr><td>a+</td><td>æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ç”¨äºè¯»å†™ã€‚å¦‚æœè¯¥æ–‡ä»¶å·²å­˜åœ¨ï¼Œæ–‡ä»¶æŒ‡é’ˆå°†ä¼šæ”¾åœ¨æ–‡ä»¶çš„ç»“å°¾ã€‚æ–‡ä»¶æ‰“å¼€æ—¶ä¼šæ˜¯è¿½åŠ æ¨¡å¼ã€‚å¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°æ–‡ä»¶ç”¨äºè¯»å†™ã€‚</td></tr><tr><td>ab+</td><td>ä»¥äºŒè¿›åˆ¶æ ¼å¼æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ç”¨äºè¿½åŠ ã€‚å¦‚æœè¯¥æ–‡ä»¶å·²å­˜åœ¨ï¼Œæ–‡ä»¶æŒ‡é’ˆå°†ä¼šæ”¾åœ¨æ–‡ä»¶çš„ç»“å°¾ã€‚å¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°æ–‡ä»¶ç”¨äºè¯»å†™ã€‚</td></tr></tbody></table><h2 id="è¯»å–å°æ–‡ä»¶"><a href="#è¯»å–å°æ–‡ä»¶" class="headerlink" title="è¯»å–å°æ–‡ä»¶"></a>è¯»å–å°æ–‡ä»¶</h2><blockquote><p>å°æ–‡ä»¶è¯»å–å¯ä»¥ç”¨ <code>readlines()</code>, è¿”å›ä¸€ä¸ªåˆ—è¡¨</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="built_in">print</span>(f.readlines())</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šä»£ç æ‰§è¡Œçš„ç»“æœ (æ¢è¡Œç¬¦ç”¨\n è¡¨ç¤º):</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">&#x27;111\n&#x27;</span>, <span class="string">&#x27;222\n&#x27;</span>, <span class="string">&#x27;333\n&#x27;</span>]</span><br></pre></td></tr></table></figure><h2 id="æŒ‰è¡Œè¯»å–è¶…å¤§æ–‡ä»¶"><a href="#æŒ‰è¡Œè¯»å–è¶…å¤§æ–‡ä»¶" class="headerlink" title="æŒ‰è¡Œè¯»å–è¶…å¤§æ–‡ä»¶"></a>æŒ‰è¡Œè¯»å–è¶…å¤§æ–‡ä»¶</h2><p>æ–‡ä»¶å¦‚æœæ¯”è¾ƒå¤§ï¼Œå°±ä¸èƒ½ä½¿ç”¨ <code>readlines()</code> æ¥è¯»å–äº†ï¼Œé‚£æ ·ä¼šå ç”¨å¤§é‡å†…å­˜ã€‚å¯ä»¥ä½¿ç”¨éå† <code>readline()</code> æ–¹æ³•æ¥å®ç°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        line = f.readline()</span><br><span class="line">        <span class="keyword">if</span> line:</span><br><span class="line">            <span class="built_in">print</span>(line, end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure><p>æˆ–è€…è¿™ç§å†™æ³•ï¼Œæ›´ç®€æ´ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;1.txt&quot;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">        <span class="built_in">print</span>(line)</span><br></pre></td></tr></table></figure><h2 id="å†™å…¥æ–‡ä»¶"><a href="#å†™å…¥æ–‡ä»¶" class="headerlink" title="å†™å…¥æ–‡ä»¶"></a>å†™å…¥æ–‡ä»¶</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;test.txt&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(data)</span><br></pre></td></tr></table></figure><h2 id="å†™å…¥å¤§æ–‡ä»¶"><a href="#å†™å…¥å¤§æ–‡ä»¶" class="headerlink" title="å†™å…¥å¤§æ–‡ä»¶"></a>å†™å…¥å¤§æ–‡ä»¶</h2><p>å†™å…¥å¤§æ–‡ä»¶ä¸€èˆ¬éƒ½æ˜¯è¿½åŠ å†™å…¥</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;test.txt&#x27;</span>, <span class="string">&#x27;a&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        f.write(<span class="string">&#x27;Hello, world!&#x27;</span>)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ–‡ä»¶ </tag>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>gpgä½¿ç”¨è®°å½•</title>
      <link href="/posts/e0fe652d/"/>
      <url>/posts/e0fe652d/</url>
      
        <content type="html"><![CDATA[<p>è¦äº†è§£ä»€ä¹ˆæ˜¯ GPGï¼Œå°±è¦å…ˆäº†è§£ PGPã€‚</p><p>1991 å¹´ï¼Œç¨‹åºå‘˜ Phil Zimmermann ä¸ºäº†é¿å¼€æ”¿åºœç›‘è§†ï¼Œå¼€å‘äº†åŠ å¯†è½¯ä»¶ PGPã€‚è¿™ä¸ªè½¯ä»¶éå¸¸å¥½ç”¨ï¼Œè¿…é€Ÿæµä¼ å¼€æ¥ï¼Œæˆäº†è®¸å¤šç¨‹åºå‘˜çš„å¿…å¤‡å·¥å…·ã€‚ä½†æ˜¯ï¼Œå®ƒæ˜¯å•†ä¸šè½¯ä»¶ï¼Œä¸èƒ½è‡ªç”±ä½¿ç”¨ã€‚æ‰€ä»¥ï¼Œè‡ªç”±è½¯ä»¶åŸºé‡‘ä¼šå†³å®šï¼Œå¼€å‘ä¸€ä¸ª PGP çš„æ›¿ä»£å“ï¼Œå–åä¸º GnuPGã€‚è¿™å°±æ˜¯ GPG çš„ç”±æ¥ã€‚</p><p>GPG æœ‰è®¸å¤šç”¨é€”ï¼Œæœ¬æ–‡ä¸»è¦ä»‹ç»æ–‡ä»¶åŠ å¯†ã€‚è‡³äºé‚®ä»¶çš„åŠ å¯†ï¼Œä¸åŒçš„é‚®ä»¶å®¢æˆ·ç«¯æœ‰ä¸åŒçš„è®¾ç½®ã€‚</p><p>å½“å‰æˆ‘çš„ç³»ç»Ÿç¯å¢ƒæ˜¯ <code>Ubuntu 22.04</code> gpg ç‰ˆæœ¬æ˜¯ <code>gpg (GnuPG) 2.2.27</code>ã€‚</p><h2 id="Key-ç®¡ç†"><a href="#Key-ç®¡ç†" class="headerlink" title="Key ç®¡ç†"></a>Key ç®¡ç†</h2><p>Key ID: è¯¥ GPG Key çš„å”¯ä¸€æ ‡è¯†ï¼Œå€¼ä¸ºä¸»å…¬é’¥çš„æŒ‡çº¹ï¼Œæ”¯æŒå¤šç§æ ¼å¼ (Fingerprint, Long key ID, Short key ID)ã€‚<br>UID: 1 ä¸ªæˆ–å¤šä¸ªï¼Œæ¯ä¸ª UID ç”± nameã€emailã€comment ç»„æˆï¼Œemail å’Œ comment å¯ä»¥ä¸ºç©ºã€‚<br>Expire: è¿‡æœŸæ—¶é—´ï¼Œå¯ä»¥ä¸ºæ°¸ä¹…ã€‚<br>ä¸»ç§˜é’¥å’Œä¸»å…¬é’¥ï¼ˆPrimary Keyï¼‰ã€å­ç§˜é’¥å’Œå­å…¬é’¥ï¼ˆSub Keyï¼‰éƒ½æ˜¯æˆå¯¹å‡ºç°çš„ï¼Œå…¶ç”¨é€”ä¹Ÿæ˜¯ä¸€è‡´çš„ã€‚<br>æ¯ä¸€å¯¹éƒ½åŒ…å«ä¸€ä¸ª key id å±æ€§ï¼ˆä¸º public key çš„æŒ‡çº¹ï¼‰ï¼Œå…¶ä¸­ä¸»å¯†é’¥&#x2F;ä¸»å…¬é’¥çš„ key id å°±æ˜¯å½“å‰ GPG Key çš„ Key IDã€‚</p><h2 id="åˆ›å»ºå¯†é’¥å¯¹"><a href="#åˆ›å»ºå¯†é’¥å¯¹" class="headerlink" title="åˆ›å»ºå¯†é’¥å¯¹"></a>åˆ›å»ºå¯†é’¥å¯¹</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¿«é€Ÿç”Ÿæˆå¯†é’¥å¯¹</span></span><br><span class="line">gpg --gen-key</span><br><span class="line"></span><br><span class="line"><span class="comment"># äº¤äº’å¼åˆ›å»º</span></span><br><span class="line">gpg --full-gen-key</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ â€“full-gen-key æ¥ç”Ÿæˆå¯†é’¥å¯¹ï¼Œé¦–å…ˆé€‰æ‹©å¯†é’¥ç±»å‹ï¼Œé€‰æ‹© 1 (é»˜è®¤) å³å¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ gpg --full-gen-key</span><br><span class="line"></span><br><span class="line">gpg (GnuPG) 2.2.27; Copyright (C) 2021 Free Software Foundation, Inc.</span><br><span class="line">This is free software: you are free to change and redistribute it.</span><br><span class="line">There is NO WARRANTY, to the extent permitted by law.</span><br><span class="line"></span><br><span class="line">Please <span class="keyword">select</span> what kind of key you want:</span><br><span class="line">   (1) RSA and RSA (default)</span><br><span class="line">   (2) DSA and Elgamal</span><br><span class="line">   (3) DSA (sign only)</span><br><span class="line">   (4) RSA (sign only)</span><br><span class="line">  (14) Existing key from card</span><br><span class="line">Your selection?</span><br></pre></td></tr></table></figure><p>ç„¶åé€‰æ‹©å¯†é’¥é•¿åº¦ï¼Œæ²¡æœ‰ç‰¹æ®Šéœ€æ±‚çš„è¯ä¿æŒ 3072 çš„é»˜è®¤é€‰é¡¹å³å¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">RSA keys may be between 1024 and 4096 bits long.</span><br><span class="line">What keysize <span class="keyword">do</span> you want? (3072)</span><br></pre></td></tr></table></figure><p>ç„¶åè®¾ç½®å¯†é’¥çš„æœ‰æ•ˆæœŸï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦é•¿æœŸä½¿ç”¨ï¼Œæ‰€ä»¥é€‰æ‹© 0 ï¼Œå¯†é’¥æ°¸ä¸è¿‡æœŸ, ä¹Ÿå¯ä»¥è¾“å…¥ 2yï¼Œ è¡¨ç¤º 2 å¹´ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Please specify how long the key should be valid.</span><br><span class="line">         0 = key does not expire</span><br><span class="line">      &lt;n&gt;  = key expires <span class="keyword">in</span> n days</span><br><span class="line">      &lt;n&gt;w = key expires <span class="keyword">in</span> n weeks</span><br><span class="line">      &lt;n&gt;m = key expires <span class="keyword">in</span> n months</span><br><span class="line">      &lt;n&gt;y = key expires <span class="keyword">in</span> n years</span><br><span class="line">Key is valid <span class="keyword">for</span>? (0)</span><br></pre></td></tr></table></figure><p>ç¡®å®šåï¼Œä¾æ¬¡è¾“å…¥å§“åã€ç”µå­é‚®ä»¶å’Œæ³¨é‡Š (å¯ä»¥ä¸å¡«)ï¼Œç„¶åé€‰æ‹© o ç¡®å®š, ç¡®å®šåä¼šå‡ºç°ä¸€ä¸ªçª—å£è®©è¾“å…¥å¯†ç ï¼Œè‡ªè¡Œè®¾ç½®ä¸€ä¸ªå¯†ç ã€‚ç„¶åå¯†é’¥å°±åˆ›å»ºæˆåŠŸäº†ï¼Œ é€šè¿‡å‘½ä»¤ <code>gpg --list-keys</code> å¯ä»¥æŸ¥çœ‹å½“å‰çš„å¯†é’¥</p><p>è¿™é‡Œæœ‰ä¸€ä¸²å­—ç¬¦ã€‚å°±æ˜¯ key çš„ idï¼Œåé¢çš„æ“ä½œéƒ½éœ€è¦è¿™ä¸ªã€‚</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202212271033949.png" alt="æŸ¥çœ‹key"></p><h2 id="åˆ›å»ºå­å¯†é’¥"><a href="#åˆ›å»ºå­å¯†é’¥" class="headerlink" title="åˆ›å»ºå­å¯†é’¥"></a>åˆ›å»ºå­å¯†é’¥</h2><p>ä¸Šé¢åˆ›å»ºçš„æ˜¯å…¬é’¥ï¼Œå¦‚æœä½¿ç”¨è¿™ä¸ªå¯†é’¥åŠ å¯†ï¼Œ é‚£ä¹ˆå¦‚æœå¯†é’¥ä¸å°å¿ƒæ³„éœ²ï¼Œ å°±å¿…é¡»åŠé”€æ•´ä¸ªå¯†é’¥ã€‚æ‰€ä»¥æˆ‘ä»¬åˆ›å»ºå­å¯†é’¥æ¥ä½¿ç”¨ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gpg --edit-key 4208C2FA114EE038F9EAD2374808D00D9D910E74</span><br></pre></td></tr></table></figure><p>è¿›å…¥ gpg æ§åˆ¶å°ï¼Œ è¾“å…¥ <code>addkey</code></p><p>è¾“å…¥ä¸€äº›é€‰æ‹©ï¼Œ è¿‡æœŸæ—¶é—´å»ºè®® 2yï¼Œç„¶åè¾“å…¥å¯†é’¥çš„å¯†ç åï¼Œåœ¨æ§åˆ¶å°è¾“å…¥ save ä¿å­˜é€€å‡ºã€‚</p><h2 id="å¯¼å‡ºå¯†é’¥"><a href="#å¯¼å‡ºå¯†é’¥" class="headerlink" title="å¯¼å‡ºå¯†é’¥"></a>å¯¼å‡ºå¯†é’¥</h2><p>å¯¼å‡ºå¯†é’¥é»˜è®¤æ˜¯äºŒè¿›åˆ¶å­˜å‚¨ï¼Œå¦‚æœéœ€è¦çº¯æ–‡æœ¬ï¼ŒåŠ ä¸Š <code>--armor</code> å‚æ•°</p><h3 id="å¯¼å‡ºä¸»å¯†é’¥"><a href="#å¯¼å‡ºä¸»å¯†é’¥" class="headerlink" title="å¯¼å‡ºä¸»å¯†é’¥"></a>å¯¼å‡ºä¸»å¯†é’¥</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯¼å‡ºå…¬é’¥å’Œç§é’¥</span></span><br><span class="line">gpg -o /data/gpg_key --export-secret-keys 4208C2FA114EE038F9EAD2374808D00D9D910E74</span><br><span class="line"></span><br><span class="line"><span class="comment"># åªå¯¼å‡ºå…¬é’¥</span></span><br><span class="line">gpg -o /data/gpg_pubkey --<span class="built_in">export</span> 4208C2FA114EE038F9EAD2374808D00D9D910E74</span><br></pre></td></tr></table></figure><p>ä¸»å¯†é’¥ä¸€å®šè¦ä¿å­˜å¥½ï¼Œä¸è¦æ³„éœ²</p><h3 id="å¯¼å‡ºå­å¯†é’¥"><a href="#å¯¼å‡ºå­å¯†é’¥" class="headerlink" title="å¯¼å‡ºå­å¯†é’¥"></a>å¯¼å‡ºå­å¯†é’¥</h3><p>ä¸ºä»€ä¹ˆä¼šå­˜åœ¨å­å¯†é’¥ï¼Ÿç†è®ºä¸Šåªéœ€ä¸€å¯¹ä¸»å¯†é’¥ï¼Œå°±å¯ä»¥å®Œæˆæ‰€æœ‰åŠ å¯†å’Œç­¾åçš„éœ€è¦äº†ã€‚è€Œ GPG æ”¯æŒä¸€å¯¹ä¸»å¯†é’¥å’Œè‹¥å¹²å¯¹å­å¯†é’¥ï¼Œä¸»è¦æ˜¯ä¸ºäº†å¯†é’¥æœ¬èº«çš„å®‰å…¨è€ƒè™‘ã€‚ä¾‹å¦‚éœ€è¦åœ¨å¤šå°è®¾å¤‡ä¸Šè¿›è¡Œç­¾åå’ŒåŠ å¯†æ“ä½œï¼Œå¦‚æœåœ¨æ¯ä¸ªæœºå™¨ä¸Šéƒ½ä½¿ç”¨ä¸»å¯†é’¥ï¼Œä¸€æ—¦ä¸¢å¤±ï¼Œåˆ™æ‰€æœ‰è®¾å¤‡ä¸Šçš„ä¿¡æ¯éƒ½å°†å¯ä»¥è¢«è§£å¯†ã€‚è€Œä¸”é™¤äº†æ’¤é”€æ•´ä¸ªä¸»å¯†é’¥ä¹‹å¤–ï¼Œæ²¡æœ‰ä»»ä½•å…¶ä»–åŠæ³•æ¥æ­¢æŸã€‚è€Œå¦‚æœå°†ä¸»å¯†é’¥ä¿å­˜åœ¨å®‰å…¨çš„åœ°æ–¹ï¼Œä»…åœ¨å¿…è¦çš„æ—¶å€™ä½¿ç”¨ï¼Œå…¶ä½™æœºå™¨ä¸Šéƒ½ä½¿ç”¨å­å¯†é’¥ã€‚é‚£ä¹ˆå¦‚æœä¸€å°æœºå™¨ä¸Šçš„å­å¯†é’¥ä¸¢å¤±ï¼Œåªæœ‰è¿™å°æœºå™¨ä¸Šçš„ä¿¡æ¯å¯èƒ½è¢«æ³„éœ²ã€‚è€Œä¸”æ— éœ€æ’¤é”€æ•´ä¸ªä¸»å¯†é’¥ï¼Œåªéœ€è¦ä½¿ç”¨ä¸»å¯†é’¥æ’¤é”€è¿™ä¸ªå­å¯†é’¥ï¼Œç„¶åé‡æ–°åˆ›å»ºä¸€ä¸ªå­å¯†é’¥å³å¯ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gpg -o /data/gpg_key.sub --export-secret-subkeys 4208C2FA114EE038F9EAD2374808D00D9D910E74</span><br></pre></td></tr></table></figure><h2 id="æŸ¥çœ‹å¯†é’¥"><a href="#æŸ¥çœ‹å¯†é’¥" class="headerlink" title="æŸ¥çœ‹å¯†é’¥"></a>æŸ¥çœ‹å¯†é’¥</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">gpg -k                   <span class="comment"># æŸ¥çœ‹å…¬é’¥</span></span><br><span class="line">gpg -K                   <span class="comment"># æŸ¥çœ‹ç§é’¥</span></span><br><span class="line">gpg --list-keys          <span class="comment"># æŸ¥çœ‹å…¬é’¥</span></span><br><span class="line">gpg --list-secret-keys   <span class="comment"># æŸ¥çœ‹ç§é’¥</span></span><br><span class="line">gpg --list-keys --keyid-format long          <span class="comment"># æŸ¥çœ‹å…¬é’¥ï¼Œæ‰“å°å‡ºæŒ‡çº¹</span></span><br><span class="line">gpg --list-secret-keys --keyid-format long   <span class="comment"># æŸ¥çœ‹ç§é’¥ï¼Œæ‰“å°å‡ºæŒ‡çº¹</span></span><br></pre></td></tr></table></figure><h3 id="å¯†é’¥ç±»å‹"><a href="#å¯†é’¥ç±»å‹" class="headerlink" title="å¯†é’¥ç±»å‹"></a>å¯†é’¥ç±»å‹</h3><p>æ¯ä¸ªå¯†é’¥å¼€å¤´éƒ½ä¼šæœ‰è¿™æ ·å‡ ä¸ªå­—æ¯ï¼špub&#x2F;sec&#x2F;sub&#x2F;ssb&#x2F;ï¼Œè¡¨ç¤ºè¿™ä¸ªå¯†é’¥çš„ç±»å‹ã€‚</p><p>åœ¨éå¯¹ç§°åŠ å¯†ç®—æ³•ä¸­ï¼Œå¯†é’¥éƒ½æ˜¯æˆå¯¹å‡ºç°çš„ã€‚pub å’Œ sec å°±åˆ†åˆ«è¡¨ç¤ºè¿™ä¸€å¯¹å¯†é’¥çš„å…¬é’¥å’Œç§é’¥ï¼Œè€Œ sub å’Œ ssb åˆ™åˆ†åˆ«è¡¨ç¤ºä¸€å¯¹å­å¯†é’¥çš„å…¬é’¥å’Œç§é’¥ã€‚</p><table><thead><tr><th>ç¼©å†™</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>pub</td><td>ä¸»å…¬é’¥</td></tr><tr><td>sec</td><td>ä¸»ç§é’¥</td></tr><tr><td>sub</td><td>å­å…¬é’¥</td></tr><tr><td>ssb</td><td>å­ç§é’¥</td></tr></tbody></table><h3 id="å¯†é’¥ç”¨é€”"><a href="#å¯†é’¥ç”¨é€”" class="headerlink" title="å¯†é’¥ç”¨é€”"></a>å¯†é’¥ç”¨é€”</h3><p>æ¯ä¸ªå¯†é’¥æ—è¾¹éƒ½ä¼šæœ‰æ–¹æ‹¬å·åŒ…å›´çš„ä¸€ä¸ªæˆ–å¤šä¸ªå­—æ¯ï¼Œå¯èƒ½å–å€¼æœ‰ E&#x2F;S&#x2F;C&#x2F;Aï¼Œè¡¨ç¤ºè¿™ä¸ªå¯†é’¥çš„ç”¨é€”ã€‚æ¯ä¸ªå€¼çš„å«ä¹‰å¦‚ä¸‹ï¼š</p><table><thead><tr><th>ç¼©å†™</th><th>å…¨ç§°</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>E</td><td>Encryption</td><td>åŠ å¯†</td></tr><tr><td>S</td><td>Signing</td><td>ç­¾å</td></tr><tr><td>C</td><td>Certification</td><td>è®¤è¯å…¶ä»–å­å¯†é’¥æˆ– uid</td></tr><tr><td>A</td><td>Authentication</td><td>èº«ä»½è®¤è¯ï¼Œä¾‹å¦‚ç”¨äº SSH ç™»å½•</td></tr></tbody></table><h3 id="å¯¼å‡ºå…¬é’¥"><a href="#å¯¼å‡ºå…¬é’¥" class="headerlink" title="å¯¼å‡ºå…¬é’¥"></a>å¯¼å‡ºå…¬é’¥</h3><blockquote><p>å…¬é’¥æ˜¯éœ€è¦å…¬å¼€çš„ï¼Œå¯ä»¥å°†å…¬é’¥å‘é€ç»™åˆ«äººï¼Œåˆ«äººç”¨äºåŠ å¯†</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gpg --armor --output /data/public-key.txt --<span class="built_in">export</span> 4208C2FA114EE038F9EAD2374808D00D9D910E74</span><br></pre></td></tr></table></figure><h4 id="ä¸Šä¼ å…¬é’¥"><a href="#ä¸Šä¼ å…¬é’¥" class="headerlink" title="ä¸Šä¼ å…¬é’¥"></a>ä¸Šä¼ å…¬é’¥</h4><blockquote><p>ä¹Ÿå¯ä»¥å°†å…¬é’¥ä¸Šä¼ åˆ°å…¬å…±æœåŠ¡å™¨ä¸Š</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gpg --send-keys 4208C2FA114EE038F9EAD2374808D00D9D910E74</span><br></pre></td></tr></table></figure><h3 id="å¯¼å‡ºåŠé”€è¯ä¹¦"><a href="#å¯¼å‡ºåŠé”€è¯ä¹¦" class="headerlink" title="å¯¼å‡ºåŠé”€è¯ä¹¦"></a>å¯¼å‡ºåŠé”€è¯ä¹¦</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gpg --generate-revocation 4208C2FA114EE038F9EAD2374808D00D9D910E74</span><br></pre></td></tr></table></figure><p>ä¸è¿‡å®é™…ä¸Šåœ¨ç”Ÿæˆå¯†åŒ™æ—¶å°±å·²ç»ç”Ÿæˆäº†ä¸€ä»½åŠé”€è¯ä¹¦äº†ï¼Œæ”¾åœ¨è¿™ä¸ªç›®å½•ä¸‹é¢ <code>~/.gnupg/openpgp-revocs.d/</code></p><h2 id="åˆ é™¤å¯†é’¥"><a href="#åˆ é™¤å¯†é’¥" class="headerlink" title="åˆ é™¤å¯†é’¥"></a>åˆ é™¤å¯†é’¥</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ é™¤ç§é’¥</span></span><br><span class="line">gpg --delete-secret-keys 4208C2FA114EE038F9EAD2374808D00D9D910E74</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤å…¬é’¥</span></span><br><span class="line">gpg --delete-keys 4208C2FA114EE038F9EAD2374808D00D9D910E74</span><br></pre></td></tr></table></figure><h3 id="åˆ é™¤å­å¯†é’¥"><a href="#åˆ é™¤å­å¯†é’¥" class="headerlink" title="åˆ é™¤å­å¯†é’¥"></a>åˆ é™¤å­å¯†é’¥</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">gpg --expert --edit-key x@zahui.fan</span><br><span class="line">gpg&gt; list</span><br><span class="line"></span><br><span class="line">pub  rsa3072/1065DD1957C255D3</span><br><span class="line">     åˆ›å»ºäºï¼š2022-12-27  æœ‰æ•ˆè‡³ï¼šæ°¸ä¸       å¯ç”¨äºï¼šSC</span><br><span class="line">     ä¿¡ä»»åº¦ï¼šæœªçŸ¥        æœ‰æ•ˆæ€§ï¼šæœªçŸ¥</span><br><span class="line">ssb  rsa3072/77FD7CF225B6A92B</span><br><span class="line">     åˆ›å»ºäºï¼š2022-12-27  æœ‰æ•ˆè‡³ï¼šæ°¸ä¸       å¯ç”¨äºï¼šE</span><br><span class="line">ssb  rsa3072/CEA7CACC468ACDFE</span><br><span class="line">     åˆ›å»ºäºï¼š2022-12-27  æœ‰æ•ˆè‡³ï¼š2024-12-26  å¯ç”¨äºï¼šS</span><br><span class="line">ssb  rsa3072/539C73E4E4949E97</span><br><span class="line">     åˆ›å»ºäºï¼š2022-12-27  æœ‰æ•ˆè‡³ï¼š2024-12-26  å¯ç”¨äºï¼šE</span><br><span class="line">[ æœªçŸ¥ ] (1). zhanglikun (å¼ ç†å¤) &lt;x@zahui.fan&gt;</span><br><span class="line"></span><br><span class="line">gpg&gt;</span><br><span class="line">gpg&gt; key 77FD7CF225B6A92B</span><br><span class="line">gpg&gt; delkey</span><br><span class="line">gpg&gt; save</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨å¯†é’¥"><a href="#ä½¿ç”¨å¯†é’¥" class="headerlink" title="ä½¿ç”¨å¯†é’¥"></a>ä½¿ç”¨å¯†é’¥</h2><h3 id="ä¸»å¯†é’¥ç¦»çº¿ä½¿ç”¨"><a href="#ä¸»å¯†é’¥ç¦»çº¿ä½¿ç”¨" class="headerlink" title="ä¸»å¯†é’¥ç¦»çº¿ä½¿ç”¨"></a>ä¸»å¯†é’¥ç¦»çº¿ä½¿ç”¨</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">gpg -K</span><br><span class="line">[keyboxd]</span><br><span class="line">---------</span><br><span class="line">sec<span class="comment">#  rsa3072 2022-12-27 [SC]</span></span><br><span class="line">      3CBE03848A00F025624C14B41065DD1957C255D3</span><br><span class="line">uid             [ æœªçŸ¥ ] zhanglikun (å¼ ç†å¤) &lt;x@zahui.fan&gt;</span><br><span class="line">ssb   rsa3072 2022-12-27 [E]</span><br><span class="line">ssb   rsa3072 2022-12-27 [S] [æœ‰æ•ˆè‡³ï¼š2024-12-26]</span><br><span class="line">ssb   rsa3072 2022-12-27 [E] [æœ‰æ•ˆè‡³ï¼š2024-12-26]</span><br></pre></td></tr></table></figure><p>æ³¨æ„è¿™é‡Œæ˜¯ <code>sec#</code> ä¸æ˜¯ <code>sec</code>, è¯´æ˜æ²¡æœ‰ä¸»å¯†é’¥ã€‚</p><h3 id="å¯¼å…¥å¯†é’¥"><a href="#å¯¼å…¥å¯†é’¥" class="headerlink" title="å¯¼å…¥å¯†é’¥"></a>å¯¼å…¥å¯†é’¥</h3><p>åœ¨<mark class="hl-label red">è‡ªå·±çš„</mark>ç”µè„‘ä¸Šé¢</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gpg --import /data/gpg_key.sub</span><br></pre></td></tr></table></figure><h3 id="åŠ å¯†"><a href="#åŠ å¯†" class="headerlink" title="åŠ å¯†"></a>åŠ å¯†</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gpg -r iuxt@qq.com -e test.txt</span><br></pre></td></tr></table></figure><h3 id="è§£å¯†"><a href="#è§£å¯†" class="headerlink" title="è§£å¯†"></a>è§£å¯†</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gpg test.txt.gpg</span><br></pre></td></tr></table></figure><h3 id="ç­¾å"><a href="#ç­¾å" class="headerlink" title="ç­¾å"></a>ç­¾å</h3><p>æœ‰æ—¶ï¼Œæˆ‘ä»¬ä¸éœ€è¦åŠ å¯†æ–‡ä»¶ï¼Œåªéœ€è¦å¯¹æ–‡ä»¶ç­¾åï¼Œè¡¨ç¤ºè¿™ä¸ªæ–‡ä»¶ç¡®å®æ˜¯æˆ‘æœ¬äººå‘å‡ºçš„ã€‚sign å‚æ•°ç”¨æ¥ç­¾åã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gpg --sign test.txt</span><br></pre></td></tr></table></figure><p>ç„¶åç”Ÿæˆäº†ä¸€ä¸ª test.txt.gpg æ–‡ä»¶ï¼Œæˆ‘ä»¬æ‰“å¼€è¿™ä¸ªæ–‡ä»¶åï¼Œå‘ç°è¿™ä¹Ÿæ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶çš„æ•°æ®ï¼Œè¿™å¹¶ä¸æ˜¯åŠ å¯†åçš„æ•°æ®ï¼Œä¸ä¸Šè¾¹çš„äºŒè¿›åˆ¶æ•°æ®ä¸ä¸€æ ·ã€‚å¦‚æœæƒ³ç”Ÿæˆ ASCII ç çš„ç­¾åæ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ clearsign å‚æ•°</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gpg --clearsign test.txt</span><br></pre></td></tr></table></figure><p>å¦‚æœæƒ³ç”Ÿæˆå•ç‹¬çš„ç­¾åæ–‡ä»¶ï¼Œä¸æ–‡ä»¶å†…å®¹åˆ†å¼€å­˜æ”¾ï¼Œå¯ä»¥ä½¿ç”¨ detach-sign å‚æ•°ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gpg --detach-sign test.txt</span><br></pre></td></tr></table></figure><p>æ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶çš„æ•°æ®ï¼Œå¦‚æœæƒ³é‡‡ç”¨ ASCII ç å½¢å¼ï¼Œè¦åŠ ä¸Š armor å‚æ•°</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gpg --armor --detach-sign test.txt</span><br></pre></td></tr></table></figure><h3 id="ç­¾å-åŠ å¯†"><a href="#ç­¾å-åŠ å¯†" class="headerlink" title="ç­¾å + åŠ å¯†"></a>ç­¾å + åŠ å¯†</h3><p>id ä¹Ÿå¯ä»¥æ¢æˆ emailï¼Œ å¯ä»¥åŠ å¤šä¸ª â€“recipient å‚æ•°</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gpg --local-user [å‘ä¿¡è€…ID] --recipient [æ¥æ”¶è€…ID] --armor --sign --encrypt test.txt</span><br></pre></td></tr></table></figure><p>local-user å‚æ•°æŒ‡å®šç”¨å‘ä¿¡è€…çš„ç§é’¥ç­¾åï¼Œrecipient å‚æ•°æŒ‡å®šç”¨æ¥æ”¶è€…çš„å…¬é’¥åŠ å¯†ï¼Œarmor å‚æ•°è¡¨ç¤ºé‡‡ç”¨ ASCII ç å½¢å¼æ˜¾ç¤ºï¼Œsign å‚æ•°è¡¨ç¤ºéœ€è¦ç­¾åï¼Œencrypt å‚æ•°è¡¨ç¤ºæŒ‡å®šæºæ–‡ä»¶ã€‚</p><h3 id="éªŒè¯ç­¾å"><a href="#éªŒè¯ç­¾å" class="headerlink" title="éªŒè¯ç­¾å"></a>éªŒè¯ç­¾å</h3><p>æˆ‘ä»¬æ”¶åˆ°åˆ«äººç­¾ååçš„æ–‡ä»¶ï¼Œéœ€è¦ç”¨å¯¹æ–¹çš„å…¬é’¥éªŒè¯ç­¾åæ˜¯å¦ä¸ºçœŸã€‚verify å‚æ•°ç”¨æ¥éªŒè¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gpg --verify test.txt.asc test.txt</span><br></pre></td></tr></table></figure><h2 id="é…åˆ-GitHub-ä½¿ç”¨"><a href="#é…åˆ-GitHub-ä½¿ç”¨" class="headerlink" title="é…åˆ GitHub ä½¿ç”¨"></a>é…åˆ GitHub ä½¿ç”¨</h2><p>é¦–å…ˆï¼Œéœ€è¦è®© Git çŸ¥é“ç­¾åæ‰€ç”¨çš„ GPG å¯†é’¥ ID</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.signingkey &#123;key_id&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œåœ¨æ¯æ¬¡ commit çš„æ—¶å€™ï¼ŒåŠ ä¸Š -S å‚æ•°ï¼Œè¡¨ç¤ºè¿™æ¬¡æäº¤éœ€è¦ç”¨ GPG å¯†é’¥è¿›è¡Œç­¾åï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git commit -S -m <span class="string">&quot;...&quot;</span></span><br></pre></td></tr></table></figure><p>å¦‚æœè§‰å¾—æ¯æ¬¡éƒ½éœ€è¦æ‰‹åŠ¨åŠ ä¸Š -S æœ‰äº›éº»çƒ¦ï¼Œå¯ä»¥è®¾ç½® Git ä¸ºæ¯æ¬¡ commit è‡ªåŠ¨è¦æ±‚ç­¾åï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --global commit.gpgsign <span class="literal">true</span></span><br></pre></td></tr></table></figure><p>ç„¶åæ·»åŠ å˜é‡åˆ° <code>.bashrc</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> GPG_TTY=$(<span class="built_in">tty</span>)</span><br></pre></td></tr></table></figure><p>commit æ—¶çš†ä¼šå¼¹å‡ºå¯¹è¯æ¡†ï¼Œéœ€è¦è¾“å…¥è¯¥å¯†é’¥çš„å¯†ç ï¼Œä»¥ç¡®ä¿æ˜¯å¯†é’¥æ‹¥æœ‰è€…æœ¬äººæ“ä½œ</p>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åŠ å¯† </tag>
            
            <tag> gpg </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨PowerShellæ“ä½œWindows Defender</title>
      <link href="/posts/lqkgw2cy/"/>
      <url>/posts/lqkgw2cy/</url>
      
        <content type="html"><![CDATA[<p>é¦–å…ˆéœ€è¦ä½¿ç”¨åˆ°ç®¡ç†å‘˜æƒé™è¿è¡Œ PowerShell</p><h2 id="æŸ¥çœ‹æ’é™¤åˆ—è¡¨"><a href="#æŸ¥çœ‹æ’é™¤åˆ—è¡¨" class="headerlink" title="æŸ¥çœ‹æ’é™¤åˆ—è¡¨"></a>æŸ¥çœ‹æ’é™¤åˆ—è¡¨</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$WDAVprefs</span> = <span class="built_in">Get-MpPreference</span></span><br><span class="line"><span class="variable">$WDAVprefs</span>.ExclusionPath</span><br></pre></td></tr></table></figure><h2 id="æ’é™¤æŒ‡å®šæ–‡ä»¶å¤¹"><a href="#æ’é™¤æŒ‡å®šæ–‡ä»¶å¤¹" class="headerlink" title="æ’é™¤æŒ‡å®šæ–‡ä»¶å¤¹"></a>æ’é™¤æŒ‡å®šæ–‡ä»¶å¤¹</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸¤ç§å†™æ³•ï¼ŒSet-MpPreference æ˜¯ç›´æ¥ä¿®æ”¹ï¼Œä¼šè¦†ç›–ä¹‹å‰çš„è§„åˆ™</span></span><br><span class="line">powershell.exe <span class="literal">-Command</span> <span class="string">&#x27;Set-MpPreference -ExclusionPath &quot;C:\xxx&quot;, &quot;D:\yyy&quot;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Add-MpPreference æ˜¯è¿½åŠ é…ç½®ã€‚</span></span><br><span class="line"><span class="built_in">Add-MpPreference</span> <span class="literal">-ExclusionPath</span> <span class="string">&quot;C:\Program Files (x86)\WinAgent\*&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹æ˜¯å¦ç”Ÿæ•ˆ</span></span><br><span class="line">(<span class="built_in">Get-MpPreference</span>).ExclusionPath | <span class="built_in">Select-String</span> <span class="string">&quot;C:\Program Files (x86)\WinAgent\*&quot;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows </tag>
            
            <tag> Command </tag>
            
            <tag> PowerShell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CentOS7æ›´æ–°å†…æ ¸ç‰ˆæœ¬</title>
      <link href="/posts/8a7e6530/"/>
      <url>/posts/8a7e6530/</url>
      
        <content type="html"><![CDATA[<h2 id="ç¡®è®¤å½“å‰å†…æ ¸ç‰ˆæœ¬"><a href="#ç¡®è®¤å½“å‰å†…æ ¸ç‰ˆæœ¬" class="headerlink" title="ç¡®è®¤å½“å‰å†…æ ¸ç‰ˆæœ¬"></a>ç¡®è®¤å½“å‰å†…æ ¸ç‰ˆæœ¬</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">uname</span> -r</span><br></pre></td></tr></table></figure><h2 id="å®‰è£…å†…æ ¸ä»“åº“"><a href="#å®‰è£…å†…æ ¸ä»“åº“" class="headerlink" title="å®‰è£…å†…æ ¸ä»“åº“"></a>å®‰è£…å†…æ ¸ä»“åº“</h2><blockquote><p>ä»“åº“çš„å®˜æ–¹åœ°å€æ˜¯ï¼š <a href="http://elrepo.org/tiki/HomePage">http://elrepo.org/tiki/HomePage</a></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org</span><br><span class="line">yum install https://www.elrepo.org/elrepo-release-7.el7.elrepo.noarch.rpm</span><br></pre></td></tr></table></figure><h2 id="æŸ¥çœ‹å¯ç”¨çš„å†…æ ¸åˆ—è¡¨"><a href="#æŸ¥çœ‹å¯ç”¨çš„å†…æ ¸åˆ—è¡¨" class="headerlink" title="æŸ¥çœ‹å¯ç”¨çš„å†…æ ¸åˆ—è¡¨"></a>æŸ¥çœ‹å¯ç”¨çš„å†…æ ¸åˆ—è¡¨</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum --disablerepo=<span class="string">&quot;*&quot;</span> --enablerepo=<span class="string">&quot;elrepo-kernel&quot;</span> list available</span><br></pre></td></tr></table></figure><h2 id="å®‰è£…-LTS-ç‰ˆå†…æ ¸"><a href="#å®‰è£…-LTS-ç‰ˆå†…æ ¸" class="headerlink" title="å®‰è£… LTS ç‰ˆå†…æ ¸"></a>å®‰è£… LTS ç‰ˆå†…æ ¸</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum --enablerepo=elrepo-kernel install kernel-lt-devel kernel-lt kernel-lt-tools kernel-lt-tools-libs-devel -y</span><br></pre></td></tr></table></figure><h2 id="æŸ¥çœ‹å½“å‰ç³»ç»Ÿå¯ç”¨çš„å†…æ ¸"><a href="#æŸ¥çœ‹å½“å‰ç³»ç»Ÿå¯ç”¨çš„å†…æ ¸" class="headerlink" title="æŸ¥çœ‹å½“å‰ç³»ç»Ÿå¯ç”¨çš„å†…æ ¸"></a>æŸ¥çœ‹å½“å‰ç³»ç»Ÿå¯ç”¨çš„å†…æ ¸</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk -F\&#x27; <span class="string">&#x27;$1==&quot;menuentry &quot; &#123;print i++ &quot; : &quot; $2&#125;&#x27;</span> /etc/grub2.cfg</span><br></pre></td></tr></table></figure><h2 id="ä¿®æ”¹é»˜è®¤å†…æ ¸"><a href="#ä¿®æ”¹é»˜è®¤å†…æ ¸" class="headerlink" title="ä¿®æ”¹é»˜è®¤å†…æ ¸"></a>ä¿®æ”¹é»˜è®¤å†…æ ¸</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grub2-set-default 0</span><br></pre></td></tr></table></figure><h2 id="ç”Ÿæˆ-grub-é…ç½®"><a href="#ç”Ÿæˆ-grub-é…ç½®" class="headerlink" title="ç”Ÿæˆ grub é…ç½®"></a>ç”Ÿæˆ grub é…ç½®</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grub2-mkconfig -o /boot/grub2/grub.cfg</span><br></pre></td></tr></table></figure><h2 id="é‡å¯ç³»ç»Ÿ"><a href="#é‡å¯ç³»ç»Ÿ" class="headerlink" title="é‡å¯ç³»ç»Ÿ"></a>é‡å¯ç³»ç»Ÿ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reboot</span><br></pre></td></tr></table></figure><h2 id="åˆ é™¤æ—§çš„å†…æ ¸-å¯é€‰"><a href="#åˆ é™¤æ—§çš„å†…æ ¸-å¯é€‰" class="headerlink" title="åˆ é™¤æ—§çš„å†…æ ¸ (å¯é€‰)"></a>åˆ é™¤æ—§çš„å†…æ ¸ (å¯é€‰)</h2><blockquote><mark class="hl-label red">åˆ é™¤å†…æ ¸æœ‰é£é™©</mark>ï¼Œå¹²ä¸å¹²è‡ªè¡Œè¯„ä¼°</blockquote><h3 id="æŸ¥çœ‹å½“å‰å®‰è£…çš„å†…æ ¸"><a href="#æŸ¥çœ‹å½“å‰å®‰è£…çš„å†…æ ¸" class="headerlink" title="æŸ¥çœ‹å½“å‰å®‰è£…çš„å†…æ ¸"></a>æŸ¥çœ‹å½“å‰å®‰è£…çš„å†…æ ¸</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -qa | grep kernel</span><br></pre></td></tr></table></figure><h3 id="åˆ é™¤æ—§çš„å†…æ ¸"><a href="#åˆ é™¤æ—§çš„å†…æ ¸" class="headerlink" title="åˆ é™¤æ—§çš„å†…æ ¸"></a>åˆ é™¤æ—§çš„å†…æ ¸</h3><blockquote><p>å‚è€ƒä¸Šä¸€æ­¥è¾“å‡ºçš„åŒ…å</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum remove kernel-3.10.0-327.el7.x86_64</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
            <tag> centos </tag>
            
            <tag> Kernel </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¤‡ä»½MySQLè„šæœ¬-shellç‰ˆ</title>
      <link href="/posts/lqevsmdb/"/>
      <url>/posts/lqevsmdb/</url>
      
        <content type="html"><![CDATA[<p>å¤‡ä»½æ•°æ®åº“, å¹¶æ’é™¤ç³»ç»Ÿåº“, ä½¿ç”¨ mysqldump</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">set</span> -euo pipefail</span><br><span class="line"></span><br><span class="line">mysql_host=10.0.0.187</span><br><span class="line">mysql_user=root</span><br><span class="line">mysql_passwd=password</span><br><span class="line">exclude_databases=information_schema|performance_schema|sys|mysql</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;å¼€å§‹å¤‡ä»½æ•°æ®åº“â€¦â€¦&quot;</span></span><br><span class="line">mysql -h<span class="string">&quot;<span class="variable">$&#123;mysql_host&#125;</span>&quot;</span> -u<span class="string">&quot;<span class="variable">$&#123;mysql_user&#125;</span>&quot;</span> -p<span class="string">&quot;<span class="variable">$&#123;mysql_passwd&#125;</span>&quot;</span> -N -e <span class="string">&quot;show databases;&quot;</span> | grep -Ev <span class="string">&quot;<span class="variable">$&#123;exclude_databases&#125;</span>&quot;</span> | xargs mysqldump -h<span class="string">&quot;<span class="variable">$&#123;mysql_host&#125;</span>&quot;</span> -u<span class="string">&quot;<span class="variable">$&#123;mysql_user&#125;</span>&quot;</span> -p<span class="string">&quot;<span class="variable">$&#123;mysql_passwd&#125;</span>&quot;</span> --databases &gt; $(<span class="built_in">pwd</span>)/mysql_backup.sql</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è„šæœ¬ </tag>
            
            <tag> Shell </tag>
            
            <tag> å¤‡ä»½è¿˜åŸ </tag>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è°ƒæ•´Dockerå®¹å™¨å†…çš„æ—¶åŒº</title>
      <link href="/posts/3c828831/"/>
      <url>/posts/3c828831/</url>
      
        <content type="html"><![CDATA[<p>å®¹å™¨å†…çš„æ—¶åŒºé—®é¢˜ä¼šå½±å“åˆ°æœåŠ¡æ‰“å°çš„æ—¥å¿—, æ‰€ä»¥è®¾ç½®æ—¶åŒºæ˜¯å¾ˆæœ‰å¿…è¦çš„, è®¾ç½®å®¹å™¨å†…æ—¶åŒºçš„æ–¹æ³•ä¸€èˆ¬æœ‰:</p><ol><li>è®¾ç½® TZ ç¯å¢ƒå˜é‡</li><li>æŒ‚è½½ä¸»æœºçš„æ—¶åŒºæ–‡ä»¶</li><li>ç›´æ¥ä¿®æ”¹é•œåƒçš„ dockerfile,å°†æ—¶åŒºé»˜è®¤é…ç½®åœ¨é•œåƒé‡Œ</li></ol><h2 id="è®¾ç½®-TZ-ç¯å¢ƒå˜é‡"><a href="#è®¾ç½®-TZ-ç¯å¢ƒå˜é‡" class="headerlink" title="è®¾ç½® TZ ç¯å¢ƒå˜é‡"></a>è®¾ç½® TZ ç¯å¢ƒå˜é‡</h2><p>docker ç¯å¢ƒä¸‹, å¢åŠ  -e å‚æ•°:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name <span class="built_in">test</span> --<span class="built_in">rm</span> -ti -e TZ=Asia/Shanghai debian <span class="built_in">date</span></span><br></pre></td></tr></table></figure><p>è¿™ç§æ–¹æ³•ä¹Ÿå¯ä»¥å†™åœ¨ Dockerfile é‡Œé¢, å¢åŠ ä¸€è¡Œ:</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ENV</span> TZ Asia/Shanghai</span><br></pre></td></tr></table></figure><blockquote><p>ç»æµ‹è¯•: Debian CentOS é•œåƒå¯ä»¥æ”¯æŒè¿™ç§æ–¹æ¡ˆ<br>Ubuntu Alpine ä¸æ”¯æŒè¿™ç§æ–¹æ¡ˆ</p></blockquote><h2 id="æŒ‚è½½ä¸»æœºçš„-timezone-å’Œ-localtime"><a href="#æŒ‚è½½ä¸»æœºçš„-timezone-å’Œ-localtime" class="headerlink" title="æŒ‚è½½ä¸»æœºçš„ timezone å’Œ localtime"></a>æŒ‚è½½ä¸»æœºçš„ timezone å’Œ localtime</h2><p>Docker ç¯å¢ƒä¸‹, å¢åŠ  -v å‚æ•°:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name <span class="built_in">test</span> --<span class="built_in">rm</span> -ti -v /etc/timezone:/etc/timezone:ro -v /etc/localtime:/etc/localtime:ro alpine <span class="built_in">date</span></span><br></pre></td></tr></table></figure><p>é€‚ç”¨äºå¤§éƒ¨åˆ†é•œåƒ, ç‰¹ç‚¹æ˜¯å’Œä¸»æœºä¿æŒä¸€è‡´, ç¼ºç‚¹æ˜¯ä¾èµ–ä¸»æœºçš„ç¯å¢ƒ</p><h2 id="é€šè¿‡-build-é•œåƒä¿®æ”¹"><a href="#é€šè¿‡-build-é•œåƒä¿®æ”¹" class="headerlink" title="é€šè¿‡ build é•œåƒä¿®æ”¹"></a>é€šè¿‡ build é•œåƒä¿®æ”¹</h2><h3 id="Alpine"><a href="#Alpine" class="headerlink" title="Alpine"></a>Alpine</h3><p>å°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ° Dockerfile ä¸­ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ENV</span> TZ Asia/Shanghai</span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apk add tzdata &amp;&amp; <span class="built_in">cp</span> /usr/share/zoneinfo/<span class="variable">$&#123;TZ&#125;</span> /etc/localtime</span></span><br><span class="line">    &amp;&amp; echo $&#123;TZ&#125; &gt; /etc/timezone</span><br><span class="line">    &amp;&amp; apk del tzdata</span><br></pre></td></tr></table></figure><h3 id="Debian"><a href="#Debian" class="headerlink" title="Debian"></a>Debian</h3><p>Debian åŸºç¡€é•œåƒ ä¸­å·²ç»å®‰è£…äº† tzdata åŒ…ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ° Dockerfile ä¸­ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ENV</span> TZ=Asia/Shanghai</span><br><span class="line">    DEBIAN_FRONTEND=noninteractive</span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">ln</span> -fs /usr/share/zoneinfo/<span class="variable">$&#123;TZ&#125;</span> /etc/localtime</span></span><br><span class="line">    &amp;&amp; echo $&#123;TZ&#125; &gt; /etc/timezone</span><br><span class="line">    &amp;&amp; dpkg-reconfigure --frontend noninteractive tzdata</span><br><span class="line">    &amp;&amp; rm -rf /var/lib/apt/lists/*</span><br></pre></td></tr></table></figure><h3 id="Ubuntu"><a href="#Ubuntu" class="headerlink" title="Ubuntu"></a>Ubuntu</h3><p>Ubuntu åŸºç¡€é•œåƒä¸­æ²¡æœ‰å®‰è£…äº† tzdata åŒ…ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å…ˆå®‰è£… tzdata åŒ…ã€‚<br>æˆ‘ä»¬å¯ä»¥å°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ° Dockerfile ä¸­ã€‚</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ENV</span> TZ=Asia/Shanghai</span><br><span class="line">    DEBIAN_FRONTEND=noninteractive</span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt update</span></span><br><span class="line">    &amp;&amp; apt install -y tzdata</span><br><span class="line">    &amp;&amp; ln -fs /usr/share/zoneinfo/$&#123;TZ&#125; /etc/localtime</span><br><span class="line">    &amp;&amp; echo $&#123;TZ&#125; &gt; /etc/timezone</span><br><span class="line">    &amp;&amp; dpkg-reconfigure --frontend noninteractive tzdata</span><br><span class="line">    &amp;&amp; rm -rf /var/lib/apt/lists/*</span><br></pre></td></tr></table></figure><h3 id="CentOS"><a href="#CentOS" class="headerlink" title="CentOS"></a>CentOS</h3><p>CentOS åŸºç¡€é•œåƒ ä¸­å·²ç»å®‰è£…äº† tzdata åŒ…ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ° Dockerfile ä¸­ã€‚</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ENV</span> TZ Asia/Shanghai</span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">ln</span> -fs /usr/share/zoneinfo/<span class="variable">$&#123;TZ&#125;</span> /etc/localtime</span></span><br><span class="line">    &amp;&amp; echo $&#123;TZ&#125; &gt; /etc/timezone</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å®¹å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
            <tag> timezone </tag>
            
            <tag> æ—¶åŒº </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŸºäºUbuntuçš„è½¯è·¯ç”±æ­å»ºè®°å½•</title>
      <link href="/posts/cfedbd03/"/>
      <url>/posts/cfedbd03/</url>
      
        <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æˆ‘ä¸€ç›´ä½¿ç”¨çš„æ˜¯æ–è®¯ k3 è¿™æ¬¾ä¸‡å…ƒè·¯ç”±å™¨ğŸ˜‚ï¼Œä¸€ç›´ç”¨çš„æ˜¯ openwrtï¼Œä¸è¿‡ openwrt ä¿¡å·çœŸå¿ƒä¸å¥½ï¼Œåˆ·å›å®˜æ–¹ root ç³»ç»Ÿï¼Œæ„Ÿè§‰é‡è·äº†æ–°ç”Ÿï¼Œç„¶åå†³å®šè·¯ç”±å™¨åªåš WiFi å…±äº«ï¼Œå…¶ä»–åŠŸèƒ½äº¤ç»™è½¯è·¯ç”±ã€‚<br>æˆ‘çš„è½¯è·¯ç”±æ˜¯ä¹°çš„åŒç½‘å£æœºå™¨ï¼Œj4125 çš„ cpu åšè½¯è·¯ç”±ç»°ç»°æœ‰ä½™äº†, ä¸œè¥¿å¦‚å›¾:</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202212192147769.png" alt="åŒç½‘å£è½¯è·¯ç”±|431"></p><p>ç³»ç»Ÿä½¿ç”¨çš„æ˜¯ ubuntu22.04ï¼Œä»¥ä¸‹æ­¥éª¤éƒ½ä»¥æ­¤ç³»ç»Ÿä¸ºåŸºç¡€è¿›è¡Œï¼Œç½‘ç»œæ‹“æ‰‘å¦‚ä¸‹ï¼š</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202212191312730.png" alt="ç½‘ç»œæ‹“æ‰‘"></p><p>æˆ‘è‡ªå·±å®šä¹‰çš„ç½‘æ®µï¼Œç½‘æ®µä¸å¯ä»¥æœ‰äº¤å‰ã€‚</p><table><thead><tr><th>è®¾å¤‡</th><th>LAN ç½‘æ®µ</th><th>WAN é…ç½®</th></tr></thead><tbody><tr><td>å…‰çŒ«</td><td>192.168.1.0&#x2F;24</td><td>æ‹¨å·ä¸Šç½‘</td></tr><tr><td>è½¯è·¯ç”±</td><td>192.168.3.0&#x2F;24</td><td>DHCP è‡ªåŠ¨è·å–åœ°å€</td></tr><tr><td>æ–è®¯è·¯ç”±å™¨</td><td>192.168.2.0&#x2F;24</td><td>å›ºå®š IPï¼Œå›ºå®šç½‘å…³åœ°å€</td></tr></tbody></table><h2 id="å®šä¹‰å†…å¤–ç½‘"><a href="#å®šä¹‰å†…å¤–ç½‘" class="headerlink" title="å®šä¹‰å†…å¤–ç½‘"></a>å®šä¹‰å†…å¤–ç½‘</h2><table><thead><tr><th>ç½‘å¡è®¾å¤‡å</th><th>å®šä¹‰</th></tr></thead><tbody><tr><td>enp1s0</td><td>å¤–ç½‘</td></tr><tr><td>enp2s0</td><td>å†…ç½‘</td></tr></tbody></table><p>é‚£ä¹ˆ ç»™å¤–ç½‘ç½‘å¡è®¾ç½® dhcpï¼Œä»å…‰çŒ«è‡ªåŠ¨è·å– ipï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨è®¾ç½® ip<br>å†…ç½‘ç½‘å¡å›ºå®šä¸ª ipï¼Œä¸ç”¨è®¾ç½®ç½‘å…³å’Œ dnsï¼Œé…ç½®æ–‡ä»¶å¦‚ä¸‹</p><p>vim &#x2F;etc&#x2F;netplan&#x2F;00-installer-config.yaml</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">network:</span></span><br><span class="line">  <span class="attr">ethernets:</span></span><br><span class="line">    <span class="attr">enp1s0:</span></span><br><span class="line">      <span class="attr">dhcp4:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">dhcp6:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">enp2s0:</span></span><br><span class="line">      <span class="attr">addresses:</span> [ <span class="number">192.168</span><span class="number">.3</span><span class="number">.1</span><span class="string">/24</span> ]</span><br><span class="line">  <span class="attr">version:</span> <span class="number">2</span></span><br></pre></td></tr></table></figure><p>éªŒè¯ï¼š<code>ip a</code> çœ‹ä¸‹ä¸¤å¼ ç½‘å¡æ˜¯å¦éƒ½æœ‰äº† ipï¼Œåœ¨è½¯è·¯ç”±é‡Œæ‰§è¡Œ <code>curl baidu.com</code> çœ‹çœ‹æ˜¯å¦å¯ä»¥ä¸Šç½‘</p><h2 id="å®Œæˆè·¯ç”±åŠŸèƒ½"><a href="#å®Œæˆè·¯ç”±åŠŸèƒ½" class="headerlink" title="å®Œæˆè·¯ç”±åŠŸèƒ½"></a>å®Œæˆè·¯ç”±åŠŸèƒ½</h2><h3 id="å…³é—­-ufw"><a href="#å…³é—­-ufw" class="headerlink" title="å…³é—­ ufw"></a>å…³é—­ ufw</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">disable</span> --now ufw</span><br></pre></td></tr></table></figure><h3 id="åŠ è½½-nf-conntrack-æ¨¡å—"><a href="#åŠ è½½-nf-conntrack-æ¨¡å—" class="headerlink" title="åŠ è½½ nf_conntrack æ¨¡å—"></a>åŠ è½½ nf_conntrack æ¨¡å—</h3><p>vim &#x2F;etc&#x2F;modules-load.d&#x2F;custom-modules.conf</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># Located in /etc/modules-load.d/custom-modules.conf</span><br><span class="line">nf_conntrack</span><br></pre></td></tr></table></figure><p>lsmod æŸ¥çœ‹æœ‰æ²¡æœ‰åŠ è½½æ­¤æ¨¡å—ï¼Œ nf_conntrack ç”¨äºè·Ÿè¸ª iptables è§„åˆ™ã€‚</p><h3 id="ä¿®æ”¹å†…æ ¸å‚æ•°"><a href="#ä¿®æ”¹å†…æ ¸å‚æ•°" class="headerlink" title="ä¿®æ”¹å†…æ ¸å‚æ•°"></a>ä¿®æ”¹å†…æ ¸å‚æ•°</h3><p>vim &#x2F;etc&#x2F;sysctl.d&#x2F;99-forward.conf</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># Located in /etc/sysctl.d/99-forward.conf</span><br><span class="line">net.ipv4.ip_forward=1</span><br><span class="line">net.ipv4.conf.all.forwarding=1</span><br><span class="line">net.ipv4.conf.default.forwarding=1</span><br><span class="line">net.ipv4.conf.all.route_localnet=1</span><br><span class="line"></span><br><span class="line">net.ipv6.conf.all.forwarding=1</span><br><span class="line">net.ipv6.conf.default.forwarding=1</span><br></pre></td></tr></table></figure><h3 id="iptables-è„šæœ¬"><a href="#iptables-è„šæœ¬" class="headerlink" title="iptables è„šæœ¬"></a>iptables è„šæœ¬</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># /data/firewall-set.sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ ¹æ®ä½ çš„WANç½‘å¡åç§°å¯¹åº”ä¿®æ”¹ï¼ï¼ï¼</span></span><br><span class="line">WAN_NAME=<span class="string">&#x27;enp1s0&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># IPv4è®¾ç½®</span></span><br><span class="line">iptables -t nat -N mt_rtr_4_n_rtr</span><br><span class="line">iptables -t nat -A POSTROUTING -j mt_rtr_4_n_rtr</span><br><span class="line">iptables -t nat -A mt_rtr_4_n_rtr -o <span class="variable">$&#123;WAN_NAME&#125;</span> -j MASQUERADE <span class="comment"># æ·»åŠ è·¯ç”±åˆ°ä½œä¸ºWANçš„ç½‘å¡çš„è‡ªåŠ¨æºåœ°å€è½¬æ¢è§„åˆ™</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ IPv4è½¬å‘ä¼˜åŒ–è§„åˆ™</span></span><br><span class="line">iptables -t mangle -N mt_rtr_4_m_rtr </span><br><span class="line">iptables -t mangle -A FORWARD -j mt_rtr_4_m_rtr</span><br><span class="line">iptables -t mangle -A mt_rtr_4_m_rtr -o <span class="variable">$&#123;WAN_NAME&#125;</span> -p tcp -m tcp --tcp-flags SYN,RST SYN -j TCPMSS --clamp-mss-to-pmtu <span class="comment"># é’ˆå¯¹PPPoEé“¾æ¥çš„ä¼˜åŒ–</span></span><br><span class="line">iptables -t mangle -A mt_rtr_4_m_rtr -m state --state RELATED,ESTABLISHED -j ACCEPT <span class="comment"># å…è®¸å·²å»ºç«‹è¿æ¥çš„æ•°æ®åŒ…ç›´æ¥é€šè¿‡</span></span><br><span class="line">iptables -t mangle -A mt_rtr_4_m_rtr -m conntrack --ctstate INVALID -j DROP</span><br><span class="line">iptables -t mangle -A mt_rtr_4_m_rtr -p tcp -m tcp ! --tcp-flags FIN,SYN,RST,ACK SYN -m state --state NEW -j DROP</span><br><span class="line">iptables -t mangle -A mt_rtr_4_m_rtr -p tcp -m tcp --tcp-flags FIN,SYN,RST,PSH,ACK,URG FIN,SYN,RST,PSH,ACK,URG -j DROP</span><br><span class="line">iptables -t mangle -A mt_rtr_4_m_rtr -p tcp -m tcp --tcp-flags FIN,SYN,RST,PSH,ACK,URG NONE -j DROP</span><br><span class="line">iptables -t mangle -A mt_rtr_4_m_rtr -i br_lan -o <span class="variable">$&#123;WAN_NAME&#125;</span> -j ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="comment"># IPv6 NATè®¾ç½®ï¼Œä¸IPv4åŸºæœ¬ä¸€è‡´</span></span><br><span class="line">ip6tables -t nat -N mt_rtr_6_n_rtr</span><br><span class="line">ip6tables -t nat -A POSTROUTING -j mt_rtr_6_n_rtr</span><br><span class="line">ip6tables -t nat -A mt_rtr_6_n_rtr -o <span class="variable">$&#123;WAN_NAME&#125;</span> -j MASQUERADE <span class="comment"># æ·»åŠ è·¯ç”±åˆ°ä½œä¸ºWANçš„ç½‘å¡çš„è‡ªåŠ¨æºåœ°å€è½¬æ¢è§„åˆ™</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ IPv6è½¬å‘ä¼˜åŒ–è§„åˆ™</span></span><br><span class="line">ip6tables -t mangle -N mt_rtr_6_m_rtr</span><br><span class="line">ip6tables -t mangle -A FORWARD -j mt_rtr_6_m_rtr</span><br><span class="line">ip6tables -t mangle -A mt_rtr_6_m_rtr -o <span class="variable">$&#123;WAN_NAME&#125;</span> -p tcp -m tcp --tcp-flags SYN,RST SYN -j TCPMSS --clamp-mss-to-pmtu</span><br><span class="line">ip6tables -t mangle -A mt_rtr_6_m_rtr -m state --state RELATED,ESTABLISHED -j ACCEPT</span><br><span class="line">ip6tables -t mangle -A mt_rtr_6_m_rtr -m conntrack --ctstate INVALID -j DROP</span><br><span class="line">ip6tables -t mangle -A mt_rtr_6_m_rtr -p tcp -m tcp ! --tcp-flags FIN,SYN,RST,ACK SYN -m state --state NEW -j DROP</span><br><span class="line">ip6tables -t mangle -A mt_rtr_6_m_rtr -p tcp -m tcp --tcp-flags FIN,SYN,RST,PSH,ACK,URG FIN,SYN,RST,PSH,ACK,URG -j DROP</span><br><span class="line">ip6tables -t mangle -A mt_rtr_6_m_rtr -p tcp -m tcp --tcp-flags FIN,SYN,RST,PSH,ACK,URG NONE -j DROP</span><br><span class="line">ip6tables -t mangle -A mt_rtr_6_m_rtr -i br_lan -o <span class="variable">$&#123;WAN_NAME&#125;</span> -j ACCEPT</span><br></pre></td></tr></table></figure><p>ä»¥ä¸‹æ­¥éª¤äºŒé€‰ä¸€ï¼š</p><ol><li>å¼€æœºæ‰§è¡Œæ­¤è„šæœ¬</li><li>ä½¿ç”¨ <code>iptables-persistent</code> è¿›è¡ŒæŒä¹…åŒ–é…ç½®: <code>sudo apt install iptables-persistent</code> root èº«ä»½è¿è¡Œè„šæœ¬ï¼Œ ç„¶åæ‰§è¡Œ <code>netfilter-persistent save</code></li></ol><p>éªŒè¯ï¼š è¿æ¥æ–è®¯è·¯ç”±å™¨ï¼Œ è·¯ç”±å™¨ WAN å£ IP é…ç½®æˆ <code>192.168.3.2</code>ï¼ŒWAN å£ç½‘å…³é…ç½®æˆ <code>192.168.3.1</code>ï¼ŒWAN å£ DNS é…ç½®æˆ <code>114.114.114.114</code>ï¼Œæ£€æŸ¥é€šè¿‡æ–è®¯è·¯ç”±å™¨æ˜¯å¦å¯ä»¥ä¸Šç½‘</p><h2 id="éƒ¨ç½²-DHCP-æœåŠ¡ï¼ˆå¯é€‰ï¼‰"><a href="#éƒ¨ç½²-DHCP-æœåŠ¡ï¼ˆå¯é€‰ï¼‰" class="headerlink" title="éƒ¨ç½² DHCP æœåŠ¡ï¼ˆå¯é€‰ï¼‰"></a>éƒ¨ç½² DHCP æœåŠ¡ï¼ˆå¯é€‰ï¼‰</h2><p>éƒ¨ç½² DHCP æœåŠ¡å¯ä»¥è‡ªåŠ¨åˆ†é… IPï¼Œçœå»æ‰‹åŠ¨è®¾ç½® IP çš„çƒ¦æ¼ï¼Œæ¯”å¦‚ä¸Šä¸€æ­¥çš„æ–è®¯è·¯ç”±å™¨æ‰‹åŠ¨é…ç½® WAN å£ IPï¼Œæœ‰äº† DHCP åè®¾ç½® WAN å£ DHCP è·å– IP å³å¯ã€‚å¦å¤–å¦‚æœè·¯ç”±å™¨è®¾ç½®æˆ AP æ¨¡å¼ï¼Œ å¯ä»¥åˆ©ç”¨è½¯è·¯ç”±ä¸Šé¢çš„ DHCP æ¥ç»™å®¢æˆ·ç«¯åˆ†é… IP åœ°å€ã€‚</p><h3 id="å®‰è£…-DNSMASQ"><a href="#å®‰è£…-DNSMASQ" class="headerlink" title="å®‰è£… DNSMASQ"></a>å®‰è£… DNSMASQ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install dnsmasq</span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹é…ç½®æ–‡ä»¶"><a href="#ä¿®æ”¹é…ç½®æ–‡ä»¶" class="headerlink" title="ä¿®æ”¹é…ç½®æ–‡ä»¶"></a>ä¿®æ”¹é…ç½®æ–‡ä»¶</h3><p>dnsmasq çš„ dns æœåŠ¡å’Œ systemd-resolved.service å†²çªï¼ˆéƒ½å ç”¨ udp53 ç«¯å£ï¼‰ï¼Œæ‰€ä»¥éœ€è¦å…³é—­ systemd-resolved.service æˆ–è€… dnsmasq çš„ dns æœåŠ¡ã€‚è¿™é‡Œå…³é—­ dnsmasq çš„ dns æœåŠ¡</p><p>æ³¨æ„ï¼š&#x2F;etc&#x2F;dnsmasq.d é‡Œé¢çš„å…¶ä»–æ–‡ä»¶ä¸è¦æœ‰å†²çªçš„é…ç½®é¡¹ï¼ŒåŒä¸€é¡¹é…ç½®æ³¨æ„åˆ é™¤åªä¿ç•™ä¸€ä¸ªã€‚</p><p>cat &#x2F;etc&#x2F;dnsmasq.d&#x2F;router.conf</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç›‘å¬çš„ç½‘å¡</span></span><br><span class="line"><span class="attr">interface</span>=enp2s0</span><br><span class="line"></span><br><span class="line"><span class="comment"># DHCPåˆ†é…åœ°å€çš„èŒƒå›´ã€æ©ç ã€ç§ŸæœŸç­‰</span></span><br><span class="line"><span class="attr">dhcp-range</span>=<span class="number">192.168</span>.<span class="number">3.50</span>,<span class="number">192.168</span>.<span class="number">3.150</span>,<span class="number">255.255</span>.<span class="number">255.0</span>,<span class="number">12</span>h</span><br><span class="line"></span><br><span class="line"><span class="comment"># é€šè¿‡MACåœ°å€æ‰‹åŠ¨ç»‘å®šIP</span></span><br><span class="line"><span class="attr">dhcp-host</span>=<span class="number">11</span>:<span class="number">22</span>:<span class="number">33</span>:<span class="number">44</span>:<span class="number">55</span>:<span class="number">66</span>,<span class="number">192.168</span>.<span class="number">3.60</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># DHCPåˆ†é…DNSæœåŠ¡å™¨åœ°å€é…ç½®</span></span><br><span class="line"><span class="attr">dhcp-option</span>=option:dns-server,<span class="number">192.168</span>.<span class="number">3.1</span>,<span class="number">114.114</span>.<span class="number">114.114</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å…³é—­DNSè§£ææœåŠ¡</span></span><br><span class="line"><span class="attr">port</span>=<span class="number">0</span></span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹ç§ŸæœŸ"><a href="#æŸ¥çœ‹ç§ŸæœŸ" class="headerlink" title="æŸ¥çœ‹ç§ŸæœŸ"></a>æŸ¥çœ‹ç§ŸæœŸ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /var/lib/misc/dnsmasq.leases</span><br></pre></td></tr></table></figure><h2 id="è·¯ç”±å™¨ä½¿ç”¨-AP-æ¨¡å¼-å¯é€‰"><a href="#è·¯ç”±å™¨ä½¿ç”¨-AP-æ¨¡å¼-å¯é€‰" class="headerlink" title="è·¯ç”±å™¨ä½¿ç”¨ AP æ¨¡å¼ (å¯é€‰)"></a>è·¯ç”±å™¨ä½¿ç”¨ AP æ¨¡å¼ (å¯é€‰)</h2><p>ä½¿ç”¨ AP æ¨¡å¼å°±æ˜¯ä¸ä½¿ç”¨ä»»ä½•è·¯ç”±å™¨çš„ç®¡ç†åŠŸèƒ½ï¼Œ ä»…ä»…å½“ä½œä¸€ä¸ªå‘å°„ WIFI çš„å·¥å…·ï¼ŒDNS å’Œ DHCP éƒ½ç”±è½¯è·¯ç”±æ¥æä¾›ï¼Œ é…ç½®ä¸Šé¢çš„ DNSMASQ æ¥å®ç°ã€‚</p><p>è·¯ç”±å™¨ä¸Šå¦‚æœæœ‰ AP æ¨¡å¼é€‰é¡¹ï¼Œ åˆ™å¼€å¯åï¼Œ ç½‘çº¿æ’å…¥ LAN å£ï¼Œ å¦‚æœæ²¡æœ‰ AP æ¨¡å¼é€‰é¡¹ï¼Œ åˆ™å…³é—­è·¯ç”±å™¨çš„ DHCP æœåŠ¡ï¼Œç„¶åç½‘çº¿æ’å…¥ LAN å£æ¥ä½¿ç”¨ã€‚</p><h2 id="ä¼˜åŒ–-å¼€å¯-TCP-BBR"><a href="#ä¼˜åŒ–-å¼€å¯-TCP-BBR" class="headerlink" title="ä¼˜åŒ–: å¼€å¯ TCP BBR"></a>ä¼˜åŒ–: å¼€å¯ TCP BBR</h2><blockquote><p>BBR ä¸å¼€å¯ä¹Ÿä¸å½±å“ä½¿ç”¨</p></blockquote><p>å†…æ ¸ç‰ˆæœ¬å¤§äº 4.9 é»˜è®¤éƒ½æ˜¯é›†æˆäº† BBR æ¨¡å—çš„, ç›´æ¥é€šè¿‡ä¿®æ”¹å†…æ ¸å‚æ•°çš„æ–¹å¼æ¥å¼€å¯å³å¯.</p><p>vim sysctl.d&#x2F;99-bbr.conf</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">net.core.default_qdisc=fq</span><br><span class="line">net.ipv4.tcp_congestion_control=bbr</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysctl -p</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹, å¦‚æœç»“æœä¸­åŒ…å« bbr, åˆ™è¯´æ˜å·²å¼€å¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sysctl net.ipv4.tcp_available_congestion_control</span><br><span class="line">lsmod | grep bbr</span><br></pre></td></tr></table></figure><h2 id="ä»£ç†å·¥å…·é…ç½®"><a href="#ä»£ç†å·¥å…·é…ç½®" class="headerlink" title="ä»£ç†å·¥å…·é…ç½®"></a>ä»£ç†å·¥å…·é…ç½®</h2><p>é€æ˜ä»£ç†æˆ‘ç”¨çš„æ˜¯ v2ray è¿™ä¸ªæ¶‰åŠæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ã€‚</p><h3 id="æœåŠ¡ç«¯"><a href="#æœåŠ¡ç«¯" class="headerlink" title="æœåŠ¡ç«¯"></a>æœåŠ¡ç«¯</h3><h4 id="v2ray-æœåŠ¡ç«¯é…ç½®"><a href="#v2ray-æœåŠ¡ç«¯é…ç½®" class="headerlink" title="v2ray æœåŠ¡ç«¯é…ç½®"></a>v2ray æœåŠ¡ç«¯é…ç½®</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;inbounds&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;port&quot;</span><span class="punctuation">:</span> <span class="number">2333</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;protocol&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vmess&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;clients&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;è¿™é‡Œä½¿ç”¨uuidgenè‡ªåŠ¨ç”Ÿæˆ&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;alterId&quot;</span><span class="punctuation">:</span> <span class="number">64</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;streamSettings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;network&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ws&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;wsSettings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;è¿™é‡Œè‡ªå®šä¹‰ä¸€ä¸ªlocation, æ¯”å¦‚ /xxx &quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;outbounds&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;protocol&quot;</span><span class="punctuation">:</span> <span class="string">&quot;freedom&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h4 id="nginx-åä»£é…ç½®"><a href="#nginx-åä»£é…ç½®" class="headerlink" title="nginx åä»£é…ç½®"></a>nginx åä»£é…ç½®</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">upstream v2ray &#123;</span><br><span class="line">  server v2ray:2333;        # æŒ‡å‘v2rayçš„ç«¯å£</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">  listen 80;</span><br><span class="line">  listen [::]:80;</span><br><span class="line">  listen 443 ssl;</span><br><span class="line">  listen [::]:443 ssl;</span><br><span class="line">  server_name ä½ çš„åŸŸå;</span><br><span class="line">  client_max_body_size 1024m;</span><br><span class="line"></span><br><span class="line">  ssl_certificate         ssl/ä½ çš„è¯ä¹¦ä½ç½®.crt;</span><br><span class="line">  ssl_certificate_key     ssl/ä½ çš„ç§é’¥ä½ç½®.key;</span><br><span class="line">  ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</span><br><span class="line">  ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE;</span><br><span class="line">  ssl_prefer_server_ciphers on;</span><br><span class="line">  ssl_session_cache shared:SSL:10m;</span><br><span class="line">  ssl_session_timeout 10m;</span><br><span class="line">  error_page 497  https://$host$request_uri;</span><br><span class="line"></span><br><span class="line">  if ( $scheme = http )&#123;</span><br><span class="line">      rewrite ^(/.*)$ https://$host$1 permanent;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        root   /usr/share/nginx/html;</span><br><span class="line">        index  index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    location /xxx &#123;                   # å’Œä¸Šé¢çš„pathä¿æŒä¸€è‡´</span><br><span class="line">        proxy_pass http://v2ray;</span><br><span class="line">        proxy_redirect off;</span><br><span class="line">        proxy_http_version 1.1;</span><br><span class="line">        proxy_set_header Upgrade $http_upgrade;</span><br><span class="line">        proxy_set_header Connection &quot;Upgrade&quot;;</span><br><span class="line">        proxy_set_header Host $http_host;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å®¢æˆ·ç«¯"><a href="#å®¢æˆ·ç«¯" class="headerlink" title="å®¢æˆ·ç«¯"></a>å®¢æˆ·ç«¯</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;inbounds&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;tag&quot;</span><span class="punctuation">:</span><span class="string">&quot;transparent&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;port&quot;</span><span class="punctuation">:</span> <span class="number">12345</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;protocol&quot;</span><span class="punctuation">:</span> <span class="string">&quot;dokodemo-door&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;network&quot;</span><span class="punctuation">:</span> <span class="string">&quot;tcp,udp&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;followRedirect&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;sniffing&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;enabled&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;destOverride&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="string">&quot;http&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;tls&quot;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;streamSettings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;sockopt&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          # <span class="attr">&quot;tproxy&quot;</span><span class="punctuation">:</span> <span class="string">&quot;redirect&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;tproxy&quot;</span><span class="punctuation">:</span> <span class="string">&quot;tproxy&quot;</span><span class="punctuation">,</span> <span class="comment">// é€æ˜ä»£ç†ä½¿ç”¨ TPROXY æ–¹å¼</span></span><br><span class="line">          <span class="attr">&quot;mark&quot;</span><span class="punctuation">:</span><span class="number">255</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;port&quot;</span><span class="punctuation">:</span> <span class="number">1080</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;protocol&quot;</span><span class="punctuation">:</span> <span class="string">&quot;socks&quot;</span><span class="punctuation">,</span> <span class="comment">// å…¥å£åè®®ä¸º SOCKS 5</span></span><br><span class="line">      <span class="attr">&quot;sniffing&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;enabled&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;destOverride&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;http&quot;</span><span class="punctuation">,</span> <span class="string">&quot;tls&quot;</span><span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;auth&quot;</span><span class="punctuation">:</span> <span class="string">&quot;noauth&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;outbounds&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;tag&quot;</span><span class="punctuation">:</span> <span class="string">&quot;proxy&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;protocol&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vmess&quot;</span><span class="punctuation">,</span> <span class="comment">// ä»£ç†æœåŠ¡å™¨</span></span><br><span class="line">      <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;vnext&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;address&quot;</span><span class="punctuation">:</span> <span class="string">&quot;aria2.babudiu.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;port&quot;</span><span class="punctuation">:</span> <span class="number">443</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;users&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">              <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ä½ çš„æœåŠ¡ç«¯çš„uuid&quot;</span><span class="punctuation">,</span>         <span class="comment">// è°ƒæ•´å’Œä½ æœåŠ¡ç«¯ç›¸åŒçš„uuid</span></span><br><span class="line">                <span class="attr">&quot;alterId&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;security&quot;</span><span class="punctuation">:</span> <span class="string">&quot;auto&quot;</span></span><br><span class="line">              <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;streamSettings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;network&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ws&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;security&quot;</span><span class="punctuation">:</span> <span class="string">&quot;tls&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;tlsSettings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;allowInsecure&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;sockopt&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;mark&quot;</span><span class="punctuation">:</span> <span class="number">255</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;wsSettings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/xxx&quot;</span>          <span class="comment">// è°ƒæ•´å’Œä½ æœåŠ¡ç«¯ç›¸åŒçš„è·¯å¾„</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;mux&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;enabled&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;concurrency&quot;</span><span class="punctuation">:</span> <span class="number">8</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;tag&quot;</span><span class="punctuation">:</span> <span class="string">&quot;direct&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;protocol&quot;</span><span class="punctuation">:</span> <span class="string">&quot;freedom&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;domainStrategy&quot;</span><span class="punctuation">:</span> <span class="string">&quot;UseIP&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;streamSettings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;sockopt&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;mark&quot;</span><span class="punctuation">:</span> <span class="number">255</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;tag&quot;</span><span class="punctuation">:</span> <span class="string">&quot;block&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;protocol&quot;</span><span class="punctuation">:</span> <span class="string">&quot;blackhole&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;response&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;tag&quot;</span><span class="punctuation">:</span> <span class="string">&quot;dns-out&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;protocol&quot;</span><span class="punctuation">:</span> <span class="string">&quot;dns&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;streamSettings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;sockopt&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;mark&quot;</span><span class="punctuation">:</span> <span class="number">255</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;dns&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;servers&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;address&quot;</span><span class="punctuation">:</span> <span class="string">&quot;223.5.5.5&quot;</span><span class="punctuation">,</span> <span class="comment">//ä¸­å›½å¤§é™†åŸŸåä½¿ç”¨é˜¿é‡Œçš„ DNS</span></span><br><span class="line">        <span class="attr">&quot;port&quot;</span><span class="punctuation">:</span> <span class="number">53</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;domains&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="string">&quot;geosite:cn&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;ntp.org&quot;</span><span class="punctuation">,</span>   <span class="comment">// NTP æœåŠ¡å™¨</span></span><br><span class="line">          <span class="string">&quot;a.com&quot;</span> <span class="comment">// æ­¤å¤„æ”¹ä¸ºä½  VPS çš„åŸŸå</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;address&quot;</span><span class="punctuation">:</span> <span class="string">&quot;114.114.114.114&quot;</span><span class="punctuation">,</span> <span class="comment">//ä¸­å›½å¤§é™†åŸŸåä½¿ç”¨ 114 çš„ DNS (å¤‡ç”¨)</span></span><br><span class="line">        <span class="attr">&quot;port&quot;</span><span class="punctuation">:</span> <span class="number">53</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;domains&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="string">&quot;geosite:cn&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;ntp.org&quot;</span><span class="punctuation">,</span>   <span class="comment">// NTP æœåŠ¡å™¨</span></span><br><span class="line">          <span class="string">&quot;a.com&quot;</span> <span class="comment">// æ­¤å¤„æ”¹ä¸ºä½  VPS çš„åŸŸå</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;address&quot;</span><span class="punctuation">:</span> <span class="string">&quot;8.8.8.8&quot;</span><span class="punctuation">,</span> <span class="comment">//éä¸­å›½å¤§é™†åŸŸåä½¿ç”¨ Google çš„ DNS</span></span><br><span class="line">        <span class="attr">&quot;port&quot;</span><span class="punctuation">:</span> <span class="number">53</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;domains&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="string">&quot;geosite:geolocation-!cn&quot;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;address&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.1.1.1&quot;</span><span class="punctuation">,</span> <span class="comment">//éä¸­å›½å¤§é™†åŸŸåä½¿ç”¨ Cloudflare çš„ DNS</span></span><br><span class="line">        <span class="attr">&quot;port&quot;</span><span class="punctuation">:</span> <span class="number">53</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;domains&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="string">&quot;geosite:geolocation-!cn&quot;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;routing&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;domainStrategy&quot;</span><span class="punctuation">:</span> <span class="string">&quot;IPOnDemand&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;rules&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span> <span class="comment">// åŠ«æŒ 53 ç«¯å£ UDP æµé‡ï¼Œä½¿ç”¨ V2Ray çš„ DNS</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;field&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;inboundTag&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="string">&quot;transparent&quot;</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;port&quot;</span><span class="punctuation">:</span> <span class="number">53</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;network&quot;</span><span class="punctuation">:</span> <span class="string">&quot;udp&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;outboundTag&quot;</span><span class="punctuation">:</span> <span class="string">&quot;dns-out&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span> <span class="comment">// ç›´è¿ 123 ç«¯å£ UDP æµé‡ï¼ˆNTP åè®®ï¼‰</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;field&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;inboundTag&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="string">&quot;transparent&quot;</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;port&quot;</span><span class="punctuation">:</span> <span class="number">123</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;network&quot;</span><span class="punctuation">:</span> <span class="string">&quot;udp&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;outboundTag&quot;</span><span class="punctuation">:</span> <span class="string">&quot;direct&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;field&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;ip&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="comment">// è®¾ç½® DNS é…ç½®ä¸­çš„å›½å†… DNS æœåŠ¡å™¨åœ°å€ç›´è¿ï¼Œä»¥è¾¾åˆ° DNS åˆ†æµç›®çš„</span></span><br><span class="line">          <span class="string">&quot;223.5.5.5&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;114.114.114.114&quot;</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;outboundTag&quot;</span><span class="punctuation">:</span> <span class="string">&quot;direct&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;field&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;ip&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="comment">// è®¾ç½® DNS é…ç½®ä¸­çš„å›½å¤– DNS æœåŠ¡å™¨åœ°å€èµ°ä»£ç†ï¼Œä»¥è¾¾åˆ° DNS åˆ†æµç›®çš„</span></span><br><span class="line">          <span class="string">&quot;8.8.8.8&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;1.1.1.1&quot;</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;outboundTag&quot;</span><span class="punctuation">:</span> <span class="string">&quot;proxy&quot;</span> <span class="comment">// æ”¹ä¸ºä½ è‡ªå·±ä»£ç†çš„å‡ºç«™ tag</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span> <span class="comment">// å¹¿å‘Šæ‹¦æˆª</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;field&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;domain&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="string">&quot;geosite:category-ads-all&quot;</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;outboundTag&quot;</span><span class="punctuation">:</span> <span class="string">&quot;block&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span> <span class="comment">// BT æµé‡ç›´è¿</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;field&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;protocol&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="string">&quot;bittorrent&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;outboundTag&quot;</span><span class="punctuation">:</span> <span class="string">&quot;direct&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span> <span class="comment">// ç›´è¿ä¸­å›½å¤§é™†ä¸»æµç½‘ç«™ ip å’Œ ä¿ç•™ ip</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;field&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;ip&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="string">&quot;geoip:private&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;geoip:cn&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="comment">// éœ€è¦æŠŠæœåŠ¡å™¨çš„IPåŠ å…¥ç›´è¿åå•</span></span><br><span class="line">          <span class="string">&quot;2.2.2.2&quot;</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;outboundTag&quot;</span><span class="punctuation">:</span> <span class="string">&quot;direct&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span> <span class="comment">// ç›´è¿ä¸­å›½å¤§é™†ä¸»æµç½‘ç«™åŸŸå</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;field&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;domain&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="string">&quot;geosite:cn&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="comment">// éœ€è¦æŠŠæœåŠ¡å™¨çš„åŸŸååŠ å…¥ç›´è¿åå•</span></span><br><span class="line">          <span class="string">&quot;v2ray_server.com&quot;</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;outboundTag&quot;</span><span class="punctuation">:</span> <span class="string">&quot;direct&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>å¯¹åº”çš„å¯åŠ¨ <code>systemd</code>service å†…å®¹ä¸º:</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Unit]</span></span><br><span class="line"><span class="attr">Description</span>=V2Ray Service</span><br><span class="line"><span class="attr">Documentation</span>=https://www.v2fly.org/</span><br><span class="line"><span class="attr">After</span>=network.target nss-lookup.target</span><br><span class="line"></span><br><span class="line"><span class="section">[Service]</span></span><br><span class="line"><span class="attr">User</span>=root</span><br><span class="line"><span class="attr">ExecStart</span>=/data/v2ray/v2ray run -config /data/v2ray/config.json</span><br><span class="line"><span class="attr">Restart</span>=<span class="literal">on</span>-failure</span><br><span class="line"><span class="attr">RestartPreventExitStatus</span>=<span class="number">23</span></span><br><span class="line"><span class="attr">LimitNPROC</span>=<span class="number">500</span></span><br><span class="line"><span class="attr">LimitNOFILE</span>=<span class="number">1000000</span></span><br><span class="line"></span><br><span class="line"><span class="section">[Install]</span></span><br><span class="line"><span class="attr">WantedBy</span>=multi-user.target</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ï¼š åœ¨è½¯è·¯ç”±ä¸Šæ‰§è¡Œ <code>curl --socks5 localhost:1080 google.com</code> å¦‚æœå¯ä»¥è®¿é—®ï¼Œè¯´æ˜é…ç½®æˆåŠŸã€‚æ¥ä¸‹æ¥é…ç½®é€æ˜ä»£ç†</p><h3 id="é€æ˜ä»£ç†"><a href="#é€æ˜ä»£ç†" class="headerlink" title="é€æ˜ä»£ç†"></a>é€æ˜ä»£ç†</h3><blockquote><p>å‚è€ƒæ–‡ç« : <a href="https://toutyrater.github.io/app/tproxy.html">https://toutyrater.github.io/app/tproxy.html</a></p></blockquote><h4 id="åˆ›å»º-tproxy-sh-è„šæœ¬"><a href="#åˆ›å»º-tproxy-sh-è„šæœ¬" class="headerlink" title="åˆ›å»º tproxy.sh è„šæœ¬"></a>åˆ›å»º <code>tproxy.sh</code> è„šæœ¬</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®ç­–ç•¥è·¯ç”±</span></span><br><span class="line">ip rule add fwmark 1 table 100</span><br><span class="line">ip route add <span class="built_in">local</span> 0.0.0.0/0 dev lo table 100</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»£ç†å±€åŸŸç½‘è®¾å¤‡</span></span><br><span class="line">iptables -t mangle -N V2RAY</span><br><span class="line">iptables -t mangle -A V2RAY -d 127.0.0.1/32 -j RETURN</span><br><span class="line">iptables -t mangle -A V2RAY -d 224.0.0.0/4 -j RETURN</span><br><span class="line">iptables -t mangle -A V2RAY -d 255.255.255.255/32 -j RETURN</span><br><span class="line">iptables -t mangle -A V2RAY -d 192.168.0.0/16 -p tcp -j RETURN <span class="comment"># ç›´è¿å±€åŸŸç½‘ï¼Œé¿å… V2Ray æ— æ³•å¯åŠ¨æ—¶æ— æ³•è¿ç½‘å…³çš„ SSHï¼Œå¦‚æœä½ é…ç½®çš„æ˜¯å…¶ä»–ç½‘æ®µï¼ˆå¦‚ 10.x.x.x ç­‰ï¼‰ï¼Œåˆ™ä¿®æ”¹æˆè‡ªå·±çš„</span></span><br><span class="line">iptables -t mangle -A V2RAY -d 192.168.0.0/16 -p udp ! --dport 53 -j RETURN <span class="comment"># ç›´è¿å±€åŸŸç½‘ï¼Œ53 ç«¯å£é™¤å¤–ï¼ˆå› ä¸ºè¦ä½¿ç”¨ V2Ray çš„ DNS)</span></span><br><span class="line">iptables -t mangle -A V2RAY -j RETURN -m mark --mark 0xff    <span class="comment"># ç›´è¿ SO_MARK ä¸º 0xff çš„æµé‡(0xff æ˜¯ 16 è¿›åˆ¶æ•°ï¼Œæ•°å€¼ä¸Šç­‰åŒä¸ä¸Šé¢V2Ray é…ç½®çš„ 255)ï¼Œæ­¤è§„åˆ™ç›®çš„æ˜¯è§£å†³v2rayå ç”¨å¤§é‡CPUï¼ˆhttps://github.com/v2ray/v2ray-core/issues/2621ï¼‰</span></span><br><span class="line">iptables -t mangle -A V2RAY -p udp -j TPROXY --on-ip 127.0.0.1 --on-port 12345 --tproxy-mark 1 <span class="comment"># ç»™ UDP æ‰“æ ‡è®° 1ï¼Œè½¬å‘è‡³ 12345 ç«¯å£</span></span><br><span class="line">iptables -t mangle -A V2RAY -p tcp -j TPROXY --on-ip 127.0.0.1 --on-port 12345 --tproxy-mark 1 <span class="comment"># ç»™ TCP æ‰“æ ‡è®° 1ï¼Œè½¬å‘è‡³ 12345 ç«¯å£</span></span><br><span class="line">iptables -t mangle -A PREROUTING -j V2RAY <span class="comment"># åº”ç”¨è§„åˆ™</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»£ç†ç½‘å…³æœ¬æœº</span></span><br><span class="line">iptables -t mangle -N V2RAY_MASK</span><br><span class="line">iptables -t mangle -A V2RAY_MASK -d 224.0.0.0/4 -j RETURN</span><br><span class="line">iptables -t mangle -A V2RAY_MASK -d 255.255.255.255/32 -j RETURN</span><br><span class="line">iptables -t mangle -A V2RAY_MASK -d 192.168.0.0/16 -p tcp -j RETURN <span class="comment"># ç›´è¿å±€åŸŸç½‘</span></span><br><span class="line">iptables -t mangle -A V2RAY_MASK -d 192.168.0.0/16 -p udp ! --dport 53 -j RETURN <span class="comment"># ç›´è¿å±€åŸŸç½‘ï¼Œ53 ç«¯å£é™¤å¤–ï¼ˆå› ä¸ºè¦ä½¿ç”¨ V2Ray çš„ DNSï¼‰</span></span><br><span class="line">iptables -t mangle -A V2RAY_MASK -j RETURN -m mark --mark 0xff    <span class="comment"># ç›´è¿ SO_MARK ä¸º 0xff çš„æµé‡(0xff æ˜¯ 16 è¿›åˆ¶æ•°ï¼Œæ•°å€¼ä¸Šç­‰åŒä¸ä¸Šé¢V2Ray é…ç½®çš„ 255)ï¼Œæ­¤è§„åˆ™ç›®çš„æ˜¯é¿å…ä»£ç†æœ¬æœº(ç½‘å…³)æµé‡å‡ºç°å›ç¯é—®é¢˜</span></span><br><span class="line">iptables -t mangle -A V2RAY_MASK -p udp -j MARK --set-mark 1   <span class="comment"># ç»™ UDP æ‰“æ ‡è®°ï¼Œé‡è·¯ç”±</span></span><br><span class="line">iptables -t mangle -A V2RAY_MASK -p tcp -j MARK --set-mark 1   <span class="comment"># ç»™ TCP æ‰“æ ‡è®°ï¼Œé‡è·¯ç”±</span></span><br><span class="line">iptables -t mangle -A OUTPUT -j V2RAY_MASK <span class="comment"># åº”ç”¨è§„åˆ™</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–°å»º DIVERT è§„åˆ™ï¼Œé¿å…å·²æœ‰è¿æ¥çš„åŒ…äºŒæ¬¡é€šè¿‡ TPROXYï¼Œç†è®ºä¸Šæœ‰ä¸€å®šçš„æ€§èƒ½æå‡</span></span><br><span class="line">iptables -t mangle -N DIVERT</span><br><span class="line">iptables -t mangle -A DIVERT -j MARK --set-mark 1</span><br><span class="line">iptables -t mangle -A DIVERT -j ACCEPT</span><br><span class="line">iptables -t mangle -I PREROUTING -p tcp -m socket -j DIVERT</span><br></pre></td></tr></table></figure><h4 id="åˆ›å»ºæ¸…ç†-iptables-è„šæœ¬-clean-iptables-sh"><a href="#åˆ›å»ºæ¸…ç†-iptables-è„šæœ¬-clean-iptables-sh" class="headerlink" title="åˆ›å»ºæ¸…ç† iptables è„šæœ¬ clean_iptables.sh"></a>åˆ›å»ºæ¸…ç† iptables è„šæœ¬ <code>clean_iptables.sh</code></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">iptables -t mangle -F</span><br><span class="line">iptables -t mangle -X V2RAY</span><br><span class="line">iptables -t mangle -X V2RAY_MASK</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œ <code>tproxy.sh</code> å³å¯å¼€å¯é€æ˜ä»£ç†</p><h4 id="ä¼˜åŒ–ä¸€ä¸‹-systemd"><a href="#ä¼˜åŒ–ä¸€ä¸‹-systemd" class="headerlink" title="ä¼˜åŒ–ä¸€ä¸‹ systemd"></a>ä¼˜åŒ–ä¸€ä¸‹ systemd</h4><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Unit]</span></span><br><span class="line"><span class="attr">Description</span>=V2Ray Service</span><br><span class="line"><span class="attr">Documentation</span>=https://www.v2fly.org/</span><br><span class="line"><span class="attr">After</span>=network.target nss-lookup.target</span><br><span class="line"></span><br><span class="line"><span class="section">[Service]</span></span><br><span class="line"><span class="attr">User</span>=root</span><br><span class="line"><span class="attr">ExecStartPre</span>=/data/v2ray/tproxy.sh</span><br><span class="line"><span class="attr">ExecStart</span>=/data/v2ray/v2ray run -config /data/v2ray/config.json</span><br><span class="line"><span class="attr">ExecStopPost</span>=/data/v2ray/clean_iptables.sh</span><br><span class="line"><span class="attr">Restart</span>=<span class="literal">on</span>-failure</span><br><span class="line"><span class="attr">RestartPreventExitStatus</span>=<span class="number">23</span></span><br><span class="line"></span><br><span class="line"><span class="section">[Install]</span></span><br><span class="line"><span class="attr">WantedBy</span>=multi-user.target</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ubuntu </tag>
            
            <tag> è½¯è·¯ç”± </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redisé›†ç¾¤æ¨¡å¼éƒ¨ç½²</title>
      <link href="/posts/5cc4b89d/"/>
      <url>/posts/5cc4b89d/</url>
      
        <content type="html"><![CDATA[<p>æ­å»ºä¸ª 6 èŠ‚ç‚¹çš„é›†ç¾¤ï¼ŒåŒ…æ‹¬ä¸‰ä¸»ä¸‰ä»</p><h2 id="åˆ›å»ºé…ç½®æ–‡ä»¶"><a href="#åˆ›å»ºé…ç½®æ–‡ä»¶" class="headerlink" title="åˆ›å»ºé…ç½®æ–‡ä»¶"></a>åˆ›å»ºé…ç½®æ–‡ä»¶</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">port 6379</span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file nodes.conf</span><br><span class="line">cluster-node-timeout 5000</span><br><span class="line">appendonly yes</span><br><span class="line">daemonize yes</span><br><span class="line">protected-mode no</span><br><span class="line">pidfile  /var/run/redis.pid</span><br></pre></td></tr></table></figure><blockquote><p>å¦‚æœæ˜¯åŒä¸€å°æœºå™¨ä¸Šè·‘ 6 ä¸ªå®ä¾‹çš„è¯ï¼Œéœ€è¦ä¿è¯ç«¯å£å’Œ pid æ–‡ä»¶ä¸èƒ½é‡å¤</p></blockquote><h2 id="å¯åŠ¨æœåŠ¡å™¨"><a href="#å¯åŠ¨æœåŠ¡å™¨" class="headerlink" title="å¯åŠ¨æœåŠ¡å™¨"></a>å¯åŠ¨æœåŠ¡å™¨</h2><p>åœ¨æ¯å°æœºå™¨ä¸Šé¢æ‰§è¡Œï¼Œå¯åŠ¨ 6 ä¸ª redis æœåŠ¡å™¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-server redis.conf</span><br></pre></td></tr></table></figure><h2 id="åˆ›å»ºé›†ç¾¤"><a href="#åˆ›å»ºé›†ç¾¤" class="headerlink" title="åˆ›å»ºé›†ç¾¤"></a>åˆ›å»ºé›†ç¾¤</h2><p>åœ¨ä¸€å°æœºå™¨ä¸Šæ‰§è¡Œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli --cluster create --cluster-replicas 1 192.168.1.11:6379 192.168.1.12:6379 192.168.1.13:6379 192.168.1.14:6379 192.168.1.15:6379 192.168.1.16:6379</span><br></pre></td></tr></table></figure><p>å‡ºç°æç¤ºï¼Œè¾“å…¥ yes</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202212161407297.png" alt="åˆ›å»ºé›†ç¾¤"></p><h2 id="è¿æ¥é›†ç¾¤"><a href="#è¿æ¥é›†ç¾¤" class="headerlink" title="è¿æ¥é›†ç¾¤"></a>è¿æ¥é›†ç¾¤</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -c -h 192.168.1.11 -p 6379</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@ops_manage redis-cluster]<span class="comment"># ./redis-cli -c -h 127.0.0.1 -p 7001</span></span><br><span class="line">127.0.0.1:7001&gt; get foo</span><br><span class="line">-&gt; Redirected to slot [12182] located at 127.0.0.1:7003</span><br><span class="line"><span class="string">&quot;bar&quot;</span></span><br><span class="line">127.0.0.1:7003&gt;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Prometheuså¸¸ç”¨PromSQLè®°å½•</title>
      <link href="/posts/11255f25/"/>
      <url>/posts/11255f25/</url>
      
        <content type="html"><![CDATA[<p>prometheus æŸ¥è¯¢è¯­æ³•å« promsqlï¼Œåšä¸ªè®°å½•ï¼š</p><h2 id="æŸ¥è¯¢æ¡ä»¶"><a href="#æŸ¥è¯¢æ¡ä»¶" class="headerlink" title="æŸ¥è¯¢æ¡ä»¶"></a>æŸ¥è¯¢æ¡ä»¶</h2><p>Prometheus å­˜å‚¨çš„æ˜¯æ—¶åºæ•°æ®ï¼Œè€Œå®ƒçš„æ—¶åºæ˜¯ç”±åå­—å’Œä¸€ç»„æ ‡ç­¾æ„æˆçš„ï¼Œå…¶å®åå­—ä¹Ÿå¯ä»¥å†™å‡ºæ ‡ç­¾çš„å½¢å¼ï¼Œä¾‹å¦‚ <code>http_requests_total</code> ç­‰ä»·äº <code>&#123;name=&quot;http_requests_total&quot;&#125;</code>ã€‚</p><p>ä¸€ä¸ªç®€å•çš„æŸ¥è¯¢ç›¸å½“äºæ˜¯å¯¹å„ç§æ ‡ç­¾çš„ç­›é€‰ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">http_requests_total&#123;code=<span class="string">&quot;200&quot;</span>&#125;     <span class="comment"># è¡¨ç¤ºæŸ¥è¯¢åå­—ä¸º http_requests_totalï¼Œcode ä¸º &quot;200&quot; çš„æ•°æ®</span></span><br><span class="line">http_requests_total&#123;code!=<span class="string">&quot;200&quot;</span>&#125;    <span class="comment"># è¡¨ç¤ºæŸ¥è¯¢ code ä¸ä¸º &quot;200&quot; çš„æ•°æ®</span></span><br><span class="line">http_requests_total&#123;code=~<span class="string">&quot;2..&quot;</span>&#125;    <span class="comment"># è¡¨ç¤ºæŸ¥è¯¢ code ä¸º &quot;2xx&quot; çš„æ•°æ®</span></span><br><span class="line">http_requests_total&#123;code!~<span class="string">&quot;2..&quot;</span>&#125;    <span class="comment"># è¡¨ç¤ºæŸ¥è¯¢ code ä¸ä¸º &quot;2xx&quot; çš„æ•°æ®</span></span><br></pre></td></tr></table></figure><h2 id="æ“ä½œç¬¦"><a href="#æ“ä½œç¬¦" class="headerlink" title="æ“ä½œç¬¦"></a>æ“ä½œç¬¦</h2><p>Prometheus æŸ¥è¯¢è¯­å¥ä¸­ï¼Œæ”¯æŒå¸¸è§çš„å„ç§è¡¨è¾¾å¼æ“ä½œç¬¦ï¼Œä¾‹å¦‚</p><h3 id="ç®—æœ¯è¿ç®—ç¬¦"><a href="#ç®—æœ¯è¿ç®—ç¬¦" class="headerlink" title="ç®—æœ¯è¿ç®—ç¬¦"></a>ç®—æœ¯è¿ç®—ç¬¦</h3><p>æ”¯æŒçš„ç®—æœ¯è¿ç®—ç¬¦æœ‰ <code>+ï¼Œ-ï¼Œ*ï¼Œ/ï¼Œ%ï¼Œ^</code> , ä¾‹å¦‚ <code>http_requests_total * 2</code> è¡¨ç¤ºå°† http_requests_total æ‰€æœ‰æ•°æ® double ä¸€å€ã€‚</p><h3 id="æ¯”è¾ƒè¿ç®—ç¬¦"><a href="#æ¯”è¾ƒè¿ç®—ç¬¦" class="headerlink" title="æ¯”è¾ƒè¿ç®—ç¬¦"></a>æ¯”è¾ƒè¿ç®—ç¬¦</h3><p>æ”¯æŒçš„æ¯”è¾ƒè¿ç®—ç¬¦æœ‰ <code>==ï¼Œ!=ï¼Œ&gt;ï¼Œ&lt;ï¼Œ&gt;=ï¼Œ&lt;=</code> , ä¾‹å¦‚ <code>http_requests_total &gt; 100</code> è¡¨ç¤º http_requests_total ç»“æœä¸­å¤§äº 100 çš„æ•°æ®ã€‚</p><h3 id="é€»è¾‘è¿ç®—ç¬¦"><a href="#é€»è¾‘è¿ç®—ç¬¦" class="headerlink" title="é€»è¾‘è¿ç®—ç¬¦"></a>é€»è¾‘è¿ç®—ç¬¦</h3><p>æ”¯æŒçš„é€»è¾‘è¿ç®—ç¬¦æœ‰ <code>andï¼Œorï¼Œunless</code>, ä¾‹å¦‚ <code>http_requests_total == 5 or http_requests_total == 2</code> è¡¨ç¤º http_requests_total ç»“æœä¸­ç­‰äº 5 æˆ–è€… 2 çš„æ•°æ®ã€‚</p><h3 id="èšåˆè¿ç®—ç¬¦"><a href="#èšåˆè¿ç®—ç¬¦" class="headerlink" title="èšåˆè¿ç®—ç¬¦"></a>èšåˆè¿ç®—ç¬¦</h3><p>æ”¯æŒçš„èšåˆè¿ç®—ç¬¦æœ‰ <code>sumï¼Œminï¼Œmaxï¼Œavgï¼Œstddevï¼Œstdvarï¼Œcountï¼Œcount_valuesï¼Œbottomkï¼Œtopkï¼Œquantile</code> , ä¾‹å¦‚ <code>max(http_requests_total)</code> è¡¨ç¤º http_requests_total ç»“æœä¸­æœ€å¤§çš„æ•°æ®ã€‚</p><p>æ³¨æ„ï¼Œå’Œå››åˆ™è¿ç®—ç±»å‹ï¼ŒPrometheus çš„è¿ç®—ç¬¦ä¹Ÿæœ‰ä¼˜å…ˆçº§ï¼Œå®ƒä»¬éµä» <code>(^)&gt; (*, /, %) &gt; (+, -) &gt; (==, !=, &lt;=, &lt;, &gt;=, &gt;) &gt; (and, unless) &gt; (or)</code> çš„åŸåˆ™ã€‚</p><h2 id="å†…ç½®å‡½æ•°"><a href="#å†…ç½®å‡½æ•°" class="headerlink" title="å†…ç½®å‡½æ•°"></a>å†…ç½®å‡½æ•°</h2><h3 id="å–æ•´"><a href="#å–æ•´" class="headerlink" title="å–æ•´"></a>å–æ•´</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">floor(avg(http_requests_total&#123;code=<span class="string">&quot;200&quot;</span>&#125;))       <span class="comment"># å¾€å°äº†å–å€¼</span></span><br><span class="line">ceil(avg(http_requests_total&#123;code=<span class="string">&quot;200&quot;</span>&#125;))        <span class="comment"># å¾€å¤§äº†å–å€¼</span></span><br></pre></td></tr></table></figure><h3 id="é€Ÿç‡"><a href="#é€Ÿç‡" class="headerlink" title="é€Ÿç‡"></a>é€Ÿç‡</h3><p>æŸ¥çœ‹ http_requests_total 5 åˆ†é’Ÿå†…ï¼Œå¹³å‡æ¯ç§’æ•°æ®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rate(http_requests_total[5m])</span><br><span class="line">irate(http_requests_total[5m])</span><br></pre></td></tr></table></figure><h3 id="å¹³å‡å€¼"><a href="#å¹³å‡å€¼" class="headerlink" title="å¹³å‡å€¼"></a>å¹³å‡å€¼</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">avg()       <span class="comment"># å¹³å‡å€¼</span></span><br><span class="line">max()       <span class="comment"># æœ€å¤§å€¼</span></span><br><span class="line">min()       <span class="comment"># æœ€å°å€¼</span></span><br><span class="line">abs()       <span class="comment"># ç»å¯¹å€¼</span></span><br><span class="line">increase()  <span class="comment"># å¢é‡</span></span><br></pre></td></tr></table></figure><p>æ›´å¤šè¯·æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://prometheus.io/docs/prometheus/latest/querying/functions/">https://prometheus.io/docs/prometheus/latest/querying/functions/</a></p><h2 id="èšåˆ"><a href="#èšåˆ" class="headerlink" title="èšåˆ"></a>èšåˆ</h2><h3 id="æ±‚å’Œ"><a href="#æ±‚å’Œ" class="headerlink" title="æ±‚å’Œ"></a>æ±‚å’Œ</h3><blockquote><p>sum æ˜¯æ±‚å’Œï¼Œ sum by (app, proc) æ˜¯æŠŠæ•°æ®ä»¥ app å’Œ proc èšåˆ åˆ†ç±»æ¥æ±‚å’Œï¼Œ ç»“æœä¼šå¸¦ä¸Šè¿™ä¸¤ä¸ªæ ‡ç­¾</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sum</span> by (app, proc) (</span><br><span class="line">  instance_memory_limit_bytes - instance_memory_usage_bytes</span><br><span class="line">) / 1024 / 1024</span><br></pre></td></tr></table></figure><h3 id="è®¡æ•°"><a href="#è®¡æ•°" class="headerlink" title="è®¡æ•°"></a>è®¡æ•°</h3><blockquote><p>ç±»ä¼¼äº <code>wc -l</code></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">count by (app) (instance_cpu_time_ns)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç›‘æ§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> prometheus </tag>
            
            <tag> Prometheus </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¤‡ä»½è¿˜åŸLinuxæ“ä½œç³»ç»Ÿ</title>
      <link href="/posts/a222390c/"/>
      <url>/posts/a222390c/</url>
      
        <content type="html"><![CDATA[<p>åœ¨ Linux å†…, ä¸€åˆ‡çš†æ–‡ä»¶, æ‰€ä»¥å¯ä»¥é€šè¿‡ç›´æ¥å¤åˆ¶æ–‡ä»¶çš„æ–¹å¼æ¥å¤‡ä»½ Linux ç³»ç»Ÿ, ä½¿ç”¨ Linux è‡ªå¸¦çš„å·¥å…·, æ¯”å¦‚ tar rsync éƒ½å¯ä»¥å®Œæˆè¿™äº›æ“ä½œ.</p><h2 id="ä½¿ç”¨-rsync-å¤‡ä»½è¿˜åŸ-Linux-ç³»ç»Ÿ"><a href="#ä½¿ç”¨-rsync-å¤‡ä»½è¿˜åŸ-Linux-ç³»ç»Ÿ" class="headerlink" title="ä½¿ç”¨ rsync å¤‡ä»½è¿˜åŸ Linux ç³»ç»Ÿ"></a>ä½¿ç”¨ rsync å¤‡ä»½è¿˜åŸ Linux ç³»ç»Ÿ</h2><h3 id="ä½¿ç”¨-rsync-å¤‡ä»½"><a href="#ä½¿ç”¨-rsync-å¤‡ä»½" class="headerlink" title="ä½¿ç”¨ rsync å¤‡ä»½"></a>ä½¿ç”¨ rsync å¤‡ä»½</h3><p>æ¯”å¦‚å¤‡ä»½è·¯å¾„æ˜¯ <code>/backup</code> , åŒæ—¶éœ€è¦æ’é™¤ <code>/backup</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rsync -aAXHv --exclude=&#123;<span class="string">&quot;/dev/*&quot;</span>,<span class="string">&quot;/proc/*&quot;</span>,<span class="string">&quot;/sys/*&quot;</span>,<span class="string">&quot;/tmp/*&quot;</span>,<span class="string">&quot;/run/*&quot;</span>,<span class="string">&quot;/mnt/*&quot;</span>,<span class="string">&quot;/media/*&quot;</span>,<span class="string">&quot;/lost+found&quot;</span>, <span class="string">&quot;/backup&quot;</span>&#125; --delete / /backup</span><br></pre></td></tr></table></figure><blockquote><p>é€šè¿‡ä½¿ç”¨ -aAX é€‰é¡¹é›†ï¼Œæ–‡ä»¶ä»¥å½’æ¡£æ¨¡å¼ä¼ è¾“ï¼Œç¡®ä¿ç¬¦å·é“¾æ¥ã€è®¾å¤‡ã€æƒé™ã€æ‰€æœ‰æƒã€ä¿®æ”¹æ—¶é—´ã€ACLs å’Œæ‰©å±•å±æ€§å¾—ä»¥ä¿ç•™ï¼Œå‰ææ˜¯ç›®æ ‡æ–‡ä»¶ç³»ç»Ÿæ”¯æŒè¿™ä¸€åŠŸèƒ½ã€‚é€‰é¡¹ -H ä¿ç•™äº†ç¡¬é“¾æ¥ï¼Œä½†ä¼šä½¿ç”¨æ›´å¤šçš„å†…å­˜ã€‚<br>swap æ–‡ä»¶ä¹Ÿæœ€å¥½æ’é™¤, gvfs éœ€è¦æ’é™¤ <code>/home/*/.gvfs</code></p></blockquote><h3 id="ä½¿ç”¨-rsync-è¿˜åŸ"><a href="#ä½¿ç”¨-rsync-è¿˜åŸ" class="headerlink" title="ä½¿ç”¨ rsync è¿˜åŸ"></a>ä½¿ç”¨ rsync è¿˜åŸ</h3><p>åœ¨ Linux Livecd ä¸‹:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rsync -aAXHv --delete /backup /</span><br></pre></td></tr></table></figure><p>rsync å¤‡ä»½å¯ä»¥å®ç°å¢é‡æ›´æ–°, å®æ—¶æ›´æ–°ç­‰, æ¯”è¾ƒæ–¹ä¾¿ä½¿ç”¨, é€Ÿåº¦ä¹Ÿå¾ˆå¿«</p><h2 id="ä½¿ç”¨-dd-å‘½ä»¤"><a href="#ä½¿ç”¨-dd-å‘½ä»¤" class="headerlink" title="ä½¿ç”¨ dd å‘½ä»¤"></a>ä½¿ç”¨ dd å‘½ä»¤</h2><p>dd æ˜¯ç›´æ¥è¿›è¡Œç¡¬ç›˜å¯¹æ‹·, å¤‡ä»½æ˜¯å°†æ•´ä¸ªç¡¬ç›˜ç»™ dump ä¸‹æ¥, é€Ÿåº¦éå¸¸æ…¢, ä¸æ¨èè¿™ç§æ–¹å¼</p><h3 id="ä½¿ç”¨-dd-å¤‡ä»½"><a href="#ä½¿ç”¨-dd-å¤‡ä»½" class="headerlink" title="ä½¿ç”¨ dd å¤‡ä»½"></a>ä½¿ç”¨ dd å¤‡ä»½</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/sda of=/backup/backup.dd</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨-dd-è¿˜åŸ"><a href="#ä½¿ç”¨-dd-è¿˜åŸ" class="headerlink" title="ä½¿ç”¨ dd è¿˜åŸ"></a>ä½¿ç”¨ dd è¿˜åŸ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/backup/backup.dd of=/dev/sda</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨-tar-æ¥å®ç°"><a href="#ä½¿ç”¨-tar-æ¥å®ç°" class="headerlink" title="ä½¿ç”¨ tar æ¥å®ç°"></a>ä½¿ç”¨ tar æ¥å®ç°</h2><h3 id="ä½¿ç”¨-tar-å¤‡ä»½"><a href="#ä½¿ç”¨-tar-å¤‡ä»½" class="headerlink" title="ä½¿ç”¨ tar å¤‡ä»½"></a>ä½¿ç”¨ tar å¤‡ä»½</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /</span><br><span class="line">tar -cvpzf backup.tar.gz \</span><br><span class="line">--exclude=/backup.tar.gz \</span><br><span class="line">--exclude=/proc \</span><br><span class="line">--exclude=/tmp \</span><br><span class="line">--exclude=/mnt \</span><br><span class="line">--exclude=/dev \</span><br><span class="line">--exclude=/sys \</span><br><span class="line">--exclude=/run \ </span><br><span class="line">--exclude=/media \ </span><br><span class="line">--exclude=/var/log \</span><br><span class="line">--exclude=/var/cache/apt/archives \</span><br><span class="line">--exclude=/usr/src/linux-headers* \ </span><br><span class="line">--exclude=/home/*/.gvfs \</span><br><span class="line">--exclude=/home/*/.cache \ </span><br><span class="line">--exclude=/home/*/.local/share/Trash /</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨-tar-è¿˜åŸ"><a href="#ä½¿ç”¨-tar-è¿˜åŸ" class="headerlink" title="ä½¿ç”¨ tar è¿˜åŸ"></a>ä½¿ç”¨ tar è¿˜åŸ</h3><p>ç”¨ livecd å¯åŠ¨ç³»ç»Ÿ, ç„¶åç‚¹å‡»ä¸€ä¸‹è¦è¿˜åŸçš„ç›®çš„ç£ç›˜, å‡è®¾è‡ªåŠ¨æŒ‚è½½åˆ° <code>/media/mountpath</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo tar -xvpzf /path/to/backup.tar.gz -C /media/mountpath --numeric-owner</span><br><span class="line">sudo <span class="built_in">mkdir</span> proc sys mnt media</span><br></pre></td></tr></table></figure><blockquote><p>â€“numeric-owner æ¢å¤æ–‡ä»¶åŸæ¥çš„æƒé™</p></blockquote><h3 id="ä¿®å¤-grub"><a href="#ä¿®å¤-grub" class="headerlink" title="ä¿®å¤ grub"></a>ä¿®å¤ grub</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo -s</span><br><span class="line"><span class="keyword">for</span> f <span class="keyword">in</span> dev dev/pts proc ; <span class="keyword">do</span> mount --<span class="built_in">bind</span> /<span class="variable">$f</span> /media/whatever/<span class="variable">$f</span> ; <span class="keyword">done</span></span><br><span class="line"><span class="built_in">chroot</span> /media/mountpath</span><br><span class="line">dpkg-reconfigure grub-pc</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> å¤‡ä»½è¿˜åŸ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Djangoé…ç½®MySQLæ•°æ®åº“æ”¯æŒ</title>
      <link href="/posts/28913a98/"/>
      <url>/posts/28913a98/</url>
      
        <content type="html"><![CDATA[<p>Django æ”¯æŒ MySQL ä¸»è¦æœ‰ä¸¤ç§æ–¹å¼, ä¸€ç§æ˜¯ä½¿ç”¨ <code>pymysql</code> åŒ…, è¿™ä¸ªæ˜¯ä¸ªçº¯ python åŒ…, å¯ä»¥è·¨å¹³å°è¿è¡Œ, ä¸è¿‡æ€§èƒ½è¾ƒå·®, å¦ä¸€ç§æ˜¯ <code>mysqlclient</code>, è¿™ä¸ªéœ€è¦æ“ä½œç³»ç»Ÿæ”¯æŒ, åœ¨ linux å¹³å°å¯ä»¥è·å¾—æ›´å¥½çš„æ€§èƒ½, åœ¨ windows ç³»ç»Ÿä¸‹å®‰è£…æ¯”è¾ƒéº»çƒ¦ã€‚</p><h2 id="mysqlclient"><a href="#mysqlclient" class="headerlink" title="mysqlclient"></a>mysqlclient</h2><p>mysqlclient éœ€è¦ä¾èµ–æ“ä½œç³»ç»Ÿçš„åº“</p><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">Ubuntuå’ŒDebianå®‰è£…</button><button type="button" class="tab">CentOSå’ŒFedoraå®‰è£…</button></div><div class="tab-contents"><div class="tab-item-content active"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install python3-dev default-libmysqlclient-dev build-essential</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install python3-devel mysql-devel</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div><p>ç„¶å pip å®‰è£… mysqlclient</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install mysqlclient</span><br></pre></td></tr></table></figure><h2 id="pymysql"><a href="#pymysql" class="headerlink" title="pymysql"></a>pymysql</h2><p>ç›´æ¥å®‰è£…:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install pymysql</span><br></pre></td></tr></table></figure><p>åœ¨ <code>__init__.py</code> æˆ–è€… <code>settings.py</code> æ–‡ä»¶å¼€å¤´æ·»åŠ </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line">pymysql.install_as_MySQLdb()</span><br></pre></td></tr></table></figure><h2 id="settings-py-é…ç½®"><a href="#settings-py-é…ç½®" class="headerlink" title="settings.py é…ç½®"></a>settings.py é…ç½®</h2><p>Django çš„ settings.py éœ€è¦é…ç½®ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">DATABASES = &#123;</span><br><span class="line">    <span class="string">&#x27;default&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;ENGINE&#x27;</span>: <span class="string">&#x27;django.db.backends.mysql&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;NAME&#x27;</span>: <span class="string">&#x27;django&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;USER&#x27;</span>: <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;PASSWORD&#x27;</span>: <span class="string">&#x27;123456&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;HOST&#x27;</span>: <span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;PORT&#x27;</span>: <span class="string">&#x27;3306&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> django </tag>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å•ç‹¬å®‰è£…MySQL clientå®¢æˆ·ç«¯</title>
      <link href="/posts/sn8a2y/"/>
      <url>/posts/sn8a2y/</url>
      
        <content type="html"><![CDATA[<h2 id="æ–¹æ³•ä¸€ã€ç›´æ¥ä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶"><a href="#æ–¹æ³•ä¸€ã€ç›´æ¥ä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶" class="headerlink" title="æ–¹æ³•ä¸€ã€ç›´æ¥ä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶"></a>æ–¹æ³•ä¸€ã€ç›´æ¥ä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶</h2><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">CentOS</button><button type="button" class="tab">Debian/Ubuntu</button></div><div class="tab-contents"><div class="tab-item-content active"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install -y ncurses-libs <span class="comment"># è¿™ä¸ªåŒ…centosé»˜è®¤è‡ªå¸¦äº†</span></span><br><span class="line">curl -OL https://file.babudiu.com/f/w0ty/mysql &amp;&amp; <span class="built_in">chmod</span> +x mysql</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt install -y libncurses5</span><br><span class="line">curl -OL https://file.babudiu.com/f/w0ty/mysql &amp;&amp; <span class="built_in">chmod</span> +x mysql</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div><h2 id="æ–¹æ³•äºŒã€ä½¿ç”¨æºå®‰è£…"><a href="#æ–¹æ³•äºŒã€ä½¿ç”¨æºå®‰è£…" class="headerlink" title="æ–¹æ³•äºŒã€ä½¿ç”¨æºå®‰è£…"></a>æ–¹æ³•äºŒã€ä½¿ç”¨æºå®‰è£…</h2><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">CentOS</button><button type="button" class="tab">Debian/Ubuntu</button></div><div class="tab-contents"><div class="tab-item-content active"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y ncurses-libs mariadb-client</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sed -i <span class="string">&#x27;s@//.*debian.org@//mirrors.ustc.edu.cn@g&#x27;</span> /etc/apt/sources.list</span><br><span class="line">sed -i <span class="string">&#x27;s@//.*ubuntu.com@//mirrors.ustc.edu.cn@g&#x27;</span> /etc/apt/sources.list</span><br><span class="line"></span><br><span class="line">apt update &amp;&amp; apt install -y libncurses5 mariadb-client</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Linuxæ—¶é—´å¤„ç†ä¸æ ¼å¼åŒ–</title>
      <link href="/posts/871fdda4/"/>
      <url>/posts/871fdda4/</url>
      
        <content type="html"><![CDATA[<p>ä½¿ç”¨ shell è„šæœ¬çš„æ—¶å€™ï¼Œå¯ä»¥æŒ‰ç…§æŒ‡å®šæ ¼å¼è¾“å‡ºæ—¶é—´ã€‚</p><h2 id="æŠŠ-unix-æ—¶é—´æˆ³è½¬æ¢ä¸ºäººç±»å¯è¯»çš„æ—¶é—´"><a href="#æŠŠ-unix-æ—¶é—´æˆ³è½¬æ¢ä¸ºäººç±»å¯è¯»çš„æ—¶é—´" class="headerlink" title="æŠŠ unix æ—¶é—´æˆ³è½¬æ¢ä¸ºäººç±»å¯è¯»çš„æ—¶é—´"></a>æŠŠ unix æ—¶é—´æˆ³è½¬æ¢ä¸ºäººç±»å¯è¯»çš„æ—¶é—´</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">date</span> -d @1660396123 +<span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span></span><br></pre></td></tr></table></figure><h2 id="æ—¶é—´è½¬æ¢ä¸º-unix-æ—¶é—´æˆ³"><a href="#æ—¶é—´è½¬æ¢ä¸º-unix-æ—¶é—´æˆ³" class="headerlink" title="æ—¶é—´è½¬æ¢ä¸º unix æ—¶é—´æˆ³"></a>æ—¶é—´è½¬æ¢ä¸º unix æ—¶é—´æˆ³</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">date</span> -d <span class="string">&#x27;Sat May 15 23:00:27 CST 2021&#x27;</span> +%s</span><br></pre></td></tr></table></figure><h2 id="è·å–ä¹‹å‰çš„æ—¶é—´"><a href="#è·å–ä¹‹å‰çš„æ—¶é—´" class="headerlink" title="è·å–ä¹‹å‰çš„æ—¶é—´"></a>è·å–ä¹‹å‰çš„æ—¶é—´</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">date</span> -d <span class="string">&#x27;yesterday&#x27;</span> +<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span></span><br><span class="line"><span class="built_in">date</span> -d <span class="string">&#x27;-2 hours&#x27;</span> +<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">date</span> -d <span class="string">&quot;2 days ago&quot;</span> +%Y.%m.%d</span><br><span class="line"><span class="built_in">date</span> -d <span class="string">&quot;1 week ago&quot;</span> +%Y.%m.%d</span><br><span class="line"><span class="built_in">date</span> -d <span class="string">&quot;1 year ago&quot;</span> +%Y.%m.%d</span><br><span class="line"><span class="built_in">date</span> -d <span class="string">&quot;1 month ago&quot;</span> +%Y.%m.%d</span><br><span class="line"><span class="built_in">date</span> -d <span class="string">&quot;-7 days&quot;</span> +%Y%m%d</span><br></pre></td></tr></table></figure><h2 id="æŒ‡å®šæ ¼å¼è¾“å‡º"><a href="#æŒ‡å®šæ ¼å¼è¾“å‡º" class="headerlink" title="æŒ‡å®šæ ¼å¼è¾“å‡º"></a>æŒ‡å®šæ ¼å¼è¾“å‡º</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">date</span> +<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span></span><br><span class="line"><span class="comment"># 2023-11-21 13:36:51</span></span><br></pre></td></tr></table></figure><table><thead><tr><th>æ ¼å¼</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>%Y</td><td>å¹´</td></tr><tr><td>%m</td><td>æœˆ</td></tr><tr><td>%d</td><td>æ—¥</td></tr><tr><td>%H</td><td>æ—¶</td></tr><tr><td>%M</td><td>åˆ†</td></tr><tr><td>%S</td><td>ç§’</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> time </tag>
            
            <tag> æ—¶é—´ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>kubernetesåˆ é™¤èŠ‚ç‚¹</title>
      <link href="/posts/b1a2141c/"/>
      <url>/posts/b1a2141c/</url>
      
        <content type="html"><![CDATA[<h2 id="åˆ é™¤-worker-èŠ‚ç‚¹"><a href="#åˆ é™¤-worker-èŠ‚ç‚¹" class="headerlink" title="åˆ é™¤ worker èŠ‚ç‚¹"></a>åˆ é™¤ worker èŠ‚ç‚¹</h2><p>è®¾ç½®èŠ‚ç‚¹ä¸å¯è°ƒåº¦ï¼Œå³ä¸ä¼šæœ‰æ–°çš„ pod åœ¨è¯¥èŠ‚ç‚¹ä¸Šåˆ›å»º</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl cordon 172.16.21.26</span><br><span class="line">kubectl drain 172.16.21.26 --delete-local-data --ignore-daemonsets --force</span><br></pre></td></tr></table></figure><blockquote><p>â€“delete-local-data: å³ä½¿ pod ä½¿ç”¨äº† emptyDir ä¹Ÿåˆ é™¤<br>â€“ignore-daemonsets: å¿½ç•¥ deamonset æ§åˆ¶å™¨çš„ podï¼Œå¦‚æœä¸å¿½ç•¥ï¼Œdeamonset æ§åˆ¶å™¨æ§åˆ¶çš„ pod è¢«åˆ é™¤åå¯èƒ½é©¬ä¸Šåˆåœ¨æ­¤èŠ‚ç‚¹ä¸Šå¯åŠ¨èµ·æ¥,ä¼šæˆä¸ºæ­»å¾ªç¯ï¼›<br>â€“force: ä¸åŠ  force å‚æ•°åªä¼šåˆ é™¤è¯¥ NODE ä¸Šç”± ReplicationController, ReplicaSet, DaemonSet,StatefulSet or Job åˆ›å»ºçš„ Podï¼ŒåŠ äº†åè¿˜ä¼šåˆ é™¤â€™è£¸å¥”çš„ podâ€™(æ²¡æœ‰ç»‘å®šåˆ°ä»»ä½• replication controller)</p></blockquote><p>kubectl delete node 172.16.21.26</p><h2 id="åˆ é™¤-master-èŠ‚ç‚¹"><a href="#åˆ é™¤-master-èŠ‚ç‚¹" class="headerlink" title="åˆ é™¤ master èŠ‚ç‚¹"></a>åˆ é™¤ master èŠ‚ç‚¹</h2><p>æœªå®Œå¾…ç»­</p>]]></content>
      
      
      <categories>
          
          <category> å®¹å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> k8s </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨base64ç”Ÿæˆkubernetesä½¿ç”¨çš„secret yaml</title>
      <link href="/posts/462d0642/"/>
      <url>/posts/462d0642/</url>
      
        <content type="html"><![CDATA[<p>å…ˆç”³è¯·è¯ä¹¦, è¯ä¹¦ç”³è¯·ä¸‹æ¥åä¼šæœ‰ è¯ä¹¦ (ä¸€èˆ¬éƒ½æ˜¯ pem åç¼€æˆ–è€… crt åç¼€) å’Œ ç§é’¥ (ä¸€èˆ¬åç¼€æ˜¯ key)</p><p>ä½¿ç”¨ base64 åŠ å·¥ä¸€ä¸‹:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">base64</span> ./i.com_bundle.crt -w 0</span><br></pre></td></tr></table></figure><blockquote><p>-w 0 çš„æ„æ€æ˜¯ä¸æ¢è¡Œ, é»˜è®¤æ˜¯ 76 ä¸ªå­—ç¬¦æ¢è¡Œ.</p></blockquote><p>ç„¶åå¡«åˆ° Kubernetes çš„ yaml æ–‡ä»¶é‡Œé¢å³å¯.</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">tls.crt:</span> <span class="string">&lt;å•è¡Œæ–‡æœ¬è¯ä¹¦&gt;</span></span><br><span class="line">  <span class="attr">tls.key:</span> <span class="string">&lt;å•è¡Œæ–‡æœ¬key&gt;</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Secret</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">lexus-ald-i-com</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">prod-valet</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">kubernetes.io/tls</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å®¹å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> k8s </tag>
            
            <tag> base64 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨ Elasticsearch äºŒè¿›åˆ¶ tar åŒ…éƒ¨ç½²å¹¶åˆå§‹åŒ–ä¸‰èŠ‚ç‚¹é›†ç¾¤</title>
      <link href="/posts/a07ebcb/"/>
      <url>/posts/a07ebcb/</url>
      
        <content type="html"><![CDATA[<p>éœ€è¦åˆå§‹åŒ–é…ç½®ä¸€ä¸ª 3 èŠ‚ç‚¹çš„é›†ç¾¤ï¼Œæˆ‘çš„æœºå™¨è¯¦æƒ…æ˜¯ï¼š</p><table><thead><tr><th>hostname</th><th>IP åœ°å€</th><th>ç³»ç»Ÿç‰ˆæœ¬</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>node-1</td><td>10.0.0.11</td><td>AlmaLinux 9.5</td><td>åˆå§‹åŒ– master èŠ‚ç‚¹</td></tr><tr><td>node-2</td><td>10.0.0.12</td><td>AlmaLinux 9.5</td><td>åˆå§‹åŒ– master èŠ‚ç‚¹</td></tr><tr><td>node-3</td><td>10.0.0.13</td><td>AlmaLinux 9.5</td><td>åˆå§‹åŒ– master èŠ‚ç‚¹</td></tr><tr><td>node-4</td><td>10.0.0.14</td><td>AlmaLinux 9.5</td><td>æ–°å¢èŠ‚ç‚¹</td></tr></tbody></table><h2 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h2><h3 id="ä¸»æœºåè§„èŒƒ-å¯é€‰"><a href="#ä¸»æœºåè§„èŒƒ-å¯é€‰" class="headerlink" title="ä¸»æœºåè§„èŒƒ (å¯é€‰)"></a>ä¸»æœºåè§„èŒƒ (å¯é€‰)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hostnamectl set-hostname es_1</span><br></pre></td></tr></table></figure><h3 id="å†…æ ¸å‚æ•°ä¿®æ”¹"><a href="#å†…æ ¸å‚æ•°ä¿®æ”¹" class="headerlink" title="å†…æ ¸å‚æ•°ä¿®æ”¹"></a>å†…æ ¸å‚æ•°ä¿®æ”¹</h3><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">ä¸´æ—¶ä¿®æ”¹</button><button type="button" class="tab">æ°¸ä¹…ä¿®æ”¹</button></div><div class="tab-contents"><div class="tab-item-content active"><p>é‡å¯åé…ç½®ä¼šä¸¢å¤±</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo sysctl -w vm.max_map_count=262144</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><p><code>vim /etc/sysctl.conf</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vm.max_map_count=262144</span><br></pre></td></tr></table></figure><p>é©¬ä¸Šç”Ÿæ•ˆï¼Œæ‰§è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo sysctl -p</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div><h3 id="å…³é—­-selinux"><a href="#å…³é—­-selinux" class="headerlink" title="å…³é—­ selinux"></a>å…³é—­ selinux</h3><p>redhat ç³»éœ€è¦ï¼ŒUbuntu ä¸ç”¨, å¦‚æœå¯åŠ¨æœåŠ¡æç¤º <code>Permission Denied</code> ï¼Œå¦‚æœæƒé™æ²¡é—®é¢˜ï¼Œé‚£å¯èƒ½æ˜¯ selinux çš„é—®é¢˜ã€‚</p><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">ä¸´æ—¶ä¿®æ”¹</button><button type="button" class="tab">æ°¸ä¹…ä¿®æ”¹</button></div><div class="tab-contents"><div class="tab-item-content active"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo setenforce 0</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><p><code>vim /etc/selinux/config</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELINUX=disabled</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div><h3 id="å…³é—­é˜²ç«å¢™"><a href="#å…³é—­é˜²ç«å¢™" class="headerlink" title="å…³é—­é˜²ç«å¢™"></a>å…³é—­é˜²ç«å¢™</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># CentOS</span></span><br><span class="line">sudo systemctl <span class="built_in">disable</span> --now firewalld</span><br><span class="line"></span><br><span class="line"><span class="comment"># Ubuntu</span></span><br><span class="line">sudo systemctl <span class="built_in">disable</span> --now ufw</span><br></pre></td></tr></table></figure><h3 id="å‡†å¤‡-ES-å®‰è£…åŒ…"><a href="#å‡†å¤‡-ES-å®‰è£…åŒ…" class="headerlink" title="å‡†å¤‡ ES å®‰è£…åŒ…"></a>å‡†å¤‡ ES å®‰è£…åŒ…</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[ ! -d /data/elasticsearch ] &amp;&amp; <span class="built_in">mkdir</span> -p /data/elasticsearch</span><br><span class="line"><span class="built_in">cd</span> /data/elasticsearch</span><br><span class="line">wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.16.2-linux-x86_64.tar.gz</span><br><span class="line">tar xf elasticsearch-7.16.2-linux-x86_64.tar.gz</span><br><span class="line"><span class="built_in">cd</span> elasticsearch-7.16.2</span><br></pre></td></tr></table></figure><h3 id="åˆ›å»ºç”¨æˆ·"><a href="#åˆ›å»ºç”¨æˆ·" class="headerlink" title="åˆ›å»ºç”¨æˆ·"></a>åˆ›å»ºç”¨æˆ·</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo useradd elasticsearch -m -s /usr/sbin/nologin</span><br></pre></td></tr></table></figure><h2 id="åˆå§‹åŒ–é›†ç¾¤é…ç½®"><a href="#åˆå§‹åŒ–é›†ç¾¤é…ç½®" class="headerlink" title="åˆå§‹åŒ–é›†ç¾¤é…ç½®"></a>åˆå§‹åŒ–é›†ç¾¤é…ç½®</h2><p><code>vim config/elasticsearch.yml</code></p><p>ä¿®æ”¹é…ç½®æ–‡ä»¶ä¸º</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é›†ç¾¤åå­—</span></span><br><span class="line"><span class="attr">cluster.name:</span> <span class="string">es_cluster</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»™èŠ‚ç‚¹å®šä¹‰ä¸ªåå­—ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¸ä¸€æ ·</span></span><br><span class="line"><span class="attr">node.name:</span> <span class="string">node-1</span></span><br><span class="line"><span class="comment"># èŠ‚ç‚¹ç›‘å¬çš„ipï¼Œæœ¬æœºIP</span></span><br><span class="line"><span class="attr">network.host:</span> <span class="number">10.0</span><span class="number">.0</span><span class="number">.11</span></span><br><span class="line"><span class="attr">http.port:</span> <span class="number">9200</span></span><br><span class="line"><span class="comment"># å°½é‡ä¸è¦é…ç½®è‡ªèº«ipï¼Œé¿å…è‡ªå¼•ç”¨é—®é¢˜ã€‚</span></span><br><span class="line"><span class="attr">discovery.seed_hosts:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;10.0.0.12:9300&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;10.0.0.13:9300&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># masterèŠ‚ç‚¹çš„ node.mane é…ç½®ï¼Œåˆå§‹åŒ–é…ç½®å“ªäº›èŠ‚ç‚¹æœ‰èµ„æ ¼é€‰ä¸¾æˆä¸»èŠ‚ç‚¹ï¼Œåˆå§‹åŒ–çš„æ—¶å€™ä¼šé€‰ä¸¾ä¸€ä¸ªmasterèŠ‚ç‚¹å‡ºæ¥ã€‚</span></span><br><span class="line"><span class="attr">cluster.initial_master_nodes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;node-1&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;node-2&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;node-3&quot;</span></span><br><span class="line"><span class="attr">transport.tcp.port:</span> <span class="number">9300</span></span><br><span class="line"><span class="attr">http.cors.enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">http.cors.allow-origin:</span> <span class="string">&quot;*&quot;</span></span><br><span class="line"><span class="attr">http.cors.allow-headers:</span> <span class="string">Authorization</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># èŠ‚ç‚¹é—´è®¤è¯é…ç½®</span></span><br><span class="line"><span class="attr">xpack.security.enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">xpack.security.transport.ssl.enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">xpack.security.transport.ssl.verification_mode:</span> <span class="string">certificate</span></span><br><span class="line"><span class="attr">xpack.security.transport.ssl.keystore.path:</span> <span class="string">elastic-certificates.p12</span></span><br><span class="line"><span class="attr">xpack.security.transport.ssl.truststore.path:</span> <span class="string">elastic-certificates.p12</span></span><br></pre></td></tr></table></figure><h3 id="ç”Ÿæˆè¯ä¹¦"><a href="#ç”Ÿæˆè¯ä¹¦" class="headerlink" title="ç”Ÿæˆè¯ä¹¦"></a>ç”Ÿæˆè¯ä¹¦</h3><blockquote><p>åœ¨ä¸€ä¸ª master ä¸Šæ‰§è¡Œå³å¯, æ‰€æœ‰é€‰é¡¹å…¨éƒ¨ä¿æŒé»˜è®¤</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./bin/elasticsearch-certutil ca</span><br><span class="line">./bin/elasticsearch-certutil cert --ca elastic-stack-ca.p12</span><br></pre></td></tr></table></figure><h3 id="å¤åˆ¶è¯ä¹¦"><a href="#å¤åˆ¶è¯ä¹¦" class="headerlink" title="å¤åˆ¶è¯ä¹¦"></a>å¤åˆ¶è¯ä¹¦</h3><blockquote><p>æŠŠç”Ÿæˆçš„æ–‡ä»¶æ”¾åˆ° conf ä¸‹</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mv</span> elastic-certificates.p12  elastic-stack-ca.p12 config/</span><br></pre></td></tr></table></figure><p>ç„¶åæŠŠè¿™ä¸¤ä¸ªæ–‡ä»¶å¤åˆ¶åˆ°å…¶ä»–çš„èŠ‚ç‚¹ config ç›®å½•ä¸‹.</p><h3 id="æ–‡ä»¶æƒé™"><a href="#æ–‡ä»¶æƒé™" class="headerlink" title="æ–‡ä»¶æƒé™"></a>æ–‡ä»¶æƒé™</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chown</span> -R elasticsearch:elasticsearch /data/elasticsearch</span><br></pre></td></tr></table></figure><h3 id="ç”Ÿæˆ-systemd-å¯åŠ¨è„šæœ¬"><a href="#ç”Ÿæˆ-systemd-å¯åŠ¨è„šæœ¬" class="headerlink" title="ç”Ÿæˆ systemd å¯åŠ¨è„šæœ¬"></a>ç”Ÿæˆ systemd å¯åŠ¨è„šæœ¬</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; /usr/lib/systemd/system/elasticsearch.service &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">[Unit]</span></span><br><span class="line"><span class="string">Description=elasticsearch</span></span><br><span class="line"><span class="string">After=network.target</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Service]</span></span><br><span class="line"><span class="string">Type=simple</span></span><br><span class="line"><span class="string">User=elasticsearch</span></span><br><span class="line"><span class="string">Group=elasticsearch</span></span><br><span class="line"><span class="string">LimitNOFILE=100000</span></span><br><span class="line"><span class="string">LimitNPROC=100000</span></span><br><span class="line"><span class="string">Restart=no</span></span><br><span class="line"><span class="string">ExecStart=/data/elasticsearch/elasticsearch-7.16.2/bin/elasticsearch</span></span><br><span class="line"><span class="string">PrivateTmp=true</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Install]</span></span><br><span class="line"><span class="string">WantedBy=multi-user.target</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><h3 id="å¯åŠ¨é›†ç¾¤"><a href="#å¯åŠ¨é›†ç¾¤" class="headerlink" title="å¯åŠ¨é›†ç¾¤"></a>å¯åŠ¨é›†ç¾¤</h3><p>ä¸€ä¸ª 3 èŠ‚ç‚¹çš„é›†ç¾¤è‡³å°‘å¯åŠ¨ 2 ä¸ªèŠ‚ç‚¹æ‰èƒ½æ­£å¸¸æœåŠ¡ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl <span class="built_in">enable</span> --now elasticsearch</span><br></pre></td></tr></table></figure><h3 id="è®¾ç½®å¯†ç "><a href="#è®¾ç½®å¯†ç " class="headerlink" title="è®¾ç½®å¯†ç "></a>è®¾ç½®å¯†ç </h3><p>åˆå§‹åŒ–å¯†ç ï¼Œåªéœ€è¦æ‰§è¡Œä¸€æ¬¡ã€‚å¦‚æœä¸èƒ½æ­£å¸¸è®¾ç½®ï¼Œæ£€æŸ¥ä¸‹æ˜¯ä¸æ˜¯åªå¯åŠ¨äº†ä¸€ä¸ªèŠ‚ç‚¹ã€‚</p><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">è‡ªåŠ¨ç”Ÿæˆæ‰€æœ‰å¯†ç </button><button type="button" class="tab">æ‰‹åŠ¨è®¾ç½®æ¯ä¸ªå¯†ç </button><button type="button" class="tab">æ‰‹åŠ¨è®¾ç½®æ¯ä¸ªå¯†ç </button></div><div class="tab-contents"><div class="tab-item-content active"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/elasticsearch-setup-passwords auto</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/elasticsearch-setup-passwords interactive</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><p>è®¾ç½®æˆå›ºå®šå¯†ç </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">ELASTIC_PASSWORD=<span class="string">&quot;12345678&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;y</span></span><br><span class="line"><span class="string"><span class="variable">$&#123;ELASTIC_PASSWORD&#125;</span></span></span><br><span class="line"><span class="string"><span class="variable">$&#123;ELASTIC_PASSWORD&#125;</span></span></span><br><span class="line"><span class="string"><span class="variable">$&#123;ELASTIC_PASSWORD&#125;</span></span></span><br><span class="line"><span class="string"><span class="variable">$&#123;ELASTIC_PASSWORD&#125;</span></span></span><br><span class="line"><span class="string"><span class="variable">$&#123;ELASTIC_PASSWORD&#125;</span></span></span><br><span class="line"><span class="string"><span class="variable">$&#123;ELASTIC_PASSWORD&#125;</span></span></span><br><span class="line"><span class="string"><span class="variable">$&#123;ELASTIC_PASSWORD&#125;</span></span></span><br><span class="line"><span class="string"><span class="variable">$&#123;ELASTIC_PASSWORD&#125;</span></span></span><br><span class="line"><span class="string"><span class="variable">$&#123;ELASTIC_PASSWORD&#125;</span></span></span><br><span class="line"><span class="string"><span class="variable">$&#123;ELASTIC_PASSWORD&#125;</span></span></span><br><span class="line"><span class="string"><span class="variable">$&#123;ELASTIC_PASSWORD&#125;</span></span></span><br><span class="line"><span class="string"><span class="variable">$&#123;ELASTIC_PASSWORD&#125;</span>&quot;</span> | ./bin/elasticsearch-setup-passwords interactive</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div><h2 id="æ£€æŸ¥é›†ç¾¤"><a href="#æ£€æŸ¥é›†ç¾¤" class="headerlink" title="æ£€æŸ¥é›†ç¾¤"></a>æ£€æŸ¥é›†ç¾¤</h2><h3 id="æ£€æŸ¥æ—¥å¿—"><a href="#æ£€æŸ¥æ—¥å¿—" class="headerlink" title="æ£€æŸ¥æ—¥å¿—"></a>æ£€æŸ¥æ—¥å¿—</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">tail</span> -f /data/elasticsearch/elasticsearch-7.16.2/logs/es_cluster.log</span><br></pre></td></tr></table></figure><h3 id="æ£€æŸ¥èŠ‚ç‚¹çŠ¶æ€"><a href="#æ£€æŸ¥èŠ‚ç‚¹çŠ¶æ€" class="headerlink" title="æ£€æŸ¥èŠ‚ç‚¹çŠ¶æ€"></a>æ£€æŸ¥èŠ‚ç‚¹çŠ¶æ€</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@test1 logs]<span class="comment"># curl -u elastic:6xr7pJvcNmoNlMFZNGP4 10.0.0.11:9200/_cat/nodes?v</span></span><br><span class="line">ip        heap.percent ram.percent cpu load_1m load_5m load_15m node.role   master name</span><br><span class="line">10.0.0.11           44          95   0    0.00    0.00     0.00 cdfhilmrstw -      node-1</span><br><span class="line">10.0.0.13           25          95   0    0.00    0.00     0.00 cdfhilmrstw -      node-3</span><br><span class="line">10.0.0.12           38          95   0    0.00    0.00     0.00 cdfhilmrstw *      node-2</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="æ£€æŸ¥é›†ç¾¤çŠ¶æ€"><a href="#æ£€æŸ¥é›†ç¾¤çŠ¶æ€" class="headerlink" title="æ£€æŸ¥é›†ç¾¤çŠ¶æ€"></a>æ£€æŸ¥é›†ç¾¤çŠ¶æ€</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@test1 logs]<span class="comment"># curl -u elastic:6xr7pJvcNmoNlMFZNGP4 10.0.0.11:9200/_cat/health?v</span></span><br><span class="line">epoch      timestamp cluster    status node.total node.data shards pri relo init unassign pending_tasks max_task_wait_time active_shards_percent</span><br><span class="line">1740216850 09:34:10  es_cluster green           4         4      8   4    0    0        0             0                  -                100.0%</span><br></pre></td></tr></table></figure><h2 id="æ–°å¢èŠ‚ç‚¹"><a href="#æ–°å¢èŠ‚ç‚¹" class="headerlink" title="æ–°å¢èŠ‚ç‚¹"></a>æ–°å¢èŠ‚ç‚¹</h2><p>æ–°èŠ‚ç‚¹æŒ‰ç…§ä¸Šé¢æ­¥éª¤æ‰§è¡Œä¸€éï¼Œä¸è¿‡ä¸éœ€è¦ç”Ÿæˆè¯ä¹¦ï¼Œå°†ç”Ÿæˆè¿‡çš„è¯ä¹¦å¤åˆ¶åˆ°æ–°èŠ‚ç‚¹çš„å¯¹åº”ç›®å½•ï¼Œä¸éœ€è¦è®¾ç½®å¯†ç ï¼Œå¯åŠ¨èŠ‚ç‚¹åä¼šè‡ªåŠ¨åŠ å…¥é›†ç¾¤ä¸­ã€‚<br>æ–°èŠ‚ç‚¹ä¸éœ€è¦é…ç½® <code>cluster.initial_master_nodes:</code> äº†ï¼Œè¿™ä¸ªæ˜¯åˆå§‹åŒ–ç”¨åˆ°çš„é…ç½®ã€‚<br>æ–°å¢çš„èŠ‚ç‚¹ä¹Ÿå¯ä»¥é…ç½®æˆä¸»èŠ‚ç‚¹ï¼Œä¹Ÿå¯ä»¥é…ç½®æˆæ•°æ®èŠ‚ç‚¹ï¼š</p><h3 id="é…ç½®æˆæ•°æ®èŠ‚ç‚¹"><a href="#é…ç½®æˆæ•°æ®èŠ‚ç‚¹" class="headerlink" title="é…ç½®æˆæ•°æ®èŠ‚ç‚¹"></a>é…ç½®æˆæ•°æ®èŠ‚ç‚¹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">node.master: <span class="literal">false</span></span><br><span class="line">node.data: <span class="literal">true</span></span><br></pre></td></tr></table></figure><h3 id="é…ç½®æˆä¸»èŠ‚ç‚¹"><a href="#é…ç½®æˆä¸»èŠ‚ç‚¹" class="headerlink" title="é…ç½®æˆä¸»èŠ‚ç‚¹"></a>é…ç½®æˆä¸»èŠ‚ç‚¹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">node.master: <span class="literal">true</span></span><br><span class="line">node.data: <span class="literal">false</span></span><br></pre></td></tr></table></figure><h2 id="kibana-æ­å»ºï¼ˆå¯é€‰ï¼‰"><a href="#kibana-æ­å»ºï¼ˆå¯é€‰ï¼‰" class="headerlink" title="kibana æ­å»ºï¼ˆå¯é€‰ï¼‰"></a>kibana æ­å»ºï¼ˆå¯é€‰ï¼‰</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://artifacts.elastic.co/downloads/kibana/kibana-7.16.2-linux-x86_64.tar.gz</span><br><span class="line">tar xf kibana-7.16.2-linux-x86_64.tar.gz</span><br></pre></td></tr></table></figure><p>å‡†å¤‡ kibana çš„é…ç½®æ–‡ä»¶ <code>kibana.yml</code></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server.name:</span> <span class="string">kibana</span></span><br><span class="line"><span class="attr">server.port:</span> <span class="number">5601</span></span><br><span class="line"><span class="attr">server.host:</span> <span class="string">&quot;0.0.0.0&quot;</span></span><br><span class="line"><span class="attr">elasticsearch.username:</span> <span class="string">&quot;elastic&quot;</span></span><br><span class="line"><span class="attr">elasticsearch.password:</span> <span class="string">&quot;12345678&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">elasticsearch.hosts:</span> [<span class="string">&quot;http://10.0.0.11:9200&quot;</span>, <span class="string">&quot;http://10.0.0.12:9200&quot;</span>, <span class="string">&quot;http://10.0.0.13:9200&quot;</span>]</span><br><span class="line"><span class="attr">i18n.locale:</span> <span class="string">&quot;zh-CN&quot;</span></span><br></pre></td></tr></table></figure><p>å¯åŠ¨ kibana</p><h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><p>tar åŒ…å®‰è£…çš„è¦å…³é—­ selinuxï¼Œä¸ç„¶æç¤º <code>Permission denied</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo setenforce 0</span><br></pre></td></tr></table></figure><p><code>vm.max_map_count [65530] is too low, increase to at least [262144]</code> éœ€è¦æ‰§è¡Œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo sysctl -w vm.max_map_count=262144</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ­å»º </tag>
            
            <tag> Elasticsearch </tag>
            
            <tag> ES </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dockerå¤šé˜¶æ®µæ„å»º</title>
      <link href="/posts/4161b051/"/>
      <url>/posts/4161b051/</url>
      
        <content type="html"><![CDATA[<p>æ„å»º Docker é•œåƒçš„æ—¶å€™,æˆ‘ä»¬å¯ä»¥åœ¨æœºå™¨ä¸Šç›´æ¥æ„å»º,ä¹Ÿå¯ä»¥ä½¿ç”¨å®¹å™¨æ¥æ„å»º,ä¿è¯ç¯å¢ƒçš„ç»Ÿä¸€æ€§, é€šè¿‡å®¹å™¨æ¥æ„å»ºä¼šæœ‰ä¸€ä¸ªé—®é¢˜,å°±æ˜¯æ„å»ºä½¿ç”¨åˆ°çš„å·¥å…·å¹¶ä¸éœ€è¦å¸¦å…¥åˆ°çœŸæ­£çš„è¿è¡Œç¯å¢ƒ, æ¯”å¦‚è¯´ä½¿ç”¨ nodejs çš„å‰ç«¯é¡¹ç›®, æ„å»ºçš„æ—¶å€™éœ€è¦ nodejs æˆ–è€… npm, ä½†æ˜¯è¿è¡Œçš„æ—¶å€™éœ€è¦çš„æ˜¯ nginx. å¤šé˜¶æ®µæ„å»ºå³ä¸ºæ„å»ºå®Œæˆåç›´æ¥å°†ä»£ç å¡è¿›è¿è¡Œå®¹å™¨, ä¸ä¼šå¸¦å…¥æ„å»ºç¯å¢ƒ.</p><h2 id="ç¼–å†™-Dockerfile"><a href="#ç¼–å†™-Dockerfile" class="headerlink" title="ç¼–å†™ Dockerfile"></a>ç¼–å†™ Dockerfile</h2><p>vim Dockerfile</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> node:<span class="number">14.20</span>.<span class="number">1</span>-buster AS build</span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash"> argus-wfe /argus-wfe</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /argus-wfe</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> yarn &amp;&amp; yarn run build</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">From</span> nginx</span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> --from=build /argus-wfe/dist /usr/share/nginx/html</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å®¹å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
            <tag> Build </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mRemoteNG å¦‚ä½•æ˜¾ç¤ºä¿å­˜çš„å¯†ç </title>
      <link href="/posts/sm0nds/"/>
      <url>/posts/sm0nds/</url>
      
        <content type="html"><![CDATA[<p>mRemoteNG æ˜¯ä¸€æ¬¾æ¯”è¾ƒå¥½ç”¨çš„ Windows å¹³å°çš„è¿æ¥ RDP çš„ç®¡ç†å·¥å…·ï¼Œéå¸¸å¥½ç”¨ï¼Œæ”¯æŒé€‰é¡¹å¡ï¼Œé…ç½®æ–‡ä»¶ç®¡ç†ï¼Œè´¦å·å¯†ç ç®¡ç†ç­‰ã€‚è™½ç„¶ç°åœ¨ xshell 8 ä¹Ÿæ”¯æŒè¿æ¥ rdp äº†ï¼Œä½†æ˜¯æ²¡æœ‰è¿™ä¸ªå¥½ç”¨ã€‚mRemoteNG ä¹Ÿæ”¯æŒè¿æ¥ vnc å’Œ sshï¼Œä½†æ˜¯ä¸å¥½ç”¨ï¼Œæˆ‘åªç”¨å®ƒæ¥è¿ rdp</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202410272116148.png" alt="image.png"></p><p>ä¸è¿‡æ·»åŠ å¥½çš„é…ç½®æ–‡ä»¶ï¼Œå¯†ç æ˜¯åŠ å¯†çš„ï¼Œå¯¼å‡ºé…ç½®æ–‡ä»¶ä¹Ÿçœ‹ä¸åˆ°åŸå¯†ç ï¼Œå¦‚æœæˆ‘æ·»åŠ äº†é…ç½®ï¼Œè¿‡äº†ä¸€æ®µæ—¶é—´å¿˜è®°äº†å¯†ç ï¼Œå¯ä»¥é€šè¿‡è¿™ç§æ–¹æ³•æ¥æ‰¾å›å¯†ç ã€‚</p><p>é…ç½® å¤–éƒ¨å·¥å…· æ–°å¢ä¸€ä¸ªå¤–éƒ¨å·¥å…·ï¼Œé…ç½®å¦‚ä¸‹ï¼š</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202410272122994.png" alt="image.png"></p><table><thead><tr><th>åç§°</th><th>é…ç½®</th></tr></thead><tbody><tr><td>æ˜¾ç¤ºåç§°</td><td>æ˜¾ç¤ºå¯†ç </td></tr><tr><td>æ–‡ä»¶å</td><td>cmd</td></tr><tr><td>å‚æ•°</td><td>&#x2F;k echo %password%</td></tr><tr><td>é€‰é¡¹</td><td>çœ‹ä¸Šå›¾</td></tr></tbody></table><p>ä½¿ç”¨æ–¹æ³•ï¼š<br>åœ¨è¿æ¥ä¸Šé¢å³é”®ï¼Œé€‰æ‹©å·¥å…· â€“ æ˜¾ç¤ºå¯†ç <br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202410272125763.png" alt="image.png"></p><p>åœ¨å¼¹å‡ºçš„ cmd çª—å£ä¸­ä¼šæ˜¾ç¤ºå‡ºå¯†ç æ˜æ–‡<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202410272126009.png" alt="image.png"></p>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rdp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ElasticSearchå‡çº§ç‰ˆæœ¬</title>
      <link href="/posts/74398d89/"/>
      <url>/posts/74398d89/</url>
      
        <content type="html"><![CDATA[<p>èƒŒæ™¯ï¼šes æ—§ç‰ˆæœ¬æœ‰ log4j æ¼æ´ï¼Œéœ€è¦è¿›è¡Œå‡çº§å¤„ç†ï¼Œå› ä¸ºæ˜¯ä½¿ç”¨ yum å®‰è£…çš„ï¼Œå‡çº§ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œè¿™é‡Œè®°å½•ä¸€ä¸‹ï¼Œè¿™é‡Œé€‰æ‹©çš„ç‰ˆæœ¬æ˜¯ 7.16.2</p><p>æ›´æ–°æ—¥å¿—ï¼š <a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.17/release-notes-7.16.2.html">https://www.elastic.co/guide/en/elasticsearch/reference/7.17/release-notes-7.16.2.html</a></p><h2 id="é¦–å…ˆä¸‹è½½å®‰è£…åŒ…"><a href="#é¦–å…ˆä¸‹è½½å®‰è£…åŒ…" class="headerlink" title="é¦–å…ˆä¸‹è½½å®‰è£…åŒ…"></a>é¦–å…ˆä¸‹è½½å®‰è£…åŒ…</h2><p>é˜¿é‡Œäº‘é•œåƒåœ°å€ï¼š<a href="https://mirrors.aliyun.com/elasticstack/7.x/yum/7.16.2/">https://mirrors.aliyun.com/elasticstack/7.x/yum/7.16.2/</a></p><p>è…¾è®¯äº‘é•œåƒåœ°å€ï¼š<a href="https://mirrors.cloud.tencent.com/elasticstack/7.x/yum/7.16.2/">https://mirrors.cloud.tencent.com/elasticstack/7.x/yum/7.16.2/</a></p><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -Uvh ./elasticsearch-7.16.2-x86_64.rpm</span><br></pre></td></tr></table></figure><h2 id="é‡æ–°å¯åŠ¨"><a href="#é‡æ–°å¯åŠ¨" class="headerlink" title="é‡æ–°å¯åŠ¨"></a>é‡æ–°å¯åŠ¨</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart elasticsearch.service </span><br></pre></td></tr></table></figure><h2 id="å¸¸è§é”™è¯¯"><a href="#å¸¸è§é”™è¯¯" class="headerlink" title="å¸¸è§é”™è¯¯"></a>å¸¸è§é”™è¯¯</h2><p>java.lang.IllegalStateException: codebase property already set: codebase.jackson-annotations -&gt; file:&#x2F;usr&#x2F;share&#x2F;elasticsearch&#x2F;modules&#x2F;ingest-geoip&#x2F;jackson-annotations-2.12.2.jar, cannot set to file:&#x2F;usr&#x2F;share&#x2F;elasticsearch&#x2F;modules&#x2F;ingest-geoip&#x2F;jackson-annotations-2.10.4.jar</p><blockquote><p>è¿™ç§æƒ…å†µæ˜¯ç”±äºç‰ˆæœ¬ç›¸å·®è¾ƒå¤§é€ æˆçš„ã€‚å·²ç»åŠ è½½äº†ä¸€ä¸ªç‰ˆæœ¬çš„åŒ…ï¼Œä¸èƒ½å†åŠ è½½å¦ä¸€ä¸ªç‰ˆæœ¬çš„åŒ…ã€‚</p></blockquote><p>å®‰è£…æ—¶çš„æç¤ºï¼š</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@l7---es-<span class="number">3</span> ~]# rpm -Uvh ./elasticsearch-<span class="number">7.16</span>.<span class="number">2</span>-x86_64.rpm </span><br><span class="line">warning: ./elasticsearch-<span class="number">7.16</span>.<span class="number">2</span>-x86_64.rpm: Header V4 RSA/SHA512 Signature, key ID d88e42b4: NOKEY</span><br><span class="line">Preparing...                          ################################# [<span class="number">100</span>%]</span><br><span class="line">Updating / installing...</span><br><span class="line">   <span class="number">1</span>:elasticsearch-<span class="number">0</span>:<span class="number">7.16</span>.<span class="number">2</span>-<span class="number">1</span>         warning: /etc/elasticsearch/elasticsearch.yml created <span class="keyword">as</span> /etc/elasticsearch/elasticsearch.yml.rpmnew</span><br><span class="line">warning: /etc/elasticsearch/jvm.<span class="keyword">options</span> created <span class="keyword">as</span> /etc/elasticsearch/jvm.<span class="keyword">options</span>.rpmnew</span><br><span class="line">################################# [ <span class="number">50</span>%]</span><br><span class="line">Cleaning <span class="keyword">up</span> / removing...</span><br><span class="line">   <span class="number">2</span>:elasticsearch-<span class="number">0</span>:<span class="number">7.5</span>.<span class="number">0</span>-<span class="number">1</span>          warning: <span class="keyword">file</span> /usr/share/elasticsearch/modules/ingest-geoip/jackson-databind-<span class="number">2.8</span>.<span class="number">11.3</span>.jar: <span class="built_in">remove</span> failed: No such <span class="keyword">file</span> <span class="built_in">or</span> directory</span><br><span class="line">warning: <span class="keyword">file</span> /usr/share/elasticsearch/modules/ingest-geoip/jackson-annotations-<span class="number">2.8</span>.<span class="number">11</span>.jar: <span class="built_in">remove</span> failed: No such <span class="keyword">file</span> <span class="built_in">or</span> directory</span><br><span class="line">################################# [<span class="number">100</span>%]</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™é‡Œå¾ˆæ˜æ˜¾æ˜¯å®‰è£…çš„æ—¶å€™å®‰è£…è„šæœ¬ä¼šç§»é™¤æ—§çš„ jar åŒ…ï¼Œä½†æ˜¯æ²¡æœ‰æ‰¾åˆ°è¿™ä¸ªæ–‡ä»¶</p><p>è§£å†³æ–¹æ¡ˆï¼š</p><p>cd &#x2F;usr&#x2F;share&#x2F;elasticsearch&#x2F;modules&#x2F;ingest-geoip&#x2F;</p><p>åˆ é™¤æ—§ç‰ˆæœ¬çš„ jar åŒ…</p>]]></content>
      
      
      <categories>
          
          <category> æ—¥å¿— </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Elasticsearch </tag>
            
            <tag> ES </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Windowsè®¾ç½®OEMä¿¡æ¯</title>
      <link href="/posts/6f85bc6b/"/>
      <url>/posts/6f85bc6b/</url>
      
        <content type="html"><![CDATA[<p>OEM ä¿¡æ¯å­˜å‚¨äºæ³¨å†Œè¡¨ä¸­ï¼Œä¿®æ”¹æ³¨å†Œè¡¨å³å¯ã€‚</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line"></span><br><span class="line">%<span class="number">1</span> mshta vbscript:CreateObject(&quot;Shell.Application&quot;).ShellExecute(&quot;<span class="built_in">cmd</span>.exe&quot;,&quot;/c %~s0 ::&quot;,&quot;&quot;,&quot;runas&quot;,<span class="number">1</span>)(window.close)&amp;&amp;<span class="keyword">exit</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /d &quot;%~dp0&quot;</span><br><span class="line"></span><br><span class="line">reg add &quot;HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\OEMInformation&quot; /f /v &quot;SupportURL&quot; /t REG_SZ /d &quot;https://zahui.fan&quot;</span><br><span class="line">reg add &quot;HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\OEMInformation&quot; /f /v &quot;Model&quot; /t REG_SZ /d &quot;PC&quot;</span><br><span class="line">reg add &quot;HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\OEMInformation&quot; /f /v &quot;SupportHours&quot; /t REG_SZ /d &quot;<span class="number">8</span>:<span class="number">00</span>-<span class="number">22</span>:<span class="number">00</span>&quot;</span><br><span class="line">reg add &quot;HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\OEMInformation&quot; /f /v &quot;SupportPhone&quot; /t REG_SZ /d &quot;<span class="number">17621268822</span>&quot;</span><br><span class="line">reg add &quot;HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\OEMInformation&quot; /f /v &quot;Logo&quot; /t REG_SZ /d &quot;C:\Windows\Media\logo.bmp&quot;</span><br><span class="line">reg add &quot;HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\OEMInformation&quot; /f /v &quot;Manufacturer&quot; /t REG_SZ /d &quot;å¼ ç†å¤&quot;</span><br><span class="line"><span class="built_in">copy</span> logo.bmp <span class="variable">%windir%</span>\media\logo.bmp</span><br></pre></td></tr></table></figure><p>å¦‚æœéœ€è¦åˆ é™¤ OEM ä¿¡æ¯<br><code>reg delete &quot;HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\OEMInformation&quot; /f</code></p>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ³¨å†Œè¡¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Bitlockerç›¸å…³ä½¿ç”¨è¯´æ˜</title>
      <link href="/posts/55d95f5b/"/>
      <url>/posts/55d95f5b/</url>
      
        <content type="html"><![CDATA[<h2 id="è§£é”-bitlocker"><a href="#è§£é”-bitlocker" class="headerlink" title="è§£é” bitlocker"></a>è§£é” bitlocker</h2><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">manage-bde â€“unlock E: -RecoveryPassword ******</span><br></pre></td></tr></table></figure><h2 id="ä¿å­˜åˆ°-Microsoft-è´¦æˆ·çš„-Bitlocker-ç§˜é’¥"><a href="#ä¿å­˜åˆ°-Microsoft-è´¦æˆ·çš„-Bitlocker-ç§˜é’¥" class="headerlink" title="ä¿å­˜åˆ° Microsoft è´¦æˆ·çš„ Bitlocker ç§˜é’¥"></a>ä¿å­˜åˆ° Microsoft è´¦æˆ·çš„ Bitlocker ç§˜é’¥</h2><p><a href="https://account.microsoft.com/devices/recoverykey">https://account.microsoft.com/devices/recoverykey</a></p><h2 id="æ‰‹åŠ¨é”å®š-Bitlocker"><a href="#æ‰‹åŠ¨é”å®š-Bitlocker" class="headerlink" title="æ‰‹åŠ¨é”å®š Bitlocker"></a>æ‰‹åŠ¨é”å®š Bitlocker</h2><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">%systemdrive%</span>\Windows\System32\Manage-bde.exe â€“lock d:</span><br></pre></td></tr></table></figure><p>å¦‚æœæœ‰æ‰“å¼€çš„æ–‡ä»¶ï¼Œåˆ™ä¼šæç¤ºè§£é”ä¸æˆåŠŸï¼Œè¿™æ—¶å¯ä»¥åŠ ä¸Šå¼ºåˆ¶é€‰é¡¹ï¼š</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">%systemdrive%</span>\Windows\System32\Manage-bde.exe -lock -fd d:</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> BitLocker </tag>
            
            <tag> åŠ å¯† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Windowsé‡ç½®ç»„ç­–ç•¥å’Œå®‰å…¨ç­–ç•¥</title>
      <link href="/posts/11456cf7/"/>
      <url>/posts/11456cf7/</url>
      
        <content type="html"><![CDATA[<p>è¿˜åŸæœ¬åœ°å®‰å…¨ç­–ç•¥</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">secedit /configure /cfg <span class="variable">%windir%</span>\inf\defltbase.inf /db defltbase.sdb /verbose</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨å‘½ä»¤è¡Œé‡ç½®ç»„ç­–ç•¥å¯¹è±¡</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">RD</span> /S /Q &quot;<span class="variable">%WinDir%</span>\System32\GroupPolicyUsers&quot;</span><br><span class="line"><span class="built_in">RD</span> /S /Q &quot;<span class="variable">%WinDir%</span>\System32\GroupPolicy&quot;</span><br><span class="line">gpupdate /force</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç»„ç­–ç•¥ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ¶ä½œç»¿è‰²ç‰ˆChromeæµè§ˆå™¨</title>
      <link href="/posts/8d9e31b7/"/>
      <url>/posts/8d9e31b7/</url>
      
        <content type="html"><![CDATA[<p>ç»¿è‰²ç‰ˆç¨‹åºåªéœ€è¦å°†å®‰è£…åçš„æ–‡ä»¶å¤¹æ‹·è´ä¸€ä»½å³å¯å®ç°ç»¿è‰²åŒ–ï¼Œä¸è¿‡æµè§ˆå™¨ç”Ÿæˆçš„æ•°æ®åŒ…æ‹¬ç¼“å­˜ã€ä¹¦ç­¾ã€å†å²è®°å½•ç­‰éƒ½æ˜¯å­˜å‚¨åœ¨æ“ä½œç³»ç»Ÿé»˜è®¤ä½ç½®çš„ï¼Œå®Œå…¨éšèº«æºå¸¦ï¼Œè¿˜éœ€è¦å°†æ•°æ®ç›®å½•å›ºå®šåœ¨ç¨‹åºæ–‡ä»¶å¤¹ä¸‹ã€‚</p><p>åœ¨ chrome å®‰è£…ç›®å½•åˆ›å»ºä¸€ä¸ª bat è„šæœ¬</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">start</span> chrome.exe --user-data-<span class="built_in">dir</span>=&quot;User Data&quot;</span><br></pre></td></tr></table></figure><p>ä»¥åä½¿ç”¨è¿™ä¸ª bat è„šæœ¬æ¥å¯åŠ¨æµè§ˆå™¨ï¼Œæ•°æ®æ–‡ä»¶å°±å…¨éƒ¨å­˜æ”¾åœ¨å½“å‰ç›®å½•ä¸‹çš„ User Data ç›®å½•ä¸‹</p>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æµè§ˆå™¨ </tag>
            
            <tag> ç»¿è‰²è½¯ä»¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Windowså…³æœºçŠ¶æ€ä¿®æ”¹æ³¨å†Œè¡¨å†…å®¹</title>
      <link href="/posts/36ac7ecc/"/>
      <url>/posts/36ac7ecc/</url>
      
        <content type="html"><![CDATA[<p>æ³¨å†Œè¡¨æ˜¯ windows å¹³å°ä¸€ç§ç‰¹æ®Šçš„æ•°æ®åº“ï¼Œä¸»è¦ç”¨äºå­˜å‚¨è½¯ä»¶å’Œç³»ç»Ÿçš„é…ç½®ä¿¡æ¯</p><p>æ­£å¸¸æƒ…å†µä¸‹ä¿®æ”¹æ˜¯æ‰“å¼€æ³¨å†Œè¡¨ç¼–è¾‘å™¨è¿›è¡Œä¿®æ”¹ï¼Œä¸è¿‡æœ‰äº›ç‰¹æ®Šæƒ…å†µï¼Œæ¯”å¦‚ç³»ç»Ÿå¯åŠ¨å°±è“å±ï¼Œéœ€è¦ä¿®æ”¹ç£ç›˜é©±åŠ¨å™¨ç›¸å…³çš„é…ç½®ï¼Œæˆ–è€…å°è£…ç³»ç»Ÿé•œåƒä¿®æ”¹é»˜è®¤è®¾ç½®ï¼Œæ¯”å¦‚å£çº¸ã€è®¡ç®—æœºåç­‰</p><p>æ³¨å†Œè¡¨ç±»ä¼¼äºæ•°æ®åº“ï¼Œå®ƒä¹Ÿæ˜¯ä»¥æ–‡ä»¶çš„å½¢å¼å­˜å‚¨åœ¨ç”µè„‘é‡Œé¢</p><p>ä¿®æ”¹æ–¹æ³•ï¼š</p><p>è¿›å…¥ PEï¼Œæ‰“å¼€æ³¨å†Œè¡¨ç¼–è¾‘å™¨ï¼Œå®šä½åˆ°<strong>HKEY_LOCAL_MACHINE</strong>ç„¶åç‚¹å‡» æ–‡ä»¶ - åŠ è½½é…ç½®å•å…ƒ ï¼Œé€‰æ‹©æ³¨å†Œè¡¨ Hive æ–‡ä»¶</p><p>é¦–å…ˆåˆ—å‡º Hive æ–‡ä»¶çš„ä½ç½®</p><table><thead><tr><th>Hive æ–‡ä»¶</th><th>æ³¨å†Œè¡¨ä½ç½®</th></tr></thead><tbody><tr><td>C:\Windows\System32\config\SOFTWARE</td><td>HKEY_LOCAL_MACHINE\SOFTWARE</td></tr><tr><td>C:\Windows\System32\config\SYSTEM</td><td>HKEY_LOCAL_MACHINE\SYSTEM</td></tr><tr><td>C:\Users&#x2F;Default&#x2F;NTUSER.DAT</td><td>é»˜è®¤ç”¨æˆ·é…ç½® (æ–°å»ºç”¨æˆ·æ—¶ä¼šå¤åˆ¶ä¸€ä»½åˆ°ç”¨æˆ·æ–‡ä»¶å¤¹)</td></tr><tr><td>C:\Users&#x2F;ç”¨æˆ·å&#x2F;NTUSER.DAT</td><td>HKEY_CURRENT_USER</td></tr></tbody></table><p>ä¿®æ”¹å®Œæˆï¼Œç‚¹å‡» æ–‡ä»¶ - å¸è½½é…ç½®å•å…ƒ å³å¯å®Œæˆä¿®æ”¹</p>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ³¨å†Œè¡¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Windowså®¶åº­ç‰ˆæ‰“å¼€Hyper Vè™šæ‹Ÿæœº</title>
      <link href="/posts/b428e1a3/"/>
      <url>/posts/b428e1a3/</url>
      
        <content type="html"><![CDATA[<p>å®¶åº­ç‰ˆç³»ç»Ÿä¸å¯ä»¥åœ¨ç³»ç»Ÿç¨‹åºå’ŒåŠŸèƒ½é‡Œé¢æ·»åŠ  Hyper-V åŠŸèƒ½çš„ï¼Œ ä¸è¿‡å¾®è½¯å¹¶æ²¡æœ‰ç¦æ­¢é€šè¿‡ dism å¢åŠ åŒ…çš„æ–¹å¼æ·»åŠ  Hyper-V åŠŸèƒ½ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨è¿™ç§æ–¹å¼æ¥ä½¿ç”¨ Hyper-V</p><p>æ“ä½œéœ€è¦ä½¿ç”¨ç®¡ç†å‘˜æƒé™æ¥æ‰§è¡Œ</p><h2 id="æ‰“å¼€-Hyper-V"><a href="#æ‰“å¼€-Hyper-V" class="headerlink" title="æ‰“å¼€ Hyper-V"></a>æ‰“å¼€ Hyper-V</h2><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">pushd</span> &quot;%~dp0&quot;</span><br><span class="line"><span class="built_in">dir</span> /b <span class="variable">%SystemRoot%</span>\servicing\Packages\*Hyper-V*.mum &gt;hyper-v.txt</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> /f <span class="variable">%%i</span> <span class="keyword">in</span> (&#x27;<span class="built_in">findstr</span> /i . hyper-v.txt <span class="number">2</span>^&gt;<span class="built_in">nul</span>&#x27;) <span class="keyword">do</span> dism /online /norestart /add-Package:&quot;<span class="variable">%SystemRoot%</span>\servicing\Packages\<span class="variable">%%i</span>&quot;</span><br><span class="line"></span><br><span class="line"><span class="built_in">del</span> hyper-v.txt</span><br><span class="line"></span><br><span class="line">Dism /online /enable-feature /featurename:Microsoft-Hyper-V-All /LimitAccess /ALL</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="å…³é—­-Hyper-V"><a href="#å…³é—­-Hyper-V" class="headerlink" title="å…³é—­ Hyper-V"></a>å…³é—­ Hyper-V</h2><h3 id="åˆ é™¤-Hyper-V-ç»„ä»¶"><a href="#åˆ é™¤-Hyper-V-ç»„ä»¶" class="headerlink" title="åˆ é™¤ Hyper-V ç»„ä»¶"></a>åˆ é™¤ Hyper-V ç»„ä»¶</h3><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">pushd</span> &quot;%~dp0&quot;</span><br><span class="line"><span class="built_in">dir</span> /b <span class="variable">%SystemRoot%</span>\servicing\Packages\*Hyper-V*.mum &gt;hyper-v.txt</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> /f <span class="variable">%%i</span> <span class="keyword">in</span> (&#x27;<span class="built_in">findstr</span> /i . hyper-v.txt <span class="number">2</span>^&gt;<span class="built_in">nul</span>&#x27;) <span class="keyword">do</span> dism /online /norestart /Remove-Package:&quot;<span class="variable">%SystemRoot%</span>\servicing\Packages\<span class="variable">%%i</span>&quot;</span><br><span class="line"></span><br><span class="line"><span class="built_in">del</span> hyper-v.txt</span><br><span class="line"></span><br><span class="line">Dism /online /disable-feature /featurename:Microsoft-Hyper-V-All /LimitAccess /ALL</span><br></pre></td></tr></table></figure><h3 id="å…³é—­éœ€è¦ä¿®æ”¹å¯åŠ¨é…ç½®"><a href="#å…³é—­éœ€è¦ä¿®æ”¹å¯åŠ¨é…ç½®" class="headerlink" title="å…³é—­éœ€è¦ä¿®æ”¹å¯åŠ¨é…ç½®"></a>å…³é—­éœ€è¦ä¿®æ”¹å¯åŠ¨é…ç½®</h3><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">bcdedit /<span class="built_in">set</span> hypervisorlaunchtype off</span><br><span class="line"></span><br><span class="line"># æ¢å¤é…ç½®</span><br><span class="line"># bcdedit /<span class="built_in">set</span> hypervisorlaunchtype auto</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hyper-V </tag>
            
            <tag> VirtualMachine </tag>
            
            <tag> è™šæ‹ŸåŒ– </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxå¸¸ç”¨å‘½ä»¤ä¹‹xargs</title>
      <link href="/posts/d680904b/"/>
      <url>/posts/d680904b/</url>
      
        <content type="html"><![CDATA[<p>å¤šè¡Œè¾“å…¥å•è¡Œè¾“å‡ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat test</span></span><br><span class="line">1 2 3</span><br><span class="line">4 5 6</span><br><span class="line"></span><br><span class="line"><span class="comment"># cat test| xargs</span></span><br><span class="line">1 2 3 4 5 6</span><br></pre></td></tr></table></figure><p>å¤šè¡Œè¾“å‡º</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat test | xargs -n 2</span></span><br><span class="line">1 2</span><br><span class="line">3 4</span><br><span class="line">5 6</span><br></pre></td></tr></table></figure><p>è‡ªå®šä¹‰ä¸€ä¸ªå®šç•Œç¬¦</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -d é€‰é¡¹å¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªå®šç•Œç¬¦ï¼š</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;nameXnameXnameXname&quot;</span> | xargs -dX</span><br><span class="line">name name name name</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»“åˆ -n é€‰é¡¹ä½¿ç”¨ï¼š</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;nameXnameXnameXname&quot;</span> | xargs -dX -n2</span><br><span class="line">name name</span><br><span class="line">name name</span><br></pre></td></tr></table></figure><p>å¤åˆ¶æ‰€æœ‰å›¾ç‰‡æ–‡ä»¶åˆ° &#x2F;data&#x2F;images ç›®å½•ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> *.jpg | xargs -n1 -I &#123;&#125; <span class="built_in">cp</span> &#123;&#125; /data/images</span><br></pre></td></tr></table></figure><p>xargs ç»“åˆ find ä½¿ç”¨<br>ç”¨ rm åˆ é™¤å¤ªå¤šçš„æ–‡ä»¶æ—¶å€™ï¼Œå¯èƒ½å¾—åˆ°ä¸€ä¸ªé”™è¯¯ä¿¡æ¯ï¼š&#x2F;bin&#x2F;rm Argument list too long. ç”¨ xargs å»é¿å…è¿™ä¸ªé—®é¢˜ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">find . -<span class="built_in">type</span> f -name <span class="string">&quot;*.log&quot;</span> -print0 | xargs -0 <span class="built_in">rm</span> -f</span><br><span class="line"><span class="comment"># xargs -0 å°† \0 ä½œä¸ºå®šç•Œç¬¦ã€‚</span></span><br></pre></td></tr></table></figure><p>ç»Ÿè®¡ä¸€ä¸ªæºä»£ç ç›®å½•ä¸­æ‰€æœ‰ php æ–‡ä»¶çš„è¡Œæ•°ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find . -<span class="built_in">type</span> f -name <span class="string">&quot;*.php&quot;</span> -print0 | xargs -0 <span class="built_in">wc</span> -l</span><br></pre></td></tr></table></figure><p>æŸ¥æ‰¾æ‰€æœ‰çš„ jpg æ–‡ä»¶ï¼Œå¹¶ä¸”å‹ç¼©å®ƒä»¬ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find . -<span class="built_in">type</span> f -name <span class="string">&quot;*.jpg&quot;</span> -<span class="built_in">print</span> | xargs tar -czvf images.tar.gz</span><br></pre></td></tr></table></figure><p>æŸ¥æ‰¾å¹¶æ›¿æ¢</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find -name <span class="string">&#x27;è¦æŸ¥æ‰¾çš„æ–‡ä»¶å&#x27;</span> | xargs perl -pi -e <span class="string">&#x27;s|è¢«æ›¿æ¢çš„å­—ç¬¦ä¸²|æ›¿æ¢åçš„å­—ç¬¦ä¸²|g&#x27;</span></span><br></pre></td></tr></table></figure><p>å»é™¤æ¢è¡Œç¬¦å’Œé¦–å°¾ç©ºæ ¼</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;   11 22&quot;</span> | xargs <span class="built_in">echo</span> -n</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Command </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxè®¾ç½®é»˜è®¤çš„æ–‡æœ¬ç¼–è¾‘å™¨</title>
      <link href="/posts/b8c29b0f/"/>
      <url>/posts/b8c29b0f/</url>
      
        <content type="html"><![CDATA[<p>åœ¨ Linux å‘½ä»¤è¡Œç•Œé¢ï¼Œæ¯”è¾ƒå¸¸ç”¨çš„æ˜¯ vimï¼Œä½†æ˜¯éƒ¨åˆ† linux é»˜è®¤çš„ç¼–è¾‘å™¨æ˜¯ nanoï¼Œæ‰€ä»¥æ•´ç†äº†ä¸€ä¸‹ä¿®æ”¹æ•™ç¨‹ã€‚</p><h2 id="select-editor-å‘½ä»¤"><a href="#select-editor-å‘½ä»¤" class="headerlink" title="select-editor å‘½ä»¤"></a>select-editor å‘½ä»¤</h2><p>ä½¿ç”¨ select-editor å¯ä»¥ä¿®æ”¹éƒ¨åˆ†åœºæ™¯ä¸‹ä½¿ç”¨çš„é»˜è®¤ç¼–è¾‘å™¨</p><p>ç›´æ¥æ‰§è¡Œ select-editorï¼ˆä¸è¦ç”¨ sudoï¼‰</p><p>ä»¥ä¸Šæ“ä½œç›¸å½“äºåˆ›å»ºäº†ä¸€ä¸ª <code>~/.selected_editor</code> æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> ~/.selected_editor</span><br><span class="line"></span><br><span class="line"><span class="comment"># Generated by /usr/bin/select-editor</span></span><br><span class="line">SELECTED_EDITOR=<span class="string">&quot;/usr/bin/vim.basic&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="update-alternatives-å‘½ä»¤"><a href="#update-alternatives-å‘½ä»¤" class="headerlink" title="update-alternatives å‘½ä»¤"></a>update-alternatives å‘½ä»¤</h2><p>è¿™æ¡å‘½ä»¤éœ€è¦ä½¿ç”¨ root æƒé™æ‰§è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo update-alternatives --config editor</span><br></pre></td></tr></table></figure><p>ç›¸å½“äº</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ln</span> -sf /bin/vim.basic /etc/alternatives/editor</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¿«é€Ÿæ­å»ºipsec Vpn</title>
      <link href="/posts/759185f9/"/>
      <url>/posts/759185f9/</url>
      
        <content type="html"><![CDATA[<h2 id="å®‰è£…-Docker"><a href="#å®‰è£…-Docker" class="headerlink" title="å®‰è£… Docker"></a>å®‰è£… Docker</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -fsSL get.docker.com | bash</span><br><span class="line">sudo usermod -aG docker <span class="variable">$USER</span></span><br></pre></td></tr></table></figure><h2 id="å¯åŠ¨æœåŠ¡"><a href="#å¯åŠ¨æœåŠ¡" class="headerlink" title="å¯åŠ¨æœåŠ¡"></a>å¯åŠ¨æœåŠ¡</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">docker run \</span><br><span class="line">  --name ipsec-vpn-server \</span><br><span class="line">  --restart=always \</span><br><span class="line">  -v $(<span class="built_in">pwd</span>)/ikev2-vpn-data:/etc/ipsec.d \</span><br><span class="line">  -p 500:500/udp \</span><br><span class="line">  -p 4500:4500/udp \</span><br><span class="line">  -d --privileged \</span><br><span class="line">  --restart=always \</span><br><span class="line">  hwdsl2/ipsec-vpn-server</span><br></pre></td></tr></table></figure><h2 id="å°†-ikev2-vpn-data-æ–‡ä»¶å¤åˆ¶åˆ°æœ¬åœ°"><a href="#å°†-ikev2-vpn-data-æ–‡ä»¶å¤åˆ¶åˆ°æœ¬åœ°" class="headerlink" title="å°† ikev2-vpn-data æ–‡ä»¶å¤åˆ¶åˆ°æœ¬åœ°"></a>å°† ikev2-vpn-data æ–‡ä»¶å¤åˆ¶åˆ°æœ¬åœ°</h2><p>åœ¨ ikev2-vpn-data ç›®å½•ä¸­ï¼Œè¯ä¹¦æˆ–é…ç½®æ–‡ä»¶çš„ä½ç½®ï¼š</p><table><thead><tr><th>æ“ä½œç³»ç»Ÿ</th><th>æ–‡ä»¶å</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>Windows å’Œ Linux</td><td>vpnclient.p12</td><td>Windows10 &amp; 11 æŒ‰ç…§ä¸‹æ–‡é…ç½® VPN</td></tr><tr><td>Android</td><td>vpnclient.sswan</td><td>å®‰å“éœ€è¦å®‰è£… strongSwan è½¯ä»¶</td></tr><tr><td>Apple è®¾å¤‡</td><td>vpnclient.mobileconfig</td><td>å¯¼å…¥æè¿°æ–‡ä»¶å³å¯</td></tr></tbody></table><h2 id="windows-å®¢æˆ·ç«¯é…ç½®"><a href="#windows-å®¢æˆ·ç«¯é…ç½®" class="headerlink" title="windows å®¢æˆ·ç«¯é…ç½®"></a>windows å®¢æˆ·ç«¯é…ç½®</h2><h3 id="å¯¼å…¥è¯ä¹¦"><a href="#å¯¼å…¥è¯ä¹¦" class="headerlink" title="å¯¼å…¥è¯ä¹¦"></a>å¯¼å…¥è¯ä¹¦</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">certutil -f -importpfx vpnclient.p12 NoExport</span><br></pre></td></tr></table></figure><blockquote><p>è¯ä¹¦ä¼šå¯¼å…¥åˆ° <strong>å—ä¿¡ä»»çš„æ ¹è¯ä¹¦é¢å‘æœºæ„</strong> <strong>IKEv2 VPN CA</strong></p></blockquote><blockquote><p>å¦å¤–ï¼Œä½ ä¹Ÿå¯ä»¥æ‰‹åŠ¨å¯¼å…¥ .p12 æ–‡ä»¶ã€‚åœ¨å¯¼å…¥è¯ä¹¦åï¼Œä½ å¿…é¡»ç¡®ä¿å°†å®¢æˆ·ç«¯è¯ä¹¦æ”¾åœ¨ â€œ ä¸ªäºº -&gt; è¯ä¹¦ â€œ ç›®å½•ä¸­ï¼Œå¹¶ä¸”å°† CA è¯ä¹¦æ”¾åœ¨ â€œ å—ä¿¡ä»»çš„æ ¹è¯ä¹¦é¢å‘æœºæ„ -&gt; è¯ä¹¦ â€œ ç›®å½•ä¸­ã€‚</p></blockquote><h3 id="åˆ›å»º-VPN-è¿æ¥"><a href="#åˆ›å»º-VPN-è¿æ¥" class="headerlink" title="åˆ›å»º VPN è¿æ¥"></a>åˆ›å»º VPN è¿æ¥</h3><p>åœ¨ Windows è®¡ç®—æœºä¸Šæ·»åŠ ä¸€ä¸ªæ–°çš„ IKEv2 VPN è¿æ¥ã€‚å¯¹äº Windows 8.x å’Œ 10ï¼Œæ¨èä»å‘½ä»¤æç¤ºç¬¦è¿è¡Œä»¥ä¸‹å‘½ä»¤åˆ›å»º VPN è¿æ¥ï¼Œä»¥è¾¾åˆ°æ›´ä½³çš„å®‰å…¨æ€§å’Œæ€§èƒ½ã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell <span class="literal">-command</span> <span class="string">&quot;Add-VpnConnection -ServerAddress &#x27;è¿™é‡Œæ˜¯ä½ çš„VPNæœåŠ¡å™¨åœ°å€&#x27; -Name &#x27;VPN1&#x27; -TunnelType IKEv2 -AuthenticationMethod MachineCertificate -EncryptionLevel Required -PassThru&quot;</span></span><br></pre></td></tr></table></figure><h3 id="è®¾ç½®-IPsec-å‚æ•°"><a href="#è®¾ç½®-IPsec-å‚æ•°" class="headerlink" title="è®¾ç½® IPsec å‚æ•°"></a>è®¾ç½® IPsec å‚æ•°</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell <span class="literal">-command</span> <span class="string">&quot;Set-VpnConnectionIPsecConfiguration -ConnectionName &#x27;VPN1&#x27; -AuthenticationTransformConstants GCMAES128 -CipherTransformConstants GCMAES128 -EncryptionMethod AES256 -IntegrityCheckMethod SHA256 -PfsGroup None -DHGroup Group14 -PassThru -Force&quot;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Windowsçš„batè„šæœ¬é»˜è®¤å˜é‡</title>
      <link href="/posts/5157092d/"/>
      <url>/posts/5157092d/</url>
      
        <content type="html"><![CDATA[<figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chcp</span> <span class="number">65001</span></span><br><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line"><span class="built_in">echo</span> å½“å‰çš„batæ–‡ä»¶ï¼š&quot;%~<span class="number">0</span>&quot;</span><br><span class="line"><span class="built_in">echo</span> å½“å‰ç›˜ç¬¦ï¼š&quot;%~d0&quot;</span><br><span class="line"><span class="built_in">echo</span> å½“å‰ç›˜ç¬¦å’Œè·¯å¾„ï¼š&quot;%~dp0&quot;</span><br><span class="line"><span class="built_in">echo</span> å½“å‰æ‰¹å¤„ç†å…¨è·¯å¾„ï¼š&quot;%~f0&quot;</span><br><span class="line"><span class="built_in">echo</span> å½“å‰ç›˜ç¬¦å’Œè·¯å¾„çš„çŸ­æ–‡ä»¶åæ ¼å¼ï¼š&quot;%~sdp0&quot;</span><br><span class="line"><span class="built_in">echo</span> å½“å‰<span class="built_in">CMD</span>é»˜è®¤ç›®å½•ï¼š&quot;<span class="variable">%cd%</span>&quot;</span><br></pre></td></tr></table></figure><p>æ¡Œé¢ä¸Šçš„è„šæœ¬è¾“å‡ºè¾“å‡ºç±»ä¼¼äºï¼š</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">å½“å‰çš„batæ–‡ä»¶ï¼š&quot;C:\Users\iuxt\Desktop\test.bat&quot;</span><br><span class="line">å½“å‰ç›˜ç¬¦ï¼š&quot;C:&quot;</span><br><span class="line">å½“å‰ç›˜ç¬¦å’Œè·¯å¾„ï¼š&quot;C:\Users\iuxt\Desktop\&quot;</span><br><span class="line">å½“å‰æ‰¹å¤„ç†å…¨è·¯å¾„ï¼š&quot;C:\Users\iuxt\Desktop\test.bat&quot;</span><br><span class="line">å½“å‰ç›˜ç¬¦å’Œè·¯å¾„çš„çŸ­æ–‡ä»¶åæ ¼å¼ï¼š&quot;C:\Users\iuxt\Desktop\&quot;</span><br><span class="line">å½“å‰CMDé»˜è®¤ç›®å½•ï¼š&quot;C:\Users\iuxt\Desktop&quot;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸‹æ˜¯é’ˆå¯¹æ‹–æ”¾æ–‡ä»¶ï¼š</p><p>è„šæœ¬å†…å®¹ä¸ºï¼š</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chcp</span> <span class="number">65001</span></span><br><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line"><span class="built_in">echo</span> æ— åç¼€åï¼š %~n1</span><br><span class="line"><span class="built_in">echo</span> æœ‰åç¼€åï¼š %~nx1</span><br><span class="line"><span class="built_in">echo</span> ç»å¯¹è·¯å¾„ï¼š %<span class="number">1</span></span><br><span class="line"><span class="built_in">echo</span> çŸ­è·¯å¾„åçš„ç»å¯¹è·¯å¾„ï¼š %~s1</span><br><span class="line"><span class="built_in">echo</span> é©±åŠ¨å™¨å’Œè·¯å¾„ï¼š %~dp1</span><br><span class="line"><span class="built_in">echo</span> é©±åŠ¨å™¨ï¼š %~d1</span><br><span class="line"><span class="built_in">echo</span> è·¯å¾„ï¼š %~p1</span><br><span class="line"><span class="built_in">echo</span> æ–‡ä»¶å±æ€§ï¼š %~a1</span><br><span class="line"><span class="built_in">echo</span> æ—¥æœŸ/æ—¶é—´ï¼š %~t1</span><br><span class="line"><span class="built_in">echo</span> æ–‡ä»¶å¤§å°ï¼š %~z1</span><br></pre></td></tr></table></figure><p>ç°åœ¨å°†å¦ä¸€ä¸ªæ–‡ä»¶æ‹–åˆ°è¿™ä¸ªè„šæœ¬ä¸Šï¼š</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">æ— åç¼€åï¼š å‘¨ä¼ é›„ - ç”·äººæµ·æ´‹</span><br><span class="line">æœ‰åç¼€åï¼š å‘¨ä¼ é›„ - ç”·äººæµ·æ´‹.mp3</span><br><span class="line">ç»å¯¹è·¯å¾„ï¼š &quot;D:\å‘¨ä¼ é›„ - ç”·äººæµ·æ´‹.mp3&quot;</span><br><span class="line">çŸ­è·¯å¾„åçš„ç»å¯¹è·¯å¾„ï¼š D:\___-~704.MP3</span><br><span class="line">é©±åŠ¨å™¨å’Œè·¯å¾„ï¼š D:\</span><br><span class="line">é©±åŠ¨å™¨ï¼š D:</span><br><span class="line">è·¯å¾„ï¼š \</span><br><span class="line">æ–‡ä»¶å±æ€§ï¼š --a--------</span><br><span class="line">æ—¥æœŸ/æ—¶é—´ï¼š 2023/04/09 22:34</span><br><span class="line">æ–‡ä»¶å¤§å°ï¼š 9695866</span><br></pre></td></tr></table></figure><table><thead><tr><th>å˜é‡</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>%*</td><td>è„šæœ¬çš„æ‰€æœ‰å‚æ•°</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cmd </tag>
            
            <tag> bat </tag>
            
            <tag> cli </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ£€æŸ¥åŸŸåè§£æ</title>
      <link href="/posts/ae8cd9d9/"/>
      <url>/posts/ae8cd9d9/</url>
      
        <content type="html"><![CDATA[<h2 id="dig"><a href="#dig" class="headerlink" title="dig"></a>dig</h2><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># Ubuntu</span><br><span class="line">apt-<span class="built_in">get</span> install dnsutils</span><br><span class="line"></span><br><span class="line"># CentOS</span><br><span class="line">yum install bind-utils</span><br></pre></td></tr></table></figure><h3 id="æŸ¥è¯¢"><a href="#æŸ¥è¯¢" class="headerlink" title="æŸ¥è¯¢"></a>æŸ¥è¯¢</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥è¯¢åŸŸåï¼ŒæŒ‡å®šDNSåœ°å€</span></span><br><span class="line">dig auth.vipthink.cn @114.114.114.114</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æŸ¥aè®°å½•</span></span><br><span class="line">dig a www.baidu.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æŸ¥cnameè®°å½•</span></span><br><span class="line">dig cname www.baidu.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># åå‘è§£æ</span></span><br><span class="line">dig -x 10.0.0.2</span><br></pre></td></tr></table></figure><h2 id="nslookup"><a href="#nslookup" class="headerlink" title="nslookup"></a>nslookup</h2><h3 id="æ£€æŸ¥åŸŸå-A-è®°å½•"><a href="#æ£€æŸ¥åŸŸå-A-è®°å½•" class="headerlink" title="æ£€æŸ¥åŸŸå A è®°å½•"></a>æ£€æŸ¥åŸŸå A è®°å½•</h3><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nslookup baidu.com <span class="number">114</span>.<span class="number">114</span>.<span class="number">114</span>.<span class="number">114</span></span><br><span class="line">nslookup -<span class="built_in">type</span>=a qq.com <span class="number">114</span>.<span class="number">114</span>.<span class="number">114</span>.<span class="number">114</span></span><br><span class="line">nslookup baidu.com</span><br></pre></td></tr></table></figure><h3 id="æ£€æŸ¥åŸŸå-NS-è®°å½•"><a href="#æ£€æŸ¥åŸŸå-NS-è®°å½•" class="headerlink" title="æ£€æŸ¥åŸŸå NS è®°å½•"></a>æ£€æŸ¥åŸŸå NS è®°å½•</h3><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nslookup</span><br><span class="line">&gt; <span class="built_in">set</span> <span class="built_in">type</span>=ns</span><br><span class="line">&gt; zahui.fan <span class="number">114</span>.<span class="number">114</span>.<span class="number">114</span>.<span class="number">114</span></span><br></pre></td></tr></table></figure><h3 id="æ£€æŸ¥åŸŸå-CNAME-è®°å½•"><a href="#æ£€æŸ¥åŸŸå-CNAME-è®°å½•" class="headerlink" title="æ£€æŸ¥åŸŸå CNAME è®°å½•"></a>æ£€æŸ¥åŸŸå CNAME è®°å½•</h3><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nslookup</span><br><span class="line">&gt; <span class="built_in">set</span> <span class="built_in">type</span>=cname</span><br><span class="line">&gt; zahui.fan <span class="number">114</span>.<span class="number">114</span>.<span class="number">114</span>.<span class="number">114</span></span><br></pre></td></tr></table></figure><h3 id="åå‘è§£æ"><a href="#åå‘è§£æ" class="headerlink" title="åå‘è§£æ"></a>åå‘è§£æ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nslookup 10.0.0.2</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®šdnsæœåŠ¡å™¨åå‘è§£æipï¼š10.0.0.2</span></span><br><span class="line">nslookup 10.0.0.2 127.0.0.1</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åŸŸå </tag>
            
            <tag> DNS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Bashæ£€æŸ¥å½“å‰ç”¨æˆ·æ˜¯ä¸æ˜¯root</title>
      <link href="/posts/78f9310c/"/>
      <url>/posts/78f9310c/</url>
      
        <content type="html"><![CDATA[<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> [ $(<span class="built_in">id</span> -u) != <span class="string">&quot;0&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Error: You must be root to run this script&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> bash </tag>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nginx Statusç›‘æ§</title>
      <link href="/posts/7d58920d/"/>
      <url>/posts/7d58920d/</url>
      
        <content type="html"><![CDATA[<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">        listen 8080;</span><br><span class="line">        access_log off;</span><br><span class="line"></span><br><span class="line">        location /nginx_status &#123;</span><br><span class="line">            stub_status on;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ—¶å€™è¯·æ±‚,è¿”å›</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">curl localhost:8080/nginx_status</span><br><span class="line"></span><br><span class="line">Active connections: 1 </span><br><span class="line">server accepts handled requests</span><br><span class="line"> 7 7 6 </span><br><span class="line">Reading: 0 Writing: 1 Waiting: 0</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Nginx </tag>
            
            <tag> Monitor </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQL Binlog å¸¸ç”¨æ“ä½œè®°å½•</title>
      <link href="/posts/4d67bced/"/>
      <url>/posts/4d67bced/</url>
      
        <content type="html"><![CDATA[<p>æœ¬æ–‡è®°å½•ä¸€äº›æ—¥å¸¸ä½¿ç”¨ MySQL binlog çš„å‘½ä»¤è®°å½•ï¼Œæ–¹ä¾¿æ—¥åæŸ¥è¯¢ã€‚</p><h2 id="å¼€å¯-binlog-æ—¥å¿—-åœ¨-mysqld-ä¸‹ä¿®æ”¹æˆ–æ·»åŠ å¦‚ä¸‹é…ç½®"><a href="#å¼€å¯-binlog-æ—¥å¿—-åœ¨-mysqld-ä¸‹ä¿®æ”¹æˆ–æ·»åŠ å¦‚ä¸‹é…ç½®" class="headerlink" title="å¼€å¯ binlog æ—¥å¿— (åœ¨ [mysqld] ä¸‹ä¿®æ”¹æˆ–æ·»åŠ å¦‚ä¸‹é…ç½®)"></a>å¼€å¯ binlog æ—¥å¿— (åœ¨ [mysqld] ä¸‹ä¿®æ”¹æˆ–æ·»åŠ å¦‚ä¸‹é…ç½®)</h2><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server-id</span>=<span class="number">1</span></span><br><span class="line"><span class="attr">log-bin</span>=mysql-bin</span><br><span class="line"><span class="attr">binlog_format</span>=MIXED</span><br></pre></td></tr></table></figure><h2 id="binlog-æ—¥å¿—æ¨¡å¼"><a href="#binlog-æ—¥å¿—æ¨¡å¼" class="headerlink" title="binlog æ—¥å¿—æ¨¡å¼"></a>binlog æ—¥å¿—æ¨¡å¼</h2><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Mysqlå¤åˆ¶ä¸»è¦æœ‰ä¸‰ç§æ–¹å¼ï¼šåŸºäºSQLè¯­å¥çš„å¤åˆ¶(statement-based replication, SBR)ï¼ŒåŸºäºè¡Œçš„å¤åˆ¶(row-based replication, RBR)ï¼Œæ··åˆæ¨¡å¼å¤åˆ¶(mixed-based replication, MBR)ã€‚å¯¹åº”çš„ï¼Œbinlogçš„æ ¼å¼ä¹Ÿæœ‰ä¸‰ç§ï¼šSTATEMENTï¼ŒROWï¼ŒMIXEDã€‚</span><br><span class="line"></span><br><span class="line">1ã€STATEMENTæ¨¡å¼ï¼ˆSBRï¼‰</span><br><span class="line">æ¯ä¸€æ¡ä¼šä¿®æ”¹æ•°æ®çš„sqlè¯­å¥ä¼šè®°å½•åˆ°binlogä¸­ã€‚ä¼˜ç‚¹æ˜¯å¹¶ä¸éœ€è¦è®°å½•æ¯ä¸€æ¡sqlè¯­å¥å’Œæ¯ä¸€è¡Œçš„æ•°æ®å˜åŒ–ï¼Œå‡å°‘äº†binlogæ—¥å¿—é‡ï¼ŒèŠ‚çº¦IOï¼Œæé«˜æ€§èƒ½ã€‚ç¼ºç‚¹æ˜¯åœ¨æŸäº›æƒ…å†µä¸‹ä¼šå¯¼è‡´master-slaveä¸­çš„æ•°æ®ä¸ä¸€è‡´(å¦‚sleep()å‡½æ•°ï¼Œ last_insert_id()ï¼Œä»¥åŠuser-defined functions(udf)ç­‰ä¼šå‡ºç°é—®é¢˜)</span><br><span class="line"></span><br><span class="line">2ã€ROWæ¨¡å¼ï¼ˆRBRï¼‰</span><br><span class="line">ä¸è®°å½•æ¯æ¡sqlè¯­å¥çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œä»…éœ€è®°å½•å“ªæ¡æ•°æ®è¢«ä¿®æ”¹äº†ï¼Œä¿®æ”¹æˆä»€ä¹ˆæ ·äº†ã€‚è€Œä¸”ä¸ä¼šå‡ºç°æŸäº›ç‰¹å®šæƒ…å†µä¸‹çš„å­˜å‚¨è¿‡ç¨‹ã€æˆ–functionã€æˆ–triggerçš„è°ƒç”¨å’Œè§¦å‘æ— æ³•è¢«æ­£ç¡®å¤åˆ¶çš„é—®é¢˜ã€‚ç¼ºç‚¹æ˜¯ä¼šäº§ç”Ÿå¤§é‡çš„æ—¥å¿—ï¼Œå°¤å…¶æ˜¯alter tableçš„æ—¶å€™ä¼šè®©æ—¥å¿—æš´æ¶¨ã€‚</span><br><span class="line"></span><br><span class="line">3ã€MIXEDæ¨¡å¼ï¼ˆMBRï¼‰</span><br><span class="line">ä»¥ä¸Šä¸¤ç§æ¨¡å¼çš„æ··åˆä½¿ç”¨ï¼Œä¸€èˆ¬çš„å¤åˆ¶ä½¿ç”¨STATEMENTæ¨¡å¼ä¿å­˜binlogï¼Œå¯¹äºSTATEMENTæ¨¡å¼æ— æ³•å¤åˆ¶çš„æ“ä½œä½¿ç”¨ROWæ¨¡å¼ä¿å­˜binlogï¼ŒMySQLä¼šæ ¹æ®æ‰§è¡Œçš„SQLè¯­å¥é€‰æ‹©æ—¥å¿—ä¿å­˜æ–¹å¼ã€‚</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹-binlog-æ ¼å¼"><a href="#æŸ¥çœ‹-binlog-æ ¼å¼" class="headerlink" title="æŸ¥çœ‹ binlog æ ¼å¼"></a>æŸ¥çœ‹ binlog æ ¼å¼</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;BINLOG_FORMAT&#x27;</span>;</span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹-binlog-æ ¼å¼"><a href="#ä¿®æ”¹-binlog-æ ¼å¼" class="headerlink" title="ä¿®æ”¹ binlog æ ¼å¼"></a>ä¿®æ”¹ binlog æ ¼å¼</h3><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">ä¸åœæœåŠ¡ä¿®æ”¹</button><button type="button" class="tab">åœæœä¿®æ”¹</button></div><div class="tab-contents"><div class="tab-item-content active"><p>ç¼–è¾‘&#x2F;etc&#x2F;my.cnf æ–‡ä»¶ï¼ŒåŠ å…¥ä»¥ä¸‹è®¾ç½®</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">binlog_format</span>=row</span><br></pre></td></tr></table></figure><p>åœ¨ MySQL å‘½ä»¤è¡Œæ‰§è¡Œ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> binlog_format<span class="operator">=</span><span class="type">ROW</span>;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><p>ç¼–è¾‘&#x2F;etc&#x2F;my.cnf æ–‡ä»¶ï¼ŒåŠ å…¥ä»¥ä¸‹è®¾ç½®</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">binlog_format</span>=row</span><br></pre></td></tr></table></figure><p>é‡å¯ MySQL æœåŠ¡å™¨</p></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div><h2 id="æŸ¥çœ‹é»˜è®¤çš„æ—¥å¿—ä¿å­˜å¤©æ•°"><a href="#æŸ¥çœ‹é»˜è®¤çš„æ—¥å¿—ä¿å­˜å¤©æ•°" class="headerlink" title="æŸ¥çœ‹é»˜è®¤çš„æ—¥å¿—ä¿å­˜å¤©æ•°"></a>æŸ¥çœ‹é»˜è®¤çš„æ—¥å¿—ä¿å­˜å¤©æ•°</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;%expire_logs_days%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="number">0</span><span class="operator">-</span>è¡¨ç¤ºæ°¸ä¸è¿‡æœŸ</span><br></pre></td></tr></table></figure><h2 id="è®¾ç½®ä¸º-7-å¤©æœ‰æ•ˆæœŸ-ä¿®æ”¹é…ç½®æ–‡ä»¶"><a href="#è®¾ç½®ä¸º-7-å¤©æœ‰æ•ˆæœŸ-ä¿®æ”¹é…ç½®æ–‡ä»¶" class="headerlink" title="è®¾ç½®ä¸º 7 å¤©æœ‰æ•ˆæœŸ (ä¿®æ”¹é…ç½®æ–‡ä»¶)"></a>è®¾ç½®ä¸º 7 å¤©æœ‰æ•ˆæœŸ (ä¿®æ”¹é…ç½®æ–‡ä»¶)</h2><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">expire_logs_days</span>=<span class="number">7</span></span><br></pre></td></tr></table></figure><h2 id="binlog-ä½¿ç”¨"><a href="#binlog-ä½¿ç”¨" class="headerlink" title="binlog ä½¿ç”¨"></a>binlog ä½¿ç”¨</h2><h3 id="å¸¸ç”¨-sql-å‘½ä»¤"><a href="#å¸¸ç”¨-sql-å‘½ä»¤" class="headerlink" title="å¸¸ç”¨ sql å‘½ä»¤"></a>å¸¸ç”¨ sql å‘½ä»¤</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* æŸ¥çœ‹binlogæ˜¯å¦å¼€å¯ */</span></span><br><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;log_%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* æŸ¥çœ‹binlogåˆ—è¡¨ */</span></span><br><span class="line"><span class="keyword">show</span> <span class="type">binary</span> logs;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* æŸ¥çœ‹æ­£åœ¨å†™å…¥çš„binlogæ–‡ä»¶ */</span></span><br><span class="line"><span class="keyword">show</span> master status \G</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹æŸä¸ªæ—¶é—´æ®µçš„-sql-æ“ä½œ"><a href="#æŸ¥çœ‹æŸä¸ªæ—¶é—´æ®µçš„-sql-æ“ä½œ" class="headerlink" title="æŸ¥çœ‹æŸä¸ªæ—¶é—´æ®µçš„ sql æ“ä½œ"></a>æŸ¥çœ‹æŸä¸ªæ—¶é—´æ®µçš„ sql æ“ä½œ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># idk_base æ˜¯åº“å, éœ€è¦è¿›å…¥åˆ°binlogæ–‡ä»¶æ‰€åœ¨çš„ç›®å½•</span></span><br><span class="line">mysqlbinlog --base64-output=decode-rows --start-datetime=<span class="string">&#x27;2022-11-09 10:48:40&#x27;</span> --stop-datetime=<span class="string">&#x27;2022-11-09 10:49:00&#x27;</span> -v -d idk_base binlog.000009</span><br></pre></td></tr></table></figure><h2 id="å…³é—­-binlog"><a href="#å…³é—­-binlog" class="headerlink" title="å…³é—­ binlog"></a>å…³é—­ binlog</h2><p>åœ¨ my.cnf é…ç½®æ–‡ä»¶ [mysqld] ä¸‹ å¢åŠ :</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">disable-log-bin</span><br></pre></td></tr></table></figure><p>ç„¶åé‡å¯ mysql æœåŠ¡</p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
            <tag> binlog </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mysqldumpå¤‡ä»½æ•°æ®åº“</title>
      <link href="/posts/913ca09b/"/>
      <url>/posts/913ca09b/</url>
      
        <content type="html"><![CDATA[<p>mysqldump æ˜¯ <a href="/tags/mysql">MySQL</a> æ•°æ®åº“è‡ªå¸¦çš„å¯¼å‡º sql å·¥å…·ï¼Œå¯ä»¥å¯¼å‡ºåŸç”Ÿ sqlï¼Œæ–¹ä¾¿åç»­ä½¿ç”¨ã€‚</p><h2 id="åˆ›å»ºå¤‡ä»½ç”¨æˆ·"><a href="#åˆ›å»ºå¤‡ä»½ç”¨æˆ·" class="headerlink" title="åˆ›å»ºå¤‡ä»½ç”¨æˆ·"></a>åˆ›å»ºå¤‡ä»½ç”¨æˆ·</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;backup&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;password&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Grant all privileges on *.* to &#x27;backup&#x27;@&#x27;%&#x27; with grant option; */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Grant</span> <span class="keyword">select</span>,lock tables,<span class="keyword">show</span> <span class="keyword">view</span>,<span class="keyword">trigger</span>,event <span class="keyword">on</span> database.<span class="operator">*</span> <span class="keyword">to</span> <span class="string">&#x27;backup&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> <span class="string">&#x27;backup&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;password&#x27;</span>;</span><br></pre></td></tr></table></figure><h2 id="å¤‡ä»½æ ¼å¼"><a href="#å¤‡ä»½æ ¼å¼" class="headerlink" title="å¤‡ä»½æ ¼å¼"></a>å¤‡ä»½æ ¼å¼</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -hä¸»æœºå -Pç«¯å£ -uç”¨æˆ·å -på¯†ç  --databases æ•°æ®åº“å &gt; æ–‡ä»¶å.sql</span><br></pre></td></tr></table></figure><h2 id="å¤‡ä»½å‹ç¼©"><a href="#å¤‡ä»½å‹ç¼©" class="headerlink" title="å¤‡ä»½å‹ç¼©"></a>å¤‡ä»½å‹ç¼©</h2><p>mysql å¯¼å‡ºçš„æ–‡ä»¶æ˜¯å­—èŠ‚æµï¼Œå¯ä»¥é€šè¿‡ç®¡é“è¿›è¡Œå‹ç¼©ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -hä¸»æœºå -Pç«¯å£ -uç”¨æˆ·å -på¯†ç  --databases æ•°æ®åº“å | gzip &gt; æ–‡ä»¶å.sql.gz</span><br></pre></td></tr></table></figure><p>è§£å‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gzip &lt; æ–‡ä»¶å.sql.gz &gt; æ–‡ä»¶å.sql</span><br></pre></td></tr></table></figure><p>å¦‚æœ cpu æ€§èƒ½æ¯”è¾ƒå·®ï¼Œå»ºè®®ä¸å‹ç¼©ï¼Œæˆ–è€…å¤‡ä»½å®Œæˆåå†å‹ç¼©ï¼Œä¸ç„¶å¤‡ä»½é€Ÿåº¦éå¸¸æ…¢</p><h2 id="å¤‡ä»½æŒ‡å®šåº“"><a href="#å¤‡ä»½æŒ‡å®šåº“" class="headerlink" title="å¤‡ä»½æŒ‡å®šåº“"></a>å¤‡ä»½æŒ‡å®šåº“</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -hä¸»æœºå -Pç«¯å£ -uç”¨æˆ·å -på¯†ç  --databases æ•°æ®åº“å1 æ•°æ®åº“å2 æ•°æ®åº“å3 &gt; æ–‡ä»¶å.sql</span><br></pre></td></tr></table></figure><h2 id="å¤‡ä»½åŒä¸ªåº“å¤šä¸ªè¡¨"><a href="#å¤‡ä»½åŒä¸ªåº“å¤šä¸ªè¡¨" class="headerlink" title="å¤‡ä»½åŒä¸ªåº“å¤šä¸ªè¡¨"></a>å¤‡ä»½åŒä¸ªåº“å¤šä¸ªè¡¨</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -hä¸»æœºå -Pç«¯å£ -uç”¨æˆ·å -på¯†ç  --databases æ•°æ®åº“å --tables è¡¨1 è¡¨2 .... &gt; æ–‡ä»¶å.sql</span><br></pre></td></tr></table></figure><h2 id="å¤‡ä»½æ‰€æœ‰åº“"><a href="#å¤‡ä»½æ‰€æœ‰åº“" class="headerlink" title="å¤‡ä»½æ‰€æœ‰åº“"></a>å¤‡ä»½æ‰€æœ‰åº“</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -hä¸»æœºå -Pç«¯å£ -uç”¨æˆ·å -på¯†ç  --all-databases &gt; æ–‡ä»¶å.sql</span><br></pre></td></tr></table></figure><h2 id="é™„å¸¦-drop-è¡¨æˆ–åº“çš„å¤‡ä»½"><a href="#é™„å¸¦-drop-è¡¨æˆ–åº“çš„å¤‡ä»½" class="headerlink" title="é™„å¸¦ drop è¡¨æˆ–åº“çš„å¤‡ä»½"></a>é™„å¸¦ drop è¡¨æˆ–åº“çš„å¤‡ä»½</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é»˜è®¤æƒ…å†µä¸‹å¤‡ä»½çš„ sql ä¹Ÿä¼šå¸¦ drop table çš„</span></span><br><span class="line">mysqldump -hä¸»æœºå -Pç«¯å£ -uç”¨æˆ·å -på¯†ç  --add-drop-table --add-drop-database æ•°æ®åº“å &gt; æ–‡ä»¶å.sql</span><br></pre></td></tr></table></figure><p>è¿™æ ·å¯¼å…¥çš„æ—¶å€™ï¼Œå¦‚æœå­˜åœ¨å¯¹åº”çš„åº“æˆ–è¡¨ï¼Œä¼šè¢«å…ˆåˆ é™¤å†å¯¼å…¥ã€‚</p><h2 id="å¤‡ä»½ç»“æ„ï¼Œä¸å¤‡ä»½æ•°æ®"><a href="#å¤‡ä»½ç»“æ„ï¼Œä¸å¤‡ä»½æ•°æ®" class="headerlink" title="å¤‡ä»½ç»“æ„ï¼Œä¸å¤‡ä»½æ•°æ®"></a>å¤‡ä»½ç»“æ„ï¼Œä¸å¤‡ä»½æ•°æ®</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -hä¸»æœºå -Pç«¯å£ -uç”¨æˆ·å -på¯†ç  --no-data --databases æ•°æ®åº“å1 æ•°æ®åº“å2 æ•°æ®åº“å3 &gt; æ–‡ä»¶å.sql</span><br></pre></td></tr></table></figure><h2 id="å¤‡ä»½ä¸é”è¡¨ï¼Œè®°å½•-binlog-ä½ç½®"><a href="#å¤‡ä»½ä¸é”è¡¨ï¼Œè®°å½•-binlog-ä½ç½®" class="headerlink" title="å¤‡ä»½ä¸é”è¡¨ï¼Œè®°å½• binlog ä½ç½®"></a>å¤‡ä»½ä¸é”è¡¨ï¼Œè®°å½• binlog ä½ç½®</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -uroot -ppassword -hlocalhost -P3306 --master-data=2 --single-transaction --skip-tz-utc --all-databases &gt; /tmp/db.sql</span><br></pre></td></tr></table></figure><h2 id="å¤‡ä»½æ•°æ®åº“ï¼Œ-ä¸å¸¦-drop-è¯­å¥"><a href="#å¤‡ä»½æ•°æ®åº“ï¼Œ-ä¸å¸¦-drop-è¯­å¥" class="headerlink" title="å¤‡ä»½æ•°æ®åº“ï¼Œ ä¸å¸¦ drop è¯­å¥"></a>å¤‡ä»½æ•°æ®åº“ï¼Œ ä¸å¸¦ drop è¯­å¥</h2><p>é»˜è®¤å¤‡ä»½çš„ç±»ä¼¼äºï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- Table structure for table `db_sms_auth_code`</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `db_sms_auth_code`;</span><br><span class="line"><span class="comment">/*!40101 SET @saved_cs_client     = @@character_set_client */</span>;</span><br><span class="line"><span class="comment">/*!40101 SET character_set_client = utf8 */</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `db_sms_auth_code` (</span><br><span class="line">  `CID` <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `TEXT` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `CODE` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `MOBILE_NO` <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `CREATE_DATE` datetime <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `STATUS` <span class="type">int</span>(<span class="number">2</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `PR_ID` <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`CID`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 ROW_FORMAT<span class="operator">=</span><span class="keyword">DYNAMIC</span> COMMENT<span class="operator">=</span><span class="string">&#x27;çŸ­ä¿¡æ ¡éªŒç &#x27;</span>;</span><br><span class="line"><span class="comment">/*!40101 SET character_set_client = @saved_cs_client */</span>;</span><br></pre></td></tr></table></figure><p>è€ƒè™‘åˆ°å®‰å…¨é—®é¢˜ï¼Œä¸æƒ³è¦ DROP è¯­å¥ï¼Œå¯ä»¥å¢åŠ  <code>--skip-add-drop-table</code> å‚æ•°</p><h2 id="æ‹†åˆ†-insert-è¯­å¥"><a href="#æ‹†åˆ†-insert-è¯­å¥" class="headerlink" title="æ‹†åˆ† insert è¯­å¥"></a>æ‹†åˆ† insert è¯­å¥</h2><p>é»˜è®¤ mysqldump å¤‡ä»½çš„æ–‡ä»¶ä¼šåœ¨ä¸€æ¡ insert è¯­å¥ä¸­æ’å…¥å¾ˆå¤šæ¡æ•°æ®ï¼Œè¿™æ ·å¯ä»¥ç¼©å° sql æ–‡ä»¶çš„å¤§å°ï¼Œè¿˜èƒ½å¢åŠ å¯¼å…¥æ—¶å€™çš„é€Ÿåº¦ï¼Œä½†æ˜¯åœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬è¿˜æ˜¯å¸Œæœ›ä¸€æ¡ insert å¯¹åº”ä¸€æ¡æ•°æ®ã€‚é‚£ä¹ˆå¯ä»¥å¢åŠ  <code>--skip-extended-insert</code> å‚æ•°</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202402071656925.png"></p><h2 id="å¤‡ä»½è„šæœ¬"><a href="#å¤‡ä»½è„šæœ¬" class="headerlink" title="å¤‡ä»½è„šæœ¬"></a>å¤‡ä»½è„šæœ¬</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">set</span> -euo pipefail</span><br><span class="line"></span><br><span class="line">MYSQL_HOST=<span class="string">&#x27;127.0.0.1&#x27;</span></span><br><span class="line">MYSQL_USER=<span class="string">&#x27;root&#x27;</span></span><br><span class="line">MYSQL_PASSWORD=<span class="string">&#x27;com.012&#x27;</span></span><br><span class="line">MYSQL_PORT=<span class="string">&#x27;3306&#x27;</span></span><br><span class="line">SQL_PATH=<span class="string">&#x27;/tmp/backup.sql.gz&#x27;</span></span><br><span class="line">EXCLUDE_DATABASES=<span class="string">&#x27;information_schema|performance_schema|sys|mysql&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql -u<span class="variable">$&#123;MYSQL_USER&#125;</span> -p<span class="variable">$&#123;MYSQL_PASSWORD&#125;</span> -h<span class="variable">$&#123;MYSQL_HOST&#125;</span> -P<span class="variable">$&#123;MYSQL_PORT&#125;</span> -N -e <span class="string">&quot;show databases;&quot;</span> | grep -Ev <span class="variable">$&#123;EXCLUDE_DATABASES&#125;</span> | xargs mysqldump -u<span class="variable">$&#123;MYSQL_USER&#125;</span> -p<span class="variable">$&#123;MYSQL_PASSWORD&#125;</span> -h<span class="variable">$&#123;MYSQL_HOST&#125;</span> -P<span class="variable">$&#123;MYSQL_PORT&#125;</span> --single-transaction --master-data=2 --triggers --routines --events --hex-blob --skip-tz-utc --databases | gzip &gt; <span class="variable">$&#123;SQL_PATH&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ³¨ï¼š gz æ–‡ä»¶è§£å‹ï¼š <code>gzip -d backup.sql.gz</code></p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Kubernetesä¸­ä½¿ç”¨Prometheuså¯¹é›†ç¾¤èŠ‚ç‚¹åšç›‘æ§</title>
      <link href="/posts/61baae6f/"/>
      <url>/posts/61baae6f/</url>
      
        <content type="html"><![CDATA[<p>æ­£å¸¸æƒ…å†µä¸‹ä½¿ç”¨ Prometheus å¯¹æœºå™¨åšç›‘æ§ï¼Œæ¯”å¦‚ç›‘æ§ CPUã€å†…å­˜ã€ç£ç›˜ç­‰ä¿¡æ¯ï¼Œ éƒ½æ˜¯åœ¨æœºå™¨ä¸Šå®‰è£…ä¸€ä¸ª node exporterï¼Œ ç„¶åå°† metrics æ¥å…¥åˆ° Prometheus ä¸­ã€‚åœ¨ k8s ç¯å¢ƒä¸‹ï¼Œ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ k8s æ¥ç®¡ç†ï¼Œ å®ç°è‡ªåŠ¨åŒ–ç›‘æ§ã€‚</p><p>node exporter æ˜¯é’ˆå¯¹ä¸»æœºèŠ‚ç‚¹çš„ï¼Œ éœ€è¦åœ¨æ¯å° node èŠ‚ç‚¹ä¸Šå®‰è£…ï¼Œ é‚£ä¹ˆ daemonset æ§åˆ¶å™¨æ˜¯æœ€åˆç†çš„é€‰æ‹©ã€‚ ç½‘ç»œä½¿ç”¨ Host Network æ¨¡å¼ï¼Œ åœ¨ä¸»æœºä¸Šç›´æ¥æš´éœ²ä¸€ä¸ªç«¯å£ã€‚</p><h2 id="éƒ¨ç½²-node-exporter"><a href="#éƒ¨ç½²-node-exporter" class="headerlink" title="éƒ¨ç½² node exporter"></a>éƒ¨ç½² node exporter</h2><p>ä½¿ç”¨ yaml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">DaemonSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">node-exporter</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">monitor</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">node-exporter</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">node-exporter</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">node-exporter</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">hostPID:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">hostIPC:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">hostNetwork:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">node-exporter</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">prom/node-exporter:v1.3.1</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">9100</span></span><br><span class="line">        <span class="attr">resources:</span></span><br><span class="line">          <span class="attr">requests:</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="number">0.15</span></span><br><span class="line">        <span class="attr">securityContext:</span></span><br><span class="line">          <span class="attr">privileged:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">args:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">--path.procfs</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">/host/proc</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">--path.sysfs</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">/host/sys</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">--collector.filesystem.ignored-mount-points</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&#x27;&quot;^/(sys|proc|dev|host|etc)($|/)&quot;&#x27;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&#x27;--web.listen-address=:9100&#x27;</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">dev</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/host/dev</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">proc</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/host/proc</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">sys</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/host/sys</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">rootfs</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/rootfs</span></span><br><span class="line">      <span class="attr">tolerations:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">&quot;node-role.kubernetes.io/master&quot;</span></span><br><span class="line">        <span class="attr">operator:</span> <span class="string">&quot;Exists&quot;</span></span><br><span class="line">        <span class="attr">effect:</span> <span class="string">&quot;NoSchedule&quot;</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">proc</span></span><br><span class="line">          <span class="attr">hostPath:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/proc</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">dev</span></span><br><span class="line">          <span class="attr">hostPath:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/dev</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">sys</span></span><br><span class="line">          <span class="attr">hostPath:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/sys</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">rootfs</span></span><br><span class="line">          <span class="attr">hostPath:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/</span></span><br></pre></td></tr></table></figure><h2 id="é…ç½®-prometheus"><a href="#é…ç½®-prometheus" class="headerlink" title="é…ç½® prometheus"></a>é…ç½® prometheus</h2><p>å…³äº Prometheus æ ‡ç­¾å¤„ç†ï¼Œ å¯ä»¥çœ‹ <a href="/posts/prometheus_tag">è¿™ç¯‡æ–‡ç« </a></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">prometheus-config</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">monitor</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">web.yml:</span> <span class="string">|</span></span><br><span class="line"><span class="string">    basic_auth_users:</span></span><br><span class="line"><span class="string">      admin: $2y$05$UKSS18ztdsUNoEuXYScr2OE1TCMe1hWnmD6JuwUi/uPTJayHIakae</span></span><br><span class="line"><span class="string"></span>  <span class="attr">prometheus.yml:</span> <span class="string">|</span></span><br><span class="line"><span class="string">    global:</span></span><br><span class="line"><span class="string">      scrape_interval:     15s</span></span><br><span class="line"><span class="string">      evaluation_interval: 15s</span></span><br><span class="line"><span class="string">      </span></span><br><span class="line"><span class="string">      # å…¨å±€æ ‡ç­¾</span></span><br><span class="line"><span class="string">      external_labels:</span></span><br><span class="line"><span class="string">        env: prod</span></span><br><span class="line"><span class="string">        dept: ops</span></span><br><span class="line"><span class="string">        project: datong</span></span><br><span class="line"><span class="string"></span></span><br><span class="line">    <span class="attr">scrape_configs:</span></span><br><span class="line">    <span class="comment"># æ­¤å¤„çœç•¥æ‰ä¸€éƒ¨åˆ†JOB</span></span><br><span class="line">      <span class="comment"># è‡ªåŠ¨å‘ç°é›†ç¾¤çš„èŠ‚ç‚¹</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;kubernetes-node&#x27;</span></span><br><span class="line">        <span class="attr">kubernetes_sd_configs:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">node</span></span><br><span class="line">        <span class="attr">relabel_configs:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__address__</span>]</span><br><span class="line">          <span class="attr">regex:</span> <span class="string">&#x27;(.*):10250&#x27;</span></span><br><span class="line">          <span class="attr">replacement:</span> <span class="string">&#x27;$&#123;1&#125;:9100&#x27;</span></span><br><span class="line">          <span class="attr">target_label:</span> <span class="string">__address__</span></span><br><span class="line">          <span class="attr">action:</span> <span class="string">replace</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">action:</span> <span class="string">labelmap</span></span><br><span class="line">          <span class="attr">regex:</span> <span class="string">__meta_kubernetes_node_label_(.+)</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ˜¯åˆ©ç”¨äº† Prometheus çš„å…ƒæ•°æ®ï¼Œå°† kubelet çš„åœ°å€æ›´æ¢æˆäº† node exporter çš„åœ°å€ï¼Œ ç«¯å£æ¢æˆäº† 9100 æ¥å®ç°è‡ªåŠ¨åŒ–ç›‘æ§çš„ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç›‘æ§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> k8s </tag>
            
            <tag> prometheus </tag>
            
            <tag> Prometheus </tag>
            
            <tag> node_exporter </tag>
            
            <tag> monitor </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxå†…æ ¸å‚æ•°</title>
      <link href="/posts/1b957a56/"/>
      <url>/posts/1b957a56/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¿®æ”¹å†…æ ¸å‚æ•°"><a href="#ä¿®æ”¹å†…æ ¸å‚æ•°" class="headerlink" title="ä¿®æ”¹å†…æ ¸å‚æ•°"></a>ä¿®æ”¹å†…æ ¸å‚æ•°</h2><h3 id="ä¸´æ—¶ä¿®æ”¹"><a href="#ä¸´æ—¶ä¿®æ”¹" class="headerlink" title="ä¸´æ—¶ä¿®æ”¹"></a>ä¸´æ—¶ä¿®æ”¹</h3><h4 id="ä¿®æ”¹-proc-ç›®å½•"><a href="#ä¿®æ”¹-proc-ç›®å½•" class="headerlink" title="ä¿®æ”¹&#x2F;proc ç›®å½•"></a>ä¿®æ”¹&#x2F;proc ç›®å½•</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> 2048 &gt; /proc/sys/net/core/somaxconn</span><br></pre></td></tr></table></figure><blockquote><p>&#x2F;proc&#x2F;sys&#x2F; ç›®å½•æ˜¯ Linux å†…æ ¸å¯åŠ¨åç”Ÿæˆçš„ä¼ªç›®å½•ï¼Œå…¶ç›®å½•ä¸‹çš„ net æ–‡ä»¶å¤¹ä¸­å­˜æ”¾äº†å½“å‰ç³»ç»Ÿä¸­ç”Ÿæ•ˆçš„æ‰€æœ‰å†…æ ¸å‚æ•°ã€ç›®å½•æ ‘ç»“æ„ä¸å‚æ•°çš„å®Œæ•´åç§°ç›¸å…³ï¼Œå¦‚ <code>net.ipv4.tcp_tw_recycle</code>ï¼Œå®ƒå¯¹åº”çš„æ–‡ä»¶æ˜¯ &#x2F;proc&#x2F;sys&#x2F;net&#x2F;ipv4&#x2F;tcp_tw_recycleï¼Œæ–‡ä»¶çš„å†…å®¹å°±æ˜¯å‚æ•°å€¼ã€‚</p></blockquote><h4 id="sysctl-å‘½ä»¤ä¿®æ”¹"><a href="#sysctl-å‘½ä»¤ä¿®æ”¹" class="headerlink" title="sysctl å‘½ä»¤ä¿®æ”¹"></a>sysctl å‘½ä»¤ä¿®æ”¹</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysctl -w net.ipv4.tcp_tw_recycle=<span class="string">&quot;0&quot;</span></span><br></pre></td></tr></table></figure><h3 id="æ°¸ä¹…ä¿®æ”¹"><a href="#æ°¸ä¹…ä¿®æ”¹" class="headerlink" title="æ°¸ä¹…ä¿®æ”¹"></a>æ°¸ä¹…ä¿®æ”¹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/sysctl.conf</span><br><span class="line">net.core.somaxconn = 2048</span><br><span class="line">sysctl -p</span><br></pre></td></tr></table></figure><h2 id="æŸ¥çœ‹å†…æ ¸å‚æ•°"><a href="#æŸ¥çœ‹å†…æ ¸å‚æ•°" class="headerlink" title="æŸ¥çœ‹å†…æ ¸å‚æ•°"></a>æŸ¥çœ‹å†…æ ¸å‚æ•°</h2><h3 id="æŸ¥çœ‹-proc-ç›®å½•"><a href="#æŸ¥çœ‹-proc-ç›®å½•" class="headerlink" title="æŸ¥çœ‹&#x2F;proc&#x2F;ç›®å½•"></a>æŸ¥çœ‹&#x2F;proc&#x2F;ç›®å½•</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /proc/sys/net/ipv4/tcp_tw_recycle</span><br></pre></td></tr></table></figure><h3 id="sysctl-æŸ¥çœ‹"><a href="#sysctl-æŸ¥çœ‹" class="headerlink" title="sysctl æŸ¥çœ‹"></a>sysctl æŸ¥çœ‹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sysctl -a                            <span class="comment"># æŸ¥çœ‹æ‰€æœ‰</span></span><br><span class="line">sysctl -n net.ipv4.ip_forward        <span class="comment"># æŸ¥çœ‹å•ä¸ª</span></span><br></pre></td></tr></table></figure><h2 id="å¸¸ç”¨å†…æ ¸å‚æ•°"><a href="#å¸¸ç”¨å†…æ ¸å‚æ•°" class="headerlink" title="å¸¸ç”¨å†…æ ¸å‚æ•°"></a>å¸¸ç”¨å†…æ ¸å‚æ•°</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vm.overcommit_memory = 1</span><br><span class="line">net.ipv4.ip_forward = 1                    <span class="comment">#å…è®¸ipè½¬å‘</span></span><br><span class="line">net.ipv4.icmp_echo_ignore_all=1            <span class="comment"># ä¸å…è®¸ping</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Kernel </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¼–è¯‘å®‰è£…PHP7.2</title>
      <link href="/posts/a03938f2/"/>
      <url>/posts/a03938f2/</url>
      
        <content type="html"><![CDATA[<p>æœ¬æ–‡è®°å½•ä¸€ä¸‹åœ¨ Linux ä¸‹ç¼–è¯‘å®‰è£… PHP è¿‡ç¨‹ï¼Œæ²¡æœ‰ç‰¹æ®Šéœ€æ±‚çš„è¯ï¼Œä½¿ç”¨ yum æºå®‰è£…æ›´æ–¹ä¾¿ã€‚</p><h2 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h2><h3 id="å‡†å¤‡æºç åŒ…"><a href="#å‡†å¤‡æºç åŒ…" class="headerlink" title="å‡†å¤‡æºç åŒ…"></a>å‡†å¤‡æºç åŒ…</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://www.php.net/distributions/php-7.2.28.tar.bz2</span><br><span class="line"><span class="built_in">mkdir</span> -p /data/exec</span><br></pre></td></tr></table></figure><h3 id="åˆ›å»ºç”¨æˆ·"><a href="#åˆ›å»ºç”¨æˆ·" class="headerlink" title="åˆ›å»ºç”¨æˆ·"></a>åˆ›å»ºç”¨æˆ·</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useradd www -s <span class="string">&#x27;/sbin/nologin&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="å®‰è£…ç¼–è¯‘ä¾èµ–"><a href="#å®‰è£…ç¼–è¯‘ä¾èµ–" class="headerlink" title="å®‰è£…ç¼–è¯‘ä¾èµ–"></a>å®‰è£…ç¼–è¯‘ä¾èµ–</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">apt install -y libxml2 libxml2-dev libcurl4-openssl-dev libfreetype6-dev libjpeg-dev libicu-dev libxslt1-dev openssl</span><br><span class="line"></span><br><span class="line">yum install -y libxml2-devel libcurl-devel libjpeg libpng freetype libjpeg-devel libpng-devel freetype-devel libicu-devel libxslt-devel</span><br><span class="line"></span><br><span class="line"><span class="comment"># ldapæ‰©å±•éœ€è¦å®‰è£…libldap-devè¿™ä¸ªåŒ…</span></span><br></pre></td></tr></table></figure><h2 id="ç¼–è¯‘-PHP7-2"><a href="#ç¼–è¯‘-PHP7-2" class="headerlink" title="ç¼–è¯‘ PHP7.2"></a>ç¼–è¯‘ PHP7.2</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">./configure --prefix=/data/exec/php \</span><br><span class="line">    --with-config-file-path=/data/exec/php/etc \</span><br><span class="line">    --with-config-file-scan-dir=/data/exec/php/conf.d \</span><br><span class="line">    --enable-fpm --with-fpm-user=www --with-fpm-group=www \</span><br><span class="line">    --enable-mysqlnd --with-mysqli=mysqlnd --with-pdo-mysql=mysqlnd \</span><br><span class="line">    --with-iconv-dir --with-freetype-dir --with-jpeg-dir --with-png-dir \</span><br><span class="line">    --with-zlib --with-libxml-dir --enable-xml --disable-rpath \</span><br><span class="line">    --enable-bcmath --enable-shmop --enable-sysvsem --enable-inline-optimization \</span><br><span class="line">    --with-curl --enable-mbregex --enable-mbstring --enable-intl --enable-ftp --with-gd \</span><br><span class="line">    --with-openssl --with-mhash --enable-pcntl --enable-sockets --with-xmlrpc --enable-zip \</span><br><span class="line">    --enable-soap --with-gettext --enable-opcache --with-xsl</span><br><span class="line"></span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure><h2 id="æµ‹è¯•-PHP-å·¥ä½œ"><a href="#æµ‹è¯•-PHP-å·¥ä½œ" class="headerlink" title="æµ‹è¯• PHP å·¥ä½œ"></a>æµ‹è¯• PHP å·¥ä½œ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&lt;?php phpinfo(); ?&gt;&quot;</span> &gt;&gt; index.php</span><br></pre></td></tr></table></figure><h2 id="å…¶ä»–å¸¸ç”¨æ“ä½œ"><a href="#å…¶ä»–å¸¸ç”¨æ“ä½œ" class="headerlink" title="å…¶ä»–å¸¸ç”¨æ“ä½œ"></a>å…¶ä»–å¸¸ç”¨æ“ä½œ</h2><h3 id="æŸ¥çœ‹ç¼–è¯‘å‚æ•°"><a href="#æŸ¥çœ‹ç¼–è¯‘å‚æ•°" class="headerlink" title="æŸ¥çœ‹ç¼–è¯‘å‚æ•°"></a>æŸ¥çœ‹ç¼–è¯‘å‚æ•°</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php -i |grep configure</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹å½“å‰ç”Ÿæ•ˆçš„é…ç½®æ–‡ä»¶"><a href="#æŸ¥çœ‹å½“å‰ç”Ÿæ•ˆçš„é…ç½®æ–‡ä»¶" class="headerlink" title="æŸ¥çœ‹å½“å‰ç”Ÿæ•ˆçš„é…ç½®æ–‡ä»¶"></a>æŸ¥çœ‹å½“å‰ç”Ÿæ•ˆçš„é…ç½®æ–‡ä»¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php --ini</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹å½“å‰ç”Ÿæ•ˆçš„æ‰©å±•"><a href="#æŸ¥çœ‹å½“å‰ç”Ÿæ•ˆçš„æ‰©å±•" class="headerlink" title="æŸ¥çœ‹å½“å‰ç”Ÿæ•ˆçš„æ‰©å±•"></a>æŸ¥çœ‹å½“å‰ç”Ÿæ•ˆçš„æ‰©å±•</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php -m</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¼–è¯‘ </tag>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LinuxæŸ¥çœ‹ç³»ç»Ÿç¡¬ä»¶ä¿¡æ¯</title>
      <link href="/posts/6a0f629b/"/>
      <url>/posts/6a0f629b/</url>
      
        <content type="html"><![CDATA[<h2 id="CPU"><a href="#CPU" class="headerlink" title="CPU"></a>CPU</h2><p>æŸ¥çœ‹ cpu å‹å·</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /proc/cpuinfo |grep <span class="string">&quot;model name&quot;</span></span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹ CPU æ ¸å¿ƒæ•°</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /proc/cpuinfo |grep <span class="string">&quot;cpu cores&quot;</span></span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹ cpu æ”¯ä¸æ”¯æŒ aes(ç»“æœæœ‰ aes å³ä¸ºæ”¯æŒ)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep -m1 -o aes /proc/cpuinfo</span><br></pre></td></tr></table></figure><h2 id="å†…å­˜"><a href="#å†…å­˜" class="headerlink" title="å†…å­˜"></a>å†…å­˜</h2><p>æŸ¥çœ‹å†…å­˜å¤§å°</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /proc/meminfo |grep MemTotal</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹å†…å­˜å‹å·ï¼Œæ’æ§½</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dmidecode -t memory | grep <span class="string">&quot;Size:&quot;</span></span><br></pre></td></tr></table></figure><h2 id="ç¡¬ç›˜"><a href="#ç¡¬ç›˜" class="headerlink" title="ç¡¬ç›˜"></a>ç¡¬ç›˜</h2><p>æŸ¥çœ‹ç¡¬ç›˜</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fdisk -l |grep Disk</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹æŒ‚è½½ã€åˆ†åŒº</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo lsblk</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹è½¯ raid çŠ¶æ€</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /proc/mdstat</span><br></pre></td></tr></table></figure><h2 id="PCI-è®¾å¤‡"><a href="#PCI-è®¾å¤‡" class="headerlink" title="PCI è®¾å¤‡"></a>PCI è®¾å¤‡</h2><p>æŸ¥çœ‹ pci è®¾å¤‡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lspci -tv</span><br></pre></td></tr></table></figure><h2 id="ç½‘å¡"><a href="#ç½‘å¡" class="headerlink" title="ç½‘å¡"></a>ç½‘å¡</h2><p>æŸ¥çœ‹ç½‘å¡ crc æ ¡éªŒé”™è¯¯æ•°ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ethtool -S ens1f1 | grep rx_crc_errors:</span><br></pre></td></tr></table></figure><p>å¦‚æœæ•°é‡ä¸€è‡´å¢å¤§ï¼Œå°±æ˜¯æœ‰é—®é¢˜</p><p>dmesg å¯ä»¥æŸ¥çœ‹ç½‘å¡ down å’Œ up çš„æƒ…å†µ</p>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> ç¡¬ä»¶ä¿¡æ¯ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LinuxMinté…ç½®è®°å½•</title>
      <link href="/posts/sik5eq/"/>
      <url>/posts/sik5eq/</url>
      
        <content type="html"><![CDATA[<p>æ–‡ç« åŸºäº LinuxMint 22 ç‰ˆæœ¬ï¼Œ å¯¹åº”çš„ Ubuntu ç‰ˆæœ¬æ˜¯ 24.04</p><h2 id="ä¿®æ”¹-grub-å¯åŠ¨å»¶è¿Ÿ"><a href="#ä¿®æ”¹-grub-å¯åŠ¨å»¶è¿Ÿ" class="headerlink" title="ä¿®æ”¹ grub å¯åŠ¨å»¶è¿Ÿ"></a>ä¿®æ”¹ grub å¯åŠ¨å»¶è¿Ÿ</h2><p>é»˜è®¤å»¶è¿Ÿ 30sï¼Œå¤ªä¹…äº†</p><p>æœç´¢åˆ°çš„æ–‡ç« æ˜¯ä¿®æ”¹ <code>/etc/default/grub</code> é‡Œé¢çš„ <code>GRUB_TIMEOUT</code> å€¼ï¼Œç„¶åé‡æ–°ç”Ÿæˆ grub é…ç½®ï¼Œæˆ‘æµ‹è¯•ä¸ç”Ÿæ•ˆã€‚åº”è¯¥å¢åŠ  <code>GRUB_RECORDFAIL_TIMEOUT=3</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ›´æ–°grubé…ç½®æ–‡ä»¶</span></span><br><span class="line">sudo update-grub</span><br><span class="line"></span><br><span class="line"><span class="comment"># æˆ–è€…</span></span><br><span class="line"><span class="comment"># sudo grub-mkconfig â€“o /etc/grub2.cfg</span></span><br></pre></td></tr></table></figure><h2 id="åŸºç¡€ç¯å¢ƒé…ç½®"><a href="#åŸºç¡€ç¯å¢ƒé…ç½®" class="headerlink" title="åŸºç¡€ç¯å¢ƒé…ç½®"></a>åŸºç¡€ç¯å¢ƒé…ç½®</h2><h3 id="å®‰è£…å¸¸ç”¨çš„åŒ…"><a href="#å®‰è£…å¸¸ç”¨çš„åŒ…" class="headerlink" title="å®‰è£…å¸¸ç”¨çš„åŒ…"></a>å®‰è£…å¸¸ç”¨çš„åŒ…</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update &amp;&amp; sudo apt upgrade -y</span><br><span class="line">sudo apt install -y libmysqlclient-dev build-essential libssl-dev zlib1g-dev libbz2-dev libreadline-dev libsqlite3-dev libncursesw5-dev xz-utils tk-dev libxml2-dev libxmlsec1-dev libffi-dev liblzma-dev lrzsz</span><br></pre></td></tr></table></figure><h3 id="å½“å‰ç”¨æˆ·å…-sudo-å¯†ç "><a href="#å½“å‰ç”¨æˆ·å…-sudo-å¯†ç " class="headerlink" title="å½“å‰ç”¨æˆ·å… sudo å¯†ç "></a>å½“å‰ç”¨æˆ·å… sudo å¯†ç </h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">tee</span> /etc/sudoers.d/iuxt &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">%sudo   ALL=(ALL:ALL) NOPASSWD:ALL</span></span><br><span class="line"><span class="string">$USER   ALL=(ALL:ALL) NOPASSWD:ALL</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><h2 id="git-é…ç½®"><a href="#git-é…ç½®" class="headerlink" title="git é…ç½®"></a>git é…ç½®</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install -y git git-lfs</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">tee</span> ~/.gitconfig &lt;&lt;-<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">[user]</span><br><span class="line">        name = zhanglikun</span><br><span class="line">        email = x@zahui.fan</span><br><span class="line">        signingkey = zhanglikun</span><br><span class="line">[credential]</span><br><span class="line">        helper = store</span><br><span class="line">[core]</span><br><span class="line">        autocrlf = <span class="literal">false</span></span><br><span class="line">        quotepath = <span class="literal">false</span></span><br><span class="line">[init]</span><br><span class="line">        defaultBranch = master</span><br><span class="line">[pull]</span><br><span class="line">        rebase = <span class="literal">false</span></span><br><span class="line">[commit]</span><br><span class="line">        gpgsign = <span class="literal">false</span></span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h2 id="zsh-é…ç½®"><a href="#zsh-é…ç½®" class="headerlink" title="zsh é…ç½®"></a>zsh é…ç½®</h2><h3 id="å®‰è£…-zsh"><a href="#å®‰è£…-zsh" class="headerlink" title="å®‰è£… zsh"></a>å®‰è£… zsh</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install -y zsh</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…-oh-my-zsh"><a href="#å®‰è£…-oh-my-zsh" class="headerlink" title="å®‰è£… oh my zsh"></a>å®‰è£… oh my zsh</h3><p><a href="https://ohmyz.sh/#install">https://ohmyz.sh/#install</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh -c <span class="string">&quot;<span class="subst">$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)</span>&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¿®æ”¹ä¸»é¢˜é…ç½®</span></span><br><span class="line">sed -i <span class="string">&#x27;s#^ZSH_THEME=.*#ZSH_THEME=&quot;example&quot;#g&#x27;</span> ~/.zshrc</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…ä¸€äº›æ’ä»¶"><a href="#å®‰è£…ä¸€äº›æ’ä»¶" class="headerlink" title="å®‰è£…ä¸€äº›æ’ä»¶"></a>å®‰è£…ä¸€äº›æ’ä»¶</h3><p><a href="https://github.com/zsh-users/zsh-autosuggestions">https://github.com/zsh-users/zsh-autosuggestions</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install -y fzf</span><br><span class="line">git <span class="built_in">clone</span> https://github.com/zsh-users/zsh-autosuggestions <span class="variable">$&#123;ZSH_CUSTOM:-~/.oh-my-zsh/custom&#125;</span>/plugins/zsh-autosuggestions</span><br><span class="line">git <span class="built_in">clone</span> https://github.com/zsh-users/zsh-syntax-highlighting.git <span class="variable">$&#123;ZSH_CUSTOM:-~/.oh-my-zsh/custom&#125;</span>/plugins/zsh-syntax-highlighting</span><br><span class="line">omz plugin <span class="built_in">enable</span> z git sudo zsh-autosuggestions zsh-syntax-highlighting fzf</span><br></pre></td></tr></table></figure><h2 id="vim"><a href="#vim" class="headerlink" title="vim"></a>vim</h2><h3 id="ä¿®æ”¹é»˜è®¤ç¼–è¾‘å™¨"><a href="#ä¿®æ”¹é»˜è®¤ç¼–è¾‘å™¨" class="headerlink" title="ä¿®æ”¹é»˜è®¤ç¼–è¾‘å™¨"></a>ä¿®æ”¹é»˜è®¤ç¼–è¾‘å™¨</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sudo update-alternatives --config editor</span></span><br><span class="line">sudo <span class="built_in">ln</span> -sf /usr/bin/vim.basic /etc/alternatives/editor</span><br><span class="line"></span><br><span class="line"><span class="comment"># select-editor</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;SELECTED_EDITOR=&quot;/usr/bin/vim.basic&quot;&#x27;</span> &gt; ~/.selected_editor</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…-vim-plug-æ’ä»¶ç®¡ç†å·¥å…·"><a href="#å®‰è£…-vim-plug-æ’ä»¶ç®¡ç†å·¥å…·" class="headerlink" title="å®‰è£… vim plug æ’ä»¶ç®¡ç†å·¥å…·"></a>å®‰è£… vim plug æ’ä»¶ç®¡ç†å·¥å…·</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -fLo ~/.vim/autoload/plug.vim --create-dirs \</span><br><span class="line">    https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim</span><br></pre></td></tr></table></figure><p>é…ç½®æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">tee</span> ~/.vimrc &lt;&lt;-<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">call plug<span class="comment">#begin()</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot; On-demand loading</span></span><br><span class="line"><span class="string">Plug &#x27;preservim/nerdtree&#x27;, &#123; &#x27;on&#x27;: &#x27;NERDTreeToggle&#x27; &#125;</span></span><br><span class="line"><span class="string">Plug &#x27;vim-airline/vim-airline&#x27;</span></span><br><span class="line"><span class="string">Plug &#x27;vim-airline/vim-airline-themes&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">call plug#end()</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">set paste</span></span><br><span class="line"><span class="string">&quot;</span><span class="built_in">set</span> number</span><br><span class="line"></span><br><span class="line"><span class="string">&quot; nerdtree</span></span><br><span class="line"><span class="string">let NERDTreeWinPos=&quot;</span>left<span class="string">&quot;</span></span><br><span class="line"><span class="string">noremap &lt;F8&gt; :NERDTreeToggle&lt;CR&gt;</span></span><br><span class="line"><span class="string">let g:NERDTreeDirArrowExpandable = &#x27;â–¸&#x27;</span></span><br><span class="line"><span class="string">let g:NERDTreeDirArrowCollapsible = &#x27;â–¾&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&quot;</span> airline</span><br><span class="line"><span class="built_in">set</span> laststatus=2  <span class="string">&quot;æ°¸è¿œæ˜¾ç¤ºçŠ¶æ€æ </span></span><br><span class="line"><span class="string">let g:airline_powerline_fonts = 1  &quot;</span>æ”¯æŒ powerline å­—ä½“</span><br><span class="line"><span class="built_in">let</span> g:airline<span class="comment">#extensions#tabline#enabled = 1 &quot;æ˜¾ç¤ºçª—å£tabå’Œbuffer</span></span><br><span class="line"><span class="built_in">let</span> g:airline_theme=<span class="string">&#x27;molokai&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> !exists(<span class="string">&#x27;g:airline_symbols&#x27;</span>)</span><br><span class="line"><span class="built_in">let</span> g:airline_symbols = &#123;&#125;</span><br><span class="line">endif</span><br><span class="line"><span class="built_in">let</span> g:airline_left_sep = <span class="string">&#x27;â–¶&#x27;</span></span><br><span class="line"><span class="built_in">let</span> g:airline_left_alt_sep = <span class="string">&#x27;â¯&#x27;</span></span><br><span class="line"><span class="built_in">let</span> g:airline_right_sep = <span class="string">&#x27;â—€&#x27;</span></span><br><span class="line"><span class="built_in">let</span> g:airline_right_alt_sep = <span class="string">&#x27;â®&#x27;</span></span><br><span class="line"><span class="built_in">let</span> g:airline_symbols.linenr = <span class="string">&#x27;Â¶&#x27;</span></span><br><span class="line"><span class="built_in">let</span> g:airline_symbols.branch = <span class="string">&#x27;â‡&#x27;</span></span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><p>è¿›å…¥ vim å‘½ä»¤ç•Œé¢, è¾“å…¥ <code>:PlugInstall</code> å®‰è£…æ’ä»¶</p><h2 id="å¸¸ç”¨ç¯å¢ƒå®‰è£…"><a href="#å¸¸ç”¨ç¯å¢ƒå®‰è£…" class="headerlink" title="å¸¸ç”¨ç¯å¢ƒå®‰è£…"></a>å¸¸ç”¨ç¯å¢ƒå®‰è£…</h2><p>å®‰è£… golang python nodejs æŸ¥çœ‹ <a href="/posts/5e168f7e">å¿«é€Ÿæ­å»ºç¯å¢ƒè®°å½•</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">curl -fsSL get.docker.com | bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹ä¸€äº›é…ç½®</span></span><br><span class="line">sudo <span class="built_in">mkdir</span> -p /etc/docker &amp;&amp; sudo <span class="built_in">tee</span> /etc/docker/daemon.json &lt;&lt;-<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;exec-opts&quot;</span>: [<span class="string">&quot;native.cgroupdriver=systemd&quot;</span>],</span><br><span class="line">  <span class="string">&quot;log-driver&quot;</span>: <span class="string">&quot;json-file&quot;</span>,</span><br><span class="line">  <span class="string">&quot;log-opts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;max-size&quot;</span>: <span class="string">&quot;100m&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;storage-driver&quot;</span>: <span class="string">&quot;overlay2&quot;</span>,</span><br><span class="line">  <span class="string">&quot;iptables&quot;</span>: <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># å½“å‰ç”¨æˆ·æ‰§è¡Œdockerå‘½ä»¤ï¼Œéœ€è¦æ³¨é”€ç”¨æˆ·</span></span><br><span class="line">sudo usermod -aG docker <span class="variable">$USER</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ä¼˜é›…åœ°ç»™æ­£åœ¨è¿è¡Œçš„MySQLæ·»åŠ ä»åº“</title>
      <link href="/posts/86a9c8f5/"/>
      <url>/posts/86a9c8f5/</url>
      
        <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä¹‹å‰å†™è¿‡ä¸€ç¯‡ <a href="/posts/265ea5f9">MySQLä¸»ä»åŒæ­¥é…ç½®</a> ç»™ MySQL é…ç½®ä»åº“ï¼Œåœ¨ä¸»åº“åœ¨ä½¿ç”¨çš„æƒ…å†µä¸‹ï¼Œéœ€è¦å°†ä¸»åº“è¿›è¡Œç¦æ­¢å†™å…¥æ“ä½œï¼Œç„¶åå†å¯¼å‡ºå¯¼å…¥ï¼Œå¦‚æœåº“æ¯”è¾ƒå¤§çš„è¯ï¼Œ ä¼šå¯¹ä¸šåŠ¡é€ æˆä¸€å®šçš„å½±å“ã€‚è¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»å¦‚ä½•ä¸åœæœºè¿›è¡Œæ·»åŠ ä»åº“ã€‚</p><h2 id="ä¸»åº“æ“ä½œ"><a href="#ä¸»åº“æ“ä½œ" class="headerlink" title="ä¸»åº“æ“ä½œ"></a>ä¸»åº“æ“ä½œ</h2><h3 id="å¼€å¯-binlog"><a href="#å¼€å¯-binlog" class="headerlink" title="å¼€å¯ binlog"></a>å¼€å¯ binlog</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">log_bin=mysql-bin</span><br><span class="line">server-id=1</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ³¨æ„ <code>server-id</code> ä¸»ä»ä¸èƒ½ä¸€æ ·, é…ç½®å®Œæˆé‡å¯ mysql</p><h3 id="åˆ›å»ºç”¨äºåŒæ­¥çš„ç”¨æˆ·è´¦å·"><a href="#åˆ›å»ºç”¨äºåŒæ­¥çš„ç”¨æˆ·è´¦å·" class="headerlink" title="åˆ›å»ºç”¨äºåŒæ­¥çš„ç”¨æˆ·è´¦å·"></a>åˆ›å»ºç”¨äºåŒæ­¥çš„ç”¨æˆ·è´¦å·</h3><p>ç™»é™†æ•°æ®åº“</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -hlocalhost -uroot -ppassword</span><br></pre></td></tr></table></figure><p>åˆ›å»ºç”¨æˆ·å¹¶æˆæƒ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;repl&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;123456&#x27;</span>;</span><br></pre></td></tr></table></figure><p>æˆæƒ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GRANT</span> REPLICATION SLAVE <span class="keyword">ON</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;repl&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure><h3 id="å¯¼å‡ºæ•°æ®åº“-sql"><a href="#å¯¼å‡ºæ•°æ®åº“-sql" class="headerlink" title="å¯¼å‡ºæ•°æ®åº“ sql"></a>å¯¼å‡ºæ•°æ®åº“ sql</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -uroot -ppassword -hlocalhost -P3306 --master-data=2 --single-transaction --skip-tz-utc --all-databases &gt; /tmp/db.sql</span><br></pre></td></tr></table></figure><blockquote><p>â€“master-data é»˜è®¤å€¼ä¸º 1ï¼Œä¼šå°† <code>CHANGE MASTER TO</code> è¯­å¥å†™å…¥åˆ° sql æ–‡ä»¶ä¸­ï¼Œå¦‚æœå°† master-data è®¾ç½®ä¸º 2ï¼Œåˆ™ä¼šä»¥æ³¨é‡Šå†™å…¥åˆ° sql æ–‡ä»¶ä¸­ã€‚<br>â€“single-transaction åœ¨ dump è¿‡ç¨‹ä¸­ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼Œè¿™ä¸ªé€‰é¡¹å¯¹ InnoDB çš„æ•°æ®è¡¨å¾ˆæœ‰ç”¨ï¼Œä¸”ä¸ä¼šé”è¡¨ã€‚ä½†æ˜¯è¿™ä¸ªä¸èƒ½ä¿è¯ MyISAM è¡¨å’Œ MEMORY è¡¨çš„æ•°æ®ä¸€è‡´æ€§ã€‚</p></blockquote><h2 id="ä»åº“æ“ä½œ"><a href="#ä»åº“æ“ä½œ" class="headerlink" title="ä»åº“æ“ä½œ"></a>ä»åº“æ“ä½œ</h2><h3 id="å¯¼å…¥æ•°æ®åº“-sql"><a href="#å¯¼å…¥æ•°æ®åº“-sql" class="headerlink" title="å¯¼å…¥æ•°æ®åº“ sql"></a>å¯¼å…¥æ•°æ®åº“ sql</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -ppassword -hlocalhost -P3306 &lt; /tmp/db.sql</span><br></pre></td></tr></table></figure><h3 id="é…ç½®ä»åº“"><a href="#é…ç½®ä»åº“" class="headerlink" title="é…ç½®ä»åº“"></a>é…ç½®ä»åº“</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">CHANGE MASTER <span class="keyword">TO</span></span><br><span class="line">  MASTER_HOST<span class="operator">=</span><span class="string">&#x27;10.91.15.131&#x27;</span>,</span><br><span class="line">  MASTER_USER<span class="operator">=</span><span class="string">&#x27;repl&#x27;</span>,</span><br><span class="line">  MASTER_PASSWORD<span class="operator">=</span><span class="string">&#x27;123456&#x27;</span>,</span><br><span class="line">  MASTER_PORT<span class="operator">=</span><span class="number">3306</span>,</span><br><span class="line">  MASTER_LOG_FILE<span class="operator">=</span><span class="string">&#x27;binlog.000008&#x27;</span>,              <span class="comment">-- è¿™ä¸¤ä¸ªé€‰é¡¹åœ¨ head -n 20 db.sql å°±èƒ½çœ‹åˆ°</span></span><br><span class="line">  MASTER_LOG_POS<span class="operator">=</span><span class="number">22950585</span>,                      <span class="comment">-- è¿™ä¸¤ä¸ªé€‰é¡¹åœ¨ head -n 20 db.sql å°±èƒ½çœ‹åˆ°</span></span><br><span class="line">  MASTER_HEARTBEAT_PERIOD<span class="operator">=</span><span class="number">180</span>,</span><br><span class="line">  MASTER_CONNECT_RETRY<span class="operator">=</span><span class="number">10</span>;</span><br></pre></td></tr></table></figure><h3 id="å¯åŠ¨ä»åº“"><a href="#å¯åŠ¨ä»åº“" class="headerlink" title="å¯åŠ¨ä»åº“"></a>å¯åŠ¨ä»åº“</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">start</span> slave;</span><br><span class="line"><span class="keyword">show</span> slave status \G;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>äºŒè¿›åˆ¶å®‰è£…MySQL5.7</title>
      <link href="/posts/3b23b5cb/"/>
      <url>/posts/3b23b5cb/</url>
      
        <content type="html"><![CDATA[<p>å¦‚æœ‰ç‰¹æ®Šéœ€æ±‚éœ€è¦ç¼–è¯‘å®‰è£… MySQL è¯·çœ‹ <a href="/posts/b670229a">ç¼–è¯‘å®‰è£…MySQL5.7</a></p><h2 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h2><h3 id="å¸è½½ç³»ç»Ÿä¸­çš„-MySQL-æˆ–-mariadb"><a href="#å¸è½½ç³»ç»Ÿä¸­çš„-MySQL-æˆ–-mariadb" class="headerlink" title="å¸è½½ç³»ç»Ÿä¸­çš„ MySQL æˆ– mariadb"></a>å¸è½½ç³»ç»Ÿä¸­çš„ MySQL æˆ– mariadb</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rpm -qa | grep mysql</span><br><span class="line">rpm -qa | grep mariadb</span><br><span class="line">yum remove xxx</span><br></pre></td></tr></table></figure><h3 id="ä¸‹è½½äºŒè¿›åˆ¶å®‰è£…åŒ…"><a href="#ä¸‹è½½äºŒè¿›åˆ¶å®‰è£…åŒ…" class="headerlink" title="ä¸‹è½½äºŒè¿›åˆ¶å®‰è£…åŒ…"></a>ä¸‹è½½äºŒè¿›åˆ¶å®‰è£…åŒ…</h3><p><a href="https://dev.mysql.com/downloads/mysql/5.7.html#downloads">MySQLå®˜ç½‘</a></p><p>é€‰æ‹©æ“ä½œç³»ç»Ÿä¸º <code>Linux-Generic</code></p><p>é€‰æ‹©ä¸‹è½½æ–‡ä»¶åä¸ºï¼š<code>mysql-5.7.39-linux-glibc2.12-x86_64.tar.gz</code></p><p>å½“ç„¶ä¹Ÿå¯ä»¥ç”¨ wget ç›´æ¥ä¸‹è½½</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://dev.mysql.com/get/Downloads/MySQL-5.7/mysql-5.7.39-linux-glibc2.12-x86_64.tar.gz</span><br></pre></td></tr></table></figure><h3 id="åˆ›å»ºç”¨æˆ·"><a href="#åˆ›å»ºç”¨æˆ·" class="headerlink" title="åˆ›å»ºç”¨æˆ·"></a>åˆ›å»ºç”¨æˆ·</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useradd -M -s /sbin/nologin -r mysql</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…ä¾èµ–åŒ…"><a href="#å®‰è£…ä¾èµ–åŒ…" class="headerlink" title="å®‰è£…ä¾èµ–åŒ…"></a>å®‰è£…ä¾èµ–åŒ…</h3><p>ä¸ºäº†é¿å…æ‰§è¡Œ mysql å‘½ä»¤æŠ¥é”™ <code>ibncurses.so.5</code> æˆ–è€… <code>libnuma.so.1</code> æ‰¾ä¸åˆ°</p><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">CentOS</button><button type="button" class="tab">Ubuntu</button></div><div class="tab-contents"><div class="tab-item-content active"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y ncurses-devel numactl-libs</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼š CentOS 9 æˆ– RHEL 9 å¦‚æœæ‰¾ä¸åˆ°è¿™ä¸ªåº“ï¼Œå¯ä»¥å‚è€ƒï¼š<a href="/posts/lv23gkql/">è§£å†³MySQL 5.7åœ¨Redhat 9ä¸­å¯åŠ¨æŠ¥é”™ï¼šlibncurses.so.5å’Œlibtinfo.so.5ç¼ºå¤±é—®é¢˜</a></p></div><div class="tab-item-content"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install -y libncurses5 libnuma1 libaio1</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div><h3 id="è®¾ç½®å®‰è£…è·¯å¾„"><a href="#è®¾ç½®å®‰è£…è·¯å¾„" class="headerlink" title="è®¾ç½®å®‰è£…è·¯å¾„"></a>è®¾ç½®å®‰è£…è·¯å¾„</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> BASE_DIR=<span class="string">&quot;/usr/local/mysql&quot;</span></span><br><span class="line"><span class="built_in">export</span> DATA_DIR=<span class="string">&quot;/data/mysql&quot;</span></span><br></pre></td></tr></table></figure><h3 id="è§£å‹å®‰è£…åŒ…"><a href="#è§£å‹å®‰è£…åŒ…" class="headerlink" title="è§£å‹å®‰è£…åŒ…"></a>è§£å‹å®‰è£…åŒ…</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tar -xf mysql-5.7.39-linux-glibc2.12-x86_64.tar.gz -C /usr/local/</span><br><span class="line"><span class="built_in">ln</span> -s <span class="variable">$&#123;BASE_DIR&#125;</span>-5.7.39-linux-glibc2.12-x86_64/ <span class="variable">$&#123;BASE_DIR&#125;</span></span><br></pre></td></tr></table></figure><h2 id="åˆå§‹åŒ–æ•°æ®åº“"><a href="#åˆå§‹åŒ–æ•°æ®åº“" class="headerlink" title="åˆå§‹åŒ–æ•°æ®åº“"></a>åˆå§‹åŒ–æ•°æ®åº“</h2><h3 id="åˆ›å»ºæ•°æ®ä¿å­˜ç›®å½•"><a href="#åˆ›å»ºæ•°æ®ä¿å­˜ç›®å½•" class="headerlink" title="åˆ›å»ºæ•°æ®ä¿å­˜ç›®å½•"></a>åˆ›å»ºæ•°æ®ä¿å­˜ç›®å½•</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p <span class="variable">$&#123;DATA_DIR&#125;</span>/&#123;binlog,data,logs,redolog,relaylog,tmp,undolog&#125;</span><br><span class="line"><span class="built_in">mkdir</span> -p <span class="variable">$&#123;BASE_DIR&#125;</span>/etc</span><br><span class="line"><span class="built_in">chown</span> -R mysql.mysql <span class="variable">$&#123;DATA_DIR&#125;</span></span><br><span class="line"><span class="built_in">touch</span> <span class="variable">$&#123;DATA_DIR&#125;</span>/logs/error_mysqld.log</span><br><span class="line"><span class="built_in">chown</span> -R mysql.mysql <span class="variable">$&#123;DATA_DIR&#125;</span>/logs/error_mysqld.log</span><br><span class="line"><span class="built_in">chown</span> -R mysql.mysql <span class="variable">$&#123;BASE_DIR&#125;</span></span><br><span class="line"><span class="built_in">chown</span> -R mysql.mysql <span class="variable">$&#123;BASE_DIR&#125;</span>-5.7.39-linux-glibc2.12-x86_64/</span><br></pre></td></tr></table></figure><h3 id="initialize"><a href="#initialize" class="headerlink" title="initialize"></a>initialize</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$&#123;BASE_DIR&#125;</span>/bin/mysqld --initialize --user=mysql --basedir=<span class="variable">$&#123;BASE_DIR&#125;</span> --datadir=<span class="variable">$&#123;DATA_DIR&#125;</span>/data</span><br><span class="line"><span class="comment"># æ§åˆ¶å°ä¼šè¾“å‡ºä¸€ä¸ªä¸´æ—¶å¯†ç ï¼Œéœ€è¦è®°å½•ä¸€ä¸‹</span></span><br></pre></td></tr></table></figure><h2 id="é…ç½®æ–‡ä»¶ä¸æœåŠ¡"><a href="#é…ç½®æ–‡ä»¶ä¸æœåŠ¡" class="headerlink" title="é…ç½®æ–‡ä»¶ä¸æœåŠ¡"></a>é…ç½®æ–‡ä»¶ä¸æœåŠ¡</h2><h3 id="åˆ›å»ºæœ€å°åŒ–é…ç½®æ–‡ä»¶"><a href="#åˆ›å»ºæœ€å°åŒ–é…ç½®æ–‡ä»¶" class="headerlink" title="åˆ›å»ºæœ€å°åŒ–é…ç½®æ–‡ä»¶"></a>åˆ›å»ºæœ€å°åŒ–é…ç½®æ–‡ä»¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; <span class="variable">$&#123;BASE_DIR&#125;</span>/etc/my.cnf &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">## MySQL 5.7 Configuration File</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[mysqld]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## General</span></span><br><span class="line"><span class="string">user                                   = mysql</span></span><br><span class="line"><span class="string">bind_address                           = 0.0.0.0</span></span><br><span class="line"><span class="string">port                                   = 3306</span></span><br><span class="line"><span class="string">basedir                                = $&#123;BASE_DIR&#125;/</span></span><br><span class="line"><span class="string">datadir                                = $&#123;DATA_DIR&#125;/data</span></span><br><span class="line"><span class="string">tmpdir                                 = $&#123;DATA_DIR&#125;/tmp</span></span><br><span class="line"><span class="string">socket                                 = $&#123;DATA_DIR&#125;/logs/mysql.sock</span></span><br><span class="line"><span class="string">pid-file                               = $&#123;DATA_DIR&#125;/logs/mysqld.pid</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">character_set_server                   = utf8</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">skip-symbolic-links</span></span><br><span class="line"><span class="string">skip_name_resolve                      = ON</span></span><br><span class="line"><span class="string">skip_external_locking                  = ON</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">performance_schema                     = ON      # default ON</span></span><br><span class="line"><span class="string">performance-schema-instrument          = &#x27;memory/%=ON&#x27;</span></span><br><span class="line"><span class="string">#lower_case_table_names                 = 0      # default 0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">### Storage Engines</span></span><br><span class="line"><span class="string">default_storage_engine                 = InnoDB</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## InnoDB</span></span><br><span class="line"><span class="string">innodb_log_group_home_dir              = $&#123;DATA_DIR&#125;/redolog/</span></span><br><span class="line"><span class="string">innodb_log_file_size                   = 256M</span></span><br><span class="line"><span class="string">innodb_log_files_in_group              = 2</span></span><br><span class="line"><span class="string">innodb_log_buffer_size                 = 16M</span></span><br><span class="line"><span class="string">innodb_rollback_segments               = 128     # defautl 128</span></span><br><span class="line"><span class="string">innodb_undo_directory                  = $&#123;DATA_DIR&#125;/undolog/</span></span><br><span class="line"><span class="string">innodb_open_files                      = 4000</span></span><br><span class="line"><span class="string">innodb_thread_concurrency              = 32</span></span><br><span class="line"><span class="string">innodb_flush_log_at_trx_commit         = 1</span></span><br><span class="line"><span class="string">innodb_flush_log_at_timeout            = 1       # defautl 1, when innodb_flush_log_at_trx_commit = 0 or 2</span></span><br><span class="line"><span class="string">innodb_purge_threads                   = 4</span></span><br><span class="line"><span class="string">innodb_print_all_deadlocks             = ON</span></span><br><span class="line"><span class="string">innodb_max_dirty_pages_pct             = 70</span></span><br><span class="line"><span class="string">innodb_lock_wait_timeout               = 50</span></span><br><span class="line"><span class="string">innodb_flush_method                    = O_DIRECT</span></span><br><span class="line"><span class="string">innodb_old_blocks_time                 = 1000    # since 5.6.6 default 1000</span></span><br><span class="line"><span class="string">innodb_io_capacity                     = 600     # default 200</span></span><br><span class="line"><span class="string">innodb_io_capacity_max                 = 2000    # default 2000</span></span><br><span class="line"><span class="string">innodb_lru_scan_depth                  = 1024    # default 1024</span></span><br><span class="line"><span class="string">innodb_read_io_threads                 = 8</span></span><br><span class="line"><span class="string">innodb_write_io_threads                = 8</span></span><br><span class="line"><span class="string">innodb_buffer_pool_load_at_startup     = ON</span></span><br><span class="line"><span class="string">innodb_buffer_pool_dump_at_shutdown    = ON</span></span><br><span class="line"><span class="string">innodb_buffer_pool_filename            = ib_buffer_pool  # default ib_buffer_pool</span></span><br><span class="line"><span class="string">innodb_sort_buffer_size                = 64M     # default 1M , 64K - 64M , for change index</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">innodb_buffer_pool_dump_pct            = 40</span></span><br><span class="line"><span class="string">innodb_page_cleaners                   = 16</span></span><br><span class="line"><span class="string">innodb_undo_log_truncate               = ON</span></span><br><span class="line"><span class="string">innodb_max_undo_log_size               = 2G</span></span><br><span class="line"><span class="string">innodb_purge_rseg_truncate_frequency   = 128</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## Gtid</span></span><br><span class="line"><span class="string">#gtid_mode                              = ON</span></span><br><span class="line"><span class="string">#enforce_gtid_consistency               = ON</span></span><br><span class="line"><span class="string">#binlog_gtid_simple_recovery            = 1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## Replication</span></span><br><span class="line"><span class="string">server_id                              = 101</span></span><br><span class="line"><span class="string">log_bin                                = $&#123;DATA_DIR&#125;/binlog/mysql_bin</span></span><br><span class="line"><span class="string">expire_logs_days                       = 7</span></span><br><span class="line"><span class="string">binlog_format                          = ROW</span></span><br><span class="line"><span class="string">binlog_row_image                       = noblob  # default full</span></span><br><span class="line"><span class="string">#innodb_autoinc_lock_mode               = 2      # default 1</span></span><br><span class="line"><span class="string">binlog_rows_query_log_events           = 1</span></span><br><span class="line"><span class="string">max_binlog_size                        = 500M</span></span><br><span class="line"><span class="string">binlog_cache_size                      = 1M</span></span><br><span class="line"><span class="string">sync_binlog                            = 1</span></span><br><span class="line"><span class="string">master_info_repository                 = TABLE</span></span><br><span class="line"><span class="string">relay_log_info_repository              = TABLE</span></span><br><span class="line"><span class="string">skip-slave-start                       = 1</span></span><br><span class="line"><span class="string">relay_log                              = $&#123;DATA_DIR&#125;/relaylog/relay_log</span></span><br><span class="line"><span class="string">max_relay_log_size                     = 500M   # default 0, use max_binlog_size</span></span><br><span class="line"><span class="string">log_slave_updates                      = ON     # default OFF</span></span><br><span class="line"><span class="string">slave_transaction_retries              = 128</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## MTS</span></span><br><span class="line"><span class="string">relay_log_recovery                     = 1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## Logging</span></span><br><span class="line"><span class="string">log_output                             = FILE</span></span><br><span class="line"><span class="string">slow_query_log                         = ON</span></span><br><span class="line"><span class="string">slow_query_log_file                    = $&#123;DATA_DIR&#125;/logs/slow_mysqld.log</span></span><br><span class="line"><span class="string">log_queries_not_using_indexes          = OFF     # default OFF</span></span><br><span class="line"><span class="string">log_throttle_queries_not_using_indexes = 10      # default 0</span></span><br><span class="line"><span class="string">min_examined_row_limit                 = 0       # default 0</span></span><br><span class="line"><span class="string">log_slow_admin_statements              = ON</span></span><br><span class="line"><span class="string">log_slow_slave_statements              = ON</span></span><br><span class="line"><span class="string">long_query_time                        = 1</span></span><br><span class="line"><span class="string">#log-short-format                       = 0</span></span><br><span class="line"><span class="string">log_error                              = $&#123;DATA_DIR&#125;/logs/error_mysqld.log</span></span><br><span class="line"><span class="string">general_log                            = OFF</span></span><br><span class="line"><span class="string">general_log_file                       = $&#123;DATA_DIR&#125;/logs/general_mysqld.log</span></span><br><span class="line"><span class="string">log_timestamps                         = system</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## Index</span></span><br><span class="line"><span class="string">ft_min_word_len                        = 4</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[mysqld_safe]</span></span><br><span class="line"><span class="string">open_files_limit                       = 65535</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[mysql]</span></span><br><span class="line"><span class="string">no_auto_rehash</span></span><br><span class="line"><span class="string">prompt                                 = &quot;MySQL [\\d] &gt; &quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[mysqldump]</span></span><br><span class="line"><span class="string">quick</span></span><br><span class="line"><span class="string">max_allowed_packet                     = 256M</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[mysqlhotcopy]</span></span><br><span class="line"><span class="string">interactive_timeout</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[client]</span></span><br><span class="line"><span class="string">socket                                 = $&#123;DATA_DIR&#125;/logs/mysql.sock</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><p>åšè½¯é“¾æ¥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mv</span> /etc/my.cnf&#123;,.bak&#125;</span><br><span class="line"><span class="built_in">ln</span> -s <span class="variable">$&#123;BASE_DIR&#125;</span>/etc/my.cnf /etc/my.cnf</span><br></pre></td></tr></table></figure><h3 id="ç”Ÿæˆ-systemd-é…ç½®"><a href="#ç”Ÿæˆ-systemd-é…ç½®" class="headerlink" title="ç”Ÿæˆ systemd é…ç½®"></a>ç”Ÿæˆ systemd é…ç½®</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; /usr/lib/systemd/system/mysql.service &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">[Unit]</span></span><br><span class="line"><span class="string">Description=MySQL Server</span></span><br><span class="line"><span class="string">Documentation=man:mysqld(8)</span></span><br><span class="line"><span class="string">Documentation=https://dev.mysql.com/doc/refman/en/using-systemd.html</span></span><br><span class="line"><span class="string">After=network.target</span></span><br><span class="line"><span class="string">After=syslog.target</span></span><br><span class="line"><span class="string">[Install]</span></span><br><span class="line"><span class="string">WantedBy=multi-user.target</span></span><br><span class="line"><span class="string">[Service]</span></span><br><span class="line"><span class="string">User=mysql</span></span><br><span class="line"><span class="string">Group=mysql</span></span><br><span class="line"><span class="string">ExecStart=$&#123;BASE_DIR&#125;/bin/mysqld --defaults-file=/etc/my.cnf</span></span><br><span class="line"><span class="string">LimitNOFILE = 5000</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><h3 id="å¯åŠ¨æœåŠ¡"><a href="#å¯åŠ¨æœåŠ¡" class="headerlink" title="å¯åŠ¨æœåŠ¡"></a>å¯åŠ¨æœåŠ¡</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> --now mysql</span><br></pre></td></tr></table></figure><h2 id="ä¼˜åŒ–å·¥ä½œ"><a href="#ä¼˜åŒ–å·¥ä½œ" class="headerlink" title="ä¼˜åŒ–å·¥ä½œ"></a>ä¼˜åŒ–å·¥ä½œ</h2><h3 id="æ·»åŠ ç¯å¢ƒå˜é‡"><a href="#æ·»åŠ ç¯å¢ƒå˜é‡" class="headerlink" title="æ·»åŠ ç¯å¢ƒå˜é‡"></a>æ·»åŠ ç¯å¢ƒå˜é‡</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="subst">$( grep <span class="string">&quot;<span class="variable">$&#123;BASE_DIR&#125;</span>/bin&quot;</span> /etc/profile | wc -l )</span>&quot;</span> -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;export PATH=\$PATH:<span class="variable">$&#123;BASE_DIR&#125;</span>/bin&quot;</span> &gt;&gt; /etc/profile</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;PATHå˜é‡å·²æ·»åŠ &quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹-root-å¯†ç "><a href="#ä¿®æ”¹-root-å¯†ç " class="headerlink" title="ä¿®æ”¹ root å¯†ç "></a>ä¿®æ”¹ root å¯†ç </h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¬¬ä¸€æ¬¡ç™»å½•éœ€è¦ä½¿ç”¨root@localhostç™»å½•ï¼Œå¯†ç ä¸ºä¸Šé¢ç”Ÿæˆçš„ä¸´æ—¶å¯†ç </span></span><br><span class="line">mysql -uroot -hlocalhost -p</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;Vb6CAEJqqtcmKndiAkEl&#x27;</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">WITH</span> mysql_native_password <span class="keyword">BY</span> <span class="string">&#x27;Vb6CAEJqqtcmKndiAkEl&#x27;</span>;</span><br><span class="line"><span class="keyword">Grant</span> <span class="keyword">all</span> privileges <span class="keyword">on</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">to</span> <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;%&#x27;</span> <span class="keyword">with</span> <span class="keyword">grant</span> option;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨keepalivedå®ŒæˆLVSé«˜å¯ç”¨</title>
      <link href="/posts/675d47a9/"/>
      <url>/posts/675d47a9/</url>
      
        <content type="html"><![CDATA[<blockquote><p>æœ‰äº† keepalived å¯ä»¥ä¸ç”¨æ‰§è¡Œ ipvsadm äº†ï¼Œ å¹¶ä¸”å¯ä»¥å®ç°è‡ªåŠ¨å‰”é™¤èŠ‚ç‚¹ï¼Œè¿˜å¯ä»¥ä¸¤å° Director åšé«˜å¯ç”¨ã€‚</p></blockquote><p>æ‰‹åŠ¨é…ç½® LVS è¯·çœ‹ <a href="/posts/5fdc91d7">å†…æ ¸çº§è´Ÿè½½å‡è¡¡ LVS DRæ¨¡å¼ éƒ¨ç½²è®°å½•</a></p><p>å¦è§ï¼š<a href="/posts/0cebb8ae">ä½¿ç”¨Keepalivedæ¥å®ç°Nginxé«˜å¯ç”¨</a></p><p>è§„åˆ’ï¼š</p><table><thead><tr><th>æœºå™¨</th><th>IP</th></tr></thead><tbody><tr><td>VIP</td><td>10.0.0.8</td></tr><tr><td>director</td><td>10.0.0.40</td></tr><tr><td>realserver1</td><td>10.0.0.42</td></tr><tr><td>realserver2</td><td>10.0.0.43</td></tr><tr><td>ç½‘å¡ interface</td><td>eth0</td></tr></tbody></table><h2 id="å•å°-Director-Server"><a href="#å•å°-Director-Server" class="headerlink" title="å•å° Director Server"></a>å•å° Director Server</h2><p>keepalived é…ç½®ï¼š</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">vrrp_sync_group GOP &#123;</span><br><span class="line">    group &#123;</span><br><span class="line">        VI_PRI_CONNECT</span><br><span class="line">        VI_PRI_AUTH</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance VI_PRI_CONNECT &#123;</span><br><span class="line">    state BACKUP</span><br><span class="line">    interface eth0</span><br><span class="line">    virtual_router_id 128</span><br><span class="line">    priority 100</span><br><span class="line">    advert_int 1</span><br><span class="line">    nopreempt</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        10.0.0.8/24 dev eth0</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">virtual_server 10.0.0.8 80 &#123;</span><br><span class="line">    delay_loop 6</span><br><span class="line">    lb_algo rr</span><br><span class="line">    lb_kind DR</span><br><span class="line">    protocol TCP</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    real_server 10.0.0.42 80 &#123;</span><br><span class="line">        weight 100</span><br><span class="line">        TCP_CHECK &#123;</span><br><span class="line">                connect_timeout 3</span><br><span class="line">                nb_get_retry 3</span><br><span class="line">                delay_before_retry 3</span><br><span class="line">                connect_port 80</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    real_server 10.0.0.43 80 &#123;</span><br><span class="line">        weight 100</span><br><span class="line">        TCP_CHECK &#123;</span><br><span class="line">                connect_timeout 3</span><br><span class="line">                nb_get_retry 3</span><br><span class="line">                delay_before_retry 3</span><br><span class="line">                connect_port 80</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä¸¤å°-Director-Server-åšä¸»å¤‡"><a href="#ä¸¤å°-Director-Server-åšä¸»å¤‡" class="headerlink" title="ä¸¤å° Director Server åšä¸»å¤‡"></a>ä¸¤å° Director Server åšä¸»å¤‡</h2><table><thead><tr><th>æœºå™¨</th><th>IP</th></tr></thead><tbody><tr><td>VIP</td><td>10.0.0.8</td></tr><tr><td>director 1</td><td>10.0.0.40</td></tr><tr><td>director 2</td><td>10.0.0.41</td></tr><tr><td>realserver1</td><td>10.0.0.42</td></tr><tr><td>realserver2</td><td>10.0.0.43</td></tr><tr><td>ç½‘å¡ interface</td><td>eth0</td></tr></tbody></table><blockquote><p>æŠ¢å å¼ å’Œ éæŠ¢å å¼çš„åŒºåˆ«ï¼š æ¯”å¦‚ master1 é»˜è®¤çš„æƒé‡ï¼ˆpriorityï¼‰é«˜ï¼Œvip å½“å‰åœ¨ master1 ä¸Šï¼Œ master1 æŒ‚æ‰å vip ä¼šé£˜åˆ° master2 ä¸Šï¼Œé‚£ä¹ˆå¦‚æœ master1 æ¢å¤æ­£å¸¸äº†ï¼ŒæŠ¢å å¼ä¼šé‡æ–°å°† vip æŠ¢è¿‡æ¥ï¼Œå†æ¬¡ç»‘å®šåˆ° master1 ä¸Šï¼ŒéæŠ¢å å¼åˆ™ä¿æŒåœ¨ master2 ä¸Šï¼Œé™¤é master2 ä¹Ÿå‡ºé—®é¢˜ã€‚</p></blockquote><h3 id="Director-Server-1"><a href="#Director-Server-1" class="headerlink" title="Director Server 1"></a>Director Server 1</h3><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">vrrp_sync_group GOP &#123;</span><br><span class="line">    group &#123;</span><br><span class="line">        VI_PRI_CONNECT</span><br><span class="line">        VI_PRI_AUTH</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance VI_PRI_CONNECT &#123;</span><br><span class="line">    state BACKUP                    # éæŠ¢å å¼æ‰€æœ‰èŠ‚ç‚¹éƒ½éœ€è¦æ˜¯BACKUP</span><br><span class="line">    interface eth0</span><br><span class="line">    virtual_router_id 128</span><br><span class="line">    priority 110                    # æƒé‡</span><br><span class="line">    advert_int 1</span><br><span class="line">    nopreempt                       # é…ç½®ä¸ºéæŠ¢å å¼</span><br><span class="line">    unicast_src_ip 10.0.0.40        # æœ¬æœºçš„IP</span><br><span class="line">    unicast_peer &#123;</span><br><span class="line">        10.0.0.41                   # å…¶ä»–Keepalivedæœºå™¨çš„IPï¼Œå¯ä»¥å†™å¤šä¸ª</span><br><span class="line">    &#125;</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        10.0.0.8/24 dev eth0</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">virtual_server 10.0.0.8 80 &#123;</span><br><span class="line">    delay_loop 6</span><br><span class="line">    lb_algo rr</span><br><span class="line">    lb_kind DR</span><br><span class="line">    protocol TCP</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    real_server 10.0.0.42 80 &#123;</span><br><span class="line">        weight 100</span><br><span class="line">        TCP_CHECK &#123;</span><br><span class="line">                connect_timeout 3</span><br><span class="line">                nb_get_retry 3</span><br><span class="line">                delay_before_retry 3</span><br><span class="line">                connect_port 80</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    real_server 10.0.0.43 80 &#123;</span><br><span class="line">        weight 100</span><br><span class="line">        TCP_CHECK &#123;</span><br><span class="line">                connect_timeout 3</span><br><span class="line">                nb_get_retry 3</span><br><span class="line">                delay_before_retry 3</span><br><span class="line">                connect_port 80</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Director-Server-2"><a href="#Director-Server-2" class="headerlink" title="Director Server 2"></a>Director Server 2</h3><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">vrrp_sync_group GOP &#123;</span><br><span class="line">    group &#123;</span><br><span class="line">        VI_PRI_CONNECT</span><br><span class="line">        VI_PRI_AUTH</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance VI_PRI_CONNECT &#123;</span><br><span class="line">    state BACKUP</span><br><span class="line">    interface eth0</span><br><span class="line">    virtual_router_id 128</span><br><span class="line">    priority 100</span><br><span class="line">    advert_int 1</span><br><span class="line">    nopreempt</span><br><span class="line">    unicast_src_ip 10.0.0.41            # æœ¬æœºçš„IP</span><br><span class="line">    unicast_peer &#123;</span><br><span class="line">        10.0.0.40                       # å…¶ä»–Keepalivedæœºå™¨çš„IPï¼Œå¯ä»¥å†™å¤šä¸ª</span><br><span class="line">    &#125;</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        10.0.0.8/24 dev eth0</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">virtual_server 10.0.0.8 80 &#123;</span><br><span class="line">    delay_loop 6</span><br><span class="line">    lb_algo rr</span><br><span class="line">    lb_kind DR</span><br><span class="line">    protocol TCP</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    real_server 10.0.0.42 80 &#123;</span><br><span class="line">        weight 100</span><br><span class="line">        TCP_CHECK &#123;</span><br><span class="line">                connect_timeout 3</span><br><span class="line">                nb_get_retry 3</span><br><span class="line">                delay_before_retry 3</span><br><span class="line">                connect_port 80</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    real_server 10.0.0.43 80 &#123;</span><br><span class="line">        weight 100</span><br><span class="line">        TCP_CHECK &#123;</span><br><span class="line">                connect_timeout 3</span><br><span class="line">                nb_get_retry 3</span><br><span class="line">                delay_before_retry 3</span><br><span class="line">                connect_port 80</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Real-Server-éœ€è¦åšçš„é…ç½®"><a href="#Real-Server-éœ€è¦åšçš„é…ç½®" class="headerlink" title="Real Server éœ€è¦åšçš„é…ç½®"></a>Real Server éœ€è¦åšçš„é…ç½®</h2><p>LVS çš„ DR æ¨¡å¼ éœ€è¦å¯¹åç«¯æœåŠ¡å™¨åšæ”¹é€ , æ·»åŠ è™šæ‹Ÿ ipï¼Œ å¹¶é…ç½®æ­¤ ip ä¸å“åº” ARP è¯·æ±‚ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ip <span class="built_in">link</span> add ipvs0 <span class="built_in">type</span> dummy</span><br><span class="line">ip addr add 10.0.0.8/32 dev ipvs0</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸å“åº”ARPè¯·æ±‚, ä¿®æ”¹å†…æ ¸å‚æ•°</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;1&quot;</span> &gt; /proc/sys/net/ipv4/conf/ipvs0/arp_ignore</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;1&quot;</span> &gt; /proc/sys/net/ipv4/conf/all/arp_ignore</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;2&quot;</span> &gt; /proc/sys/net/ipv4/conf/ipvs0/arp_announce</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;2&quot;</span> &gt; /proc/sys/net/ipv4/conf/all/arp_announce</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
            <tag> Network </tag>
            
            <tag> LoadBalance </tag>
            
            <tag> keepalived </tag>
            
            <tag> HA </tag>
            
            <tag> lvs </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Containerdçš„ç®¡ç†å·¥å…·</title>
      <link href="/posts/be10bdea/"/>
      <url>/posts/be10bdea/</url>
      
        <content type="html"><![CDATA[<p>å¦‚æœä½ å¯¹ Docker å‘½ä»¤æ¯”è¾ƒç†Ÿæ‚‰ï¼Œ å¯ä»¥è€ƒè™‘ä½¿ç”¨ nerdctl æ¥ç®¡ç† containerdï¼Œå’Œ docker å‘½ä»¤ç±»ä¼¼ï¼š<a href="https://github.com/containerd/nerdctl">https://github.com/containerd/nerdctl</a></p><h2 id="å‘½ä»¤å¯¹æ¯”"><a href="#å‘½ä»¤å¯¹æ¯”" class="headerlink" title="å‘½ä»¤å¯¹æ¯”"></a>å‘½ä»¤å¯¹æ¯”</h2><table><thead><tr><th align="left">å‘½ä»¤</th><th align="left">docker</th><th align="left">crictlï¼ˆæ¨èï¼‰</th><th align="left">ctr</th></tr></thead><tbody><tr><td align="left">æŸ¥çœ‹å®¹å™¨åˆ—è¡¨</td><td align="left">docker ps</td><td align="left">crictl ps</td><td align="left">ctr -n k8s.io c ls</td></tr><tr><td align="left">æŸ¥çœ‹å®¹å™¨è¯¦æƒ…</td><td align="left">docker inspect</td><td align="left">crictl inspect</td><td align="left">ctr -n k8s.io c info</td></tr><tr><td align="left">æŸ¥çœ‹å®¹å™¨æ—¥å¿—</td><td align="left">docker logs</td><td align="left">crictl logs</td><td align="left">æ— </td></tr><tr><td align="left">å®¹å™¨å†…æ‰§è¡Œå‘½ä»¤</td><td align="left">docker exec</td><td align="left">crictl exec</td><td align="left">æ— </td></tr><tr><td align="left">æŒ‚è½½å®¹å™¨</td><td align="left">docker attach</td><td align="left">crictl attach</td><td align="left">æ— </td></tr><tr><td align="left">å®¹å™¨èµ„æºä½¿ç”¨</td><td align="left">docker stats</td><td align="left">crictl stats</td><td align="left">æ— </td></tr><tr><td align="left">åˆ›å»ºå®¹å™¨</td><td align="left">docker create</td><td align="left">crictl create</td><td align="left">ctr -n k8s.io c create</td></tr><tr><td align="left">å¯åŠ¨å®¹å™¨</td><td align="left">docker start</td><td align="left">crictl start</td><td align="left">ctr -n k8s.io run</td></tr><tr><td align="left">åœæ­¢å®¹å™¨</td><td align="left">docker stop</td><td align="left">crictl stop</td><td align="left">æ— </td></tr><tr><td align="left">åˆ é™¤å®¹å™¨</td><td align="left">docker rm</td><td align="left">crictl rm</td><td align="left">ctr -n k8s.io c del</td></tr><tr><td align="left">æŸ¥çœ‹é•œåƒåˆ—è¡¨</td><td align="left">docker images</td><td align="left">crictl images</td><td align="left">ctr -n k8s.io i ls</td></tr><tr><td align="left">æŸ¥çœ‹é•œåƒè¯¦æƒ…</td><td align="left">docker inspect</td><td align="left">crictl inspecti</td><td align="left">æ— </td></tr><tr><td align="left">æ‹‰å–é•œåƒ</td><td align="left">docker pull</td><td align="left">crictl pull</td><td align="left">ctr -n k8s.io i pull</td></tr><tr><td align="left">æ¨é€é•œåƒ</td><td align="left">docker push</td><td align="left">æ— </td><td align="left">ctr -n k8s.io i push</td></tr><tr><td align="left">åˆ é™¤é•œåƒ</td><td align="left">docker rmi</td><td align="left">crictl rmi</td><td align="left">ctr -n k8s.io i rm</td></tr><tr><td align="left">æŸ¥çœ‹ Pod åˆ—è¡¨</td><td align="left">æ— </td><td align="left">crictl pods</td><td align="left">æ— </td></tr><tr><td align="left">æŸ¥çœ‹ Pod è¯¦æƒ…</td><td align="left">æ— </td><td align="left">crictl inspectp</td><td align="left">æ— </td></tr><tr><td align="left">å¯åŠ¨ Pod</td><td align="left">æ— </td><td align="left">crictl runp</td><td align="left">æ— </td></tr><tr><td align="left">åœæ­¢ Pod</td><td align="left">æ— </td><td align="left">crictl stopp</td><td align="left">æ— </td></tr></tbody></table><h2 id="å¯¼å…¥å¯¼å‡ºé•œåƒ"><a href="#å¯¼å…¥å¯¼å‡ºé•œåƒ" class="headerlink" title="å¯¼å…¥å¯¼å‡ºé•œåƒ"></a>å¯¼å…¥å¯¼å‡ºé•œåƒ</h2><p>containerd æœ‰ namespace çš„æ¦‚å¿µï¼Œæ‰€ä»¥éœ€è¦æŒ‡å®š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯¼å‡ºé•œåƒ</span></span><br><span class="line">ctr -n k8s.io image <span class="built_in">export</span> k8s.gcr.io/coredns/coredns:v1.8.0  coredns_v1.8.0.tar</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¼å…¥é•œåƒ</span></span><br><span class="line">ctr -n=k8s.io image import coredns_v1.8.0.tar</span><br></pre></td></tr></table></figure><h2 id="ç™»å½•ä»“åº“"><a href="#ç™»å½•ä»“åº“" class="headerlink" title="ç™»å½•ä»“åº“"></a>ç™»å½•ä»“åº“</h2><p>æ‚¨å¯ä»¥ä½¿ç”¨ ctr login å‘½ä»¤ç™»å½•ä»“åº“ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨è¦ç™»å½• registry.cn-hangzhou.aliyuncs.comï¼Œåˆ™å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctr login --username=&lt;username&gt; registry.cn-hangzhou.aliyuncs.com</span><br></pre></td></tr></table></figure><p>è¯·æ³¨æ„ï¼Œ<username>æ˜¯æ‚¨çš„ç”¨æˆ·å.</p><h2 id="æ‰“-tag"><a href="#æ‰“-tag" class="headerlink" title="æ‰“ tag"></a>æ‰“ tag</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctr image tag &lt;image-name&gt; &lt;old-tag&gt; &lt;new-tag&gt;</span><br></pre></td></tr></table></figure><p>è¯·æ³¨æ„ï¼Œ<image-name>æ˜¯é•œåƒåç§°ï¼Œ<old-tag>æ˜¯æ—§æ ‡è®°ï¼Œ<new-tag>æ˜¯æ–°æ ‡è®°</p><h2 id="æ¨é€é•œåƒ"><a href="#æ¨é€é•œåƒ" class="headerlink" title="æ¨é€é•œåƒ"></a>æ¨é€é•œåƒ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctr image push &lt;image-name&gt;:&lt;new-tag&gt;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å®¹å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cli </tag>
            
            <tag> containerd </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Iptablesè¿›è¡ŒæŒä¹…åŒ–é…ç½®ï¼Œé‡å¯ä¸ä¸¢å¤±</title>
      <link href="/posts/d8f4121a/"/>
      <url>/posts/d8f4121a/</url>
      
        <content type="html"><![CDATA[<p>æ“ä½œæ–‡æ¡£é’ˆå¯¹ ubuntu20 å’Œ centos ç³»ç»Ÿï¼Œå…¶ä»–ç³»ç»Ÿç±»ä¼¼ã€‚<code>iptables-save</code> å‘½ä»¤å…¶å®åªæ˜¯æŠŠé…ç½®æ–‡ä»¶æ‰“å°å‡ºæ¥ï¼Œå¹¶ä¸ä¼šçœŸçš„ saveï¼Œè¿™ä¸ªæœ‰ç‚¹å®¹æ˜“è®©äººè¯¯è§£ã€‚</p><h2 id="é’ˆå¯¹-ubuntu-å¹³å°"><a href="#é’ˆå¯¹-ubuntu-å¹³å°" class="headerlink" title="é’ˆå¯¹ ubuntu å¹³å°"></a>é’ˆå¯¹ ubuntu å¹³å°</h2><p>ubuntu20 éœ€è¦å®‰è£… iptables-persistent æ‰èƒ½å®ç°æŒä¹…åŒ–</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install iptables-persistent</span><br></pre></td></tr></table></figure><p>æŒä¹…åŒ–çš„é…ç½®æ–‡ä»¶ä¿å­˜åœ¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é’ˆå¯¹ipv4</span></span><br><span class="line">/etc/iptables/rules.v4</span><br><span class="line"></span><br><span class="line"><span class="comment"># é’ˆå¯¹ipv6</span></span><br><span class="line">/etc/iptables/rules.v6</span><br></pre></td></tr></table></figure><p>æ‰‹åŠ¨ä¿å­˜å½“å‰é…ç½®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é’ˆå¯¹ipv4</span></span><br><span class="line">sudo iptables-save &gt; /etc/iptables/rules.v4</span><br><span class="line"></span><br><span class="line"><span class="comment"># é’ˆå¯¹ipv6</span></span><br><span class="line">sudo ip6tables-save &gt; /etc/iptables/rules.v6</span><br></pre></td></tr></table></figure><h2 id="é’ˆå¯¹-centos-å¹³å°"><a href="#é’ˆå¯¹-centos-å¹³å°" class="headerlink" title="é’ˆå¯¹ centos å¹³å°"></a>é’ˆå¯¹ centos å¹³å°</h2><p>å®‰è£…åŒ… <code>iptables-services</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo dnf install iptables-services</span><br></pre></td></tr></table></figure><p>é…ç½®æ–‡ä»¶ä½ç½®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/etc/sysconfig/iptables</span><br><span class="line">/etc/sysconfig/ip6tables</span><br></pre></td></tr></table></figure><p>éœ€è¦å…³é—­ firewalld ç„¶åå¯åŠ¨ iptables</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl <span class="built_in">disable</span> --now firewalld</span><br><span class="line">sudo systemctl <span class="built_in">enable</span> --now iptables</span><br></pre></td></tr></table></figure><p>æ‰‹åŠ¨ä¿å­˜å½“å‰é…ç½®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo iptables-save &gt; /etc/sysconfig/iptables</span><br><span class="line">sudo ip6tables-save &gt; /etc/sysconfig/ip6tables</span><br></pre></td></tr></table></figure><h2 id="netfilter-persistent-å‘½ä»¤"><a href="#netfilter-persistent-å‘½ä»¤" class="headerlink" title="netfilter-persistent å‘½ä»¤"></a>netfilter-persistent å‘½ä»¤</h2><p>ä½¿ç”¨ <code>netfilter-persistent save</code> å¯ä»¥è‡ªåŠ¨ä¿å­˜å½“å‰è§„åˆ™ï¼Œæœ¬è´¨ä¸Šæ˜¯è°ƒç”¨ä¸¤ä¸ªè„šæœ¬</p>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç½‘ç»œ </tag>
            
            <tag> iptables </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iptablesä½¿ç”¨è®°å½•å®æˆ˜</title>
      <link href="/posts/5e8ed38b/"/>
      <url>/posts/5e8ed38b/</url>
      
        <content type="html"><![CDATA[<h2 id="iptables-å››è¡¨äº”é“¾"><a href="#iptables-å››è¡¨äº”é“¾" class="headerlink" title="iptables å››è¡¨äº”é“¾"></a>iptables å››è¡¨äº”é“¾</h2><p>å››è¡¨äº”é“¾ï¼š<br>é“¾å°±æ˜¯ä½ç½®ï¼šå…±æœ‰äº”ä¸ª è¿›è·¯ç”± (PREROUTING)ã€è¿›ç³»ç»Ÿ (INPUT) ã€è½¬å‘ (FORWARD)ã€å‡ºç³»ç»Ÿ (OUTPUT)ã€å‡ºè·¯ç”± (POSTROUTING)ï¼›<br>è¡¨å°±æ˜¯å­˜å‚¨çš„è§„åˆ™ï¼›æ•°æ®åŒ…åˆ°äº†è¯¥é“¾å¤„ï¼Œä¼šå»å¯¹åº”è¡¨ä¸­æŸ¥è¯¢è®¾ç½®çš„è§„åˆ™ï¼Œç„¶åå†³å®šæ˜¯å¦æ”¾è¡Œã€ä¸¢å¼ƒã€è½¬å‘è¿˜æ˜¯ä¿®æ”¹ç­‰ç­‰æ“ä½œã€‚</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/20250113163327215.png" alt="image.png"></p><h3 id="å…·ä½“çš„å››è¡¨"><a href="#å…·ä½“çš„å››è¡¨" class="headerlink" title="å…·ä½“çš„å››è¡¨"></a>å…·ä½“çš„å››è¡¨</h3><table><thead><tr><th>è¡¨</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>filter</td><td>è¿‡æ»¤æ•°æ®åŒ…</td></tr><tr><td>Nat</td><td>ç”¨äºç½‘ç»œåœ°å€è½¬æ¢ï¼ˆIPã€ç«¯å£ï¼‰</td></tr><tr><td>Mangle</td><td>ä¿®æ”¹æ•°æ®åŒ…çš„æœåŠ¡ç±»å‹ã€TTLã€å¹¶ä¸”å¯ä»¥é…ç½®è·¯ç”±å®ç° QOS</td></tr><tr><td>Raw</td><td>å†³å®šæ•°æ®åŒ…æ˜¯å¦è¢«çŠ¶æ€è·Ÿè¸ªæœºåˆ¶å¤„ç†</td></tr></tbody></table><h3 id="å…·ä½“çš„äº”é“¾"><a href="#å…·ä½“çš„äº”é“¾" class="headerlink" title="å…·ä½“çš„äº”é“¾"></a>å…·ä½“çš„äº”é“¾</h3><table><thead><tr><th>é“¾</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>INPUT</td><td>è¿›æ¥çš„æ•°æ®åŒ…åº”ç”¨æ­¤è§„åˆ™é“¾ä¸­çš„ç­–ç•¥</td></tr><tr><td>OUTPUT</td><td>å¤–å‡ºçš„æ•°æ®åŒ…åº”ç”¨æ­¤è§„åˆ™é“¾ä¸­çš„ç­–ç•¥</td></tr><tr><td>FORWARD</td><td>è½¬å‘æ•°æ®åŒ…æ—¶åº”ç”¨æ­¤è§„åˆ™é“¾ä¸­çš„ç­–ç•¥</td></tr><tr><td>PREROUTING</td><td>å¯¹æ•°æ®åŒ…ä½œè·¯ç”±é€‰æ‹©å‰åº”ç”¨æ­¤é“¾ä¸­çš„è§„åˆ™ï¼ˆæ‰€æœ‰çš„æ•°æ®åŒ…è¿›æ¥çš„æ—¶ä¾¯éƒ½å…ˆç”±è¿™ä¸ªé“¾å¤„ç†ï¼‰</td></tr><tr><td>POSTROUTING</td><td>å¯¹æ•°æ®åŒ…ä½œè·¯ç”±é€‰æ‹©ååº”ç”¨æ­¤é“¾ä¸­çš„è§„åˆ™ï¼ˆæ‰€æœ‰çš„æ•°æ®åŒ…å‡ºæ¥çš„æ—¶ä¾¯éƒ½å…ˆç”±è¿™ä¸ªé“¾å¤„ç†ï¼‰</td></tr></tbody></table><h2 id="å¼€å¯å†…æ ¸è½¬å‘åŠŸèƒ½"><a href="#å¼€å¯å†…æ ¸è½¬å‘åŠŸèƒ½" class="headerlink" title="å¼€å¯å†…æ ¸è½¬å‘åŠŸèƒ½"></a>å¼€å¯å†…æ ¸è½¬å‘åŠŸèƒ½</h2><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">ä¸´æ—¶å¼€å¯</button><button type="button" class="tab">æ°¸ä¹…å¼€å¯</button></div><div class="tab-contents"><div class="tab-item-content active"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo sysctl -w net.ipv4.ip_forward=1</span><br></pre></td></tr></table></figure><p>æˆ–è€…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;1&quot;</span> &gt; /proc/sys/net/ipv4/ip_forward</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/sysctl.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿è¯æ˜¯è¿™ä¸ªé…ç½®</span></span><br><span class="line">net.ipv4.ip_forward=1</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç«‹å³ç”Ÿæ•ˆ</span></span><br><span class="line">sudo sysctl -p</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div><h2 id="ä½¿ç”¨æ¡ˆä¾‹"><a href="#ä½¿ç”¨æ¡ˆä¾‹" class="headerlink" title="ä½¿ç”¨æ¡ˆä¾‹"></a>ä½¿ç”¨æ¡ˆä¾‹</h2><h3 id="é™åˆ¶å…¥ç«™ï¼Œä¸é™åˆ¶å‡ºç«™"><a href="#é™åˆ¶å…¥ç«™ï¼Œä¸é™åˆ¶å‡ºç«™" class="headerlink" title="é™åˆ¶å…¥ç«™ï¼Œä¸é™åˆ¶å‡ºç«™"></a>é™åˆ¶å…¥ç«™ï¼Œä¸é™åˆ¶å‡ºç«™</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é»˜è®¤ç­–ç•¥</span></span><br><span class="line">iptables -P INPUT DROP</span><br><span class="line">iptables -P FORWARD DROP</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…è®¸è®¿é—®22ç«¯å£</span></span><br><span class="line">iptables -A INPUT -i eth0 -p tcp --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»…å…è®¸æŒ‡å®šIPæ®µè®¿é—®</span></span><br><span class="line">iptables -A INPUT -i eth0 -p tcp -s 192.168.100.0/24 --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT</span><br></pre></td></tr></table></figure><h3 id="é™åˆ¶å…¥ç«™å’Œå‡ºç«™"><a href="#é™åˆ¶å…¥ç«™å’Œå‡ºç«™" class="headerlink" title="é™åˆ¶å…¥ç«™å’Œå‡ºç«™"></a>é™åˆ¶å…¥ç«™å’Œå‡ºç«™</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®¾ç½®é“¾çš„é»˜è®¤ç­–ç•¥</span></span><br><span class="line">iptables -P INPUT DROP</span><br><span class="line">iptables -P FORWARD DROP</span><br><span class="line">iptables -P OUTPUT DROP</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¦æ­¢ä¸€ä¸ªIPçš„æ‰€æœ‰åŒ…</span></span><br><span class="line">iptables -A INPUT -s 192.168.1.10 -j DROP</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…è®¸æ‰€æœ‰SSHçš„è¿æ¥è¯·æ±‚</span></span><br><span class="line">iptables -A INPUT -i eth0 -p tcp --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT</span><br><span class="line">iptables -A OUTPUT -o eth0 -p tcp --sport 22 -m state --state ESTABLISHED -j ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»…å…è®¸æ¥è‡ªäº192.168.100.0/24åŸŸçš„ç”¨æˆ·çš„sshè¿æ¥è¯·æ±‚</span></span><br><span class="line">iptables -A INPUT -i eth0 -p tcp -s 192.168.100.0/24 --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT</span><br><span class="line">iptables -A OUTPUT -o eth0 -p tcp --sport 22 -m state --state ESTABLISHED -j ACCEPT</span><br></pre></td></tr></table></figure><h3 id="æœ¬åœ°ç«¯å£è½¬å‘åˆ°æœ¬åœ°ç«¯å£"><a href="#æœ¬åœ°ç«¯å£è½¬å‘åˆ°æœ¬åœ°ç«¯å£" class="headerlink" title="æœ¬åœ°ç«¯å£è½¬å‘åˆ°æœ¬åœ°ç«¯å£"></a>æœ¬åœ°ç«¯å£è½¬å‘åˆ°æœ¬åœ°ç«¯å£</h3><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/20250110160536647.png" alt="image.png|631"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®¿é—®æœåŠ¡å™¨çš„ 2222 ç«¯å£ï¼Œè½¬å‘åˆ°æœåŠ¡å™¨çš„ 22 ç«¯å£</span></span><br><span class="line">iptables -t nat -A PREROUTING -p tcp --dport 2222 -j REDIRECT --to-port 22</span><br></pre></td></tr></table></figure><h3 id="è½¬å‘è¯·æ±‚åˆ°å…¶ä»–ä¸»æœº"><a href="#è½¬å‘è¯·æ±‚åˆ°å…¶ä»–ä¸»æœº" class="headerlink" title="è½¬å‘è¯·æ±‚åˆ°å…¶ä»–ä¸»æœº"></a>è½¬å‘è¯·æ±‚åˆ°å…¶ä»–ä¸»æœº</h3><p>è¿™æ˜¯é€šè¿‡æœ¬ä¸»æœºåšä¸€ä¸ªè·³è½¬ï¼Œæ¯”å¦‚è®¿é—® <code>10.0.0.102</code> çš„ 80 ç«¯å£è½¬å‘åˆ° <code>10.0.0.103</code> çš„ 8000 ç«¯å£</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/20250110162930990.png" alt="image.png|740"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨10.0.0.102ï¼ˆServer Aï¼‰ä¸Šæ‰§è¡Œ</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿™ä¸ªæ˜¯è¿›æ¥çš„æ•°æ®åŒ…ï¼ˆä¸åŒ…å«è‡ªèº«å‘å‡ºçš„æ•°æ®åŒ…ï¼Œå¦‚æœæ˜¯è‡ªèº«å‘å‡ºï¼Œä½¿ç”¨OUTPUTé“¾ï¼‰ï¼Œç›®çš„åœ°å€æ˜¯ 10.0.0.102 ä¸”ç«¯å£æ˜¯80 çš„æ•°æ®åŒ…è½¬å‘åˆ° 10.0.0.103:8000</span></span><br><span class="line">iptables -t nat -A PREROUTING -4 -p tcp -d 10.0.0.102 --dport 80 -j DNAT --to-destination 10.0.0.103:8000</span><br><span class="line"></span><br><span class="line"><span class="comment"># è½¬å‘å‡ºå»çš„æ•°æ®åŒ… ç›®çš„åœ°å€æ˜¯ 10.0.0.103 ç«¯å£æ˜¯ 8000 çš„æ•°æ®åŒ…è¿›è¡Œä¼ªè£…ï¼ˆå°±æ˜¯æŠŠæ•°æ®åŒ…æ¥æºåœ°å€æ¢æˆæœ¬æœºçš„ipï¼Œè¿™æ ·å¦ä¸€å°æœºå™¨å›åŒ…æ‰ä¼šå›ç»™è‡ªå·±ï¼‰ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ï¼š iptables -t nat -A POSTROUTING -4 -p tcp -d 10.0.0.103 --dport 8000 -j MASQUERADE</span></span><br><span class="line">iptables -t nat -A POSTROUTING -4 -p tcp -d 10.0.0.103 --dport 8000 -j SNAT --to-source 10.0.0.102</span><br></pre></td></tr></table></figure><p>ä¸Šé¢æ“ä½œå®Œæˆåï¼Œå¯ä»¥ä½¿ç”¨ä» client è¯·æ±‚ <code>10.0.0.102:80</code> , ä½†æ˜¯ <code>Server A</code> è¿™å°æœºå™¨è¯·æ±‚ <code>10.0.0.102:80</code> ä¸é€šï¼Œå¦‚æœè¦å®ç° <code>Server A</code> ä¹Ÿå¯ä»¥è®¿é—® <code>10.0.0.102:80</code> éœ€è¦é¢å¤–æ‰§è¡Œä¸€ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨10.0.0.102ï¼ˆServer Aï¼‰ä¸Šæ‰§è¡Œ</span></span><br><span class="line">iptables -t nat -A OUTPUT -4 -p tcp -d 10.0.0.102 --dport 80 -j DNAT --to-destination 10.0.0.103:8000</span><br></pre></td></tr></table></figure><h2 id="å…¶ä»–æ“ä½œ"><a href="#å…¶ä»–æ“ä½œ" class="headerlink" title="å…¶ä»–æ“ä½œ"></a>å…¶ä»–æ“ä½œ</h2><table><thead><tr><th>æ“ä½œ</th><th>å‘½ä»¤</th></tr></thead><tbody><tr><td>æŸ¥çœ‹ nat è¡¨</td><td>sudo iptables -t nat -L</td></tr><tr><td>æ¸…ç©º nat è¡¨é…ç½®</td><td>sudo iptables -t nat -F<br></td></tr><tr><td>æŸ¥çœ‹ filter è¡¨</td><td>sudo iptables -L</td></tr><tr><td>æ¸…ç©º filter è¡¨</td><td>sudo iptables -F</td></tr></tbody></table><h3 id="iptables-æŒä¹…åŒ–"><a href="#iptables-æŒä¹…åŒ–" class="headerlink" title="iptables æŒä¹…åŒ–"></a>iptables æŒä¹…åŒ–</h3><p>è¯·çœ‹ <a href="/posts/d8f4121a">iptablesè¿›è¡ŒæŒä¹…åŒ–é…ç½®ï¼Œé‡å¯ä¸ä¸¢å¤±</a></p><h3 id="SNAT-å’Œ-MASQUERADE-çš„åŒºåˆ«"><a href="#SNAT-å’Œ-MASQUERADE-çš„åŒºåˆ«" class="headerlink" title="SNAT å’Œ MASQUERADE çš„åŒºåˆ«"></a>SNAT å’Œ MASQUERADE çš„åŒºåˆ«</h3><p>MASQUERADE æ˜¯ä¸€ç§ç‰¹æ®Šçš„ SNAT ä¸»è¦æ˜¯ä¸ç”¨ç‰¹æ®ŠæŒ‡å®šä¿®æ”¹çš„æºåœ°å€ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># SNAT ç¤ºä¾‹ï¼Œå‡è®¾ 203.0.113.1 æ˜¯å…¬ç½‘IP</span></span><br><span class="line">iptables -t nat -A POSTROUTING -s 192.168.1.0/24 -o eth0 -j SNAT --to-source 203.0.113.1</span><br><span class="line"></span><br><span class="line"><span class="comment"># MASQUERADE ç¤ºä¾‹</span></span><br><span class="line">iptables -t nat -A POSTROUTING -s 192.168.1.0/24 -o eth0 -j MASQUERADE</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç½‘ç»œ </tag>
            
            <tag> iptables </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hexoåšå®¢æ·»åŠ è‡ªå®šä¹‰htmlé¡µé¢</title>
      <link href="/posts/sgba64/"/>
      <url>/posts/sgba64/</url>
      
        <content type="html"><![CDATA[<p>æ¯”å¦‚æˆ‘æƒ³å¢åŠ ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œæ–‡ä»¶å¤¹é‡Œé¢æœ‰ imgã€cssã€js ç­‰æ–‡ä»¶å¤¹ï¼Œè¿˜æœ‰ index.html æ–‡ä»¶ï¼Œæƒ³è¦åœ¨ hexo åšå®¢é‡Œå¯ä»¥æ­£å¸¸æ˜¾ç¤º</p><p>å°† æ–‡ä»¶å¤¹ æ”¾åˆ° hexo çš„ source æ–‡ä»¶å¤¹ä¸‹ã€‚</p><p>ç„¶åéœ€è¦é…ç½®è·³è¿‡ hexo çš„æ¸²æŸ“ï¼Œå› ä¸º hexo ä¼šæ”¹å˜ html æ–‡ä»¶çš„ç»“æ„ã€‚</p><p>ä¿®æ”¹ <code>_config.yml</code></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">skip_render:</span> </span><br><span class="line"><span class="comment"># è¿™é‡Œæ’é™¤çš„æ˜¯ source ç›®å½•ä¸‹ä¸éœ€è¦æ¸²æŸ“çš„æ–‡ä»¶</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;**/README.md&#x27;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;html/*&#x27;</span></span><br></pre></td></tr></table></figure><p>åç»­å¯ä»¥é€šè¿‡è®¿é—® <code>http://xxx.com/html/</code> æ¥æ‰“å¼€é¡µé¢</p><p>éœ€è¦æ³¨æ„ js css html ç­‰æ–‡ä»¶è°ƒç”¨çš„åœ°å€æœ‰å¯èƒ½éœ€è¦æ›´æ¢ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ­å»º </tag>
            
            <tag> è®°å½• </tag>
            
            <tag> hexo </tag>
            
            <tag> åšå®¢ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¼–è¯‘å®‰è£…MySQL5.7</title>
      <link href="/posts/b670229a/"/>
      <url>/posts/b670229a/</url>
      
        <content type="html"><![CDATA[<p>ç¼–è¯‘éœ€è¦è€—æ—¶ï¼Œä¸”å¯¹ç³»ç»Ÿçš„ä¾èµ–æ›´ä¸ºå¤æ‚ï¼Œæ›´å®¹æ˜“å‡ºé”™ï¼Œ å¦‚æœæ²¡æœ‰å¿…è¦ï¼Œå¯ä»¥å‚è€ƒä½¿ç”¨ <a href="/posts/3b23b5cb">äºŒè¿›åˆ¶å®‰è£…MySQL5.7</a></p><h2 id="å®‰è£…ç¼–è¯‘ä¾èµ–"><a href="#å®‰è£…ç¼–è¯‘ä¾èµ–" class="headerlink" title="å®‰è£…ç¼–è¯‘ä¾èµ–"></a>å®‰è£…ç¼–è¯‘ä¾èµ–</h2><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">Ubuntuå’ŒDebian</button><button type="button" class="tab">CentOSå’ŒFedora</button></div><div class="tab-contents"><div class="tab-item-content active"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install -y build-essential cmake libaio-dev libncurses5-dev pkg-config</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum -y install zlib-devel openssl-devel libaio-devel ncurses-devel cmake gcc-c++</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div><h2 id="ç¼–è¯‘"><a href="#ç¼–è¯‘" class="headerlink" title="ç¼–è¯‘"></a>ç¼–è¯‘</h2><h3 id="è®¾ç½®å®‰è£…è·¯å¾„"><a href="#è®¾ç½®å®‰è£…è·¯å¾„" class="headerlink" title="è®¾ç½®å®‰è£…è·¯å¾„"></a>è®¾ç½®å®‰è£…è·¯å¾„</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> BASE_DIR=<span class="string">&quot;/usr/local/mysql&quot;</span></span><br><span class="line"><span class="built_in">export</span> DATA_DIR=<span class="string">&quot;/data/mysql&quot;</span></span><br></pre></td></tr></table></figure><h3 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wget https://cdn.mysql.com//Downloads/MySQL-5.7/mysql-boost-5.7.38.tar.gz</span><br><span class="line">tar xf mysql-boost-5.7.38.tar.gz &amp;&amp; <span class="built_in">cd</span> mysql-5.7.38</span><br><span class="line">[[ -d build ]] &amp;&amp; <span class="built_in">rm</span> -r build</span><br><span class="line"><span class="built_in">mkdir</span> -p build &amp;&amp; <span class="built_in">cd</span> build</span><br></pre></td></tr></table></figure><h3 id="å¼€å§‹ç¼–è¯‘"><a href="#å¼€å§‹ç¼–è¯‘" class="headerlink" title="å¼€å§‹ç¼–è¯‘"></a>å¼€å§‹ç¼–è¯‘</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">cmake .. \</span><br><span class="line">    -DBUILD_CONFIG=mysql_release \</span><br><span class="line">    -DFEATURE_SET=<span class="string">&quot;community&quot;</span> \</span><br><span class="line">    -DCMAKE_INSTALL_PREFIX=<span class="string">&quot;<span class="variable">$&#123;BASE_DIR&#125;</span>&quot;</span> \</span><br><span class="line">    -DWITH_EMBEDDED_SERVER=off \</span><br><span class="line">    -DINSTALL_SBINDIR=bin \</span><br><span class="line">    -DINSTALL_SCRIPTDIR=bin \</span><br><span class="line">    -DINSTALL_LIBDIR=lib/mysql \</span><br><span class="line">    -DINSTALL_PLUGINDIR=lib/plugin \</span><br><span class="line">    -DINSTALL_INCLUDEDIR=include \</span><br><span class="line">    -DINSTALL_INFODIR=share/info \</span><br><span class="line">    -DINSTALL_MANDIR=share/man \</span><br><span class="line">    -DINSTALL_MYSQLSHAREDIR=share/mysql \</span><br><span class="line">    -DINSTALL_SUPPORTFILESDIR=share/mysql \</span><br><span class="line">    -DINSTALL_MYSQLTESTDIR=mysql-test \</span><br><span class="line">    -DDEFAULT_CHARSET=utf8 \</span><br><span class="line">    -DDEFAULT_COLLATION=utf8_general_ci \</span><br><span class="line">    -DEXTRA_CHARSETS=all \</span><br><span class="line">    -DENABLED_LOCAL_INFILE=ON \</span><br><span class="line">    -DWITH_LIBEVENT=bundled \</span><br><span class="line">    -DWITH_SSL=bundled \</span><br><span class="line">    -DWITH_ZLIB=bundled \</span><br><span class="line">    -DWITH_INNODB_MEMCACHED=on \</span><br><span class="line">    -DWITH_BOOST=../boost \</span><br><span class="line">    -DWITH_UNIT_TESTS=on \</span><br><span class="line">    -DWITH_DEBUG=off</span><br><span class="line"></span><br><span class="line">make -j4 &amp;&amp; make install</span><br><span class="line"><span class="comment"># æ ¹æ®cpuæ ¸å¿ƒæ•°è®¾ç½®ï¼Œç›´æ¥makeä¹Ÿè¡Œ</span></span><br></pre></td></tr></table></figure><h2 id="æ”¶å°¾"><a href="#æ”¶å°¾" class="headerlink" title="æ”¶å°¾"></a>æ”¶å°¾</h2><h3 id="åˆ›å»ºç›®å½•å’Œç”¨æˆ·"><a href="#åˆ›å»ºç›®å½•å’Œç”¨æˆ·" class="headerlink" title="åˆ›å»ºç›®å½•å’Œç”¨æˆ·"></a>åˆ›å»ºç›®å½•å’Œç”¨æˆ·</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p <span class="variable">$&#123;DATA_DIR&#125;</span>/&#123;binlog,data,logs,redolog,relaylog,tmp,undolog&#125;</span><br><span class="line"><span class="built_in">mkdir</span> -p <span class="variable">$&#123;BASE_DIR&#125;</span>/etc</span><br><span class="line">groupadd -g 27 -o -r mysql</span><br><span class="line">useradd -M -g mysql -o -r -d /dev/null -s /sbin/nologin -u 27 mysql </span><br><span class="line"><span class="built_in">chown</span> -R mysql.mysql <span class="variable">$&#123;DATA_DIR&#125;</span></span><br></pre></td></tr></table></figure><h3 id="åˆ›å»ºé…ç½®æ–‡ä»¶"><a href="#åˆ›å»ºé…ç½®æ–‡ä»¶" class="headerlink" title="åˆ›å»ºé…ç½®æ–‡ä»¶"></a>åˆ›å»ºé…ç½®æ–‡ä»¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; <span class="variable">$&#123;BASE_DIR&#125;</span>/etc/my.cnf &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">## MySQL 5.7 Configuration File</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[mysqld]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## General</span></span><br><span class="line"><span class="string">user                                   = mysql</span></span><br><span class="line"><span class="string">bind_address                           = 0.0.0.0</span></span><br><span class="line"><span class="string">port                                   = 3306</span></span><br><span class="line"><span class="string">basedir                                = $&#123;BASE_DIR&#125;/</span></span><br><span class="line"><span class="string">datadir                                = $&#123;DATA_DIR&#125;/data</span></span><br><span class="line"><span class="string">tmpdir                                 = $&#123;DATA_DIR&#125;/tmp</span></span><br><span class="line"><span class="string">socket                                 = $&#123;DATA_DIR&#125;/logs/mysql.sock</span></span><br><span class="line"><span class="string">pid-file                               = $&#123;DATA_DIR&#125;/logs/mysqld.pid</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">character_set_server                   = utf8</span></span><br><span class="line"><span class="string">sql_mode                               = NO_ENGINE_SUBSTITUTION  # default &quot;STRICT_TRANS_TABLES,NO_ENGINE_SUBSTITUTION</span></span><br><span class="line"><span class="string">transaction_isolation                  = READ-COMMITTED    # default REPEATABLE-READ</span></span><br><span class="line"><span class="string">explicit_defaults_for_timestamp        = ON     # default OFF</span></span><br><span class="line"><span class="string">secure_file_priv                       =</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">skip-symbolic-links</span></span><br><span class="line"><span class="string">skip_name_resolve                      = ON</span></span><br><span class="line"><span class="string">skip_external_locking                  = ON</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">performance_schema                     = ON      # default ON</span></span><br><span class="line"><span class="string">performance-schema-instrument          = &#x27;memory/%=ON&#x27;</span></span><br><span class="line"><span class="string">autocommit                             = ON      # default ON</span></span><br><span class="line"><span class="string">#event_scheduler                        = ON     # default OFF</span></span><br><span class="line"><span class="string">#lower_case_table_names                 = 0      # default 0</span></span><br><span class="line"><span class="string">show_compatibility_56                  = ON      # &gt;= 5.7.8 default OFF</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## ssl</span></span><br><span class="line"><span class="string">#ssl_ca                                 = $&#123;DATA_DIR&#125;/ssl/ca.pem</span></span><br><span class="line"><span class="string">#ssl_cert                               = $&#123;DATA_DIR&#125;/ssl/server-cert.pem</span></span><br><span class="line"><span class="string">#ssl_key                                = $&#123;DATA_DIR&#125;/ssl/server-key.pem</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## Networking</span></span><br><span class="line"><span class="string">back_log                               = 1000</span></span><br><span class="line"><span class="string">max_connections                        = 1100</span></span><br><span class="line"><span class="string">max_user_connections                   = 1000</span></span><br><span class="line"><span class="string">max_connect_errors                     = 1000000</span></span><br><span class="line"><span class="string">interactive_timeout                    = 300</span></span><br><span class="line"><span class="string">wait_timeout                           = 300</span></span><br><span class="line"><span class="string">connect_timeout                        = 10</span></span><br><span class="line"><span class="string">net_buffer_length                      = 1M</span></span><br><span class="line"><span class="string">max_allowed_packet                     = 256M</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## Cache</span></span><br><span class="line"><span class="string">thread_cache_size                      = 192     # since 5.6.8 default -1, autosized ( max_connections / 100 ) + 8</span></span><br><span class="line"><span class="string">table_open_cache                       = 4096</span></span><br><span class="line"><span class="string">table_definition_cache                 = 4096</span></span><br><span class="line"><span class="string">table_open_cache_instances             = 8</span></span><br><span class="line"><span class="string">query_cache_type                       = 0</span></span><br><span class="line"><span class="string">query_cache_size                       = 0</span></span><br><span class="line"><span class="string">#query_cache_size                       = 32M</span></span><br><span class="line"><span class="string">#query_cache_limit                      = 1M</span></span><br><span class="line"><span class="string">#query_cache_min_res_unit               = 2K</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## Per_thread Buffers</span></span><br><span class="line"><span class="string">sort_buffer_size                       = 32M     # default 256K</span></span><br><span class="line"><span class="string">read_buffer_size                       = 16M     # default 256K</span></span><br><span class="line"><span class="string">read_rnd_buffer_size                   = 32M     # default 256K</span></span><br><span class="line"><span class="string">join_buffer_size                       = 128M    # default 256K</span></span><br><span class="line"><span class="string">bulk_insert_buffer_size                = 64M</span></span><br><span class="line"><span class="string">thread_stack                           = 256K    # default 192K</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## Temp Tables</span></span><br><span class="line"><span class="string">tmp_table_size                         = 512M</span></span><br><span class="line"><span class="string">max_heap_table_size                    = 512M</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## Sort</span></span><br><span class="line"><span class="string">max_length_for_sort_data               = 2048    # default 1024</span></span><br><span class="line"><span class="string">eq_range_index_dive_limit              = 200     # default 10</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">### Storage Engines</span></span><br><span class="line"><span class="string">default_storage_engine                 = InnoDB</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## InnoDB</span></span><br><span class="line"><span class="string">innodb_file_per_table                  = ON</span></span><br><span class="line"><span class="string">innodb_file_format_check               = ON</span></span><br><span class="line"><span class="string">innodb_checksum_algorithm              = crc32</span></span><br><span class="line"><span class="string">innodb_page_size                       = 16k     # default 16k</span></span><br><span class="line"><span class="string">innodb_buffer_pool_size                = 2G      # default 1G, = innodb_buffer_pool_instances * innodb_buffer_pool_chunk_size * n</span></span><br><span class="line"><span class="string">innodb_buffer_pool_instances           = 8       # since 5.6.6 if innodb_buffer_pool_size &lt; 1G default 1 else 8</span></span><br><span class="line"><span class="string">innodb_buffer_pool_chunk_size          = 128M    # defautl 128M</span></span><br><span class="line"><span class="string">innodb_data_file_path                  = ibdata1:100M:autoextend</span></span><br><span class="line"><span class="string">innodb_temp_data_file_path             = ../tmp/ibtmp1:12M:autoextend</span></span><br><span class="line"><span class="string">innodb_log_group_home_dir              = $&#123;DATA_DIR&#125;/redolog/</span></span><br><span class="line"><span class="string">innodb_log_file_size                   = 256M</span></span><br><span class="line"><span class="string">innodb_log_files_in_group              = 2</span></span><br><span class="line"><span class="string">innodb_log_buffer_size                 = 16M</span></span><br><span class="line"><span class="string">innodb_rollback_segments               = 128     # defautl 128</span></span><br><span class="line"><span class="string">innodb_undo_directory                  = $&#123;DATA_DIR&#125;/undolog/</span></span><br><span class="line"><span class="string">innodb_undo_tablespaces                = 4       # from 5.7.21 deprecated</span></span><br><span class="line"><span class="string">innodb_open_files                      = 4000</span></span><br><span class="line"><span class="string">innodb_thread_concurrency              = 32</span></span><br><span class="line"><span class="string">innodb_flush_log_at_trx_commit         = 1</span></span><br><span class="line"><span class="string">innodb_flush_log_at_timeout            = 1       # defautl 1, when innodb_flush_log_at_trx_commit = 0 or 2</span></span><br><span class="line"><span class="string">innodb_purge_threads                   = 4</span></span><br><span class="line"><span class="string">innodb_print_all_deadlocks             = ON</span></span><br><span class="line"><span class="string">innodb_max_dirty_pages_pct             = 70</span></span><br><span class="line"><span class="string">innodb_lock_wait_timeout               = 50</span></span><br><span class="line"><span class="string">innodb_flush_method                    = O_DIRECT</span></span><br><span class="line"><span class="string">innodb_old_blocks_time                 = 1000    # since 5.6.6 default 1000</span></span><br><span class="line"><span class="string">innodb_io_capacity                     = 600     # default 200</span></span><br><span class="line"><span class="string">innodb_io_capacity_max                 = 2000    # default 2000</span></span><br><span class="line"><span class="string">innodb_lru_scan_depth                  = 1024    # default 1024</span></span><br><span class="line"><span class="string">innodb_read_io_threads                 = 8</span></span><br><span class="line"><span class="string">innodb_write_io_threads                = 8</span></span><br><span class="line"><span class="string">innodb_buffer_pool_load_at_startup     = ON</span></span><br><span class="line"><span class="string">innodb_buffer_pool_dump_at_shutdown    = ON</span></span><br><span class="line"><span class="string">innodb_buffer_pool_filename            = ib_buffer_pool  # default ib_buffer_pool</span></span><br><span class="line"><span class="string">innodb_sort_buffer_size                = 64M     # default 1M , 64K - 64M , for change index</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">innodb_buffer_pool_dump_pct            = 40</span></span><br><span class="line"><span class="string">innodb_page_cleaners                   = 16</span></span><br><span class="line"><span class="string">innodb_undo_log_truncate               = ON</span></span><br><span class="line"><span class="string">innodb_max_undo_log_size               = 2G</span></span><br><span class="line"><span class="string">innodb_purge_rseg_truncate_frequency   = 128</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## Gtid</span></span><br><span class="line"><span class="string">#gtid_mode                              = ON</span></span><br><span class="line"><span class="string">#enforce_gtid_consistency               = ON</span></span><br><span class="line"><span class="string">#binlog_gtid_simple_recovery            = 1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## Replication</span></span><br><span class="line"><span class="string">server_id                              = 101</span></span><br><span class="line"><span class="string">log_bin                                = $&#123;DATA_DIR&#125;/binlog/mysql_bin</span></span><br><span class="line"><span class="string">expire_logs_days                       = 7</span></span><br><span class="line"><span class="string">binlog_format                          = ROW</span></span><br><span class="line"><span class="string">binlog_row_image                       = noblob  # default full</span></span><br><span class="line"><span class="string">#innodb_autoinc_lock_mode               = 2      # default 1</span></span><br><span class="line"><span class="string">binlog_rows_query_log_events           = 1</span></span><br><span class="line"><span class="string">max_binlog_size                        = 500M</span></span><br><span class="line"><span class="string">binlog_cache_size                      = 1M</span></span><br><span class="line"><span class="string">sync_binlog                            = 1</span></span><br><span class="line"><span class="string">master_info_repository                 = TABLE</span></span><br><span class="line"><span class="string">relay_log_info_repository              = TABLE</span></span><br><span class="line"><span class="string">skip-slave-start                       = 1</span></span><br><span class="line"><span class="string">relay_log                              = $&#123;DATA_DIR&#125;/relaylog/relay_log</span></span><br><span class="line"><span class="string">max_relay_log_size                     = 500M   # default 0, use max_binlog_size</span></span><br><span class="line"><span class="string">log_slave_updates                      = ON     # default OFF</span></span><br><span class="line"><span class="string">#read_only                              = ON</span></span><br><span class="line"><span class="string">#super_read_only                        = ON</span></span><br><span class="line"><span class="string">#relay_log_purge                        = 1</span></span><br><span class="line"><span class="string">#slave_net_timeout                      = 60</span></span><br><span class="line"><span class="string">#replicate_wild_do_table                = mysql.%</span></span><br><span class="line"><span class="string">#replicate_wild_ignore_table            = test.%</span></span><br><span class="line"><span class="string">#auto_increment_offset                  = 1</span></span><br><span class="line"><span class="string">#auto_increment_increment               = 2</span></span><br><span class="line"><span class="string">#plugin_dir                             = $&#123;DATA_DIR&#125;/lib/plugin</span></span><br><span class="line"><span class="string">#plugin_load                            = &quot;rpl_semi_sync_master=semisync_master.so;rpl_semi_sync_slave=semisync_slave.so&quot;</span></span><br><span class="line"><span class="string">#rpl_semi_sync_master_enabled           = ON</span></span><br><span class="line"><span class="string">#rpl_semi_sync_slave_enabled            = ON</span></span><br><span class="line"><span class="string">#rpl_semi_sync_master_timeout           = 1000</span></span><br><span class="line"><span class="string">slave_transaction_retries              = 128</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## MTS</span></span><br><span class="line"><span class="string">relay_log_recovery                     = 1</span></span><br><span class="line"><span class="string">#slave_parallel_type                    = LOGICAL_CLOCK</span></span><br><span class="line"><span class="string">#slave_parallel_workers                 = 16</span></span><br><span class="line"><span class="string">#slave_preserve_commit_order            = 1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## Logging</span></span><br><span class="line"><span class="string">log_output                             = FILE</span></span><br><span class="line"><span class="string">slow_query_log                         = ON</span></span><br><span class="line"><span class="string">slow_query_log_file                    = $&#123;DATA_DIR&#125;/logs/slow_mysqld.log</span></span><br><span class="line"><span class="string">log_queries_not_using_indexes          = OFF     # default OFF</span></span><br><span class="line"><span class="string">log_throttle_queries_not_using_indexes = 10      # default 0</span></span><br><span class="line"><span class="string">min_examined_row_limit                 = 0       # default 0</span></span><br><span class="line"><span class="string">log_slow_admin_statements              = ON</span></span><br><span class="line"><span class="string">log_slow_slave_statements              = ON</span></span><br><span class="line"><span class="string">long_query_time                        = 1</span></span><br><span class="line"><span class="string">#log-short-format                       = 0</span></span><br><span class="line"><span class="string">log_error                              = $&#123;DATA_DIR&#125;/logs/error_mysqld.log</span></span><br><span class="line"><span class="string">general_log                            = OFF</span></span><br><span class="line"><span class="string">general_log_file                       = $&#123;DATA_DIR&#125;/logs/general_mysqld.log</span></span><br><span class="line"><span class="string">log_timestamps                         = system</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## Index</span></span><br><span class="line"><span class="string">ft_min_word_len                        = 4</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[mysqld_safe]</span></span><br><span class="line"><span class="string">open_files_limit                       = 65535</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[mysql]</span></span><br><span class="line"><span class="string">no_auto_rehash</span></span><br><span class="line"><span class="string">prompt                                 = &quot;MySQL [\\d] &gt; &quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[mysqldump]</span></span><br><span class="line"><span class="string">quick</span></span><br><span class="line"><span class="string">max_allowed_packet                     = 256M</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[mysqlhotcopy]</span></span><br><span class="line"><span class="string">interactive_timeout</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[client]</span></span><br><span class="line"><span class="string">socket                                 = $&#123;DATA_DIR&#125;/logs/mysql.sock</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><h3 id="åˆ›å»ºè½¯é“¾æ¥"><a href="#åˆ›å»ºè½¯é“¾æ¥" class="headerlink" title="åˆ›å»ºè½¯é“¾æ¥"></a>åˆ›å»ºè½¯é“¾æ¥</h3><p>my.cnf æ–‡ä»¶å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½éœ€è¦ä½¿ç”¨çš„ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">ln</span> -s <span class="variable">$&#123;BASE_DIR&#125;</span>/etc/my.cnf /etc/my.cnf</span><br></pre></td></tr></table></figure><h3 id="åˆ›å»º-service-æ–‡ä»¶"><a href="#åˆ›å»º-service-æ–‡ä»¶" class="headerlink" title="åˆ›å»º service æ–‡ä»¶"></a>åˆ›å»º service æ–‡ä»¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">cp</span> <span class="variable">$&#123;BASE_DIR&#125;</span>/share/mysql.service /etc/init.d/</span><br><span class="line">sudo systemctl daemon-reload</span><br></pre></td></tr></table></figure><h2 id="åˆå§‹åŒ–æ•°æ®åº“"><a href="#åˆå§‹åŒ–æ•°æ®åº“" class="headerlink" title="åˆå§‹åŒ–æ•°æ®åº“"></a>åˆå§‹åŒ–æ•°æ®åº“</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$&#123;BASE_DIR&#125;</span>/bin/mysqld --initialize-insecure      <span class="comment"># ç©ºå¯†ç , å¯ä»¥é€šè¿‡mysqlå‘½ä»¤ç™»å½•</span></span><br><span class="line"><span class="variable">$&#123;BASE_DIR&#125;</span>/bin/mysqld --initialize               <span class="comment"># æˆ–è€…ä½¿ç”¨éšæœºå¯†ç ï¼Œerror_logæ—¥å¿—ä¼šæ‰“å°ä¸´æ—¶å¯†ç </span></span><br></pre></td></tr></table></figure><h2 id="ä¼˜åŒ–å·¥ä½œ"><a href="#ä¼˜åŒ–å·¥ä½œ" class="headerlink" title="ä¼˜åŒ–å·¥ä½œ"></a>ä¼˜åŒ–å·¥ä½œ</h2><h3 id="æ·»åŠ ç¯å¢ƒå˜é‡"><a href="#æ·»åŠ ç¯å¢ƒå˜é‡" class="headerlink" title="æ·»åŠ ç¯å¢ƒå˜é‡"></a>æ·»åŠ ç¯å¢ƒå˜é‡</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="subst">$( grep <span class="string">&quot;<span class="variable">$&#123;BASE_DIR&#125;</span>/bin&quot;</span> /etc/profile | wc -l )</span>&quot;</span> -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;export PATH=\$PATH:<span class="variable">$&#123;BASE_DIR&#125;</span>/bin&quot;</span> &gt;&gt; /etc/profile</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;PATHå˜é‡å·²æ·»åŠ &quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹-root-å¯†ç "><a href="#ä¿®æ”¹-root-å¯†ç " class="headerlink" title="ä¿®æ”¹ root å¯†ç "></a>ä¿®æ”¹ root å¯†ç </h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;Vb6CAEJqqtcmKndiAkEl&#x27;</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;Vb6CAEJqqtcmKndiAkEl&#x27;</span>;</span><br><span class="line"><span class="keyword">Grant</span> <span class="keyword">all</span> privileges <span class="keyword">on</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">to</span> <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;%&#x27;</span> <span class="keyword">with</span> <span class="keyword">grant</span> option;</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹ç¼–è¯‘å‚æ•°"><a href="#æŸ¥çœ‹ç¼–è¯‘å‚æ•°" class="headerlink" title="æŸ¥çœ‹ç¼–è¯‘å‚æ•°"></a>æŸ¥çœ‹ç¼–è¯‘å‚æ•°</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /user/local/mysql/bin/mysqlbug |grep configure</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Prometheusæ‰‹åŠ¨æ‰“æ ‡ç­¾</title>
      <link href="/posts/ac395656/"/>
      <url>/posts/ac395656/</url>
      
        <content type="html"><![CDATA[<p>æœ‰æ—¶å€™éœ€è¦ç»™ Prometheus æ‰“æ ‡ç­¾ï¼Œæ¯”å¦‚è¯´è”é‚¦é›†ç¾¤æ¥å…¥ï¼Œéœ€è¦çŸ¥é“æ˜¯å“ªä¸ªé›†ç¾¤ï¼Œremote write å†™å…¥çš„æ—¶å€™ä¹Ÿéœ€è¦åšä¸ªæ ‡è®°ã€‚</p><h2 id="ç›´æ¥åœ¨é›†ç¾¤æ‰“æ ‡ç­¾"><a href="#ç›´æ¥åœ¨é›†ç¾¤æ‰“æ ‡ç­¾" class="headerlink" title="ç›´æ¥åœ¨é›†ç¾¤æ‰“æ ‡ç­¾"></a>ç›´æ¥åœ¨é›†ç¾¤æ‰“æ ‡ç­¾</h2><p>vim prometheus.yml</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">global:</span></span><br><span class="line">  <span class="attr">scrape_interval:</span> <span class="string">15s</span> <span class="comment"># Set the scrape interval to every 15 seconds. Default is every 1 minute.</span></span><br><span class="line">  <span class="attr">evaluation_interval:</span> <span class="string">15s</span> <span class="comment"># Evaluate rules every 15 seconds. The default is every 1 minute.</span></span><br><span class="line">  <span class="comment"># scrape_timeout is set to the global default (10s).</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">external_labels:</span></span><br><span class="line">    <span class="attr">env:</span> <span class="string">uat</span></span><br><span class="line">    <span class="attr">dept:</span> <span class="string">ops</span></span><br><span class="line">    <span class="attr">project:</span> <span class="string">xxx</span></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±å¯ä»¥ç»™é›†ç¾¤å†…çš„æ‰€æœ‰ metrics æ‰“ä¸Šè¿™ä¸‰ä¸ªæ ‡ç­¾ã€‚</p><h2 id="é€šè¿‡è”é‚¦é›†ç¾¤æ‰“æ ‡ç­¾"><a href="#é€šè¿‡è”é‚¦é›†ç¾¤æ‰“æ ‡ç­¾" class="headerlink" title="é€šè¿‡è”é‚¦é›†ç¾¤æ‰“æ ‡ç­¾"></a>é€šè¿‡è”é‚¦é›†ç¾¤æ‰“æ ‡ç­¾</h2><p>å¦‚æœé›†ç¾¤ä¸å¥½è¿›è¡Œæ“ä½œï¼Œå¯ä»¥é€šè¿‡è”é‚¦é›†ç¾¤æ¥å…¥ï¼Œåœ¨è”é‚¦ä¸»èŠ‚ç‚¹è¿›è¡Œé…ç½®</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">global:</span></span><br><span class="line">  <span class="attr">scrape_interval:</span> <span class="string">15s</span></span><br><span class="line">  <span class="attr">evaluation_interval:</span> <span class="string">15s</span></span><br><span class="line">  <span class="attr">scrape_timeout:</span> <span class="string">10s</span></span><br><span class="line"></span><br><span class="line"><span class="attr">scrape_configs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;federate-https&#x27;</span></span><br><span class="line">    <span class="attr">scrape_interval:</span> <span class="string">15s</span></span><br><span class="line">    <span class="attr">scrape_timeout:</span> <span class="string">15s</span></span><br><span class="line">    <span class="attr">honor_labels:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">metrics_path:</span> <span class="string">&#x27;/federate&#x27;</span></span><br><span class="line">    <span class="attr">scheme:</span> <span class="string">https</span></span><br><span class="line">    <span class="attr">params:</span></span><br><span class="line">      <span class="string">&#x27;match[]&#x27;</span><span class="string">:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&#x27;&#123;job=~&quot;.+&quot;&#125;&#x27;</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">targets:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&#x27;10.0.0.11:9090&#x27;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&#x27;10.0.0.12:9090&#x27;</span></span><br><span class="line">        <span class="attr">labels:</span></span><br><span class="line">          <span class="attr">env:</span> <span class="string">uat</span></span><br><span class="line">          <span class="attr">dept:</span> <span class="string">ops</span></span><br><span class="line">          <span class="attr">project:</span> <span class="string">xxx</span></span><br></pre></td></tr></table></figure><h2 id="ç»™æ¥å…¥çš„-target-æ‰“æ ‡ç­¾"><a href="#ç»™æ¥å…¥çš„-target-æ‰“æ ‡ç­¾" class="headerlink" title="ç»™æ¥å…¥çš„ target æ‰“æ ‡ç­¾"></a>ç»™æ¥å…¥çš„ target æ‰“æ ‡ç­¾</h2><blockquote><p>è¿™ç§åªæ˜¯ç»™å½“å‰è¿™ä¸ª target æ‰“æ ‡ç­¾ï¼Œä¸æ˜¯å…¨å±€ç”Ÿæ•ˆ</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">node_exporter</span></span><br><span class="line">  <span class="attr">honor_timestamps:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">scrape_interval:</span> <span class="string">5s</span></span><br><span class="line">  <span class="attr">scrape_timeout:</span> <span class="string">5s</span></span><br><span class="line">  <span class="attr">metrics_path:</span> <span class="string">/metrics</span></span><br><span class="line">  <span class="attr">scheme:</span> <span class="string">http</span></span><br><span class="line">  <span class="attr">follow_redirects:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">static_configs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">targets:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">10.0</span><span class="number">.0</span><span class="number">.17</span><span class="string">:9100</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">10.0</span><span class="number">.0</span><span class="number">.18</span><span class="string">:9100</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">10.0</span><span class="number">.0</span><span class="number">.19</span><span class="string">:9100</span></span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">env:</span> <span class="string">uat</span></span><br><span class="line">      <span class="attr">dept:</span> <span class="string">ops</span></span><br><span class="line">      <span class="attr">project:</span> <span class="string">xxx</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç›‘æ§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> prometheus </tag>
            
            <tag> Prometheus </tag>
            
            <tag> monitor </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŸºäºVictoriaMetricsçš„å¤§è§„æ¨¡ç›‘æ§å®æˆ˜</title>
      <link href="/posts/e59d8e32/"/>
      <url>/posts/e59d8e32/</url>
      
        <content type="html"><![CDATA[<p>victoriametrics åŸç”Ÿæ”¯æŒæ°´å¹³æ‰©å±•ï¼Œå¹¶ä¸”å¤§éƒ¨åˆ†å…¼å®¹ Prometheus è¯­æ³•ï¼Œå®˜æ–¹æ–‡æ¡£åœ°å€ï¼š<a href="https://docs.victoriametrics.com/">https://docs.victoriametrics.com/</a></p><p>è¿™ä¸ªæ˜¯ victoriametrics å®˜æ–¹çš„é›†ç¾¤æ¶æ„</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/20220617162704.png" alt="victoriametricsé›†ç¾¤æ¶æ„"></p><p>æˆ‘å…¬å¸ç”¨åˆ°çš„é›†ç¾¤æ¶æ„</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202206182239511.png" alt="æˆ‘å…¬å¸ç”¨åˆ°çš„é›†ç¾¤"></p><p>ç›®å‰ç”¨åˆ° 3 å°æœºå™¨</p><table><thead><tr><th>IP</th><th>éƒ¨ç½²çš„æœåŠ¡</th></tr></thead><tbody><tr><td>10.0.0.21</td><td>vmauthã€vmselectã€vminsertã€vmstorageã€vmalert</td></tr><tr><td>10.0.0.22</td><td>vmselectã€vminsertã€vmstorage</td></tr><tr><td>10.0.0.23</td><td>vmselectã€vminsertã€vmstorage</td></tr></tbody></table><h2 id="vmstorage"><a href="#vmstorage" class="headerlink" title="vmstorage"></a>vmstorage</h2><p>é¦–å…ˆéœ€è¦æŠŠå­˜å‚¨éƒ¨ç½²ä¸Šï¼Œå¤šä¸ªå­˜å‚¨ä¹‹é—´æ•°æ®æ˜¯ä¸åŒæ­¥çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æ‰€æœ‰çš„ storege ç»„ä»¶ä¹‹é—´æ˜¯æ„ŸçŸ¥ä¸åˆ°å½¼æ­¤çš„ã€‚é€šè¿‡ vmselect å’Œ vminsert é‡‡ç”¨ä¸€è‡´æ€§ hash ç®—æ³•æ¥ç¡®å®šè¯»å–&#x2F;å†™å…¥å“ªå°èŠ‚ç‚¹ã€‚</p><p>vmstorage å¯åŠ¨å‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">./vmstorage-prod -httpListenAddr <span class="string">&quot;0.0.0.0:8482&quot;</span> \   <span class="comment"># vmstorageç›‘å¬ç«¯å£</span></span><br><span class="line">    -storageDataPath ./data \                       <span class="comment"># æ•°æ®å­˜å‚¨ä½ç½®</span></span><br><span class="line">    -retentionPeriod 60d \                          <span class="comment"># æ•°æ®ä¿ç•™å¤šä¹…</span></span><br><span class="line">    -vminsertAddr <span class="string">&quot;0.0.0.0:8400&quot;</span> \                  <span class="comment"># insertæœåŠ¡è¿æ¥çš„ç«¯å£</span></span><br><span class="line">    -vmselectAddr <span class="string">&quot;0.0.0.0:8401&quot;</span> \                  <span class="comment"># selectæœåŠ¡è¿æ¥çš„ç«¯å£</span></span><br><span class="line">    -dedup.minScrapeInterval=30s \                  <span class="comment"># å’Œvmselectä¿æŒä¸€è‡´</span></span><br><span class="line">    -loggerTimezone <span class="string">&quot;Asia/Shanghai&quot;</span> \</span><br><span class="line">    -loggerLevel INFO</span><br></pre></td></tr></table></figure><h2 id="vminsert"><a href="#vminsert" class="headerlink" title="vminsert"></a>vminsert</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">./vminsert-prod -httpListenAddr <span class="string">&quot;0.0.0.0:8480&quot;</span> \</span><br><span class="line">    -storageNode 10.0.0.21:8400,10.0.0.22:8400,10.0.0.23:8400 \       <span class="comment"># æŒ‡å®šæ‰€æœ‰storegeèŠ‚ç‚¹</span></span><br><span class="line">    -replicationFactor 2 \                                                  <span class="comment"># å‰¯æœ¬æ•°2</span></span><br><span class="line">    -loggerTimezone<span class="string">&quot;Asia/Shanghai&quot;</span> \</span><br><span class="line">    -loggerLevel INFO</span><br></pre></td></tr></table></figure><h2 id="vmselect"><a href="#vmselect" class="headerlink" title="vmselect"></a>vmselect</h2><p>vmselect å¯åŠ¨å‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">./vmselect-prod -httpListenAddr <span class="string">&quot;0.0.0.0:8481&quot;</span> \</span><br><span class="line">    -selectNode 10.0.0.21:8481,10.0.0.22:8481,10.0.0.23:8481 \    <span class="comment"># selectçš„æ‰€æœ‰èŠ‚ç‚¹</span></span><br><span class="line">    -storageNode 10.0.0.21:8401,10.0.0.22:8401,10.0.0.23:8401 \   <span class="comment"># æŒ‡å®šæ‰€æœ‰storageèŠ‚ç‚¹</span></span><br><span class="line">    -dedup.minScrapeInterval=30s \                                      <span class="comment"># é‡å¤æ•°æ®åˆ é™¤ï¼Œå¦‚æœæ˜¯ä»Prometheuså†™å…¥çš„è¯ï¼Œå¿…é¡»å’ŒPrometheusçš„scrape_intervalä¿æŒä¸€è‡´ã€‚</span></span><br><span class="line">    -loggerTimezone <span class="string">&quot;Asia/Shanghai&quot;</span> \</span><br><span class="line">    -loggerLevel INFO</span><br></pre></td></tr></table></figure><h2 id="vmalert"><a href="#vmalert" class="headerlink" title="vmalert"></a>vmalert</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">./vmalert-prod -rule=./rules/* \                            <span class="comment"># å‘Šè­¦è§„åˆ™ç›®å½•</span></span><br><span class="line">    -datasource.url=http://10.0.0.21:8427 \               <span class="comment"># vmselectçš„url,ä¸€èˆ¬éƒ½æ˜¯è´Ÿè½½å‡è¡¡åœ°å€</span></span><br><span class="line">    -datasource.basicAuth.username admin \                  <span class="comment"># vmselectçš„urlè®¤è¯ç”¨æˆ·å</span></span><br><span class="line">    -datasource.basicAuth.password 123456 \                <span class="comment"># vmselectçš„urlè®¤è¯å¯†ç </span></span><br><span class="line">    -notifier.url=http://10.0.0.11:9093 \                 <span class="comment"># alertmanageråœ°å€</span></span><br><span class="line">    -remoteWrite.url=http://10.0.0.21:8427 \              <span class="comment"># vminsertçš„url,ä¸€èˆ¬éƒ½æ˜¯è´Ÿè½½å‡è¡¡åœ°å€</span></span><br><span class="line">    -remoteWrite.basicAuth.username admin \                 <span class="comment"># vminsertçš„urlè®¤è¯ç”¨æˆ·å</span></span><br><span class="line">    -remoteWrite.basicAuth.password 123456 \               <span class="comment"># vminsertçš„urlè®¤è¯å¯†ç </span></span><br><span class="line">    -evaluationInterval=15s \</span><br><span class="line">    -httpListenAddr=0.0.0.0:8080</span><br></pre></td></tr></table></figure><h2 id="è´Ÿè½½å‡è¡¡é…ç½®"><a href="#è´Ÿè½½å‡è¡¡é…ç½®" class="headerlink" title="è´Ÿè½½å‡è¡¡é…ç½®"></a>è´Ÿè½½å‡è¡¡é…ç½®</h2><h3 id="vmauth-è´Ÿè½½å‡è¡¡é…ç½®"><a href="#vmauth-è´Ÿè½½å‡è¡¡é…ç½®" class="headerlink" title="vmauth è´Ÿè½½å‡è¡¡é…ç½®"></a>vmauth è´Ÿè½½å‡è¡¡é…ç½®</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./vmauth-prod -auth.config=./vmauth.yml</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ vmauth.yml çš„é…ç½®</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">users:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">username:</span> <span class="string">&quot;admin&quot;</span></span><br><span class="line">  <span class="attr">password:</span> <span class="string">&quot;123456&quot;</span></span><br><span class="line">  <span class="attr">url_map:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">src_paths:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;/api/v1/query&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;/api/v1/query_range&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;/api/v1/label/[^/]+/values&quot;</span></span><br><span class="line">    <span class="attr">url_prefix:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;http://10.0.0.21:8481/select/0/prometheus&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;http://10.0.0.22:8481/select/0/prometheus&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;http://10.0.0.23:8481/select/0/prometheus&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">src_paths:</span> [<span class="string">&quot;/api/v1/write&quot;</span>]</span><br><span class="line">    <span class="attr">url_prefix:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;http://10.0.0.21:8480/insert/0/prometheus&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;http://10.0.0.22:8480/insert/0/prometheus&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;http://10.0.0.23:8480/insert/0/prometheus&quot;</span></span><br><span class="line"><span class="comment">#    headers:</span></span><br><span class="line"><span class="comment">#    - &quot;X-Scope-OrgID: abc&quot;</span></span><br></pre></td></tr></table></figure><h3 id="nginx-è´Ÿè½½å‡è¡¡é…ç½®"><a href="#nginx-è´Ÿè½½å‡è¡¡é…ç½®" class="headerlink" title="nginx è´Ÿè½½å‡è¡¡é…ç½®"></a>nginx è´Ÿè½½å‡è¡¡é…ç½®</h3><p>å¦‚æœä½ ä¸æƒ³ç”¨ vmauthï¼Œnginx åŠŸèƒ½å¯ä»¥å®Œå…¨è¦†ç›– vmauth</p><p>nginx é…ç½®ç¤ºä¾‹ï¼š</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">upstream  vmselect &#123;</span><br><span class="line">    server  10.0.0.21:8481 weight=5 ;</span><br><span class="line">    server  10.0.0.22:8481 weight=5 ;</span><br><span class="line">    server  10.0.0.23:8481 weight=5 ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen 8000;</span><br><span class="line">    server_name _;</span><br><span class="line">    auth_basic &quot;authentication&quot;;                # å¼€å¯åŸºæœ¬è®¤è¯</span><br><span class="line">    auth_basic_user_file conf.d/.htpasswd;      # å¯†ç æ–‡ä»¶</span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_pass http://vmselect/select/0/prometheus/;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">upstream vminsert &#123;</span><br><span class="line">    server  10.0.0.21:8480 weight=5 ;</span><br><span class="line">    server  10.0.0.22:8480 weight=5 ;</span><br><span class="line">    server  10.0.0.23:8480 weight=5 ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen 8001;</span><br><span class="line">    server_name _;</span><br><span class="line">    auth_basic &quot;authentication&quot;;                # å¼€å¯åŸºæœ¬è®¤è¯</span><br><span class="line">    auth_basic_user_file conf.d/.htpasswd;      # å¯†ç æ–‡ä»¶</span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_pass http://vminsert/insert/0/prometheus/;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>.htpasswd æ–‡ä»¶æ ¼å¼ï¼š</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin:$1$QYnl4A1Q$I8Q712.eKtG9m7sAb9oeM1</span><br></pre></td></tr></table></figure><blockquote><p>admin æ˜¯ç”¨æˆ·å, : åé¢çš„æ˜¯å¯†ç ï¼Œ å¯†ç å¯ä»¥ä½¿ç”¨ <code>openssl passwd -1 123456</code> æ¥ç”Ÿæˆï¼ˆå‡è®¾åŸå§‹å¯†ç æ˜¯ 123456ï¼‰</p></blockquote><h2 id="å¸¸ç”¨çš„é…ç½®"><a href="#å¸¸ç”¨çš„é…ç½®" class="headerlink" title="å¸¸ç”¨çš„é…ç½®"></a>å¸¸ç”¨çš„é…ç½®</h2><h3 id="Prometheus-é€šè¿‡-remote-write-å†™å…¥-vm-é›†ç¾¤"><a href="#Prometheus-é€šè¿‡-remote-write-å†™å…¥-vm-é›†ç¾¤" class="headerlink" title="Prometheus é€šè¿‡ remote_write å†™å…¥ vm é›†ç¾¤"></a>Prometheus é€šè¿‡ remote_write å†™å…¥ vm é›†ç¾¤</h3><blockquote><p>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://prometheus.io/docs/prometheus/latest/configuration/configuration/#remote_write">https://prometheus.io/docs/prometheus/latest/configuration/configuration/#remote_write</a></p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">remote_write:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">url:</span> <span class="string">&quot;http://10.0.0.21:8001/api/v1/write&quot;</span>                           <span class="comment"># é€šè¿‡è´Ÿè½½å‡è¡¡åœ°å€</span></span><br><span class="line"><span class="comment"># - url: &quot;http://10.0.0.21:8480/insert/0/prometheus/api/v1/write&quot;     # ç›´æ¥è¿æ¥vminsertç»„ä»¶</span></span><br><span class="line">  <span class="attr">basic_auth:</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">admin</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">  <span class="attr">remote_timeout:</span> <span class="string">30s</span></span><br><span class="line">  <span class="attr">tls_config:</span></span><br><span class="line">    <span class="attr">insecure_skip_verify:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">queue_config:</span></span><br><span class="line">    <span class="attr">capacity:</span> <span class="number">2500</span></span><br><span class="line">    <span class="attr">max_shards:</span> <span class="number">200</span></span><br><span class="line">    <span class="attr">min_shards:</span> <span class="number">1</span></span><br><span class="line">    <span class="attr">max_samples_per_send:</span> <span class="number">500</span></span><br><span class="line">    <span class="attr">batch_send_deadline:</span> <span class="string">5s</span></span><br><span class="line">    <span class="attr">min_backoff:</span> <span class="string">30ms</span></span><br><span class="line">    <span class="attr">max_backoff:</span> <span class="string">5s</span></span><br></pre></td></tr></table></figure><p>å‚æ•°è¯´æ˜ï¼š</p><blockquote><p>å®˜æ–¹åœ°å€ï¼š<a href="https://prometheus.io/docs/practices/remote_write/">https://prometheus.io/docs/practices/remote_write/</a></p></blockquote><ul><li><p>capacity</p><p>  å®šä¹‰ï¼šæ¯ä¸ªå†…å­˜é˜Ÿåˆ—ï¼ˆshardï¼šåˆ†ç‰‡ï¼‰çš„å®¹é‡ã€‚</p><p>  ä¸€æ—¦ WAL è¢«é˜»å¡ï¼Œå°±æ— æ³•å°†æ ·æœ¬é™„åŠ åˆ°ä»»ä½•åˆ†ç‰‡ï¼Œå¹¶ä¸”æ‰€æœ‰ååé‡éƒ½å°†åœæ­¢ã€‚æ‰€ä»¥åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå•ä¸ªé˜Ÿåˆ—å®¹é‡åº”è¶³å¤Ÿæ‰“ä»¥é¿å…é˜»å¡å…¶ä»–åˆ†ç‰‡ï¼Œä½†æ˜¯å¤ªå¤§çš„å®¹é‡å¯èƒ½ä¼šå¯¼è‡´è¿‡å¤šçš„å†…å­˜æ¶ˆè€—ï¼Œå¹¶å¯¼è‡´é‡æ–°åˆ†ç‰‡æœŸé—´æ¸…é™¤é˜Ÿåˆ—çš„æ—¶é—´æ›´é•¿ã€‚</p><p>  å®¹é‡å»ºè®®ï¼šå°†å®¹é‡è®¾ç½®ä¸º 3-10 å€ <code>max_samples_per_send</code></p></li><li><p>max_shards</p><p>  é¡¾åæ€ä¹‰ï¼Œæœ€å¤§çš„åˆ†ç‰‡æ•°ï¼ˆå³é˜Ÿåˆ—æ•°ï¼‰ï¼Œä¹Ÿå¯ä»¥ç†è§£ä¸ºè¿œç¨‹å†™çš„å¹¶è¡Œåº¦ã€‚peometheus è¿œç¨‹å†™çš„æ—¶å€™ä¼šä½¿ç”¨æ‰€æœ‰çš„åˆ†ç‰‡ï¼Œåªæœ‰åœ¨å†™é˜Ÿåˆ—è½åäºè¿œç¨‹å†™çš„é€Ÿåº¦ï¼Œä½¿ç”¨çš„é˜Ÿåˆ—æ•°ä¼šè¾¾åˆ° max_shards,ç›®çš„åœ¨äºæé«˜è¿œç¨‹å†™çš„ååé‡ã€‚</p><p>  PSï¼šåœ¨æ“ä½œè¿‡ç¨‹ä¸­ï¼ŒPrometheus å°†æ ¹æ®ä¼ å…¥çš„é‡‡æ ·ç‡ï¼Œæœªå‘é€çš„æœªå¤„ç†æ ·æœ¬æ•°ä»¥åŠå‘é€æ¯ä¸ªæ ·æœ¬æ‰€èŠ±è´¹çš„æ—¶é—´ï¼Œè¿ç»­è®¡ç®—è¦ä½¿ç”¨çš„æœ€ä½³åˆ†ç‰‡æ•°ã€‚ï¼ˆå®é™…çš„åˆ†ç‰‡æ•°æ˜¯åŠ¨æ€è°ƒæ•´çš„ï¼‰</p></li><li><p>min_shards</p><p>  æœ€å°åˆ†ç‰‡é…ç½® Prometheus ä½¿ç”¨çš„æœ€å°åˆ†ç‰‡æ•°é‡ï¼Œå¹¶ä¸”æ˜¯è¿œç¨‹å†™å…¥å¼€å§‹æ—¶ä½¿ç”¨çš„åˆ†ç‰‡æ•°é‡ã€‚å¦‚æœè¿œç¨‹å†™å…¥è½åï¼ŒPrometheus å°†è‡ªåŠ¨æ‰©å¤§åˆ†ç‰‡çš„æ•°é‡ï¼Œå› æ­¤å¤§å¤šæ•°ç”¨æˆ·ä¸å¿…è°ƒæ•´æ­¤å‚æ•°ã€‚ä½†æ˜¯ï¼Œå¢åŠ æœ€å°åˆ†ç‰‡æ•°å°†ä½¿ Prometheus åœ¨è®¡ç®—æ‰€éœ€åˆ†ç‰‡æ•°æ—¶é¿å…åœ¨ä¸€å¼€å§‹å°±è½åã€‚</p></li><li><p>max_samples_per_send</p><p>  å®šä¹‰ï¼šæ¯æ¬¡è¿œç¨‹å†™å‘é€çš„æœ€å¤§æŒ‡æ ‡æ•°é‡ï¼Œå³æ‰¹å¤„ç†ï¼›</p><p>  è¿™ä¸ªå€¼ä¾èµ–äºè¿œç¨‹å­˜å‚¨ç³»ç»Ÿï¼Œå¯¹äºä¸€äº›ç³»ç»Ÿè€Œè¨€ï¼Œåœ¨æ²¡æœ‰æ˜¾è‘—å¢åŠ å»¶è¿Ÿçš„æƒ…å†µä¸‹å‘é€æ›´å¤šæŒ‡æ ‡æ•°æ®è€Œè¿è¡Œè‰¯å¥½ï¼Œç„¶è€Œï¼Œå¯¹äºå¦å¤–ä¸€äº›ç³»ç»Ÿè€Œè¨€ï¼Œæ¯æ¬¡è¯·æ±‚ä¸­å‘é€å¤§é‡æŒ‡æ ‡æ•°æ®å¯èƒ½å¯¼è‡´å…¶å‡ºç°æ•…éšœï¼Œä½¿ç”¨çš„é»˜è®¤å€¼æ˜¯é€‚ç”¨äºç»å¤§å¤šæ•°ç³»ç»Ÿçš„ã€‚</p></li><li><p>batch_send_deadline</p><p>  å®šä¹‰ï¼šå•ä¸€åˆ†ç‰‡æ‰¹é‡å‘é€æŒ‡æ ‡æ•°æ®çš„æœ€å¤§ç­‰å¾…æ—¶é—´ï¼›</p><p>  å³ä½¿æ’é˜Ÿçš„åˆ†ç‰‡å°šæœªè¾¾åˆ° max_samples_per_sendï¼Œä¹Ÿä¼šå‘é€è¯·æ±‚ã€‚ å¯¹äºå¯¹å»¶è¿Ÿä¸æ•æ„Ÿçš„å°æ‰¹é‡ç³»ç»Ÿï¼Œå¯ä»¥å¢åŠ æ‰¹é‡å‘é€çš„æˆªæ­¢æ—¶é—´ï¼Œä»¥æé«˜è¯·æ±‚æ•ˆç‡ã€‚</p></li><li><p>min_backoff</p><p>  å®šä¹‰ï¼šè¿œç¨‹å†™å¤±è´¥çš„æœ€å°ç­‰å¾…æ—¶é—´ï¼›</p><p>  min_backoff æ˜¯ç¬¬ä¸€æ¬¡çš„é‡è¯•ç­‰å¾…æ—¶é—´ï¼Œç¬¬äºŒæ¬¡ç­‰å¾…æ—¶é—´æ˜¯å…¶ 2 å€ï¼Œä»¥æ­¤ç±»æ¨ï¼Œç›´åˆ° max_backoff çš„å€¼ï¼›</p></li><li><p>max_backoff</p><p>  å®šä¹‰ï¼šè¿œç¨‹å†™å¤±è´¥çš„æœ€å¤§ç­‰å¾…æ—¶é—´ï¼›</p></li></ul><h3 id="Grafana-ç›´æ¥æŸ¥è¯¢-VM-é›†ç¾¤"><a href="#Grafana-ç›´æ¥æŸ¥è¯¢-VM-é›†ç¾¤" class="headerlink" title="Grafana ç›´æ¥æŸ¥è¯¢ VM é›†ç¾¤"></a>Grafana ç›´æ¥æŸ¥è¯¢ VM é›†ç¾¤</h3><p>Grafana é…ç½®åœ°å€ï¼š</p><table><thead><tr><th>è¯´æ˜</th><th>åœ°å€</th></tr></thead><tbody><tr><td>è´Ÿè½½å‡è¡¡åœ°å€</td><td><code>http://10.0.0.21:8000</code></td></tr><tr><td>vmselect åœ°å€</td><td><code>http://10.0.0.21:8481/select/0/prometheus</code></td></tr></tbody></table><h3 id="å…¶ä»–-API-åœ°å€"><a href="#å…¶ä»–-API-åœ°å€" class="headerlink" title="å…¶ä»– API åœ°å€"></a>å…¶ä»– API åœ°å€</h3><p>ç›®å½•ï¼š<a href="http://10.0.0.21:8481/select/0/">http://10.0.0.21:8481/select/0/</a></p><p>vmuiï¼š<a href="http://10.0.0.21:8481/select/0/vmui/">http://10.0.0.21:8481/select/0/vmui/</a></p><p>æ¯ä¸ªç»„ä»¶éƒ½æœ‰ <code>/metrics</code>ï¼Œå¯ä»¥æ¥å…¥ç›‘æ§</p>]]></content>
      
      
      <categories>
          
          <category> ç›‘æ§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
            <tag> prometheus </tag>
            
            <tag> monitor </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨Keepalivedæ¥å®ç°Nginxé«˜å¯ç”¨</title>
      <link href="/posts/0cebb8ae/"/>
      <url>/posts/0cebb8ae/</url>
      
        <content type="html"><![CDATA[<p>å…¬æœ‰äº‘ä¸ä¼šè€ƒè™‘è¿™äº›ï¼Œä¸è¿‡è‡ªå»ºæœºæˆ¿ï¼Œä½¿ç”¨ nginx åšå…¥å£ï¼Œkeepalived æ˜¯å”¯ä¸€çš„é€‰æ‹©ã€‚</p><table><thead><tr><th>èŠ‚ç‚¹</th><th>IP</th></tr></thead><tbody><tr><td>keepalived ä¸»</td><td>10.0.0.45</td></tr><tr><td>keepalived å¤‡</td><td>10.0.0.44</td></tr><tr><td>vip</td><td>10.0.0.46</td></tr></tbody></table><h2 id="ç»„æ’­æ¨¡å¼"><a href="#ç»„æ’­æ¨¡å¼" class="headerlink" title="ç»„æ’­æ¨¡å¼"></a>ç»„æ’­æ¨¡å¼</h2><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">keepalived1</button><button type="button" class="tab">keepalived2</button></div><div class="tab-contents"><div class="tab-item-content active"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">global_defs &#123;</span><br><span class="line">    script_user root            # è„šæœ¬æ‰§è¡Œè€…</span><br><span class="line">    enable_script_security      # æ ‡è®°è„šæœ¬å®‰å…¨</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_script check_script &#123;</span><br><span class="line">    script &quot;killall -0 nginx&quot;          # è„šæœ¬è·¯å¾„, è¿”å›å€¼ä¸º0åˆ™æ­£å¸¸ï¼Œä¸ä¸º0è®¤ä¸ºä¸æ­£å¸¸</span><br><span class="line">    # å¯æ›¿ä»£çš„å‘½ä»¤:</span><br><span class="line">    # /usr/sbin/pidof nginx             è¿™ä¸ªå‘½ä»¤ä¸æ¨è, å¤šä¸ªè¿›ç¨‹pidä¼šå‡ºé—®é¢˜</span><br><span class="line">    # pgrep nginx                       ç±»ä¼¼äºpidof nginx è¿”å›çš„æ˜¯pid</span><br><span class="line">    interval 2                              # è„šæœ¬æ‰§è¡Œé—´éš”ï¼Œå•ä½s</span><br><span class="line">    weight -20                              # -254-254ä¹‹é—´ï¼Œæ£€æµ‹å¤±è´¥æƒé‡å‡å°‘</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance VI_1 &#123;                        # å®ä¾‹å</span><br><span class="line">    state MASTER                            # å½“å‰keepalivedçŠ¶æ€</span><br><span class="line">    interface eth0</span><br><span class="line">    virtual_router_id 251                   # ç»„æ’­IDä¸»å¤‡éœ€ä¸€è‡´ï¼Œå•æ’­æ— æ‰€è°“</span><br><span class="line">    priority 100                            # é»˜è®¤æƒé‡</span><br><span class="line">    advert_int 1                            # å‘é€VRRPé€šå‘Šé—´éš”ï¼Œå•ä½s</span><br><span class="line">    # nopreempt                             # è®¾ç½®éæŠ¢å æ¨¡å¼ï¼ŒåŸæœ¬é«˜ä¼˜å…ˆçº§çš„MASERæ¢å¤ä¹‹åï¼Œä¸ä¼šå»æŠ¢ç°åœ¨æ˜¯ä½ä¼˜å…ˆçº§BACKUP, è¿™é¡¹é…ç½®åªæœ‰åœ¨ä¸¤å°éƒ½é…ç½®ä¸ºstate backupæ‰æœ‰ç”¨ã€‚</span><br><span class="line"></span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS                      # ä¸»å¤‡éªŒè¯ä¿¡æ¯ï¼Œéœ€ä¸€è‡´</span><br><span class="line">        auth_pass 123456 </span><br><span class="line">    &#125;</span><br><span class="line">    track_script &#123;</span><br><span class="line">        check_script                        # è°ƒç”¨è„šæœ¬,è‹¥è„šæœ¬æœ€åçš„æ‰§è¡Œç»“æœæ˜¯é0çš„ï¼Œåˆ™åˆ¤æ–­ç«¯å£downæ‰ï¼Œæ­¤æ—¶vipä¼šæ¼‚ç§»åˆ°keepalived-BACKUPä¸Š</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        10.0.0.46                       # vip</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">global_defs &#123;</span><br><span class="line">    script_user root</span><br><span class="line">    enable_script_security</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_script check_script &#123;</span><br><span class="line">    script &quot;killall -0 nginx&quot;</span><br><span class="line">    interval 2</span><br><span class="line">    weight -20</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">    state BACKUP</span><br><span class="line">    interface eth0</span><br><span class="line">    virtual_router_id 251</span><br><span class="line">    priority 99</span><br><span class="line">    advert_int 1</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 123456</span><br><span class="line">    &#125;</span><br><span class="line">    track_script &#123;</span><br><span class="line">        check_script</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        10.0.0.46</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div><h2 id="å•æ’­æ¨¡å¼"><a href="#å•æ’­æ¨¡å¼" class="headerlink" title="å•æ’­æ¨¡å¼"></a>å•æ’­æ¨¡å¼</h2><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">keepalived1</button><button type="button" class="tab">keepalived2</button></div><div class="tab-contents"><div class="tab-item-content active"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">global_defs &#123;</span><br><span class="line">    script_user root            # è„šæœ¬æ‰§è¡Œè€…</span><br><span class="line">    enable_script_security      # æ ‡è®°è„šæœ¬å®‰å…¨</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_script check_script &#123;</span><br><span class="line">    script &quot;killall -0 nginx&quot;          # è„šæœ¬è·¯å¾„, è¿”å›å€¼ä¸º0åˆ™æ­£å¸¸ï¼Œä¸ä¸º0è®¤ä¸ºä¸æ­£å¸¸</span><br><span class="line">    interval 2                              # è„šæœ¬æ‰§è¡Œé—´éš”ï¼Œå•ä½s</span><br><span class="line">    weight -20                              # -254-254ä¹‹é—´ï¼Œæ£€æµ‹å¤±è´¥æƒé‡å‡å°‘, è¦å¤§äºé›†ç¾¤  æœ€å¤§ priority - æœ€å° priority</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance VI_1 &#123;                        # å®ä¾‹å</span><br><span class="line">    state MASTER                            # å½“å‰keepalivedçŠ¶æ€</span><br><span class="line">    interface eth0</span><br><span class="line">    virtual_router_id 251                   # ç»„æ’­IDä¸»å¤‡éœ€ä¸€è‡´ï¼Œå•æ’­æ— æ‰€è°“</span><br><span class="line">    priority 100                            # é»˜è®¤æƒé‡</span><br><span class="line">    advert_int 1                            # å‘é€VRRPé€šå‘Šé—´éš”ï¼Œå•ä½s</span><br><span class="line">    # nopreempt                             # è®¾ç½®éæŠ¢å æ¨¡å¼ï¼ŒåŸæœ¬é«˜ä¼˜å…ˆçº§çš„MASERæ¢å¤ä¹‹åï¼Œä¸ä¼šå»æŠ¢ç°åœ¨æ˜¯ä½ä¼˜å…ˆçº§BACKUP, è¿™é¡¹é…ç½®åªæœ‰åœ¨ä¸¤å°éƒ½é…ç½®ä¸ºstate backupæ‰æœ‰ç”¨ã€‚</span><br><span class="line"></span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS                      # ä¸»å¤‡éªŒè¯ä¿¡æ¯ï¼Œéœ€ä¸€è‡´</span><br><span class="line">        auth_pass 123456 </span><br><span class="line">    &#125;</span><br><span class="line">    track_script &#123;</span><br><span class="line">        check_script                        # è°ƒç”¨è„šæœ¬,è‹¥è„šæœ¬æœ€åçš„æ‰§è¡Œç»“æœæ˜¯é0çš„ï¼Œåˆ™åˆ¤æ–­ç«¯å£downæ‰ï¼Œæ­¤æ—¶vipä¼šæ¼‚ç§»åˆ°keepalived-BACKUPä¸Š</span><br><span class="line">    &#125;</span><br><span class="line">    unicast_src_ip 10.0.0.45            # é…ç½®æºåœ°å€çš„IPåœ°å€</span><br><span class="line">    unicast_peer &#123;</span><br><span class="line">       10.0.0.44                         # é…ç½®ä»èŠ‚ç‚¹çš„ç›®æ ‡IPåœ°å€</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        10.0.0.46                       # vip</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">global_defs &#123;</span><br><span class="line">    script_user root</span><br><span class="line">    enable_script_security</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_script check_script &#123;</span><br><span class="line">    script &quot;killall -0 nginx&quot;</span><br><span class="line">    interval 2</span><br><span class="line">    weight -20</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">    state BACKUP</span><br><span class="line">    interface eth0</span><br><span class="line">    virtual_router_id 251</span><br><span class="line">    priority 99</span><br><span class="line">    advert_int 1</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 123456</span><br><span class="line">    &#125;</span><br><span class="line">    track_script &#123;</span><br><span class="line">        check_script</span><br><span class="line">    &#125;</span><br><span class="line">    unicast_src_ip 10.0.0.44</span><br><span class="line">    unicast_peer &#123;</span><br><span class="line">       10.0.0.45</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        10.0.0.46</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div><h2 id="éæŠ¢å å¼è¯´æ˜"><a href="#éæŠ¢å å¼è¯´æ˜" class="headerlink" title="éæŠ¢å å¼è¯´æ˜"></a>éæŠ¢å å¼è¯´æ˜</h2><blockquote><p>æŠ¢å å¼ å’Œ éæŠ¢å å¼çš„åŒºåˆ«ï¼š æ¯”å¦‚ master1 é»˜è®¤çš„æƒé‡ï¼ˆpriorityï¼‰é«˜ï¼Œvip å½“å‰åœ¨ master1 ä¸Šï¼Œ master1 æŒ‚æ‰å vip ä¼šé£˜åˆ° master2 ä¸Šï¼Œé‚£ä¹ˆå¦‚æœ master1 æ¢å¤æ­£å¸¸äº†ï¼ŒæŠ¢å å¼ä¼šé‡æ–°å°† vip æŠ¢è¿‡æ¥ï¼Œå†æ¬¡ç»‘å®šåˆ° master1 ä¸Šï¼ŒéæŠ¢å å¼åˆ™ä¿æŒåœ¨ master2 ä¸Šï¼Œé™¤é master2 ä¹Ÿå‡ºé—®é¢˜ã€‚</p></blockquote><ul><li>å¿…é¡»éƒ½ä¸º BACKUP æ¨¡å¼ï¼Œå¦‚æœæœ‰ MASTERï¼Œé‚£ä¹ˆ MASTER ä¼šæŠ¢å </li><li>å¿…é¡»éƒ½é…ç½® nopreempt</li><li>å»æ‰ weight -20 é…ç½®ï¼Œ å› ä¸ºéæŠ¢å å¼è¿™ç§é…ç½®ï¼Œ é«˜ä¼˜å…ˆçº§çš„ä¸ä¼šå»æŠ¢å ä½ä¼˜å…ˆçº§çš„ VIPï¼Œ æ‰€ä»¥æ£€æµ‹å¤±è´¥é™ä½æƒé‡æ˜¯æ²¡æœ‰æ•ˆæœçš„ã€‚</li><li>é…ç½® <code>rise 1</code> å’Œ <code>fall 1</code> å«ä¹‰æ˜¯æ£€æµ‹å¤±è´¥çŠ¶æ€å˜æˆ fault</li></ul><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">keepalived1</button><button type="button" class="tab">keepalived2</button><button type="button" class="tab">keepalived3</button></div><div class="tab-contents"><div class="tab-item-content active"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">global_defs &#123;</span><br><span class="line">    script_user root</span><br><span class="line">    enable_script_security</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_script check &#123;</span><br><span class="line">    script &quot;pgrep nginx&quot;</span><br><span class="line">    interval 2</span><br><span class="line">    rise 1</span><br><span class="line">    fall 1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">    state  BACKUP</span><br><span class="line">    interface eth0</span><br><span class="line">    virtual_router_id 251</span><br><span class="line">    priority 100</span><br><span class="line">    nopreempt</span><br><span class="line"></span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 123456</span><br><span class="line">    &#125;</span><br><span class="line">    track_script &#123;</span><br><span class="line">        check</span><br><span class="line">    &#125;</span><br><span class="line">    unicast_src_ip 10.0.0.11</span><br><span class="line">    unicast_peer &#123;</span><br><span class="line">       10.0.0.12</span><br><span class="line">       10.0.0.13</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        10.0.0.10 dev eth0</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">global_defs &#123;</span><br><span class="line">    script_user root</span><br><span class="line">    enable_script_security</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_script check &#123;</span><br><span class="line">    script &quot;pgrep nginx&quot;</span><br><span class="line">    interval 2</span><br><span class="line">    rise 1</span><br><span class="line">    fall 1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">    state  BACKUP</span><br><span class="line">    interface eth0</span><br><span class="line">    virtual_router_id 251</span><br><span class="line">    priority 99</span><br><span class="line">    nopreempt</span><br><span class="line"></span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 123456</span><br><span class="line">    &#125;</span><br><span class="line">    track_script &#123;</span><br><span class="line">        check</span><br><span class="line">    &#125;</span><br><span class="line">    unicast_src_ip 10.0.0.12</span><br><span class="line">    unicast_peer &#123;</span><br><span class="line">       10.0.0.11</span><br><span class="line">       10.0.0.13</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        10.0.0.10 dev eth0</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">global_defs &#123;</span><br><span class="line">    script_user root</span><br><span class="line">    enable_script_security</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_script check &#123;</span><br><span class="line">    script &quot;pgrep nginx&quot;</span><br><span class="line">    interval 2</span><br><span class="line">    rise 1</span><br><span class="line">    fall 1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">    state  BACKUP</span><br><span class="line">    interface eth0</span><br><span class="line">    virtual_router_id 251</span><br><span class="line">    priority 98</span><br><span class="line">    nopreempt</span><br><span class="line"></span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 123456</span><br><span class="line">    &#125;</span><br><span class="line">    track_script &#123;</span><br><span class="line">        check</span><br><span class="line">    &#125;</span><br><span class="line">    unicast_src_ip 10.0.0.13</span><br><span class="line">    unicast_peer &#123;</span><br><span class="line">       10.0.0.11</span><br><span class="line">       10.0.0.12</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        10.0.0.10 dev eth0</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div><h2 id="ä¸¤å°-Nginx-åŒæ­¥é…ç½®æ–‡ä»¶"><a href="#ä¸¤å°-Nginx-åŒæ­¥é…ç½®æ–‡ä»¶" class="headerlink" title="ä¸¤å° Nginx åŒæ­¥é…ç½®æ–‡ä»¶"></a>ä¸¤å° Nginx åŒæ­¥é…ç½®æ–‡ä»¶</h2><p>ä½¿ç”¨ crontab å®šæ—¶æ¯ 5 åˆ†é’Ÿæ‰§è¡Œè„šæœ¬ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">set</span> -ueo pipefail</span><br><span class="line"></span><br><span class="line">NGINX_CONF_LOCATION=<span class="string">&quot;/usr/local/nginx/conf/&quot;</span></span><br><span class="line">BACKUP_SERVER=<span class="string">&quot;root@10.0.0.44&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿™é‡Œæ˜¯æ‰§è¡ŒrsyncåŒæ­¥é…ç½®æ–‡ä»¶ï¼Œç„¶åæ‰“å°ç»“æœä¸­çš„ç¬¬äºŒè¡Œï¼ˆå¦‚æœæœ‰æ›´æ–°çš„æ–‡ä»¶ï¼Œç¬¬äºŒè¡Œä¸ä¸ºç©ºï¼‰</span></span><br><span class="line">rsync_result=$(rsync -av --delete <span class="variable">$&#123;NGINX_CONF_LOCATION&#125;</span> <span class="variable">$&#123;BACKUP_SERVER&#125;</span>:<span class="variable">$&#123;NGINX_CONF_LOCATION&#125;</span> | sed -n <span class="string">&quot;2p&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> [ -z <span class="variable">$&#123;rsync_result&#125;</span> ];<span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;the configuration file has not changed&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;changed nginx config, reload Backup Nginx&quot;</span></span><br><span class="line">  ssh <span class="variable">$&#123;BACKUP_SERVER&#125;</span> <span class="string">&quot;sudo /usr/local/nginx/sbin/nginx -s reload&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
            <tag> keepalived </tag>
            
            <tag> nginx </tag>
            
            <tag> HA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Prometheusé€šè¿‡remote_writeå†™å…¥æ•°æ®åˆ°å¦ä¸€å°Prometheus</title>
      <link href="/posts/666e547f/"/>
      <url>/posts/666e547f/</url>
      
        <content type="html"><![CDATA[<p>å‡è®¾ <code>Prometheus1</code> æ˜¯ä¸€ä¸ªé›†ç¾¤å†…çš„ <code>Prometheus</code>ï¼Œéœ€è¦è¿œç¨‹å†™å…¥æ•°æ®åˆ° <code>Prometheus_Core</code></p><h2 id="Prometheus-Core-å¼€å¯-remote-write-receiver"><a href="#Prometheus-Core-å¼€å¯-remote-write-receiver" class="headerlink" title="Prometheus_Core å¼€å¯ remote_write_receiver"></a>Prometheus_Core å¼€å¯ remote_write_receiver</h2><p><code>Prometheus_Core</code> éœ€è¦æ‰“å¼€æ¥æ”¶è¿œç¨‹å†™å…¥çš„åŠŸèƒ½ï¼Œé€šè¿‡å¢åŠ å¯åŠ¨å‚æ•° <code>--web.enable-remote-write-receiver</code>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./prometheus --web.enable-remote-write-receiver --web.config.file=web.yml --web.listen-address=0.0.0.0:9090</span><br></pre></td></tr></table></figure><blockquote><p>è¿œç¨‹å†™çš„æ¥å£åœ°å€ <code>/api/v1/write</code></p></blockquote><h2 id="Prometheus-Core-å¼€å¯è®¤è¯"><a href="#Prometheus-Core-å¼€å¯è®¤è¯" class="headerlink" title="Prometheus_Core å¼€å¯è®¤è¯"></a>Prometheus_Core å¼€å¯è®¤è¯</h2><p>å‚è€ƒ <a href="/posts/165a0cd3/">Prometheuså¼€å¯basic_authè®¤è¯</a></p><h2 id="Prometheus1-é…ç½®-remote-write"><a href="#Prometheus1-é…ç½®-remote-write" class="headerlink" title="Prometheus1 é…ç½® remote_write"></a>Prometheus1 é…ç½® remote_write</h2><p><code>Prometheus1</code> éœ€è¦å°† <code>remote_write</code> å†™å…¥åˆ° <code>Prometheus_Core</code> çš„è¿œç¨‹æ¥å£</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">remote_write:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">url:</span> <span class="string">&quot;http://127.0.0.1:9090/api/v1/write&quot;</span></span><br><span class="line">  <span class="attr">basic_auth:</span>                   <span class="comment"># å¼€å¯è®¤è¯åéœ€è¦é…ç½®</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">admin</span>             <span class="comment"># å¼€å¯è®¤è¯åéœ€è¦é…ç½®</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">xxxxxx</span>            <span class="comment"># å¼€å¯è®¤è¯åéœ€è¦é…ç½®</span></span><br><span class="line">  <span class="attr">remote_timeout:</span> <span class="string">30s</span></span><br><span class="line">  <span class="attr">tls_config:</span></span><br><span class="line">    <span class="attr">insecure_skip_verify:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">queue_config:</span></span><br><span class="line">    <span class="attr">capacity:</span> <span class="number">500</span></span><br><span class="line">    <span class="attr">max_shards:</span> <span class="number">1000</span></span><br><span class="line">    <span class="attr">min_shards:</span> <span class="number">1</span></span><br><span class="line">    <span class="attr">max_samples_per_send:</span> <span class="number">100</span></span><br><span class="line">    <span class="attr">batch_send_deadline:</span> <span class="string">5s</span></span><br><span class="line">    <span class="attr">min_backoff:</span> <span class="string">30ms</span></span><br><span class="line">    <span class="attr">max_backoff:</span> <span class="string">100ms</span></span><br></pre></td></tr></table></figure><h2 id="è¿œç¨‹å†™å¦‚ä½•åˆ¤æ–­ç›‘æ§æ˜¯å¦ç¦»çº¿"><a href="#è¿œç¨‹å†™å¦‚ä½•åˆ¤æ–­ç›‘æ§æ˜¯å¦ç¦»çº¿" class="headerlink" title="è¿œç¨‹å†™å¦‚ä½•åˆ¤æ–­ç›‘æ§æ˜¯å¦ç¦»çº¿"></a>è¿œç¨‹å†™å¦‚ä½•åˆ¤æ–­ç›‘æ§æ˜¯å¦ç¦»çº¿</h2><p>è¿œç¨‹å†™ä¸åƒè”é‚¦é›†ç¾¤ï¼Œè”é‚¦æ˜¯äº‹å…ˆé…ç½®å¥½çš„ï¼Œè¿œç¨‹å†™çš„æ–¹å¼ï¼Œè¢«å†™å…¥çš„ Prometheus æ˜¯æ— æ³•é¢„çŸ¥æ˜¯è°åœ¨å‘æˆ‘å‘é€æ•°æ®çš„ã€‚å¯ä»¥é€šè¿‡ absent å‡½æ•°æ¥å®ç°ã€‚</p><h3 id="æ”¶é›†-Prometheus-è‡ªèº«çš„ç›‘æ§æŒ‡æ ‡"><a href="#æ”¶é›†-Prometheus-è‡ªèº«çš„ç›‘æ§æŒ‡æ ‡" class="headerlink" title="æ”¶é›† Prometheus è‡ªèº«çš„ç›‘æ§æŒ‡æ ‡"></a>æ”¶é›† Prometheus è‡ªèº«çš„ç›‘æ§æŒ‡æ ‡</h3><p>æƒ³è¦ç›‘æ§ <code>Prometheus</code> çš„çŠ¶æ€ï¼Œåˆ™éœ€è¦æ”¶é›†è‡ªèº«çš„ç›‘æ§æŒ‡æ ‡ï¼ˆæ¯”å¦‚ <code>up</code> æŒ‡æ ‡ï¼‰ï¼Œç¡®ä¿ <code>Prometheus1</code> ä¸­æœ‰å¦‚ä¸‹é…ç½®ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">scrape_configs:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;prometheus&#x27;</span></span><br><span class="line">  <span class="attr">static_configs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;localhost:9090&#x27;</span>]</span><br></pre></td></tr></table></figure><p>åœ¨ <code>Prometheus_Core</code> çš„å‘Šè­¦é…ç½®ä¸­åšå¦‚ä¸‹é…ç½®ï¼Œå…¶ä¸­ <code>absent</code> åœ¨æŸ¥è¯¢ä¸åˆ°æ•°æ®çš„æƒ…å†µä¸‹è¿”å› <code>1</code>ï¼Œç”±äº <code>absent</code> è¿”å›çš„æ•°æ®ä¸å¸¦æ ‡ç­¾ï¼Œæ‰€ä»¥ç‹¬ç«‹å†™æˆä¸€æ¡å‘Šè­¦è§„åˆ™ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">groups:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Prometheus1æ¨é€å‘Šè­¦</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">alert:</span> <span class="string">&quot;Prometheus1æ¨é€ç¦»çº¿&quot;</span></span><br><span class="line">    <span class="attr">expr:</span> <span class="string">absent(up&#123;job=~&quot;prometheus&quot;,project=~&quot;prometheus1&quot;&#125;)</span> <span class="string">==</span> <span class="number">1</span></span><br><span class="line">    <span class="attr">for:</span> <span class="string">3m</span></span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">severity:</span> <span class="string">critical</span></span><br><span class="line">    <span class="attr">annotations:</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">&#x27;è¿œç¨‹å†™ Prometheus1 æ— æ•°æ®&#x27;</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">&quot;è¿œç¨‹å†™ Prometheus1 æ— æ•°æ®&quot;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç›‘æ§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> prometheus </tag>
            
            <tag> Prometheus </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Prometheuså¼€å¯basic_authè®¤è¯</title>
      <link href="/posts/165a0cd3/"/>
      <url>/posts/165a0cd3/</url>
      
        <content type="html"><![CDATA[<p>è€ƒè™‘å°†å…¬å¸çš„è”é‚¦é›†ç¾¤ï¼ˆpullï¼‰æ¢æˆ remote_writeï¼ˆpushï¼‰è¿™ç§å½¢å¼ï¼Œ æ‰€ä»¥éœ€è¦å°† Prometheus å¼€æ”¾åˆ°å…¬ç½‘ï¼Œçœ‹äº†çœ‹è®¤è¯ç›¸å…³çš„é…ç½®</p><p>ä¹Ÿå¯ä»¥ä½¿ç”¨ Nginx æ¥åå‘ä»£ç†ï¼Œå¯ä»¥å‚è€ƒ <a href="/posts/5855bc56">Nginxå¼€å¯åŸºæœ¬httpè®¤è¯</a>ï¼Œ ä¸è¿‡ Prometheus åŸç”Ÿå¸¦äº† basic auth å’Œ ssl è®¤è¯, å®˜ç½‘çš„è¯´æ˜<a href="https://prometheus.io/docs/guides/basic-auth/">https://prometheus.io/docs/guides/basic-auth/</a></p><h2 id="å¼€å¯-web-é…ç½®æ–‡ä»¶"><a href="#å¼€å¯-web-é…ç½®æ–‡ä»¶" class="headerlink" title="å¼€å¯ web é…ç½®æ–‡ä»¶"></a>å¼€å¯ web é…ç½®æ–‡ä»¶</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./prometheus --web.config.file=<span class="string">&quot;web.yml&quot;</span>  --web.listen-address=<span class="string">&quot;0.0.0.0:9001&quot;</span></span><br></pre></td></tr></table></figure><h2 id="ç”Ÿæˆå¯†ç "><a href="#ç”Ÿæˆå¯†ç " class="headerlink" title="ç”Ÿæˆå¯†ç "></a>ç”Ÿæˆå¯†ç </h2><p>å¯†ç éœ€è¦ bcrypt åŠ å¯†ï¼Œè¿™é‡Œä½¿ç”¨ <code>htpasswd</code> å·¥å…·ç”Ÿæˆ</p><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">Ubuntuå’ŒDebianå®‰è£…</button><button type="button" class="tab">CentOSå’ŒFedoraå®‰è£…</button></div><div class="tab-contents"><div class="tab-item-content active"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install apache2-utils</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install httpd-tools</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">htpasswd -nB <span class="string">&#x27;admin&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="web-é…ç½®æ–‡ä»¶"><a href="#web-é…ç½®æ–‡ä»¶" class="headerlink" title="web é…ç½®æ–‡ä»¶"></a>web é…ç½®æ–‡ä»¶</h2><p>vim web.yml</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">basic_auth_users:</span></span><br><span class="line">  <span class="attr">admin:</span> <span class="string">$2y$05$UKSS18ztdsUNoEuXYScr2OE1TCMe1hWnmD6JuwUi/uPTJayHIakae</span></span><br></pre></td></tr></table></figure><h3 id="éªŒè¯ä¸€ä¸‹é…ç½®"><a href="#éªŒè¯ä¸€ä¸‹é…ç½®" class="headerlink" title="éªŒè¯ä¸€ä¸‹é…ç½®"></a>éªŒè¯ä¸€ä¸‹é…ç½®</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">promtool check web-config web.yml</span><br></pre></td></tr></table></figure><h2 id="remote-write-è®¿é—®"><a href="#remote-write-è®¿é—®" class="headerlink" title="remote write è®¿é—®"></a>remote write è®¿é—®</h2><p>åé¢è®¿é—®æ§åˆ¶å°é¡µé¢æˆ–è€…è°ƒç”¨æ¥å£éƒ½éœ€è¦æŒ‡å®šè´¦å·å¯†ç äº†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -u admin:xxxxx http://localhost:9090</span><br></pre></td></tr></table></figure><p>å…¶ä»– Prometheus å¦‚æœéœ€è¦å¾€è¿™å°å†™å…¥ï¼Œ éœ€è¦åœ¨å…¶ä»–çš„ Prometheus remote_write é…ç½®è®¤è¯</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">remote_write:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">url:</span> <span class="string">&quot;http://127.0.0.1:9090/api/v1/write&quot;</span></span><br><span class="line">  <span class="attr">basic_auth:</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">admin</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">xxxxx</span></span><br><span class="line">  <span class="attr">remote_timeout:</span> <span class="string">30s</span></span><br><span class="line">  <span class="attr">tls_config:</span></span><br><span class="line">    <span class="attr">insecure_skip_verify:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">queue_config:</span></span><br><span class="line">    <span class="attr">capacity:</span> <span class="number">500</span></span><br><span class="line">    <span class="attr">max_shards:</span> <span class="number">1000</span></span><br><span class="line">    <span class="attr">min_shards:</span> <span class="number">1</span></span><br><span class="line">    <span class="attr">max_samples_per_send:</span> <span class="number">100</span></span><br><span class="line">    <span class="attr">batch_send_deadline:</span> <span class="string">5s</span></span><br><span class="line">    <span class="attr">min_backoff:</span> <span class="string">30ms</span></span><br><span class="line">    <span class="attr">max_backoff:</span> <span class="string">100ms</span></span><br></pre></td></tr></table></figure><h2 id="è”é‚¦é…ç½®"><a href="#è”é‚¦é…ç½®" class="headerlink" title="è”é‚¦é…ç½®"></a>è”é‚¦é…ç½®</h2><p>å¦‚æœæ­¤ Prometheus éœ€è¦é€šè¿‡è”é‚¦æœºåˆ¶æ¥å…¥åˆ°å…¶ä»– Prometheusï¼Œ éœ€è¦åœ¨å¯¹æ–¹çš„é…ç½®é‡Œé¢å¢åŠ ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;federate-http&#x27;</span></span><br><span class="line">  <span class="attr">scrape_interval:</span> <span class="string">30s</span></span><br><span class="line">  <span class="attr">scrape_timeout:</span> <span class="string">30s</span></span><br><span class="line">  <span class="attr">honor_labels:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">metrics_path:</span> <span class="string">&#x27;/federate&#x27;</span></span><br><span class="line">  <span class="attr">basic_auth:</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">&#x27;admin&#x27;</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">&#x27;xxxxx&#x27;</span></span><br><span class="line">  <span class="attr">params:</span></span><br><span class="line">    <span class="string">&#x27;match[]&#x27;</span><span class="string">:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;&#123;job=~&quot;.+&quot;&#125;&#x27;</span></span><br><span class="line">  <span class="attr">file_sd_configs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">files:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">/data/prometheus/conf.d/federate_http.yml</span></span><br><span class="line">      <span class="attr">refresh_interval:</span> <span class="string">30s</span></span><br></pre></td></tr></table></figure><h2 id="å¯ç”¨äº†-Basic-Auth-æ€ä¹ˆå¥åº·æ£€æŸ¥"><a href="#å¯ç”¨äº†-Basic-Auth-æ€ä¹ˆå¥åº·æ£€æŸ¥" class="headerlink" title="å¯ç”¨äº† Basic Auth æ€ä¹ˆå¥åº·æ£€æŸ¥"></a>å¯ç”¨äº† Basic Auth æ€ä¹ˆå¥åº·æ£€æŸ¥</h2><p>åœ¨ Kubernetes ç¯å¢ƒä¸‹ï¼Œé…ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç”Ÿæˆbase64çš„è´¦å·å¯†ç ç¼–ç </span></span><br><span class="line"><span class="built_in">echo</span> -n <span class="string">&quot;user:pass&quot;</span> |<span class="built_in">base64</span> -w0</span><br></pre></td></tr></table></figure><p>åœ¨ Liveness å’Œ Readness é…ç½®</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">httpGet:</span> </span><br><span class="line">  <span class="attr">httpHeaders:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Authorization</span></span><br><span class="line">    <span class="attr">value:</span> <span class="string">Basic</span> <span class="string">dXNlcjpwYXNz</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç›‘æ§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Auth </tag>
            
            <tag> prometheus </tag>
            
            <tag> Prometheus </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ingress Nginx çš„ç°åº¦æ–¹æ¡ˆ</title>
      <link href="/posts/c86b58e3/"/>
      <url>/posts/c86b58e3/</url>
      
        <content type="html"><![CDATA[<p>åœ¨ k8s ç¯å¢ƒä¸‹è¿›è¡Œç°åº¦ï¼Œingress-nginx è‡ªå¸¦äº†ç°åº¦æ³¨è§£ï¼Œ è¿™ç¯‡æ–‡ç« æŒºè¯¦ç»†çš„<a href="https://v2-1.docs.kubesphere.io/docs/zh-CN/quick-start/ingress-canary/">https://v2-1.docs.kubesphere.io/docs/zh-CN/quick-start/ingress-canary/</a></p><h2 id="å†æ­¤ä¹‹å‰"><a href="#å†æ­¤ä¹‹å‰" class="headerlink" title="å†æ­¤ä¹‹å‰"></a>å†æ­¤ä¹‹å‰</h2><p>æœ‰ä¸ªéœ€æ±‚ï¼Œ æ ¹æ®è¯·æ±‚ header æœ‰æ²¡æœ‰ç‰¹å®šçš„å€¼ï¼Œæ¥åˆ¤æ–­æ˜¯å¦è¿›å…¥ç°åº¦ç¯å¢ƒã€‚å½“æ—¶çš„åšæ³•æ˜¯åœ¨é›†ç¾¤å†…ç”¨ nginx</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># å¦‚æœæœ‰ä¸ªheaderå«gray</span><br><span class="line">if ($http_gray = &quot;true&quot;) &#123;</span><br><span class="line">    proxy_pass http://nginx.test1:80;</span><br><span class="line">    break;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ç§æ–¹å¼å¯ä»¥å®ç°éœ€æ±‚ï¼Œ ä¸è¿‡ä¸çµæ´»ï¼Œ ä¹Ÿä¸ä¼˜é›…ï¼Œ æœäº†ä¸€ä¸‹ï¼Œ å‘ç° ingress nginx åŸç”Ÿæä¾›äº†ç°åº¦çš„æ–¹æ¡ˆ</p><h2 id="ingress-è‡ªå¸¦-canary-éƒ¨ç½²"><a href="#ingress-è‡ªå¸¦-canary-éƒ¨ç½²" class="headerlink" title="ingress è‡ªå¸¦ canary éƒ¨ç½²"></a>ingress è‡ªå¸¦ canary éƒ¨ç½²</h2><p>ç®€å•æ¥è¯´å°±æ˜¯éƒ¨ç½²äº†ä¸¤å¥—ç¯å¢ƒï¼Œ è¿™ä¸¤å¥—ä¸€æ¨¡ä¸€æ ·ï¼Œ åªæ˜¯åœ¨ä¸åŒçš„ namespaceï¼ˆåŒä¸€ä¸ª namespace éœ€è¦å–ä¸åŒçš„åå­—ï¼‰ï¼Œservice å’Œ ingress åŸŸåéƒ½é…ç½®æˆä¸€æ ·çš„ï¼Œ ç„¶ååœ¨ canary ç¯å¢ƒçš„ ingress ä¸Šæ·»åŠ æ³¨è§£å³å¯ã€‚</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">extensions/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">canary</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">test1</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">kubernetes.io/ingress.class:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="comment"># ä¼˜å…ˆé¡ºåº canary-by-header - &gt; canary-by-cookie - &gt; canary-weight</span></span><br><span class="line">    <span class="comment"># è¿™é‡Œå¿…é¡»åŠ è¿™æ¡ï¼Œè¡¨ç¤ºå½“å‰ingressæ˜¯ç°åº¦çš„ingress</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/canary:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line">    <span class="comment"># è¿™é‡Œçš„å€¼å¯ä»¥æ”¹æˆä»»æ„å€¼, å’Œåé¢çš„è¯·æ±‚headerå¯¹åº”</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/canary-by-header:</span> <span class="string">gray</span></span><br><span class="line">    <span class="comment"># è¯¥è§„åˆ™å…è®¸ç”¨æˆ·è‡ªå®šä¹‰ Request Header çš„å€¼, ä¸åŠ çš„è¯ï¼Œé»˜è®¤å°±æ˜¯alwayså’Œneverä¸¤ä¸ªå€¼, è¡¨ç¤ºå§‹ç»ˆè¿›ç°åº¦æˆ–ä¸è¿›å…¥ç°åº¦ã€‚</span></span><br><span class="line">    <span class="comment"># nginx.ingress.kubernetes.io/canary-by-header-value: &quot;true&quot;</span></span><br><span class="line">    <span class="comment"># åªåŠ æƒé‡å¯ä»¥å®ç° æƒé‡æ§åˆ¶æµé‡</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/canary-weight:</span> <span class="string">&quot;50&quot;</span></span><br></pre></td></tr></table></figure><h2 id="å¦‚ä½•æµ‹è¯•æ•ˆæœ"><a href="#å¦‚ä½•æµ‹è¯•æ•ˆæœ" class="headerlink" title="å¦‚ä½•æµ‹è¯•æ•ˆæœ"></a>å¦‚ä½•æµ‹è¯•æ•ˆæœ</h2><p>å¯ä»¥ä½¿ç”¨ echo server æ¥åšæµ‹è¯•å®¹å™¨ï¼Œ è¯·æ±‚å®ƒå¯ä»¥è¾“å‡ºä¸€äº›åŸºæœ¬ä¿¡æ¯ï¼Œ æˆ‘ä»¬å°±çŸ¥é“è®¿é—®åˆ°å“ªä¸ª pod äº†</p><p><a href="/posts/635c073a">æµ‹è¯•è¿‡ç¨‹</a></p>]]></content>
      
      
      <categories>
          
          <category> å®¹å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nginx </tag>
            
            <tag> ingress </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nginxå››å±‚åå‘ä»£ç†åç«¯è®°å½•çœŸå®IP</title>
      <link href="/posts/ee4a87b3/"/>
      <url>/posts/ee4a87b3/</url>
      
        <content type="html"><![CDATA[<p>ä½¿ç”¨ k8s çš„ ingress æš´éœ²æœåŠ¡ï¼Œä¼šæœ‰ä½¿ç”¨è´Ÿè½½å‡è¡¡åå‘ä»£ç† ingress çš„æƒ…å†µï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„ ingress è·å–åˆ°çš„ ip éƒ½æ˜¯ 4 å±‚è´Ÿè½½çš„ ipï¼Œæ¯”å¦‚å¸¸ç”¨æ¶æ„å›¾<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/20220608100711.png" alt="å¸¸ç”¨æ¶æ„"></p><p>4 å±‚ Proxy Protocol é€ä¼  tcp å·¥ä½œåœ¨ç½‘ç»œç¬¬ 4 å±‚,Proxy Protocol å°±æ˜¯åœ¨ tcp ä¸­å¢åŠ ä¸€ä¸ªå°çš„æŠ¥å¤´ï¼Œç”¨æ¥å­˜å‚¨é¢å¤–çš„ä¿¡æ¯</p><p>ä»£ç†åè®®å³ Proxy Protocol,æ˜¯ haproxy çš„ä½œè€… Willy Tarreau äº 2010 å¹´å¼€å‘å’Œè®¾è®¡çš„ä¸€ä¸ª Internet åè®®ï¼Œé€šè¿‡ä¸º tcp æ·»åŠ ä¸€ä¸ªå¾ˆå°çš„å¤´ä¿¡æ¯ï¼Œæ¥æ–¹ä¾¿çš„ä¼ é€’å®¢æˆ·ç«¯ä¿¡æ¯ï¼ˆåè®®æ ˆã€æº IPã€ç›®çš„ IPã€æºç«¯å£ã€ç›®çš„ç«¯å£ç­‰)ï¼Œåœ¨ç½‘ç»œæƒ…å†µå¤æ‚åˆéœ€è¦è·å–å®¢æˆ· IP æ—¶éå¸¸æœ‰ç”¨ã€‚<br>å…¶æœ¬è´¨æ˜¯åœ¨ä¸‰æ¬¡æ¡æ‰‹ç»“æŸåç”±ä»£ç†åœ¨è¿æ¥ä¸­æ’å…¥äº†ä¸€ä¸ªæºå¸¦äº†åŸå§‹è¿æ¥å››å…ƒç»„ä¿¡æ¯çš„æ•°æ®åŒ…ã€‚</p><p>ç›®å‰ proxy protocol æœ‰ä¸¤ä¸ªç‰ˆæœ¬ï¼Œv1 ä»…æ”¯æŒ human-readable æŠ¥å¤´æ ¼å¼ï¼ˆASCIII ç ï¼‰ï¼Œv2 éœ€åŒæ—¶æ”¯æŒ human-readable å’ŒäºŒè¿›åˆ¶æ ¼å¼ï¼Œå³éœ€è¦å…¼å®¹ v1 æ ¼å¼<br>proxy protocol çš„æ¥æ”¶ç«¯å¿…é¡»åœ¨æ¥æ”¶åˆ°å®Œæ•´æœ‰æ•ˆçš„ proxy protocol å¤´éƒ¨åæ‰èƒ½å¼€å§‹å¤„ç†è¿æ¥æ•°æ®ã€‚å› æ­¤å¯¹äºæœåŠ¡å™¨çš„åŒä¸€ä¸ªç›‘å¬ç«¯å£ï¼Œä¸å­˜åœ¨å…¼å®¹å¸¦ proxy protocol åŒ…çš„è¿æ¥å’Œä¸å¸¦ proxy protocol åŒ…çš„è¿æ¥ã€‚å¦‚æœæœåŠ¡å™¨æ¥æ”¶åˆ°çš„ç¬¬ä¸€ä¸ªæ•°æ®åŒ…ä¸ç¬¦åˆ proxy protocol çš„æ ¼å¼ï¼Œé‚£ä¹ˆæœåŠ¡å™¨ä¼šç›´æ¥ç»ˆæ­¢è¿æ¥ã€‚</p><p>Proxy protocol æ˜¯æ¯”è¾ƒæ–°çš„åè®®ï¼Œä½†ç›®å‰å·²ç»æœ‰å¾ˆå¤šè½¯ä»¶æ”¯æŒï¼Œå¦‚ haproxyã€nginxã€apacheã€squidã€mysql ç­‰ç­‰ï¼Œè¦ä½¿ç”¨ proxy protocol éœ€è¦ä¸¤ä¸ªè§’è‰² sender å’Œ receiver,sender åœ¨ä¸ receiver ä¹‹é—´å»ºç«‹è¿æ¥åï¼Œä¼šå…ˆå‘é€ä¸€ä¸ªå¸¦æœ‰å®¢æˆ·ä¿¡æ¯çš„ tcp header,å› ä¸ºæ›´æ”¹äº† tcp åè®®å¤´ï¼Œéœ€ receiver ä¹Ÿæ”¯æŒ proxy protocolï¼Œå¦åˆ™ä¸èƒ½è¯†åˆ« tcp åŒ…å¤´ï¼Œå¯¼è‡´æ— æ³•æˆåŠŸå»ºç«‹è¿æ¥ã€‚<br>nginx æ˜¯ä» 1.5.12 èµ·å¼€å§‹æ”¯æŒçš„</p><h2 id="é—®é¢˜æ‰€åœ¨"><a href="#é—®é¢˜æ‰€åœ¨" class="headerlink" title="é—®é¢˜æ‰€åœ¨"></a>é—®é¢˜æ‰€åœ¨</h2><p>é€šå¸¸æˆ‘ä»¬è·å–çœŸå® ip æ˜¯é€šè¿‡è´Ÿè½½å‡è¡¡è·å–åˆ°è¿œç¨‹çš„åœ°å€ï¼Œ ç„¶åç”Ÿæˆä¸€ä¸ª header å‘é€ç»™åç«¯ï¼Œ è¿™æ ·å°±å¯ä»¥è·å–åˆ°çœŸå® ip äº†ï¼Œä½†æ˜¯åœ¨ 4 å±‚è´Ÿè½½é‡Œé¢ï¼Œ æ²¡æœ‰ header è¿™ä¸ªæ¦‚å¿µï¼Œ ingress åˆæ²¡åŠæ³•è·å–åˆ°è®¿é—® 4 å±‚çš„åœ°å€ï¼Œ æœ€å¤šåªèƒ½æ‹¿åˆ° 4 å±‚è´Ÿè½½çš„åœ°å€ï¼Œ æ‰€ä»¥éœ€è¦åœ¨ 4 å±‚ä¸Šé¢æŠŠè¿œç¨‹çš„ ip è®°å½•ä¸‹æ¥ï¼Œ ç„¶åä¼ é€åˆ°åç«¯ä¹Ÿå°±æ˜¯ ingress</p><p>TCP proxy_protocol çš„å®šä¹‰å…¶å®å°±æ˜¯åœ¨æ•°æ®æŠ¥æ–‡æœ€å‰é¢åŠ ä¸Šå¯¹åº”çš„ IP ä¿¡æ¯ã€‚ç„¶åæœ€åä¸€ä¸ª server è§£å¼€è¿™ä¸ª data å‰é¢çš„ IP ä¿¡æ¯ã€‚</p><p>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://nginx.org/en/docs/stream/ngx_stream_realip_module.html">https://nginx.org/en/docs/stream/ngx_stream_realip_module.html</a></p><h2 id="4-å±‚è´Ÿè½½ä¿®æ”¹"><a href="#4-å±‚è´Ÿè½½ä¿®æ”¹" class="headerlink" title="4 å±‚è´Ÿè½½ä¿®æ”¹"></a>4 å±‚è´Ÿè½½ä¿®æ”¹</h2><p>å…ˆç”¨ <code>nginx -V</code> çœ‹ä¸‹ nginx æœ‰æ²¡æœ‰ <code>--with-stream_realip_module</code> ç¼–è¯‘å‚æ•°ï¼Œ æ²¡æœ‰çš„è¯ï¼Œ éœ€è¦è®°ä¸‹å½“å‰çš„ç¼–è¯‘å‚æ•°ï¼Œæ·»åŠ  <code>--with-stream_realip_module</code> åé‡æ–°ç¼–è¯‘ï¼Œæ›¿æ¢ç°æœ‰çš„ nginx äºŒè¿›åˆ¶æ–‡ä»¶</p><p>ç„¶åä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œå¢åŠ å‚æ•°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">upstream k8s-http &#123;</span><br><span class="line">     server 10.0.0.30:80;</span><br><span class="line"> &#125;</span><br><span class="line"> server &#123;</span><br><span class="line">     listen 80;</span><br><span class="line">     proxy_connect_timeout 1s;</span><br><span class="line">     # proxy_timeout 10s;        # åç«¯è¿æ¥è¶…æ—¶æ—¶é—´</span><br><span class="line">     proxy_protocol on ;         # å¢åŠ è¿™ä¸ª</span><br><span class="line">     proxy_pass k8s-http;</span><br><span class="line"> &#125;</span><br><span class="line">upstream k8s-https &#123;</span><br><span class="line">     server 10.0.0.30:443;</span><br><span class="line"> &#125;</span><br><span class="line"> server &#123;</span><br><span class="line">     listen 443;</span><br><span class="line">     proxy_connect_timeout 1s;</span><br><span class="line">     # proxy_timeout 10s;        # åç«¯è¿æ¥è¶…æ—¶æ—¶é—´</span><br><span class="line">     proxy_protocol on ;         # å¢åŠ è¿™ä¸ª</span><br><span class="line">     proxy_pass k8s-https;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h2 id="ä¿®æ”¹-ingressï¼ˆæœ€åä¸€ä¸ªè´Ÿè½½å‡è¡¡ï¼‰"><a href="#ä¿®æ”¹-ingressï¼ˆæœ€åä¸€ä¸ªè´Ÿè½½å‡è¡¡ï¼‰" class="headerlink" title="ä¿®æ”¹ ingressï¼ˆæœ€åä¸€ä¸ªè´Ÿè½½å‡è¡¡ï¼‰"></a>ä¿®æ”¹ ingressï¼ˆæœ€åä¸€ä¸ªè´Ÿè½½å‡è¡¡ï¼‰</h2><p>è¿™æ ·æ”¹äº†ä¹‹åï¼Œ ç”±äºåŒ…è¢«ä¿®æ”¹äº†ï¼Œå¯¼è‡´åé¢çš„ ingress æ— æ³•è§£æè¿™ä¸ªåŒ…äº†ï¼Œ ä¼šæŠ¥é”™ <code>400 Bad Request</code></p><p>éœ€è¦ä¿®æ”¹ ingress nginx çš„ configmap é…ç½®ï¼Œ å¦‚ä¸‹ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">use-proxy-protocol:</span> <span class="string">&quot;true&quot;</span></span><br></pre></td></tr></table></figure><p>ç„¶å ingress å°±å¯ä»¥è·å–åˆ°çœŸå®çš„ ip äº†ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
            <tag> proxy </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åœ¨CentOS7ä¸Šå®‰è£…æ–°ç‰ˆæœ¬Git(2.x)</title>
      <link href="/posts/5a398dc9/"/>
      <url>/posts/5a398dc9/</url>
      
        <content type="html"><![CDATA[<blockquote><p>centos7 çš„é»˜è®¤æºé‡Œé¢çš„ git ç‰ˆæœ¬æ˜¯ 1.8.3, æ¯”è¾ƒè€äº†, å¯¹äºæœ‰äº›æ“ä½œä¼šæç¤º git ç‰ˆæœ¬å¤ªä½, å¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹æºçš„æ–¹å¼æ¥å®‰è£…æ–°ç‰ˆæœ¬çš„ git</p></blockquote><h2 id="ä½¿ç”¨-Wandisco-æº"><a href="#ä½¿ç”¨-Wandisco-æº" class="headerlink" title="ä½¿ç”¨ Wandisco æº"></a>ä½¿ç”¨ Wandisco æº</h2><p>åˆ›å»ºä»“åº“æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; /etc/yum.repos.d/wandisco-git.repo &lt;&lt;-<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">[wandisco-git]</span><br><span class="line">name=Wandisco GIT Repository</span><br><span class="line">baseurl=http://opensource.wandisco.com/centos/7/git/<span class="variable">$basearch</span>/</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=http://opensource.wandisco.com/RPM-GPG-KEY-WANdisco</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h2 id="å®‰è£…-git"><a href="#å®‰è£…-git" class="headerlink" title="å®‰è£… git"></a>å®‰è£… git</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install git</span><br></pre></td></tr></table></figure><h2 id="æŸ¥çœ‹ç‰ˆæœ¬"><a href="#æŸ¥çœ‹ç‰ˆæœ¬" class="headerlink" title="æŸ¥çœ‹ç‰ˆæœ¬"></a>æŸ¥çœ‹ç‰ˆæœ¬</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git version</span><br></pre></td></tr></table></figure><h2 id="ç¦»çº¿å®‰è£…-æ‰‹åŠ¨å®‰è£…-rpm"><a href="#ç¦»çº¿å®‰è£…-æ‰‹åŠ¨å®‰è£…-rpm" class="headerlink" title="ç¦»çº¿å®‰è£… (æ‰‹åŠ¨å®‰è£… rpm)"></a>ç¦»çº¿å®‰è£… (æ‰‹åŠ¨å®‰è£… rpm)</h2><p>ä¸‹è½½ä¸¤ä¸ªæ–‡ä»¶åˆ°æœ¬åœ°</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://file.babudiu.com/f/yXCL/perl-Git-2.41.0-1.WANdiscoRP.noarch.rpm</span><br><span class="line">wget https://file.babudiu.com/f/znF4/git-2.41.0-1.WANdiscoRP.x86_64.rpm</span><br></pre></td></tr></table></figure><p>å®‰è£…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install ./*.rpm</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nginxé…ç½®åŒå‘è®¤è¯</title>
      <link href="/posts/b78a00fa/"/>
      <url>/posts/b78a00fa/</url>
      
        <content type="html"><![CDATA[<p>å•é¡¹è®¤è¯åªéœ€è¦æœåŠ¡å™¨æä¾›è¯ä¹¦å³å¯, ä¸éªŒè¯å®¢æˆ·ç«¯è¯ä¹¦, è€ŒåŒå‘è®¤è¯éœ€è¦éªŒè¯æœåŠ¡å™¨è¯ä¹¦,ä¹Ÿéœ€è¦éªŒè¯å®¢æˆ·ç«¯è¯ä¹¦, ä¸æ»¡è¶³è¦æ±‚çš„å®¢æˆ·ç«¯å¯ä»¥ä¸å…è®¸å…¶è®¿é—®, å¹¶ä¸”å¯ä»¥é€šè¿‡åæœŸåŠé”€è¯ä¹¦çš„æ–¹å¼ç¦æ­¢å…¶è®¿é—®.</p><p>è¯ä¹¦ç­¾åå¯ä»¥å‚è€ƒ:</p><p><a href="/posts/28c679c3">ä½¿ç”¨certbotè‡ªåŠ¨ç”³è¯·sslè¯ä¹¦</a></p><p><a href="/posts/1e777b9e">ä½¿ç”¨acme.shæ¥è‡ªåŠ¨æ›´æ–°httpsè¯ä¹¦</a></p><p><a href="/posts/097e5b7c">åˆ¶ä½œå’Œä½¿ç”¨è‡ªç­¾åè¯ä¹¦</a></p><p>æœ¬æ–‡æåˆ°çš„ <code>client.crt</code> <code>server.crt</code> éƒ½æ˜¯é€šè¿‡ ca ç­¾å‘çš„</p><h2 id="æœåŠ¡å™¨é…ç½®"><a href="#æœåŠ¡å™¨é…ç½®" class="headerlink" title="æœåŠ¡å™¨é…ç½®"></a>æœåŠ¡å™¨é…ç½®</h2><p>Nginx é…ç½®:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">        listen 443 ssl;</span><br><span class="line">        server_name localhost;</span><br><span class="line">        ssl_certificate ssl/server.crt;             # é…ç½®è¯ä¹¦ä½ç½®</span><br><span class="line">        ssl_certificate_key ssl/server.key;         # é…ç½®ç§é’¥ä½ç½®</span><br><span class="line">        ssl_client_certificate ssl/ca.crt;          # å®¢æˆ·ç«¯è¯ä¹¦</span><br><span class="line">        ssl_verify_client on;                       # æ‰“å¼€å®¢æˆ·ç«¯ssléªŒè¯</span><br><span class="line">        ssl_session_timeout 5m;</span><br><span class="line">        ssl_protocols SSLv2 SSLv3 TLSv1 TLSv1.1 TLSv1.2;</span><br><span class="line">        ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE;</span><br><span class="line">        ssl_prefer_server_ciphers on;</span><br><span class="line">        root html;</span><br><span class="line">        index index.html;</span><br><span class="line">        location / &#123;</span><br><span class="line">                try_files $uri $uri/ =404;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä»£ç†é…ç½®"><a href="#ä»£ç†é…ç½®" class="headerlink" title="ä»£ç†é…ç½®"></a>ä»£ç†é…ç½®</h2><p>æ¯”å¦‚æœåŠ¡å™¨æ˜¯å¼€å¯äº†åŒå‘è®¤è¯çš„, æˆ‘æƒ³ç”¨ä¸€å° Nginx åšä»£ç†, è¯ä¹¦éƒ½ç»‘å®šåˆ°è¿™å°ä»£ç†æœºå™¨ä¸Šé¢, å¹³å¸¸è®¿é—®å°±è®¿é—®è¿™å°ä»£ç† Nginx å°±è¡Œäº†, å®¢æˆ·ç«¯ä¸ç”¨å†é…ç½®è¯ä¹¦äº†.</p><p>Nginx é…ç½®:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen       0.0.0.0:9999;</span><br><span class="line">    access_log  off;</span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_ssl_certificate        client.crt;</span><br><span class="line">        proxy_ssl_certificate_key    client.key;</span><br><span class="line">        proxy_ssl_server_name on;</span><br><span class="line">        proxy_pass   https://10.0.0.134;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ é‡åˆ°è®¿é—® nginx æŠ¥é”™ 502 çš„ï¼Œæ°å¥½ä½ çš„ç³»ç»Ÿåˆæ˜¯ RedHat ç³»ï¼Œ å¯ä»¥å°è¯•å…³é—­ Selinux</p><h2 id="ä½¿ç”¨-curl-æµ‹è¯•"><a href="#ä½¿ç”¨-curl-æµ‹è¯•" class="headerlink" title="ä½¿ç”¨ curl æµ‹è¯•"></a>ä½¿ç”¨ curl æµ‹è¯•</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl --cacert ca.crt --cert client.crt --key client.key --tlsv1.2 https://10.0.0.134</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
            <tag> SSL </tag>
            
            <tag> Nginx </tag>
            
            <tag> Auth </tag>
            
            <tag> åå‘ä»£ç† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ¶ä½œå’Œä½¿ç”¨è‡ªç­¾åè¯ä¹¦</title>
      <link href="/posts/097e5b7c/"/>
      <url>/posts/097e5b7c/</url>
      
        <content type="html"><![CDATA[<p>åœ¨å¾ˆå¤šä½¿ç”¨åˆ°è¯ä¹¦çš„åœºæ™¯, æ¯”å¦‚ HTTPS, å¯ä»¥é€‰æ‹©å»ç”³è¯·ä¸€ä¸ªå…è´¹çš„è¯ä¹¦, ä¹Ÿå¯ä»¥å°è¯•è‡ªç­¾åè¯ä¹¦, ç”³è¯·å…è´¹è¯ä¹¦è¯·çœ‹:<a href="/posts/28c679c3">ä½¿ç”¨certbotè‡ªåŠ¨ç”³è¯·sslè¯ä¹¦</a> æˆ–è€… <a href="/posts/1e777b9e">ä½¿ç”¨acme.shæ¥è‡ªåŠ¨æ›´æ–°httpsè¯ä¹¦</a>, æœ¬æ–‡ä»‹ç»è‡ªç­¾åè¯ä¹¦.</p><p>å¯ä»¥ç›´æ¥ä½¿ç”¨æˆ‘åˆ¶ä½œå¥½çš„å·¥å…·ï¼Œä¸€é”®ç”Ÿæˆè¯ä¹¦ï¼š<a href="https://github.com/iuxt/my_cert">https://github.com/iuxt/my_cert</a></p><h2 id="SSL-åè®®åŠ å¯†æ–¹å¼"><a href="#SSL-åè®®åŠ å¯†æ–¹å¼" class="headerlink" title="SSL åè®®åŠ å¯†æ–¹å¼"></a>SSL åè®®åŠ å¯†æ–¹å¼</h2><p>SSL åè®®å³ç”¨åˆ°äº†å¯¹ç§°åŠ å¯†ä¹Ÿç”¨åˆ°äº†éå¯¹ç§°åŠ å¯† (å…¬é’¥åŠ å¯†)ï¼Œåœ¨å»ºç«‹ä¼ è¾“é“¾è·¯æ—¶ï¼ŒSSL é¦–å…ˆå¯¹å¯¹ç§°åŠ å¯†çš„å¯†é’¥ä½¿ç”¨å…¬é’¥è¿›è¡Œéå¯¹ç§°åŠ å¯†ï¼Œé“¾è·¯å»ºç«‹å¥½ä¹‹åï¼ŒSSL å¯¹ä¼ è¾“å†…å®¹ä½¿ç”¨å¯¹ç§°åŠ å¯†ã€‚</p><ul><li><p>å¯¹ç§°åŠ å¯†<br>  é€Ÿåº¦é«˜ï¼Œå¯åŠ å¯†å†…å®¹è¾ƒå¤§ï¼Œç”¨æ¥åŠ å¯†ä¼šè¯è¿‡ç¨‹ä¸­çš„æ¶ˆæ¯ã€‚</p></li><li><p>å…¬é’¥åŠ å¯†<br>  åŠ å¯†é€Ÿåº¦è¾ƒæ…¢ï¼Œä½†èƒ½æä¾›æ›´å¥½çš„èº«ä»½è®¤è¯æŠ€æœ¯ï¼Œç”¨æ¥åŠ å¯†å¯¹ç§°åŠ å¯†çš„å¯†é’¥ã€‚</p></li></ul><h2 id="CA-è¯ä¹¦"><a href="#CA-è¯ä¹¦" class="headerlink" title="CA è¯ä¹¦"></a>CA è¯ä¹¦</h2><h3 id="ç”Ÿæˆ-CA-ç§é’¥"><a href="#ç”Ÿæˆ-CA-ç§é’¥" class="headerlink" title="ç”Ÿæˆ CA ç§é’¥"></a>ç”Ÿæˆ CA ç§é’¥</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl genrsa -out ca.key 4096</span><br></pre></td></tr></table></figure><p>ç”Ÿæˆä¸€ä¸ª <code>ca.key</code> æ–‡ä»¶</p><h3 id="ç”Ÿæˆ-CA-è¯ä¹¦"><a href="#ç”Ÿæˆ-CA-è¯ä¹¦" class="headerlink" title="ç”Ÿæˆ CA è¯ä¹¦"></a>ç”Ÿæˆ CA è¯ä¹¦</h3><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">éäº¤äº’å¼åˆ›å»º</button><button type="button" class="tab">äº¤äº’å¼åˆ›å»º</button></div><div class="tab-contents"><div class="tab-item-content active"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl req -utf8 -new -x509 -days 3650 -key ca.key -out ca.crt -subj <span class="string">&#x27;/C=CN/ST=Shanghai/L=Pudong/O=iuxt/OU=å¼ ç†å¤/CN=www.i.com/emailAddress=iuxt@qq.com&#x27;</span></span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl req -utf8 -new -x509 -days 3650 -key ca.key -out ca.crt</span><br></pre></td></tr></table></figure><p>éœ€è¦äº¤äº’å¼è¾“å…¥:</p><table><thead><tr><th>æç¤º</th><th>å«ä¹‰</th><th>è¾“å…¥å†…å®¹</th></tr></thead><tbody><tr><td>Country Name</td><td>å›½å®¶</td><td>CN</td></tr><tr><td>State or Province Name</td><td>çœ</td><td>Shanghai</td></tr><tr><td>Locality Name</td><td>å¸‚</td><td>ç•™ç©º</td></tr><tr><td>Organization Name</td><td>ç»„ç»‡å,å…¬å¸å</td><td>iuxt</td></tr><tr><td>Organizational Unit Name</td><td>å›¢ä½“å</td><td>ç•™ç©º</td></tr><tr><td>Common Name</td><td>ä½ çš„åå­—æˆ–åŸŸå</td><td>zhanglikun</td></tr><tr><td>Email Address</td><td>ç”µå­é‚®ç®±</td><td><a href="mailto:&#105;&#x75;&#120;&#x74;&#64;&#113;&#x71;&#x2e;&#x63;&#x6f;&#x6d;">&#105;&#x75;&#120;&#x74;&#64;&#113;&#x71;&#x2e;&#x63;&#x6f;&#x6d;</a></td></tr></tbody></table></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div><p>å°±å¯ä»¥ç”Ÿæˆ <code>ca.crt</code> æ–‡ä»¶, è¿™ä¸ªæ–‡ä»¶éœ€è¦åŠ å…¥åˆ°å®¢æˆ·ç«¯çš„ <code>å—ä¿¡ä»»çš„æ ¹è¯ä¹¦é¢å‘æœºæ„</code></p><h2 id="Server-è¯ä¹¦"><a href="#Server-è¯ä¹¦" class="headerlink" title="Server è¯ä¹¦"></a>Server è¯ä¹¦</h2><h3 id="ç”Ÿæˆ-server-ç«¯çš„ç§é’¥"><a href="#ç”Ÿæˆ-server-ç«¯çš„ç§é’¥" class="headerlink" title="ç”Ÿæˆ server ç«¯çš„ç§é’¥"></a>ç”Ÿæˆ server ç«¯çš„ç§é’¥</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl genrsa -out server.key 4096</span><br></pre></td></tr></table></figure><h3 id="ç”Ÿæˆ-server-ç«¯æ•°å­—è¯ä¹¦è¯·æ±‚"><a href="#ç”Ÿæˆ-server-ç«¯æ•°å­—è¯ä¹¦è¯·æ±‚" class="headerlink" title="ç”Ÿæˆ server ç«¯æ•°å­—è¯ä¹¦è¯·æ±‚"></a>ç”Ÿæˆ server ç«¯æ•°å­—è¯ä¹¦è¯·æ±‚</h3><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">éäº¤äº’å¼åˆ›å»º</button><button type="button" class="tab">äº¤äº’å¼åˆ›å»º</button></div><div class="tab-contents"><div class="tab-item-content active"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl req -utf8 -new -key server.key -out server.csr -subj <span class="string">&#x27;/C=CN/ST=Shanghai/L=Pudong/O=iuxt/OU=å¼ ç†å¤/CN=*.i.com/emailAddress=iuxt@qq.com&#x27;</span></span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl req -utf8 -new -key server.key -out server.csr</span><br></pre></td></tr></table></figure><p>éœ€è¦äº¤äº’å¼è¾“å…¥:</p><table><thead><tr><th>æç¤º</th><th>å«ä¹‰</th><th>è¾“å…¥å†…å®¹</th></tr></thead><tbody><tr><td>Country Name</td><td>å›½å®¶</td><td>CN</td></tr><tr><td>State or Province Name</td><td>çœ</td><td>Shanghai</td></tr><tr><td>Locality Name</td><td>å¸‚</td><td>ç•™ç©º</td></tr><tr><td>Organization Name</td><td>ç»„ç»‡å,å…¬å¸å</td><td>iuxt</td></tr><tr><td>Organizational Unit Name</td><td>å›¢ä½“å</td><td>ç•™ç©º</td></tr><tr><td>Common Name</td><td>ä½ çš„åå­—æˆ–åŸŸå</td><td>è¿™é‡Œå¿…é¡»å†™åŸŸåæˆ–è€… ip</td></tr><tr><td>Email Address</td><td>ç”µå­é‚®ç®±</td><td><a href="mailto:&#x69;&#x75;&#120;&#116;&#64;&#x71;&#113;&#46;&#99;&#x6f;&#109;">&#x69;&#x75;&#120;&#116;&#64;&#x71;&#113;&#46;&#99;&#x6f;&#109;</a></td></tr></tbody></table></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div><h3 id="ç”¨-CA-ç§é’¥ç­¾å‘-server-çš„æ•°å­—è¯ä¹¦"><a href="#ç”¨-CA-ç§é’¥ç­¾å‘-server-çš„æ•°å­—è¯ä¹¦" class="headerlink" title="ç”¨ CA ç§é’¥ç­¾å‘ server çš„æ•°å­—è¯ä¹¦"></a>ç”¨ CA ç§é’¥ç­¾å‘ server çš„æ•°å­—è¯ä¹¦</h3><blockquote><p>è§£å†³ chrome ä¸å—ä¿¡ä»»çš„é—®é¢˜</p></blockquote><p><code>vim server.ext</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">keyUsage = nonRepudiation, digitalSignature, keyEncipherment</span><br><span class="line">extendedKeyUsage = serverAuth, clientAuth</span><br><span class="line">subjectAltName=@SubjectAlternativeName</span><br><span class="line"></span><br><span class="line">[ SubjectAlternativeName ]</span><br><span class="line">DNS.1=i.com</span><br><span class="line">DNS.2=*.i.com</span><br><span class="line">IP.1=192.168.1.1</span><br><span class="line">IP.2=192.168.1.2</span><br></pre></td></tr></table></figure><p>åœ¨é‡Œé¢å¡«å†™è¯ä¹¦ç»‘å®šçš„ IP å’ŒåŸŸå, æ”¯æŒé€šé…ç¬¦</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -req -<span class="keyword">in</span> server.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out server.crt -days 3650 -sha256 -extfile server.ext</span><br></pre></td></tr></table></figure><p>ç”Ÿæˆ <code>server.crt</code> è¯ä¹¦æ–‡ä»¶</p><h2 id="å°†-server-è¯ä¹¦é…ç½®åˆ°-nginx"><a href="#å°†-server-è¯ä¹¦é…ç½®åˆ°-nginx" class="headerlink" title="å°† server è¯ä¹¦é…ç½®åˆ° nginx"></a>å°† server è¯ä¹¦é…ç½®åˆ° nginx</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">  listen 80;</span><br><span class="line">  listen [::]:80;</span><br><span class="line">  listen 443 ssl;</span><br><span class="line">  listen [::]:443 ssl;</span><br><span class="line">  ssl_certificate   ssl/i.com.crt;              # server è¯ä¹¦</span><br><span class="line">  ssl_certificate_key ssl/i.com.key;            # server ç§é’¥</span><br><span class="line">  ssl_session_timeout 5m;</span><br><span class="line">  ssl_ciphers HIGH:!aNULL:!MD5;</span><br><span class="line">  ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</span><br><span class="line">  ssl_prefer_server_ciphers on;</span><br><span class="line">  server_name i.com;</span><br><span class="line"></span><br><span class="line">  client_max_body_size 1024m;</span><br><span class="line"></span><br><span class="line">  location / &#123;</span><br><span class="line">          default_type text/plain;</span><br><span class="line">          return 200 &quot;hello&quot;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é…ç½®å®¢æˆ·ç«¯ä¿¡ä»»-CA-è¯ä¹¦"><a href="#é…ç½®å®¢æˆ·ç«¯ä¿¡ä»»-CA-è¯ä¹¦" class="headerlink" title="é…ç½®å®¢æˆ·ç«¯ä¿¡ä»» CA è¯ä¹¦"></a>é…ç½®å®¢æˆ·ç«¯ä¿¡ä»» CA è¯ä¹¦</h2><p>ä½¿ç”¨è‡ªç­¾åçš„è¯ä¹¦çš„åŸŸåï¼Œå®¢æˆ·ç«¯æ˜¯ä¸ä¿¡ä»»çš„ï¼Œ é™¤éå®¢æˆ·ç«¯ä¿¡ä»»å¯¹åº”çš„è‡ªç­¾å CA è¯ä¹¦ã€‚</p><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">windowsä¿¡ä»»CA</button><button type="button" class="tab">Debianç³»ä¿¡ä»»CA</button><button type="button" class="tab">Redhatç³»ä¿¡ä»»CA</button></div><div class="tab-contents"><div class="tab-item-content active"><p>å³é”® cacert.crt é€‰æ‹©å®‰è£…è¯ä¹¦ï¼Œ æ”¾è¿›å—ä¿¡ä»»çš„æ ¹è¯ä¹¦é¢å‘æœºæ„ã€‚</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202305251008396.png" alt="windowså®‰è£…CAè¯ä¹¦"></p></div><div class="tab-item-content"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">cp</span> cacert.crt /usr/local/share/ca-certificates/</span><br><span class="line">sudo update-ca-certificates</span><br></pre></td></tr></table></figure><p>ç„¶åä½¿ç”¨ curl ç­‰å·¥å…·å°±å—ä¿¡ä»»äº†ã€‚</p></div><div class="tab-item-content"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">cp</span> cacert.crt /etc/pki/ca-trust/source/anchors/</span><br><span class="line">sudo update-ca-trust</span><br></pre></td></tr></table></figure><p>ç„¶åä½¿ç”¨ curl ç­‰å·¥å…·å°±å—ä¿¡ä»»äº†ã€‚</p></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div><blockquote><p>å¦‚æœåªæ˜¯éœ€è¦ https è¯ä¹¦ï¼Œåˆ°è¿™é‡Œå°±å¯ä»¥äº†ï¼Œä¸‹é¢çš„æ­¥éª¤æ˜¯åŒå‘è®¤è¯ä»¥åŠåŠé”€è¯ä¹¦éœ€è¦çš„ã€‚</p></blockquote><hr><h2 id="åŠé”€è¯ä¹¦"><a href="#åŠé”€è¯ä¹¦" class="headerlink" title="åŠé”€è¯ä¹¦"></a>åŠé”€è¯ä¹¦</h2><p>æˆ‘æ˜¯åœ¨ <code>Ubuntu 24.04</code> ç³»ç»Ÿä¸‹æ“ä½œã€‚ä¸åŒç³»ç»Ÿå¯èƒ½ä¼šæœ‰å·®åˆ«ã€‚</p><h3 id="ç”Ÿæˆè¯ä¹¦åŠé”€åˆ—è¡¨"><a href="#ç”Ÿæˆè¯ä¹¦åŠé”€åˆ—è¡¨" class="headerlink" title="ç”Ÿæˆè¯ä¹¦åŠé”€åˆ—è¡¨"></a>ç”Ÿæˆè¯ä¹¦åŠé”€åˆ—è¡¨</h3><p>å‡†å¤‡ä¸€ä»½ <code>openssl.cnf</code> é…ç½®æ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">[ ca ]</span><br><span class="line">default_ca = CA_default</span><br><span class="line"></span><br><span class="line">[ CA_default ]</span><br><span class="line"># æ ¹ç›®å½•è®¾ç½®ä¸ºè‡ªå®šä¹‰è·¯å¾„</span><br><span class="line">dir = ./ca</span><br><span class="line"></span><br><span class="line"># é»˜è®¤ç®—æ³•</span><br><span class="line">default_md = sha256</span><br><span class="line"></span><br><span class="line"># CA çš„æ•°æ®åº“æ–‡ä»¶</span><br><span class="line">database = $dir/index.txt</span><br><span class="line"># è¯ä¹¦çš„åºåˆ—å·æ–‡ä»¶</span><br><span class="line">serial = $dir/serial</span><br><span class="line"># æ–°è¯ä¹¦çš„é»˜è®¤æœ‰æ•ˆæœŸ</span><br><span class="line">default_days = 365</span><br><span class="line"># åŠé”€è¯ä¹¦çš„ç†ç”±</span><br><span class="line">crl_reason = unspecified</span><br><span class="line"># é»˜è®¤çš„è¯ä¹¦é¢å‘ç­–ç•¥</span><br><span class="line">policy = policy_anything</span><br><span class="line"></span><br><span class="line"># CRL é€‰é¡¹</span><br><span class="line">crlnumber = $dir/crlnumber</span><br><span class="line">default_crl_days = 30</span><br><span class="line">crl_extensions = crl_ext</span><br><span class="line"></span><br><span class="line">[ policy_anything ]</span><br><span class="line"># é…ç½®ä»»ä½•ç­–ç•¥</span><br><span class="line">countryName = optional</span><br><span class="line">stateOrProvinceName = optional</span><br><span class="line">organizationName = optional</span><br><span class="line">organizationalUnitName = optional</span><br><span class="line">commonName = supplied</span><br><span class="line">emailAddress = optional</span><br><span class="line"></span><br><span class="line">[ crl_ext ]</span><br><span class="line"># CRL çš„æ‰©å±•é…ç½®</span><br><span class="line">authorityKeyIdentifier = keyid:always</span><br></pre></td></tr></table></figure><h3 id="åŠé”€æŒ‡å®šè¯ä¹¦"><a href="#åŠé”€æŒ‡å®šè¯ä¹¦" class="headerlink" title="åŠé”€æŒ‡å®šè¯ä¹¦"></a>åŠé”€æŒ‡å®šè¯ä¹¦</h3><p>å…¶ä»–çš„è¯ä¹¦éƒ½æ˜¯ ca ç­¾å‘çš„, ä¸ç®¡æ˜¯ nginx ç”¨çš„ server è¯ä¹¦,è¿˜æ˜¯åŒå‘è®¤è¯ç”¨åˆ°çš„ client è¯ä¹¦, åŠé”€è¯ä¹¦åéœ€è¦é‡æ–°ç”Ÿæˆ crl æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">touch</span> ca/index.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># crlnumberåˆå§‹åŒ–ï¼Œç¬¬ä¸€æ¬¡ç»™ä¸ªåˆå§‹å€¼å³å¯ï¼Œåé¢ä¸éœ€è¦ä¿®æ”¹ï¼Œæ¯æ¬¡é‡æ–°ç”Ÿæˆcrlçš„æ—¶å€™ä¼šè‡ªå¢ã€‚</span></span><br><span class="line">[ ! -f ca/crlnumber ] &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;01&quot;</span> &gt; ca/crlnumber</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŠé”€æŒ‡å®šè¯ä¹¦</span></span><br><span class="line">openssl ca  -config openssl.cnf -cert ca/ca.crt  -keyfile  ca/ca.key  -revoke ssl/i.com.crt</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŠé”€å®Œæˆåï¼Œé‡æ–°ç”ŸæˆåŠé”€åˆ—è¡¨ï¼Œå»ºè®®å®šæœŸé‡æ–°ç”Ÿæˆ CRL æ–‡ä»¶ï¼Œå¹¶åœ¨ Nginx ä¸Š reload é…ç½®</span></span><br><span class="line">openssl ca -config openssl.cnf  -cert ca/ca.crt  -keyfile  ca/ca.key  -gencrl -out ca/crl.pem</span><br></pre></td></tr></table></figure><h3 id="æœåŠ¡ç«¯-nginx-é…ç½®"><a href="#æœåŠ¡ç«¯-nginx-é…ç½®" class="headerlink" title="æœåŠ¡ç«¯ nginx é…ç½®"></a>æœåŠ¡ç«¯ nginx é…ç½®</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">  listen 80;</span><br><span class="line">  listen [::]:80;</span><br><span class="line">  listen 443 ssl;</span><br><span class="line">  listen [::]:443 ssl;</span><br><span class="line">  ssl_certificate   ssl/i.com.crt;</span><br><span class="line">  ssl_certificate_key ssl/i.com.key;</span><br><span class="line">  ssl_session_timeout 5m;</span><br><span class="line">  ssl_ciphers HIGH:!aNULL:!MD5;</span><br><span class="line">  ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</span><br><span class="line">  ssl_prefer_server_ciphers on;</span><br><span class="line">  server_name i.com;</span><br><span class="line"></span><br><span class="line">  ssl_client_certificate ssl/ca.crt;       # é…ç½® CA è¯ä¹¦ï¼Œç”¨äºéªŒè¯å®¢æˆ·ç«¯è¯ä¹¦çš„ç­¾å‘è€…</span><br><span class="line">  ssl_verify_client on;                    # å¯ç”¨å®¢æˆ·ç«¯è¯ä¹¦éªŒè¯</span><br><span class="line">  ssl_crl ssl/crl.pem;                     # é…ç½® CRL æ–‡ä»¶è·¯å¾„ï¼Œç”¨äºæ£€æŸ¥åŠé”€çš„è¯ä¹¦</span><br><span class="line"></span><br><span class="line">  client_max_body_size 1024m;</span><br><span class="line"></span><br><span class="line">  location / &#123;</span><br><span class="line">          default_type text/plain;</span><br><span class="line">          return 200 &quot;hello&quot;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="é…ç½®å®¢æˆ·ç«¯-client-è¯ä¹¦"><a href="#é…ç½®å®¢æˆ·ç«¯-client-è¯ä¹¦" class="headerlink" title="é…ç½®å®¢æˆ·ç«¯ client è¯ä¹¦"></a>é…ç½®å®¢æˆ·ç«¯ client è¯ä¹¦</h2><p>è¯ä¹¦ç”Ÿæˆæ–¹å¼å’Œä¸Šé¢ä¸€æ ·ï¼Œp12 æ ¼å¼åŒ…å«ç§é’¥å’Œè¯ä¹¦ï¼Œæ‰€ä»¥ç”Ÿæˆå®Œæˆåéœ€è¦è½¬æ¢æˆ P12 æ ¼å¼ï¼ˆWindows ç³»ç»Ÿï¼‰ï¼Œç„¶åå¯¼å…¥åˆ° Windows ç³»ç»Ÿä¸­ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl pkcs12 -<span class="built_in">export</span> -<span class="keyword">in</span> zhangsan.crt -inkey zhangsan.key -out zhangsan.p12</span><br></pre></td></tr></table></figure><p>åŒå‡»å¯¼å…¥ï¼Œå­˜å‚¨ä½ç½®é€‰æ‹©ä¸ªäºº<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202411071859189.png" alt="image.png"></p><p>è®¿é—®å¯¹åº”ç½‘ç«™çš„æ—¶å€™æµè§ˆå™¨ä¼šæç¤ºè®©é€‰æ‹©è¯ä¹¦<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202411071900128.png" alt="image.png|845"></p><p>è¿™æ˜¯è¯ä¹¦è¢«åŠé”€çš„æ ·å­ï¼š<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202411071900403.png" alt="image.png|843"></p><h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><h3 id="æŸ¥çœ‹è¯ä¹¦æœ‰æ•ˆæœŸ"><a href="#æŸ¥çœ‹è¯ä¹¦æœ‰æ•ˆæœŸ" class="headerlink" title="æŸ¥çœ‹è¯ä¹¦æœ‰æ•ˆæœŸ"></a>æŸ¥çœ‹è¯ä¹¦æœ‰æ•ˆæœŸ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -<span class="keyword">in</span> cacert.crt -noout -dates</span><br></pre></td></tr></table></figure><h3 id="Windows-åˆ é™¤è¯ä¹¦"><a href="#Windows-åˆ é™¤è¯ä¹¦" class="headerlink" title="Windows åˆ é™¤è¯ä¹¦"></a>Windows åˆ é™¤è¯ä¹¦</h3><p>win + r è¿è¡Œï¼Œè¾“å…¥ <code>certmgr.msc</code> è¿›å…¥è¯ä¹¦ç®¡ç†å™¨ã€‚æˆ–è€…åœ¨å¼€å§‹èœå•æœç´¢ <code>ç®¡ç†ç”¨æˆ·è¯ä¹¦</code> è¿›å…¥ã€‚æ‰¾åˆ°è¯ä¹¦ï¼Œå³é”®åˆ é™¤å³å¯ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SSL </tag>
            
            <tag> Auth </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nginxè®¾ç½®å›¾ç‰‡é˜²ç›—é“¾</title>
      <link href="/posts/9e870c50/"/>
      <url>/posts/9e870c50/</url>
      
        <content type="html"><![CDATA[<p>å¸¸è§çš„ä½¿ç”¨ Nginx è¿›è¡Œé˜²ç›—é“¾é…ç½®æ˜¯åˆ©ç”¨äº† referer, ä¹Ÿå°±æ˜¯æ¥æºåœ°å€æ¥åˆ¤æ–­, åªè¦ä¸æ˜¯ç™½åå•ä¸­çš„åœ°å€, å°±ç¦æ­¢è®¿é—®, referer æ˜¯æ¯”è¾ƒæœ‰æ•ˆçš„æ–¹å¼, ä½†æ˜¯å¯ä»¥è½»æ¾ç»•è¿‡, ç›®çš„æ˜¯ä¸ºäº†é˜²æ­¢é¡µé¢è¢«åˆ«äººå¤åˆ¶ç²˜è´´æˆ‘ä»¬çš„æ–‡ç« , å›¾ç‰‡ç­‰èµ„æºä¾ç„¶ä½¿ç”¨æˆ‘ä»¬çš„è¿æ¥, å ç”¨å¸¦å®½æˆ–æµé‡é€ æˆè´¹ç”¨.</p><h2 id="ç™½åå•æ¨¡å¼"><a href="#ç™½åå•æ¨¡å¼" class="headerlink" title="ç™½åå•æ¨¡å¼"></a>ç™½åå•æ¨¡å¼</h2><p>è¿™ç§æ¨¡å¼å°±æ˜¯åœ¨ç™½åå•ä¹‹å¤–çš„æ‰€æœ‰åŸŸåéƒ½ä¸èƒ½è¯·æ±‚æˆ‘ä»¬çš„å›¾ç‰‡ç­‰èµ„æº</p><p>é…ç½®ç¤ºä¾‹:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"># èµ„æºé˜²ç›—é“¾ï¼ˆæŒ‡å®šç›®å½•oræŒ‡å®šæ–‡ä»¶ç±»å‹ï¼‰</span><br><span class="line">  location ~ .*\.(gif|jpg|jpeg|png|bmp|swf)$ &#123;</span><br><span class="line">  # location /upload/ &#123;</span><br><span class="line">    access_log off;</span><br><span class="line"></span><br><span class="line">    # noneï¼šè¡¨ç¤ºæ²¡æœ‰ referer çš„å¯ä»¥è®¿é—®</span><br><span class="line">    # blockedï¼šè¡¨ç¤º referer æ²¡æœ‰å€¼çš„å¯ä»¥è®¿é—®</span><br><span class="line">    # server_namesï¼šè¡¨ç¤º Nginx çš„ server_name å¯ä»¥è®¿é—®</span><br><span class="line">    # ~.*google\.ï¼šgoogle å‰åéƒ½æ˜¯æ­£åˆ™åŒ¹é…, ~è¡¨ç¤ºåé¢çš„æ˜¯æ­£åˆ™åŒ¹é…</span><br><span class="line"></span><br><span class="line">    valid_referers none blocked server_names</span><br><span class="line">      127.0.0.1</span><br><span class="line">      ~.*google\.</span><br><span class="line">      ~.*baidu\.</span><br><span class="line">      ~.*bing\.</span><br><span class="line">      ~.*sogou\.</span><br><span class="line">      ~.*360\.</span><br><span class="line">      ~.*zahui.fan;</span><br><span class="line">    if ($invalid_referer) &#123;</span><br><span class="line">      # è¿™é‡Œä¹Ÿå¯ä»¥ return ä¸€ä¸ª403 ç­‰</span><br><span class="line">      rewrite ^/ https://static.zahui.fan/images/babudiu_block.jpg;</span><br><span class="line">    &#125;</span><br><span class="line">    proxy_pass http://halo;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é»‘åå•æ¨¡å¼"><a href="#é»‘åå•æ¨¡å¼" class="headerlink" title="é»‘åå•æ¨¡å¼"></a>é»‘åå•æ¨¡å¼</h2><p>æœªå®Œå¾…ç»­â€¦</p>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
            <tag> Nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Kuberneteså›æ»šåº”ç”¨ä¹‹kubectl rollout</title>
      <link href="/posts/8d88b8c4/"/>
      <url>/posts/8d88b8c4/</url>
      
        <content type="html"><![CDATA[<p>kubernetes æ¯æ¬¡æ›´æ–°èµ„æºä¼šè®°å½•èµ„æºçš„å†å²ç‰ˆæœ¬ï¼Œ æ–¹ä¾¿æˆ‘ä»¬è¿›è¡Œå›æ»šæ“ä½œã€‚çœŸçš„ k8s è§£å†³äº†å¾ˆå¤šè¿ç»´çš„ç—›ç‚¹é—®é¢˜, æƒ³èµ·æ¥ä»¥å‰æ²¡æœ‰ç”¨ k8s çš„æ—¶å€™,ç”¨ jenkins å’Œ ansible æ¥åšçš„å‘å¸ƒå’Œå›æ»šâ€¦</p><h2 id="æŸ¥çœ‹å†å²ç‰ˆæœ¬"><a href="#æŸ¥çœ‹å†å²ç‰ˆæœ¬" class="headerlink" title="æŸ¥çœ‹å†å²ç‰ˆæœ¬"></a>æŸ¥çœ‹å†å²ç‰ˆæœ¬</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">kubectl rollout <span class="built_in">history</span> deployment nfs-client-provisioner</span><br><span class="line"></span><br><span class="line">deployment.apps/nfs-client-provisioner</span><br><span class="line">REVISION  CHANGE-CAUSE</span><br><span class="line">1         &lt;none&gt;</span><br><span class="line">2         &lt;none&gt;</span><br><span class="line">4         &lt;none&gt;</span><br><span class="line">5         &lt;none&gt;</span><br></pre></td></tr></table></figure><blockquote><p>è¿™é‡Œåˆ—å‡ºçš„å°±æ˜¯ç‰ˆæœ¬ï¼Œ ä¸ºä»€ä¹ˆæ²¡æœ‰ 3ï¼Œ å› ä¸ºä»ç‰ˆæœ¬ 4 å›æ»šåˆ°äº†ç‰ˆæœ¬ 3ï¼Œ åˆ™ç‰ˆæœ¬ 3 å°±å˜æˆäº†ç‰ˆæœ¬ 5</p></blockquote><h2 id="æŸ¥çœ‹æŒ‡å®šç‰ˆæœ¬è¯¦æƒ…"><a href="#æŸ¥çœ‹æŒ‡å®šç‰ˆæœ¬è¯¦æƒ…" class="headerlink" title="æŸ¥çœ‹æŒ‡å®šç‰ˆæœ¬è¯¦æƒ…"></a>æŸ¥çœ‹æŒ‡å®šç‰ˆæœ¬è¯¦æƒ…</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl rollout <span class="built_in">history</span> deployment nfs-client-provisioner --revision=4</span><br></pre></td></tr></table></figure><h2 id="å›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬"><a href="#å›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬" class="headerlink" title="å›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬"></a>å›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl rollout undo deployment nfs-client-provisioner --to-revision=4</span><br></pre></td></tr></table></figure><blockquote><p>å›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬å¯ä»¥ä¸ç”¨å¢åŠ  <code>--to-revision=4</code> å‚æ•°, é»˜è®¤å°±æ˜¯å›æ»šä¸Šä¸€ä¸ªç‰ˆæœ¬</p></blockquote><h2 id="è®°å½•ç‰ˆæœ¬å˜åŒ–"><a href="#è®°å½•ç‰ˆæœ¬å˜åŒ–" class="headerlink" title="è®°å½•ç‰ˆæœ¬å˜åŒ–"></a>è®°å½•ç‰ˆæœ¬å˜åŒ–</h2><h3 id="æ‰§è¡Œå‘½ä»¤è®°å½•å˜åŒ–"><a href="#æ‰§è¡Œå‘½ä»¤è®°å½•å˜åŒ–" class="headerlink" title="æ‰§è¡Œå‘½ä»¤è®°å½•å˜åŒ–"></a>æ‰§è¡Œå‘½ä»¤è®°å½•å˜åŒ–</h3><p>åœ¨ç¬¬ä¸€æ­¥æŸ¥çœ‹å†å²ç‰ˆæœ¬, CHANGE-CAUSE æ˜¾ç¤ºçš„æ˜¯ none, å¦‚æœéœ€è¦è®°å½• kubectl æ‰§è¡Œçš„å‘½ä»¤,åˆ™æ‰§è¡Œå‘½ä»¤çš„æ—¶å€™éœ€è¦æ·»åŠ å‚æ•°</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl <span class="built_in">set</span> image deployment/nginx-deployment nginx=nginx:1.16.1 --record=<span class="literal">true</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±ä¼šæŠŠå½“å‰çš„å‘½ä»¤è®°å½•åˆ°ç‰ˆæœ¬çš„ CHANGE-CAUSE è¿™ä¸€æ </p><h3 id="è®¾ç½®å†å²ç‰ˆæœ¬æ•°é‡"><a href="#è®¾ç½®å†å²ç‰ˆæœ¬æ•°é‡" class="headerlink" title="è®¾ç½®å†å²ç‰ˆæœ¬æ•°é‡"></a>è®¾ç½®å†å²ç‰ˆæœ¬æ•°é‡</h3><p>åœ¨ yml æ–‡ä»¶é‡Œé¢å¯ä»¥è®¾ç½®å†å²ç‰ˆæœ¬çš„æ•°é‡, æ¯”å¦‚:</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-deployment</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">revisionHistoryLimit:</span> <span class="number">5</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure><h2 id="æŸ¥çœ‹å†å²ç‰ˆæœ¬-1"><a href="#æŸ¥çœ‹å†å²ç‰ˆæœ¬-1" class="headerlink" title="æŸ¥çœ‹å†å²ç‰ˆæœ¬"></a>æŸ¥çœ‹å†å²ç‰ˆæœ¬</h2><p>å¦‚æœåªæ˜¯æ›´æ–°äº†é•œåƒï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤æŸ¥çœ‹å†å²çš„é•œåƒç‰ˆæœ¬ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># æ£€æŸ¥å‚æ•°æ˜¯å¦æ­£ç¡®</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> -lt 1 ] || [ <span class="variable">$#</span> -gt 2 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;ç”¨æ³•: <span class="variable">$0</span> &lt;deploymentåç§°&gt; [å‘½åç©ºé—´]&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">DEPLOYMENT_NAME=<span class="variable">$1</span></span><br><span class="line">NAMESPACE=<span class="variable">$&#123;2:-default&#125;</span>  <span class="comment"># å¦‚æœæœªæŒ‡å®šå‘½åç©ºé—´åˆ™ä½¿ç”¨ default</span></span><br><span class="line"></span><br><span class="line">VER=$(kubectl rollout <span class="built_in">history</span> deployment -n <span class="variable">$NAMESPACE</span> <span class="variable">$DEPLOYMENT_NAME</span> | awk <span class="string">&#x27;NR &gt; 2 &#123;print $1&#125;&#x27;</span> | <span class="built_in">sort</span> -nr)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="variable">$VER</span>;<span class="keyword">do</span></span><br><span class="line">    kubectl rollout <span class="built_in">history</span> deployment -n <span class="variable">$NAMESPACE</span> <span class="variable">$DEPLOYMENT_NAME</span> --revision=<span class="variable">$i</span> | grep Image:</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å®¹å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> kubectl </tag>
            
            <tag> Kubernetes </tag>
            
            <tag> k8s </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Kubeadmä¹‹å•èŠ‚ç‚¹masterå‡çº§é«˜å¯ç”¨master</title>
      <link href="/posts/34d8fad0/"/>
      <url>/posts/34d8fad0/</url>
      
        <content type="html"><![CDATA[<p>å•èŠ‚ç‚¹å‡çº§ master æ€»ä½“æ¥è¯´å°±æ˜¯ä¸¤æ­¥ï¼Œ å…ˆä¿®æ”¹ apiserver åœ°å€ä¸ºè´Ÿè½½å‡è¡¡åœ°å€ï¼Œç„¶åæ·»åŠ æ–°çš„ master èŠ‚ç‚¹ã€‚</p><p>æ­å»ºé›†ç¾¤çš„æ—¶å€™æˆ‘ä»¬æ³¨æ„ä¸€ä¸‹å°±å¯ä»¥å‡å°‘åæœŸç»´æŠ¤çš„çƒ¦æ¼ï¼Œæ¯”å¦‚ï¼š</p><ol><li>ä½¿ç”¨ hostname è€Œä¸æ˜¯ ip æ¥ä½œä¸º kube-apiserver åœ°å€</li><li>å•èŠ‚ç‚¹ä¹ŸæŠŠè´Ÿè½½å‡è¡¡å®‰æ’ä¸Š</li></ol><p>å‡è®¾å·²ç»æœ‰ä¸€ä¸ªæ²¡æœ‰è´Ÿè½½å‡è¡¡çš„å•èŠ‚ç‚¹ masterï¼Œç°åœ¨æƒ³å°†å®ƒåˆ‡æ¢ä¸ºé«˜å¯ç”¨é›†ç¾¤ï¼Œè®°å½•ä»¥ä¸‹æ­¥éª¤ï¼š</p><h2 id="éƒ¨ç½²è´Ÿè½½å‡è¡¡"><a href="#éƒ¨ç½²è´Ÿè½½å‡è¡¡" class="headerlink" title="éƒ¨ç½²è´Ÿè½½å‡è¡¡"></a>éƒ¨ç½²è´Ÿè½½å‡è¡¡</h2><p>å‚è€ƒ <a href="/posts/10cef768/">Kubernetesä¹‹masteré«˜å¯ç”¨æ–¹æ¡ˆ</a></p><h2 id="æ›´æ–°è¯ä¹¦"><a href="#æ›´æ–°è¯ä¹¦" class="headerlink" title="æ›´æ–°è¯ä¹¦"></a>æ›´æ–°è¯ä¹¦</h2><blockquote><p>å› ä¸ºæˆ‘ä»¬éƒ¨ç½²äº†è´Ÿè½½å‡è¡¡ï¼Œæ‰€ä»¥éœ€è¦é€šè¿‡è´Ÿè½½å‡è¡¡çš„åœ°å€æ¥è®¿é—® apiserverï¼Œå› ä¸ºè¯ä¹¦æ˜¯é’ˆå¯¹åŸŸåæˆ–è€… ip åšçš„ç­¾åï¼Œå¦‚æœ ip å˜äº†è¯ä¹¦å°±å¤±æ•ˆäº†ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå»ºè®®ä½¿ç”¨ hostname æ¥ä»£æ›¿ ip</p></blockquote><p>å¦‚æœä½ æ˜¯ç”¨ kubeadm init æ¥åˆ›å»ºçš„é›†ç¾¤ï¼Œé‚£ä¹ˆä½ éœ€è¦å¯¼å‡ºä¸€ä¸ª kubeadm é…ç½®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl -n kube-system get configmap kubeadm-config -o jsonpath=<span class="string">&#x27;&#123;.data.ClusterConfiguration&#125;&#x27;</span> &gt; kubeadm.yaml</span><br></pre></td></tr></table></figure><h3 id="æ·»åŠ è¯ä¹¦-SANs-ä¿¡æ¯"><a href="#æ·»åŠ è¯ä¹¦-SANs-ä¿¡æ¯" class="headerlink" title="æ·»åŠ è¯ä¹¦ SANs ä¿¡æ¯"></a>æ·»åŠ è¯ä¹¦ SANs ä¿¡æ¯</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiServer:</span></span><br><span class="line">  <span class="attr">certSANs:</span></span><br><span class="line">  <span class="comment"># è¿™é‡Œéœ€è¦åŒ…å«è´Ÿè½½å‡è¡¡ã€æ‰€æœ‰masterèŠ‚ç‚¹çš„hostnameå’Œip</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">kube-apiserver</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">m1</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">m2</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">m3</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">10.0</span><span class="number">.0</span><span class="number">.3</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">10.0</span><span class="number">.0</span><span class="number">.11</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">10.0</span><span class="number">.0</span><span class="number">.12</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">10.0</span><span class="number">.0</span><span class="number">.13</span></span><br><span class="line">  <span class="attr">extraArgs:</span></span><br><span class="line">    <span class="attr">authorization-mode:</span> <span class="string">Node,RBAC</span></span><br><span class="line">  <span class="attr">timeoutForControlPlane:</span> <span class="string">4m0s</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">kubeadm.k8s.io/v1beta2</span></span><br><span class="line"><span class="attr">certificatesDir:</span> <span class="string">/etc/kubernetes/pki</span></span><br><span class="line"><span class="attr">clusterName:</span> <span class="string">kubernetes</span></span><br><span class="line"><span class="attr">controlPlaneEndpoint:</span> <span class="string">kube-apiserver:6443</span>  <span class="comment"># ä¿®æ”¹æˆè´Ÿè½½å‡è¡¡çš„åœ°å€</span></span><br><span class="line"><span class="attr">controllerManager:</span> &#123;&#125;</span><br><span class="line"><span class="attr">dns:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">CoreDNS</span></span><br><span class="line"><span class="attr">etcd:</span></span><br><span class="line">  <span class="attr">local:</span></span><br><span class="line">    <span class="attr">dataDir:</span> <span class="string">/var/lib/etcd</span></span><br><span class="line"><span class="attr">imageRepository:</span> <span class="string">k8s.gcr.io</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterConfiguration</span></span><br><span class="line"><span class="attr">kubernetesVersion:</span> <span class="string">v1.21.10</span></span><br><span class="line"><span class="attr">networking:</span></span><br><span class="line">  <span class="attr">dnsDomain:</span> <span class="string">cluster.local</span></span><br><span class="line">  <span class="attr">podSubnet:</span> <span class="number">10.244</span><span class="number">.0</span><span class="number">.0</span><span class="string">/16</span></span><br><span class="line">  <span class="attr">serviceSubnet:</span> <span class="number">10.96</span><span class="number">.0</span><span class="number">.0</span><span class="string">/12</span></span><br><span class="line"><span class="attr">scheduler:</span> &#123;&#125;</span><br></pre></td></tr></table></figure><h3 id="ç”Ÿæˆæ–°çš„è¯ä¹¦"><a href="#ç”Ÿæˆæ–°çš„è¯ä¹¦" class="headerlink" title="ç”Ÿæˆæ–°çš„è¯ä¹¦"></a>ç”Ÿæˆæ–°çš„è¯ä¹¦</h3><p>å¤‡ä»½æ—§è¯ä¹¦</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mv</span> /etc/kubernetes/pki/apiserver.&#123;crt,key&#125; .</span><br></pre></td></tr></table></figure><p>ç”Ÿæˆæ–°çš„è¯ä¹¦</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubeadm init phase certs apiserver --config kubeadm.yaml</span><br></pre></td></tr></table></figure><p>éªŒè¯è¯ä¹¦ï¼Œç¡®å®šåŒ…å«æ–°æ·»åŠ çš„ SAN åˆ—è¡¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -<span class="keyword">in</span> /etc/kubernetes/pki/apiserver.crt -text</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">DNS:apiserver-endpoint, DNS:kubernetes, DNS:kubernetes.default, DNS:kubernetes.default.svc, DNS:kubernetes.default.svc.cluster.local, DNS:m1, DNS:m2, DNS:m3, IP Address:10.96.0.1, IP Address:10.0.0.11, IP Address:10.0.0.3, IP Address:10.0.0.12, IP Address:10.0.0.13</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>é‡å¯ apiserver</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete pod kube-controller-manager-m1 kube-controller-manager-m2</span><br></pre></td></tr></table></figure><h3 id="ä¿å­˜æ–°çš„é…ç½®"><a href="#ä¿å­˜æ–°çš„é…ç½®" class="headerlink" title="ä¿å­˜æ–°çš„é…ç½®"></a>ä¿å­˜æ–°çš„é…ç½®</h3><p>è¿™æ­¥æ“ä½œå…¶å®æ˜¯æŠŠ kubeadm çš„é…ç½®ç»™ä¿å­˜åœ¨é›†ç¾¤ä¸­ï¼Œ ä»¥åæ·»åŠ æ–°çš„èŠ‚ç‚¹å°±ä¼šè¯»å–è¿™ä¸ªé…ç½®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubeadm init phase upload-config kubeadm --config kubeadm.yaml</span><br></pre></td></tr></table></figure><p>å½“ç„¶ä½ ä¹Ÿå¯ä»¥æ‰‹åŠ¨ç¼–è¾‘ configmap</p><h2 id="æ›´æ–°é…ç½®"><a href="#æ›´æ–°é…ç½®" class="headerlink" title="æ›´æ–°é…ç½®"></a>æ›´æ–°é…ç½®</h2><p>è¯ä¹¦æ›´æ–°å®Œæˆäº†ï¼Œè´Ÿè½½å‡è¡¡ä¹Ÿéƒ¨ç½²å¥½äº†ï¼Œæ¥ä¸‹æ¥å°±éœ€è¦æŠŠæ‰€æœ‰ç”¨åˆ°æ—§åœ°å€çš„ç»„ä»¶é…ç½®ä¿®æ”¹æˆè´Ÿè½½å‡è¡¡çš„åœ°å€ã€‚</p><h3 id="kubelet-conf"><a href="#kubelet-conf" class="headerlink" title="kubelet.conf"></a>kubelet.conf</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/kubernetes/kubelet.conf</span><br><span class="line">...</span><br><span class="line">    server: https://kube-apiserver:6443</span><br><span class="line">  name: kubernetes</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">systemctl restart kubelet</span><br></pre></td></tr></table></figure><h3 id="controller-manager-conf"><a href="#controller-manager-conf" class="headerlink" title="controller-manager.conf"></a>controller-manager.conf</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/kubernetes/controller-manager.conf</span><br><span class="line">...</span><br><span class="line">    server: https://kube-apiserver:6443</span><br><span class="line">  name: kubernetes</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>é‡å¯ kube-controller-manager</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete pod -n kube-system kube-controller-manager-m1 kube-controller-manager-m2</span><br></pre></td></tr></table></figure><h3 id="scheduler-conf"><a href="#scheduler-conf" class="headerlink" title="scheduler.conf"></a>scheduler.conf</h3><p>vim &#x2F;etc&#x2F;kubernetes&#x2F;scheduler.conf</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">    server: https://kube-apiserver:6443</span><br><span class="line">  name: kubernetes</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>é‡å¯ kube-scheduler</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete pod -n kube-system kube-scheduler-m1 kube-scheduler-m2</span><br></pre></td></tr></table></figure><h3 id="kube-proxy"><a href="#kube-proxy" class="headerlink" title="kube-proxy"></a>kube-proxy</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">kubectl edit configmap kube-proxy -n kube-system</span><br><span class="line">...</span><br><span class="line">  kubeconfig.conf: |-</span><br><span class="line">    apiVersion: v1</span><br><span class="line">    kind: Config</span><br><span class="line">    clusters:</span><br><span class="line">    - cluster:</span><br><span class="line">        certificate-authority: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt</span><br><span class="line">        server: https://kube-apiserver:6443</span><br><span class="line">      name: default</span><br><span class="line">    contexts:</span><br><span class="line">    - context:</span><br><span class="line">        cluster: default</span><br><span class="line">        namespace: default</span><br><span class="line">        user: default</span><br><span class="line">      name: default</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>é‡å¯ kube-proxy</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl rollout restart daemonset kube-proxy -n kube-system</span><br></pre></td></tr></table></figure><p>kubeconfig ä¸Šé¢çš„åœ°å€ä¹Ÿéœ€è¦æ”¹ï¼Œæ¯”å¦‚ <code>~/.kube/config</code> å’Œ <code>/etc/kubernetes/admin.conf</code></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">...</span></span><br><span class="line">    <span class="attr">server:</span> <span class="string">https://kube-apiserver:6443</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kubernetes</span></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure><h2 id="æ·»åŠ æ§åˆ¶å¹³é¢"><a href="#æ·»åŠ æ§åˆ¶å¹³é¢" class="headerlink" title="æ·»åŠ æ§åˆ¶å¹³é¢"></a>æ·»åŠ æ§åˆ¶å¹³é¢</h2><p>æ·»åŠ æ§åˆ¶å¹³é¢ (master) è¯·æŸ¥çœ‹ï¼š<a href="/posts/b86d9e9f/#%E8%8E%B7%E5%8F%96join%E5%91%BD%E4%BB%A4-%E5%A2%9E%E5%8A%A0%E6%96%B0%E7%9A%84%E8%8A%82%E7%82%B9">kubeadmæ·»åŠ masterèŠ‚ç‚¹</a></p>]]></content>
      
      
      <categories>
          
          <category> å®¹å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
            <tag> Linux </tag>
            
            <tag> Container </tag>
            
            <tag> Kubernetes </tag>
            
            <tag> kubeadm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨kubeaszæ­å»ºä¸€å¥—é«˜å¯ç”¨çš„Kubernetesé›†ç¾¤</title>
      <link href="/posts/6f59afe4/"/>
      <url>/posts/6f59afe4/</url>
      
        <content type="html"><![CDATA[<p>kubeasz æ˜¯åŸºäº ansible å’Œ shell åˆ¶ä½œçš„å·¥å…·ï¼Œå¯ä»¥å¿«é€Ÿæ­å»ºä¸€ä¸ªé«˜å¯ç”¨çš„ k8s é›†ç¾¤ï¼ˆäºŒè¿›åˆ¶éƒ¨ç½²ï¼‰ï¼Œä¸éœ€è¦é¢å¤–çš„è´Ÿè½½å‡è¡¡ã€‚é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/easzlab/kubeasz">https://github.com/easzlab/kubeasz</a>, kubeasz æ¯ä¸ªç‰ˆæœ¬å¯¹åº”äº†æ”¯æŒçš„ k8s ç‰ˆæœ¬, å¯ä»¥åˆ°é¡¹ç›®ä¸»é¡µæŸ¥çœ‹, è¿™é‡Œä½¿ç”¨ kubeasz ç‰ˆæœ¬ 3.6.3, éƒ¨ç½² <code>k8s 1.29.0</code></p><blockquote><p>å¦è§ kubeadm éƒ¨ç½²<br><a href="/posts/b86d9e9f/">åœ¨centosä½¿ç”¨kubeadméƒ¨ç½²k8s</a><br><a href="/posts/526ffc9a/">åœ¨ubuntuä½¿ç”¨kubeadméƒ¨ç½²k8s</a></p></blockquote><h2 id="å®‰è£…å‡†å¤‡"><a href="#å®‰è£…å‡†å¤‡" class="headerlink" title="å®‰è£…å‡†å¤‡"></a>å®‰è£…å‡†å¤‡</h2><p>å‡†å¤‡æœºå™¨å¦‚ä¸‹ï¼š</p><table><thead><tr><th>æœºå™¨</th><th>IP</th></tr></thead><tbody><tr><td>kubeasz æ“ä½œæœº</td><td>10.0.0.7</td></tr><tr><td>master1</td><td>10.0.0.31</td></tr><tr><td>master2</td><td>10.0.0.32</td></tr><tr><td>master3</td><td>10.0.0.33</td></tr><tr><td>worker1</td><td>10.0.0.41</td></tr></tbody></table><p>é¦–å…ˆç¡®ä¿æ“ä½œæœºå¯ä»¥é€šè¿‡ ssh è¿æ¥åˆ°å…¶ä»–æ‰€æœ‰æœºå™¨ï¼Œæœ€å¥½å¯†é’¥æ‰“é€šï¼ˆè¿™æ˜¯ä½¿ç”¨ ansible çš„å¿…è¦æ¡ä»¶ï¼‰</p><h2 id="å®‰è£…-kubeasz"><a href="#å®‰è£…-kubeasz" class="headerlink" title="å®‰è£… kubeasz"></a>å®‰è£… kubeasz</h2><h3 id="ä¸‹è½½-ezdown-éƒ¨ç½²å·¥å…·"><a href="#ä¸‹è½½-ezdown-éƒ¨ç½²å·¥å…·" class="headerlink" title="ä¸‹è½½ ezdown éƒ¨ç½²å·¥å…·"></a>ä¸‹è½½ ezdown éƒ¨ç½²å·¥å…·</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> release=3.6.3                     <span class="comment"># è®¾ç½®kubeaszç‰ˆæœ¬</span></span><br><span class="line">wget https://github.com/easzlab/kubeasz/releases/download/<span class="variable">$&#123;release&#125;</span>/ezdown</span><br><span class="line"><span class="built_in">chmod</span> +x ./ezdown</span><br></pre></td></tr></table></figure><h3 id="ä¸‹è½½-kubeasz-ç¦»çº¿åŒ…ç­‰"><a href="#ä¸‹è½½-kubeasz-ç¦»çº¿åŒ…ç­‰" class="headerlink" title="ä¸‹è½½ kubeasz ç¦»çº¿åŒ…ç­‰"></a>ä¸‹è½½ kubeasz ç¦»çº¿åŒ…ç­‰</h3><p>ä¸‹è½½çš„æ–‡ä»¶ä½äº <code>/etc/kubeasz/</code> ç›®å½•ä¸­ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸‹è½½é»˜è®¤ç‰ˆæœ¬</span></span><br><span class="line">./ezdown -D</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯ä»¥ä½¿ç”¨-kå‚æ•°æŒ‡å®šéœ€è¦ä¸‹è½½çš„k8sç‰ˆæœ¬</span></span><br><span class="line"><span class="comment"># ./ezdown -D -k v1.29.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸‹è½½Dockerå®¹å™¨ç‰ˆezctl</span></span><br><span class="line">./ezdown -S</span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸‹è½½flannelç»„ä»¶</span></span><br><span class="line">./ezdown -X flannel</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸‹è½½ç¦»çº¿deb/rpmåŒ…</span></span><br><span class="line"><span class="comment"># ./ezdown -P</span></span><br></pre></td></tr></table></figure><h2 id="éƒ¨ç½²é›†ç¾¤"><a href="#éƒ¨ç½²é›†ç¾¤" class="headerlink" title="éƒ¨ç½²é›†ç¾¤"></a>éƒ¨ç½²é›†ç¾¤</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/kubeasz/</span><br><span class="line">dk ezctl new k8s-cluster</span><br></pre></td></tr></table></figure><p>æ ¹æ®éœ€æ±‚ä¿®æ”¹é…ç½®æ–‡ä»¶</p><p>ansible ä¸»æœºæ¸…å•ï¼ˆå®šä¹‰ä¸»æœº IPï¼‰<code>/etc/kubeasz/clusters/k8s-cluster/hosts</code><br>é›†ç¾¤é…ç½®æ–‡ä»¶ <code>/etc/kubeasz/clusters/k8s-cluster/config.yml</code></p><p>å¼€å§‹éƒ¨ç½²</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dk ezctl setup k8s-cluster all</span><br></pre></td></tr></table></figure><h2 id="æ£€æŸ¥éƒ¨ç½²ç»“æœ"><a href="#æ£€æŸ¥éƒ¨ç½²ç»“æœ" class="headerlink" title="æ£€æŸ¥éƒ¨ç½²ç»“æœ"></a>æ£€æŸ¥éƒ¨ç½²ç»“æœ</h2><p>æŸ¥çœ‹ kubernetes é›†ç¾¤çš„ç»„ä»¶çŠ¶æ€ï¼ˆåŸºæœ¬éƒ½æ˜¯é€šè¿‡ systemd ç®¡ç†çš„ï¼‰</p><h3 id="åœ¨-master-èŠ‚ç‚¹ä¸ŠæŸ¥çœ‹"><a href="#åœ¨-master-èŠ‚ç‚¹ä¸ŠæŸ¥çœ‹" class="headerlink" title="åœ¨ master èŠ‚ç‚¹ä¸ŠæŸ¥çœ‹"></a>åœ¨ master èŠ‚ç‚¹ä¸ŠæŸ¥çœ‹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">systemctl status etcd</span><br><span class="line">systemctl status kube-apiserver</span><br><span class="line">systemctl status kube-scheduler</span><br><span class="line">systemctl status kube-controller-manager</span><br></pre></td></tr></table></figure><h3 id="åœ¨-master-å’Œ-node-èŠ‚ç‚¹ä¸ŠæŸ¥çœ‹"><a href="#åœ¨-master-å’Œ-node-èŠ‚ç‚¹ä¸ŠæŸ¥çœ‹" class="headerlink" title="åœ¨ master å’Œ node èŠ‚ç‚¹ä¸ŠæŸ¥çœ‹"></a>åœ¨ master å’Œ node èŠ‚ç‚¹ä¸ŠæŸ¥çœ‹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl status kubelet </span><br><span class="line">systemctl status kube-proxy </span><br><span class="line">systemctl status docker</span><br></pre></td></tr></table></figure><h2 id="æ¸…ç†é›†ç¾¤"><a href="#æ¸…ç†é›†ç¾¤" class="headerlink" title="æ¸…ç†é›†ç¾¤"></a>æ¸…ç†é›†ç¾¤</h2><p>å¦‚æœéœ€è¦æ‰§è¡Œæ¸…ç†æ“ä½œ:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dk ezctl destroy k8s-cluster</span><br></pre></td></tr></table></figure><h2 id="èŠ‚ç‚¹ç®¡ç†"><a href="#èŠ‚ç‚¹ç®¡ç†" class="headerlink" title="èŠ‚ç‚¹ç®¡ç†"></a>èŠ‚ç‚¹ç®¡ç†</h2><p>æ“ä½œæœºå»ºè®®ä¿ç•™ï¼Œ åæœŸè¿›è¡Œæ‰©å®¹ç­‰ä¼šéå¸¸æ–¹ä¾¿ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ–°å¢masterèŠ‚ç‚¹</span></span><br><span class="line">dk ezctl add-master k8s-cluster 10.0.0.34</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–°å¢etcdèŠ‚ç‚¹</span></span><br><span class="line">dk ezctl add-etcd k8s-cluster 10.0.0.34</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–°å¢workerèŠ‚ç‚¹</span></span><br><span class="line">dk ezctl add-node k8s-cluster 10.0.0.41</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤etcdèŠ‚ç‚¹</span></span><br><span class="line">dk ezctl del-etcd k8s-cluster 10.0.0.34</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤masterèŠ‚ç‚¹</span></span><br><span class="line">dk ezctl del-master k8s-cluster 10.0.0.34</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤workerèŠ‚ç‚¹</span></span><br><span class="line">dk ezctl del-node k8s-cluster 10.0.0.41</span><br></pre></td></tr></table></figure><h3 id="master-å…è®¸è°ƒåº¦"><a href="#master-å…è®¸è°ƒåº¦" class="headerlink" title="master å…è®¸è°ƒåº¦"></a>master å…è®¸è°ƒåº¦</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl uncordon master-01</span><br><span class="line">kubectl uncordon master-02</span><br><span class="line">kubectl uncordon master-03</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å®¹å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
            <tag> Linux </tag>
            
            <tag> Container </tag>
            
            <tag> Kubernetes </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨kubeadméƒ¨ç½²ä¸€å¥—é«˜å¯ç”¨k8sé›†ç¾¤ for CentOS</title>
      <link href="/posts/b86d9e9f/"/>
      <url>/posts/b86d9e9f/</url>
      
        <content type="html"><![CDATA[<blockquote><p>åŸºäº centos ä½¿ç”¨ kubeadm æ­å»ºé›†ç¾¤ï¼Œ <a href="/posts/526ffc9a/">ubuntuéƒ¨ç½²æ–‡æ¡£</a>, æœ‰ç–‘é—®çš„åœ°æ–¹å¯ä»¥çœ‹ <a href="https://kubernetes.io/zh/docs/setup/production-environment/tools/kubeadm/">å®˜æ–¹æ–‡æ¡£</a></p></blockquote><h2 id="å‡†å¤‡æœºå™¨"><a href="#å‡†å¤‡æœºå™¨" class="headerlink" title="å‡†å¤‡æœºå™¨"></a>å‡†å¤‡æœºå™¨</h2><blockquote><p>æˆ‘çš„æœºå™¨è¯¦æƒ…å¦‚ä¸‹, é…ç½®è‡³å°‘ä¸º 4C4G</p></blockquote><table><thead><tr><th>hostname</th><th>IP</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>public</td><td>10.0.0.3</td><td>ingress å’Œ apiserver çš„è´Ÿè½½å‡è¡¡ï¼Œnfs å­˜å‚¨</td></tr><tr><td>master1</td><td>10.0.0.11</td><td>k8s master èŠ‚ç‚¹</td></tr><tr><td>master2</td><td>10.0.0.12</td><td>k8s master èŠ‚ç‚¹</td></tr><tr><td>master3</td><td>10.0.0.13</td><td>k8s master èŠ‚ç‚¹</td></tr><tr><td>worker1</td><td>10.0.0.21</td><td>k8s worker èŠ‚ç‚¹</td></tr><tr><td>worker2</td><td>10.0.0.22</td><td>k8s worker èŠ‚ç‚¹</td></tr></tbody></table><p>æ¯å°æœºå™¨éƒ½åšåŸŸåè§£æï¼Œæˆ–è€…ç»‘å®š hosts(å¯é€‰ä½†å»ºè®®)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/hosts</span><br><span class="line"></span><br><span class="line">10.0.0.3  public kube-apiserver</span><br><span class="line">10.0.0.11 master1</span><br><span class="line">10.0.0.12 master2</span><br><span class="line">10.0.0.13 master3</span><br></pre></td></tr></table></figure><p>æ¯å°æœºå™¨éƒ½å…³é—­é˜²ç«å¢™å’Œ SELinux</p><blockquote><p>è´Ÿè½½å‡è¡¡æœºå™¨å¿…é¡»è¦å…³é—­,å› ä¸º 6443 ä¸æ˜¯ nginx çš„æ ‡å‡†ç«¯å£,ä¼šè¢« selinux æ‹¦æˆª, é˜²ç«å¢™ä¹Ÿéœ€è¦æ”¾è¡Œ 6443 ç«¯å£, å¯ä»¥è€ƒè™‘ç›´æ¥å…³é—­</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl <span class="built_in">disable</span> --now firewalld</span><br><span class="line">setenforce 0</span><br><span class="line">sed -i <span class="string">&quot;s/^SELINUX=.*/SELINUX=disabled/g&quot;</span> /etc/selinux/config</span><br></pre></td></tr></table></figure><h2 id="åŸºç¡€ç¯å¢ƒé…ç½®"><a href="#åŸºç¡€ç¯å¢ƒé…ç½®" class="headerlink" title="åŸºç¡€ç¯å¢ƒé…ç½®"></a>åŸºç¡€ç¯å¢ƒé…ç½®</h2><blockquote><p>åŸºç¡€ç¯å¢ƒæ˜¯ä¸ç®¡ master è¿˜æ˜¯ worker éƒ½éœ€è¦çš„ç¯å¢ƒ</p></blockquote><ol><li>ç¦ç”¨ swap</li><li>ç¡®ä¿æ¯ä¸ªèŠ‚ç‚¹ä¸Š MAC åœ°å€å’Œ product_uuid çš„å”¯ä¸€æ€§ <code>sudo cat /sys/class/dmi/id/product_uuid</code></li><li>ä¿®æ”¹ hostname</li><li>å…è®¸ iptables æ£€æŸ¥æ¡¥æ¥æµé‡</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF | sudo tee /etc/modules-load.d/k8s.conf</span></span><br><span class="line"><span class="string">br_netfilter</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF | sudo tee /etc/sysctl.d/k8s.conf</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-ip6tables = 1</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-iptables = 1</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">sudo sysctl --system</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…-runtime"><a href="#å®‰è£…-runtime" class="headerlink" title="å®‰è£… runtime"></a>å®‰è£… runtime</h3><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">Containerd</button><button type="button" class="tab">Docker</button></div><div class="tab-contents"><div class="tab-item-content active"><h4 id="å…ˆå†³æ¡ä»¶"><a href="#å…ˆå†³æ¡ä»¶" class="headerlink" title="å…ˆå†³æ¡ä»¶"></a>å…ˆå†³æ¡ä»¶</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF | sudo tee /etc/modules-load.d/containerd.conf</span></span><br><span class="line"><span class="string">overlay</span></span><br><span class="line"><span class="string">br_netfilter</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">sudo modprobe overlay</span><br><span class="line">sudo modprobe br_netfilter</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®å¿…éœ€çš„ sysctl å‚æ•°ï¼Œè¿™äº›å‚æ•°åœ¨é‡æ–°å¯åŠ¨åä»ç„¶å­˜åœ¨ã€‚</span></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF | sudo tee /etc/sysctl.d/99-kubernetes-cri.conf</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-iptables  = 1</span></span><br><span class="line"><span class="string">net.ipv4.ip_forward                 = 1</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-ip6tables = 1</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åº”ç”¨ sysctl å‚æ•°è€Œæ— éœ€é‡æ–°å¯åŠ¨</span></span><br><span class="line">sudo sysctl --system</span><br></pre></td></tr></table></figure><h4 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¸è½½æ—§ç‰ˆæœ¬Docker</span></span><br><span class="line">sudo yum remove docker \</span><br><span class="line">        docker-client \</span><br><span class="line">        docker-client-latest \</span><br><span class="line">        docker-common \</span><br><span class="line">        docker-latest \</span><br><span class="line">        docker-latest-logrotate \</span><br><span class="line">        docker-logrotate \</span><br><span class="line">        docker-engine</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…dockerä»“åº“</span></span><br><span class="line">sudo yum install -y yum-utils</span><br><span class="line">sudo yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https://download.docker.com/linux/centos/docker-ce.repo</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…containerd</span></span><br><span class="line">sudo yum install containerd.io -y</span><br></pre></td></tr></table></figure><h4 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h4><p>ç”Ÿæˆé»˜è®¤é…ç½®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">mkdir</span> -p /etc/containerd</span><br><span class="line">containerd config default | sudo <span class="built_in">tee</span> /etc/containerd/config.toml</span><br></pre></td></tr></table></figure><p>ç»“åˆ runc ä½¿ç”¨ systemd cgroup é©±åŠ¨ï¼Œåœ¨ <code>/etc/containerd/config.toml</code> ä¸­è®¾ç½®</p><figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.runtimes.runc]</span></span><br><span class="line">...</span><br><span class="line"><span class="section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.runtimes.runc.options]</span></span><br><span class="line">   <span class="attr">SystemdCgroup</span> = <span class="literal">true</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl <span class="built_in">enable</span> containerd</span><br><span class="line">sudo systemctl restart containerd</span><br></pre></td></tr></table></figure><h4 id="crictl-é…ç½®"><a href="#crictl-é…ç½®" class="headerlink" title="crictl é…ç½®"></a>crictl é…ç½®</h4><p>ä¹‹å‰ä½¿ç”¨ docker çš„æ—¶å€™ï¼Œdocker ç»™æˆ‘ä»¬åšäº†å¾ˆå¤šå¥½ç”¨çš„å·¥å…·ï¼Œç°åœ¨ç”¨äº† containerdï¼Œç®¡ç†å®¹å™¨æˆ‘ä»¬ç”¨ cri ç®¡ç†å·¥å…· crictlï¼Œåˆ›å»ºé…ç½®æ–‡ä»¶</p><p>vim &#x2F;etc&#x2F;crictl.yaml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">runtime-endpoint:</span> <span class="string">unix:///run/containerd/containerd.sock</span></span><br><span class="line"><span class="attr">debug:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><h4 id="å®‰è£…-Docker"><a href="#å®‰è£…-Docker" class="headerlink" title="å®‰è£… Docker"></a>å®‰è£… Docker</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -fsSL get.docker.com | bash</span><br></pre></td></tr></table></figure><h4 id="é…ç½®-Doker"><a href="#é…ç½®-Doker" class="headerlink" title="é…ç½® Doker"></a>é…ç½® Doker</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">mkdir</span> /etc/docker</span><br><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF | sudo tee /etc/docker/daemon.json</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  &quot;exec-opts&quot;: [&quot;native.cgroupdriver=systemd&quot;],</span></span><br><span class="line"><span class="string">  &quot;log-driver&quot;: &quot;json-file&quot;,</span></span><br><span class="line"><span class="string">  &quot;log-opts&quot;: &#123;</span></span><br><span class="line"><span class="string">    &quot;max-size&quot;: &quot;100m&quot;</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">  &quot;storage-driver&quot;: &quot;overlay2&quot;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">sudo systemctl <span class="built_in">enable</span> --now docker</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div><h3 id="å®‰è£…-kubeadmã€kubelet-å’Œ-kubectl"><a href="#å®‰è£…-kubeadmã€kubelet-å’Œ-kubectl" class="headerlink" title="å®‰è£… kubeadmã€kubelet å’Œ kubectl"></a>å®‰è£… kubeadmã€kubelet å’Œ kubectl</h3><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">ä½¿ç”¨å®˜æ–¹ä»“åº“</button><button type="button" class="tab">ä½¿ç”¨é˜¿é‡Œäº‘é•œåƒä»“åº“</button></div><div class="tab-contents"><div class="tab-item-content active"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF | sudo tee /etc/yum.repos.d/kubernetes.repo</span></span><br><span class="line"><span class="string">[kubernetes]</span></span><br><span class="line"><span class="string">name=Kubernetes</span></span><br><span class="line"><span class="string">baseurl=https://packages.cloud.google.com/yum/repos/kubernetes-el7-\$basearch</span></span><br><span class="line"><span class="string">enabled=1</span></span><br><span class="line"><span class="string">gpgcheck=0</span></span><br><span class="line"><span class="string">repo_gpgcheck=0</span></span><br><span class="line"><span class="string">gpgkey=https://packages.cloud.google.com/yum/doc/yum-key.gpg https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg</span></span><br><span class="line"><span class="string">exclude=kubelet kubeadm kubectl</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sudo yum install -y kubelet-1.21.10-0 kubeadm-1.21.10-0 kubectl-1.21.10-0 --disableexcludes=kubernetes</span><br><span class="line"></span><br><span class="line">sudo systemctl <span class="built_in">enable</span> --now kubelet</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºä»“åº“æ–‡ä»¶</span></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF &gt; /etc/yum.repos.d/kubernetes.repo</span></span><br><span class="line"><span class="string">[kubernetes]</span></span><br><span class="line"><span class="string">name=Kubernetes</span></span><br><span class="line"><span class="string">baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/</span></span><br><span class="line"><span class="string">enabled=1</span></span><br><span class="line"><span class="string">gpgcheck=0</span></span><br><span class="line"><span class="string">repo_gpgcheck=0</span></span><br><span class="line"><span class="string">gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„kubeadm</span></span><br><span class="line">yum install -y --nogpgcheck kubelet-1.21.10-0 kubeadm-1.21.10-0 kubectl-1.21.10-0</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨kubelet</span></span><br><span class="line">systemctl <span class="built_in">enable</span> --now kubelet</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div><h2 id="å‡†å¤‡é«˜å¯ç”¨æ–¹æ¡ˆ"><a href="#å‡†å¤‡é«˜å¯ç”¨æ–¹æ¡ˆ" class="headerlink" title="å‡†å¤‡é«˜å¯ç”¨æ–¹æ¡ˆ"></a>å‡†å¤‡é«˜å¯ç”¨æ–¹æ¡ˆ</h2><p><a href="/posts/10cef768/">Kubernetesä¹‹masteré«˜å¯ç”¨æ–¹æ¡ˆ</a></p><h2 id="åˆ›å»ºé›†ç¾¤"><a href="#åˆ›å»ºé›†ç¾¤" class="headerlink" title="åˆ›å»ºé›†ç¾¤"></a>åˆ›å»ºé›†ç¾¤</h2><h3 id="kubeadm-init"><a href="#kubeadm-init" class="headerlink" title="kubeadm init"></a>kubeadm init</h3><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">å®˜æ–¹é•œåƒæº</button><button type="button" class="tab">å›½å†…é˜¿é‡Œäº‘é•œåƒæº</button></div><div class="tab-contents"><div class="tab-item-content active"><p>åœ¨ init ä¹‹å‰å…ˆå°†é•œåƒæ‹‰å–åˆ°æœ¬åœ°ï¼ˆå¯é€‰æ­¥éª¤ï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubeadm config images pull --kubernetes-version 1.21.10</span><br></pre></td></tr></table></figure><p>åœ¨ k8s-master0 ä¸Šæ‰§è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo kubeadm init \</span><br><span class="line">--kubernetes-version 1.21.10 \</span><br><span class="line">--control-plane-endpoint <span class="string">&quot;kube-apiserver:6443&quot;</span> \</span><br><span class="line">--upload-certs \</span><br><span class="line">--service-cidr=10.96.0.0/12 \</span><br><span class="line">--pod-network-cidr=10.244.0.0/16</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><p>åœ¨ init ä¹‹å‰å…ˆå°†é•œåƒæ‹‰å–åˆ°æœ¬åœ°ï¼ˆå¯é€‰æ­¥éª¤ï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubeadm config images pull --kubernetes-version 1.21.10 --image-repository registry.cn-hangzhou.aliyuncs.com/google_containers</span><br></pre></td></tr></table></figure><p>åœ¨ k8s-master0 ä¸Šæ‰§è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo kubeadm init \</span><br><span class="line">--kubernetes-version 1.21.10 \</span><br><span class="line">--control-plane-endpoint <span class="string">&quot;kube-apiserver:6443&quot;</span> \</span><br><span class="line">--image-repository registry.cn-hangzhou.aliyuncs.com/google_containers \</span><br><span class="line">--upload-certs \</span><br><span class="line">--service-cidr=10.96.0.0/12 \</span><br><span class="line">--pod-network-cidr=10.244.0.0/16</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div><blockquote><p>ä¹Ÿå¯ä»¥ç”¨ <code>kubeadm config print init-defaults &gt; init.yaml</code> ç”Ÿæˆ kubeadm çš„é…ç½®ï¼Œå¹¶ç”¨<br><code>kubeadm init --config=init.yaml</code> æ¥åˆ›å»ºé›†ç¾¤ã€‚</p></blockquote><h3 id="å®‰è£…ç½‘ç»œæ’ä»¶"><a href="#å®‰è£…ç½‘ç»œæ’ä»¶" class="headerlink" title="å®‰è£…ç½‘ç»œæ’ä»¶"></a>å®‰è£…ç½‘ç»œæ’ä»¶</h3><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">å®‰è£…flannelæ’ä»¶</button><button type="button" class="tab">å®‰è£…calicoæ’ä»¶</button></div><div class="tab-contents"><div class="tab-item-content active"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å¾…è¡¥å……</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div><h2 id="å¸¸è§é—®é¢˜"><a href="#å¸¸è§é—®é¢˜" class="headerlink" title="å¸¸è§é—®é¢˜"></a>å¸¸è§é—®é¢˜</h2><p><a href="/posts/sepu3k/">kubeadm éƒ¨ç½²çš„é›†ç¾¤ å¸¸è§é—®é¢˜æ±‡æ€»</a></p>]]></content>
      
      
      <categories>
          
          <category> å®¹å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
            <tag> Linux </tag>
            
            <tag> Docker </tag>
            
            <tag> Container </tag>
            
            <tag> Kubernetes </tag>
            
            <tag> kubeadm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é…ç½®æ ‘è“æ´¾å…³æœºæ—¶æ­£å¸¸åœè½¬ç§»åŠ¨ç¡¬ç›˜</title>
      <link href="/posts/8e3fdb74/"/>
      <url>/posts/8e3fdb74/</url>
      
        <content type="html"><![CDATA[<p>å°†é—²ç½®çš„æ ‘è“æ´¾åšä¸ªå…±äº«æœåŠ¡å™¨ï¼Œåœ¨å®¶é‡Œé¢å­˜ä¸€äº›æ–‡ä»¶ç”¨ã€‚å°†æ ‘è“æ´¾å’Œç§»åŠ¨ç¡¬ç›˜ç›’éƒ½å·²ç»æ”¹è£…å¥½äº†ï¼Œå›ºå®šåœ¨äº†ä¸€èµ·ï¼Œç”¨ä¸€å— 12864 æ¥æ˜¾ç¤ºä¸€äº›ä¿¡æ¯ï¼Œæ¯”å¦‚ç£ç›˜ç©ºé—´å ç”¨ç­‰ã€‚</p><p>æ ‘è“æ´¾ 3B+ çš„åƒå…†ç½‘å£å’Œ usb æ¥å£ç›¸å½“äºæ˜¯ä¸€ä¸ª usb2.0 hub åˆ†å‡ºæ¥çš„ï¼Œ é€Ÿåº¦æ ¹æœ¬è¾¾ä¸åˆ°åƒå…†ï¼Œè¿˜æŠ¢å  usb çš„å¸¦å®½ã€‚å®æµ‹é€Ÿåº¦ 20M&#x2F;s å·¦å³ï¼ˆç¡¬ç›˜é€Ÿåº¦èƒ½è·‘åˆ° 100M&#x2F;sï¼‰</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/raspberrypi-3b+.jpg" alt="æ ‘è“æ´¾3B+"></p><h2 id="é‡åˆ°çš„é—®é¢˜"><a href="#é‡åˆ°çš„é—®é¢˜" class="headerlink" title="é‡åˆ°çš„é—®é¢˜"></a>é‡åˆ°çš„é—®é¢˜</h2><p>æ¯æ¬¡å…³æœºæˆ–è€…é‡å¯çš„æ—¶å€™ï¼Œéƒ½ä¼šé‡åˆ°ç¡¬ç›˜å±~çš„ä¸€å£°ï¼Œè¿™ç§æƒ…å†µæ˜¯æ“ä½œç³»ç»Ÿå…³æœºçš„æ—¶å€™æ²¡æœ‰é€šçŸ¥ç¡¬ç›˜ç£å¤´å½’ä½ç›´æ¥æ–­ç”µï¼Œ è¿™æ ·ç¡¬ç›˜ä¼šè‡ªå·±å°†ç£å¤´å½’ä½ï¼Œå°±ä¼šæœ‰å£°éŸ³ã€‚æ—¶é—´ä¹…äº†å¯¹æœºæ¢°ç¡¬ç›˜æ˜¯ä¸€ç§æŸä¼¤ã€‚</p><p>å‚è€ƒ<a href="http://www.linux-ata.org/shutdown.html">http://www.linux-ata.org/shutdown.html</a></p><h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><h3 id="æŸ¥æ‰¾ç¡¬ç›˜å¯åœé…ç½®"><a href="#æŸ¥æ‰¾ç¡¬ç›˜å¯åœé…ç½®" class="headerlink" title="æŸ¥æ‰¾ç¡¬ç›˜å¯åœé…ç½®"></a>æŸ¥æ‰¾ç¡¬ç›˜å¯åœé…ç½®</h3><p>åœ¨ linux ç³»ç»Ÿé‡Œé¢ï¼Œä¸€åˆ‡çš†æ–‡ä»¶ï¼Œç¡¬ç›˜çš„å„ç§ä¿¡æ¯ä¹Ÿä¸åˆ—å¤–ã€‚æˆ‘ä»¬å¯ä»¥åˆ° <code>/sys/class/scsi_disk/</code> æ‰¾è‡ªå·±çš„ç¡¬ç›˜ï¼Œå¯ä»¥é€šè¿‡æŸ¥çœ‹ç¡¬ç›˜çš„å‹å·æ¥ç¡®å®š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /sys/class/scsi_disk/0:0:0:0/device/model</span><br></pre></td></tr></table></figure><p>æ–‡ä»¶ <code>manage_start_stop</code> å°±æ˜¯é…ç½®ç£å¤´å½’ä½çš„ï¼Œåªéœ€è¦å°†æ­¤æ–‡ä»¶å†…å®¹è®¾ç½®æˆ 1 å³å¯ã€‚éœ€è¦æ¯æ¬¡å¼€æœºåéƒ½æ‰§è¡Œã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo bash -c <span class="string">&quot;echo 1 &gt; /sys/class/scsi_disk/0\:0\:0\:0/manage_start_stop&quot;</span></span><br></pre></td></tr></table></figure><h3 id="ä¹Ÿå¯ä»¥æ‰¹é‡å¯¹æ‰€æœ‰ç¡¬ç›˜æ‰§è¡Œè¿™ä¸ªæ“ä½œ"><a href="#ä¹Ÿå¯ä»¥æ‰¹é‡å¯¹æ‰€æœ‰ç¡¬ç›˜æ‰§è¡Œè¿™ä¸ªæ“ä½œ" class="headerlink" title="ä¹Ÿå¯ä»¥æ‰¹é‡å¯¹æ‰€æœ‰ç¡¬ç›˜æ‰§è¡Œè¿™ä¸ªæ“ä½œ"></a>ä¹Ÿå¯ä»¥æ‰¹é‡å¯¹æ‰€æœ‰ç¡¬ç›˜æ‰§è¡Œè¿™ä¸ªæ“ä½œ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> /sys/class/scsi_disk/*/manage_start_stop;<span class="keyword">do</span> <span class="built_in">echo</span> 1 &gt; <span class="variable">$i</span>;<span class="keyword">done</span></span><br></pre></td></tr></table></figure><h3 id="è®¾ç½®å¼€æœºè‡ªå¯åŠ¨"><a href="#è®¾ç½®å¼€æœºè‡ªå¯åŠ¨" class="headerlink" title="è®¾ç½®å¼€æœºè‡ªå¯åŠ¨"></a>è®¾ç½®å¼€æœºè‡ªå¯åŠ¨</h3><p>ä¸ªäººå–œæ¬¢ä½¿ç”¨ systemd æ¥è¿›è¡Œå¼€æœºè‡ªå¯åŠ¨</p><p><code>vim /etc/systemd/system/custom.service</code></p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Unit]</span></span><br><span class="line"><span class="attr">Description</span> = Custom Startup Service</span><br><span class="line"></span><br><span class="line"><span class="section">[Service]</span></span><br><span class="line"><span class="attr">Type</span> = simple</span><br><span class="line"><span class="attr">ExecStart</span> = /opt/scripts/custom.sh</span><br><span class="line"></span><br><span class="line"><span class="section">[Install]</span></span><br><span class="line"><span class="attr">WantedBy</span> = multi-user.target</span><br></pre></td></tr></table></figure><p>å°†éœ€è¦å¼€æœºè‡ªå®šçš„å‘½ä»¤å†™åˆ° <code>/opt/scripts/custom.sh</code> é‡Œé¢</p><p><code>sudo systemctl enable custom.service</code></p>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Disk </tag>
            
            <tag> å¼€å‘ç‰ˆ </tag>
            
            <tag> æ ‘è“æ´¾ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Kubernetesé›†ç¾¤è°ƒåº¦ä¹‹èŠ‚ç‚¹äº²å’Œæ€§ã€Podäº²å’Œæ€§ã€æ±¡ç‚¹ä¸å®¹å¿</title>
      <link href="/posts/aec8a52c/"/>
      <url>/posts/aec8a52c/</url>
      
        <content type="html"><![CDATA[<h2 id="è°ƒåº¦å™¨"><a href="#è°ƒåº¦å™¨" class="headerlink" title="è°ƒåº¦å™¨"></a>è°ƒåº¦å™¨</h2><p>Scheduler æ˜¯ Kubernetes çš„è°ƒåº¦å™¨ï¼Œä¸»è¦çš„ä»»åŠ¡æ˜¯æŠŠå®šä¹‰çš„ pod åˆ†é…åˆ°é›†ç¾¤çš„èŠ‚ç‚¹ä¸Šã€‚å¬èµ·æ¥éå¸¸ç®€å•ï¼Œä½†æœ‰å¾ˆå¤šè¦è€ƒè™‘çš„é—®é¢˜ï¼š</p><ul><li>å…¬å¹³ï¼šå¦‚ä½•ä¿è¯æ¯ä¸ªèŠ‚ç‚¹éƒ½èƒ½è¢«åˆ†é…èµ„æº</li><li>èµ„æºé«˜æ•ˆåˆ©ç”¨ï¼šé›†ç¾¤æ‰€æœ‰èµ„æºæœ€å¤§åŒ–è¢«ä½¿ç”¨</li><li>æ•ˆç‡ï¼šè°ƒåº¦çš„æ€§èƒ½è¦å¥½ï¼Œèƒ½å¤Ÿå°½å¿«åœ°å¯¹å¤§æ‰¹é‡çš„ pod å®Œæˆè°ƒåº¦å·¥ä½œ</li><li>çµæ´»ï¼šå…è®¸ç”¨æˆ·æ ¹æ®è‡ªå·±çš„éœ€æ±‚æ§åˆ¶è°ƒåº¦çš„é€»è¾‘ k</li></ul><p>Scheduler æ˜¯ä½œä¸ºå•ç‹¬çš„ç¨‹åºè¿è¡Œçš„ï¼Œå¯åŠ¨ä¹‹åä¼šä¸€ç›´ç›‘å¬ API Serverï¼Œè·å– PodSpec.NodeName ä¸ºç©ºçš„ podï¼Œå¯¹æ¯ä¸ª pod éƒ½ä¼šåˆ›å»ºä¸€ä¸ª bindingï¼ˆå¿…é¡»éµå®ˆçš„ï¼‰ï¼Œè¡¨æ˜è¯¥ pod åº”è¯¥æ”¾åˆ°å“ªä¸ªèŠ‚ç‚¹ä¸Š</p><h3 id="è°ƒåº¦è¿‡ç¨‹"><a href="#è°ƒåº¦è¿‡ç¨‹" class="headerlink" title="è°ƒåº¦è¿‡ç¨‹"></a>è°ƒåº¦è¿‡ç¨‹</h3><p>è°ƒåº¦åˆ†ä¸ºå‡ ä¸ªæ­¥éª¤ï¼š</p><ol><li>é¦–å…ˆæ˜¯è¿‡æ»¤æ‰ä¸æ»¡è¶³æ¡ä»¶çš„èŠ‚ç‚¹ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸º predicateï¼ˆé¢„é€‰ï¼‰ï¼›</li><li>ç„¶åå¯¹é€šè¿‡çš„èŠ‚ç‚¹æŒ‰ç…§ä¼˜å…ˆçº§æ’åºï¼Œè¿™ä¸ªæ˜¯ priorityï¼ˆä¼˜é€‰ï¼‰ï¼›</li><li>æœ€åä»ä¸­é€‰æ‹©ä¼˜å…ˆçº§æœ€é«˜çš„èŠ‚ç‚¹ã€‚</li></ol><p>Predicateï¼ˆé¢„é€‰ï¼‰æœ‰ä¸€ç³»åˆ—çš„ç®—æ³•å¯ä»¥ä½¿ç”¨ï¼š</p><table><thead><tr><th>ç®—æ³•</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>PodFitsResources</td><td>èŠ‚ç‚¹ä¸Šå‰©ä½™çš„èµ„æºæ˜¯å¦å¤§äº pod è¯·æ±‚çš„èµ„æº</td></tr><tr><td>PodFitsHost</td><td>å¦‚æœ pod æŒ‡å®šäº† NodeNameï¼Œæ£€æŸ¥èŠ‚ç‚¹åç§°æ˜¯å¦å’Œ NodeName åŒ¹é…</td></tr><tr><td>PodFitsHostPorts</td><td>èŠ‚ç‚¹ä¸Šå·²ç»ä½¿ç”¨çš„ port æ˜¯å¦å’Œ pod ç”³è¯·çš„ port å†²çª</td></tr><tr><td>PodSelectorMatches</td><td>è¿‡æ»¤æ‰å’Œ pod æŒ‡å®šçš„ label ä¸åŒ¹é…çš„èŠ‚ç‚¹</td></tr><tr><td>NoDiskConflict</td><td>å·²ç» mount çš„ volume å’Œ pod æŒ‡å®šçš„ volume ä¸å†²çªï¼Œé™¤éå®ƒä»¬éƒ½æ˜¯åªè¯»</td></tr></tbody></table><p>å¦‚æœåœ¨ predicate è¿‡ç¨‹ä¸­æ²¡æœ‰åˆé€‚çš„èŠ‚ç‚¹ï¼Œpod ä¼šä¸€ç›´åœ¨ pending çŠ¶æ€ï¼Œä¸æ–­é‡è¯•è°ƒåº¦ï¼Œç›´åˆ°æœ‰èŠ‚ç‚¹æ»¡è¶³æ¡ä»¶ã€‚ç»è¿‡è¿™ä¸ªæ­¥éª¤ï¼Œå¦‚æœæœ‰å¤šä¸ªèŠ‚ç‚¹æ»¡è¶³æ¡ä»¶ï¼Œå°±ç»§ç»­ priorities è¿‡ç¨‹ï¼šæŒ‰ç…§ä¼˜å…ˆçº§å¤§å°å¯¹èŠ‚ç‚¹æ’åº</p><p><strong>ä¼˜å…ˆçº§ç”±ä¸€ç³»åˆ—é”®å€¼å¯¹ç»„æˆï¼Œé”®æ˜¯è¯¥ä¼˜å…ˆçº§é¡¹çš„åç§°ï¼Œå€¼æ˜¯å®ƒçš„æƒé‡ï¼ˆè¯¥é¡¹çš„é‡è¦æ€§ï¼‰ã€‚è¿™äº›ä¼˜å…ˆçº§é€‰é¡¹åŒ…æ‹¬ï¼š</strong></p><table><thead><tr><th>ç®—æ³•</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>LeastRequestedPriority</td><td>é€šè¿‡è®¡ç®— CPU å’Œ Memory çš„ä½¿ç”¨ç‡æ¥å†³å®šæƒé‡ï¼Œä½¿ç”¨ç‡è¶Šä½æƒé‡è¶Šé«˜ã€‚æ¢å¥è¯è¯´ï¼Œè¿™ä¸ªä¼˜å…ˆçº§æŒ‡æ ‡å€¾å‘äºèµ„æºä½¿ç”¨æ¯”ä¾‹æ›´ä½çš„èŠ‚ç‚¹</td></tr><tr><td>BalancedResourceAllocation</td><td>èŠ‚ç‚¹ä¸Š CPU å’Œ Memory ä½¿ç”¨ç‡è¶Šæ¥è¿‘ï¼Œæƒé‡è¶Šé«˜ã€‚è¿™ä¸ªåº”è¯¥å’Œä¸Šé¢çš„ä¸€èµ·ä½¿ç”¨ï¼Œä¸åº”è¯¥å•ç‹¬ä½¿ç”¨</td></tr><tr><td>ImageLocalityPriority</td><td>å€¾å‘äºå·²ç»æœ‰è¦ä½¿ç”¨é•œåƒçš„èŠ‚ç‚¹ï¼Œé•œåƒæ€»å¤§å°å€¼è¶Šå¤§ï¼Œæƒé‡è¶Šé«˜</td></tr></tbody></table><p>é€šè¿‡ç®—æ³•å¯¹æ‰€æœ‰çš„ä¼˜å…ˆçº§é¡¹ç›®å’Œæƒé‡è¿›è¡Œè®¡ç®—ï¼Œå¾—å‡ºæœ€ç»ˆçš„ç»“æœ</p><h2 id="èŠ‚ç‚¹äº²å’Œæ€§"><a href="#èŠ‚ç‚¹äº²å’Œæ€§" class="headerlink" title="èŠ‚ç‚¹äº²å’Œæ€§"></a>èŠ‚ç‚¹äº²å’Œæ€§</h2><p>pod.spec.nodeAffinity</p><ul><li>preferredDuringSchedulingIgnoredDuringExecutionï¼ˆä¼˜å…ˆæ‰§è¡Œè®¡åˆ’ï¼‰ï¼šè½¯ç­–ç•¥</li><li>requiredDuringSchedulingIgnoredDuringExecutionï¼ˆè¦æ±‚æ‰§è¡Œè®¡åˆ’ï¼‰ï¼šç¡¬ç­–ç•¥</li></ul><p>é”®å€¼è¿ç®—å…³ç³»</p><table><thead><tr><th>è¿ç®—ç¬¦</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>In</td><td>label çš„å€¼åœ¨æŸä¸ªåˆ—è¡¨ä¸­</td></tr><tr><td>NotIn</td><td>label çš„å€¼ä¸åœ¨æŸä¸ªåˆ—è¡¨ä¸­</td></tr><tr><td>Gt</td><td>label çš„å€¼å¤§äºæŸä¸ªå€¼</td></tr><tr><td>Lt</td><td>label çš„å€¼å°äºæŸä¸ªå€¼</td></tr><tr><td>Exists</td><td>æŸä¸ª label å­˜åœ¨</td></tr><tr><td>DoesNotExist</td><td>æŸä¸ª label ä¸å­˜åœ¨</td></tr></tbody></table><p>æ ‡ç­¾æ“ä½œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹label</span></span><br><span class="line">kubectl get node --show-labels</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ label</span></span><br><span class="line">kubectl label nodes 192.168.15.182 nodetype=hci</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤label</span></span><br><span class="line">kubectl label nodes 192.168.15.182 nodetype-</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹label</span></span><br><span class="line">kubectl label nodes 192.168.15.182 nodetype=vmware --overwrite</span><br></pre></td></tr></table></figure><h3 id="ç¡¬ç­–ç•¥ï¼šrequiredDuringSchedulingIgnoredDuringExecution"><a href="#ç¡¬ç­–ç•¥ï¼šrequiredDuringSchedulingIgnoredDuringExecution" class="headerlink" title="ç¡¬ç­–ç•¥ï¼šrequiredDuringSchedulingIgnoredDuringExecution"></a>ç¡¬ç­–ç•¥ï¼šrequiredDuringSchedulingIgnoredDuringExecution</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#èŠ‚ç‚¹ç¡¬ç­–ç•¥ã€‚æ’é™¤node02ï¼Œåªèƒ½åœ¨node01ä¸Šè¿è¡Œ</span></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: affinity</span><br><span class="line">  labels:</span><br><span class="line">    app: node-affinity-pod</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - name: with-node-affinity</span><br><span class="line">    image: hub.atguigu.com/library/myapp:v1</span><br><span class="line">  affinity:            <span class="comment">#äº²å’Œæ€§</span></span><br><span class="line">    nodeAffinity:        <span class="comment">#nodeäº²å’Œæ€§</span></span><br><span class="line">      <span class="comment"># ç¡¬äº²å’Œæ€§é™åˆ¶</span></span><br><span class="line">      requiredDuringSchedulingIgnoredDuringExecution:</span><br><span class="line">        nodeSelectorTerms:</span><br><span class="line">        - matchExpressions:</span><br><span class="line">          - key: kubernetes.io/hostname <span class="comment"># æ ‡ç­¾é”®å</span></span><br><span class="line">            operator: NotIn      <span class="comment">#é”®å€¼è¿ç®—å…³ç³» ï¼ŒNotIn:labelçš„å€¼ä¸åœ¨æŸä¸ªåˆ—è¡¨ä¸­ã€‚ è¡¨ç¤ºä¸æ˜¯node02èŠ‚ç‚¹å°±å¯è¿è¡Œ</span></span><br><span class="line">            values:</span><br><span class="line">            - k8s-node02 <span class="comment"># æ ‡ç­¾é”®å€¼</span></span><br></pre></td></tr></table></figure><h3 id="è½¯ç­–ç•¥ï¼špreferredDuringSchedulingIgnoredDuringExecution"><a href="#è½¯ç­–ç•¥ï¼špreferredDuringSchedulingIgnoredDuringExecution" class="headerlink" title="è½¯ç­–ç•¥ï¼špreferredDuringSchedulingIgnoredDuringExecution"></a>è½¯ç­–ç•¥ï¼špreferredDuringSchedulingIgnoredDuringExecution</h3><p>å¦‚æœæœ‰çš„è¯å°±åœ¨ä¸Šé¢è¿è¡Œï¼Œæ²¡æœ‰çš„è¯å°±ç®—äº†</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#è½¯ç­–ç•¥</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">affinity2</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">node-affinity-pod</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">with-node-affinity</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">hub.atguigu.com/library/myapp:v1</span></span><br><span class="line">  <span class="attr">affinity:</span></span><br><span class="line">    <span class="attr">nodeAffinity:</span></span><br><span class="line">      <span class="attr">preferredDuringSchedulingIgnoredDuringExecution:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">weight:</span> <span class="number">1</span>   <span class="comment">#æƒé‡ï¼Œæƒé‡è¶Šå¤§è¶Šäº²å’Œ(å¤šä¸ªè½¯ç­–ç•¥çš„æƒ…å†µ)</span></span><br><span class="line">        <span class="attr">preference:</span> </span><br><span class="line">          <span class="attr">matchExpressions:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">kubernetes.io/hostname</span></span><br><span class="line">            <span class="attr">operator:</span> <span class="string">In</span></span><br><span class="line">            <span class="attr">values:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">k8s-node03</span>  <span class="comment"># æœŸæœ›æ˜¯node03</span></span><br></pre></td></tr></table></figure><h3 id="è½¯ç¡¬ç­–ç•¥ï¼ˆå…ˆæ»¡è¶³ç¡¬ç­–ç•¥å†æ»¡è¶³è½¯ç­–ç•¥ï¼‰"><a href="#è½¯ç¡¬ç­–ç•¥ï¼ˆå…ˆæ»¡è¶³ç¡¬ç­–ç•¥å†æ»¡è¶³è½¯ç­–ç•¥ï¼‰" class="headerlink" title="è½¯ç¡¬ç­–ç•¥ï¼ˆå…ˆæ»¡è¶³ç¡¬ç­–ç•¥å†æ»¡è¶³è½¯ç­–ç•¥ï¼‰"></a>è½¯ç¡¬ç­–ç•¥ï¼ˆå…ˆæ»¡è¶³ç¡¬ç­–ç•¥å†æ»¡è¶³è½¯ç­–ç•¥ï¼‰</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#è½¯ç¡¬åˆä½“</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">affinity2</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">node-affinity-pod</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">with-node-affinity</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">hub.atguigu.com/library/myapp:v1</span></span><br><span class="line">  <span class="attr">affinity:</span></span><br><span class="line">    <span class="attr">nodeAffinity:</span>        <span class="comment">#nodeäº²å’Œæ€§</span></span><br><span class="line">      <span class="comment"># ç¡¬äº²å’Œæ€§é™åˆ¶</span></span><br><span class="line">      <span class="attr">requiredDuringSchedulingIgnoredDuringExecution:</span></span><br><span class="line">        <span class="attr">nodeSelectorTerms:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">matchExpressions:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">kubernetes.io/hostname</span> <span class="comment"># æ ‡ç­¾é”®å</span></span><br><span class="line">            <span class="attr">operator:</span> <span class="string">NotIn</span>      <span class="comment">#é”®å€¼è¿ç®—å…³ç³» ï¼ŒNotIn:labelçš„å€¼ä¸åœ¨æŸä¸ªåˆ—è¡¨ä¸­ã€‚ è¡¨ç¤ºä¸æ˜¯node02èŠ‚ç‚¹å°±å¯è¿è¡Œ</span></span><br><span class="line">            <span class="attr">values:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">k8s-node02</span> <span class="comment"># æ ‡ç­¾é”®å€¼</span></span><br><span class="line">      <span class="attr">preferredDuringSchedulingIgnoredDuringExecution:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">weight:</span> <span class="number">1</span>   <span class="comment">#æƒé‡ï¼Œæƒé‡è¶Šå¤§è¶Šäº²å’Œ(å¤šä¸ªè½¯ç­–ç•¥çš„æƒ…å†µ)</span></span><br><span class="line">        <span class="attr">preference:</span> </span><br><span class="line">          <span class="attr">matchExpressions:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">kubernetes.io/hostname</span></span><br><span class="line">            <span class="attr">operator:</span> <span class="string">In</span></span><br><span class="line">            <span class="attr">values:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">k8s-node03</span>  <span class="comment"># æœŸæœ›æ˜¯node03</span></span><br></pre></td></tr></table></figure><h2 id="Pod-äº²å’Œæ€§ï¼ˆpod-ä¸-pod-ä¹‹é—´çš„äº²å’Œæ€§ï¼‰"><a href="#Pod-äº²å’Œæ€§ï¼ˆpod-ä¸-pod-ä¹‹é—´çš„äº²å’Œæ€§ï¼‰" class="headerlink" title="Pod äº²å’Œæ€§ï¼ˆpod ä¸ pod ä¹‹é—´çš„äº²å’Œæ€§ï¼‰"></a>Pod äº²å’Œæ€§ï¼ˆpod ä¸ pod ä¹‹é—´çš„äº²å’Œæ€§ï¼‰</h2><p>pod.spec.affinity.podAffinity&#x2F;podAntiAffinity</p><ul><li>preferredDuringSchedulingIgnoredDuringExecutionï¼šè½¯ç­–ç•¥</li><li>requiredDuringSchedulingIgnoredDuringExecutionï¼šç¡¬ç­–ç•¥</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pod-3</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">pod-3</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">pod-3</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">hub.atguigu.com/library/myapp:v1</span></span><br><span class="line">  <span class="attr">affinity:</span></span><br><span class="line">    <span class="comment">#æƒ³è®©ä¸¤ä¸ªpodè¿è¡Œåœ¨åŒä¸€ä¸ªnodeä¸Š</span></span><br><span class="line">    <span class="attr">podAffinity:</span></span><br><span class="line">      <span class="comment">#ç¡¬ç­–ç•¥</span></span><br><span class="line">      <span class="attr">requiredDuringSchedulingIgnoredDuringExecution:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">labelSelector:</span>  <span class="comment">#æ ‡ç­¾é€‰æ‹©</span></span><br><span class="line">          <span class="attr">matchExpressions:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">app</span> <span class="comment">#å½“appå­˜åœ¨node-affinity-podæ—¶å°±é€‰æ‹©</span></span><br><span class="line">            <span class="attr">operator:</span> <span class="string">In</span></span><br><span class="line">            <span class="attr">values:</span> </span><br><span class="line">            <span class="bullet">-</span> <span class="string">node-affinity-pod</span></span><br><span class="line">        <span class="attr">topologyKey:</span> <span class="string">kubernetes.io/hostname</span> </span><br><span class="line">        <span class="comment">#hostnameåˆ¤æ–­æ˜¯å¦åœ¨åŒä¸€ä¸ªpodï¼Œå”¯ä¸€</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pod-4</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">pod-4</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">pod-4</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">hub.atguigu.com/library/myapp:v1</span></span><br><span class="line">  <span class="attr">affinity:</span></span><br><span class="line">    <span class="comment">#ä¸æƒ³è®©ä¸¤ä¸ªpodè¿è¡Œåœ¨åŒä¸€ä¸ªnodeä¸Š</span></span><br><span class="line">    <span class="comment">#åŒ¹é…æ ‡ç­¾å¦‚æœapp=pod-2ï¼Œé‚£ä¹ˆåˆ™ä¸è¿è¡Œåœ¨è¿™ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">    <span class="attr">podAntiAffinity:</span></span><br><span class="line">      <span class="comment">#è½¯ç­–ç•¥</span></span><br><span class="line">      <span class="attr">preferredDuringSchedulingIgnoredDuringExecution:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">weight:</span> <span class="number">1</span></span><br><span class="line">        <span class="attr">podAffinityTerm:</span></span><br><span class="line">          <span class="attr">labelSelector:</span></span><br><span class="line">            <span class="attr">matchExpressions:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">app</span> <span class="comment">#åŒ¹é…app=node-affinity-pod</span></span><br><span class="line">              <span class="attr">operator:</span> <span class="string">In</span></span><br><span class="line">              <span class="attr">values:</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">node-affinity-pod</span></span><br><span class="line">          <span class="attr">topologyKey:</span> <span class="string">kubernetes.io/hostname</span></span><br></pre></td></tr></table></figure><h2 id="Taint-å’Œ-Toleration"><a href="#Taint-å’Œ-Toleration" class="headerlink" title="Taint å’Œ Toleration"></a>Taint å’Œ Toleration</h2><p>èŠ‚ç‚¹äº²å’Œæ€§ï¼Œæ˜¯ pod çš„ä¸€ç§å±æ€§ï¼ˆåå¥½æˆ–ç¡¬æ€§è¦æ±‚ï¼‰ï¼Œå®ƒä½¿ pod è¢«å¸å¼•åˆ°ä¸€ç±»ç‰¹å®šçš„èŠ‚ç‚¹ã€‚Taint åˆ™ç›¸åï¼Œå®ƒä½¿èŠ‚ç‚¹èƒ½å¤Ÿæ’æ–¥ä¸€ç±»ç‰¹å®šçš„ pod</p><p>Taint å’Œ toleration ç›¸äº’é…åˆï¼Œå¯ä»¥ç”¨æ¥é¿å… pod è¢«åˆ†é…åˆ°ä¸åˆé€‚çš„èŠ‚ç‚¹ä¸Šã€‚æ¯ä¸ªèŠ‚ç‚¹ä¸Šéƒ½å¯ä»¥åº”ç”¨ä¸€ä¸ªæˆ–å¤šä¸ª taint ï¼Œè¿™è¡¨ç¤ºå¯¹äºé‚£äº›ä¸èƒ½å®¹å¿è¿™äº› taint çš„ podï¼Œæ˜¯ä¸ä¼šè¢«è¯¥èŠ‚ç‚¹æ¥å—çš„ã€‚å¦‚æœå°† toleration åº”ç”¨äº pod ä¸Šï¼Œåˆ™è¡¨ç¤ºè¿™äº› pod å¯ä»¥ï¼ˆä½†ä¸è¦æ±‚ï¼‰è¢«è°ƒåº¦åˆ°å…·æœ‰åŒ¹é… taint çš„èŠ‚ç‚¹ä¸Š</p><h3 id="æ±¡ç‚¹-Taint"><a href="#æ±¡ç‚¹-Taint" class="headerlink" title="æ±¡ç‚¹ (Taint)"></a>æ±¡ç‚¹ (Taint)</h3><h4 id="1ã€æ±¡ç‚¹-Taint-çš„ç»„æˆ"><a href="#1ã€æ±¡ç‚¹-Taint-çš„ç»„æˆ" class="headerlink" title="1ã€æ±¡ç‚¹ ( Taint ) çš„ç»„æˆ"></a>1ã€æ±¡ç‚¹ ( Taint ) çš„ç»„æˆ</h4><p>ä½¿ç”¨ kubectl taint å‘½ä»¤å¯ä»¥ç»™æŸä¸ª Node èŠ‚ç‚¹è®¾ç½®æ±¡ç‚¹ï¼ŒNode è¢«è®¾ç½®ä¸Šæ±¡ç‚¹ä¹‹åå°±å’Œ Pod ä¹‹é—´å­˜åœ¨äº†ä¸€ç§ç›¸æ–¥çš„å…³ç³»ï¼Œå¯ä»¥è®© Node æ‹’ç» Pod çš„è°ƒåº¦æ‰§è¡Œï¼Œç”šè‡³å°† Node å·²ç»å­˜åœ¨çš„ Pod é©±é€å‡ºå»æ¯ä¸ªæ±¡ç‚¹çš„ç»„æˆå¦‚ä¸‹ï¼š</p><p><code>key=value:effect</code></p><p>æ¯ä¸ªæ±¡ç‚¹æœ‰ä¸€ä¸ª key å’Œ value ä½œä¸ºæ±¡ç‚¹çš„æ ‡ç­¾ï¼Œå…¶ä¸­ value å¯ä»¥ä¸ºç©ºï¼Œeffect æè¿°æ±¡ç‚¹çš„ä½œç”¨ã€‚å½“å‰ taint effect æ”¯æŒå¦‚ä¸‹ä¸‰ä¸ªé€‰é¡¹ï¼š</p><table><thead><tr><th>æ±¡ç‚¹ç±»å‹</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>NoSchedule</td><td>æ–°çš„ä¸èƒ½å®¹å¿çš„ pod ä¸èƒ½å†è°ƒåº¦è¿‡æ¥ï¼Œä½†æ˜¯è€çš„è¿è¡Œåœ¨ node ä¸Šä¸å—å½±å“</td></tr><tr><td>PreferNoSchedule</td><td>åŒæ—¶ä¼šå°† Node ä¸Šå·²ç»å­˜åœ¨çš„ Pod é©±é€å‡ºå», pod ä¼šå°è¯•å°† pod åˆ†é…åˆ°è¯¥èŠ‚ç‚¹</td></tr><tr><td>NoExecute</td><td>æ–°çš„ä¸èƒ½å®¹å¿çš„ pod ä¸èƒ½è°ƒåº¦è¿‡æ¥ï¼Œè€çš„ pod ä¹Ÿä¼šè¢«é©±é€</td></tr></tbody></table><h4 id="2ã€æ±¡ç‚¹çš„è®¾ç½®ã€æŸ¥çœ‹å’Œå»é™¤"><a href="#2ã€æ±¡ç‚¹çš„è®¾ç½®ã€æŸ¥çœ‹å’Œå»é™¤" class="headerlink" title="2ã€æ±¡ç‚¹çš„è®¾ç½®ã€æŸ¥çœ‹å’Œå»é™¤"></a>2ã€æ±¡ç‚¹çš„è®¾ç½®ã€æŸ¥çœ‹å’Œå»é™¤</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æŸ¥çœ‹èŠ‚ç‚¹æ±¡ç‚¹</span></span><br><span class="line">kubectl describe node k8s-node01</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®æ±¡ç‚¹</span></span><br><span class="line">kubectl taint nodes node1 key1=value1:NoSchedule</span><br><span class="line"></span><br><span class="line"><span class="comment"># èŠ‚ç‚¹è¯´æ˜ä¸­ï¼ŒæŸ¥æ‰¾ Taints å­—æ®µ</span></span><br><span class="line">kubectl describe node k8s-node01</span><br><span class="line"></span><br><span class="line"><span class="comment"># å»é™¤æ±¡ç‚¹</span></span><br><span class="line">kubectl taint nodes node1 key1:NoSchedule-</span><br></pre></td></tr></table></figure><h3 id="å®¹å¿-Tolerations"><a href="#å®¹å¿-Tolerations" class="headerlink" title="å®¹å¿ (Tolerations)"></a>å®¹å¿ (Tolerations)</h3><p>è®¾ç½®äº†æ±¡ç‚¹çš„ Node å°†æ ¹æ® taint çš„ effectï¼šNoScheduleã€PreferNoScheduleã€NoExecute å’Œ Pod ä¹‹é—´äº§ç”Ÿäº’æ–¥çš„å…³ç³»ï¼ŒPod å°†åœ¨ä¸€å®šç¨‹åº¦ä¸Šä¸ä¼šè¢«è°ƒåº¦åˆ° Node ä¸Šã€‚ä½†æˆ‘ä»¬å¯ä»¥åœ¨ Pod ä¸Šè®¾ç½®å®¹å¿ ( Toleration ) ï¼Œæ„æ€æ˜¯è®¾ç½®äº†å®¹å¿çš„ Pod å°†å¯ä»¥å®¹å¿æ±¡ç‚¹çš„å­˜åœ¨ï¼Œå¯ä»¥è¢«è°ƒåº¦åˆ°å­˜åœ¨æ±¡ç‚¹çš„ Node ä¸Š</p><p>pod.spec.tolerations</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">tolerations:</span>                <span class="comment"># containersåŒçº§</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">key:</span> <span class="string">&quot;disk_type&quot;</span>          <span class="comment"># èƒ½å®¹å¿çš„æ±¡ç‚¹key</span></span><br><span class="line">  <span class="attr">operator:</span> <span class="string">&quot;Equal&quot;</span>         <span class="comment"># Equal è¡¨ç¤ºkey=value ï¼Œ Exists åªè¦å­˜åœ¨keyå³å¯</span></span><br><span class="line">  <span class="attr">value:</span> <span class="string">&quot;SSD&quot;</span>              <span class="comment"># å€¼</span></span><br><span class="line">  <span class="attr">effect:</span> <span class="string">&quot;NoExecute&quot;</span>       <span class="comment"># effectç­–ç•¥</span></span><br><span class="line">  <span class="attr">tolerationSeconds:</span> <span class="number">3600</span>   <span class="comment"># åŸå§‹çš„podå¤šä¹…é©±é€,å•ä½æ˜¯ç§’ï¼Œæ³¨æ„åªæœ‰effect: &quot;NoExecute&quot;æ‰èƒ½è®¾ç½®ï¼Œä¸ç„¶æŠ¥é”™</span></span><br></pre></td></tr></table></figure><blockquote><p>å…¶ä¸­ key, vaule, effect è¦ä¸ Node ä¸Šè®¾ç½®çš„ taint ä¿æŒä¸€è‡´<br>operator çš„å€¼ä¸º Exists å°†ä¼šå¿½ç•¥ value å€¼</p></blockquote><h4 id="1ã€å½“ä¸æŒ‡å®š-key-å€¼æ—¶ï¼Œè¡¨ç¤ºå®¹å¿æ‰€æœ‰çš„æ±¡ç‚¹-key"><a href="#1ã€å½“ä¸æŒ‡å®š-key-å€¼æ—¶ï¼Œè¡¨ç¤ºå®¹å¿æ‰€æœ‰çš„æ±¡ç‚¹-key" class="headerlink" title="1ã€å½“ä¸æŒ‡å®š key å€¼æ—¶ï¼Œè¡¨ç¤ºå®¹å¿æ‰€æœ‰çš„æ±¡ç‚¹ key"></a>1ã€å½“ä¸æŒ‡å®š key å€¼æ—¶ï¼Œè¡¨ç¤ºå®¹å¿æ‰€æœ‰çš„æ±¡ç‚¹ key</h4><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">tolerations:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">operator:</span> <span class="string">&quot;Exists&quot;</span></span><br></pre></td></tr></table></figure><h4 id="2ã€å½“ä¸æŒ‡å®š-effect-å€¼æ—¶ï¼Œè¡¨ç¤ºå®¹å¿æ‰€æœ‰çš„æ±¡ç‚¹ä½œç”¨"><a href="#2ã€å½“ä¸æŒ‡å®š-effect-å€¼æ—¶ï¼Œè¡¨ç¤ºå®¹å¿æ‰€æœ‰çš„æ±¡ç‚¹ä½œç”¨" class="headerlink" title="2ã€å½“ä¸æŒ‡å®š effect å€¼æ—¶ï¼Œè¡¨ç¤ºå®¹å¿æ‰€æœ‰çš„æ±¡ç‚¹ä½œç”¨"></a>2ã€å½“ä¸æŒ‡å®š effect å€¼æ—¶ï¼Œè¡¨ç¤ºå®¹å¿æ‰€æœ‰çš„æ±¡ç‚¹ä½œç”¨</h4><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">tolerations:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">key:</span> <span class="string">&quot;key&quot;</span></span><br><span class="line">  <span class="attr">operator:</span> <span class="string">&quot;Exists&quot;</span></span><br></pre></td></tr></table></figure><h2 id="æŒ‡å®šè°ƒåº¦èŠ‚ç‚¹"><a href="#æŒ‡å®šè°ƒåº¦èŠ‚ç‚¹" class="headerlink" title="æŒ‡å®šè°ƒåº¦èŠ‚ç‚¹"></a>æŒ‡å®šè°ƒåº¦èŠ‚ç‚¹</h2><p>äº²å’Œæ€§å’Œæ±¡ç‚¹ï¼Œå®¹å¿éƒ½æ¯”è¾ƒå«è“„ã€‚<br>æŒ‡å®šè°ƒåº¦èŠ‚ç‚¹æ˜¯ç»å¯¹æŒ‡å®šç›®æ ‡ï¼Œå°±è¦è¿™ä¸ª</p><h3 id="Pod-spec-nodeName"><a href="#Pod-spec-nodeName" class="headerlink" title="Pod.spec.nodeName"></a>Pod.spec.nodeName</h3><p>å°† Pod ç›´æ¥è°ƒåº¦åˆ°æŒ‡å®šçš„ Node èŠ‚ç‚¹ä¸Šï¼Œä¼šè·³è¿‡ Scheduler çš„è°ƒåº¦ç­–ç•¥ï¼Œè¯¥åŒ¹é…è§„åˆ™æ˜¯å¼ºåˆ¶åŒ¹é…</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">extensions/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">myweb</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">myweb</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">nodeName:</span> <span class="string">k8s-node01</span>          <span class="comment"># æŒ‡å®šå…¨åœ¨k8s-node01</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">myweb</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">hub.atguigu.com/library/myapp:v1</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure><h3 id="Pod-spec-nodeSelector"><a href="#Pod-spec-nodeSelector" class="headerlink" title="Pod.spec.nodeSelector"></a>Pod.spec.nodeSelector</h3><p>é€šè¿‡ kubernetes çš„ label-selector æœºåˆ¶é€‰æ‹©èŠ‚ç‚¹ï¼Œç”±è°ƒåº¦å™¨è°ƒåº¦ç­–ç•¥åŒ¹é… labelï¼Œè€Œåè°ƒåº¦ Pod åˆ°ç›®æ ‡èŠ‚ç‚¹ï¼Œè¯¥åŒ¹é…è§„åˆ™å±äºå¼ºåˆ¶çº¦æŸ</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">extensions/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">myweb66</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">myweb66</span></span><br><span class="line">  <span class="attr">spec:</span></span><br><span class="line">    <span class="attr">nodeSelector:</span></span><br><span class="line">      <span class="attr">disk:</span> <span class="string">ssd</span>                 <span class="comment"># ç¡¬ç›˜å¿…é¡»æ˜¯ssdç±»å‹æ‰è¿è¡Œ</span></span><br><span class="line">      <span class="comment"># type: backEndNode1      # æ ‡ç­¾åï¼Œæ ‡ç­¾å€¼</span></span><br><span class="line">    <span class="attr">containers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">myweb66</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">hub.atguigu.com/library/myapp:v1</span></span><br><span class="line">      <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å®¹å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Scheduler </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨acme.shæ¥è‡ªåŠ¨æ›´æ–°httpsè¯ä¹¦</title>
      <link href="/posts/1e777b9e/"/>
      <url>/posts/1e777b9e/</url>
      
        <content type="html"><![CDATA[<p>ä½¿ç”¨ acme.sh å¯ä»¥è‡ªåŠ¨ç”³è¯· letâ€™s encrypt è¯ä¹¦ï¼Œå¹¶ä¸”å¯ä»¥è‡ªåŠ¨é…ç½®åˆ° nginxï¼Œæ•´ä¸ªè¿‡ç¨‹å¯ä»¥å…¨è‡ªåŠ¨ã€‚<br>ä¹Ÿå¯ä»¥ä½¿ç”¨ certbotï¼Œcertbot åŸºäº acme.sh<a href="/posts/28c679c3">ä½¿ç”¨certbotè‡ªåŠ¨ç”³è¯·sslè¯ä¹¦</a></p><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>æ¨èå®‰è£… socat</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install socat</span><br></pre></td></tr></table></figure><p>å®‰è£… acme.sh</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl  https://get.acme.sh | sh</span><br></pre></td></tr></table></figure><p>é€€å‡ºç»ˆç«¯ï¼Œé‡æ–°ç™»é™†åï¼Œæ‰§è¡Œ acme.sh æœ‰è¾“å‡ºï¼Œè¯´æ˜å®‰è£…æˆåŠŸäº†ã€‚</p><h2 id="é…ç½®é‚®ç®±"><a href="#é…ç½®é‚®ç®±" class="headerlink" title="é…ç½®é‚®ç®±"></a>é…ç½®é‚®ç®±</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">acme.sh --register-account -m <span class="string">&quot;iuxt@qq.com&quot;</span></span><br></pre></td></tr></table></figure><h2 id="é…ç½®é»˜è®¤-CA"><a href="#é…ç½®é»˜è®¤-CA" class="headerlink" title="é…ç½®é»˜è®¤ CA"></a>é…ç½®é»˜è®¤ CA</h2><p>æ–°ç‰ˆé»˜è®¤ zerosslï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨åˆ‡æ¢ä¸º letâ€™s encrypt</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># acme.sh --set-default-ca --server letsencrypt</span></span><br><span class="line"><span class="comment"># acme.sh --set-default-ca --server zerossl</span></span><br></pre></td></tr></table></figure><h2 id="ç”³è¯·è¯ä¹¦"><a href="#ç”³è¯·è¯ä¹¦" class="headerlink" title="ç”³è¯·è¯ä¹¦"></a>ç”³è¯·è¯ä¹¦</h2><p>acme.sh å®ç°äº† acme åè®®æ”¯æŒçš„æ‰€æœ‰éªŒè¯åè®®.<br>ä¸€èˆ¬æœ‰ä¸¤ç§æ–¹å¼éªŒè¯: http å’Œ dns éªŒè¯.</p><h3 id="ä½¿ç”¨-dns-api-è‡ªåŠ¨ç”³è¯·"><a href="#ä½¿ç”¨-dns-api-è‡ªåŠ¨ç”³è¯·" class="headerlink" title="ä½¿ç”¨ dns api è‡ªåŠ¨ç”³è¯·"></a>ä½¿ç”¨ dns api è‡ªåŠ¨ç”³è¯·</h3><p>å®˜æ–¹è¯´æ˜: <a href="https://github.com/acmesh-official/acme.sh/wiki/dnsapi">https://github.com/acmesh-official/acme.sh/wiki/dnsapi</a></p><h4 id="DNSpod"><a href="#DNSpod" class="headerlink" title="DNSpod"></a>DNSpod</h4><p>è¿™é‡Œä»¥ dnspod ä¸ºä¾‹ï¼Œç”³è¯·ä¸€ä¸ª dnspod çš„ api key<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/20220428083952.png" alt="ç”³è¯·dnspod api|861"></p><p>å°† id å’Œ key è®°å½•ä¸‹æ¥ï¼Œæ‰§è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> DP_Id=<span class="string">&quot;310134&quot;</span></span><br><span class="line"><span class="built_in">export</span> DP_Key=<span class="string">&quot;ä½ çš„api key&quot;</span></span><br><span class="line"></span><br><span class="line">acme.sh --issue --dns dns_dp -d babudiu.com -d www.babudiu.com</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œä¸€æ¬¡å°±ä¼šæŠŠ id å’Œ key è®°å½•åœ¨ <code>~/.acme.sh/account.conf</code>ï¼Œä¸‹æ¬¡å†æ‰§è¡Œå°±ä¸ç”¨å†æä¾› id å’Œ key äº†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é‡åˆ°é—®é¢˜å¯ä»¥æŸ¥çœ‹debugæ—¥å¿—</span></span><br><span class="line">acme.sh --issue --dns dns_dp -d jenkins.babudiu.com --debug</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”³è¯·æ³›åŸŸåè¯ä¹¦, æ³›åŸŸåä¸åŒ…æ‹¬ä¸€çº§åŸŸå, æ‰€ä»¥ä¹Ÿè¦æŠŠä¸€çº§åŸŸååŠ ä¸Š</span></span><br><span class="line">acme.sh --issue --dns dns_dp -d babudiu.com -d *.babudiu.com</span><br></pre></td></tr></table></figure><p>å¦‚æœæ‰¾ä¸åˆ° acme.shï¼Œ å¯ä»¥ä½¿ç”¨ç»å¯¹è·¯å¾„ <code>~/.acme.sh/acme.sh</code></p><h4 id="cloudflare-dns"><a href="#cloudflare-dns" class="headerlink" title="cloudflare dns"></a>cloudflare dns</h4><p>è·å– API ä»¤ç‰Œ<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202312091611899.png" alt="image.png|879"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> CF_Key=<span class="string">&quot;ä½ çš„api key&quot;</span></span><br><span class="line"><span class="built_in">export</span> CF_Email=<span class="string">&quot;iuxt@qq.com&quot;</span></span><br><span class="line">acme.sh --issue --dns dns_cf --dnssleep 600 -d babudiu.com -d *.babudiu.com</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨-HTTP-è®¤è¯"><a href="#ä½¿ç”¨-HTTP-è®¤è¯" class="headerlink" title="ä½¿ç”¨ HTTP è®¤è¯"></a>ä½¿ç”¨ HTTP è®¤è¯</h3><p>http æ–¹å¼éœ€è¦åœ¨ä½ çš„ç½‘ç«™æ ¹ç›®å½•ä¸‹æ”¾ç½®ä¸€ä¸ªæ–‡ä»¶, æ¥éªŒè¯ä½ çš„åŸŸåæ‰€æœ‰æƒ, å®ŒæˆéªŒè¯. ç„¶åå°±å¯ä»¥ç”Ÿæˆè¯ä¹¦äº†.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">acme.sh --issue -d mydomain.com -d www.mydomain.com --webroot /home/wwwroot/mydomain.com/</span><br></pre></td></tr></table></figure><p>åªéœ€è¦æŒ‡å®šåŸŸå, å¹¶æŒ‡å®šåŸŸåæ‰€åœ¨çš„ç½‘ç«™æ ¹ç›®å½•. acme.sh ä¼šå…¨è‡ªåŠ¨çš„ç”ŸæˆéªŒè¯æ–‡ä»¶, å¹¶æ”¾åˆ°ç½‘ç«™çš„æ ¹ç›®å½•, ç„¶åè‡ªåŠ¨å®ŒæˆéªŒè¯. æœ€åä¼šèªæ˜çš„åˆ é™¤éªŒè¯æ–‡ä»¶. æ•´ä¸ªè¿‡ç¨‹æ²¡æœ‰ä»»ä½•å‰¯ä½œç”¨.</p><p>å¦‚æœä½ ç”¨çš„ apache æœåŠ¡å™¨, acme.sh è¿˜å¯ä»¥æ™ºèƒ½çš„ä» apache çš„é…ç½®ä¸­è‡ªåŠ¨å®ŒæˆéªŒè¯, ä½ ä¸éœ€è¦æŒ‡å®šç½‘ç«™æ ¹ç›®å½•:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">acme.sh --issue -d mydomain.com --apache</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ ç”¨çš„ nginx æœåŠ¡å™¨, æˆ–è€…åä»£, acme.sh è¿˜å¯ä»¥æ™ºèƒ½çš„ä» nginx çš„é…ç½®ä¸­è‡ªåŠ¨å®ŒæˆéªŒè¯, ä½ ä¸éœ€è¦æŒ‡å®šç½‘ç«™æ ¹ç›®å½•:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">acme.sh --issue -d mydomain.com --nginx</span><br></pre></td></tr></table></figure><p>æ³¨æ„, æ— è®ºæ˜¯ apache è¿˜æ˜¯ nginx æ¨¡å¼, acme.sh åœ¨å®ŒæˆéªŒè¯ä¹‹å, ä¼šæ¢å¤åˆ°ä¹‹å‰çš„çŠ¶æ€, éƒ½ä¸ä¼šç§è‡ªæ›´æ”¹ä½ æœ¬èº«çš„é…ç½®.</p><p>å¦‚æœä½ è¿˜æ²¡æœ‰è¿è¡Œä»»ä½• web æœåŠ¡, 80 ç«¯å£æ˜¯ç©ºé—²çš„, é‚£ä¹ˆ acme.sh è¿˜èƒ½å‡è£…è‡ªå·±æ˜¯ä¸€ä¸ª webserver, ä¸´æ—¶å¬åœ¨ 80 ç«¯å£, å®ŒæˆéªŒè¯:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">acme.sh --issue -d mydomain.com --standalone</span><br></pre></td></tr></table></figure><p>æ›´é«˜çº§çš„ç”¨æ³•è¯·å‚è€ƒ: <a href="https://github.com/Neilpang/acme.sh/wiki/How-to-issue-a-cert">https://github.com/Neilpang/acme.sh/wiki/How-to-issue-a-cert</a></p><h2 id="å®‰è£…è¯ä¹¦"><a href="#å®‰è£…è¯ä¹¦" class="headerlink" title="å®‰è£…è¯ä¹¦"></a>å®‰è£…è¯ä¹¦</h2><p>é»˜è®¤ç”Ÿæˆçš„è¯ä¹¦éƒ½æ”¾åœ¨ <code>~/.acme.sh/</code>, å¯ä»¥ä½¿ç”¨ <code>--install-cert</code> å‘½ä»¤, å°†è¯ä¹¦å¤åˆ¶åˆ°æŒ‡å®šçš„ä½ç½®ã€‚</p><p>åªæœ‰é€šè¿‡è¿™ç§æ–¹å¼æ¥å¤åˆ¶è¯ä¹¦ï¼Œä»¥åæ‰èƒ½è‡ªåŠ¨æ›´æ–°ï¼Œæ‰‹åŠ¨å¤åˆ¶çš„è¯ä¹¦ä¸èƒ½è‡ªåŠ¨æ›´æ–°ã€‚</p><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">Apache</button><button type="button" class="tab">Nginx</button></div><div class="tab-contents"><div class="tab-item-content active"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> DOMAIN=babudiu.com</span><br><span class="line">acme.sh --install-cert -d <span class="string">&quot;<span class="variable">$&#123;DOMAIN&#125;</span>&quot;</span> \</span><br><span class="line">    --cert-file      /path/to/certfile/in/apache/<span class="string">&quot;<span class="variable">$&#123;DOMAIN&#125;</span>&quot;</span>.crt  \</span><br><span class="line">    --key-file       /path/to/keyfile/in/apache/<span class="string">&quot;<span class="variable">$&#123;DOMAIN&#125;</span>&quot;</span>.key  \</span><br><span class="line">    --fullchain-file /path/to/fullchain/certfile/apache/<span class="string">&quot;<span class="variable">$&#123;DOMAIN&#125;</span>&quot;</span>-fullchain.pem \</span><br><span class="line">    --reloadcmd     <span class="string">&quot;systemctl reload httpd&quot;</span></span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> DOMAIN=babudiu.com</span><br><span class="line">acme.sh --install-cert -d <span class="string">&quot;<span class="variable">$&#123;DOMAIN&#125;</span>&quot;</span> \</span><br><span class="line">    --key-file       /etc/nginx/ssl/<span class="string">&quot;<span class="variable">$&#123;DOMAIN&#125;</span>&quot;</span>.key  \</span><br><span class="line">    --fullchain-file /etc/nginx/ssl/<span class="string">&quot;<span class="variable">$&#123;DOMAIN&#125;</span>&quot;</span>.crt \</span><br><span class="line">    --reloadcmd     <span class="string">&quot;nginx -s reload&quot;</span></span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div><h2 id="å‡çº§-acme-sh"><a href="#å‡çº§-acme-sh" class="headerlink" title="å‡çº§ acme.sh"></a>å‡çº§ acme.sh</h2><p>æ‰‹åŠ¨å‡çº§</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">acme.sh --upgrade</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥è®¾ç½®è‡ªåŠ¨å‡çº§</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">acme.sh  --upgrade  --auto-upgrade</span><br></pre></td></tr></table></figure><p>å…³é—­è‡ªåŠ¨æ›´æ–°</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">acme.sh --upgrade  --auto-upgrade  0</span><br></pre></td></tr></table></figure><p>Nginx è¯ä¹¦é…ç½®çš„è§£é‡Š</p><table><thead><tr><th>æ–‡ä»¶å</th><th>å†…å®¹</th></tr></thead><tbody><tr><td>cert.pem</td><td>æœåŠ¡ç«¯è¯ä¹¦</td></tr><tr><td>chain.pem</td><td>æµè§ˆå™¨éœ€è¦çš„æ‰€æœ‰è¯ä¹¦ä½†ä¸åŒ…æ‹¬æœåŠ¡ç«¯è¯ä¹¦ï¼Œæ¯”å¦‚æ ¹è¯ä¹¦å’Œä¸­é—´è¯ä¹¦</td></tr><tr><td>fullchain.pem</td><td>åŒ…æ‹¬äº† cert.pem å’Œ chain.pem çš„å†…å®¹</td></tr><tr><td>privkey.pem</td><td>è¯ä¹¦çš„ç§é’¥</td></tr></tbody></table><h2 id="é”™è¯¯æ’æŸ¥"><a href="#é”™è¯¯æ’æŸ¥" class="headerlink" title="é”™è¯¯æ’æŸ¥"></a>é”™è¯¯æ’æŸ¥</h2><p>æ·»åŠ  <code>--debug</code> å‚æ•°ï¼Œçœ‹çœ‹è¾“å‡ºç»“æœï¼Œéƒ½ä¼šå¾ˆè¯¦ç»†çš„è¯´æ˜é—®é¢˜åŸå› ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> SSL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQLä¸»ä»åŒæ­¥é…ç½®</title>
      <link href="/posts/265ea5f9/"/>
      <url>/posts/265ea5f9/</url>
      
        <content type="html"><![CDATA[<p>ä¸»ä»åŒæ­¥å¯ä»¥ç›¸å½“äºå®æ—¶å¤‡ä»½ï¼Œè¯»å†™åˆ†ç¦»è¿˜èƒ½æé«˜æ•°æ®åº“çš„æ€§èƒ½ï¼Œè®°å½•ä¸€ä¸‹ä¸»ä»åŒæ­¥çš„é…ç½®</p><p>ä¸åœæœºå¢åŠ ä»åº“å¯ä»¥æŸ¥çœ‹ <a href="/posts/86a9c8f5">ä¼˜é›…åœ°ç»™æ­£åœ¨è¿è¡Œçš„MySQLæ·»åŠ ä»åº“</a></p><h2 id="ä¸€-å‡†å¤‡"><a href="#ä¸€-å‡†å¤‡" class="headerlink" title="ä¸€.å‡†å¤‡"></a>ä¸€.å‡†å¤‡</h2><ul><li>ä¸»ä»æ•°æ®åº“ç‰ˆæœ¬æœ€å¥½ä¸€è‡´</li><li>ä¿è¯æ•°æ®åº“çš„ uuid ä¸ä¸€è‡´</li></ul><table><thead><tr><th>æœåŠ¡å™¨</th><th>ip åœ°å€</th></tr></thead><tbody><tr><td>MySQL Master</td><td>192.168.21.53</td></tr><tr><td>MySQL Slave</td><td>192.168.21.54</td></tr></tbody></table><h2 id="äºŒ-æ“ä½œ"><a href="#äºŒ-æ“ä½œ" class="headerlink" title="äºŒ.æ“ä½œ"></a>äºŒ.æ“ä½œ</h2><h3 id="ä¸»æ•°æ®åº“æ“ä½œ"><a href="#ä¸»æ•°æ®åº“æ“ä½œ" class="headerlink" title="ä¸»æ•°æ®åº“æ“ä½œ"></a>ä¸»æ•°æ®åº“æ“ä½œ</h3><h4 id="å¼€å¯-binlog"><a href="#å¼€å¯-binlog" class="headerlink" title="å¼€å¯ binlog"></a>å¼€å¯ binlog</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">log_bin=mysql-bin</span><br><span class="line">server-id=1</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ³¨æ„ <code>server-id</code> ä¸»ä»ä¸èƒ½ä¸€æ ·, é…ç½®å®Œæˆé‡å¯ mysql</p><h4 id="åˆ›å»ºç”¨äºåŒæ­¥çš„ç”¨æˆ·è´¦å·"><a href="#åˆ›å»ºç”¨äºåŒæ­¥çš„ç”¨æˆ·è´¦å·" class="headerlink" title="åˆ›å»ºç”¨äºåŒæ­¥çš„ç”¨æˆ·è´¦å·"></a>åˆ›å»ºç”¨äºåŒæ­¥çš„ç”¨æˆ·è´¦å·</h4><p>ç™»é™†æ•°æ®åº“</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -hlocalhost -uroot -ppassword</span><br></pre></td></tr></table></figure><p>åˆ›å»ºç”¨æˆ·å¹¶æˆæƒ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;repl&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;A4MyDNdzpHvg5M02KRtm&#x27;</span>;</span><br></pre></td></tr></table></figure><p>æˆæƒ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GRANT</span> REPLICATION SLAVE <span class="keyword">ON</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;repl&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">æœªä½¿ç”¨çš„ä¸»åº“</button><button type="button" class="tab">ä¸»åº“æ­£åœ¨ä½¿ç”¨ï¼ˆæœ‰å†™å…¥æ“ä½œï¼‰</button></div><div class="tab-contents"><div class="tab-item-content active"><p>æ–°å¼€ä¸€ä¸ªçª—å£æŸ¥çœ‹ master çŠ¶æ€</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> MASTER STATUS;</span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+----------+--------------+------------------+</span></span><br><span class="line"><span class="operator">|</span> File             <span class="operator">|</span> Position <span class="operator">|</span> Binlog_Do_DB <span class="operator">|</span> Binlog_Ignore_DB <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+----------+--------------+------------------+</span></span><br><span class="line"><span class="operator">|</span> mysql<span class="operator">-</span>bin<span class="number">.000010</span> <span class="operator">|</span> <span class="number">747</span>      <span class="operator">|</span>              <span class="operator">|</span>                  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+----------+--------------+------------------+ </span></span><br></pre></td></tr></table></figure><p>è®°å½•äºŒè¿›åˆ¶æ–‡ä»¶å (mysql-bin.000010) å’Œä½ç½® (747)</p></div><div class="tab-item-content"><p>é”è¡¨ï¼Œç¦æ­¢å†™å…¥ï¼Œå½“å‰çª—å£ä¸èƒ½é€€å‡ºï¼Œè¿™æ—¶å€™å¼€å¯å¦ä¸€ä¸ªç»ˆç«¯ç»§ç»­æ“ä½œ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flush <span class="keyword">table</span> <span class="keyword">with</span> read lock;</span><br></pre></td></tr></table></figure><p>æ–°å¼€ä¸€ä¸ªçª—å£æŸ¥çœ‹ master çŠ¶æ€</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> MASTER STATUS;</span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+----------+--------------+------------------+</span></span><br><span class="line"><span class="operator">|</span> File             <span class="operator">|</span> Position <span class="operator">|</span> Binlog_Do_DB <span class="operator">|</span> Binlog_Ignore_DB <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+----------+--------------+------------------+</span></span><br><span class="line"><span class="operator">|</span> mysql<span class="operator">-</span>bin<span class="number">.000010</span> <span class="operator">|</span> <span class="number">747</span>      <span class="operator">|</span>              <span class="operator">|</span>                  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+----------+--------------+------------------+ </span></span><br></pre></td></tr></table></figure><p>è®°å½•äºŒè¿›åˆ¶æ–‡ä»¶å (mysql-bin.000010) å’Œä½ç½® (747)</p><p>å°†å½“å‰æ•°æ®å¯¼å‡º</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -u root -p --all-databases &gt; /root/backup.sql</span><br></pre></td></tr></table></figure><p>å–æ¶ˆé”è¡¨</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unlock <span class="keyword">table</span>;</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div><h3 id="ä»æœåŠ¡å™¨æ“ä½œ"><a href="#ä»æœåŠ¡å™¨æ“ä½œ" class="headerlink" title="ä»æœåŠ¡å™¨æ“ä½œ"></a>ä»æœåŠ¡å™¨æ“ä½œ</h3><p>å¯¼å…¥æ•°æ®ï¼ˆå¦‚æœéœ€è¦çš„è¯ï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p &lt; backup.sql</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹é…ç½®æ–‡ä»¶</p><p><code>vim /etc/my.cnf</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">server-id=2 </span><br></pre></td></tr></table></figure><p><code>server-id</code> å¿…é¡»å’Œä¸»æ•°æ®åº“ä¸ä¸€è‡´ï¼Œä¿®æ”¹å®Œæˆåé‡å¯ mysql</p><p>é…ç½®ä»æ•°æ®åº“</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CHANGE MASTER <span class="keyword">TO</span> MASTER_HOST<span class="operator">=</span><span class="string">&#x27;192.168.21.53&#x27;</span>, MASTER_USER<span class="operator">=</span><span class="string">&#x27;repl&#x27;</span>, MASTER_PASSWORD<span class="operator">=</span><span class="string">&#x27;A4MyDNdzpHvg5M02KRtm&#x27;</span>, MASTER_LOG_FILE<span class="operator">=</span><span class="string">&#x27;mysql-bin.000010&#x27;</span>, MASTER_LOG_POS<span class="operator">=</span><span class="number">747</span>;</span><br><span class="line"><span class="keyword">start</span> slave;</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹ slave çŠ¶æ€ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> slave status\G;</span><br></pre></td></tr></table></figure><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">*************************** 1. row ***************************</span><br><span class="line">               Slave_IO_State: Waiting for master to send event</span><br><span class="line">                  Master_Host: 192.168.21.53</span><br><span class="line">                  Master_User: repl</span><br><span class="line">                  Master_Port: 3306</span><br><span class="line">                Connect_Retry: 60</span><br><span class="line">              Master_Log_File: mysql-bin.000010</span><br><span class="line">          Read_Master_Log_Pos: 1055                                           # è¡¨ç¤ºå½“å‰åŒæ­¥åˆ°äº†ä»€ä¹ˆä½ç½®</span><br><span class="line">               Relay_Log_File: prod_cukin_mysql_slave-relay-bin.000003</span><br><span class="line">                Relay_Log_Pos: 628</span><br><span class="line">        Relay_Master_Log_File: mysql-bin.000010</span><br><span class="line">             Slave_IO_Running: Yes                                            # æ˜¯Yesè¡¨ç¤ºé…ç½®æˆåŠŸ</span><br><span class="line">            Slave_SQL_Running: Yes                                            # æ˜¯Yesè¡¨ç¤ºé…ç½®æˆåŠŸ</span><br></pre></td></tr></table></figure><h2 id="å¸¸è§é—®é¢˜"><a href="#å¸¸è§é—®é¢˜" class="headerlink" title="å¸¸è§é—®é¢˜"></a>å¸¸è§é—®é¢˜</h2><h3 id="uuid-ä¸€è‡´é—®é¢˜"><a href="#uuid-ä¸€è‡´é—®é¢˜" class="headerlink" title="uuid ä¸€è‡´é—®é¢˜"></a>uuid ä¸€è‡´é—®é¢˜</h3><p>å¾ˆå¤šæ—¶å€™æˆ‘ä»¬æ˜¯ç›´æ¥å…‹éš†çš„æœºå™¨åšä»åº“ï¼Œè¿™ä¸ªæ—¶å€™ä¸¤å° mysql æœºå™¨çš„ uuid å°±æ˜¯ä¸€æ ·çš„æ²¡åŠæ³•åšä¸»ä»åŒæ­¥ï¼Œä¼šæŠ¥é”™</p><p><code>The slave I/O thread stops because master and slave have equal MySQL server UUIDs; these UUIDs must be different for replication to work</code></p><p>uuid å¯ä»¥é€šè¿‡ä»¥ä¸‹ sql æ¥æŸ¥çœ‹</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;%server_uuid%&#x27;</span>;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ—¶å€™éœ€è¦ä¿®æ”¹ uuidï¼Œè§„èŒƒä¸€ç‚¹å¯ä»¥ä½¿ç”¨ <code>uuidgen</code> æ¥ç”Ÿæˆä¸€ä¸ªæ–°çš„ uuidï¼Œé…ç½®åœ¨ mysql çš„æ•°æ®ç›®å½• auto.cnf æ–‡ä»¶å†…</p><h3 id="é‡æ–°åŒæ­¥"><a href="#é‡æ–°åŒæ­¥" class="headerlink" title="é‡æ–°åŒæ­¥"></a>é‡æ–°åŒæ­¥</h3><p>å¦‚æœéœ€è¦åœæ­¢åŒæ­¥ï¼Œæ¯”å¦‚æ›´æ¢äº†åŒæ­¥æ‰€ç”¨åˆ°çš„å¯†ç ï¼Œåˆ™éœ€è¦ï¼š</p><p>åœæ­¢ slave è¿›ç¨‹, åœ¨ slave ä¸Šæ‰§è¡Œï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stop slave;</span><br></pre></td></tr></table></figure><p>è®°å½•å½“å‰çš„ Read_Master_Log_Pos, åœ¨ slave ä¸Šæ‰§è¡Œï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> slave status \G</span><br></pre></td></tr></table></figure><p>é‡æ–°é…ç½®åŒæ­¥ï¼Œåœ¨ slave ä¸Šæ‰§è¡Œï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CHANGE MASTER <span class="keyword">TO</span> </span><br><span class="line">MASTER_HOST<span class="operator">=</span><span class="string">&#x27;192.168.21.53&#x27;</span>, </span><br><span class="line">MASTER_USER<span class="operator">=</span><span class="string">&#x27;repl&#x27;</span>, </span><br><span class="line">MASTER_PASSWORD<span class="operator">=</span><span class="string">&#x27;A4MyDNdzpHvg5M02KRtm&#x27;</span>, </span><br><span class="line">MASTER_LOG_FILE<span class="operator">=</span><span class="string">&#x27;mysql-bin.000010&#x27;</span>, </span><br><span class="line">MASTER_LOG_POS<span class="operator">=</span><span class="number">747</span>;</span><br></pre></td></tr></table></figure><p>å¼€å§‹åŒæ­¥</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">start</span> slave;</span><br></pre></td></tr></table></figure><h2 id="ç¦æ­¢ä»åº“æ›´æ–°æ•°æ®"><a href="#ç¦æ­¢ä»åº“æ›´æ–°æ•°æ®" class="headerlink" title="ç¦æ­¢ä»åº“æ›´æ–°æ•°æ®"></a>ç¦æ­¢ä»åº“æ›´æ–°æ•°æ®</h2><p>super_read_only å’Œ read_only çš„åŒºåˆ«</p><ol><li>read_only å‚æ•°å’Œ super_read_only å‚æ•°é»˜è®¤éƒ½æ˜¯å…³é—­çš„ï¼Œread_only å‚æ•°è®¾ç½®ä¸º on çš„æƒ…å†µä¸‹ï¼Œä¼šç»„ç»‡å®¢æˆ·ç«¯çš„æ›´æ–°ï¼Œä½†æ˜¯å¦‚æœä¸€ä¸ªè´¦å·æ‹¥æœ‰ super æƒé™ï¼Œé‚£ä¹ˆè¿˜æ˜¯å¯ä»¥è¿›è¡Œæ›´æ–°çš„ã€‚è€Œ super_read_only ä¼šé˜»æ­¢æ‰€æœ‰çš„å®¢æˆ·ç«¯æ›´æ–°ï¼Œå³ä½¿å®¢æˆ·ç«¯æ‹¥æœ‰ super æƒé™ä¹Ÿä¸å¯ä»¥ã€‚</li><li>è®¾ç½® super_read_only å‚æ•°ä¸º on ä¼šé»˜è®¤è”åŠ¨çš„è®¾ç½® read_only ä¸º on</li><li>è®¾ç½® read_only å‚æ•°ä¸º offï¼Œä¼šé»˜è®¤è”åŠ¨è®¾ç½® super_read_only ä¸º off</li></ol><h3 id="æŸ¥çœ‹ç°æœ‰çš„é…ç½®"><a href="#æŸ¥çœ‹ç°æœ‰çš„é…ç½®" class="headerlink" title="æŸ¥çœ‹ç°æœ‰çš„é…ç½®"></a>æŸ¥çœ‹ç°æœ‰çš„é…ç½®</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;%read_only%&#x27;</span>;</span><br></pre></td></tr></table></figure><h3 id="è®¾ç½®-readonly"><a href="#è®¾ç½®-readonly" class="headerlink" title="è®¾ç½® readonly"></a>è®¾ç½® readonly</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> super_read_only<span class="operator">=</span><span class="keyword">on</span>;</span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œæ°¸ä¹…ç”Ÿæ•ˆ"><a href="#ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œæ°¸ä¹…ç”Ÿæ•ˆ" class="headerlink" title="ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œæ°¸ä¹…ç”Ÿæ•ˆ"></a>ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œæ°¸ä¹…ç”Ÿæ•ˆ</h3><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[mysqld]</span></span><br><span class="line">read-only</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
            <tag> database </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dockerå®¹å™¨é—´ä¼˜é›…çš„äº’è”</title>
      <link href="/posts/d083ba2e/"/>
      <url>/posts/d083ba2e/</url>
      
        <content type="html"><![CDATA[<p>æœ¬æ–‡ä¸»è¦ä»‹ç»å¦‚ä½•ä¼˜é›…çš„è®© Docker å®¹å™¨å’Œ Docker å®¹å™¨ä¹‹é—´ç›¸äº’é€šä¿¡ï¼Œä»¥åŠ Docker å®¹å™¨å¦‚ä½•å’Œå®¿ä¸»æœºè¿›è¡Œç½‘ç»œé€šä¿¡ã€‚</p><h2 id="å®¹å™¨é—´ç½‘ç»œé€šä¿¡"><a href="#å®¹å™¨é—´ç½‘ç»œé€šä¿¡" class="headerlink" title="å®¹å™¨é—´ç½‘ç»œé€šä¿¡"></a>å®¹å™¨é—´ç½‘ç»œé€šä¿¡</h2><p>docker å®¹å™¨é—´é€šä¿¡å¸¸è§çš„æ–¹å¼æ˜¯ä½¿ç”¨ â€“link è¿›è¡Œè¿æ¥ï¼Œä½†æ˜¯ Docker å·²ç»å¼ƒç”¨è¿™ç§æ–¹å¼ï¼Œå¹¶ä¸”å®¹å™¨æ•°é‡ä¸€æ—¦ä¸€å¤šï¼Œâ€“link ä¼šæ˜¾å¾—å¾ˆä¹±ã€‚å®˜æ–¹æ¨èä½¿ç”¨è‡ªå®šä¹‰ç½‘ç»œæ¥è¿›è¡Œäº’è”ã€‚</p><h3 id="åˆ›å»ºè‡ªå®šä¹‰ç½‘ç»œ"><a href="#åˆ›å»ºè‡ªå®šä¹‰ç½‘ç»œ" class="headerlink" title="åˆ›å»ºè‡ªå®šä¹‰ç½‘ç»œ"></a>åˆ›å»ºè‡ªå®šä¹‰ç½‘ç»œ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network create my-network</span><br></pre></td></tr></table></figure><h3 id="åˆ›å»ºå®¹å™¨ä½¿ç”¨è‡ªå®šä¹‰-network"><a href="#åˆ›å»ºå®¹å™¨ä½¿ç”¨è‡ªå®šä¹‰-network" class="headerlink" title="åˆ›å»ºå®¹å™¨ä½¿ç”¨è‡ªå®šä¹‰ network"></a>åˆ›å»ºå®¹å™¨ä½¿ç”¨è‡ªå®šä¹‰ network</h3><p>æ¯”å¦‚ä¸€ä¸ª nginx å®¹å™¨éœ€è¦è®¿é—® php å®¹å™¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 80:80 --network my-network nginx</span><br><span class="line">docker run --name php --network my-network php</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ—¶å€™ nginx å¯ä»¥ç›´æ¥é€šè¿‡ <code>php</code> æ¥è®¿é—® php å®¹å™¨ï¼Œæ‰“å¼€&#x2F;etc&#x2F;hosts å¯ä»¥å‘ç°æ˜¯ docker è‡ªåŠ¨å¸®ä½ æ·»åŠ äº†è§£æ</p><h2 id="å®¹å™¨è®¿é—®ä¸»æœºæœåŠ¡"><a href="#å®¹å™¨è®¿é—®ä¸»æœºæœåŠ¡" class="headerlink" title="å®¹å™¨è®¿é—®ä¸»æœºæœåŠ¡"></a>å®¹å™¨è®¿é—®ä¸»æœºæœåŠ¡</h2><p>å¯ä»¥ä½¿ç”¨å®¹å™¨çš„ç½‘å…³ IP æ¥è®¿é—®ï¼ˆnat ç½‘ç»œï¼‰ï¼Œä¸è¿‡ä½¿ç”¨ ip ä¸ä¼˜é›…ï¼Œæ—§ç‰ˆæœ¬çš„ Docker å¯ä»¥ä½¿ç”¨ <code>host.docker.internal</code> æ¥è®¿é—®ä¸»æœºï¼Œæ–°ç‰ˆæœ¬çš„æ— æ³•ç›´æ¥è®¿é—®ï¼Œå¯ä»¥é€šè¿‡ <code>docker run</code> å¢åŠ å¯åŠ¨å‚æ•°æ¥å…¼å®¹è¿™ç§æ–¹æ¡ˆ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">docker run --name nginx \</span><br><span class="line">  -v <span class="string">&quot;<span class="subst">$(pwd)</span>&quot;</span>/www:/usr/share/nginx/html:ro \</span><br><span class="line">  -v <span class="string">&quot;<span class="subst">$(pwd)</span>&quot;</span>/conf/nginx.conf:/etc/nginx/nginx.conf \</span><br><span class="line">  -v <span class="string">&quot;<span class="subst">$(pwd)</span>&quot;</span>/conf/conf.d:/etc/nginx/conf.d \</span><br><span class="line">  -v <span class="string">&quot;<span class="subst">$(pwd)</span>&quot;</span>/conf/ssl:/etc/nginx/ssl \</span><br><span class="line">  -p 80:80 \</span><br><span class="line">  -p 443:443 \</span><br><span class="line">  --add-host=host.docker.internal:host-gateway \</span><br><span class="line">  --network iuxt \</span><br><span class="line">  --restart always \</span><br><span class="line">  -d nginx</span><br></pre></td></tr></table></figure><p>ä¹‹åå°±å¯ä»¥åœ¨å®¹å™¨å†…é€šè¿‡ <code>host.docker.internal</code> æ¥è®¿é—®ä¸»æœºäº†ã€‚</p><h2 id="ä½¿ç”¨å›ºå®šçš„-ip-è¿›è¡Œé€šä¿¡"><a href="#ä½¿ç”¨å›ºå®šçš„-ip-è¿›è¡Œé€šä¿¡" class="headerlink" title="ä½¿ç”¨å›ºå®šçš„ ip è¿›è¡Œé€šä¿¡"></a>ä½¿ç”¨å›ºå®šçš„ ip è¿›è¡Œé€šä¿¡</h2><p>å¦‚æœæƒ³å›ºå®šæ¯ä¸ªå®¹å™¨çš„ IPï¼Œæ¯”å¦‚æƒ³éƒ¨ç½²ä¸€ä¸ª ElasticSearch é›†ç¾¤ï¼Œéœ€è¦æ¯ä¸ªèŠ‚ç‚¹ IP éƒ½é…ç½®åˆ°é…ç½®æ–‡ä»¶é‡Œé¢ã€‚å¯ä»¥ä½¿ç”¨è¿™ç§æ–¹å¼ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªDockerç½‘ç»œ</span></span><br><span class="line">docker network create --subnet=172.16.0.0/24 elasticsearch-br0</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¯ä¸ªå®¹å™¨æ‰‹åŠ¨æŒ‡å®šä½¿ç”¨è¿™ä¸ªDockerç½‘ç»œï¼Œå¹¶åˆ†é…å›ºå®šçš„IP</span></span><br><span class="line">docker run -d --name elasticsearch1 \</span><br><span class="line">    -e <span class="string">&quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot;</span> \</span><br><span class="line">    -v <span class="string">&quot;<span class="subst">$(pwd)</span>&quot;</span>/elasticsearch1.yml:/usr/share/elasticsearch/config/elasticsearch.yml:ro \</span><br><span class="line">    -v es-data1:/usr/share/elasticsearch/data:rw \</span><br><span class="line">    -v es-logs1:/usr/share/elasticsearch/logs:rw \</span><br><span class="line">    --network elasticsearch-br0 \</span><br><span class="line">    --ip 172.16.0.11 \</span><br><span class="line">    -p 9201:9200 -p 9301:9300 \</span><br><span class="line">    elasticsearch:7.16.2</span><br><span class="line"></span><br><span class="line">docker run -d --name elasticsearch2 \</span><br><span class="line">    -e <span class="string">&quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot;</span> \</span><br><span class="line">    -v <span class="string">&quot;<span class="subst">$(pwd)</span>&quot;</span>/elasticsearch2.yml:/usr/share/elasticsearch/config/elasticsearch.yml:ro \</span><br><span class="line">    -v es-data2:/usr/share/elasticsearch/data:rw \</span><br><span class="line">    -v es-logs2:/usr/share/elasticsearch/logs:rw \</span><br><span class="line">    --network elasticsearch-br0 \</span><br><span class="line">    --ip 172.16.0.12 \</span><br><span class="line">    -p 9202:9200 -p 9302:9300 \</span><br><span class="line">    elasticsearch:7.16.2</span><br><span class="line"></span><br><span class="line">docker run -d --name elasticsearch3 \</span><br><span class="line">    -e <span class="string">&quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot;</span> \</span><br><span class="line">    -v <span class="string">&quot;<span class="subst">$(pwd)</span>&quot;</span>/elasticsearch3.yml:/usr/share/elasticsearch/config/elasticsearch.yml:ro \</span><br><span class="line">    -v es-data3:/usr/share/elasticsearch/data:rw \</span><br><span class="line">    -v es-logs3:/usr/share/elasticsearch/logs:rw \</span><br><span class="line">    --network elasticsearch-br0 \</span><br><span class="line">    --ip 172.16.0.13 \</span><br><span class="line">    -p 9203:9200 -p 9303:9300 \</span><br><span class="line">    elasticsearch:7.16.2</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å®¹å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
            <tag> Container </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Elasticsearchå¸¸ç”¨APIæ“ä½œ</title>
      <link href="/posts/ee708f6b/"/>
      <url>/posts/ee708f6b/</url>
      
        <content type="html"><![CDATA[<p>å¦‚æœæœ‰ Kibana çš„è¯ï¼Œä»¥ä¸‹æ‰€æœ‰æ“ä½œéƒ½å¯ä»¥åœ¨ Kibana çš„ DevTools é¡µé¢è¿›è¡Œè°ƒè¯•ï¼Œå¯ä»¥å…å»è®¤è¯æ“ä½œã€‚</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/20220425224238.png" alt="Kibanaè°ƒè¯•æŸ¥çœ‹ç´¢å¼•æ¥å£"></p><table><thead><tr><th>æ¥å£</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td>&#x2F;_cat&#x2F;health?v</td><td>é›†ç¾¤å¥åº·çŠ¶æ€</td></tr><tr><td>&#x2F;_cat&#x2F;shards</td><td>åˆ†ç‰‡ä¿¡æ¯</td></tr><tr><td>&#x2F;_cat&#x2F;nodes</td><td>èŠ‚ç‚¹ä¿¡æ¯</td></tr><tr><td>&#x2F;_cat&#x2F;indices</td><td>ç´¢å¼•ä¿¡æ¯</td></tr><tr><td>&#x2F;_cat&#x2F;allocation?v</td><td>ç£ç›˜å ç”¨</td></tr><tr><td>&#x2F;ç´¢å¼•åå­—&#x2F;_mapping?pretty</td><td>æŸ¥çœ‹ mappingï¼ˆç´¢å¼•å­—æ®µç±»å‹ç­‰ï¼‰</td></tr></tbody></table><p><code>?v</code> æ˜¯è¯¦ç»†ä¿¡æ¯è¾“å‡º</p><h2 id="ç´¢å¼•"><a href="#ç´¢å¼•" class="headerlink" title="ç´¢å¼•"></a>ç´¢å¼•</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹æœ‰å“ªäº›ç´¢å¼•</span></span><br><span class="line">curl -u elastic:password localhost:9200/_cat/indices</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºç´¢å¼•</span></span><br><span class="line">curl -u elastic:password -X PUT <span class="string">&quot;localhost:9200/ç´¢å¼•åå­—?pretty&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤ç´¢å¼•</span></span><br><span class="line">curl -u elastic:password -s -XDELETE 10.0.0.127:9200/ç´¢å¼•åå­—</span><br></pre></td></tr></table></figure><blockquote><p>ç´¢å¼•åå­—å¯ä»¥é€šè¿‡æŸ¥çœ‹ç´¢å¼•æ¥å£æŸ¥çœ‹</p></blockquote><h2 id="ä¿®æ”¹å¯†ç "><a href="#ä¿®æ”¹å¯†ç " class="headerlink" title="ä¿®æ”¹å¯†ç "></a>ä¿®æ”¹å¯†ç </h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -H <span class="string">&quot;Content-Type:application/json&quot;</span> -XPOST -u elastic:password <span class="string">&#x27;http://127.0.0.1:9200/_xpack/security/user/elastic/_password&#x27;</span> -d <span class="string">&#x27;&#123; &quot;password&quot; : &quot;123456&quot; &#125;&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="æ·»åŠ è§’è‰²"><a href="#æ·»åŠ è§’è‰²" class="headerlink" title="æ·»åŠ è§’è‰²"></a>æ·»åŠ è§’è‰²</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">curl -XPOST -H <span class="string">&#x27;Content-type: application/json&#x27;</span> -u elastic:password <span class="string">&#x27;http://1.1.1.1:9600/_xpack/security/role/admin?pretty&#x27;</span> -d <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">&quot;run_as&quot;:[&quot;elastic&quot;],</span></span><br><span class="line"><span class="string">&quot;cluster&quot;:[&quot;all&quot;],</span></span><br><span class="line"><span class="string">&quot;indices&quot;:[</span></span><br><span class="line"><span class="string"> &#123;</span></span><br><span class="line"><span class="string">  &quot;names&quot;:[&quot;*&quot;],</span></span><br><span class="line"><span class="string">  &quot;privileges&quot;:[&quot;all&quot;]</span></span><br><span class="line"><span class="string"> &#125;</span></span><br><span class="line"><span class="string">]</span></span><br><span class="line"><span class="string">&#125;&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="æŸ¥çœ‹è§’è‰²"><a href="#æŸ¥çœ‹è§’è‰²" class="headerlink" title="æŸ¥çœ‹è§’è‰²"></a>æŸ¥çœ‹è§’è‰²</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -XGET -H <span class="string">&#x27;Content-type: application/json&#x27;</span> -u elastic:password <span class="string">&#x27;http://1.1.1.1:9600/_xpack/security/role/admin?pretty&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="å…è®¸è‡ªåŠ¨åˆ›å»ºç´¢å¼•"><a href="#å…è®¸è‡ªåŠ¨åˆ›å»ºç´¢å¼•" class="headerlink" title="å…è®¸è‡ªåŠ¨åˆ›å»ºç´¢å¼•"></a>å…è®¸è‡ªåŠ¨åˆ›å»ºç´¢å¼•</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -XPUT -H <span class="string">&quot;Content-Type:application/json&quot;</span> -u <span class="string">&quot;admin:password&quot;</span> https://1.1.1.1:9200/_cluster/settings -d <span class="string">&#x27;&#123;&quot;persistent&quot;:&#123;&quot;action.auto_create_index&quot;:&quot;true&quot;&#125;&#125;&#x27;</span> -k</span><br></pre></td></tr></table></figure><h2 id="æŸ¥çœ‹è®¾ç½®"><a href="#æŸ¥çœ‹è®¾ç½®" class="headerlink" title="æŸ¥çœ‹è®¾ç½®"></a>æŸ¥çœ‹è®¾ç½®</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -XGET -u <span class="string">&quot;admin:password&quot;</span> https://1.1.1.1:9200/_cluster/settings -k</span><br></pre></td></tr></table></figure><h2 id="ä¿®æ”¹è®¾ç½®"><a href="#ä¿®æ”¹è®¾ç½®" class="headerlink" title="ä¿®æ”¹è®¾ç½®"></a>ä¿®æ”¹è®¾ç½®</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">curl -u elastic:password 1.1.1.1:9200/_cluster/settings -X PUT -H <span class="string">&quot;Content-Type: application/json&quot;</span> -d <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">  &quot;persistent&quot; : &#123;</span></span><br><span class="line"><span class="string">    &quot;cluster&quot; : &#123;</span></span><br><span class="line"><span class="string">      &quot;max_shards_per_node&quot; : &quot;900000&quot;</span></span><br><span class="line"><span class="string">    &#125;,</span></span><br><span class="line"><span class="string">    &quot;indices&quot; : &#123;</span></span><br><span class="line"><span class="string">      &quot;breaker&quot; : &#123;</span></span><br><span class="line"><span class="string">        &quot;total&quot; : &#123;</span></span><br><span class="line"><span class="string">          &quot;limit&quot; : &quot;95%&quot;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;,</span></span><br><span class="line"><span class="string">    &quot;xpack&quot; : &#123;</span></span><br><span class="line"><span class="string">      &quot;monitoring&quot; : &#123;</span></span><br><span class="line"><span class="string">        &quot;collection&quot; : &#123;</span></span><br><span class="line"><span class="string">          &quot;enabled&quot; : &quot;true&quot;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#125;&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹å•ä¸ª-node-æœ€å¤§åˆ†ç‰‡æ•°"><a href="#ä¿®æ”¹å•ä¸ª-node-æœ€å¤§åˆ†ç‰‡æ•°" class="headerlink" title="ä¿®æ”¹å•ä¸ª node æœ€å¤§åˆ†ç‰‡æ•°"></a>ä¿®æ”¹å•ä¸ª node æœ€å¤§åˆ†ç‰‡æ•°</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># es æ”¯æŒæ°¸ä¹…ä¿®æ”¹é…ç½®ä¸ä¸´æ—¶ä¿®æ”¹é…ç½®, å¦‚æœæƒ³è¦ä¸´æ—¶ä¿®æ”¹:  &quot;transient&quot; : &#123;&quot;cluster&quot; : &#123;&quot;max_shards_per_node&quot; : &quot;900000&quot;&#125;&#125;</span></span><br><span class="line">curl -X PUT localhost:9200/_cluster/settings -H <span class="string">&quot;Content-Type: application/json&quot;</span> -d <span class="string">&#x27;&#123; &quot;persistent&quot;: &#123; &quot;cluster.max_shards_per_node&quot;: &quot;3000&quot; &#125; &#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æœªåˆ†é…çš„åˆ†ç‰‡æ•°</span></span><br><span class="line">curl -XGET http://localhost:9200/_cluster/health\?pretty | grep unassigned_shards</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æ—¥å¿— </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Elasticsearch </tag>
            
            <tag> log </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQLå¸¸ç”¨æ“ä½œè®°å½•</title>
      <link href="/posts/fa013442/"/>
      <url>/posts/fa013442/</url>
      
        <content type="html"><![CDATA[<p>è®°å½•ä¸€ä¸‹æ—¥å¸¸å·¥ä½œä¸­å¸¸ç”¨åˆ°çš„ MySQL è¯­å¥å’Œä¸€äº›é…ç½®ç­‰ï¼Œæ–¹ä¾¿æ—¥åæŸ¥è¯¢</p><h2 id="ç”¨æˆ·æˆæƒç›¸å…³"><a href="#ç”¨æˆ·æˆæƒç›¸å…³" class="headerlink" title="ç”¨æˆ·æˆæƒç›¸å…³"></a>ç”¨æˆ·æˆæƒç›¸å…³</h2><h3 id="åˆ›å»ºç”¨æˆ·"><a href="#åˆ›å»ºç”¨æˆ·" class="headerlink" title="åˆ›å»ºç”¨æˆ·"></a>åˆ›å»ºç”¨æˆ·</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- CREATE USER &#x27;root&#x27;@&#x27;%&#x27; IDENTIFIED BY &#x27;123456&#x27;;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">WITH</span> mysql_native_password <span class="keyword">BY</span> <span class="string">&#x27;123456&#x27;</span>;</span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹å¯†ç "><a href="#ä¿®æ”¹å¯†ç " class="headerlink" title="ä¿®æ”¹å¯†ç "></a>ä¿®æ”¹å¯†ç </h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ALTER USER &#x27;root&#x27;@&#x27;%&#x27; IDENTIFIED BY &#x27;123456&#x27;;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">WITH</span> mysql_native_password <span class="keyword">BY</span> <span class="string">&#x27;123456&#x27;</span>;</span><br></pre></td></tr></table></figure><h3 id="æˆæƒ"><a href="#æˆæƒ" class="headerlink" title="æˆæƒ"></a>æˆæƒ</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Grant</span> <span class="keyword">all</span> privileges <span class="keyword">on</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">to</span> <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;%&#x27;</span> <span class="keyword">with</span> <span class="keyword">grant</span> option;</span><br></pre></td></tr></table></figure><h3 id="æˆæƒçš„åŒæ—¶ä¿®æ”¹å¯†ç "><a href="#æˆæƒçš„åŒæ—¶ä¿®æ”¹å¯†ç " class="headerlink" title="æˆæƒçš„åŒæ—¶ä¿®æ”¹å¯†ç "></a>æˆæƒçš„åŒæ—¶ä¿®æ”¹å¯†ç </h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Grant</span> <span class="keyword">all</span> privileges <span class="keyword">on</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">to</span> <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;%&#x27;</span> identified <span class="keyword">by</span> <span class="string">&#x27;123456&#x27;</span> <span class="keyword">with</span> <span class="keyword">grant</span> option;</span><br></pre></td></tr></table></figure><h3 id="åˆ›å»ºåªè¯»è´¦å·"><a href="#åˆ›å»ºåªè¯»è´¦å·" class="headerlink" title="åˆ›å»ºåªè¯»è´¦å·"></a>åˆ›å»ºåªè¯»è´¦å·</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SElECT</span> <span class="keyword">ON</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;read_only&#x27;</span>@<span class="string">&#x27;ip&#x27;</span> IDENTIFIED <span class="keyword">BY</span> &quot;password&quot;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">CREATE USER &#x27;read_only&#x27;@&#x27;ip&#x27; IDENTIFIED BY &#x27;password&#x27;;</span></span><br><span class="line"><span class="comment">GRANT SELECT ON *.* TO &#x27;read_only&#x27;@&#x27;ip&#x27; WITH GRANT OPTION;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* åˆ é™¤æƒé™ */</span></span><br><span class="line"><span class="comment">/* REVOKE all privileges ON *.* FROM &#x27;read_only_user&#x27;@&#x27;ip&#x27;; */</span></span><br></pre></td></tr></table></figure><h3 id="åˆ›å»ºä¸šåŠ¡è´¦å·"><a href="#åˆ›å»ºä¸šåŠ¡è´¦å·" class="headerlink" title="åˆ›å»ºä¸šåŠ¡è´¦å·"></a>åˆ›å»ºä¸šåŠ¡è´¦å·</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;username&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;password&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">Alter</span>, <span class="keyword">Create</span>, <span class="keyword">Create</span> <span class="keyword">View</span>, <span class="keyword">Delete</span>, Index, <span class="keyword">Insert</span>, Lock Tables, <span class="keyword">Select</span>, <span class="keyword">Show</span> Databases, <span class="keyword">Show</span> <span class="keyword">View</span>, <span class="keyword">Update</span> <span class="keyword">ON</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">TO</span> `username`@`<span class="operator">%</span>`;</span><br></pre></td></tr></table></figure><h2 id="åº“ç›¸å…³"><a href="#åº“ç›¸å…³" class="headerlink" title="åº“ç›¸å…³"></a>åº“ç›¸å…³</h2><h3 id="å»ºåº“"><a href="#å»ºåº“" class="headerlink" title="å»ºåº“"></a>å»ºåº“</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE `idp_app` <span class="type">CHARACTER</span> <span class="keyword">SET</span> <span class="string">&#x27;utf8&#x27;</span> <span class="keyword">COLLATE</span> <span class="string">&#x27;utf8_general_ci&#x27;</span>;</span><br><span class="line"><span class="keyword">CREATE</span> DATABASE `idp_sdk` <span class="type">CHARACTER</span> <span class="keyword">SET</span> <span class="string">&#x27;utf8mb4&#x27;</span> <span class="keyword">COLLATE</span> <span class="string">&#x27;utf8mb4_general_ci&#x27;</span>;</span><br></pre></td></tr></table></figure><h2 id="é…ç½®æ–‡ä»¶ç›¸å…³"><a href="#é…ç½®æ–‡ä»¶ç›¸å…³" class="headerlink" title="é…ç½®æ–‡ä»¶ç›¸å…³"></a>é…ç½®æ–‡ä»¶ç›¸å…³</h2><p>apt å®‰è£…çš„ mysql é…ç½®æ–‡ä»¶åœ¨ <code>/etc/mysql/mysql.conf.d/mysqld.cnf</code></p><h3 id="åˆå§‹åŒ–å¯†ç "><a href="#åˆå§‹åŒ–å¯†ç " class="headerlink" title="åˆå§‹åŒ–å¯†ç "></a>åˆå§‹åŒ–å¯†ç </h3><blockquote><p>ubuntu ç³»ç»Ÿé€šè¿‡ apt å®‰è£…çš„ mysqlï¼Œéœ€è¦åˆ‡æ¢åˆ° rootï¼Œç„¶åæ‰§è¡Œ mysql å‘½ä»¤å°±å¯ä»¥ç™»å½•ï¼ˆä¸ç”¨å¯†ç ï¼‰ï¼Œå¯¹åº”çš„ç”¨æˆ·æ˜¯ <code>root@localhost</code><br>å½“ç„¶ä¹Ÿå¯ä»¥ <code>cat /etc/mysql/debian.cnf</code> æŸ¥çœ‹å¯†ç ã€‚</p></blockquote><h3 id="è¡¨åå¼ºåˆ¶è½¬æ¢ä¸ºå°å†™"><a href="#è¡¨åå¼ºåˆ¶è½¬æ¢ä¸ºå°å†™" class="headerlink" title="è¡¨åå¼ºåˆ¶è½¬æ¢ä¸ºå°å†™"></a>è¡¨åå¼ºåˆ¶è½¬æ¢ä¸ºå°å†™</h3><p>ä»…é€‚ç”¨äº MySQL 5.7 åŠä»¥ä¸‹ç‰ˆæœ¬ï¼Œåˆ°äº† 8.0ï¼Œåªæ”¯æŒåˆå§‹åŒ–æ—¶æŒ‡å®šè¯¥å‚æ•°ï¼Œåˆå§‹åŒ–ä¹‹åï¼Œå¦‚æœä¿®æ”¹äº†è¯¥å‚æ•°ï¼Œå¯åŠ¨å°±ä¼šæŠ¥é”™ã€‚</p><p>é…ç½®æ–‡ä»¶åœ¨ [mysqld] ä¸‹é¢æ–°å¢ä¸€è¡Œ</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[mysqld]</span></span><br><span class="line"><span class="attr">lower_case_table_names</span> = <span class="number">1</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥é€šè¿‡æ‰§è¡Œ sql æŸ¥çœ‹æ˜¯å¦è®¾ç½®æˆåŠŸ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;lower_case_table_names&#x27;</span>;</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹å»ºåº“å»ºè¡¨è¯­å¥"><a href="#æŸ¥çœ‹å»ºåº“å»ºè¡¨è¯­å¥" class="headerlink" title="æŸ¥çœ‹å»ºåº“å»ºè¡¨è¯­å¥"></a>æŸ¥çœ‹å»ºåº“å»ºè¡¨è¯­å¥</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> database django;</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">table</span> django.auth_user;</span><br></pre></td></tr></table></figure><h2 id="binlog"><a href="#binlog" class="headerlink" title="binlog"></a>binlog</h2><p>æŸ¥çœ‹ binlog çŠ¶æ€</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">MySQL [(<span class="keyword">none</span>)] <span class="operator">&gt;</span> <span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;log_bin%&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------------+------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name                   <span class="operator">|</span> <span class="keyword">Value</span>                              <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------------+------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> log_bin                         <span class="operator">|</span> <span class="keyword">ON</span>                                 <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> log_bin_basename                <span class="operator">|</span> <span class="operator">/</span>data<span class="operator">/</span>mysql<span class="operator">/</span>binlog<span class="operator">/</span>mysql_bin       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> log_bin_index                   <span class="operator">|</span> <span class="operator">/</span>data<span class="operator">/</span>mysql<span class="operator">/</span>binlog<span class="operator">/</span>mysql_bin.index <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> log_bin_trust_function_creators <span class="operator">|</span> OFF                                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> log_bin_use_v1_row_events       <span class="operator">|</span> OFF                                <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------------+------------------------------------+</span></span><br><span class="line"><span class="number">5</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.02</span> sec)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹ binlog æ¨¡å¼</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MySQL [(<span class="keyword">none</span>)] <span class="operator">&gt;</span> <span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;%binlog_format%&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+-------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name <span class="operator">|</span> <span class="keyword">Value</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+-------+</span></span><br><span class="line"><span class="operator">|</span> binlog_format <span class="operator">|</span> <span class="type">ROW</span>   <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+-------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>binlog é…ç½®æ–‡ä»¶</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[mysqld]</span></span><br><span class="line"><span class="attr">server_id</span> = <span class="number">1</span></span><br><span class="line"><span class="attr">log_bin</span> = /var/log/mysql/mysql-bin.log</span><br><span class="line"><span class="attr">max_binlog_size</span> = <span class="number">1</span>G</span><br><span class="line"><span class="attr">binlog_format</span> = row</span><br><span class="line"><span class="attr">binlog_row_image</span> = full</span><br></pre></td></tr></table></figure><h2 id="æ’åº"><a href="#æ’åº" class="headerlink" title="æ’åº"></a>æ’åº</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">from</span> runoob_tbl <span class="keyword">ORDER</span> <span class="keyword">BY</span> submission_date <span class="keyword">ASC</span>;  # å‡åº</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">from</span> runoob_tbl <span class="keyword">ORDER</span> <span class="keyword">BY</span> submission_date <span class="keyword">DESC</span>;   # é™åº</span><br></pre></td></tr></table></figure><h2 id="æ‰¹é‡-kill-æ…¢æŸ¥è¯¢"><a href="#æ‰¹é‡-kill-æ…¢æŸ¥è¯¢" class="headerlink" title="æ‰¹é‡ kill æ…¢æŸ¥è¯¢"></a>æ‰¹é‡ kill æ…¢æŸ¥è¯¢</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æŸ¥è¯¢å“ªäº›æŸ¥è¯¢æ—¶é—´å¤§äº20ç§’</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span>  <span class="keyword">from</span> information_schema.processlist <span class="keyword">where</span> COMMAND<span class="operator">=</span><span class="string">&#x27;Query&#x27;</span> <span class="keyword">AND</span> <span class="type">time</span> <span class="operator">&gt;</span> <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ç”Ÿæˆkillæ…¢æŸ¥è¯¢çš„è¯­å¥ï¼ˆä¸æ‰§è¡Œkillï¼‰</span></span><br><span class="line"><span class="keyword">select</span> concat(<span class="string">&#x27;KILL &#x27;</span>,id,<span class="string">&#x27;;&#x27;</span>) <span class="keyword">from</span> information_schema.processlist <span class="keyword">where</span> COMMAND<span class="operator">=</span><span class="string">&#x27;Query&#x27;</span> <span class="keyword">AND</span> <span class="type">time</span> <span class="operator">&gt;</span> <span class="number">20</span>;</span><br></pre></td></tr></table></figure><p>è‡ªåŠ¨ kill æ…¢ SQL è„šæœ¬ï¼Œå¹¶è®°å½•æ—¥å¿—åˆ°æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">MYSQL_CMD=<span class="string">&quot;mysql -uroot -pxxxxx -h 192.168.10.10&quot;</span></span><br><span class="line">NOW=$(<span class="built_in">date</span> +<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>)</span><br><span class="line">SLOWLOG=$(<span class="variable">$&#123;MYSQL_CMD&#125;</span> -e <span class="string">&quot;select * from information_schema.processlist where COMMAND=&#x27;Query&#x27; AND time &gt; 10;&quot;</span> 2&gt;/dev/null | sed <span class="string">&#x27;1d&#x27;</span> )</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -n <span class="string">&quot;<span class="variable">$&#123;SLOWLOG&#125;</span>&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$&#123;NOW&#125;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$&#123;SLOWLOG&#125;</span></span><br><span class="line">    <span class="variable">$&#123;MYSQL_CMD&#125;</span> -e <span class="string">&quot;select id from information_schema.processlist where COMMAND=&#x27;Query&#x27; AND time &gt; 10;&quot;</span> 2&gt;/dev/null | sed <span class="string">&#x27;1d&#x27;</span> | xargs -I &#123;&#125; <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;MYSQL_CMD&#125;</span> -e &#x27;kill &#123;&#125;;&#x27;&quot;</span> | bash 2&gt;/dev/null</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><p>crontab é…ç½®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* * * * * bash /root/slowlog.sh &gt;&gt; /root/slowlog.txt 2&gt;&amp;1</span><br></pre></td></tr></table></figure><h2 id="æŸ¥çœ‹ç‰ˆæœ¬"><a href="#æŸ¥çœ‹ç‰ˆæœ¬" class="headerlink" title="æŸ¥çœ‹ç‰ˆæœ¬"></a>æŸ¥çœ‹ç‰ˆæœ¬</h2><h3 id="æŸ¥çœ‹å˜é‡çš„æ–¹å¼"><a href="#æŸ¥çœ‹å˜é‡çš„æ–¹å¼" class="headerlink" title="æŸ¥çœ‹å˜é‡çš„æ–¹å¼"></a>æŸ¥çœ‹å˜é‡çš„æ–¹å¼</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;%version%&#x27;</span>;</span><br></pre></td></tr></table></figure><h3 id="mysql-å‘½ä»¤è¡Œæ‰§è¡Œå‘½ä»¤çš„æ–¹å¼"><a href="#mysql-å‘½ä»¤è¡Œæ‰§è¡Œå‘½ä»¤çš„æ–¹å¼" class="headerlink" title="mysql å‘½ä»¤è¡Œæ‰§è¡Œå‘½ä»¤çš„æ–¹å¼"></a>mysql å‘½ä»¤è¡Œæ‰§è¡Œå‘½ä»¤çš„æ–¹å¼</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">status</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨-MySQL-å‡½æ•°æ–¹å¼ï¼š"><a href="#ä½¿ç”¨-MySQL-å‡½æ•°æ–¹å¼ï¼š" class="headerlink" title="ä½¿ç”¨ MySQL å‡½æ•°æ–¹å¼ï¼š"></a>ä½¿ç”¨ MySQL å‡½æ•°æ–¹å¼ï¼š</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> version();</span><br></pre></td></tr></table></figure><h2 id="æŸ¥çœ‹å“ªäº›åº“ä½¿ç”¨çš„æ˜¯-MyISAM-å¼•æ“"><a href="#æŸ¥çœ‹å“ªäº›åº“ä½¿ç”¨çš„æ˜¯-MyISAM-å¼•æ“" class="headerlink" title="æŸ¥çœ‹å“ªäº›åº“ä½¿ç”¨çš„æ˜¯ MyISAM å¼•æ“"></a>æŸ¥çœ‹å“ªäº›åº“ä½¿ç”¨çš„æ˜¯ MyISAM å¼•æ“</h2><p>æŸ¥è¯¢å“ªäº›è¡¨å¼•æ“æ˜¯ MyISAM</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> TABLE_SCHEMA <span class="keyword">as</span> DbName ,TABLE_NAME <span class="keyword">as</span> TableName ,ENGINE <span class="keyword">as</span> Engine <span class="keyword">FROM</span> information_schema.TABLES <span class="keyword">WHERE</span> ENGINE<span class="operator">=</span><span class="string">&#x27;MyISAM&#x27;</span> <span class="keyword">AND</span> TABLE_SCHEMA <span class="keyword">NOT</span> <span class="keyword">IN</span>(<span class="string">&#x27;mysql&#x27;</span>,<span class="string">&#x27;information_schema&#x27;</span>,<span class="string">&#x27;performance_schema&#x27;</span>);</span><br></pre></td></tr></table></figure><p>ç”Ÿæˆ <code>ALTER</code> è¯­å¥æ¥è½¬æ¢åˆ° <code>InnoDB</code></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> CONCAT(<span class="string">&#x27;ALTER TABLE &#x27;</span>, TABLE_SCHEMA,<span class="string">&#x27;.&#x27;</span>,TABLE_NAME, <span class="string">&#x27; ENGINE = InnoDB;&#x27;</span>) <span class="keyword">FROM</span> information_schema.TABLES <span class="keyword">WHERE</span> ENGINE<span class="operator">=</span><span class="string">&#x27;MyISAM&#x27;</span> <span class="keyword">AND</span> TABLE_SCHEMA <span class="keyword">NOT</span> <span class="keyword">IN</span>(<span class="string">&#x27;mysql&#x27;</span>,<span class="string">&#x27;information_schema&#x27;</span>,<span class="string">&#x27;performance_schema&#x27;</span>);</span><br></pre></td></tr></table></figure><h2 id="æŸ¥çœ‹è¯­å¥ä½¿ç”¨çš„ç´¢å¼•"><a href="#æŸ¥çœ‹è¯­å¥ä½¿ç”¨çš„ç´¢å¼•" class="headerlink" title="æŸ¥çœ‹è¯­å¥ä½¿ç”¨çš„ç´¢å¼•"></a>æŸ¥çœ‹è¯­å¥ä½¿ç”¨çš„ç´¢å¼•</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- EXPLAIN select è¯­å¥;</span></span><br><span class="line">mysql<span class="operator">&gt;</span> explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> e_name<span class="operator">=</span><span class="string">&#x27;Mark&#x27;</span>\G</span><br><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span> <span class="number">1.</span> <span class="type">row</span> <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line">           id: <span class="number">1</span></span><br><span class="line">  select_type: SIMPLE</span><br><span class="line">        <span class="keyword">table</span>: emp</span><br><span class="line">   partitions: <span class="keyword">NULL</span></span><br><span class="line">         type: <span class="keyword">ref</span></span><br><span class="line">possible_keys: idx_ename</span><br><span class="line">          key: idx_ename</span><br><span class="line">      key_len: <span class="number">81</span></span><br><span class="line">          <span class="keyword">ref</span>: const</span><br><span class="line">         <span class="keyword">rows</span>: <span class="number">1</span></span><br><span class="line">     filtered: <span class="number">100.00</span></span><br><span class="line">        Extra: <span class="keyword">NULL</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">1</span> warning (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¯´æ˜</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ï¼ˆ<span class="number">1</span>ï¼‰  idï¼šSELECT è¯†åˆ«ç¬¦</span><br><span class="line">ï¼ˆ<span class="number">2</span>ï¼‰  select_typeï¼šSELECT æŸ¥è¯¢çš„ç±»å‹</span><br><span class="line">ï¼ˆ<span class="number">3</span>ï¼‰  tableï¼šæ•°æ®è¡¨çš„åå­—</span><br><span class="line">ï¼ˆ<span class="number">4</span>ï¼‰  partitionsï¼šåŒ¹é…çš„åˆ†åŒº</span><br><span class="line">ï¼ˆ<span class="number">5</span>ï¼‰  <span class="built_in">type</span>ï¼šè®¿é—®è¡¨çš„æ–¹å¼</span><br><span class="line">ï¼ˆ<span class="number">6</span>ï¼‰  possible_keysï¼šæŸ¥è¯¢æ—¶å¯èƒ½ä½¿ç”¨çš„ç´¢å¼•</span><br><span class="line">ï¼ˆ<span class="number">7</span>ï¼‰  keyï¼šå®é™…ä½¿ç”¨çš„ç´¢å¼•</span><br><span class="line">ï¼ˆ<span class="number">8</span>ï¼‰  key_lenï¼šç´¢å¼•å­—æ®µçš„é•¿åº¦</span><br><span class="line">ï¼ˆ<span class="number">9</span>ï¼‰  refï¼šè¿æ¥æŸ¥è¯¢æ—¶ï¼Œç”¨äºæ˜¾ç¤ºå…³è”çš„å­—æ®µ</span><br><span class="line">ï¼ˆ<span class="number">10</span>ï¼‰ rowsï¼šéœ€è¦æ‰«æçš„è¡Œæ•°(ä¼°ç®—çš„è¡Œæ•°)</span><br><span class="line">ï¼ˆ<span class="number">11</span>ï¼‰ filteredï¼šæŒ‰æ¡ä»¶è¿‡æ»¤åæŸ¥è¯¢åˆ°çš„è®°å½•çš„ç™¾åˆ†æ¯”</span><br><span class="line">ï¼ˆ<span class="number">12</span>ï¼‰ Extraï¼šæ‰§è¡Œæƒ…å†µçš„æè¿°å’Œè¯´æ˜</span><br></pre></td></tr></table></figure><h2 id="åªè¯»æ¨¡å¼"><a href="#åªè¯»æ¨¡å¼" class="headerlink" title="åªè¯»æ¨¡å¼"></a>åªè¯»æ¨¡å¼</h2><h3 id="è®¾ç½®ä¸ºåªè¯»æ¨¡å¼"><a href="#è®¾ç½®ä¸ºåªè¯»æ¨¡å¼" class="headerlink" title="è®¾ç½®ä¸ºåªè¯»æ¨¡å¼"></a>è®¾ç½®ä¸ºåªè¯»æ¨¡å¼</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">flush tables <span class="keyword">with</span> read lock;</span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> read_only<span class="operator">=</span><span class="keyword">on</span>;</span><br></pre></td></tr></table></figure><h3 id="è®¾ç½®ä¸ºå¯è¯»å†™æ¨¡å¼"><a href="#è®¾ç½®ä¸ºå¯è¯»å†™æ¨¡å¼" class="headerlink" title="è®¾ç½®ä¸ºå¯è¯»å†™æ¨¡å¼"></a>è®¾ç½®ä¸ºå¯è¯»å†™æ¨¡å¼</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> global read_only=off;</span><br><span class="line">unlock tables;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
            <tag> MySQL </tag>
            
            <tag> SQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Kubernetesä½¿ç”¨ingressåå‘ä»£ç†å¤–éƒ¨IP</title>
      <link href="/posts/0ad6df1b/"/>
      <url>/posts/0ad6df1b/</url>
      
        <content type="html"><![CDATA[<p>æˆ‘ä»¬å¹³å¸¸ä½¿ç”¨ k8s çš„ service éƒ½æ˜¯è‡ªåŠ¨å‘ç°å¢åŠ  endpoint çš„ï¼Œä½†æ˜¯æœ‰çš„æ—¶å€™é›†ç¾¤å¤–çš„æœåŠ¡æˆ‘ä»¬åˆæƒ³ç”¨ k8s çš„ ingress æ¥ç»Ÿä¸€åšå…¥å£ï¼Œå°±ä¼šæ¶‰åŠåˆ°è‡ªå®šä¹‰ endpoint</p><h2 id="åˆ›å»º-service"><a href="#åˆ›å»º-service" class="headerlink" title="åˆ›å»º service"></a>åˆ›å»º service</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kibana</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">ops</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">ClusterIP</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">kibana</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure><h2 id="åˆ›å»º-endpoint"><a href="#åˆ›å»º-endpoint" class="headerlink" title="åˆ›å»º endpoint"></a>åˆ›å»º endpoint</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Endpoints</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kibana</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">ops</span></span><br><span class="line"><span class="attr">subsets:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">addresses:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">ip:</span> <span class="number">10.0</span><span class="number">.0</span><span class="number">.12</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">ip:</span> <span class="number">10.0</span><span class="number">.0</span><span class="number">.13</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">kibana</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5601</span></span><br><span class="line">    <span class="attr">protocol:</span> <span class="string">TCP</span></span><br></pre></td></tr></table></figure><h2 id="åˆ›å»º-Ingress"><a href="#åˆ›å»º-Ingress" class="headerlink" title="åˆ›å»º Ingress"></a>åˆ›å»º Ingress</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kibana</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">ops</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">kubernetes.io/ingress.class:</span> <span class="string">&quot;nginx&quot;</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/proxy-body-size:</span> <span class="string">300M</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/server-snippet:</span> <span class="string">|</span></span><br><span class="line"><span class="string">      if ($http_user_agent ~* (Scrapy|Go-http-client/1.1|HttpClient|curl/7.64.1)) &#123;</span></span><br><span class="line"><span class="string">        return 403;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string"></span><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">kibana.i.com</span></span><br><span class="line">    <span class="attr">http:</span></span><br><span class="line">      <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">serviceName:</span> <span class="string">kibana</span></span><br><span class="line">          <span class="attr">servicePort:</span> <span class="number">80</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">/</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å®¹å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> k8s </tag>
            
            <tag> Service </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Kafkaå¸¸ç”¨æ“ä½œè®°å½•</title>
      <link href="/posts/12ab226e/"/>
      <url>/posts/12ab226e/</url>
      
        <content type="html"><![CDATA[<p>ç»å¸¸ç”¨åˆ°çš„ Kafka å‘½ä»¤è®°å½•ä»¥ä¸‹ï¼Œæ–¹ä¾¿æŸ¥æ‰¾ã€‚kafka çš„æ­å»ºå¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç«  <a href="/posts/60a9e345">Kafkaå’Œzookeeperæ­å»º</a></p><div class="note warning simple"><p>æ³¨æ„: â€“bootstrap-server å‚æ•°é…ç½®çš„ kafka åœ°å€éœ€è¦æ ¹æ® kafka ç›‘å¬åœ°å€æ¥åˆ¤æ–­, å¦‚æœç›‘å¬çš„æ˜¯è‡ªå·±çš„ ip è€Œä¸æ˜¯ 0.0.0.0, é‚£å°±ä¸è¦é…ç½® localhost, æ”¹ç”¨ ip åœ°å€.</p></div><h2 id="Topic-æ“ä½œ"><a href="#Topic-æ“ä½œ" class="headerlink" title="Topic æ“ä½œ"></a>Topic æ“ä½œ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºtopic</span></span><br><span class="line">bin/kafka-topics.sh --bootstrap-server localhost:9092 --create --replication-factor 1 --partitions 3 --topic test_topic</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹topicå…·ä½“ä¿¡æ¯</span></span><br><span class="line">bin/kafka-topics.sh --bootstrap-server localhost:9092  --describe --topic test_topic</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ‰€æœ‰çš„topicåˆ—è¡¨</span></span><br><span class="line">bin/kafka-topics.sh --bootstrap-server localhost:9092 --list</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤topic</span></span><br><span class="line">bin/kafka-topics.sh --bootstrap-server localhost:9092 --delete --topic test_topic</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹topicåˆ†åŒºæ•°</span></span><br><span class="line">bin/kafka-topics.sh --bootstrap-server localhost:9092 --alter --partitions 8 --topic test_topic</span><br></pre></td></tr></table></figure><p>kafka åˆ é™¤ topic æœ‰å¯èƒ½æç¤º <code>marked for deletion</code> è¿™ç§æƒ…å†µä¸‹, éœ€è¦åœæ­¢æ‰€æœ‰çš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…</p><h2 id="æ¶ˆè´¹ç»„æ“ä½œ"><a href="#æ¶ˆè´¹ç»„æ“ä½œ" class="headerlink" title="æ¶ˆè´¹ç»„æ“ä½œ"></a>æ¶ˆè´¹ç»„æ“ä½œ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ˜¾ç¤ºæ‰€æœ‰æ¶ˆè´¹ç»„</span></span><br><span class="line">bin/kafka-consumer-groups.sh --bootstrap-server localhost:9092 --all-groups --list</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ‰€æœ‰æ¶ˆè´¹ç»„è¯¦æƒ…</span></span><br><span class="line">bin/kafka-consumer-groups.sh --bootstrap-server localhost:9092 --all-groups --describe</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å•ç‹¬ç»„çš„è¯¦ç»†ä¿¡æ¯</span></span><br><span class="line">bin/kafka-consumer-groups.sh --bootstrap-server localhost:9092 --group test_group --describe</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰‹åŠ¨åˆ›å»ºæ¶ˆè´¹ç»„</span></span><br><span class="line">bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic idkNfcKey1 --consumer-property group.id=idpTsp1</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤æ¶ˆè´¹ç»„ï¼ˆå‰ææ˜¯æ²¡æœ‰åœ¨æ¶ˆè´¹çš„ï¼‰</span></span><br><span class="line">bin/kafka-consumer-groups.sh --bootstrap-server localhost:9092 --group test_group  --delete</span><br></pre></td></tr></table></figure><h2 id="æ§åˆ¶å°ç”Ÿäº§æ¶ˆè´¹"><a href="#æ§åˆ¶å°ç”Ÿäº§æ¶ˆè´¹" class="headerlink" title="æ§åˆ¶å°ç”Ÿäº§æ¶ˆè´¹"></a>æ§åˆ¶å°ç”Ÿäº§æ¶ˆè´¹</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç”Ÿäº§è€…å‘é€æ¶ˆæ¯, ç„¶åæ§åˆ¶å°è¾“å…¥å†…å®¹ï¼Œå›è½¦å³å¯</span></span><br><span class="line">bin/kafka-console-producer.sh --bootstrap-server localhost:9092 --topic test_topic</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯, --from-beginning  æ˜¯æŒ‡ä»å¤´è¿›è¡Œæ¶ˆè´¹ï¼Œå¯èƒ½ä¼šæ‰“å°å¤§é‡ä¸œè¥¿åœ¨æ§åˆ¶å°ä¸Šã€‚</span></span><br><span class="line">bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic test_topic --from-beginning</span><br></pre></td></tr></table></figure><h3 id="æ§åˆ¶å°æŸ¥çœ‹æœ€æ–°æ¶ˆæ¯"><a href="#æ§åˆ¶å°æŸ¥çœ‹æœ€æ–°æ¶ˆæ¯" class="headerlink" title="æ§åˆ¶å°æŸ¥çœ‹æœ€æ–°æ¶ˆæ¯"></a>æ§åˆ¶å°æŸ¥çœ‹æœ€æ–°æ¶ˆæ¯</h3><h4 id="æŸ¥çœ‹ä¸€ä¸ª-topic-çš„æ¯ä¸ª-partition-çš„-offset"><a href="#æŸ¥çœ‹ä¸€ä¸ª-topic-çš„æ¯ä¸ª-partition-çš„-offset" class="headerlink" title="æŸ¥çœ‹ä¸€ä¸ª topic çš„æ¯ä¸ª partition çš„ offset"></a>æŸ¥çœ‹ä¸€ä¸ª topic çš„æ¯ä¸ª partition çš„ offset</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-run-class.sh kafka.tools.GetOffsetShell --broker-list alikafka-pre-cn-uax3b5ny1002-1-vpc.alikafka.aliyuncs.com:9092,alikafka-pre-cn-uax3b5ny1002-2-vpc.alikafka.aliyuncs.com:9092,alikafka-pre-cn-uax3b5ny1002-3-vpc.alikafka.aliyuncs.com:9092 --topic nova_event_topic --time -1</span><br></pre></td></tr></table></figure><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202312051049856.png" alt="image.png"></p><h4 id="æ ¹æ®æ¯ä¸ª-partition-çš„-offset-æ¥æ¶ˆè´¹æœ€æ–°æ¶ˆæ¯"><a href="#æ ¹æ®æ¯ä¸ª-partition-çš„-offset-æ¥æ¶ˆè´¹æœ€æ–°æ¶ˆæ¯" class="headerlink" title="æ ¹æ®æ¯ä¸ª partition çš„ offset æ¥æ¶ˆè´¹æœ€æ–°æ¶ˆæ¯"></a>æ ¹æ®æ¯ä¸ª partition çš„ offset æ¥æ¶ˆè´¹æœ€æ–°æ¶ˆæ¯</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-console-consumer.sh --bootstrap-server alikafka-pre-cn-uax3b5ny1002-1-vpc.alikafka.aliyuncs.com:9092,alikafka-pre-cn-uax3b5ny1002-2-vpc.alikafka.aliyuncs.com:9092,alikafka-pre-cn-uax3b5ny1002-3-vpc.alikafka.aliyuncs.com:9092 --topic nova_event_topic --partition 0 --offset 12080</span><br></pre></td></tr></table></figure><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202312051050803.png" alt="image.png"></p>]]></content>
      
      
      <categories>
          
          <category> æ—¥å¿— </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
            <tag> Kafka </tag>
            
            <tag> MQ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¼–è¯‘å®‰è£…Nginxè®°å½•</title>
      <link href="/posts/d90d2aa0/"/>
      <url>/posts/d90d2aa0/</url>
      
        <content type="html"><![CDATA[<p>é€šå¸¸æ¥è¯´ç¼–è¯‘ä¸é€šè¿‡éƒ½æ˜¯å› ä¸ºç³»ç»Ÿç¯å¢ƒä¸æ»¡è¶³æ¡ä»¶ï¼Œå¦‚ç¼ºå°‘åŒ…ç­‰ï¼Œæœ¬æ–‡ä»¥ CentOS 7 ç³»ç»Ÿä¸ºä¾‹ï¼Œå…¶ä¸­æœ‰äº›åŒ…å¦‚ xxx-devel åœ¨ ubuntu ä¸‹ä¸€èˆ¬éƒ½æ˜¯å«åš xxx-dev çš„ï¼Œå®åœ¨æ‰¾ä¸åˆ°å¯ä»¥ä½¿ç”¨ apt-file æŸ¥æ‰¾æ–‡ä»¶å±äºå“ªä¸ªåŒ…ã€‚</p><p>éœ€è¦å‡†å¤‡å¥½è¿™äº›åŒ…ï¼ˆä¸ç”¨ç›‘æ§å¯ä»¥ä¸ç”¨å‡†å¤‡ nginx-module-vtsï¼‰:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wget https://nginx.org/download/nginx-1.22.0.tar.gz</span><br><span class="line">wget https://github.com/vozlt/nginx-module-vts/archive/refs/tags/v0.2.2.tar.gz</span><br><span class="line">wget https://ftp.openssl.org/source/openssl-1.1.1p.tar.gz</span><br><span class="line">wget https://ftp.exim.org/pub/pcre/pcre-8.45.tar.gz</span><br></pre></td></tr></table></figure><p>å…¨éƒ¨è§£å‹ï¼Œç„¶åè¿›å…¥ <code>nginx-1.22.0</code> ç›®å½•æ“ä½œ</p><h2 id="é¦–å…ˆè¿è¡Œä¸€é-configure-å‘½ä»¤"><a href="#é¦–å…ˆè¿è¡Œä¸€é-configure-å‘½ä»¤" class="headerlink" title="é¦–å…ˆè¿è¡Œä¸€é configure å‘½ä»¤"></a>é¦–å…ˆè¿è¡Œä¸€é configure å‘½ä»¤</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">./configure --prefix=/usr/local/nginx \</span><br><span class="line">            --user=www --group=www \</span><br><span class="line">            --with-stream \</span><br><span class="line">            --with-http_stub_status_module \</span><br><span class="line">            --with-http_sub_module \</span><br><span class="line">            --with-http_v2_module \</span><br><span class="line">            --with-http_ssl_module \</span><br><span class="line">            --with-http_gzip_static_module \</span><br><span class="line">            --with-http_realip_module \</span><br><span class="line">            --with-http_flv_module \</span><br><span class="line">            --with-http_mp4_module \</span><br><span class="line">            --with-openssl=../openssl-1.1.1p \</span><br><span class="line">            --with-pcre=../pcre-8.45 \</span><br><span class="line">            --with-pcre-jit \</span><br><span class="line">            --with-ld-opt=-ljemalloc \</span><br><span class="line">            --add-module=../nginx-module-vts-0.1.18</span><br></pre></td></tr></table></figure><blockquote><p>nginx-module-vts æ˜¯ç›‘æ§æ¨¡å—ï¼Œå¦‚æœä¸ç”¨ç›‘æ§ï¼Œå¯ä»¥å°†è¿™ä¸€è¡Œåˆ é™¤<br>user group prefix è¿™äº›å‚æ•°åªæ˜¯ä¸ªé»˜è®¤å€¼ï¼Œæ˜¯å¯ä»¥è¢«é…ç½®æ–‡ä»¶çš„é…ç½®è¦†ç›–çš„</p></blockquote><h3 id="å¸¸è§æŠ¥é”™è§£å†³"><a href="#å¸¸è§æŠ¥é”™è§£å†³" class="headerlink" title="å¸¸è§æŠ¥é”™è§£å†³"></a>å¸¸è§æŠ¥é”™è§£å†³</h3><ul><li><p><code>./configure: error: C compiler cc is not found</code></p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y gcc-c++</span><br></pre></td></tr></table></figure></li><li><p><code>checking for --with-ld-opt=&quot;-ljemalloc&quot; ... not found</code></p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># centos</span></span><br><span class="line">yum install -y epel-release</span><br><span class="line">yum install -y jemalloc-devel</span><br><span class="line"></span><br><span class="line"><span class="comment"># ubuntu</span></span><br><span class="line">sudo apt install -y libjemalloc-dev</span><br></pre></td></tr></table></figure></li><li><p><code>checking for zlib library ... not found</code></p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install zlib-devel</span><br></pre></td></tr></table></figure></li><li><p><code>You need Perl 5.</code></p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install perl-devel</span><br></pre></td></tr></table></figure></li></ul><h2 id="å¼€å§‹ç¼–è¯‘"><a href="#å¼€å§‹ç¼–è¯‘" class="headerlink" title="å¼€å§‹ç¼–è¯‘"></a>å¼€å§‹ç¼–è¯‘</h2><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">å•æ ¸å¿ƒç¼–è¯‘</button><button type="button" class="tab">å¤šæ ¸å¿ƒç¼–è¯‘</button></div><div class="tab-contents"><div class="tab-item-content active"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make -j 4</span><br></pre></td></tr></table></figure><blockquote><p>4 è¡¨ç¤ºç”¨ 4 ä¸ªæ ¸å¿ƒæ¥ç¼–è¯‘</p></blockquote></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><h3 id="åˆ›å»ºç”¨æˆ·ç»„å’Œç”¨æˆ·"><a href="#åˆ›å»ºç”¨æˆ·ç»„å’Œç”¨æˆ·" class="headerlink" title="åˆ›å»ºç”¨æˆ·ç»„å’Œç”¨æˆ·"></a>åˆ›å»ºç”¨æˆ·ç»„å’Œç”¨æˆ·</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">groupadd www</span><br><span class="line">useradd -g www -M -s /sbin/nologin www</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…å¯æ‰§è¡Œæ–‡ä»¶"><a href="#å®‰è£…å¯æ‰§è¡Œæ–‡ä»¶" class="headerlink" title="å®‰è£…å¯æ‰§è¡Œæ–‡ä»¶"></a>å®‰è£…å¯æ‰§è¡Œæ–‡ä»¶</h3><p>å¯ä»¥ç”¨ <code>make install</code> æ¥å¿«é€Ÿå®‰è£…ï¼Œä¹Ÿå¯ä»¥è‡ªå·±è¿›å…¥ objs ç›®å½•æŠŠ nginx å¤åˆ¶åˆ°å…¶ä»–åœ°æ–¹ï¼Œé…ç½®æ–‡ä»¶æ”¾åœ¨&#x2F;usr&#x2F;loca&#x2F;nginx ä¸‹</p><h2 id="æ”¶å°¾å·¥ä½œ"><a href="#æ”¶å°¾å·¥ä½œ" class="headerlink" title="æ”¶å°¾å·¥ä½œ"></a>æ”¶å°¾å·¥ä½œ</h2><h3 id="ç”Ÿæˆ-systemd-æ–‡ä»¶"><a href="#ç”Ÿæˆ-systemd-æ–‡ä»¶" class="headerlink" title="ç”Ÿæˆ systemd æ–‡ä»¶"></a>ç”Ÿæˆ systemd æ–‡ä»¶</h3><p>vim &#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;nginx.service</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Unit]</span></span><br><span class="line"><span class="attr">Description</span>=nginx - high performance web server</span><br><span class="line"><span class="attr">Documentation</span>=http://nginx.org/en/docs/</span><br><span class="line"><span class="attr">After</span>=network.target</span><br><span class="line"></span><br><span class="line"><span class="section">[Service]</span></span><br><span class="line"><span class="attr">Type</span>=forking</span><br><span class="line"><span class="attr">PIDFile</span>=/usr/local/nginx/logs/nginx.pid</span><br><span class="line"><span class="attr">ExecStartPost</span>=/bin/sleep <span class="number">0.1</span></span><br><span class="line"><span class="attr">ExecStartPre</span>=/usr/local/nginx/sbin/nginx -t -c /usr/local/nginx/conf/nginx.conf</span><br><span class="line"><span class="attr">ExecStart</span>=/usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf</span><br><span class="line"><span class="attr">ExecReload</span>=/bin/kill -s HUP <span class="variable">$MAINPID</span></span><br><span class="line"><span class="attr">ExecStop</span>=/bin/kill -s QUIT <span class="variable">$MAINPID</span></span><br><span class="line"><span class="attr">TimeoutStartSec</span>=<span class="number">120</span></span><br><span class="line"><span class="attr">LimitNOFILE</span>=<span class="number">1000000</span></span><br><span class="line"><span class="attr">LimitNPROC</span>=<span class="number">1000000</span></span><br><span class="line"><span class="attr">LimitCORE</span>=<span class="number">1000000</span></span><br><span class="line"></span><br><span class="line"><span class="section">[Install]</span></span><br><span class="line"><span class="attr">WantedBy</span>=multi-user.target</span><br></pre></td></tr></table></figure><p>ç„¶åå°±å¯ä»¥æ„‰å¿«çš„ä½¿ç”¨ Nginx äº†ã€‚</p><h3 id="åˆ›å»ºè½¯é“¾æ¥"><a href="#åˆ›å»ºè½¯é“¾æ¥" class="headerlink" title="åˆ›å»ºè½¯é“¾æ¥"></a>åˆ›å»ºè½¯é“¾æ¥</h3><p>æ·»åŠ åå°±å¯ä»¥ç›´æ¥ä½¿ç”¨ nginx å‘½ä»¤äº†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">ln</span> -s /usr/local/nginx/sbin/nginx /usr/bin/nginx</span><br></pre></td></tr></table></figure><p>é…ç½®æ–‡ä»¶è½¯é“¾æ¥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">ln</span> -s /usr/local/nginx/conf/ /etc/nginx</span><br></pre></td></tr></table></figure><h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><h3 id="ç›‘æ§"><a href="#ç›‘æ§" class="headerlink" title="ç›‘æ§"></a>ç›‘æ§</h3><p>ç›‘æ§çš„ä½¿ç”¨æ–¹æ³•å¯ä»¥æŸ¥çœ‹ <a href="/posts/c6a32841">Nginxä½¿ç”¨module_vtsæ¨¡å—æ¥åšç›‘æ§</a></p><h3 id="æŸ¥çœ‹ç¼–è¯‘å‚æ•°"><a href="#æŸ¥çœ‹ç¼–è¯‘å‚æ•°" class="headerlink" title="æŸ¥çœ‹ç¼–è¯‘å‚æ•°"></a>æŸ¥çœ‹ç¼–è¯‘å‚æ•°</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx -V</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
            <tag> Nginx </tag>
            
            <tag> build </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Kubernetes ç»‘å®šHostsçš„æ­£ç¡®å§¿åŠ¿</title>
      <link href="/posts/23f11af0/"/>
      <url>/posts/23f11af0/</url>
      
        <content type="html"><![CDATA[<p>æœ‰çš„æ—¶å€™æˆ‘ä»¬éœ€è¦åœ¨å®¹å™¨é‡Œé¢ç»‘å®š hostsï¼Œæ¯”å¦‚æˆ‘ä»¬ç”¨ logstash éœ€è¦æ¶ˆè´¹ kafka æ¶ˆæ¯ï¼Œä½†æ˜¯ kafka ç›‘å¬çš„åœ°å€æ˜¯ hostnameï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦ç»‘å®š hostsï¼ˆè§„èŒƒä¸€ç‚¹æ˜¯åšè§£æï¼‰<br>åœ¨å®¹å™¨é‡Œé¢ç»‘å®š hosts å¸¸è§çš„æ–¹æ³•ä¸€ç§æ˜¯æŒ‚è½½ä¸»æœºçš„ hosts æ–‡ä»¶ï¼Œä¸€ç§æ˜¯ä¿®æ”¹å®¹å™¨çš„å¯åŠ¨ CMDï¼Œæ¯æ¬¡å¯åŠ¨ä¿®æ”¹ hostsï¼Œè¿™ä¸¤ç§æ–¹æ³•éƒ½æœ‰ä¸ªç¼ºç‚¹ï¼Œå°±æ˜¯ä¸å— kubelet ç®¡ç†äº†ï¼Œé»˜è®¤çš„ hosts å†…å®¹ä¹Ÿä¼šè¢«è¦†ç›–æ‰<br>åœ¨ k8s ç¯å¢ƒä¸‹æœ‰æ›´å¥½çš„è§£å†³æ–¹æ¡ˆï¼šé‚£å°±æ˜¯è®© k8s è‡ªå·±æ¥ç®¡ç†</p><h2 id="ä½¿ç”¨-hostAliases-æ¥ç»‘å®š-hosts"><a href="#ä½¿ç”¨-hostAliases-æ¥ç»‘å®š-hosts" class="headerlink" title="ä½¿ç”¨ hostAliases æ¥ç»‘å®š hosts"></a>ä½¿ç”¨ hostAliases æ¥ç»‘å®š hosts</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">logstash-k8s</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">ops</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">logstash-k8s</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">logstash-k8s</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">hostAliases:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">ip:</span> <span class="string">&quot;10.0.0.17&quot;</span></span><br><span class="line">        <span class="attr">hostnames:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&quot;elk1&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">ip:</span> <span class="string">&quot;10.0.0.18&quot;</span></span><br><span class="line">        <span class="attr">hostnames:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&quot;elk2&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">ip:</span> <span class="string">&quot;10.0.0.19&quot;</span></span><br><span class="line">        <span class="attr">hostnames:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&quot;elk3&quot;</span></span><br></pre></td></tr></table></figure><h2 id="è¿›å…¥å®¹å™¨æŸ¥çœ‹-hosts-æ–‡ä»¶"><a href="#è¿›å…¥å®¹å™¨æŸ¥çœ‹-hosts-æ–‡ä»¶" class="headerlink" title="è¿›å…¥å®¹å™¨æŸ¥çœ‹ hosts æ–‡ä»¶"></a>è¿›å…¥å®¹å™¨æŸ¥çœ‹ hosts æ–‡ä»¶</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl <span class="built_in">exec</span> -n ops logstash-k8s-68d6bf4dff-sxnst -- <span class="built_in">cat</span> /etc/hosts</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># Kubernetes-managed hosts file.</span><br><span class="line">127.0.0.1    localhost</span><br><span class="line">::1    localhost ip6-localhost ip6-loopback</span><br><span class="line">fe00::0    ip6-localnet</span><br><span class="line">fe00::0    ip6-mcastprefix</span><br><span class="line">fe00::1    ip6-allnodes</span><br><span class="line">fe00::2    ip6-allrouters</span><br><span class="line">172.20.16.108    logstash-k8s-68d6bf4dff-sxnst</span><br><span class="line"></span><br><span class="line"># Entries added by HostAliases.</span><br><span class="line">10.0.0.17    elk1</span><br><span class="line">10.0.0.18    elk2</span><br><span class="line">10.0.0.19    elk3</span><br></pre></td></tr></table></figure><p>è¿™ä¸ª hosts åŒ…æ‹¬ä¸¤ä¸ªéƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†æ˜¯å®¹å™¨è‡ªå¸¦çš„ hostsï¼Œå¦ä¸€éƒ¨åˆ†æ˜¯æˆ‘ä»¬è‡ªå·±æ·»åŠ çš„</p><h2 id="åœ¨-docker-ä¸‹ç»‘å®š-hosts"><a href="#åœ¨-docker-ä¸‹ç»‘å®š-hosts" class="headerlink" title="åœ¨ docker ä¸‹ç»‘å®š hosts"></a>åœ¨ docker ä¸‹ç»‘å®š hosts</h2><h3 id="è¿è¡Œæ—¶å€™ä¿®æ”¹"><a href="#è¿è¡Œæ—¶å€™ä¿®æ”¹" class="headerlink" title="è¿è¡Œæ—¶å€™ä¿®æ”¹"></a>è¿è¡Œæ—¶å€™ä¿®æ”¹</h3><p>docker å¯ä»¥é€šè¿‡ â€“add-host å‚æ•°æ¥æ·»åŠ  hosts ä¿¡æ¯åˆ°å®¹å™¨çš„&#x2F;etc&#x2F;hosts æ–‡ä»¶ä¸­</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --<span class="built_in">rm</span> --add-host=example.com:192.168.1.2 ubuntu <span class="built_in">cat</span> /etc/hosts</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1    localhost</span><br><span class="line">::1    localhost ip6-localhost ip6-loopback</span><br><span class="line">fe00::0    ip6-localnet</span><br><span class="line">ff00::0    ip6-mcastprefix</span><br><span class="line">ff02::1    ip6-allnodes</span><br><span class="line">ff02::2    ip6-allrouters</span><br><span class="line">192.168.1.2    example.com</span><br><span class="line">172.17.0.2    eece89ee8fc7</span><br></pre></td></tr></table></figure><h3 id="æ„å»ºæ—¶ä¿®æ”¹"><a href="#æ„å»ºæ—¶ä¿®æ”¹" class="headerlink" title="æ„å»ºæ—¶ä¿®æ”¹"></a>æ„å»ºæ—¶ä¿®æ”¹</h3><p>Dockerfile ä¸­ï¼Œå¯ä»¥åœ¨ CMD å‘½ä»¤ä¸‹è¿›è¡Œä¿®æ”¹ï¼Œåœ¨ RUN é‡Œé¢ä¿®æ”¹ä¼šæç¤ºæ–‡ä»¶åªè¯»æ— æ³•ä¿®æ”¹ã€‚</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> centos:<span class="number">7</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> <span class="built_in">echo</span> <span class="string">&quot;111&quot;</span> &gt;&gt; /etc/hosts &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    <span class="built_in">echo</span> <span class="string">&quot;Hosts: &quot;</span> &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    <span class="built_in">cat</span> /etc/hosts</span></span><br></pre></td></tr></table></figure><h2 id="åœ¨-docker-compose-ç¯å¢ƒä¸‹ç»‘å®š-hosts"><a href="#åœ¨-docker-compose-ç¯å¢ƒä¸‹ç»‘å®š-hosts" class="headerlink" title="åœ¨ docker-compose ç¯å¢ƒä¸‹ç»‘å®š hosts"></a>åœ¨ docker-compose ç¯å¢ƒä¸‹ç»‘å®š hosts</h2><p>åœ¨ yml æ–‡ä»¶é‡Œ</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">extra_hosts:</span></span><br><span class="line"> <span class="bullet">-</span> <span class="string">&quot;test.com:192.168.1.1&quot;</span></span><br><span class="line"> <span class="bullet">-</span> <span class="string">&quot;example.com:192.168.1.2&quot;</span></span><br></pre></td></tr></table></figure><p>æ˜¾ç¤ºå‡ºæ¥çš„æ•ˆæœ&#x2F;etc&#x2F;hosts</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">192.168.1.1  test.com</span><br><span class="line">192.168.1.2  example.com</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å®¹å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
            <tag> Container </tag>
            
            <tag> k8s </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nginx Ingress å®šä¹‰å¤šç§æ—¥å¿—æ ¼å¼</title>
      <link href="/posts/dcab3f5f/"/>
      <url>/posts/dcab3f5f/</url>
      
        <content type="html"><![CDATA[<p>ç”Ÿäº§ç¯å¢ƒæœ‰ä¸ªé¡¹ç›®éœ€è¦æ‰“å¼€ nginx æ—¥å¿—çš„ request_body æ—¥å¿—è®°å½•ï¼Œä½†æ˜¯å¦‚æœæŠŠé»˜è®¤çš„æ—¥å¿—æ ¼å¼æ”¹æ‰çš„è¯ï¼Œæ—¥å¿—é‡å°±å¤ªå¤§äº†ï¼Œæ‰€ä»¥æŸ¥äº†ä¸€ä¸‹é’ˆå¯¹æŸä¸ªåŸŸåè¿›è¡Œæœé›†ä¸åŒçš„æ—¥å¿—ã€‚</p><p>k8s çš„ ingress å…¶å®å°±æ˜¯ nginx å°è£…äº†ä¸€å±‚ï¼Œæ‰€ä»¥ nginx å¯ä»¥åšçš„ï¼Œingress ä¹Ÿéƒ½å¯ä»¥åšï¼Œnginx æˆ‘ä»¬çŸ¥é“å¯ä»¥å®šä¹‰ä¸åŒçš„æ—¥å¿—æ ¼å¼ï¼Œç„¶åä¸åŒçš„è™šæ‹Ÿä¸»æœºæ¥å¼•ç”¨å°±å¥½äº†ã€‚å…ˆæŸ¥çœ‹æ–‡æ¡£ï¼Œå‘ç°äº† nginx-ingress æœ‰ä¸€ä¸ªå« http-snippet çš„å‚æ•°ï¼Œæ„æ€å°±æ˜¯åœ¨ http å—ä¸‹é¢å¢åŠ ä¸€æ®µåŸç”Ÿçš„ Nginx é…ç½®</p><h2 id="åœ¨-configmap-é‡Œé¢å¢åŠ ä¸€ä¸ªæ–°çš„æ—¥å¿—æ ¼å¼é…ç½®"><a href="#åœ¨-configmap-é‡Œé¢å¢åŠ ä¸€ä¸ªæ–°çš„æ—¥å¿—æ ¼å¼é…ç½®" class="headerlink" title="åœ¨ configmap é‡Œé¢å¢åŠ ä¸€ä¸ªæ–°çš„æ—¥å¿—æ ¼å¼é…ç½®"></a>åœ¨ configmap é‡Œé¢å¢åŠ ä¸€ä¸ªæ–°çš„æ—¥å¿—æ ¼å¼é…ç½®</h2><p>æˆ‘ä»¬å¯ä»¥åœ¨ ingress-nginx çš„ configmap é‡Œé¢æ·»åŠ ä¸€ä¸ªæ–°çš„æ—¥å¿—æ ¼å¼ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ingress-nginx-controller</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">ingress-nginx</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/name:</span> <span class="string">ingress-nginx</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/part-of:</span> <span class="string">ingress-nginx</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">enable-underscores-in-headers:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line">  <span class="attr">allow-snippet-annotations:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line">  <span class="attr">use-gzip:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line">  <span class="attr">gzip-level:</span> <span class="string">&quot;2&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">proxy-body-size:</span> <span class="string">100M</span> <span class="comment"># å¯¹åº”nginx client_max_body_size</span></span><br><span class="line">  <span class="attr">client-body-buffer-size:</span> <span class="string">&quot;8M&quot;</span></span><br><span class="line">  <span class="attr">client-header-buffer-size:</span> <span class="string">&quot;2M&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">proxy-connect-timeout:</span> <span class="string">&quot;300&quot;</span></span><br><span class="line">  <span class="attr">proxy-read-timeout:</span> <span class="string">&quot;300&quot;</span></span><br><span class="line">  <span class="attr">proxy-send-timeout:</span> <span class="string">&quot;300&quot;</span></span><br><span class="line">  <span class="attr">proxy-buffer-size:</span> <span class="string">&quot;32k&quot;</span></span><br><span class="line">  <span class="attr">connection-proxy-header:</span> <span class="string">&quot;keep-alive&quot;</span></span><br><span class="line">  <span class="comment"># é»˜è®¤çš„æ—¥å¿—æ ¼å¼</span></span><br><span class="line">  <span class="attr">log-format-upstream:</span> <span class="string">&#x27;&#123;&quot;@timestamp&quot;: &quot;$time_iso8601&quot;,&quot;server_addr&quot;:&quot;$server_addr&quot;,&quot;remote_addr&quot;:&quot;$remote_addr&quot;,&quot;scheme&quot;:&quot;$scheme&quot;,&quot;request_method&quot;:&quot;$request_method&quot;,&quot;request_uri&quot;: &quot;$request_uri&quot;,&quot;request_length&quot;: &quot;$request_length&quot;,&quot;uri&quot;: &quot;$uri&quot;,&quot;request_time&quot;:$request_time,&quot;body_bytes_sent&quot;:$body_bytes_sent,&quot;bytes_sent&quot;:$bytes_sent,&quot;status&quot;:&quot;$status&quot;,&quot;upstream_host&quot;:&quot;$upstream_addr&quot;,&quot;domain&quot;:&quot;$host&quot;,&quot;http_referer&quot;:&quot;$http_referer&quot;,&quot;http_user_agent&quot;:&quot;$http_user_agent&quot;,&quot;http_app_id&quot;:&quot;$http_app_id&quot;,&quot;x_forwarded&quot;:&quot;$http_x_forwarded_for&quot;,&quot;up_r_time&quot;:&quot;$upstream_response_time&quot;,&quot;up_status&quot;:&quot;$upstream_status&quot;,&quot;os_plant&quot;:&quot;$http_os_plant&quot;,&quot;os_version&quot;:&quot;$http_os_version&quot;,&quot;app_version&quot;:&quot;$http_app_version&quot;,&quot;app_build&quot;:&quot;$http_app_build&quot;,&quot;guid&quot;:&quot;$http_guid&quot;,&quot;resolution_ratio&quot;:&quot;$http_resolution_ratio&quot;,&quot;ip&quot;:&quot;$http_ip&quot;,&quot;imsi&quot;:&quot;$http_imsi&quot;,&quot;listen_port&quot;:&quot;$server_port&quot;&#125;&#x27;</span></span><br><span class="line">  <span class="comment"># å®šä¹‰äº†ä¸€ä¸ªæ–°çš„æ—¥å¿—æ ¼å¼</span></span><br><span class="line">  <span class="attr">http-snippet:</span> <span class="string">|</span></span><br><span class="line"><span class="string">    log_format  with_body escape=json  &#x27;&#123;&quot;@timestamp&quot;: &quot;$time_iso8601&quot;,&#x27;</span></span><br><span class="line"><span class="string">      &#x27;&quot;server_addr&quot;:&quot;$server_addr&quot;,&#x27;</span></span><br><span class="line"><span class="string">      &#x27;&quot;remote_addr&quot;:&quot;$remote_addr&quot;,&#x27;</span></span><br><span class="line"><span class="string">      &#x27;&quot;scheme&quot;:&quot;$scheme&quot;,&#x27;</span></span><br><span class="line"><span class="string">      &#x27;&quot;request_method&quot;:&quot;$request_method&quot;,&#x27;</span></span><br><span class="line"><span class="string">      &#x27;&quot;request_uri&quot;: &quot;$request_uri&quot;,&#x27;</span></span><br><span class="line"><span class="string">      &#x27;&quot;request_length&quot;: &quot;$request_length&quot;,&#x27;</span></span><br><span class="line"><span class="string">      &#x27;&quot;uri&quot;: &quot;$uri&quot;, &#x27;</span></span><br><span class="line"><span class="string">      &#x27;&quot;request_time&quot;:$request_time,&#x27;</span></span><br><span class="line"><span class="string">      &#x27;&quot;body_bytes_sent&quot;:$body_bytes_sent,&#x27;</span></span><br><span class="line"><span class="string">      &#x27;&quot;bytes_sent&quot;:$bytes_sent,&#x27;</span></span><br><span class="line"><span class="string">      &#x27;&quot;dm&quot;:&quot;$request_body&quot;,&#x27;</span></span><br><span class="line"><span class="string">      &#x27;&quot;status&quot;:&quot;$status&quot;,&#x27;</span></span><br><span class="line"><span class="string">      &#x27;&quot;upstream_host&quot;:&quot;$upstream_addr&quot;,&#x27;</span></span><br><span class="line"><span class="string">      &#x27;&quot;domain&quot;:&quot;$host&quot;,&#x27;</span></span><br><span class="line"><span class="string">      &#x27;&quot;http_referer&quot;:&quot;$http_referer&quot;,&#x27;</span></span><br><span class="line"><span class="string">      &#x27;&quot;http_user_agent&quot;:&quot;$http_user_agent&quot;,&#x27;</span></span><br><span class="line"><span class="string">      &#x27;&quot;http_host&quot;:&quot;$http_host&quot;,&#x27;</span></span><br><span class="line"><span class="string">      &#x27;&quot;http_app_id&quot;:&quot;$http_app_id&quot;&#x27;</span></span><br><span class="line"><span class="string">      &#x27;&#125;&#x27;;</span></span><br></pre></td></tr></table></figure><h2 id="ç„¶åä¿®æ”¹å¯¹åº”çš„-ingress-èµ„æº"><a href="#ç„¶åä¿®æ”¹å¯¹åº”çš„-ingress-èµ„æº" class="headerlink" title="ç„¶åä¿®æ”¹å¯¹åº”çš„ ingress èµ„æº"></a>ç„¶åä¿®æ”¹å¯¹åº”çš„ ingress èµ„æº</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">test</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">test</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">kubernetes.io/ingress.class:</span> <span class="string">&quot;nginx&quot;</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/ssl-redirect:</span> <span class="string">&quot;false&quot;</span></span><br><span class="line">    <span class="comment"># æŒ‡å®šæ—¥å¿—æ ¼å¼ä¸ºwith_body</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/configuration-snippet:</span> <span class="string">|</span></span><br><span class="line"><span class="string">            access_log /dev/stdout with_body;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">tls:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">hosts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">test.i.com</span></span><br><span class="line">    <span class="attr">secretName:</span> <span class="string">i-com</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">test.i.com</span></span><br><span class="line">    <span class="attr">http:</span></span><br><span class="line">      <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">serviceName:</span> <span class="string">test</span></span><br><span class="line">          <span class="attr">servicePort:</span> <span class="number">80</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">/</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">serviceName:</span> <span class="string">test</span></span><br><span class="line">          <span class="attr">servicePort:</span> <span class="number">8080</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">/sys</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å®¹å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nginx </tag>
            
            <tag> ingress </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨Systemd TimesyncdæœåŠ¡æ¥åŒæ­¥Linuxæ—¶é—´</title>
      <link href="/posts/c4366641/"/>
      <url>/posts/c4366641/</url>
      
        <content type="html"><![CDATA[<p>ç°ä»£ Linux å‘è¡Œç‰ˆéƒ½é‡‡ç”¨ systemd ç®¡ç†ç³»ç»Ÿï¼Œsystemd ä½“ç³»ä¹Ÿæä¾›äº†åŸºç¡€çš„ <code>timesyncd</code> æœåŠ¡æ¥å®ç° SNTP å®¢æˆ·ç«¯ï¼Œå¯ä»¥æ›¿ä»£ä¼ ç»Ÿçš„ <code>ntpd</code> æ¥å®ç°ä¸»æœº NTP åŒæ­¥ (å®¢æˆ·ç«¯)ã€‚è™½ç„¶ä¸èƒ½ä½œä¸º NTP æœåŠ¡å™¨ï¼Œä½†æ˜¯ç²¾ç®€çš„ <code>systemd-timesyncd</code> å¯ä»¥å®ç°éå¸¸è½»é‡çº§çš„æ—¶é’ŸåŒæ­¥åŠŸèƒ½ã€‚</p><p><code>systemd-timesyncd</code> æ˜¯é€šè¿‡ç½‘ç»œæä¾›ç³»ç»Ÿæ—¶é’ŸåŒæ­¥çš„æœåŠ¡ï¼Œå®ç°äº† SNTP clientã€‚å’Œ NTP å®ç° chrony ntp æœåŠ¡ä¸åŒï¼Œ <code>systemd-timesyncd</code> åªå®ç°å®¢æˆ·ç«¯åŠŸèƒ½ï¼Œè€Œä¸æ˜¯å®ç°å®Œæ•´çš„ NTPï¼Œèšç„¦äºä»è¿œç¨‹æœåŠ¡å™¨æŸ¥è¯¢æ—¶é—´å¹¶åŒæ­¥åˆ°æœ¬åœ°æ—¶é’Ÿã€‚é™¤éä½ éœ€è¦éœ€è¦ä¸ºç½‘ç»œä¸­å…¶ä»– NTP å®¢æˆ·ç«¯æä¾›æœåŠ¡æˆ–è€…éœ€è¦è¿æ¥æœ¬åœ°ç¡¬ä»¶æ—¶é’Ÿï¼Œå¦åˆ™ä¸€ä¸ªç®€å•çš„ NTP å®¢æˆ·ç«¯ï¼Œä¾‹å¦‚ <code>systemd-timesyncd</code> ï¼Œå¾€å¾€æ˜¯æœ€å¥½çš„è§£å†³æ–¹æ¡ˆã€‚è¿™ä¸ªæ—¶é’ŸåŒæ­¥å®¢æˆ·ç«¯è¿è¡Œåªéœ€è¦æœ€å°çš„æƒé™ã€‚æ¯æ¬¡æ–°çš„ NTP åŒæ­¥è¯·æ±‚å‘èµ·ï¼Œ<code>timesyncd</code> æœåŠ¡å°±æŠŠå½“å‰æ—¶é’Ÿä¿å­˜åˆ°ç£ç›˜ï¼Œå¹¶ä½¿ç”¨å®ƒæ¥çŸ«æ­£å¯åŠ¨æ—¶çš„ç³»ç»Ÿæ—¶é’Ÿï¼Œè¿™æ ·å°±é€‚åˆç”¨äºç¼ºå°‘ RTC çš„è®¾å¤‡ï¼Œä¾‹å¦‚ <code>Raspberry Pi</code> æˆ–è€…åµŒå…¥è®¾å¤‡ï¼Œå¯ä»¥ç¡®ä¿è¿™äº›ç³»ç»Ÿæ—¶é’Ÿæ­£ç¡®ã€‚éœ€è¦æ³¨æ„ï¼Œåœ¨å®‰è£… <code>Systemdè¿›ç¨‹ç®¡ç†å™¨</code> æ—¶å€™éœ€è¦ç¡®ä¿åˆ›å»ºä¸€ä¸ªåä¸º <code>systemd-timesync</code> çš„ç”¨æˆ·å’Œç»„ã€‚</p><h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h2><ul><li><p>å®‰è£…:</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install systemd-timesyncd</span><br></pre></td></tr></table></figure></li><li><p>æ¿€æ´»:</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> systemd-timesyncd.service</span><br><span class="line">systemctl start systemd-timesyncd.service</span><br></pre></td></tr></table></figure></li></ul><p>å½“ <code>systemd-timesyncd</code> å¯åŠ¨æ—¶ä¼šè¯»å– <code>/etc/systemd/timesyncd.conf</code> é…ç½®ï¼Œæ‰€ä»¥å¦‚æœè¦ä¿®è®¢é…ç½®ï¼Œä¾‹å¦‚æ›´æ”¹æ—¶é’ŸæœåŠ¡å™¨ï¼Œåˆ™ç±»ä¼¼:</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[Time]</span><br><span class="line">NTP=0.arch.pool.ntp.org 1.arch.pool.ntp.org 2.arch.pool.ntp.org 3.arch.pool.ntp.org</span><br><span class="line">FallbackNTP=0.pool.ntp.org 1.pool.ntp.org 0.fr.pool.ntp.org</span><br></pre></td></tr></table></figure><ul><li><p>è¦éªŒè¯é…ç½®ï¼Œæ‰§è¡Œ:</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">timedatectl show-timesync --all</span><br></pre></td></tr></table></figure></li></ul><p>æ˜¾ç¤ºç±»ä¼¼:</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">LinkNTPServers=</span><br><span class="line">SystemNTPServers=</span><br><span class="line">FallbackNTPServers=0.rhel.pool.ntp.org 1.rhel.pool.ntp.org 2.rhel.pool.ntp.org 3.rhel.pool.ntp.org</span><br><span class="line">ServerName=0.rhel.pool.ntp.org</span><br><span class="line">ServerAddress=124.108.20.1</span><br><span class="line">RootDistanceMaxUSec=5s</span><br><span class="line">PollIntervalMinUSec=32s</span><br><span class="line">PollIntervalMaxUSec=34min 8s</span><br><span class="line">PollIntervalUSec=32s</span><br><span class="line">NTPMessage=&#123; Leap=0, Version=4, Mode=4, Stratum=2, Precision=-25, RootDelay=19.866ms, RootDispersion=1.800ms, Reference=D8DAC0CA, OriginateTimestamp=Fri 2021-05-28 16:23:26 CST, ReceiveTimestamp=Fri 2021-05-28 16:23:34 CST, TransmitTimestamp=Fri 2021-05-28 16:23:34 CST, DestinationTimestamp=Fri 2021-05-28 16:23:26 CST, Ignored=no PacketCount=1, Jitter=0  &#125;</span><br><span class="line">Frequency=0</span><br></pre></td></tr></table></figure><h2 id="timedatectl-å’Œ-timesyncd"><a href="#timedatectl-å’Œ-timesyncd" class="headerlink" title="timedatectl å’Œ timesyncd"></a>timedatectl å’Œ timesyncd</h2><ul><li><p>ä½¿ç”¨ <code>timedatectl status</code> å¯ä»¥æ£€æŸ¥æ—¶é’ŸçŠ¶å†µ:</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">timedatectl status</span><br></pre></td></tr></table></figure></li></ul><p>è¾“å‡ºæ˜¾ç¤º:</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">    Local time: Tue 2018-05-01 21:54:24 CST</span><br><span class="line">Universal time: Tue 2018-05-01 13:54:24 UTC</span><br><span class="line">      RTC time: Tue 2018-05-01 13:54:24</span><br><span class="line">     Time zone: Asia/Shanghai (CST, +0800)</span><br><span class="line">Network time on: yes</span><br><span class="line">NTP synchronized: yes</span><br><span class="line">RTC in local TZ: no</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸Šè¿°æ˜¾ç¤ºè¾“å‡ºä¸­:</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">               Local time: Fri 2021-05-28 16:24:59 CST</span><br><span class="line">           Universal time: Fri 2021-05-28 08:24:59 UTC</span><br><span class="line">                 RTC time: Fri 2021-05-28 16:24:57</span><br><span class="line">                Time zone: Asia/Shanghai (CST, +0800)</span><br><span class="line">System clock synchronized: yes</span><br><span class="line">              NTP service: inactive</span><br><span class="line">          RTC in local TZ: yes</span><br><span class="line"></span><br><span class="line">Warning: The system is configured to read the RTC time in the local time zone.</span><br><span class="line">         This mode cannot be fully supported. It will create various problems</span><br><span class="line">         with time zone changes and daylight saving time adjustments. The RTC</span><br><span class="line">         time is never updated, it relies on external facilities to maintain it.</span><br><span class="line">         If at all possible, use RTC in UTC by calling</span><br><span class="line">         &#x27;timedatectl set-local-rtc 0&#x27;.</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NTP service: inactive</span><br></pre></td></tr></table></figure><p>å®é™…ä¸Šæ²¡æœ‰æ¿€æ´»ï¼Œæ‰€ä»¥æˆ‘ä»¬é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ¿€æ´»:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">timedatectl set-ntp <span class="literal">true</span></span><br></pre></td></tr></table></figure><p>ç„¶åå†æ¬¡æ£€æŸ¥ <code>timedatectl status</code> å¯ä»¥çœ‹åˆ°:</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">              NTP service: active</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>æ­¤å¤–ï¼ŒæŒ‰ç…§æç¤ºï¼Œå…³é—­ä»æœ¬åœ°æ—¶åŒºè¯»å– RTC æ—¶é—´:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">timedatectl set-local-rtc 0</span><br></pre></td></tr></table></figure><p>å®Œæˆåå†æ¬¡æ£€æŸ¥ <code>timedatectl status</code> å¯ä»¥çœ‹åˆ°:</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">               Local time: Fri 2021-05-28 16:29:18 CST</span><br><span class="line">           Universal time: Fri 2021-05-28 08:29:18 UTC</span><br><span class="line">                 RTC time: Fri 2021-05-28 08:29:18</span><br><span class="line">                Time zone: Asia/Shanghai (CST, +0800)</span><br><span class="line">System clock synchronized: yes</span><br><span class="line">              NTP service: active</span><br><span class="line">          RTC in local TZ: no</span><br></pre></td></tr></table></figure><ul><li><p>æ£€æŸ¥æœåŠ¡è¯¦ç»†ä¿¡æ¯:</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">timedatectl timesync-status</span><br></pre></td></tr></table></figure></li></ul><p>å¯ä»¥çœ‹åˆ°ç±»ä¼¼è¾“å‡º:</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">       Server: 124.108.20.1 (0.rhel.pool.ntp.org)</span><br><span class="line">Poll interval: 1min 4s (min: 32s; max 34min 8s)</span><br><span class="line">         Leap: normal</span><br><span class="line">      Version: 4</span><br><span class="line">      Stratum: 2</span><br><span class="line">    Reference: D8DAC0CA</span><br><span class="line">    Precision: 1us (-25)</span><br><span class="line">Root distance: 11.275ms (max: 5s)</span><br><span class="line">       Offset: -14.956ms</span><br><span class="line">        Delay: 186.719ms</span><br><span class="line">       Jitter: 0</span><br><span class="line"> Packet count: 1</span><br><span class="line">    Frequency: +28.703ppm</span><br></pre></td></tr></table></figure><ul><li><p>æ£€æŸ¥æ—¶é’ŸåŒæ­¥æƒ…å†µ:</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl status systemd-timesyncd</span><br></pre></td></tr></table></figure></li></ul><p>æ˜¾ç¤ºè¾“å‡º:</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">â— systemd-timesyncd.service - Network Time Synchronization</span><br><span class="line">   Loaded: loaded (/lib/systemd/system/systemd-timesyncd.service; enabled; vendor preset: enabled)</span><br><span class="line">  Drop-In: /lib/systemd/system/systemd-timesyncd.service.d</span><br><span class="line">           â””â”€disable-with-time-daemon.conf</span><br><span class="line">   Active: active (running) since Mon 2018-04-16 10:33:42 CST; 2 weeks 1 days ago</span><br><span class="line">     Docs: man:systemd-timesyncd.service(8)</span><br><span class="line"> Main PID: 910 (systemd-timesyn)</span><br><span class="line">   Status: &quot;Synchronized to time server 91.189.91.157:123 (ntp.ubuntu.com).&quot;</span><br><span class="line">    Tasks: 2</span><br><span class="line">   Memory: 2.2M</span><br><span class="line">      CPU: 2.710s</span><br><span class="line">   CGroup: /system.slice/systemd-timesyncd.service</span><br><span class="line">           â””â”€910 /lib/systemd/systemd-timesyncd</span><br><span class="line"></span><br><span class="line">Apr 29 07:30:24 devstack systemd-timesyncd[910]: Timed out waiting for reply from 91.189.91.157:123 (ntp.ubuntu.com).</span><br><span class="line">Apr 29 07:30:24 devstack systemd-timesyncd[910]: Synchronized to time server 91.189.94.4:123 (ntp.ubuntu.com).</span><br><span class="line">Apr 29 09:14:36 devstack systemd-timesyncd[910]: Timed out waiting for reply from 91.189.94.4:123 (ntp.ubuntu.com).</span><br><span class="line">Apr 29 09:14:46 devstack systemd-timesyncd[910]: Timed out waiting for reply from 91.189.89.198:123 (ntp.ubuntu.com).</span><br><span class="line">Apr 29 09:14:56 devstack systemd-timesyncd[910]: Timed out waiting for reply from 91.189.89.199:123 (ntp.ubuntu.com).</span><br><span class="line">Apr 29 09:49:06 devstack systemd-timesyncd[910]: Synchronized to time server 91.189.89.199:123 (ntp.ubuntu.com).</span><br><span class="line">Apr 29 13:52:01 devstack systemd-timesyncd[910]: Timed out waiting for reply from 91.189.89.199:123 (ntp.ubuntu.com).</span><br><span class="line">Apr 29 13:52:11 devstack systemd-timesyncd[910]: Timed out waiting for reply from 91.189.89.198:123 (ntp.ubuntu.com).</span><br><span class="line">Apr 29 13:52:21 devstack systemd-timesyncd[910]: Timed out waiting for reply from 91.189.94.4:123 (ntp.ubuntu.com).</span><br><span class="line">Apr 29 13:52:22 devstack systemd-timesyncd[910]: Synchronized to time server 91.189.91.157:123 (ntp.ubuntu.com).</span><br></pre></td></tr></table></figure><ul><li><p>åœ¨ <code>/etc/systemd/timesyncd.conf</code> è®¾ç½® <code>timedatectl</code> å’Œ <code>timesyncd</code> è·å–æ—¶é’Ÿå€¼çš„æœåŠ¡å™¨ï¼Œå¹¶ä¸”è¯¦ç»†é…ç½®å¯ä»¥åœ¨ <code>/etc/systemd/timesyncd.conf.d/</code> ç›®å½•ä¸‹æ‰¾åˆ°</p></li><li><p>åœ¨ <code>/etc/systemd/timesyncd.conf</code> ä¸­é…ç½®äº† <code>timedatectl</code> è®¿é—®çš„æœåŠ¡å™¨ï¼Œè¿™é‡Œé…ç½®å±€åŸŸç½‘ä¸­è‡ªå»ºçš„ <a href="https://cloud-atlas.readthedocs.io/zh_CN/latest/infra_service/ntp/deploy_ntp.html#deploy-ntp">éƒ¨ç½²NTPæœåŠ¡(é›†ç¾¤)</a></p>  <figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Time]</span></span><br><span class="line"><span class="attr">NTP</span>=<span class="number">192.168</span>.<span class="number">6.11</span></span><br></pre></td></tr></table></figure></li><li><p>é‡å¯ <code>systemd-timesyncd</code> æœåŠ¡:</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart systemd-timesyncd</span><br></pre></td></tr></table></figure></li><li><p>æ£€æŸ¥å’ŒæŒ‡å®š NTP æœåŠ¡å™¨åŒæ­¥æ—¶é—´:</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl status systemd-timesyncd</span><br></pre></td></tr></table></figure></li></ul><p>å¯ä»¥çœ‹åˆ°åŒæ­¥è¿‡ç¨‹:</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">May 01 22:38:36 pi1 systemd[1]: Starting Network Time Synchronization...</span><br><span class="line">May 01 22:38:37 pi1 systemd[1]: Started Network Time Synchronization.</span><br><span class="line">May 01 22:38:37 pi1 systemd-timesyncd[23922]: Synchronized to time server 192.168.6.11:123 (192.168.6.11).</span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="https://wiki.archlinux.org/title/systemd-timesyncd">systemd-timesyncd</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> time </tag>
            
            <tag> Systemd </tag>
            
            <tag> NTP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¼–å†™å®‰å…¨å¥å£®çš„shellè„šæœ¬</title>
      <link href="/posts/b82d63c2/"/>
      <url>/posts/b82d63c2/</url>
      
        <content type="html"><![CDATA[<p>ç¼–å†™ shell è„šæœ¬å®¹æ˜“å‡ºç°çš„é—®é¢˜ï¼šæ¯”å¦‚å˜é‡ä¸ºç©ºçš„æ—¶å€™ï¼Œç®¡é“æŠ¥é”™ç­‰ï¼Œå®¹æ˜“å¼•èµ·ä¸€ç³»åˆ—é—®é¢˜ç”šè‡³ç¾éš¾æ€§çš„ç»“æœã€‚<br>å¯ä»¥å€ŸåŠ©å·¥å…·<a href="https://www.shellcheck.net/">https://www.shellcheck.net/</a>æ¥æ£€æŸ¥è„šæœ¬é‡Œé¢å¯ä»¥æ”¹è¿›çš„åœ°æ–¹ã€‚</p><h2 id="è„šæœ¬é‡Œä½¿ç”¨-set"><a href="#è„šæœ¬é‡Œä½¿ç”¨-set" class="headerlink" title="è„šæœ¬é‡Œä½¿ç”¨ set"></a>è„šæœ¬é‡Œä½¿ç”¨ set</h2><p>å»ºè®®ä½¿ç”¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> -euo pipefail</span><br></pre></td></tr></table></figure><h3 id="set-o"><a href="#set-o" class="headerlink" title="set -o"></a>set -o</h3><p><code>set -o</code> å¯ä»¥æŸ¥çœ‹ shell çš„é€‰é¡¹å¼€å…³ï¼Œæ¯”å¦‚å¸¸ç”¨çš„ <code>pipefail</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> -o | pipefail</span><br></pre></td></tr></table></figure><p>pipefail æ˜¯æŒ‡åœ¨ä¸€ä¸ªç®¡é“å‘½ä»¤ä¸­ï¼Œä»»æ„ä¸€ä¸ªå‘½ä»¤æ‰§è¡Œå¤±è´¥å°±è®¤ä¸ºå‘½ä»¤æŠ¥é”™ï¼ˆä½†æ˜¯å¯ä»¥ç»§ç»­æ‰§è¡Œï¼Œæƒ³è®©å®ƒæŠ¥é”™é€€å‡ºéœ€è¦å†åŠ ä¸Š set -eï¼‰</p><p>å¯ä»¥åœ¨ shell è„šæœ¬å¼€å¤´åŠ ä¸Š <code>set -o pipefail</code>ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">set</span> -o pipefail</span><br><span class="line"><span class="built_in">cat</span> test.txt | <span class="built_in">tee</span> test2.txt</span><br><span class="line"><span class="built_in">echo</span> $?</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‡è®¾test.txtä¸å­˜åœ¨ï¼Œè¿™ä¸ªæ—¶å€™è¾“å‡ºçš„æ˜¯1</span></span><br><span class="line"><span class="comment"># å¦‚æœå»æ‰ set -o pipefailï¼Œè¿™ä¸ªæ—¶å€™è¾“å‡ºçš„æ˜¯0</span></span><br></pre></td></tr></table></figure><h3 id="set-e"><a href="#set-e" class="headerlink" title="set -e"></a>set -e</h3><p>set -e æ˜¯æŒ‡ä»»æ„ä¸€æ¡å‘½ä»¤è¿”å›å€¼ä¸æ˜¯ 0ï¼Œè„šæœ¬å°±é€€å‡ºä¸ç»§ç»­æ‰§è¡Œäº†ã€‚</p><p>å¦‚æœæœ‰äº›ç¨‹åºæƒ³è¦äººä¸ºçš„å¿½ç•¥æŠ¥é”™ï¼Œå¯ä»¥åœ¨å‘½ä»¤å¼€å§‹å‰åŠ ä¸Š set +eï¼Œå‘½ä»¤ç»“æŸçš„æ—¶å€™å† set -eï¼Œå¦‚ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">set</span> -e</span><br><span class="line">...</span><br><span class="line"><span class="built_in">set</span> +e</span><br><span class="line">cmd</span><br><span class="line"><span class="built_in">set</span> -e</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h3 id="set-u"><a href="#set-u" class="headerlink" title="set -u"></a>set -u</h3><p>å°†æœªè®¾ç½®çš„å‚æ•°æˆ–è€…å˜é‡è§†ä¸ºé”™è¯¯å¹¶é€€å‡ºè„šæœ¬ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">set</span> -u</span><br><span class="line"><span class="built_in">echo</span> 111</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;123&#125;</span></span><br><span class="line"><span class="built_in">echo</span> 222</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ—¶å€™åªä¼šæ‰§è¡Œ echo 111ï¼Œå› ä¸º ${123}ä¸å­˜åœ¨ï¼Œè„šæœ¬å°±æŠ¥é”™é€€å‡ºäº†ã€‚</p><h3 id="set-x"><a href="#set-x" class="headerlink" title="set -x"></a>set -x</h3><p>è°ƒè¯•æ¨¡å¼ï¼Œä¼šæŠŠæ¯ä¸€ä¸ª shell å‘½ä»¤æ‰§è¡Œçš„ç»“æœéƒ½æ‰“å°å‡ºæ¥ï¼Œæ•ˆæœç­‰åŒäº <code>bash -x test.sh</code></p><h3 id="set-f"><a href="#set-f" class="headerlink" title="set -f"></a>set -f</h3><p>ç¦ç”¨æ–‡ä»¶åé€šé…ç¬¦ï¼Œæ¯”å¦‚è„šæœ¬</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">set</span> -f</span><br><span class="line"><span class="built_in">rm</span> -rf *.md</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ—¶å€™åªä¼šåˆ é™¤æ–‡ä»¶åä¸º <code>*.md</code> çš„æ–‡ä»¶ï¼Œå¹¶ä¸ä¼šæŠŠæ‰€æœ‰.md çš„æ–‡ä»¶éƒ½åˆ é™¤ã€‚</p><h2 id="ç¼–å†™è„šæœ¬æ³¨æ„äº‹é¡¹"><a href="#ç¼–å†™è„šæœ¬æ³¨æ„äº‹é¡¹" class="headerlink" title="ç¼–å†™è„šæœ¬æ³¨æ„äº‹é¡¹"></a>ç¼–å†™è„šæœ¬æ³¨æ„äº‹é¡¹</h2><table><thead><tr><th>é”™è¯¯ç¤ºèŒƒ</th><th>æ­£ç¡®ç¤ºèŒƒ</th></tr></thead><tbody><tr><td>a&#x3D;`pwd`</td><td>a&#x3D;$(pwd)</td></tr><tr><td>echo $a</td><td>echo â€œ${a}â€</td></tr></tbody></table><h2 id="trap-æ•è·é”™è¯¯"><a href="#trap-æ•è·é”™è¯¯" class="headerlink" title="trap æ•è·é”™è¯¯"></a>trap æ•è·é”™è¯¯</h2><p>trap æ˜¯æ•è·ä¿¡å·çš„å‘½ä»¤ï¼Œå¸¸ç”¨çš„ä¿¡å·æœ‰ï¼š</p><table><thead><tr><th><strong>ç¼–å·</strong></th><th><strong>ä¿¡å·åç§°</strong></th><th><strong>ç¼ºçœåŠ¨ä½œ</strong></th><th><strong>æè¿°</strong></th></tr></thead><tbody><tr><td>1</td><td>SIGHUP</td><td>ç»ˆæ­¢</td><td>ç»ˆæ­¢è¿›ç¨‹ï¼ŒæŒ‚èµ·</td></tr><tr><td>2</td><td>SIGINT</td><td>ç»ˆæ­¢</td><td>é”®ç›˜è¾“å…¥ä¸­æ–­å‘½ä»¤ï¼Œä¸€èˆ¬æ˜¯ CTRL+C</td></tr><tr><td>3</td><td>SIGQUIT</td><td>CoreDump</td><td>é”®ç›˜è¾“å…¥é€€å‡ºå‘½ä»¤ï¼Œä¸€èˆ¬æ˜¯ CTRL+\</td></tr><tr><td>4</td><td>SIGILL</td><td>CoreDump</td><td>éæ³•æŒ‡ä»¤</td></tr><tr><td>5</td><td>SIGTRAP</td><td>CoreDump</td><td>trap æŒ‡ä»¤å‘å‡ºï¼Œä¸€èˆ¬è°ƒè¯•ç”¨</td></tr><tr><td>6</td><td>SIGABRT</td><td>CoreDump</td><td>abort(3) å‘å‡ºçš„ç»ˆæ­¢ä¿¡å·</td></tr><tr><td>7</td><td>SIGBUS</td><td>CoreDump</td><td>éæ³•åœ°å€</td></tr><tr><td>8</td><td>SIGFPE</td><td>CoreDump</td><td>æµ®ç‚¹æ•°å¼‚å¸¸</td></tr><tr><td>9</td><td>SIGKILL</td><td>ç»ˆæ­¢</td><td>ç«‹å³åœæ­¢è¿›ç¨‹ï¼Œä¸èƒ½æ•è·ï¼Œä¸èƒ½å¿½ç•¥</td></tr><tr><td>10</td><td>SIGUSR1</td><td>ç»ˆæ­¢</td><td>ç”¨æˆ·è‡ªå®šä¹‰ä¿¡å· 1ï¼Œåƒ Nginx å°±æ”¯æŒ USR1 ä¿¡å·ï¼Œç”¨äºé‡è½½é…ç½®ï¼Œé‡æ–°æ‰“å¼€æ—¥å¿—</td></tr><tr><td>11</td><td>SIGSEGV</td><td>CoreDump</td><td>æ— æ•ˆå†…å­˜å¼•ç”¨</td></tr><tr><td>12</td><td>SIGUSR2</td><td>ç»ˆæ­¢</td><td>ç”¨æˆ·è‡ªå®šä¹‰ä¿¡å· 2</td></tr><tr><td>13</td><td>SIGPIPE</td><td>ç»ˆæ­¢</td><td>ç®¡é“ä¸èƒ½è®¿é—®</td></tr><tr><td>14</td><td>SIGALRM</td><td>ç»ˆæ­¢</td><td>æ—¶é’Ÿä¿¡å·ï¼Œalrm(2) å‘å‡ºçš„ç»ˆæ­¢ä¿¡å·</td></tr><tr><td>15</td><td>SIGTERM</td><td>ç»ˆæ­¢</td><td>ç»ˆæ­¢ä¿¡å·ï¼Œè¿›ç¨‹ä¼šå…ˆå…³é—­æ­£åœ¨è¿è¡Œçš„ä»»åŠ¡æˆ–æ‰“å¼€çš„æ–‡ä»¶å†ç»ˆæ­¢ï¼Œæœ‰æ—¶é—´è¿›ç¨‹åœ¨æœ‰è¿è¡Œçš„ä»»åŠ¡è€Œå¿½ç•¥æ­¤ä¿¡å·ã€‚ä¸èƒ½æ•æ‰</td></tr><tr><td>16</td><td>SIGSTKFLT</td><td>ç»ˆæ­¢</td><td>å¤„ç†å™¨æ ˆé”™è¯¯</td></tr><tr><td>17</td><td>SIGCHLD</td><td>å¯å¿½ç•¥</td><td>å­è¿›ç¨‹ç»“æŸæ—¶ï¼Œçˆ¶è¿›ç¨‹æ”¶åˆ°çš„ä¿¡å·</td></tr><tr><td>18</td><td>SIGCONT</td><td>å¯å¿½ç•¥</td><td>è®©ç»ˆæ­¢çš„è¿›ç¨‹ç»§ç»­æ‰§è¡Œ</td></tr><tr><td>19</td><td>SIGSTOP</td><td>åœæ­¢</td><td>åœæ­¢è¿›ç¨‹ï¼Œä¸èƒ½å¿½ç•¥ï¼Œä¸èƒ½æ•è·</td></tr><tr><td>20</td><td>SIGSTP</td><td>åœæ­¢</td><td>åœæ­¢è¿›ç¨‹ï¼Œä¸€èˆ¬æ˜¯ CTRL+Z</td></tr><tr><td>21</td><td>SIGTTIN</td><td>åœæ­¢</td><td>åå°è¿›ç¨‹ä»ç»ˆç«¯è¯»æ•°æ®</td></tr><tr><td>22</td><td>SIGTTOU</td><td>åœæ­¢</td><td>åå°è¿›ç¨‹ä»ç»ˆç«¯å†™æ•°æ®</td></tr><tr><td>23</td><td>SIGURG</td><td>å¯å¿½ç•¥</td><td>ç´§æ€¥æ•°ç»„æ˜¯å¦åˆ°è¾¾ socket</td></tr><tr><td>24</td><td>SIGXCPU</td><td>CoreDump</td><td>è¶…å‡º CPU å ç”¨èµ„æºé™åˆ¶</td></tr><tr><td>25</td><td>SIGXFSZ</td><td>CoreDump</td><td>è¶…å‡ºæ–‡ä»¶å¤§å°èµ„æºé™åˆ¶</td></tr><tr><td>26</td><td>SIGVTALRM</td><td>ç»ˆæ­¢</td><td>è™šæ‹Ÿæ—¶é’Ÿä¿¡å·ï¼Œç±»ä¼¼äº SIGALRMï¼Œä½†è®¡ç®—çš„æ˜¯è¿›ç¨‹å ç”¨çš„æ—¶é—´</td></tr><tr><td>27</td><td>SIGPROF</td><td>ç»ˆæ­¢</td><td>ç±»ä¼¼ä¸ SIGALRMï¼Œä½†è®¡ç®—çš„æ˜¯è¿›ç¨‹å ç”¨ CPU çš„æ—¶é—´</td></tr><tr><td>28</td><td>SIGWINCH</td><td>å¯å¿½ç•¥</td><td>çª—å£å¤§å°æ”¹å˜å‘å‡ºçš„ä¿¡å·</td></tr><tr><td>29</td><td>SIGIO</td><td>ç»ˆæ­¢</td><td>æ–‡ä»¶æè¿°ç¬¦å‡†å¤‡å°±ç»ªï¼Œå¯ä»¥è¾“å…¥&#x2F;è¾“å‡ºæ“ä½œäº†</td></tr><tr><td>30</td><td>SIGPWR</td><td>ç»ˆæ­¢</td><td>ç”µæºå¤±è´¥</td></tr><tr><td>31</td><td>SIGSYS</td><td>CoreDump</td><td>éæ³•ç³»ç»Ÿè°ƒç”¨</td></tr></tbody></table><h3 id="ç¨‹åºé€€å‡ºååˆ é™¤ä¸´æ—¶æ–‡ä»¶"><a href="#ç¨‹åºé€€å‡ºååˆ é™¤ä¸´æ—¶æ–‡ä»¶" class="headerlink" title="ç¨‹åºé€€å‡ºååˆ é™¤ä¸´æ—¶æ–‡ä»¶"></a>ç¨‹åºé€€å‡ºååˆ é™¤ä¸´æ—¶æ–‡ä»¶</h3><p>æœ‰æ—¶å€™æˆ‘ä»¬çš„è„šæœ¬ä¼šç”Ÿæˆä¸€äº›ä¸´æ—¶æ–‡ä»¶ï¼Œè™½ç„¶å¯ä»¥åœ¨è„šæœ¬æœ€ååˆ é™¤è¿™äº›ä¸´æ—¶æ–‡ä»¶ï¼Œä½†æ˜¯æœ‰äº›ä¾‹å¤–æƒ…å†µæ¯”å¦‚è„šæœ¬æŠ¥é”™ï¼Œè¿™æ ·ä¸´æ—¶æ–‡ä»¶å°±ä¸èƒ½åŠæ—¶åœ°æ¸…ç†æ‰ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ trap æ•è· EXIT ä¿¡å·æ¥æ‰§è¡Œæˆ‘ä»¬æƒ³è¦çš„å‘½ä»¤ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">some_cmd</span><br><span class="line"><span class="function"><span class="title">clean_up</span></span>() &#123;</span><br><span class="line">    <span class="built_in">rm</span> -rf /tmp/*</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;cleaned up ...&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">trap</span> <span class="string">&#x27;clean_up&#x27;</span> EXIT</span><br></pre></td></tr></table></figure><h3 id="ç¨‹åºæ„å¤–é€€å‡ºåˆ é™¤ä¸´æ—¶æ–‡ä»¶"><a href="#ç¨‹åºæ„å¤–é€€å‡ºåˆ é™¤ä¸´æ—¶æ–‡ä»¶" class="headerlink" title="ç¨‹åºæ„å¤–é€€å‡ºåˆ é™¤ä¸´æ—¶æ–‡ä»¶"></a>ç¨‹åºæ„å¤–é€€å‡ºåˆ é™¤ä¸´æ—¶æ–‡ä»¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">some_cmd</span><br><span class="line"><span class="function"><span class="title">clean_up</span></span>() &#123;</span><br><span class="line">    <span class="built_in">rm</span> -rf /tmp/*</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;cleaned up ...&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">trap</span> <span class="string">&#x27;clean_up&#x27;</span> SIGHUP SIGINT SIGTERM</span><br></pre></td></tr></table></figure><h2 id="ç”Ÿæˆä¸´æ—¶æ–‡ä»¶"><a href="#ç”Ÿæˆä¸´æ—¶æ–‡ä»¶" class="headerlink" title="ç”Ÿæˆä¸´æ—¶æ–‡ä»¶"></a>ç”Ÿæˆä¸´æ—¶æ–‡ä»¶</h2><p>å¯ä»¥ä½¿ç”¨ mktemp å‘½ä»¤ç”Ÿæˆ tmp æ–‡ä»¶ï¼Œmktemp -d ç”Ÿæˆä¸´æ—¶ç›®å½•ï¼Œé¿å…ä¸´æ—¶ç›®å½•é‡å¤ä½¿ç”¨çš„é—®é¢˜</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">tmp_file=<span class="string">&quot;<span class="subst">$(mktemp)</span>&quot;</span></span><br><span class="line">tmp_folder=<span class="string">&quot;<span class="subst">$(mktemp -d)</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$tmp_file</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$tmp_folder</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> bash </tag>
            
            <tag> shell </tag>
            
            <tag> script </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nginxä¹‹server_nameåŒ¹é…å’ŒlistenåŒ¹é…</title>
      <link href="/posts/09a38e37/"/>
      <url>/posts/09a38e37/</url>
      
        <content type="html"><![CDATA[<p>nginx å¯ä»¥é€šè¿‡ listen çš„ ip å’Œç«¯å£æ¥åŒ¹é…è¯·æ±‚åº”è¯¥ç”±å“ªä¸ªé…ç½®æ–‡ä»¶æ¥å¤„ç†ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ server_name æ¥åŒ¹é…ï¼ŒæŠ½ç©ºç†äº†ç†è¿™ä¸ªåŒ¹é…çš„è§„åˆ™å’Œä¼˜å…ˆçº§ï¼Œå‚è€ƒæ–‡æ¡£ï¼š</p><h2 id="åŸºäºåŸŸåçš„è™šæ‹Ÿä¸»æœº"><a href="#åŸºäºåŸŸåçš„è™šæ‹Ÿä¸»æœº" class="headerlink" title="åŸºäºåŸŸåçš„è™šæ‹Ÿä¸»æœº"></a>åŸºäºåŸŸåçš„è™šæ‹Ÿä¸»æœº</h2><p>é»˜è®¤æ˜¯å…ˆåŒ¹é… listen çš„ ip å’Œç«¯å£ï¼ŒåŒ¹é…åˆ°äº†å†æ£€æŸ¥ server_nameï¼Œå¦‚æœæ²¡æœ‰åŒ¹é…çš„ server_nameï¼Œåˆ™ç”±ç¬¬ä¸€ä¸ªæ¥å¤„ç†ï¼Œé™¤éæ·»åŠ  default_server</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen      80;</span><br><span class="line">    server_name example.net;</span><br><span class="line">    default_type application/json;</span><br><span class="line">    return 200 &#x27;&#123;&quot;server_name&quot;:&quot;$server_name&quot;, &quot;host&quot;: &quot;$host&quot;, &quot;server_addr&quot;:&quot;$server_addr&quot;&#125;&#x27;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen      80;</span><br><span class="line">    server_name example.com;</span><br><span class="line">    default_type application/json;</span><br><span class="line">    return 200 &#x27;&#123;&quot;server_name&quot;:&quot;$server_name&quot;, &quot;host&quot;: &quot;$host&quot;, &quot;server_addr&quot;:&quot;$server_addr&quot;&#125;&#x27;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ä¸€ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; curl 10.0.0.100 -H <span class="string">&quot;host:example.com&quot;</span></span><br><span class="line">&#123;<span class="string">&quot;server_name&quot;</span>:<span class="string">&quot;example.com&quot;</span>, <span class="string">&quot;host&quot;</span>: <span class="string">&quot;10.0.0.100&quot;</span>, <span class="string">&quot;server_addr&quot;</span>:<span class="string">&quot;10.0.0.100&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">&gt; curl localhost</span><br><span class="line">&#123;<span class="string">&quot;server_name&quot;</span>:<span class="string">&quot;example.net&quot;</span>, <span class="string">&quot;host&quot;</span>: <span class="string">&quot;localhost&quot;</span>, <span class="string">&quot;server_addr&quot;</span>:<span class="string">&quot;127.0.0.1&quot;</span>&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªé…ç½®ä¸­ï¼Œnginx ä»…ä»…æ£€æŸ¥è¯·æ±‚çš„â€œHostâ€å¤´ä»¥å†³å®šè¯¥è¯·æ±‚åº”ç”±å“ªä¸ªè™šæ‹Ÿä¸»æœºæ¥å¤„ç†ã€‚å¦‚æœ Host å¤´æ²¡æœ‰åŒ¹é…ä»»æ„ä¸€ä¸ªè™šæ‹Ÿä¸»æœºï¼Œæˆ–è€…è¯·æ±‚ä¸­æ ¹æœ¬æ²¡æœ‰åŒ…å« Host å¤´ï¼Œé‚£ nginx ä¼šå°†è¯·æ±‚åˆ†å‘åˆ°å®šä¹‰åœ¨æ­¤ç«¯å£ä¸Šçš„é»˜è®¤è™šæ‹Ÿä¸»æœºã€‚åœ¨ä»¥ä¸Šé…ç½®ä¸­ï¼Œç¬¬ä¸€ä¸ªè¢«åˆ—å‡ºçš„è™šæ‹Ÿä¸»æœºå³ nginx çš„é»˜è®¤è™šæ‹Ÿä¸»æœºâ€”â€”è¿™æ˜¯ nginx çš„é»˜è®¤è¡Œä¸ºã€‚è€Œä¸”ï¼Œå¯ä»¥æ˜¾å¼åœ°è®¾ç½®æŸä¸ªä¸»æœºä¸ºé»˜è®¤è™šæ‹Ÿä¸»æœºï¼Œå³åœ¨ â€œlistenâ€ æŒ‡ä»¤ä¸­è®¾ç½® â€œdefault_serverâ€ å‚æ•°ï¼š</p><p>å¦‚æœåŒæ ·çš„ listen é…ç½®äº†ä¸¤ä¸ª default_server åˆ™ä¼šæŠ¥é”™ <code>nginx: [emerg] a duplicate default server for 10.0.0.100:80 in /etc/nginx/conf.d/test.conf:9</code></p><h2 id="åŸºäºåŸŸåå’Œ-IP-æ··åˆçš„è™šæ‹Ÿä¸»æœº"><a href="#åŸºäºåŸŸåå’Œ-IP-æ··åˆçš„è™šæ‹Ÿä¸»æœº" class="headerlink" title="åŸºäºåŸŸåå’Œ IP æ··åˆçš„è™šæ‹Ÿä¸»æœº"></a>åŸºäºåŸŸåå’Œ IP æ··åˆçš„è™šæ‹Ÿä¸»æœº</h2><p>Nginx é¦–å…ˆé€‰å®šç”±å“ªä¸€ä¸ªè™šæ‹Ÿä¸»æœºæ¥å¤„ç†è¯·æ±‚ã€‚è®©æˆ‘ä»¬ä»ä¸€ä¸ªç®€å•çš„é…ç½®ï¼ˆå…¶ä¸­å…¨éƒ¨ 2 ä¸ªè™šæ‹Ÿä¸»æœºéƒ½åœ¨ç«¯å£ <code>*ï¼š80</code> ä¸Šç›‘å¬ï¼‰å¼€å§‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen      localhost:80;</span><br><span class="line">    server_name example.org;</span><br><span class="line">    default_type application/json;</span><br><span class="line">    return 200 &#x27;&#123;&quot;server_name&quot;:&quot;$server_name&quot;, &quot;host&quot;: &quot;$host&quot;, &quot;server_addr&quot;:&quot;$server_addr&quot;&#125;&#x27;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen      10.0.0.100:80;</span><br><span class="line">    server_name example.net;</span><br><span class="line">    default_type application/json;</span><br><span class="line">    return 200 &#x27;&#123;&quot;server_name&quot;:&quot;$server_name&quot;, &quot;host&quot;: &quot;$host&quot;, &quot;server_addr&quot;:&quot;$server_addr&quot;&#125;&#x27;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen      10.0.0.100:80;</span><br><span class="line">    server_name example.com;</span><br><span class="line">    default_type application/json;</span><br><span class="line">    return 200 &#x27;&#123;&quot;server_name&quot;:&quot;$server_name&quot;, &quot;host&quot;: &quot;$host&quot;, &quot;server_addr&quot;:&quot;$server_addr&quot;&#125;&#x27;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªé…ç½®ä¸­ï¼Œnginx é¦–å…ˆæµ‹è¯•è¯·æ±‚çš„ IP åœ°å€å’Œç«¯å£æ˜¯å¦åŒ¹é…æŸä¸ª server é…ç½®å—ä¸­çš„ listen æŒ‡ä»¤é…ç½®ã€‚æ¥ç€ nginx ç»§ç»­æµ‹è¯•è¯·æ±‚çš„ Host å¤´æ˜¯å¦åŒ¹é…è¿™ä¸ª server å—ä¸­çš„æŸä¸ª server_name çš„å€¼ã€‚å¦‚æœä¸»æœºåæ²¡æœ‰æ‰¾åˆ°ï¼Œnginx å°†æŠŠè¿™ä¸ªè¯·æ±‚äº¤ç»™é»˜è®¤è™šæ‹Ÿä¸»æœºå¤„ç†ã€‚</p><p>ä¾‹å¦‚ï¼Œä¸€ä¸ªä» 10.0.0.100:80 ç«¯å£æ”¶åˆ°çš„è®¿é—® a.example.com çš„è¯·æ±‚å°†è¢«ç›‘å¬ 10.0.0.100:80 ç«¯å£çš„é»˜è®¤è™šæ‹Ÿä¸»æœºå¤„ç†ï¼Œæœ¬ä¾‹ä¸­å°±æ˜¯ç¬¬äºŒä¸ªæœåŠ¡å™¨ï¼Œå› ä¸ºè¿™ä¸ªç«¯å£ä¸Šæ²¡æœ‰å®šä¹‰åä¸º a.example.com çš„è™šæ‹Ÿä¸»æœºã€‚</p><p>æˆ‘ä»¬å¯ä»¥æµ‹è¯•ä¸€ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt; curl localhost</span><br><span class="line">&#123;<span class="string">&quot;server_name&quot;</span>:<span class="string">&quot;example.org&quot;</span>, <span class="string">&quot;host&quot;</span>: <span class="string">&quot;localhost&quot;</span>, <span class="string">&quot;server_addr&quot;</span>:<span class="string">&quot;127.0.0.1&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">&gt; curl 10.0.0.100</span><br><span class="line">&#123;<span class="string">&quot;server_name&quot;</span>:<span class="string">&quot;example.net&quot;</span>, <span class="string">&quot;host&quot;</span>: <span class="string">&quot;10.0.0.100&quot;</span>, <span class="string">&quot;server_addr&quot;</span>:<span class="string">&quot;10.0.0.100&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">&gt; curl 10.0.0.100 -H <span class="string">&quot;host:example.com&quot;</span></span><br><span class="line">&#123;<span class="string">&quot;server_name&quot;</span>:<span class="string">&quot;example.com&quot;</span>, <span class="string">&quot;host&quot;</span>: <span class="string">&quot;example.com&quot;</span>, <span class="string">&quot;server_addr&quot;</span>:<span class="string">&quot;10.0.0.100&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">&gt; curl 10.0.0.100 -H <span class="string">&quot;host:a.example.com&quot;</span></span><br><span class="line">&#123;<span class="string">&quot;server_name&quot;</span>:<span class="string">&quot;example.net&quot;</span>, <span class="string">&quot;host&quot;</span>: <span class="string">&quot;a.example.com&quot;</span>, <span class="string">&quot;server_addr&quot;</span>:<span class="string">&quot;10.0.0.100&quot;</span>&#125;</span><br></pre></td></tr></table></figure><h2 id="server-name-ä¸ºç©º"><a href="#server-name-ä¸ºç©º" class="headerlink" title="server_name ä¸ºç©º"></a>server_name ä¸ºç©º</h2><p>çœ‹ä¸€ä¸ªä¾‹å­ï¼Œå¦‚æœä¸å…è®¸è¯·æ±‚ä¸­ç¼ºå°‘â€œHostâ€å¤´ï¼Œå¯ä»¥å®šä¹‰å¦‚ä¸‹ä¸»æœºï¼Œä¸¢å¼ƒè¿™äº›è¯·æ±‚ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen       80;</span><br><span class="line">    server_name  &quot;&quot;;</span><br><span class="line">    return       444;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Nginx </tag>
            
            <tag> é…ç½®æ–‡ä»¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨vscodeæ¥å†™hugoåšå®¢å¹¶å¤„ç†å›¾ç‰‡æ’å…¥é—®é¢˜</title>
      <link href="/posts/2a39e018/"/>
      <url>/posts/2a39e018/</url>
      
        <content type="html"><![CDATA[<p>å¦‚æœå¯¹ typora æƒ…æœ‰ç‹¬é’Ÿçš„åŒå­¦å¯ä»¥å‚è€ƒ<a href="https://zahui.fan/posts/b4cf69c3/">https://zahui.fan/posts/b4cf69c3/</a>ï¼Œä¸è¿‡æˆ‘ç”¨æ¥ç”¨å»è¿˜æ˜¯å‘ç° vscode å¥½ï¼Œå“ªæ€•ä¸å†™ä»£ç ï¼Œä»…ä»…å†™æ–‡ç« ä¹ŸæŒºä¸é”™çš„ã€‚ä¸è¿‡ç›´æ¥ç”¨çš„è¯æœ‰å¾ˆå¤šé—®é¢˜ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å€ŸåŠ© vscode å¼ºå¤§çš„æ’ä»¶ç³»ç»Ÿã€‚</p><h2 id="æ’å…¥åˆ°-static-ç›®å½•"><a href="#æ’å…¥åˆ°-static-ç›®å½•" class="headerlink" title="æ’å…¥åˆ° static ç›®å½•"></a>æ’å…¥åˆ° static ç›®å½•</h2><h3 id="æ’å…¥å›¾ç‰‡é—®é¢˜"><a href="#æ’å…¥å›¾ç‰‡é—®é¢˜" class="headerlink" title="æ’å…¥å›¾ç‰‡é—®é¢˜"></a>æ’å…¥å›¾ç‰‡é—®é¢˜</h3><p>æˆ‘ä»¬åœ¨å†™åšå®¢çš„æ—¶å€™ï¼Œæœ‰æ—¶ä¼šæœ‰ä¸€äº›æ’å…¥å›¾ç‰‡çš„éœ€æ±‚ï¼Œä¹‹å‰çš„åšæ³•æ˜¯ â€“ æˆªå›¾ä¿å­˜åˆ° <code>static/images</code> ç›®å½•ï¼Œç„¶åæ–‡ç« é‡Œé¢æ·»åŠ  <code>![å›¾ç‰‡è¯´æ˜](https://static.zahui.fan/images/xxx.png)</code>ï¼Œæ“ä½œå¾ˆç¹çï¼Œæˆ–è€…ä¹Ÿå¯ä»¥ä½¿ç”¨å›¾åºŠï¼Œä¸è¿‡ä¹ŸæŒºéº»çƒ¦çš„ã€‚æˆ‘ä»¬å¯ä»¥ç”¨ä¸€æ¬¾å« <code>paste image</code> çš„æ’ä»¶æ¥ç®€åŒ–æˆ‘ä»¬çš„æ’å…¥å›¾ç‰‡çš„æ“ä½œã€‚</p><p>å‡è®¾ä½ çš„åšå®¢å›¾ç‰‡æ”¾åœ¨ä»“åº“æ ¹ç›®å½•çš„ static&#x2F;images ç›®å½•ä¸‹ï¼Œåšå®¢æ–‡ç« åœ¨å…¶ä»–åœ°æ–¹ï¼Œéœ€è¦ä¿®æ”¹</p><ul><li><p>å›¾ç‰‡å­˜æ”¾çš„ä½ç½®ï¼š</p><p>  <img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/2022-03-30-00-46-15.png" alt="å›¾ç‰‡å­˜æ”¾çš„ä½ç½®"></p></li><li><p>å›¾ç‰‡çš„åŸºç¡€è·¯å¾„ï¼š</p><p>  å³åœ¨ markdown æ–‡ä»¶é‡Œé¢ä¸æ˜¾ç¤º static äº†ï¼Œåªä» images å¼€å§‹æ˜¾ç¤º</p><p>  <img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/2022-03-30-00-48-30.png" alt="å›¾ç‰‡çš„åŸºç¡€è·¯å¾„"></p></li><li><p>è·¯å¾„çš„å‰ç¼€ï¼š</p><p>  å¦‚æœä¸åŠ çš„è¯ï¼Œè·¯å¾„æ˜¯ç±»ä¼¼äº <code>![å›¾ç‰‡è¯´æ˜](images/xxx.png)</code>ï¼Œæˆ‘ä»¬æƒ³è¦çš„æ˜¯ <code>![å›¾ç‰‡è¯´æ˜](https://static.zahui.fan/images/xxx.png)</code></p><p>  <img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/2022-03-30-00-55-40.png" alt="è·¯å¾„å‰ç¼€"></p></li></ul><p>ä»¥ä¸Šä¿®æ”¹å®Œæˆåï¼Œå°±å¯ä»¥ä½¿ç”¨ <code>ctrl+alt+v</code> é”®ç›´æ¥ä»ç”µè„‘å‰ªè´´æ¿ç²˜è´´äº†ã€‚</p><p>ä»¥ä¸Šé…ç½®æ–‡ä»¶çš„ä¿®æ”¹ä¹Ÿå¯ä»¥é€šè¿‡ç›´æ¥ç¼–è¾‘ json æ–‡ä»¶æ¥è¿›è¡Œ</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;pasteImage.basePath&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$&#123;projectRoot&#125;/static&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;pasteImage.path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$&#123;projectRoot&#125;/static/images&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;pasteImage.prefix&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="é¿å…-blog-ä»“åº“è¿‡å¤§"><a href="#é¿å…-blog-ä»“åº“è¿‡å¤§" class="headerlink" title="é¿å… blog ä»“åº“è¿‡å¤§"></a>é¿å… blog ä»“åº“è¿‡å¤§</h3><p>blog ä»“åº“åªä¿ç•™æ–‡æœ¬æ–‡ä»¶ï¼Œæ¯æ¬¡æäº¤ commit ä¹Ÿæ˜¯æœ‰æ„ä¹‰çš„ï¼Œä½†æ˜¯åƒå›¾ç‰‡ç­‰å°±æ²¡å¿…è¦è¿™æ ·äº†ï¼Œæ‰€ä»¥ static ç›®å½•æˆ‘æ˜¯ç”¨äº†ä¸€ä¸ª git submoduleï¼Œå½“ç„¶è¿˜æœ‰ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨å›¾åºŠï¼Œæ”¾åœ¨ github ä»“åº“é‡Œï¼Œä½¿ç”¨ jsdeliver è¿›è¡Œ CDN åŠ é€Ÿ</p><h2 id="ä½¿ç”¨å›¾åºŠ"><a href="#ä½¿ç”¨å›¾åºŠ" class="headerlink" title="ä½¿ç”¨å›¾åºŠ"></a>ä½¿ç”¨å›¾åºŠ</h2><p>å›¾åºŠè¯´ç™½äº†å°±æ˜¯ä¸ªå­˜å›¾ç‰‡çš„åœ°æ–¹ï¼Œå¯ä»¥é€šè¿‡ http ç›´é“¾æ¥è®¿é—®ï¼Œå¯ä»¥ç®€åŒ– md ç¼–å†™å’Œç§»åŠ¨ï¼Œå¯ä»¥ä½¿ç”¨ <a href="https://picgo.github.io/PicGo-Doc/">PicGo</a> æ¥ç®€åŒ–æ“ä½œ</p><p>æˆ‘ç”¨çš„æ˜¯ github åšå›¾åºŠï¼Œé€šè¿‡ jsdelivr æ¥è¿›è¡Œ CDN åŠ é€Ÿï¼Œæˆ‘çš„é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼ˆå…¶ä¸­ token éœ€è¦åœ¨ github åå°ç”Ÿæˆï¼‰ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;picBed&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;current&quot;</span><span class="punctuation">:</span> <span class="string">&quot;github&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;uploader&quot;</span><span class="punctuation">:</span> <span class="string">&quot;github&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;smms&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;github&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;branch&quot;</span><span class="punctuation">:</span> <span class="string">&quot;master&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;customUrl&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://cdn.jsdelivr.net/gh/iuxt/static&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;images/&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;repo&quot;</span><span class="punctuation">:</span> <span class="string">&quot;iuxt/static&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xxxx&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;shortKey&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;picgo:upload&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;enable&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;key&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CommandOrControl+Shift+P&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;upload&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;label&quot;</span><span class="punctuation">:</span> <span class="string">&quot;å¿«æ·ä¸Šä¼ &quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;server&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;port&quot;</span><span class="punctuation">:</span> <span class="number">36677</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;host&quot;</span><span class="punctuation">:</span> <span class="string">&quot;127.0.0.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;enable&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;privacyEnsure&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;showUpdateTip&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;picgoPlugins&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;debug&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;PICGO_ENV&quot;</span><span class="punctuation">:</span> <span class="string">&quot;GUI&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;needReload&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>æŒ‰ä¸‹å¿«æ·é”® ctrl + shift + p ä¼šè‡ªåŠ¨ä¸Šä¼ å‰ªåˆ‡æ¿ä¸Šçš„å›¾ç‰‡ï¼Œç„¶åå°†è¿æ¥å†™å…¥å‰ªåˆ‡æ¿</p><h2 id="hugo-å‘½ä»¤"><a href="#hugo-å‘½ä»¤" class="headerlink" title="hugo å‘½ä»¤"></a>hugo å‘½ä»¤</h2><p>åªéœ€è¦å°† hugo.exe æ‰”åˆ° path é‡Œå°±å¥½äº†ï¼Œæˆ‘ä¸ªäººæ¯”è¾ƒå–œæ¬¢çš„åšæ³•æ˜¯åœ¨å®¶ç›®å½•åˆ›å»ºä¸€ä¸ª bin ç›®å½•ï¼Œç„¶åæŠŠè¿™ä¸ª bin ç›®å½•æ·»åŠ åˆ° path ç¯å¢ƒå˜é‡ä¸­ï¼Œå…·ä½“æ“ä½œå¦‚ä¸‹ï¼š</p><p>ä¸‹è½½ hugo.exe æ”¾åˆ° <code>%userprofile%\bin</code> ä¸­ï¼Œç„¶å</p><p>ç³»ç»Ÿè®¾ç½®</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/2022-03-30-01-01-09.png" alt="ç³»ç»Ÿè®¾ç½®"></p><p>é«˜çº§ç³»ç»Ÿè®¾ç½®</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/2022-03-30-01-02-08.png" alt="é«˜çº§è®¾ç½®"></p><p>ç¯å¢ƒå˜é‡</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/2022-03-30-01-02-16.png" alt="ç¯å¢ƒå˜é‡"></p>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Blog </tag>
            
            <tag> hugo </tag>
            
            <tag> ç¼–è¾‘å™¨ </tag>
            
            <tag> markdown </tag>
            
            <tag> vscode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxç£ç›˜ç®¡ç†</title>
      <link href="/posts/stmd3s/"/>
      <url>/posts/stmd3s/</url>
      
        <content type="html"><![CDATA[<div class="note warning flat"><p>æ•°æ®æ— ä»·ï¼Œè°¨æ…æ“ä½œï¼<br>åˆ‡å¿Œç›´æ¥å¤åˆ¶ç²˜è´´ï¼<br>æµ‹è¯•ç¯å¢ƒéªŒè¯é€šè¿‡å†ä¸Šç”Ÿäº§ï¼</p></div><h2 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ—å‡ºå—è®¾å¤‡ã€æŒ‚è½½ç‚¹ç­‰ï¼Œä¸€èˆ¬æŸ¥çœ‹ç£ç›˜ä¿¡æ¯</span></span><br><span class="line">lsblk</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºç›®å½•</span></span><br><span class="line"><span class="built_in">mkdir</span> /es-data2 /es-data1 /es-logs</span><br><span class="line"><span class="built_in">chown</span> -R elasticsearch:elasticsearch /es-data2 /es-data1 /es-logs</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æŒ‚è½½ç‚¹ã€ç£ç›˜å ç”¨å¤§å°ç­‰ã€‚</span></span><br><span class="line"><span class="built_in">df</span> -hT</span><br></pre></td></tr></table></figure><h2 id="parted-å‘½ä»¤"><a href="#parted-å‘½ä»¤" class="headerlink" title="parted å‘½ä»¤"></a>parted å‘½ä»¤</h2><h3 id="è®¾ç½®ç£ç›˜ä¸º-gpt-åˆ†åŒºè¡¨"><a href="#è®¾ç½®ç£ç›˜ä¸º-gpt-åˆ†åŒºè¡¨" class="headerlink" title="è®¾ç½®ç£ç›˜ä¸º gpt åˆ†åŒºè¡¨"></a>è®¾ç½®ç£ç›˜ä¸º gpt åˆ†åŒºè¡¨</h3><p>å¦‚æœæ˜¯å¤§ç£ç›˜ï¼ˆå¤§äº 2Tï¼‰ï¼Œå»ºè®®ä½¿ç”¨ GPT åˆ†åŒºè¡¨ã€‚<br>å¦‚æœæ˜¯å°ç£ç›˜ï¼Œåªè¦æœºå™¨ä¸æ˜¯å¤ªè€ï¼Œä¹Ÿå»ºè®®ä½¿ç”¨ GPT åˆ†åŒºè¡¨ã€‚mbr è¯¥è¢«æ·˜æ±°äº†ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo parted /dev/vdb --script mklabel gpt</span><br></pre></td></tr></table></figure><h3 id="åˆ›å»ºåˆ†åŒº"><a href="#åˆ›å»ºåˆ†åŒº" class="headerlink" title="åˆ›å»ºåˆ†åŒº"></a>åˆ›å»ºåˆ†åŒº</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºåˆ†åŒºï¼Œæ ‡è¯†ä¸ºext4(ä¸ä¼šçœŸæ­£æ ¼å¼åŒ–)</span></span><br><span class="line">sudo parted /dev/vdb mkpart primary ext4 0% 100%</span><br><span class="line"><span class="comment"># åˆ›å»ºæŒ‡å®šå¤§å°çš„åˆ†åŒº</span></span><br><span class="line"><span class="comment"># sudo parted /dev/sdX mkpart primary ext4 1MiB 50GiB</span></span><br></pre></td></tr></table></figure><blockquote><p>primaryï¼šä¸»åˆ†åŒºï¼ˆGPT åˆ†åŒºè¡¨å¯çœç•¥ï¼‰<br>ext4ï¼šæ–‡ä»¶ç³»ç»Ÿç±»å‹ï¼Œå¯é€‰ ext4, xfs, ntfs ç­‰<br>1MiB 50GiBï¼šèµ·å§‹ä½ç½®å’Œç»“æŸä½ç½®</p></blockquote><h3 id="æŸ¥çœ‹åˆ†åŒºè¡¨"><a href="#æŸ¥çœ‹åˆ†åŒºè¡¨" class="headerlink" title="æŸ¥çœ‹åˆ†åŒºè¡¨"></a>æŸ¥çœ‹åˆ†åŒºè¡¨</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo parted /dev/vdb <span class="built_in">print</span></span><br></pre></td></tr></table></figure><h3 id="å…¶ä»–å¸¸ç”¨æ“ä½œ"><a href="#å…¶ä»–å¸¸ç”¨æ“ä½œ" class="headerlink" title="å…¶ä»–å¸¸ç”¨æ“ä½œ"></a>å…¶ä»–å¸¸ç”¨æ“ä½œ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ é™¤åˆ†åŒº 1</span></span><br><span class="line">parted /dev/sdX <span class="built_in">rm</span> 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># è°ƒæ•´åˆ†åŒºå¤§å°ï¼Œè°ƒæ•´åˆ†åŒº 1 çš„å¤§å°è‡³ 100GiBã€‚</span></span><br><span class="line">parted /dev/sdX resizepart 1 100GiB</span><br></pre></td></tr></table></figure><h2 id="æ ¼å¼åŒ–ä¸æ‰‹åŠ¨æŒ‚è½½"><a href="#æ ¼å¼åŒ–ä¸æ‰‹åŠ¨æŒ‚è½½" class="headerlink" title="æ ¼å¼åŒ–ä¸æ‰‹åŠ¨æŒ‚è½½"></a>æ ¼å¼åŒ–ä¸æ‰‹åŠ¨æŒ‚è½½</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ ¼å¼åŒ–åˆ†åŒºä¸ºext4æ–‡ä»¶ç³»ç»Ÿ</span></span><br><span class="line">sudo mkfs.ext4 /dev/vdb1</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰‹åŠ¨æŒ‚è½½åˆ°æŒ‡å®šçš„è·¯å¾„ï¼Œä¸´æ—¶ä½¿ç”¨ï¼Œå»ºè®®ä½¿ç”¨ä¸‹é¢çš„è‡ªåŠ¨æŒ‚è½½ã€‚</span></span><br><span class="line"><span class="comment"># sudo mount /dev/vdb1 /es-data2</span></span><br></pre></td></tr></table></figure><h2 id="é…ç½®è‡ªåŠ¨æŒ‚è½½"><a href="#é…ç½®è‡ªåŠ¨æŒ‚è½½" class="headerlink" title="é…ç½®è‡ªåŠ¨æŒ‚è½½"></a>é…ç½®è‡ªåŠ¨æŒ‚è½½</h2><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">ä½¿ç”¨UUIDæŒ‚è½½(æ¨è)</button><button type="button" class="tab">ä½¿ç”¨è®¾å¤‡è·¯å¾„æŒ‚è½½</button></div><div class="tab-contents"><div class="tab-item-content active"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å—è®¾å¤‡çš„UUID</span></span><br><span class="line">sudo blkid /dev/vdb1</span><br></pre></td></tr></table></figure><p><code>vim /etc/fstab</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ ¼å¼ï¼šUUID=&lt;UUID&gt; &lt;æŒ‚è½½ç‚¹&gt; &lt;æ–‡ä»¶ç³»ç»Ÿç±»å‹&gt; &lt;æŒ‚è½½é€‰é¡¹&gt; &lt;dump&gt; &lt;fsck&gt;</span></span><br><span class="line">UUID=c35edad4-2d9b-4adc-b107-aeecbcae416e /es-data2 ext4    defaults,nofail 0 0</span><br></pre></td></tr></table></figure><p>å‚æ•°è§£é‡Š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">UUID:          åˆ†åŒºçš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆæ¯”è®¾å¤‡åæ›´ç¨³å®šï¼‰ã€‚</span><br><span class="line">æŒ‚è½½ç‚¹:        æ–°ç£ç›˜æŒ‚è½½çš„ç›®æ ‡ç›®å½•ï¼ˆå¦‚ /mnt/dataï¼‰ã€‚</span><br><span class="line">æ–‡ä»¶ç³»ç»Ÿç±»å‹:  åˆ†åŒºçš„æ ¼å¼ï¼ˆå¦‚ ext4ã€xfsã€ntfs ç­‰ï¼‰ã€‚</span><br><span class="line"></span><br><span class="line">æŒ‚è½½é€‰é¡¹:</span><br><span class="line">defaults:      åŒ…å«è¯»å†™ã€æ‰§è¡Œç­‰åŸºæœ¬æƒé™ã€‚</span><br><span class="line">nofail:        å¯åŠ¨æ—¶å¦‚æœç£ç›˜ä¸å­˜åœ¨ï¼Œå¿½ç•¥é”™è¯¯ï¼ˆé˜²æ­¢ç³»ç»Ÿæ— æ³•å¯åŠ¨ï¼‰ã€‚</span><br><span class="line">dump:          å¤‡ä»½å·¥å…· dump çš„æ ‡è®°ï¼ˆé€šå¸¸è®¾ä¸º 0ï¼‰ã€‚</span><br><span class="line">fsck:          æ–‡ä»¶ç³»ç»Ÿæ£€æŸ¥é¡ºåºï¼ˆ0 è¡¨ç¤ºä¸æ£€æŸ¥ï¼Œæ ¹åˆ†åŒºè®¾ä¸º 1ï¼Œå…¶ä»–æ•°æ®ç›˜è®¾ä¸º 0 æˆ– 2ï¼‰ã€‚</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><p><code>vim /etc/fstab</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/dev/vdb1 /es-data2 ext4 defaults,nofail 0 0</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div><h3 id="æµ‹è¯•è‡ªåŠ¨æŒ‚è½½"><a href="#æµ‹è¯•è‡ªåŠ¨æŒ‚è½½" class="headerlink" title="æµ‹è¯•è‡ªåŠ¨æŒ‚è½½"></a>æµ‹è¯•è‡ªåŠ¨æŒ‚è½½</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mount -a</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ‰©å®¹ </tag>
            
            <tag> åˆ†åŒº </tag>
            
            <tag> æŒ‚è½½ </tag>
            
            <tag> æ ¼å¼åŒ– </tag>
            
            <tag> ç£ç›˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Kafka + Zookeeperé›†ç¾¤æ­å»º</title>
      <link href="/posts/60a9e345/"/>
      <url>/posts/60a9e345/</url>
      
        <content type="html"><![CDATA[<p>æ–°ç‰ˆæœ¬çš„ kafka å¯ä»¥ä¸ä¾èµ– zookeeperï¼Œä¸è¿‡ç›®å‰å¤„äºæµ‹è¯•é˜¶æ®µï¼Œä¸”ä¸æ”¯æŒ zookeeper è¿ç§»åˆ°æ–°æœ¬ï¼Œæ‰€ä»¥åœ¨ç”Ÿäº§ç¯å¢ƒè¿˜æ˜¯å»ºè®®ç­‰ä¸€ç­‰ã€‚æœ¬æ–‡ä½¿ç”¨çš„æ˜¯ <a href="https://archive.apache.org/dist/kafka/2.8.1/kafka_2.13-2.8.1.tgz">kafka_2.13-2.8.1.tgz</a></p><p>zookeeper ç›¸å…³çš„æ–‡æ¡£å¯ä»¥å‚è€ƒ<a href="https://zookeeper.apache.org/doc/r3.8.0/zookeeperStarted.html">https://zookeeper.apache.org/doc/r3.8.0/zookeeperStarted.html</a></p><h2 id="å®‰è£…è§„åˆ’"><a href="#å®‰è£…è§„åˆ’" class="headerlink" title="å®‰è£…è§„åˆ’"></a>å®‰è£…è§„åˆ’</h2><table><thead><tr><th>è¯´æ˜</th><th>ç›®å½•</th></tr></thead><tbody><tr><td>kafka ç¨‹åºç›®å½•</td><td>&#x2F;data&#x2F;src&#x2F;kafka_2.13-2.8.1</td></tr><tr><td>kafka æ•°æ®ç›®å½•</td><td>&#x2F;data&#x2F;kafka-logs</td></tr><tr><td>zookeeper æ•°æ®ç›®å½•</td><td>&#x2F;data&#x2F;zookeeper_data</td></tr></tbody></table><h2 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h2><h3 id="é¦–å…ˆéœ€è¦å®‰è£…-java-ç¯å¢ƒ"><a href="#é¦–å…ˆéœ€è¦å®‰è£…-java-ç¯å¢ƒ" class="headerlink" title="é¦–å…ˆéœ€è¦å®‰è£… java ç¯å¢ƒ"></a>é¦–å…ˆéœ€è¦å®‰è£… java ç¯å¢ƒ</h3><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">Ubuntuå’ŒDebian</button><button type="button" class="tab">CentOSå’ŒFedora</button></div><div class="tab-contents"><div class="tab-item-content active"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install -y openjdk-8-jdk-headless</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y java-1.8.0-openjdk</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div><h3 id="åˆ›å»ºç›®å½•"><a href="#åˆ›å»ºç›®å½•" class="headerlink" title="åˆ›å»ºç›®å½•"></a>åˆ›å»ºç›®å½•</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /data/kafka-logs -p</span><br><span class="line"><span class="built_in">mkdir</span> /data/zookeeper_data -p</span><br><span class="line"><span class="built_in">ln</span> -s /data/src/kafka_2.13-2.8.1 /data/src/kafka</span><br></pre></td></tr></table></figure><h2 id="é…ç½®-zookeeper"><a href="#é…ç½®-zookeeper" class="headerlink" title="é…ç½® zookeeper"></a>é…ç½® zookeeper</h2><h3 id="ä¿®æ”¹-zookeeper-é…ç½®"><a href="#ä¿®æ”¹-zookeeper-é…ç½®" class="headerlink" title="ä¿®æ”¹ zookeeper é…ç½®"></a>ä¿®æ”¹ zookeeper é…ç½®</h3><p>vim config&#x2F;zookeeper.properties</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">dataDir=/data/zookeeper_data</span><br><span class="line"># the port at which the clients will connect</span><br><span class="line">clientPort=2181</span><br><span class="line"># disable the per-ip limit on the number of connections since this is a non-production config</span><br><span class="line">maxClientCnxns=0</span><br><span class="line"># Disable the adminserver by default to avoid port conflicts.</span><br><span class="line"># Set the port to something non-conflicting if choosing to enable this</span><br><span class="line">admin.enableServer=false</span><br><span class="line"># admin.serverPort=8080</span><br><span class="line"></span><br><span class="line">tickTime=2000</span><br><span class="line">initLimit=5</span><br><span class="line">syncLimit=2</span><br><span class="line">server.1=10.0.0.31:2888:3888</span><br><span class="line">server.2=10.0.0.32:2888:3888</span><br><span class="line">server.3=10.0.0.33:2888:3888</span><br></pre></td></tr></table></figure><h3 id="åˆ›å»ºæ•°æ®ç›®å½•å’Œé›†ç¾¤-ID"><a href="#åˆ›å»ºæ•°æ®ç›®å½•å’Œé›†ç¾¤-ID" class="headerlink" title="åˆ›å»ºæ•°æ®ç›®å½•å’Œé›†ç¾¤ ID"></a>åˆ›å»ºæ•°æ®ç›®å½•å’Œé›†ç¾¤ ID</h3><blockquote><p>myid é›†ç¾¤å†…ä¸èƒ½é‡å¤çš„ï¼Œæ¯å°æœºå™¨è®¾ç½®æˆä¸ä¸€æ ·çš„ã€‚</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> 1 &gt; /data/zookeeper_data/myid</span><br></pre></td></tr></table></figure><h3 id="å¯åŠ¨-zookeeper"><a href="#å¯åŠ¨-zookeeper" class="headerlink" title="å¯åŠ¨ zookeeper"></a>å¯åŠ¨ zookeeper</h3><p>åˆ›å»º systemd æ–‡ä»¶ (å¯é€‰)</p><p>vim &#x2F;etc&#x2F;systemd&#x2F;system&#x2F;zookeeper.service</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Unit]</span></span><br><span class="line"><span class="attr">Description</span>=Zookeeper service</span><br><span class="line"><span class="attr">After</span>=network.target</span><br><span class="line"></span><br><span class="line"><span class="section">[Service]</span></span><br><span class="line"><span class="attr">Type</span>=simple</span><br><span class="line"><span class="attr">User</span>=root</span><br><span class="line"><span class="attr">Group</span>=root</span><br><span class="line"><span class="attr">ExecStart</span>=/data/src/kafka/bin/zookeeper-server-start.sh /data/src/kafka/config/zookeeper.properties</span><br><span class="line"><span class="attr">ExecStop</span>=/data/src/kafka/bin/zookeeper-server-stop.sh</span><br><span class="line"><span class="attr">Restart</span>=<span class="literal">on</span>-failure</span><br><span class="line"></span><br><span class="line"><span class="section">[Install]</span></span><br><span class="line"><span class="attr">WantedBy</span>=multi-user.target</span><br></pre></td></tr></table></figure><h2 id="é…ç½®-kafka"><a href="#é…ç½®-kafka" class="headerlink" title="é…ç½® kafka"></a>é…ç½® kafka</h2><h3 id="ä¿®æ”¹é…ç½®æ–‡ä»¶"><a href="#ä¿®æ”¹é…ç½®æ–‡ä»¶" class="headerlink" title="ä¿®æ”¹é…ç½®æ–‡ä»¶"></a>ä¿®æ”¹é…ç½®æ–‡ä»¶</h3><p>vim config&#x2F;server.properties</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">broker.id=1                            # æ¯ä¸ªèŠ‚ç‚¹éœ€è¦ä¸ä¸€æ ·</span><br><span class="line">listeners=PLAINTEXT://10.0.0.31:9092   # IPå’Œä½ çš„èŠ‚ç‚¹IPä¿æŒä¸€è‡´</span><br><span class="line">zookeeper.connect=10.0.0.31:2181,10.0.0.32:2181,10.0.0.33:2181</span><br></pre></td></tr></table></figure><h3 id="å¯åŠ¨-kafka"><a href="#å¯åŠ¨-kafka" class="headerlink" title="å¯åŠ¨ kafka"></a>å¯åŠ¨ kafka</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-server-start.sh config/server.properties</span><br></pre></td></tr></table></figure><blockquote><p>å¦‚æœæŠ¥é”™ï¼š<br>kafka.common.InconsistentClusterIdException: The Cluster ID C4wRULTzSGqNoEAInvubIw doesnâ€™t match stored clusterId Some(eA5rD8rZSUm3EXr2glib2w) in meta.properties. The broker is trying tojoin the wrong cluster. Configured zookeeper.connect may be wrong.</p><p>è¿™ä¸ªæ—¶å€™éœ€è¦åˆ é™¤ kafka çš„ log ç›®å½•ï¼Œè®©ç¨‹åºé‡æ–°ç”Ÿæˆ</p></blockquote><p>åˆ›å»º systemd é…ç½®æ–‡ä»¶</p><p>vim &#x2F;etc&#x2F;systemd&#x2F;system&#x2F;kafka.service</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Unit]</span></span><br><span class="line"><span class="attr">Description</span>=Apache Kafka server (broker)</span><br><span class="line"><span class="attr">After</span>=network.target zookeeper.service</span><br><span class="line"></span><br><span class="line"><span class="section">[Service]</span></span><br><span class="line"><span class="attr">Type</span>=simple</span><br><span class="line"><span class="attr">User</span>=root</span><br><span class="line"><span class="attr">Group</span>=root</span><br><span class="line"><span class="attr">ExecStart</span>=/data/src/kafka/bin/kafka-server-start.sh /data/src/kafka/config/server.properties</span><br><span class="line"><span class="attr">ExecStop</span>=/data/src/kafka/bin/kafka-server-stop.sh</span><br><span class="line"><span class="attr">Restart</span>=<span class="literal">on</span>-failure</span><br><span class="line"></span><br><span class="line"><span class="section">[Install]</span></span><br><span class="line"><span class="attr">WantedBy</span>=multi-user.target</span><br></pre></td></tr></table></figure><h2 id="æµ‹è¯•å’Œä½¿ç”¨"><a href="#æµ‹è¯•å’Œä½¿ç”¨" class="headerlink" title="æµ‹è¯•å’Œä½¿ç”¨"></a>æµ‹è¯•å’Œä½¿ç”¨</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /data/src/kafka</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºtopic</span></span><br><span class="line">bin/kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic testtopic</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹topic list</span></span><br><span class="line">bin/kafka-topics.sh --zookeeper localhost:2181 --list</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ§åˆ¶å°ç”Ÿäº§æ¶ˆæ¯</span></span><br><span class="line">bin/kafka-console-producer.sh --bootstrap-server kafka2:9092 --topic testtopic</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ§åˆ¶å°æ¶ˆè´¹æ¶ˆæ¯</span></span><br><span class="line">bin/kafka-console-consumer.sh --bootstrap-server kafka3:9092 --topic testtopic --from-beginning</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æ—¥å¿— </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
            <tag> Kafka </tag>
            
            <tag> æœ‰çŠ¶æ€æœåŠ¡ </tag>
            
            <tag> MQ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Filebeatè¾“å‡ºæ—¥å¿—æ ¼å¼å¤„ç†</title>
      <link href="/posts/1a418f5e/"/>
      <url>/posts/1a418f5e/</url>
      
        <content type="html"><![CDATA[<p>ä½¿ç”¨ filebeat å¯ä»¥åœ¨æ”¶é›†è¿‡ç¨‹ä¸­è¿›è¡Œä¸€äº›ç®€å•çš„å¤„ç†ï¼Œå¦‚ä¸¢å¼ƒæ—¥å¿—ç­‰ï¼Œç»™åé¢çš„ kafka ç­‰å‡å°‘å‹åŠ›</p><h2 id="æ™®é€šæ–‡æœ¬æ—¥å¿—æ ¼å¼"><a href="#æ™®é€šæ–‡æœ¬æ—¥å¿—æ ¼å¼" class="headerlink" title="æ™®é€šæ–‡æœ¬æ—¥å¿—æ ¼å¼"></a>æ™®é€šæ–‡æœ¬æ—¥å¿—æ ¼å¼</h2><p>åŸå§‹æ—¥å¿—æ ¼å¼ï¼š</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;log&quot;:&quot;2022-03-15 14:53:48.972 [http-nio-8080-exec-10] o.s.c.c.c.ConfigServicePropertySourceLocator-[227]-[INFO]-Connect Timeout Exception on Url - http://localhost:8888. Will be trying the next url if available\n&quot;,&quot;stream&quot;:&quot;stdout&quot;,&quot;time&quot;:&quot;2022-03-15T06:53:48.972854745Z&quot;&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„åŸå§‹æ—¥å¿—æ˜¯æŒ‡è¦æ”¶é›†çš„æ—¥å¿—æ–‡ä»¶çš„æ ¼å¼ï¼Œä¸Šé¢çš„è¿™ä¸ªæ—¥å¿—æ˜¯è¢« Kubernetes å¤„ç†è¿‡çš„ï¼ŒçœŸæ­£ç¨‹åºè¾“å‡ºçš„æ—¥å¿—åº”è¯¥æ˜¯ log å­—æ®µã€‚</p><p>å¯¹åº”çš„ filebeat é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">filebeat.inputs:</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">type:</span> <span class="string">log</span></span><br><span class="line">    <span class="attr">symlinks:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">json.keys_under_root:</span> <span class="literal">false</span>     <span class="comment"># keys_under_rootå¯ä»¥è®©å­—æ®µä½äºæ ¹èŠ‚ç‚¹,é»˜è®¤ä¸ºfalse</span></span><br><span class="line">    <span class="attr">json.overwrite_keys:</span> <span class="literal">false</span>      <span class="comment"># å¯¹äºåŒåçš„key,è¦†ç›–åŸæœ‰keyå€¼</span></span><br><span class="line">    <span class="attr">json.add_error_key:</span> <span class="literal">true</span>        <span class="comment"># å°†è§£æé”™è¯¯çš„æ¶ˆæ¯è®°å½•å‚¨å­˜åœ¨error.messageå­—æ®µä¸­</span></span><br><span class="line">    <span class="attr">tail_files:</span> <span class="literal">true</span>                <span class="comment"># å¦‚æœæ­¤é€‰é¡¹è®¾ç½®ä¸ºtrue,Filebeatå¼€å§‹åœ¨æ¯ä¸ªæ–‡ä»¶çš„æœ«å°¾è¯»å–æ–°æ–‡ä»¶,é»˜è®¤è®¾ç½®æ˜¯falseã€‚</span></span><br><span class="line">    <span class="attr">paths:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/var/log/containers/*_dev_*.log</span></span><br><span class="line">    <span class="comment"># exclude_files:                    # æ’é™¤çš„æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">    <span class="comment">#   - &#x27;ingress-nginx-controller\.*&#x27;</span></span><br><span class="line">    <span class="comment">#   - &#x27;\.*_dev_\.*</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">processors:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">drop_event:</span></span><br><span class="line">        <span class="attr">when:</span></span><br><span class="line">            <span class="attr">or:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">regexp:</span></span><br><span class="line">                <span class="attr">json.log:</span> <span class="string">&#x27;å®šæ—¶ä»»åŠ¡task&#x27;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">regexp:</span></span><br><span class="line">                <span class="attr">json.log:</span> <span class="string">&#x27;å®šæ—¶ä»»åŠ¡æ‰§è¡ŒæˆåŠŸ&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">fields:</span></span><br><span class="line">    <span class="attr">log_topic:</span> <span class="string">k8s-pod-logs</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">&quot;kube-logs&quot;</span></span><br><span class="line">    <span class="comment"># multiline.negate: true</span></span><br><span class="line">    <span class="comment"># multiline.match: after</span></span><br></pre></td></tr></table></figure><p>ç»è¿‡ filebeat å¤„ç†åè¾“å‡ºçš„å†…å®¹ï¼š<br>æ‰€ä»¥å›è¿‡å¤´æ¥çœ‹ä¸Šé¢çš„é…ç½®æ–‡ä»¶ï¼Œ<code>drop_event</code> <code>regexp</code> ä¸‹é¢ é’ˆå¯¹ <code>json.log</code> åšæ­£åˆ™åŒ¹é…ï¼ŒåŒ…å«æŒ‡å®šå­—ç¬¦å°±ä¸¢å¼ƒã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;@timestamp&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-15T07:04:44.917Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;@metadata&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;beat&quot;</span><span class="punctuation">:</span> <span class="string">&quot;filebeat&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;_doc&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;7.3.2&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;topic&quot;</span><span class="punctuation">:</span> <span class="string">&quot;k8s-pod-logs&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;log&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;offset&quot;</span><span class="punctuation">:</span> <span class="number">6799764</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;file&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/var/log/containers/xxxx.log&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;json&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;log&quot;</span><span class="punctuation">:</span> <span class="string">&quot;[2022-03-15 15:04:37.637] http-nio-8080-exec-8 com.i.aa.aa.b-[-1]-[DEBUG]-[TID:null NAME:APPNAME ENV:dev INS:172.20.37.197] CORSFilter is work~~~\n&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;stream&quot;</span><span class="punctuation">:</span> <span class="string">&quot;stdout&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;time&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-15T07:04:37.638273461Z&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;input&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;log&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;kube-logs&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;log_topic&quot;</span><span class="punctuation">:</span> <span class="string">&quot;k8s-pod-logs&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;ecs&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.0.1&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;host&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;localhost.localdomain&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;architecture&quot;</span><span class="punctuation">:</span> <span class="string">&quot;x86_64&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;os&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;platform&quot;</span><span class="punctuation">:</span> <span class="string">&quot;centos&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;7 (Core)&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;family&quot;</span><span class="punctuation">:</span> <span class="string">&quot;redhat&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CentOS Linux&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;kernel&quot;</span><span class="punctuation">:</span> <span class="string">&quot;5.4.113-1.el7.elrepo.x86_64&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;codename&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Core&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;containerized&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;hostname&quot;</span><span class="punctuation">:</span> <span class="string">&quot;localhost.localdomain&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;agent&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;ephemeral_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xxxxx&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;hostname&quot;</span><span class="punctuation">:</span> <span class="string">&quot;localhost.localdomain&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xxxxx&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;7.3.2&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;filebeat&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h2 id="é’ˆå¯¹-json-æ ¼å¼æ—¥å¿—å¤„ç†"><a href="#é’ˆå¯¹-json-æ ¼å¼æ—¥å¿—å¤„ç†" class="headerlink" title="é’ˆå¯¹ json æ ¼å¼æ—¥å¿—å¤„ç†"></a>é’ˆå¯¹ json æ ¼å¼æ—¥å¿—å¤„ç†</h2><p>åŸå§‹æ—¥å¿—ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;@timestamp&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-15T14:15:14+08:00&quot;</span><span class="punctuation">,</span><span class="attr">&quot;server_addr&quot;</span><span class="punctuation">:</span><span class="string">&quot;1.1.1.1&quot;</span><span class="punctuation">,</span><span class="attr">&quot;remote_addr&quot;</span><span class="punctuation">:</span><span class="string">&quot;1.1.1.1&quot;</span><span class="punctuation">,</span><span class="attr">&quot;scheme&quot;</span><span class="punctuation">:</span><span class="string">&quot;https&quot;</span><span class="punctuation">,</span><span class="attr">&quot;request_method&quot;</span><span class="punctuation">:</span><span class="string">&quot;POST&quot;</span><span class="punctuation">,</span><span class="attr">&quot;request_uri&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/&quot;</span><span class="punctuation">,</span><span class="attr">&quot;request_length&quot;</span><span class="punctuation">:</span> <span class="string">&quot;25545&quot;</span><span class="punctuation">,</span><span class="attr">&quot;uri&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/&quot;</span><span class="punctuation">,</span><span class="attr">&quot;request_time&quot;</span><span class="punctuation">:</span><span class="number">0.004</span><span class="punctuation">,</span><span class="attr">&quot;body_bytes_sent&quot;</span><span class="punctuation">:</span><span class="number">833</span><span class="punctuation">,</span><span class="attr">&quot;bytes_sent&quot;</span><span class="punctuation">:</span><span class="number">1072</span><span class="punctuation">,</span><span class="attr">&quot;status&quot;</span><span class="punctuation">:</span><span class="string">&quot;200&quot;</span><span class="punctuation">,</span><span class="attr">&quot;upstream_host&quot;</span><span class="punctuation">:</span><span class="string">&quot;1.1.1.1:8084&quot;</span><span class="punctuation">,</span><span class="attr">&quot;domain&quot;</span><span class="punctuation">:</span><span class="string">&quot;a.i.com&quot;</span><span class="punctuation">,</span><span class="attr">&quot;http_referer&quot;</span><span class="punctuation">:</span><span class="string">&quot;-&quot;</span><span class="punctuation">,</span><span class="attr">&quot;http_user_agent&quot;</span><span class="punctuation">:</span><span class="string">&quot;-&quot;</span><span class="punctuation">,</span><span class="attr">&quot;http_app_id&quot;</span><span class="punctuation">:</span><span class="string">&quot;xxxxxxx&quot;</span><span class="punctuation">,</span><span class="attr">&quot;x_forwarded&quot;</span><span class="punctuation">:</span><span class="string">&quot;-&quot;</span><span class="punctuation">,</span><span class="attr">&quot;up_r_time&quot;</span><span class="punctuation">:</span><span class="string">&quot;0.003&quot;</span><span class="punctuation">,</span><span class="attr">&quot;up_status&quot;</span><span class="punctuation">:</span><span class="string">&quot;200&quot;</span><span class="punctuation">,</span><span class="attr">&quot;os_plant&quot;</span><span class="punctuation">:</span><span class="string">&quot;android&quot;</span><span class="punctuation">,</span><span class="attr">&quot;os_version&quot;</span><span class="punctuation">:</span><span class="string">&quot;11&quot;</span><span class="punctuation">,</span><span class="attr">&quot;app_version&quot;</span><span class="punctuation">:</span><span class="string">&quot;4.0.4&quot;</span><span class="punctuation">,</span><span class="attr">&quot;app_build&quot;</span><span class="punctuation">:</span><span class="string">&quot;97&quot;</span><span class="punctuation">,</span><span class="attr">&quot;guid&quot;</span><span class="punctuation">:</span><span class="string">&quot;xxxxxccb&quot;</span><span class="punctuation">,</span><span class="attr">&quot;resolution_ratio&quot;</span><span class="punctuation">:</span><span class="string">&quot;1080*2193&quot;</span><span class="punctuation">,</span><span class="attr">&quot;ip&quot;</span><span class="punctuation">:</span><span class="string">&quot;xx::xx:xx:xx:xx%dummy0&quot;</span><span class="punctuation">,</span><span class="attr">&quot;imsi&quot;</span><span class="punctuation">:</span><span class="string">&quot;xxxxx-xxxxxx&quot;</span><span class="punctuation">,</span><span class="attr">&quot;listen_port&quot;</span><span class="punctuation">:</span><span class="string">&quot;443&quot;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="æŸä¸€è¡ŒåŒ…å«-xx-å°±ä¸¢å¼ƒ"><a href="#æŸä¸€è¡ŒåŒ…å«-xx-å°±ä¸¢å¼ƒ" class="headerlink" title="æŸä¸€è¡ŒåŒ…å« xx å°±ä¸¢å¼ƒ"></a>æŸä¸€è¡ŒåŒ…å« xx å°±ä¸¢å¼ƒ</h3><p>æ¯”å¦‚æˆ‘æƒ³ä¸¢å¼ƒæ‰€æœ‰ <code>request_uri</code> ä¸º <code>/actuator/info</code> æˆ– <code>http_user_agent</code> ä¸º <code>Go-http-client/2.0</code> çš„æ—¥å¿—</p><p>filebeat.yml é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">type:</span> <span class="string">log</span></span><br><span class="line">    <span class="attr">symlinks:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">json.keys_under_root:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">json.overwrite_keys:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">json.add_error_key:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">tail_files:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">paths:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/var/log/containers/ingress-nginx-controller*.log</span></span><br><span class="line">    <span class="attr">processors:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">decode_json_fields:</span>           <span class="comment"># è§£æäºŒçº§json</span></span><br><span class="line">        <span class="attr">fields:</span> [<span class="string">&#x27;log&#x27;</span>]             <span class="comment"># ä¸€çº§jsonçš„logé”®</span></span><br><span class="line">        <span class="attr">target:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="attr">overwrite_keys:</span> <span class="literal">false</span></span><br><span class="line">        <span class="attr">process_array:</span> <span class="literal">false</span></span><br><span class="line">        <span class="attr">max_depth:</span> <span class="number">1</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">drop_event:</span></span><br><span class="line">        <span class="attr">when:</span></span><br><span class="line">            <span class="attr">or:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">regexp:</span></span><br><span class="line">                <span class="attr">http_user_agent:</span> <span class="string">&#x27;Go-http-client/2.0&#x27;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">regexp:</span></span><br><span class="line">                <span class="attr">request_uri:</span> <span class="string">&#x27;/actuator/info&#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">drop_fields:</span></span><br><span class="line">        <span class="comment"># when: å¯ä»¥è®¾ç½®å»é™¤çš„æ¡ä»¶</span></span><br><span class="line">        <span class="comment">#   condition</span></span><br><span class="line">        <span class="attr">fields:</span> [<span class="string">&quot;log&quot;</span>,<span class="string">&quot;host&quot;</span>]     <span class="comment"># è¦å»é™¤çš„å­—æ®µ</span></span><br><span class="line">        <span class="attr">ignore_missing:</span> <span class="literal">false</span></span><br><span class="line">        </span><br><span class="line">    <span class="attr">fields:</span></span><br><span class="line">    <span class="attr">log_topic:</span> <span class="string">&quot;ingress-k8s&quot;</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">&quot;ingress&quot;</span></span><br></pre></td></tr></table></figure><p>å› ä¸ºæ—¥å¿—æœ¬èº«å°±æ˜¯ä¸ª jsonï¼Œç»è¿‡ filebeat ååˆä¼šåŒ…è£…ä¸€ä¸ª jsonï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¯¹æ—¥å¿—åšäºŒçº§è§£æã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æ—¥å¿— </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Elasticsearch </tag>
            
            <tag> filebeat </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Kubernetesä¹‹masteré«˜å¯ç”¨æ–¹æ¡ˆ</title>
      <link href="/posts/10cef768/"/>
      <url>/posts/10cef768/</url>
      
        <content type="html"><![CDATA[<p>ä¹‹å‰ä¸€ç›´ç”¨ä½¿ç”¨çš„è´Ÿè½½æ–¹æ¡ˆæ˜¯æ­å»ºä¸€å°è´Ÿè½½å‡è¡¡å™¨ï¼Œå¯ä»¥æ˜¯ haproxy æˆ– nginx æˆ– lvsï¼Œæ¥å°†å¤šä¸ª master èŠ‚ç‚¹çš„ 6443 ç«¯å£åšä¸ªè´Ÿè½½å‡è¡¡ï¼Œä½†æ˜¯è€ƒè™‘åˆ°è´Ÿè½½å‡è¡¡ä¹Ÿéœ€è¦é«˜å¯ç”¨ï¼Œæ‰€ä»¥ä¼šå¼•å…¥ç±»ä¼¼ keepalived çš„æ–¹æ¡ˆæ¥è§£å†³é—®é¢˜ã€‚å¶ç„¶çœ‹åˆ°äº† kubeasz è¿™ä¸ªå¼€æºé¡¹ç›®ï¼Œå®£ç§°è§£å†³äº† master é«˜å¯ç”¨é—®é¢˜ï¼Œéƒ¨ç½²äº†ä¸€éå‘ç°å¹¶æ²¡æœ‰é¢å¤–æ­å»ºè´Ÿè½½å‡è¡¡å™¨ï¼Œç ”ç©¶äº†ä¸€ä¸‹ï¼Œå‘ç°äº†å¦ä¸€ç§æ€è·¯ã€‚</p><h2 id="ä½¿ç”¨é¢å¤–çš„è´Ÿè½½å‡è¡¡æ¥åšé«˜å¯ç”¨"><a href="#ä½¿ç”¨é¢å¤–çš„è´Ÿè½½å‡è¡¡æ¥åšé«˜å¯ç”¨" class="headerlink" title="ä½¿ç”¨é¢å¤–çš„è´Ÿè½½å‡è¡¡æ¥åšé«˜å¯ç”¨"></a>ä½¿ç”¨é¢å¤–çš„è´Ÿè½½å‡è¡¡æ¥åšé«˜å¯ç”¨</h2><p>è¿™ç§å°±æ˜¯æ¯”è¾ƒå®¹æ˜“æƒ³åˆ°çš„ä¸€ç§æ–¹æ¡ˆï¼Œæ¯”å¦‚ 3 ä¸ª master èŠ‚ç‚¹ï¼Œå‰é¢æœ‰ä¸€å°è´Ÿè½½å‡è¡¡ï¼ˆnginxã€haproxyã€lvsï¼‰ç­‰ï¼Œä½†æ˜¯è´Ÿè½½å‡è¡¡æœ¬èº«å°±æ˜¯ä¸€ä¸ªå•ç‚¹æ•…éšœï¼Œæ‰€ä»¥ä¸€èˆ¬æ¥è¯´è¿˜éœ€è¦å¦ä¸€å°è´Ÿè½½å‡è¡¡ï¼Œé€šè¿‡ keepalived æ¥å®ç° VIP çš„åˆ‡æ¢<br><a href="/posts/0cebb8ae">ä½¿ç”¨Keepalivedæ¥å®ç°Nginxé«˜å¯ç”¨</a></p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/lb_keepalived.png" alt="é’ˆå¯¹masterèŠ‚ç‚¹åšè´Ÿè½½å‡è¡¡"></p><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">ä½¿ç”¨Nginxåšè´Ÿè½½å‡è¡¡</button><button type="button" class="tab">ä½¿ç”¨HAproxyåšè´Ÿè½½å‡è¡¡</button><button type="button" class="tab">ä½¿ç”¨LVSåšè´Ÿè½½å‡è¡¡</button></div><div class="tab-contents"><div class="tab-item-content active"><p><code>vim nginx.conf</code> åœ¨æ–‡ä»¶æœ€åæ·»åŠ </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">stream &#123;</span><br><span class="line">    include stream.conf;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶å <code>vim /etc/nginx/stream.conf</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">upstream k8s-apiserver &#123;</span><br><span class="line">    server master1:6443;</span><br><span class="line">    server master2:6443;</span><br><span class="line">    server master3:6443;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">    listen 6443;</span><br><span class="line">    proxy_connect_timeout 1s;</span><br><span class="line">    proxy_pass k8s-apiserver;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">upstream ingress-http &#123;</span><br><span class="line">    server 10.0.0.21:30080;   # è¿™é‡Œéœ€è¦æ›´æ”¹æˆingressçš„NodePort</span><br><span class="line">    server 10.0.0.22:30080;   # è¿™é‡Œéœ€è¦æ›´æ”¹æˆingressçš„NodePort</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    proxy_connect_timeout 1s;</span><br><span class="line">    proxy_pass ingress-http;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">upstream ingress-https &#123;</span><br><span class="line">    server 10.0.0.21:30443;   # è¿™é‡Œéœ€è¦æ›´æ”¹æˆingressçš„NodePort</span><br><span class="line">    server 10.0.0.22:30443;   # è¿™é‡Œéœ€è¦æ›´æ”¹æˆingressçš„NodePort</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">    listen 443;</span><br><span class="line">    proxy_connect_timeout 1s;</span><br><span class="line">    proxy_pass ingress-https;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å› ä¸ºæˆ‘ä»¬ç”¨ nginx å››å±‚è´Ÿè½½ ingressï¼Œéœ€è¦ç›‘å¬ 80 ç«¯å£ï¼Œä¸ nginx é»˜è®¤çš„ç«¯å£ç›‘å¬å†²çªï¼Œæ‰€ä»¥éœ€è¦åˆ é™¤é»˜è®¤çš„é…ç½®æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">rm</span> -f /etc/nginx/sites-enabled/default</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install -y haproxy</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"># /etc/haproxy/haproxy.cfg</span><br><span class="line"># https://github.com/kubernetes/kubeadm/blob/main/docs/ha-considerations.md#options-for-software-load-balancing</span><br><span class="line">#---------------------------------------------------------------------</span><br><span class="line"># Global settings</span><br><span class="line">#---------------------------------------------------------------------</span><br><span class="line">global</span><br><span class="line">    log /dev/log local0</span><br><span class="line">    log /dev/log local1 notice</span><br><span class="line">    daemon</span><br><span class="line"></span><br><span class="line">#---------------------------------------------------------------------</span><br><span class="line"># common defaults that all the &#x27;listen&#x27; and &#x27;backend&#x27; sections will</span><br><span class="line"># use if not designated in their block</span><br><span class="line">#---------------------------------------------------------------------</span><br><span class="line">defaults</span><br><span class="line">    mode                    http</span><br><span class="line">    log                     global</span><br><span class="line">    option                  httplog</span><br><span class="line">    option                  dontlognull</span><br><span class="line">    option http-server-close</span><br><span class="line">    option forwardfor       except 127.0.0.0/8</span><br><span class="line">    option                  redispatch</span><br><span class="line">    retries                 1</span><br><span class="line">    timeout http-request    10s</span><br><span class="line">    timeout queue           20s</span><br><span class="line">    timeout connect         5s</span><br><span class="line">    timeout client          20s</span><br><span class="line">    timeout server          20s</span><br><span class="line">    timeout http-keep-alive 10s</span><br><span class="line">    timeout check           10s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#---------------------------------------------------------------------</span><br><span class="line"># apiserver frontend which proxys to the control plane nodes</span><br><span class="line">#---------------------------------------------------------------------</span><br><span class="line">frontend apiserver</span><br><span class="line">    bind *:6443</span><br><span class="line">    mode tcp</span><br><span class="line">    option tcplog</span><br><span class="line">    default_backend apiserverbackend</span><br><span class="line"></span><br><span class="line">#---------------------------------------------------------------------</span><br><span class="line"># round robin balancing for apiserver</span><br><span class="line">#---------------------------------------------------------------------</span><br><span class="line">backend apiserverbackend</span><br><span class="line">    option httpchk GET /healthz</span><br><span class="line">    http-check expect status 200</span><br><span class="line">    mode tcp</span><br><span class="line">    option ssl-hello-chk</span><br><span class="line">    balance     roundrobin</span><br><span class="line">        server master1 10.0.0.11:6443 check</span><br><span class="line">        server master2 10.0.0.12:6443 check</span><br><span class="line">        server master3 10.0.0.13:6443 check</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">frontend http_ingress_traffic_fe</span><br><span class="line">    bind :80</span><br><span class="line">    default_backend http_ingress_traffic_be</span><br><span class="line">    mode tcp</span><br><span class="line">    option tcplog</span><br><span class="line">backend http_ingress_traffic_be</span><br><span class="line">    balance source</span><br><span class="line">    mode tcp</span><br><span class="line">    server      worker1 10.0.0.21:30080 check   # è¿™é‡Œéœ€è¦æ›´æ”¹æˆingressçš„NodePort</span><br><span class="line">    server      worker2 10.0.0.22:30080 check   # è¿™é‡Œéœ€è¦æ›´æ”¹æˆingressçš„NodePort</span><br><span class="line"></span><br><span class="line">frontend https_ingress_traffic_fe</span><br><span class="line">    bind *:443</span><br><span class="line">    default_backend https_ingress_traffic_be</span><br><span class="line">    mode tcp</span><br><span class="line">    option tcplog</span><br><span class="line">backend https_ingress_traffic_be</span><br><span class="line">    balance source</span><br><span class="line">    mode tcp</span><br><span class="line">    server      worker1 10.0.0.21:30443 check   # è¿™é‡Œéœ€è¦æ›´æ”¹æˆingressçš„NodePort</span><br><span class="line">    server      worker2 10.0.0.22:30443 check   # è¿™é‡Œéœ€è¦æ›´æ”¹æˆingressçš„NodePort</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><p><a href="/posts/675d47a9/">ä½¿ç”¨keepalivedå®ŒæˆLVSé«˜å¯ç”¨</a></p></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div><h2 id="åœ¨-master-ä¸Šä½¿ç”¨-vip"><a href="#åœ¨-master-ä¸Šä½¿ç”¨-vip" class="headerlink" title="åœ¨ master ä¸Šä½¿ç”¨ vip"></a>åœ¨ master ä¸Šä½¿ç”¨ vip</h2><p>æ¶æ„å›¾å¦‚å›¾æ‰€ç¤ºï¼Œ ä½¿ç”¨ keepalived ç»´æŠ¤ vipï¼Œæ¯å° master èŠ‚ç‚¹ä¸Šéƒ½è¿è¡Œç€ä¸€ä¸ªè´Ÿè½½å‡è¡¡</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202207050032858.jpg" alt="åœ¨masterä¸Šä½¿ç”¨vip"></p><p>å¯ä»¥å‚è€ƒï¼š<a href="/posts/0cebb8ae/">ä½¿ç”¨Keepalivedæ¥å®ç°Nginxé«˜å¯ç”¨</a></p><h3 id="haproxy"><a href="#haproxy" class="headerlink" title="haproxy"></a>haproxy</h3><p>æ¯å° master éƒ½éƒ¨ç½² haproxy</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"># https://github.com/kubernetes/kubeadm/blob/main/docs/ha-considerations.md#options-for-software-load-balancing</span><br><span class="line">global</span><br><span class="line">    log /dev/log local0</span><br><span class="line">    log /dev/log local1 notice</span><br><span class="line">    daemon</span><br><span class="line"></span><br><span class="line">#---------------------------------------------------------------------</span><br><span class="line"># common defaults that all the &#x27;listen&#x27; and &#x27;backend&#x27; sections will</span><br><span class="line"># use if not designated in their block</span><br><span class="line">#---------------------------------------------------------------------</span><br><span class="line">defaults</span><br><span class="line">    mode                    http</span><br><span class="line">    log                     global</span><br><span class="line">    option                  httplog</span><br><span class="line">    option                  dontlognull</span><br><span class="line">    option http-server-close</span><br><span class="line">    option forwardfor       except 127.0.0.0/8</span><br><span class="line">    option                  redispatch</span><br><span class="line">    retries                 1</span><br><span class="line">    timeout http-request    10s</span><br><span class="line">    timeout queue           20s</span><br><span class="line">    timeout connect         5s</span><br><span class="line">    timeout client          20s</span><br><span class="line">    timeout server          20s</span><br><span class="line">    timeout http-keep-alive 10s</span><br><span class="line">    timeout check           10s</span><br><span class="line"></span><br><span class="line">#---------------------------------------------------------------------</span><br><span class="line"># apiserver frontend which proxys to the control plane nodes</span><br><span class="line">#---------------------------------------------------------------------</span><br><span class="line">frontend apiserver</span><br><span class="line">    bind *:8443</span><br><span class="line">    mode tcp</span><br><span class="line">    option tcplog</span><br><span class="line">    default_backend apiserverbackend</span><br><span class="line"></span><br><span class="line">#---------------------------------------------------------------------</span><br><span class="line"># round robin balancing for apiserver</span><br><span class="line">#---------------------------------------------------------------------</span><br><span class="line">backend apiserverbackend</span><br><span class="line">    option httpchk GET /healthz</span><br><span class="line">    http-check expect status 200</span><br><span class="line">    mode tcp</span><br><span class="line">    option ssl-hello-chk</span><br><span class="line">    balance     roundrobin</span><br><span class="line">        server master1 10.0.0.11:6443 check</span><br><span class="line">        server master2 10.0.0.12:6443 check</span><br><span class="line">        server master3 10.0.0.13:6443 check</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="master1"><a href="#master1" class="headerlink" title="master1"></a>master1</h3><p>keepalived é…ç½®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">global_defs &#123;</span><br><span class="line">    script_user root            # è„šæœ¬æ‰§è¡Œè€…</span><br><span class="line">    enable_script_security      # æ ‡è®°è„šæœ¬å®‰å…¨</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_script check_apiserver &#123;</span><br><span class="line">    script &quot;/usr/bin/curl -k https://localhost:8443/healthz&quot;      # è„šæœ¬è·¯å¾„</span><br><span class="line">    interval 3                                                    # è„šæœ¬æ‰§è¡Œé—´éš”</span><br><span class="line">    fall 2                                                        # å¤±è´¥å‡ æ¬¡è®¤ä¸ºæœ‰é—®é¢˜</span><br><span class="line">    rise 2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance VI_1 &#123;                        # å®ä¾‹å</span><br><span class="line">    state  BACKUP                           # è¿™ä¸ªæ˜¯åˆå§‹çš„çŠ¶æ€ï¼Œ MASTER æˆ–è€… BACKUPï¼Œ éæŠ¢å æ¨¡å¼å¿…é¡»ä¸º BACKUP</span><br><span class="line">    interface eth0               # ç½‘å¡</span><br><span class="line">    virtual_router_id 251                   # IDä¸»å¤‡éœ€ä¸€è‡´</span><br><span class="line">    priority 100                            # é»˜è®¤æƒé‡ï¼Œ3ä¸ªèŠ‚ç‚¹ä¿æŒä¸ä¸€è‡´ï¼Œå¹¶ä¸”MASTERæœ€å¤§ï¼Œpriorityä¹‹é—´çš„å·®å€¼è¦å°äºweight</span><br><span class="line">    nopreempt                               # è®¾ç½®éæŠ¢å æ¨¡å¼ï¼Œstateå¿…é¡»è®¾ç½®ä¸ºBACKUPæ‰èƒ½ç”Ÿæ•ˆ</span><br><span class="line"></span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS                      # ä¸»å¤‡éªŒè¯ä¿¡æ¯ï¼Œéœ€ä¸€è‡´</span><br><span class="line">        auth_pass 123456</span><br><span class="line">    &#125;</span><br><span class="line">    track_script &#123;</span><br><span class="line">        check_apiserver                     # è°ƒç”¨è„šæœ¬,è‹¥è„šæœ¬æœ€åçš„æ‰§è¡Œç»“æœæ˜¯é0çš„ï¼Œåˆ™åˆ¤æ–­ç«¯å£downæ‰ï¼Œæ­¤æ—¶vipä¼šæ¼‚ç§»åˆ°keepalived-BACKUPä¸Š</span><br><span class="line">    &#125;</span><br><span class="line">    unicast_src_ip 10.0.0.11              # é…ç½®æºåœ°å€çš„IPåœ°å€ï¼Œè‡ªå·±çš„ip</span><br><span class="line">    unicast_peer &#123;</span><br><span class="line">       10.0.0.12</span><br><span class="line">       10.0.0.13                          # é…ç½®å…¶ä»–keepalivedèŠ‚ç‚¹</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        10.0.0.10 dev eth0         # vip å’Œ ç½‘å¡</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="master2"><a href="#master2" class="headerlink" title="master2"></a>master2</h3><p>keepalived é…ç½®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">global_defs &#123;</span><br><span class="line">    script_user root</span><br><span class="line">    enable_script_security</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_script check_apiserver &#123;</span><br><span class="line">    script &quot;/usr/bin/curl -k https://localhost:8443/healthz&quot;</span><br><span class="line">    interval 3</span><br><span class="line">    fall 2</span><br><span class="line">    rise 2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">    state  BACKUP</span><br><span class="line">    interface eth0</span><br><span class="line">    virtual_router_id 251</span><br><span class="line">    priority 99</span><br><span class="line">    nopreempt</span><br><span class="line"></span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 123456</span><br><span class="line">    &#125;</span><br><span class="line">    track_script &#123;</span><br><span class="line">        check_apiserver</span><br><span class="line">    &#125;</span><br><span class="line">    unicast_src_ip 10.0.0.12</span><br><span class="line">    unicast_peer &#123;</span><br><span class="line">       10.0.0.11</span><br><span class="line">       10.0.0.13</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        10.0.0.10 dev eth0</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="master3"><a href="#master3" class="headerlink" title="master3"></a>master3</h3><p>keepalived é…ç½®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">global_defs &#123;</span><br><span class="line">    script_user root</span><br><span class="line">    enable_script_security</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_script check_apiserver &#123;</span><br><span class="line">    script &quot;/usr/bin/curl -k https://localhost:8443/healthz&quot;</span><br><span class="line">    interval 3</span><br><span class="line">    fall 2</span><br><span class="line">    rise 2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">    state  BACKUP</span><br><span class="line">    interface eth0</span><br><span class="line">    virtual_router_id 251</span><br><span class="line">    priority 98</span><br><span class="line">    nopreempt</span><br><span class="line"></span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 123456</span><br><span class="line">    &#125;</span><br><span class="line">    track_script &#123;</span><br><span class="line">        check_apiserver</span><br><span class="line">    &#125;</span><br><span class="line">    unicast_src_ip 10.0.0.13</span><br><span class="line">    unicast_peer &#123;</span><br><span class="line">       10.0.0.11</span><br><span class="line">       10.0.0.12</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        10.0.0.10 dev eth0</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šéƒ¨ç½²è´Ÿè½½å‡è¡¡"><a href="#åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šéƒ¨ç½²è´Ÿè½½å‡è¡¡" class="headerlink" title="åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šéƒ¨ç½²è´Ÿè½½å‡è¡¡"></a>åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šéƒ¨ç½²è´Ÿè½½å‡è¡¡</h2><p>æ˜¯çœ‹åˆ°äº†æœ‰äº›å¼€æºé¡¹ç›®ä¸ç”¨é¢å¤–çš„è´Ÿè½½å‡è¡¡å™¨ä¹Ÿå¯ä»¥å®Œæˆ master é«˜å¯ç”¨<br>æ–¹æ¡ˆå°±æ˜¯æ‰€æœ‰èŠ‚ç‚¹ä¸Šå®‰è£…è´Ÿè½½å‡è¡¡ï¼Œæ¶æ„å›¾å¦‚ä¸‹, ç›‘å¬çš„æ˜¯ <code>127.0.0.1:6443</code>ï¼Œæ‰€æœ‰çš„æœåŠ¡éƒ½è¿æ¥ <code>127.0.0.1:6443</code> ç«¯å£ï¼Œç„¶åè´Ÿè½½åˆ° 3 å° masterï¼Œè¿™æ ·ä¸ç”¨æ‹…å¿ƒè´Ÿè½½å‡è¡¡æŒ‚æ‰ï¼ŒæŒ‚æ‰ä¹Ÿåªä¼šå½±å“è‡ªå·±ï¼Œç¼ºç‚¹å°±æ˜¯æ¯å°æœºå™¨éƒ½éœ€è¦é¢å¤–éƒ¨ç½²æœåŠ¡ï¼Œmaster èŠ‚ç‚¹å‘ç”Ÿå˜åŒ–å, æ¯å°æœºå™¨éƒ½éœ€è¦æ›´æ–°è´Ÿè½½å‡è¡¡çš„é…ç½®ã€‚<strong>è´Ÿè½½å‡è¡¡åœ¨æ‰€æœ‰æœºå™¨ä¸Šéƒ½è¦å®‰è£…ï¼ˆåŒ…æ‹¬ worker èŠ‚ç‚¹ï¼‰</strong></p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/worker_lb.jpg" alt="åœ¨workerèŠ‚ç‚¹æ­å»ºè´Ÿè½½å‡è¡¡"></p><h3 id="å®‰è£…é›†ç¾¤çš„æ—¶å€™"><a href="#å®‰è£…é›†ç¾¤çš„æ—¶å€™" class="headerlink" title="å®‰è£…é›†ç¾¤çš„æ—¶å€™"></a>å®‰è£…é›†ç¾¤çš„æ—¶å€™</h3><p>å®‰è£…é›†ç¾¤çš„æ—¶å€™,æŒ‡å®š <code>apiserver</code> ä¸º <code>127.0.0.1:8443</code>ï¼Œç„¶åæ¯å°æœºå™¨ä¸Šéƒ½éƒ¨ç½²ä¸€ä¸ªè´Ÿè½½å‡è¡¡ï¼Œç›‘å¬ 8443 ç«¯å£ï¼Œ è½¬å‘åˆ°æ¯ä¸ª master èŠ‚ç‚¹çš„ 6443</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo kubeadm init \</span><br><span class="line">--control-plane-endpoint <span class="string">&quot;127.0.0.1:8443&quot;</span> \</span><br><span class="line">--upload-certs \</span><br><span class="line">--service-cidr=10.96.0.0/12 \</span><br><span class="line">--pod-network-cidr=10.244.0.0/16</span><br></pre></td></tr></table></figure><h3 id="é…ç½®è´Ÿè½½å‡è¡¡"><a href="#é…ç½®è´Ÿè½½å‡è¡¡" class="headerlink" title="é…ç½®è´Ÿè½½å‡è¡¡"></a>é…ç½®è´Ÿè½½å‡è¡¡</h3><p><code>Nginx</code> å’Œ <code>HAproxy</code> é€‰æ‹©ä¸€ä¸ªå°±è¡Œ, æ‰€æœ‰ master å’Œ worker èŠ‚ç‚¹éƒ½éœ€è¦éƒ¨ç½².</p><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">ä½¿ç”¨HAproxy</button><button type="button" class="tab">ä½¿ç”¨Nginx</button></div><div class="tab-contents"><div class="tab-item-content active"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">global</span><br><span class="line">        log /dev/log    local1 warning</span><br><span class="line">        chroot /var/lib/haproxy</span><br><span class="line">        user haproxy</span><br><span class="line">        group haproxy</span><br><span class="line">        daemon</span><br><span class="line">        nbproc 1</span><br><span class="line"></span><br><span class="line">defaults</span><br><span class="line">        log     global</span><br><span class="line">        timeout connect 5s</span><br><span class="line">        timeout client  10m</span><br><span class="line">        timeout server  10m</span><br><span class="line"></span><br><span class="line">listen kube_master</span><br><span class="line">        bind 127.0.0.1:8443</span><br><span class="line">        mode tcp</span><br><span class="line">        option tcplog</span><br><span class="line">        option dontlognull</span><br><span class="line">        option dontlog-normal</span><br><span class="line">        balance roundrobin</span><br><span class="line">        server 10.0.0.11 10.0.0.11:6443 check inter 10s fall 2 rise 2 weight 1</span><br><span class="line">        server 10.0.0.12 10.0.0.12:6443 check inter 10s fall 2 rise 2 weight 1</span><br><span class="line">        server 10.0.0.13 10.0.0.13:6443 check inter 10s fall 2 rise 2 weight 1</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">user root;</span><br><span class="line">worker_processes 1;</span><br><span class="line"></span><br><span class="line"># åŠ è½½æ¨¡å—</span><br><span class="line">include /usr/share/nginx/modules/*.conf;</span><br><span class="line"></span><br><span class="line">error_log  /var/log/nginx/error.log warn;</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  3000;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">stream &#123;</span><br><span class="line">    upstream backend &#123;</span><br><span class="line">        server 10.0.0.11:6443    max_fails=2 fail_timeout=3s;</span><br><span class="line">        server 10.0.0.12:6443    max_fails=2 fail_timeout=3s;</span><br><span class="line">        server 10.0.0.13:6443    max_fails=2 fail_timeout=3s;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen 127.0.0.1:8443;</span><br><span class="line">        proxy_connect_timeout 1s;</span><br><span class="line">        proxy_pass backend;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div><h3 id="å¦‚æœéœ€è¦ç”¨-6443-ç«¯å£"><a href="#å¦‚æœéœ€è¦ç”¨-6443-ç«¯å£" class="headerlink" title="å¦‚æœéœ€è¦ç”¨ 6443 ç«¯å£"></a>å¦‚æœéœ€è¦ç”¨ 6443 ç«¯å£</h3><p>master ä¸Šä¹Ÿéœ€è¦å®‰è£…è´Ÿè½½å‡è¡¡ï¼Œ apiserver é»˜è®¤ç›‘å¬çš„åœ°å€æ˜¯ <code>*:6443</code> ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨ 6443 ç«¯å£ï¼Œéœ€è¦å°† apiserver ç›‘å¬åœ°å€ä¿®æ”¹æˆ <code>&lt;ä¸»æœºIP&gt;:6443</code> è¿™æ · Nginx æ‰èƒ½ç›‘å¬ <code>127.0.0.1:6443</code>, ä¿®æ”¹æ–¹å¼ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/kubernetes/manifests/kube-apiserver.yaml</span><br></pre></td></tr></table></figure><p>å¯åŠ¨å‚æ•°å¢åŠ  <code>--bind-address=10.0.0.11</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">command:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">kube-apiserver</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--advertise-address=10.0.0.11</span></span><br><span class="line"><span class="string">...</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--bind-address=10.0.0.11</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">registry.k8s.io/kube-apiserver:v1.28.4</span></span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹ç›‘å¬ç«¯å£, æ­¤æ—¶å¯ä»¥æ­£å¸¸å¯åŠ¨ è´Ÿè½½å‡è¡¡äº†.</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202311171817270.png" alt="image.png"></p>]]></content>
      
      
      <categories>
          
          <category> å®¹å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> keepalived </tag>
            
            <tag> HA </tag>
            
            <tag> Kubernetes </tag>
            
            <tag> k8s </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Kubernetesä½¿ç”¨NFSä½œä¸ºå­˜å‚¨</title>
      <link href="/posts/179eb842/"/>
      <url>/posts/179eb842/</url>
      
        <content type="html"><![CDATA[<p>æˆ‘ä»¬ç©å•æœºçš„å®¹å™¨ï¼Œå¦‚æœéœ€è¦æŒä¹…åŒ–çš„è¯ï¼Œéœ€è¦å°†å®¹å™¨ç›®å½•æ˜ å°„åˆ°ä¸»æœºï¼Œä½†æ˜¯åœ¨ K8S ç¯å¢ƒä¸‹å®¹å™¨æ˜¯å¯èƒ½ä¼šè¢«è°ƒåº¦åˆ°ä»»æ„èŠ‚ç‚¹çš„ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨è¿œç¨‹æœåŠ¡å­˜å‚¨æ•°æ®ã€‚åœ¨äº‘å¹³å°ä¸Šéƒ½ä¼šæä¾›è‡ªå·±çš„äº‘ç›˜å­˜å‚¨ï¼Œä½†æ˜¯è‡ªå·±æ­å»ºçš„ Kubernetes æ²¡æœ‰åŠæ³•ä½¿ç”¨äº‘ç›˜åšå­˜å‚¨ï¼Œæ‰€ä»¥éœ€è¦ç”¨è‡ªå·±æ­å»ºçš„å­˜å‚¨ï¼ŒNFS æ˜¯æ¯”è¾ƒå¸¸è§çš„ä¸€ç§ï¼Œå…¶ä»–è¿˜æœ‰ glusterfsã€ceph ç­‰ã€‚</p><blockquote><p>å…³äº NFS æ­å»ºæ•™ç¨‹ï¼Œå¯ä»¥æŸ¥çœ‹<a href="https://zahui.fan/posts/4b677f68/">https://zahui.fan/posts/4b677f68/</a><br>å®¹å™¨é•œåƒå¼€æºåœ°å€<a href="https://github.com/kubernetes-sigs/nfs-subdir-external-provisioner">https://github.com/kubernetes-sigs/nfs-subdir-external-provisioner</a></p></blockquote><h2 id="å®‰è£…-NFS-client-å·¥å…·"><a href="#å®‰è£…-NFS-client-å·¥å…·" class="headerlink" title="å®‰è£… NFS client å·¥å…·"></a>å®‰è£… NFS client å·¥å…·</h2><p>æ‰€æœ‰çš„ worker èŠ‚ç‚¹ä¸Šéƒ½éœ€è¦å®‰è£… NFS client</p><ul><li><p>Ubuntu</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install nfs-common -y</span><br></pre></td></tr></table></figure></li><li><p>CentOS</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install nfs-utils -y</span><br></pre></td></tr></table></figure></li></ul><h2 id="rbac-æˆæƒ"><a href="#rbac-æˆæƒ" class="headerlink" title="rbac æˆæƒ"></a>rbac æˆæƒ</h2><p>rbac.yml</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nfs-client-provisioner</span></span><br><span class="line">  <span class="comment"># replace with namespace where provisioner is deployed</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nfs-client-provisioner-runner</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span> [<span class="string">&quot;persistentvolumes&quot;</span>]</span><br><span class="line">    <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;list&quot;</span>, <span class="string">&quot;watch&quot;</span>, <span class="string">&quot;create&quot;</span>, <span class="string">&quot;delete&quot;</span>]</span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span> [<span class="string">&quot;persistentvolumeclaims&quot;</span>]</span><br><span class="line">    <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;list&quot;</span>, <span class="string">&quot;watch&quot;</span>, <span class="string">&quot;update&quot;</span>]</span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;storage.k8s.io&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span> [<span class="string">&quot;storageclasses&quot;</span>]</span><br><span class="line">    <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;list&quot;</span>, <span class="string">&quot;watch&quot;</span>]</span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span> [<span class="string">&quot;events&quot;</span>]</span><br><span class="line">    <span class="attr">verbs:</span> [<span class="string">&quot;create&quot;</span>, <span class="string">&quot;update&quot;</span>, <span class="string">&quot;patch&quot;</span>]</span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRoleBinding</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">run-nfs-client-provisioner</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nfs-client-provisioner</span></span><br><span class="line">    <span class="comment"># replace with namespace where provisioner is deployed</span></span><br><span class="line">    <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nfs-client-provisioner-runner</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Role</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">leader-locking-nfs-client-provisioner</span></span><br><span class="line">  <span class="comment"># replace with namespace where provisioner is deployed</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span> [<span class="string">&quot;endpoints&quot;</span>]</span><br><span class="line">    <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;list&quot;</span>, <span class="string">&quot;watch&quot;</span>, <span class="string">&quot;create&quot;</span>, <span class="string">&quot;update&quot;</span>, <span class="string">&quot;patch&quot;</span>]</span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">RoleBinding</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">leader-locking-nfs-client-provisioner</span></span><br><span class="line">  <span class="comment"># replace with namespace where provisioner is deployed</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nfs-client-provisioner</span></span><br><span class="line">    <span class="comment"># replace with namespace where provisioner is deployed</span></span><br><span class="line">    <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">Role</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">leader-locking-nfs-client-provisioner</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f rbac.yml</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kubectl get sa</span><br><span class="line">NAME                     SECRETS   AGE</span><br><span class="line">default                  1         2d</span><br><span class="line">nfs-client-provisioner   1         5s</span><br></pre></td></tr></table></figure><h2 id="éƒ¨ç½²æ’ä»¶"><a href="#éƒ¨ç½²æ’ä»¶" class="headerlink" title="éƒ¨ç½²æ’ä»¶"></a>éƒ¨ç½²æ’ä»¶</h2><p>deployment.yaml</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nfs-client-provisioner</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nfs-client-provisioner</span></span><br><span class="line">  <span class="comment"># replace with namespace where provisioner is deployed</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">strategy:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">Recreate</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">nfs-client-provisioner</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">nfs-client-provisioner</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">serviceAccountName:</span> <span class="string">nfs-client-provisioner</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nfs-client-provisioner</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">registry.cn-hangzhou.aliyuncs.com/iuxt/nfs-subdir-external-provisioner:v4.0.2</span></span><br><span class="line">          <span class="attr">volumeMounts:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nfs-client-root</span></span><br><span class="line">              <span class="attr">mountPath:</span> <span class="string">/persistentvolumes</span></span><br><span class="line">          <span class="attr">env:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">PROVISIONER_NAME</span></span><br><span class="line">              <span class="comment"># å¿…é¡»ä¸class.yamlä¸­çš„provisionerçš„åç§°ä¸€è‡´</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">iuxt/nfs</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">NFS_SERVER</span></span><br><span class="line">              <span class="comment"># NFSæœåŠ¡å™¨çš„ipåœ°å€</span></span><br><span class="line">              <span class="attr">value:</span> <span class="number">10.0</span><span class="number">.0</span><span class="number">.3</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">NFS_PATH</span></span><br><span class="line">              <span class="comment"># ä¿®æ”¹ä¸ºå®é™…åˆ›å»ºçš„å…±äº«æŒ‚è½½ç›®å½•</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">/nfs</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nfs-client-root</span></span><br><span class="line">          <span class="attr">nfs:</span></span><br><span class="line">            <span class="comment"># NFSæœåŠ¡å™¨çš„ipåœ°å€</span></span><br><span class="line">            <span class="attr">server:</span> <span class="number">10.0</span><span class="number">.0</span><span class="number">.3</span></span><br><span class="line">            <span class="comment"># ä¿®æ”¹ä¸ºå®é™…åˆ›å»ºçš„å…±äº«æŒ‚è½½ç›®å½•</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/nfs</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f deployment.yml</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl get deploy</span><br><span class="line">NAME                                   READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">nfs-client-provisioner                 1/1     1            1           10s</span><br></pre></td></tr></table></figure><h2 id="åˆ›å»º-storageclass"><a href="#åˆ›å»º-storageclass" class="headerlink" title="åˆ›å»º storageclass"></a>åˆ›å»º storageclass</h2><p>storageclass.yml</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">storage.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">StorageClass</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">managed-nfs-storage</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">storageclass.kubernetes.io/is-default-class:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line"><span class="comment"># å¿…é¡»ä¸deployment.yamlä¸­çš„PROVISIONER_NAMEä¸€è‡´</span></span><br><span class="line"><span class="attr">provisioner:</span> <span class="string">iuxt/nfs</span></span><br><span class="line"><span class="attr">mountOptions:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">vers=4.1</span></span><br><span class="line"><span class="attr">parameters:</span></span><br><span class="line">  <span class="attr">archiveOnDelete:</span> <span class="string">&quot;false&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f storageclass.yml</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl get sc</span><br><span class="line">NAME                  PROVISIONER         RECLAIMPOLICY   VOLUMEBINDINGMODE   ALLOWVOLUMEEXPANSION   AGE</span><br><span class="line">managed-nfs-storage   iuxt/nfs            Delete          Immediate           <span class="literal">false</span>                  15s</span><br></pre></td></tr></table></figure><h2 id="æµ‹è¯•-NFS"><a href="#æµ‹è¯•-NFS" class="headerlink" title="æµ‹è¯• NFS"></a>æµ‹è¯• NFS</h2><p>nginx.yml</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">test-nginx</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">test-nginx</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">test-nginx</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">nginx:alpine</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/usr/share/nginx/html</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">data</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">data</span></span><br><span class="line">          <span class="attr">persistentVolumeClaim:</span></span><br><span class="line">            <span class="attr">claimName:</span> <span class="string">nfs</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolumeClaim</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"> <span class="attr">name:</span> <span class="string">nfs</span></span><br><span class="line"> <span class="attr">annotations:</span></span><br><span class="line">   <span class="attr">volume.beta.kubernetes.io/storage-class:</span> <span class="string">&quot;managed-nfs-storage&quot;</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"> <span class="attr">accessModes:</span></span><br><span class="line">   <span class="bullet">-</span> <span class="string">ReadWriteMany</span></span><br><span class="line"> <span class="attr">resources:</span></span><br><span class="line">   <span class="attr">requests:</span></span><br><span class="line">     <span class="attr">storage:</span> <span class="string">1Gi</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">test-nginx</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">test-nginx</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">test-nginx</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f nginx.yml</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨ NFS æœåŠ¡å™¨ä¸Šå¯ä»¥çœ‹åˆ°å¯¹åº”çš„ç›®å½•ï¼Œè¿›å»åˆ›å»ºä¸€ä¸ª index.html æ–‡ä»¶ï¼Œç„¶åå†è¯·æ±‚å¯¹åº”çš„å®¹å™¨ï¼Œå‘ç°å·²ç»å¯ä»¥æ­£å¸¸è¿”å›äº†ã€‚</p><h2 id="å¸¸è§é—®é¢˜"><a href="#å¸¸è§é—®é¢˜" class="headerlink" title="å¸¸è§é—®é¢˜"></a>å¸¸è§é—®é¢˜</h2><h3 id="PVC-ä¸€ç›´å¤„äº-Pending-çŠ¶æ€"><a href="#PVC-ä¸€ç›´å¤„äº-Pending-çŠ¶æ€" class="headerlink" title="PVC ä¸€ç›´å¤„äº Pending çŠ¶æ€"></a>PVC ä¸€ç›´å¤„äº Pending çŠ¶æ€</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kubectl describe pvc</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‘ç°æŠ¥é”™</span></span><br><span class="line">  Normal  ExternalProvisioning  8s (x2 over 13s)  persistentvolume-controller  waiting <span class="keyword">for</span> a volume to be created, either by external provisioner <span class="string">&quot;qgg-nfs-storage&quot;</span> or manually created by system administrator</span><br></pre></td></tr></table></figure><blockquote><p>å¦‚æœä½ æ˜¯ä½¿ç”¨çš„è¿™ä¸ªé•œåƒ <code>image: quay.io/external_storage/nfs-client-provisioner:latest</code> è¿™ä¸ªé•œåƒæ˜¯è€é•œåƒäº†ï¼Œ1.20 åŠä»¥ä¸Šç‰ˆæœ¬çš„ K8S ä¼šæŠ¥é”™ï¼Œè¿™æ˜¯å› ä¸º Kubernetes v1.20 å¼€å§‹ï¼Œé»˜è®¤åˆ é™¤äº† &gt; <code>metadata.selfLink</code> å­—æ®µï¼Œç„¶è€Œï¼Œéƒ¨åˆ†åº”ç”¨ä»ç„¶ä¾èµ–äºè¿™ä¸ªå­—æ®µï¼Œä¾‹å¦‚ <code>nfs-client-provisioner</code>ã€‚å¦‚æœä»ç„¶è¦ç»§ç»­ä½¿ç”¨è¿™äº›åº”ç”¨ï¼Œæ‚¨å°†éœ€è¦é‡æ–°å¯ç”¨è¯¥å­—æ®µã€‚<br>é€šè¿‡é…ç½® apiserver å¯åŠ¨å‚æ•°ä¸­çš„ <code>--feature-gates</code> ä¸­çš„ <code>RemoveSelfLink=false</code>ï¼Œå¯ä»¥é‡æ–°å¯ç”¨ <code>metadata.selfLink</code> å­—æ®µã€‚<br>å…·ä½“æ¥è¯´ï¼Œå¦‚æœæ‚¨ä½¿ç”¨ kubeadm å®‰è£… Kubernetesï¼Œè¯·ä¿®æ”¹ <code>/etc/kubernetes/manifests/kube-apiserver.yaml</code> æ–‡ä»¶ï¼Œå¹¶åœ¨å…¶å¯åŠ¨å‚æ•°ä¸­å¢åŠ ä¸€è¡Œ <code>- --feature-gates=RemoveSelfLink=false</code></p></blockquote><p>åœ¨æ‰€æœ‰çš„ Master èŠ‚ç‚¹ä¸Šä¿®æ”¹é…ç½®</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">kubeadm.kubernetes.io/kube-apiserver.advertise-address.endpoint:</span> <span class="number">10.0</span><span class="number">.0</span><span class="number">.11</span><span class="string">:6443</span></span><br><span class="line">  <span class="attr">creationTimestamp:</span> <span class="literal">null</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">component:</span> <span class="string">kube-apiserver</span></span><br><span class="line">    <span class="attr">tier:</span> <span class="string">control-plane</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kube-apiserver</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">command:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">kube-apiserver</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--advertise-address=10.0.0.11</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--allow-privileged=true</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--authorization-mode=Node,RBAC</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--client-ca-file=/etc/kubernetes/pki/ca.crt</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--enable-admission-plugins=NodeRestriction</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--enable-bootstrap-token-auth=true</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--etcd-cafile=/etc/kubernetes/pki/etcd/ca.crt</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--etcd-certfile=/etc/kubernetes/pki/apiserver-etcd-client.crt</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--etcd-keyfile=/etc/kubernetes/pki/apiserver-etcd-client.key</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--etcd-servers=https://127.0.0.1:2379</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--insecure-port=0</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--kubelet-client-certificate=/etc/kubernetes/pki/apiserver-kubelet-client.crt</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--kubelet-client-key=/etc/kubernetes/pki/apiserver-kubelet-client.key</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--proxy-client-cert-file=/etc/kubernetes/pki/front-proxy-client.crt</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--proxy-client-key-file=/etc/kubernetes/pki/front-proxy-client.key</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--requestheader-allowed-names=front-proxy-client</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--requestheader-client-ca-file=/etc/kubernetes/pki/front-proxy-ca.crt</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--requestheader-extra-headers-prefix=X-Remote-Extra-</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--requestheader-group-headers=X-Remote-Group</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--requestheader-username-headers=X-Remote-User</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--secure-port=6443</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--service-account-issuer=https://kubernetes.default.svc.cluster.local</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--service-account-key-file=/etc/kubernetes/pki/sa.pub</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--service-account-signing-key-file=/etc/kubernetes/pki/sa.key</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--service-cluster-ip-range=10.96.0.0/12</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--tls-cert-file=/etc/kubernetes/pki/apiserver.crt</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--tls-private-key-file=/etc/kubernetes/pki/apiserver.key</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--feature-gates=RemoveSelfLink=false</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">k8s.gcr.io/kube-apiserver:v1.21.10</span></span><br><span class="line">    <span class="string">...</span></span><br></pre></td></tr></table></figure><p>æˆ–è€…æ›´æ¢é•œåƒä¸º <code>k8s.gcr.io/sig-storage/nfs-subdir-external-provisioner:v4.0.2</code>ï¼Œå›½å†…åŠ é€Ÿé•œåƒä¸ºï¼š<code>registry.cn-hangzhou.aliyuncs.com/iuxt/nfs-subdir-external-provisioner:v4.0.2</code></p>]]></content>
      
      
      <categories>
          
          <category> å®¹å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NFS </tag>
            
            <tag> å­˜å‚¨ </tag>
            
            <tag> Kubernetes </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Kubernetesä¹‹ingress-nginxå®‰è£…é…ç½®</title>
      <link href="/posts/30bdb1c5/"/>
      <url>/posts/30bdb1c5/</url>
      
        <content type="html"><![CDATA[<h2 id="éƒ¨ç½²-ingress-nginx"><a href="#éƒ¨ç½²-ingress-nginx" class="headerlink" title="éƒ¨ç½² ingress-nginx"></a>éƒ¨ç½² ingress-nginx</h2><blockquote><p>ingress-nginx å®˜æ–¹æ–‡æ¡£ <a href="https://kubernetes.github.io/ingress-nginx/deploy/#bare-metal-clusters">https://kubernetes.github.io/ingress-nginx/deploy/#bare-metal-clusters</a><br>è‡ªå»ºçš„ Kubernetes å¯ä»¥å‚æ•° <code>bare-metal</code> å®‰è£…</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.1.2/deploy/static/provider/baremetal/deploy.yaml</span><br></pre></td></tr></table></figure><p>éƒ¨ç½²æˆåŠŸåä¿®æ”¹ NodePort,æŠŠé‡Œé¢ 30xxx çš„ç«¯å£æ¢æˆä½ æƒ³è¦çš„ç«¯å£</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl edit service ingress-nginx-controller -n ingress-nginx</span><br></pre></td></tr></table></figure><blockquote><p>ä¹Ÿå¯ä»¥ <code>wget https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.1.2/deploy/static/provider/baremetal/deploy.yaml</code> å†ç¼–è¾‘</p></blockquote><p>åœ¨</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># Source: ingress-nginx/templates/controller-service.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">helm.sh/chart:</span> <span class="string">ingress-nginx-4.0.7</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/name:</span> <span class="string">ingress-nginx</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/instance:</span> <span class="string">ingress-nginx</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/version:</span> <span class="number">1.0</span><span class="number">.5</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/managed-by:</span> <span class="string">Helm</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/component:</span> <span class="string">controller</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ingress-nginx-controller</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">ingress-nginx</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">NodePort</span></span><br><span class="line">  <span class="attr">ipFamilyPolicy:</span> <span class="string">SingleStack</span></span><br><span class="line">  <span class="attr">ipFamilies:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">IPv4</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">http</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">      <span class="attr">nodePort:</span> <span class="number">30080</span></span><br><span class="line">      <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="string">http</span></span><br><span class="line">      <span class="attr">appProtocol:</span> <span class="string">http</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">https</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">443</span></span><br><span class="line">      <span class="attr">nodePort:</span> <span class="number">30443</span></span><br><span class="line">      <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="string">https</span></span><br><span class="line">      <span class="attr">appProtocol:</span> <span class="string">https</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/name:</span> <span class="string">ingress-nginx</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/instance:</span> <span class="string">ingress-nginx</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/component:</span> <span class="string">controller</span></span><br><span class="line"><span class="meta">---</span></span><br></pre></td></tr></table></figure><blockquote><p>å½“ç„¶ä¹Ÿå¯ä»¥ä¸åšä»¥ä¸Šä¿®æ”¹ï¼Œä¸ä¿®æ”¹çš„è¯ä¼šè‡ªåŠ¨åœ¨ 30000~32767 è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªï¼Œéœ€è¦æŠŠè‡ªåŠ¨ç”Ÿæˆçš„ç«¯å£é…ç½®åˆ°è´Ÿè½½å‡è¡¡å™¨ä¸Šã€‚</p></blockquote><h2 id="é€šè¿‡-daemonset-æ–¹å¼å®‰è£…"><a href="#é€šè¿‡-daemonset-æ–¹å¼å®‰è£…" class="headerlink" title="é€šè¿‡ daemonset æ–¹å¼å®‰è£…"></a>é€šè¿‡ daemonset æ–¹å¼å®‰è£…</h2><p>é€šè¿‡ daemonset å®‰è£…ä¸€èˆ¬æ¥è¯´éƒ½æ˜¯ä»¥ hostnetwork æ–¹å¼æ¥ï¼Œç›´æ¥ç›‘å¬ node èŠ‚ç‚¹ä¸Šçš„ 80ã€443 ç«¯å£<br>å°†ä¸Šè¿° yaml ä¸­ deployment çš„éƒ¨åˆ†æ¢æˆ daemonset éƒ¨ç½²</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">DaemonSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">helm.sh/chart:</span> <span class="string">ingress-nginx-3.39.0</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/name:</span> <span class="string">ingress-nginx</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/instance:</span> <span class="string">ingress-nginx</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/version:</span> <span class="number">0.49</span><span class="number">.3</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/managed-by:</span> <span class="string">Helm</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/component:</span> <span class="string">controller</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ingress-nginx-controller</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">ingress-nginx</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app.kubernetes.io/name:</span> <span class="string">ingress-nginx</span></span><br><span class="line">      <span class="attr">app.kubernetes.io/instance:</span> <span class="string">ingress-nginx</span></span><br><span class="line">      <span class="attr">app.kubernetes.io/component:</span> <span class="string">controller</span></span><br><span class="line">  <span class="attr">revisionHistoryLimit:</span> <span class="number">10</span></span><br><span class="line">  <span class="attr">minReadySeconds:</span> <span class="number">0</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app.kubernetes.io/name:</span> <span class="string">ingress-nginx</span></span><br><span class="line">        <span class="attr">app.kubernetes.io/instance:</span> <span class="string">ingress-nginx</span></span><br><span class="line">        <span class="attr">app.kubernetes.io/component:</span> <span class="string">controller</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">controller</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">k8s.gcr.io/ingress-nginx/controller:v0.49.3@sha256:35fe394c82164efa8f47f3ed0be981b3f23da77175bbb8268a9ae438851c8324</span></span><br><span class="line">          <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">          <span class="attr">lifecycle:</span></span><br><span class="line">            <span class="attr">preStop:</span></span><br><span class="line">              <span class="attr">exec:</span></span><br><span class="line">                <span class="attr">command:</span></span><br><span class="line">                  <span class="bullet">-</span> <span class="string">/wait-shutdown</span></span><br><span class="line">          <span class="attr">args:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">/nginx-ingress-controller</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">--publish-service=$(POD_NAMESPACE)/ingress-nginx-controller</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">--election-id=ingress-controller-leader</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">--ingress-class=nginx</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">--configmap=$(POD_NAMESPACE)/ingress-nginx-controller</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">--validating-webhook=:8443</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">--validating-webhook-certificate=/usr/local/certificates/cert</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">--validating-webhook-key=/usr/local/certificates/key</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">--default-backend-service=$(POD_NAMESPACE)/ingress-nginx-default-backend</span></span><br><span class="line">          <span class="attr">securityContext:</span></span><br><span class="line">            <span class="attr">capabilities:</span></span><br><span class="line">              <span class="attr">drop:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">ALL</span></span><br><span class="line">              <span class="attr">add:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">NET_BIND_SERVICE</span></span><br><span class="line">            <span class="attr">runAsUser:</span> <span class="number">101</span></span><br><span class="line">            <span class="attr">allowPrivilegeEscalation:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">env:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">POD_NAME</span></span><br><span class="line">              <span class="attr">valueFrom:</span></span><br><span class="line">                <span class="attr">fieldRef:</span></span><br><span class="line">                  <span class="attr">fieldPath:</span> <span class="string">metadata.name</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">POD_NAMESPACE</span></span><br><span class="line">              <span class="attr">valueFrom:</span></span><br><span class="line">                <span class="attr">fieldRef:</span></span><br><span class="line">                  <span class="attr">fieldPath:</span> <span class="string">metadata.namespace</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">LD_PRELOAD</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">/usr/local/lib/libmimalloc.so</span></span><br><span class="line">          <span class="attr">livenessProbe:</span></span><br><span class="line">            <span class="attr">failureThreshold:</span> <span class="number">5</span></span><br><span class="line">            <span class="attr">httpGet:</span></span><br><span class="line">              <span class="attr">path:</span> <span class="string">/healthz</span></span><br><span class="line">              <span class="attr">port:</span> <span class="number">10254</span></span><br><span class="line">              <span class="attr">scheme:</span> <span class="string">HTTP</span></span><br><span class="line">            <span class="attr">initialDelaySeconds:</span> <span class="number">10</span></span><br><span class="line">            <span class="attr">periodSeconds:</span> <span class="number">10</span></span><br><span class="line">            <span class="attr">successThreshold:</span> <span class="number">1</span></span><br><span class="line">            <span class="attr">timeoutSeconds:</span> <span class="number">1</span></span><br><span class="line">          <span class="attr">readinessProbe:</span></span><br><span class="line">            <span class="attr">failureThreshold:</span> <span class="number">3</span></span><br><span class="line">            <span class="attr">httpGet:</span></span><br><span class="line">              <span class="attr">path:</span> <span class="string">/healthz</span></span><br><span class="line">              <span class="attr">port:</span> <span class="number">10254</span></span><br><span class="line">              <span class="attr">scheme:</span> <span class="string">HTTP</span></span><br><span class="line">            <span class="attr">initialDelaySeconds:</span> <span class="number">10</span></span><br><span class="line">            <span class="attr">periodSeconds:</span> <span class="number">10</span></span><br><span class="line">            <span class="attr">successThreshold:</span> <span class="number">1</span></span><br><span class="line">            <span class="attr">timeoutSeconds:</span> <span class="number">1</span></span><br><span class="line">          <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">prometheus</span></span><br><span class="line">              <span class="attr">containerPort:</span> <span class="number">10254</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">http</span></span><br><span class="line">              <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">              <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">https</span></span><br><span class="line">              <span class="attr">containerPort:</span> <span class="number">443</span></span><br><span class="line">              <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">webhook</span></span><br><span class="line">              <span class="attr">containerPort:</span> <span class="number">8443</span></span><br><span class="line">              <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">          <span class="attr">volumeMounts:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">timezone</span></span><br><span class="line">              <span class="attr">mountPath:</span> <span class="string">/etc/localtime</span>                           <span class="comment"># æŒ‚è½½åˆ°å®¹å™¨çš„ç›®å½•</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">webhook-cert</span></span><br><span class="line">              <span class="attr">mountPath:</span> <span class="string">/usr/local/certificates/</span></span><br><span class="line">              <span class="attr">readOnly:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">resources:</span></span><br><span class="line">            <span class="attr">requests:</span></span><br><span class="line">              <span class="attr">cpu:</span> <span class="string">100m</span></span><br><span class="line">              <span class="attr">memory:</span> <span class="string">90Mi</span></span><br><span class="line">      <span class="comment"># è¿™é‡Œä¿®æ”¹ä¸ºhostNetwork</span></span><br><span class="line">      <span class="attr">hostNetwork:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">dnsPolicy:</span> <span class="string">ClusterFirstWithHostNet</span></span><br><span class="line"></span><br><span class="line">      <span class="attr">tolerations:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">&quot;apptype&quot;</span></span><br><span class="line">        <span class="attr">operator:</span> <span class="string">&quot;Exists&quot;</span></span><br><span class="line">        <span class="attr">effect:</span> <span class="string">&quot;NoSchedule&quot;</span></span><br><span class="line"></span><br><span class="line">      <span class="attr">nodeSelector:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">ingress</span></span><br><span class="line">        <span class="attr">kubernetes.io/os:</span> <span class="string">linux</span></span><br><span class="line">      <span class="attr">serviceAccountName:</span> <span class="string">ingress-nginx</span></span><br><span class="line">      <span class="attr">terminationGracePeriodSeconds:</span> <span class="number">300</span></span><br><span class="line"></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">timezone</span></span><br><span class="line">          <span class="attr">hostPath:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/usr/share/zoneinfo/Asia/Shanghai</span>            <span class="comment"># å®¿ä¸»æœºçš„ç›®å½•</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">webhook-cert</span></span><br><span class="line">          <span class="attr">secret:</span></span><br><span class="line">            <span class="attr">secretName:</span> <span class="string">ingress-nginx-admission</span></span><br><span class="line"><span class="meta">---</span></span><br></pre></td></tr></table></figure><h2 id="ingress-nginx-å¸¸è§é—®é¢˜"><a href="#ingress-nginx-å¸¸è§é—®é¢˜" class="headerlink" title="ingress-nginx å¸¸è§é—®é¢˜"></a>ingress-nginx å¸¸è§é—®é¢˜</h2><ol><li><p>é…ç½®äº† ingressï¼Œä½†æ˜¯æ‰“å¼€ 404 æŠ¥é”™ï¼š<br>æŸ¥çœ‹ deployment é‡Œé¢çš„ ingress-nginx æ—¥å¿—ï¼Œå‘ç°æŠ¥é”™ï¼š</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;Ignoring ingress because of error while validating ingress class&quot; ingress=&quot;cattle-system/rancher&quot; error=&quot;ingress does not contain a valid IngressClass&quot; </span><br></pre></td></tr></table></figure><p> è¿™ç§æƒ…å†µæ˜¯ ingress æ²¡æœ‰æŒ‡å®š ingress controller, æ·»åŠ  ingress æ³¨è§£ï¼š</p> <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">kubernetes.io/ingress.class:</span> <span class="string">nginx</span></span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      <categories>
          
          <category> å®¹å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nginx </tag>
            
            <tag> ingress </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hugoåšå®¢æ‰¹é‡æ›´æ¢urlç»“æ„</title>
      <link href="/posts/b75ec1fe/"/>
      <url>/posts/b75ec1fe/</url>
      
        <content type="html"><![CDATA[<p>ä¹‹å‰ä¿®æ”¹è¿‡ hugo çš„ url ç»“æ„ï¼Œconfig.toml å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Permalinks]</span></span><br><span class="line">  <span class="attr">posts</span> = <span class="string">&quot;:slug&quot;</span></span><br></pre></td></tr></table></figure><p>ç”Ÿæˆçš„ URL ç±»ä¼¼äºï¼š<a href="https://zahui.fan/a7c8660c/">https://zahui.fan/a7c8660c/</a> ä¸è¿‡è¿™æ ·éšç€æ–‡ä»¶è¶Šæ¥è¶Šå¤šï¼Œå‘å¸ƒç”¨çš„ä»“åº“æ ¹ç›®å½•æ–‡ä»¶å¤¹ä¹Ÿè¶Šæ¥è¶Šå¤šï¼Œä¸å¥½çœ‹ï¼Œå†åŠ ä¸ŠåŸŸåååŠ ä¸Šå…‰ç§ƒç§ƒçš„æ— æ„ä¹‰çš„å­—ç¬¦ä¸²ä¹Ÿä¸ä¼˜é›…ï¼Œæ‰€ä»¥å†³å®šæ”¹æˆ<a href="https://zahui.fan/posts/a7c8660c/">https://zahui.fan/posts/a7c8660c/</a>è¿™æ ·çš„åŸŸåç»“æ„ã€‚</p><h2 id="ä¿®æ”¹-config-toml"><a href="#ä¿®æ”¹-config-toml" class="headerlink" title="ä¿®æ”¹ config.toml"></a>ä¿®æ”¹ config.toml</h2><p>æˆ‘ä»¬éœ€è¦ä¿®æ”¹ config.tomlï¼Œæ”¹å˜é»˜è®¤çš„ url ç»“æ„</p><figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Permalinks]</span></span><br><span class="line">  <span class="attr">posts</span> = <span class="string">&quot;/posts/:slug&quot;</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·é‡æ–°ç”Ÿæˆåšå®¢ï¼Œurl è·¯å¾„å°±ä¼šå˜æˆæ–°çš„äº†</p><h2 id="é…ç½®è‡ªåŠ¨è·³è½¬"><a href="#é…ç½®è‡ªåŠ¨è·³è½¬" class="headerlink" title="é…ç½®è‡ªåŠ¨è·³è½¬"></a>é…ç½®è‡ªåŠ¨è·³è½¬</h2><p>è¿™æ ·é…ç½®çš„è¯ï¼Œä¹‹å‰çš„ url è¿æ¥å°±ä¼šå…¨éƒ¨ 404 äº†ï¼Œå¯¹äºåšäº† SEO çš„åŒå­¦æ¥è¯´å°±æ˜¯ä¸ªç¾éš¾ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åšä¸ªè·³è½¬</p><p>åœ¨ frontmatter æ·»åŠ  aliasesï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">title:</span> <span class="string">&quot;å®‰è£…å’Œé…ç½®sambaå…±äº«&quot;</span></span><br><span class="line"><span class="attr">date:</span> <span class="number">2022-02-11T11:18:21+08:00</span></span><br><span class="line"><span class="attr">abbrlink:</span> <span class="string">a7c8660c</span></span><br><span class="line"></span><br><span class="line"><span class="attr">aliases:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">/a7c8660c/</span></span><br><span class="line"><span class="attr">typora-root-url:</span> <span class="string">../../static</span></span><br><span class="line"><span class="attr">typora-copy-images-to:</span> <span class="string">../../static/img</span></span><br><span class="line"><span class="attr">categories:</span> [<span class="string">&quot;Operations&quot;</span>]</span><br><span class="line"><span class="attr">tags:</span> [<span class="string">&quot;samba&quot;</span>, <span class="string">&quot;é…ç½®è®°å½•&quot;</span>]</span><br><span class="line"><span class="meta">---</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·æ¯æ¬¡è®¿é—®<a href="https://zahui.fan/a7c8660c/">https://zahui.fan/a7c8660c/</a>å°±ä¼šè‡ªåŠ¨è·³è½¬åˆ°<a href="https://zahui.fan/posts/a7c8660c/">https://zahui.fan/posts/a7c8660c/</a></p><h2 id="è‡ªåŠ¨æ›¿æ¢è„šæœ¬"><a href="#è‡ªåŠ¨æ›¿æ¢è„šæœ¬" class="headerlink" title="è‡ªåŠ¨æ›¿æ¢è„šæœ¬"></a>è‡ªåŠ¨æ›¿æ¢è„šæœ¬</h2><p>å†™äº†ä¸ªè„šæœ¬å¯ä»¥æ‰¹é‡ç»™ md æ–‡ä»¶æ·»åŠ  aliases:ï¼Œè„šæœ¬å’Œ md æ–‡ä»¶æ”¾åœ¨ä¸€èµ·</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">IFS=$<span class="string">&#x27;\n&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(<span class="built_in">ls</span> *.md):</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  slug=$(grep <span class="string">&quot;^slug:&quot;</span> <span class="variable">$i</span> | <span class="built_in">head</span> -1 | sed <span class="string">&quot;s/slug://g&quot;</span> | sed <span class="string">&quot;s/ //g&quot;</span>)</span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$i</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$slug</span></span><br><span class="line">  sed -i <span class="string">&quot;5a aliases:\n  - /<span class="variable">$slug</span>/&quot;</span> <span class="variable">$i</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Blog </tag>
            
            <tag> hugo </tag>
            
            <tag> markdown </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux Shell è‡ªåŠ¨è¡¥å…¨</title>
      <link href="/posts/7ce4e1fc/"/>
      <url>/posts/7ce4e1fc/</url>
      
        <content type="html"><![CDATA[<p>ä¸€ç›´ä½¿ç”¨ kubectl æ“ä½œ k8s é›†ç¾¤ï¼Œæ¯æ¬¡éƒ½éœ€è¦æŸ¥çœ‹ pod åå­—ã€æŸ¥çœ‹ service åå­—ç­‰ï¼Œæ¯”è¾ƒéº»çƒ¦ï¼Œçœ‹äº† kubectl å®˜æ–¹å°±æ”¯æŒ bash è‡ªåŠ¨è¡¥å…¨ï¼Œæ‰€ä»¥è®°å½•ä¸€ä¸‹ã€‚</p><p>å®˜æ–¹æ–‡æ¡£åœ°å€ï¼š<a href="https://kubernetes.io/zh/docs/tasks/tools/included/optional-kubectl-configs-bash-linux/">https://kubernetes.io/zh/docs/tasks/tools/included/optional-kubectl-configs-bash-linux/</a></p><p>æœ¬æ–‡ä»¥ Ubuntu20.04 ä¸‹çš„ kubectl ä¸ºä¾‹</p><h2 id="Bash-è‡ªåŠ¨è¡¥å…¨"><a href="#Bash-è‡ªåŠ¨è¡¥å…¨" class="headerlink" title="Bash è‡ªåŠ¨è¡¥å…¨"></a>Bash è‡ªåŠ¨è¡¥å…¨</h2><p>kubectl çš„ Bash è¡¥å…¨è„šæœ¬å¯ä»¥ç”¨å‘½ä»¤ kubectl completion bash ç”Ÿæˆã€‚ åœ¨ shell ä¸­å¯¼å…¥ï¼ˆSourcingï¼‰è¡¥å…¨è„šæœ¬ï¼Œå°†å¯ç”¨ kubectl è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½ã€‚</p><p>ç„¶è€Œï¼Œè¡¥å…¨è„šæœ¬ä¾èµ–äºå·¥å…· <code>bash-completion</code>ï¼Œ æ‰€ä»¥è¦å…ˆå®‰è£…å®ƒï¼ˆå¯ä»¥ç”¨å‘½ä»¤ <code>type _init_completion</code> æ£€æŸ¥ <code>bash-completion</code> æ˜¯å¦å·²å®‰è£…ï¼‰ã€‚</p><h3 id="å®‰è£…-bash-completion"><a href="#å®‰è£…-bash-completion" class="headerlink" title="å®‰è£… bash-completion"></a>å®‰è£… bash-completion</h3><p>å¾ˆå¤šåŒ…ç®¡ç†å·¥å…·å‡æ”¯æŒ bash-completionã€‚ å¯ä»¥é€šè¿‡ <code>apt-get install bash-completion</code> æˆ– <code>yum install bash-completion</code> ç­‰å‘½ä»¤æ¥å®‰è£…å®ƒã€‚</p><p>ä¸Šè¿°å‘½ä»¤å°†åˆ›å»ºæ–‡ä»¶ <code>/usr/share/bash-completion/bash_completion</code>ï¼Œå®ƒæ˜¯ bash-completion çš„ä¸»è„šæœ¬ã€‚ ä¾æ®åŒ…ç®¡ç†å·¥å…·çš„å®é™…æƒ…å†µï¼Œä½ éœ€è¦åœ¨ ~&#x2F;.bashrc æ–‡ä»¶ä¸­æ‰‹å·¥å¯¼å…¥æ­¤æ–‡ä»¶ã€‚</p><blockquote><p>ç”¨æˆ·çº§å’Œç³»ç»Ÿçº§äºŒé€‰ä¸€ï¼Œç”¨æˆ·çº§è¡¨ç¤ºç³»ç»Ÿå†…æ‰€æœ‰ç”¨æˆ·éƒ½ç”Ÿæ•ˆï¼Œç”¨æˆ·çº§åªå¯¹å½“å‰ç”¨æˆ·ç”Ÿæ•ˆ</p></blockquote><h3 id="ç”¨æˆ·çº§åˆ«å¼€å¯-bash-completion"><a href="#ç”¨æˆ·çº§åˆ«å¼€å¯-bash-completion" class="headerlink" title="ç”¨æˆ·çº§åˆ«å¼€å¯ bash_completion"></a>ç”¨æˆ·çº§åˆ«å¼€å¯ bash_completion</h3><p>åœ¨ <code>~/.bashrc</code> æœ€åé¢æ·»åŠ ä¸¤è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> /usr/share/bash-completion/bash_completion</span><br><span class="line"><span class="built_in">source</span> &lt;(kubectl completion bash)</span><br></pre></td></tr></table></figure><h3 id="ç³»ç»Ÿå±‚çº§å¼€å¯-bash-completion"><a href="#ç³»ç»Ÿå±‚çº§å¼€å¯-bash-completion" class="headerlink" title="ç³»ç»Ÿå±‚çº§å¼€å¯ bash_completion"></a>ç³»ç»Ÿå±‚çº§å¼€å¯ bash_completion</h3><p>æŠŠ <code>/etc/bash.bashrc</code> å¦‚ä¸‹å‡ è¡Œçš„æ³¨é‡Šå–æ¶ˆ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># enable bash completion in interactive shells</span></span><br><span class="line"><span class="keyword">if</span> ! <span class="built_in">shopt</span> -oq posix; <span class="keyword">then</span></span><br><span class="line">  <span class="keyword">if</span> [ -f /usr/share/bash-completion/bash_completion ]; <span class="keyword">then</span></span><br><span class="line">    . /usr/share/bash-completion/bash_completion</span><br><span class="line">  <span class="keyword">elif</span> [ -f /etc/bash_completion ]; <span class="keyword">then</span></span><br><span class="line">    . /etc/bash_completion</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><p>bash-completion è´Ÿè´£å¯¼å…¥ <code>/etc/bash_completion.d</code> ç›®å½•ä¸­çš„æ‰€æœ‰è¡¥å…¨è„šæœ¬ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl completion bash | sudo <span class="built_in">tee</span> /etc/bash_completion.d/kubectl &gt; /dev/null</span><br></pre></td></tr></table></figure><h3 id="å…³è”-kubectl-åˆ«å"><a href="#å…³è”-kubectl-åˆ«å" class="headerlink" title="å…³è” kubectl åˆ«å"></a>å…³è” kubectl åˆ«å</h3><p>å¦‚æœ kubectl æœ‰å…³è”çš„åˆ«åï¼Œä½ å¯ä»¥æ‰©å±• shell è¡¥å…¨æ¥é€‚é…æ­¤åˆ«åï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;alias k=kubectl&#x27;</span> &gt;&gt;~/.bashrc</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;complete -F __start_kubectl k&#x27;</span> &gt;&gt;~/.bashrc</span><br></pre></td></tr></table></figure><h2 id="ZSH-è‡ªåŠ¨è¡¥å…¨"><a href="#ZSH-è‡ªåŠ¨è¡¥å…¨" class="headerlink" title="ZSH è‡ªåŠ¨è¡¥å…¨"></a>ZSH è‡ªåŠ¨è¡¥å…¨</h2><p>kubectl é€šè¿‡å‘½ä»¤ kubectl completion zsh ç”Ÿæˆ Zsh è‡ªåŠ¨è¡¥å…¨è„šæœ¬ã€‚ åœ¨ shell ä¸­å¯¼å…¥ï¼ˆSourcingï¼‰è¯¥è‡ªåŠ¨è¡¥å…¨è„šæœ¬ï¼Œå°†å¯åŠ¨ kubectl è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½ã€‚</p><p>ä¸ºäº†åœ¨æ‰€æœ‰çš„ shell ä¼šè¯ä¸­å®ç°æ­¤åŠŸèƒ½ï¼Œè¯·å°†ä¸‹é¢å†…å®¹åŠ å…¥åˆ°æ–‡ä»¶ <code>~/.zshrc</code> ä¸­ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> &lt;(kubectl completion zsh)</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ ä¸º kubectl å®šä¹‰äº†åˆ«åï¼Œå¯ä»¥æ‰©å±•è„šæœ¬è¡¥å…¨ï¼Œä»¥å…¼å®¹è¯¥åˆ«åã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;alias k=kubectl&#x27;</span> &gt;&gt;~/.zshrc</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;compdef __start_kubectl k&#x27;</span> &gt;&gt;~/.zshrc</span><br></pre></td></tr></table></figure><p>é‡æ–°åŠ è½½ shell åï¼Œkubectl è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½å°†ç«‹å³ç”Ÿæ•ˆã€‚</p><p>å¦‚æœä½ æ”¶åˆ° <code>complete:13: command not found: compdef</code> è¿™æ ·çš„é”™è¯¯æç¤ºï¼Œé‚£è¯·å°†ä¸‹é¢å†…å®¹æ·»åŠ åˆ° <code>~/.zshrc</code> æ–‡ä»¶çš„å¼€å¤´ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">autoload</span> -Uz compinit</span><br><span class="line">compinit</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> kubectl </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nginxä½¿ç”¨module_vtsæ¨¡å—æ¥åšç›‘æ§</title>
      <link href="/posts/c6a32841/"/>
      <url>/posts/c6a32841/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘æˆ‘ä»¬æƒ³è¦ç”¨ Prometheus æ¥ç›‘æ§ Nginx çš„çŠ¶æ€ï¼Œæ‰€ä»¥çœ‹äº†ä¸€ä¸‹æœ‰ä¸ª module å¯ä»¥æ”¯æŒã€‚é¡¹ç›®åœ°å€åœ¨ï¼š<a href="https://github.com/vozlt/nginx-module-vts.git">https://github.com/vozlt/nginx-module-vts.git</a></p><h2 id="é‡æ–°ç¼–è¯‘-Nginx"><a href="#é‡æ–°ç¼–è¯‘-Nginx" class="headerlink" title="é‡æ–°ç¼–è¯‘ Nginx"></a>é‡æ–°ç¼–è¯‘ Nginx</h2><p>é¦–å…ˆæ‰§è¡Œ nginx -V æŸ¥çœ‹ç¼–è¯‘å‚æ•°ï¼Œè®°å½•ä¸€ä¸‹, æ¯”å¦‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--prefix=/usr/local/nginx --user=www --group=www --with-stream --with-http_stub_status_module --with-http_sub_module --with-http_v2_module --with-http_ssl_module --with-http_gzip_static_module --with-http_realip_module --with-http_flv_module --with-http_mp4_module --with-openssl=../openssl-1.1.1k --with-pcre=../pcre-8.45 --with-pcre-jit --with-ld-opt=-ljemalloc</span><br></pre></td></tr></table></figure><p>ç„¶åéœ€è¦ Nginx æºç åŒ…å’Œå½“å‰å®‰è£…çš„ Nginx ç‰ˆæœ¬ç›¸åŒ</p><p>ä¸‹è½½ nginx_module_vts</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> git://github.com/vozlt/nginx-module-vts.git</span><br></pre></td></tr></table></figure><p>è¿›å…¥ nginx æºç ç›®å½•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> nginx-1.20.2</span><br></pre></td></tr></table></figure><p>å¼€å§‹ç¼–è¯‘ï¼Œç¼–è¯‘æ—¶å¢åŠ ä¸€æ¡å‚æ•°</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--add-module=../nginx-module-vts</span><br></pre></td></tr></table></figure><p>ç»“åˆä¸Šé¢è®°å½•çš„ç¼–è¯‘å‚æ•°ï¼Œå®Œæ•´çš„ç¼–è¯‘å‚æ•°æ˜¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./configure --prefix=/usr/local/nginx --user=www --group=www --with-stream --with-http_stub_status_module --with-http_sub_module --with-http_v2_module --with-http_ssl_module --with-http_gzip_static_module --with-http_realip_module --with-http_flv_module --with-http_mp4_module --with-openssl=../openssl-1.1.1k --with-pcre=../pcre-8.45 --with-pcre-jit --with-ld-opt=-ljemalloc --add-module=../nginx-module-vts</span><br></pre></td></tr></table></figure><p>å¼€å§‹ç¼–è¯‘</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make</span><br></pre></td></tr></table></figure><p>ç„¶åå°†ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶æ–‡ä»¶æ›¿æ¢ç°æœ‰çš„ nginx</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> /data/server/nginx-1.20.2/objs/nginx /usr/local/nginx/sbin/nginx</span><br></pre></td></tr></table></figure><p>æ³¨ï¼šnginx-module-vts æ¨¡å—ä» 0.1.17+ ç‰ˆæœ¬ä¹‹ååŸç”Ÿæ”¯æŒ prometheus æ•°æ®æ ¼å¼ï¼Œå¯è·³è¿‡ nginx-vts-exporter çš„å®‰è£…ã€‚</p><blockquote><p>ä¹‹å‰æ²¡å®‰è£…è¿‡ nginx çš„å¯ä»¥ç›´æ¥ <code>make &amp;&amp; make install</code></p></blockquote><h2 id="å¼€å¯ç›‘æ§"><a href="#å¼€å¯ç›‘æ§" class="headerlink" title="å¼€å¯ç›‘æ§"></a>å¼€å¯ç›‘æ§</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># åœ¨ http å’Œ server å—ä¸­åŠ å…¥å¦‚ä¸‹ä¿¡æ¯</span><br><span class="line">http &#123;</span><br><span class="line">    vhost_traffic_status_zone;</span><br><span class="line">    ...</span><br><span class="line">    server &#123;</span><br><span class="line">        ...</span><br><span class="line">        location /metrics &#123;</span><br><span class="line">            vhost_traffic_status_display;</span><br><span class="line">            vhost_traffic_status_display_format prometheus;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç›‘æ§æ¥å£ä¸ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">æ”¯æŒçš„è¾“å‡ºæ ¼å¼æœ‰json htmlå’Œ Prometheus</span><br><span class="line"></span><br><span class="line">localhost/metrics</span><br><span class="line">localhost/metrics/format/json</span><br><span class="line">localhost/metrics/format/prometheus</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Nginx </tag>
            
            <tag> Monitor </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ­£åˆ™è¡¨è¾¾å¼å…¥é—¨</title>
      <link href="/posts/13612574/"/>
      <url>/posts/13612574/</url>
      
        <content type="html"><![CDATA[<p>åœ¨çº¿æµ‹è¯•æ­£åˆ™è¡¨è¾¾å¼: <a href="https://c.runoob.com/front-end/854/">https://c.runoob.com/front-end/854/</a></p><h2 id="å­—ç¬¦åŒ¹é…"><a href="#å­—ç¬¦åŒ¹é…" class="headerlink" title="å­—ç¬¦åŒ¹é…"></a>å­—ç¬¦åŒ¹é…</h2><p>æ™®é€šå­—ç¬¦ï¼šæ™®é€šå­—ç¬¦æŒ‰ç…§å­—é¢æ„ä¹‰è¿›è¡ŒåŒ¹é…ï¼Œä¾‹å¦‚åŒ¹é…å­—æ¯ â€œaâ€ å°†åŒ¹é…åˆ°æ–‡æœ¬ä¸­çš„ â€œaâ€ å­—ç¬¦ã€‚</p><p>å…ƒå­—ç¬¦ï¼šå…ƒå­—ç¬¦å…·æœ‰ç‰¹æ®Šçš„å«ä¹‰ï¼Œä¾‹å¦‚ \d åŒ¹é…ä»»æ„æ•°å­—å­—ç¬¦ï¼Œ\w åŒ¹é…ä»»æ„å­—æ¯æ•°å­—å­—ç¬¦ï¼Œ. åŒ¹é…ä»»æ„å­—ç¬¦ï¼ˆé™¤äº†æ¢è¡Œç¬¦ï¼‰ç­‰ã€‚</p><h2 id="é‡è¯"><a href="#é‡è¯" class="headerlink" title="é‡è¯"></a>é‡è¯</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">*ï¼šåŒ¹é…å‰é¢çš„æ¨¡å¼é›¶æ¬¡æˆ–å¤šæ¬¡ã€‚</span><br><span class="line">+ï¼šåŒ¹é…å‰é¢çš„æ¨¡å¼ä¸€æ¬¡æˆ–å¤šæ¬¡ã€‚</span><br><span class="line">?ï¼šåŒ¹é…å‰é¢çš„æ¨¡å¼é›¶æ¬¡æˆ–ä¸€æ¬¡ã€‚</span><br><span class="line">&#123;n&#125;ï¼šåŒ¹é…å‰é¢çš„æ¨¡å¼æ°å¥½ n æ¬¡ã€‚</span><br><span class="line">&#123;n,&#125;ï¼šåŒ¹é…å‰é¢çš„æ¨¡å¼è‡³å°‘ n æ¬¡ã€‚</span><br><span class="line">&#123;n,m&#125;ï¼šåŒ¹é…å‰é¢çš„æ¨¡å¼è‡³å°‘ n æ¬¡ä¸”ä¸è¶…è¿‡ m æ¬¡ã€‚</span><br></pre></td></tr></table></figure><h2 id="å­—ç¬¦ç±»"><a href="#å­—ç¬¦ç±»" class="headerlink" title="å­—ç¬¦ç±»"></a>å­—ç¬¦ç±»</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[ ]ï¼šåŒ¹é…æ‹¬å·å†…çš„ä»»æ„ä¸€ä¸ªå­—ç¬¦ã€‚ä¾‹å¦‚ï¼Œ[abc] åŒ¹é…å­—ç¬¦ <span class="string">&quot;a&quot;</span>ã€<span class="string">&quot;b&quot;</span> æˆ– <span class="string">&quot;c&quot;</span>ã€‚</span><br><span class="line">[^ ]ï¼šåŒ¹é…é™¤äº†æ‹¬å·å†…çš„å­—ç¬¦ä»¥å¤–çš„ä»»æ„ä¸€ä¸ªå­—ç¬¦ã€‚ä¾‹å¦‚ï¼Œ[^abc] åŒ¹é…é™¤äº†å­—ç¬¦ <span class="string">&quot;a&quot;</span>ã€<span class="string">&quot;b&quot;</span> æˆ– <span class="string">&quot;c&quot;</span> ä»¥å¤–çš„ä»»æ„å­—ç¬¦ã€‚</span><br></pre></td></tr></table></figure><h2 id="è¾¹ç•ŒåŒ¹é…"><a href="#è¾¹ç•ŒåŒ¹é…" class="headerlink" title="è¾¹ç•ŒåŒ¹é…"></a>è¾¹ç•ŒåŒ¹é…</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">^ï¼šåŒ¹é…å­—ç¬¦ä¸²çš„å¼€å¤´ã€‚</span><br><span class="line">$ï¼šåŒ¹é…å­—ç¬¦ä¸²çš„ç»“å°¾ã€‚</span><br><span class="line">\bï¼šåŒ¹é…å•è¯è¾¹ç•Œã€‚</span><br><span class="line">\Bï¼šåŒ¹é…éå•è¯è¾¹ç•Œã€‚</span><br></pre></td></tr></table></figure><h2 id="åˆ†ç»„å’Œæ•è·"><a href="#åˆ†ç»„å’Œæ•è·" class="headerlink" title="åˆ†ç»„å’Œæ•è·"></a>åˆ†ç»„å’Œæ•è·</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">( )ï¼šç”¨äºåˆ†ç»„å’Œæ•è·å­è¡¨è¾¾å¼ã€‚</span><br><span class="line">(?: )ï¼šç”¨äºåˆ†ç»„ä½†ä¸æ•è·å­è¡¨è¾¾å¼ã€‚</span><br></pre></td></tr></table></figure><h2 id="ç‰¹æ®Šå­—ç¬¦"><a href="#ç‰¹æ®Šå­—ç¬¦" class="headerlink" title="ç‰¹æ®Šå­—ç¬¦"></a>ç‰¹æ®Šå­—ç¬¦</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">\ï¼šè½¬ä¹‰å­—ç¬¦ï¼Œç”¨äºåŒ¹é…ç‰¹æ®Šå­—ç¬¦æœ¬èº«ã€‚</span><br><span class="line">.ï¼šåŒ¹é…ä»»æ„å­—ç¬¦ï¼ˆé™¤äº†æ¢è¡Œç¬¦ï¼‰ã€‚</span><br><span class="line">|ï¼šç”¨äºæŒ‡å®šå¤šä¸ªæ¨¡å¼çš„é€‰æ‹©ã€‚</span><br></pre></td></tr></table></figure><h2 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h2><p>æ¯”å¦‚åšç”¨æˆ·åéªŒè¯:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">^[0-9a-z_-]&#123;3,15&#125;$</span><br></pre></td></tr></table></figure><p>å­—æ¯ a-z æ•°å­— 0-9 ä¸‹åˆ’çº¿ ä¸­åˆ’çº¿ ç»“å°¾</p>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
            <tag> regexp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ansibleç³»åˆ—ä¹‹æ¡ä»¶åˆ¤æ–­</title>
      <link href="/posts/a361f259/"/>
      <url>/posts/a361f259/</url>
      
        <content type="html"><![CDATA[<p>åœ¨ ansible ä¸­ï¼Œä½¿ç”¨ when å…³é”®å­—æ¥åšæ¡ä»¶åˆ¤æ–­ï¼Œwhen å…³é”®å­—å³ä¸ºå½“æ¡ä»¶æˆåŠŸå°±æ‰§è¡Œæ­¤æ¡ä»»åŠ¡ã€‚åœ¨ when åˆ¤æ–­ä¸­ä¸éœ€è¦åŠ  <code>&#123;&#123;&#125;&#125;</code></p><h2 id="å­—ç¬¦ä¸²åˆ¤æ–­"><a href="#å­—ç¬¦ä¸²åˆ¤æ–­" class="headerlink" title="å­—ç¬¦ä¸²åˆ¤æ–­"></a>å­—ç¬¦ä¸²åˆ¤æ–­</h2><table><thead><tr><th>åˆ¤æ–­ç¬¦</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>&#x3D;&#x3D;</td><td>åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦ç›¸åŒï¼Œç›¸åŒä¸ºçœŸï¼Œä¸åŒä¸ºå‡</td></tr><tr><td>lower</td><td>æ˜¯å¦å…¨æ˜¯å°å†™ï¼Œæ˜¯ä¸ºçœŸï¼Œä¸æ˜¯ä¸ºå‡</td></tr><tr><td>upper</td><td>æ˜¯å¦æ˜¯çº¯å¤§å†™ï¼Œæ˜¯ä¸ºçœŸï¼Œä¸æ˜¯ä¸ºå‡</td></tr><tr><td>in</td><td>åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦åœ¨å¦ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­ï¼Œæ˜¯ä¸ºçœŸï¼Œä¸æ˜¯ä¸ºå‡</td></tr></tbody></table><h3 id="åˆ¤æ–­ç³»ç»Ÿ-ä¸æ”¯æŒçš„ç³»ç»Ÿç›´æ¥æŠ¥é”™é€€å‡º"><a href="#åˆ¤æ–­ç³»ç»Ÿ-ä¸æ”¯æŒçš„ç³»ç»Ÿç›´æ¥æŠ¥é”™é€€å‡º" class="headerlink" title="åˆ¤æ–­ç³»ç»Ÿ,ä¸æ”¯æŒçš„ç³»ç»Ÿç›´æ¥æŠ¥é”™é€€å‡º"></a>åˆ¤æ–­ç³»ç»Ÿ,ä¸æ”¯æŒçš„ç³»ç»Ÿç›´æ¥æŠ¥é”™é€€å‡º</h3><blockquote><p>ansible_distribution æ˜¯ ansible è‡ªå¸¦å˜é‡ï¼ŒæŸ¥çœ‹å˜é‡å¯ä»¥ç”¨ <code>ansible localhost -m setup</code> å‘½ä»¤ã€‚</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">all</span></span><br><span class="line">    <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">fail:</span> <span class="string">msg=&quot;this</span> <span class="string">playbook</span> <span class="string">don&#x27;t</span> <span class="string">support</span> <span class="string">CentOS&quot;</span></span><br><span class="line">      <span class="attr">when:</span> <span class="string">ansible_distribution</span> <span class="string">==</span> <span class="string">&quot;CentOS&quot;</span></span><br></pre></td></tr></table></figure><h3 id="åˆ¤æ–­å­—ç¬¦ä¸²å¤§å°å†™"><a href="#åˆ¤æ–­å­—ç¬¦ä¸²å¤§å°å†™" class="headerlink" title="åˆ¤æ–­å­—ç¬¦ä¸²å¤§å°å†™"></a>åˆ¤æ–­å­—ç¬¦ä¸²å¤§å°å†™</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">all</span></span><br><span class="line">  <span class="attr">vars:</span></span><br><span class="line">    <span class="attr">str1:</span> <span class="string">&quot;abc&quot;</span></span><br><span class="line">    <span class="attr">str2:</span> <span class="string">&quot;ABC&quot;</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">      <span class="attr">msg:</span> <span class="string">&quot;This string is all lowercase&quot;</span></span><br><span class="line">    <span class="attr">when:</span> <span class="string">str1</span> <span class="string">is</span> <span class="string">lower</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">      <span class="attr">msg:</span> <span class="string">&quot;This string is all uppercase&quot;</span></span><br><span class="line">    <span class="attr">when:</span> <span class="string">str2</span> <span class="string">is</span> <span class="string">upper</span></span><br></pre></td></tr></table></figure><h3 id="åˆ¤æ–­å­—ç¬¦ä¸²çš„åŒ…å«å…³ç³»"><a href="#åˆ¤æ–­å­—ç¬¦ä¸²çš„åŒ…å«å…³ç³»" class="headerlink" title="åˆ¤æ–­å­—ç¬¦ä¸²çš„åŒ…å«å…³ç³»"></a>åˆ¤æ–­å­—ç¬¦ä¸²çš„åŒ…å«å…³ç³»</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">tasks:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">check</span> <span class="string">wsl</span></span><br><span class="line">    <span class="attr">fail:</span> <span class="string">msg=&quot;this</span> <span class="string">playbook</span> <span class="string">don&#x27;t</span> <span class="string">support</span> <span class="string">wsl&quot;</span></span><br><span class="line">    <span class="attr">when:</span> <span class="string">&#x27;WSL&#x27;</span> <span class="string">in</span> <span class="string">ansible_kernel</span></span><br></pre></td></tr></table></figure><h2 id="è¿ç®—ç¬¦åˆ¤æ–­"><a href="#è¿ç®—ç¬¦åˆ¤æ–­" class="headerlink" title="è¿ç®—ç¬¦åˆ¤æ–­"></a>è¿ç®—ç¬¦åˆ¤æ–­</h2><p>åœ¨ ansible ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ¯”è¾ƒè¿ç®—ç¬¦ï¼š</p><table><thead><tr><th>æ¯”è¾ƒè¿ç®—ç¬¦</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>&#x3D;&#x3D;</td><td>æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸ç­‰ï¼Œç›¸ç­‰ä¸ºçœŸ</td></tr><tr><td>!&#x3D;</td><td>æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ä¸ç­‰ï¼Œä¸ç­‰ä¸ºçœŸ</td></tr><tr><td>&gt;</td><td>æ¯”è¾ƒä¸¤ä¸ªå€¼çš„å¤§å°ï¼Œå¦‚æœå·¦è¾¹çš„å€¼å¤§äºå³è¾¹çš„å€¼ï¼Œåˆ™ä¸ºçœŸ</td></tr><tr><td>&lt;</td><td>æ¯”è¾ƒä¸¤ä¸ªå€¼çš„å¤§å°ï¼Œå¦‚æœå·¦è¾¹çš„å€¼å°äºå³è¾¹çš„å€¼ï¼Œåˆ™ä¸ºçœŸ</td></tr><tr><td>&gt;&#x3D;</td><td>æ¯”è¾ƒä¸¤ä¸ªå€¼çš„å¤§å°ï¼Œå¦‚æœå·¦è¾¹çš„å€¼å¤§äºå³è¾¹çš„å€¼æˆ–å·¦å³ç›¸ç­‰ï¼Œåˆ™ä¸ºçœŸ</td></tr><tr><td>&lt;&#x3D;</td><td>æ¯”è¾ƒä¸¤ä¸ªå€¼çš„å¤§å°ï¼Œå¦‚æœå·¦è¾¹çš„å€¼å°äºå³è¾¹çš„å€¼æˆ–å·¦å³ç›¸ç­‰ï¼Œåˆ™ä¸ºçœŸ</td></tr></tbody></table><p>æˆ‘ä»¬æ€»ç»“çš„è¿™äº›è¿ç®—ç¬¦å…¶å®éƒ½æ˜¯ jinja2 çš„è¿ç®—ç¬¦ï¼Œansible ä½¿ç”¨ jinja2 æ¨¡æ¿å¼•æ“ï¼Œåœ¨ ansible ä¸­ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ jinja2 çš„è¿™äº›è¿ç®—ç¬¦ã€‚</p><p>è¯´å®Œäº†æ¯”è¾ƒè¿ç®—ç¬¦ï¼Œå†æ¥è¯´è¯´é€»è¾‘è¿ç®—ç¬¦ï¼Œå¯ç”¨çš„é€»è¾‘è¿ç®—ç¬¦å¦‚ä¸‹</p><table><thead><tr><th>é€»è¾‘è¿ç®—ç¬¦</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>and</td><td>é€»è¾‘ä¸ï¼Œå½“å·¦è¾¹ä¸å³è¾¹åŒæ—¶ä¸ºçœŸï¼Œåˆ™è¿”å›çœŸ</td></tr><tr><td>or</td><td>é€»è¾‘æˆ–ï¼Œå½“å·¦è¾¹ä¸å³è¾¹æœ‰ä»»æ„ä¸€ä¸ªä¸ºçœŸï¼Œåˆ™è¿”å›çœŸ</td></tr><tr><td>not</td><td>å–åï¼Œå¯¹ä¸€ä¸ªæ“ä½œä½“å–å</td></tr><tr><td>( )</td><td>ç»„åˆï¼Œå°†ä¸€ç»„æ“ä½œä½“åŒ…è£…åœ¨ä¸€èµ·ï¼Œå½¢æˆä¸€ä¸ªè¾ƒå¤§çš„æ“ä½œä½“</td></tr></tbody></table><p>ä¾‹ 1ï¼šè¾“å‡ºå¤§äº 2 çš„æ•°å­—ã€‚</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">all</span></span><br><span class="line">  <span class="attr">gather_facts:</span> <span class="literal">no</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">      <span class="attr">var:</span> <span class="string">item</span></span><br><span class="line">    <span class="attr">when:</span> <span class="string">item</span> <span class="string">&gt;</span> <span class="number">2</span></span><br><span class="line">    <span class="attr">with_items:</span> [ <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span> ]</span><br></pre></td></tr></table></figure><p>ä¾‹ 2ï¼šåˆ¤æ–­å®¢æˆ·æœºç³»ç»Ÿæ˜¯å¦æ˜¯ CentOS 7ã€‚</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">all</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">      <span class="attr">msg:</span> <span class="string">&quot;System release is centos7&quot;</span></span><br><span class="line">    <span class="attr">when:</span> <span class="string">ansible_distribution</span> <span class="string">==</span> <span class="string">&quot;CentOS&quot;</span> <span class="string">and</span> <span class="string">ansible_distribution_major_version</span> <span class="string">==</span> <span class="string">&quot;7&quot;</span></span><br></pre></td></tr></table></figure><blockquote><p>è¿™é‡Œçš„ when æ¡ä»¶ä¹Ÿå¯å†™ä¸ºå¦‚ä¸‹ï¼š</p>  <figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">when:</span></span><br><span class="line"> <span class="bullet">-</span> <span class="string">ansible_distribution</span> <span class="string">==</span> <span class="string">&quot;CentOS&quot;</span></span><br><span class="line"> <span class="bullet">-</span> <span class="string">ansible_distribution_major_version</span> <span class="string">==</span> <span class="string">&quot;7&quot;</span></span><br></pre></td></tr></table></figure><p>å…¶å«ä¹‰ä¸ºåˆ—è¡¨ä¸­æ¯ä¸€é¡¹ç»“æœéƒ½ä¸º true æ—¶æ‰æ‰§è¡Œã€‚</p></blockquote><p>ä¾‹ 3ï¼šåˆ¤æ–­ä»»åŠ¡æ˜¯å¦æˆåŠŸæ‰§è¡Œã€‚</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">localhost</span></span><br><span class="line">  <span class="attr">gather_facts:</span> <span class="literal">no</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">check</span> <span class="string">folder</span> <span class="string">exists</span></span><br><span class="line">    <span class="attr">shell:</span> <span class="string">&quot;ls /test_folder&quot;</span></span><br><span class="line">    <span class="attr">register:</span> <span class="string">check_test_folder</span></span><br><span class="line">    <span class="attr">ignore_errors:</span> <span class="literal">true</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">      <span class="attr">msg:</span> <span class="string">&quot;Command execution successful&quot;</span></span><br><span class="line">    <span class="attr">when:</span> <span class="string">check_test_folder.rc</span> <span class="string">==</span> <span class="number">0</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">      <span class="attr">msg:</span> <span class="string">&quot;Command execution failed&quot;</span></span><br><span class="line">    <span class="attr">when:</span> <span class="string">check_test_folder.rc</span> <span class="type">!=</span> <span class="number">0</span></span><br></pre></td></tr></table></figure><p>ä¾‹ 4ï¼šåˆ¤æ–­ç³»ç»Ÿæ˜¯ Ubuntu æˆ– LinuxMint ä¸”ä¸æ˜¯è™šæ‹Ÿæœº</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">install</span> <span class="string">gui</span> <span class="string">tools</span> <span class="string">on</span> <span class="string">ubuntu</span></span><br><span class="line">  <span class="attr">apt:</span> </span><br><span class="line">    <span class="attr">name:</span> [<span class="string">&quot;copyq&quot;</span>, <span class="string">&quot;flameshot&quot;</span>]</span><br><span class="line">    <span class="attr">state:</span> <span class="string">latest</span></span><br><span class="line">    <span class="attr">update_cache:</span> <span class="literal">no</span></span><br><span class="line">  <span class="attr">become:</span> <span class="literal">yes</span></span><br><span class="line">  <span class="attr">when:</span></span><br><span class="line">    <span class="string">(</span> <span class="string">ansible_distribution</span> <span class="string">==</span> <span class="string">&quot;Ubuntu&quot;</span> <span class="string">or</span> <span class="string">ansible_distribution</span> <span class="string">==</span> <span class="string">&quot;Linux Mint&quot;</span> <span class="string">)</span></span><br><span class="line">    <span class="string">and</span></span><br><span class="line">    <span class="string">(</span> <span class="string">ansible_virtualization_role</span> <span class="type">!=</span> <span class="string">&quot;guest&quot;</span> <span class="string">)</span></span><br></pre></td></tr></table></figure><h2 id="æ–‡ä»¶åˆ¤æ–­"><a href="#æ–‡ä»¶åˆ¤æ–­" class="headerlink" title="æ–‡ä»¶åˆ¤æ–­"></a>æ–‡ä»¶åˆ¤æ–­</h2><h3 id="åˆ¤æ–­-Ansible-æ§åˆ¶ä¸»æœºçš„æ–‡ä»¶"><a href="#åˆ¤æ–­-Ansible-æ§åˆ¶ä¸»æœºçš„æ–‡ä»¶" class="headerlink" title="åˆ¤æ–­ Ansible æ§åˆ¶ä¸»æœºçš„æ–‡ä»¶"></a>åˆ¤æ–­ Ansible æ§åˆ¶ä¸»æœºçš„æ–‡ä»¶</h3><p>ansible å¯é€šè¿‡å¦‚ä¸‹å…³é”®å­—å¯¹æ–‡ä»¶çŠ¶æ€è¿›è¡Œåˆ¤æ–­ï¼š</p><table><thead><tr><th>åˆ¤æ–­æ“ä½œ</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>file</td><td>åˆ¤æ–­è·¯å¾„æ˜¯å¦æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œå¦‚æœè·¯å¾„æ˜¯ä¸€ä¸ªæ–‡ä»¶åˆ™è¿”å›çœŸï¼›</td></tr><tr><td>directory</td><td>åˆ¤æ–­è·¯å¾„æ˜¯å¦æ˜¯ä¸€ä¸ªç›®å½•ï¼Œå¦‚æœè·¯å¾„æ˜¯ä¸€ä¸ªç›®å½•åˆ™è¿”å›çœŸï¼›</td></tr><tr><td>link</td><td>åˆ¤æ–­è·¯å¾„æ˜¯å¦æ˜¯ä¸€ä¸ªè½¯é“¾æ¥ï¼Œå¦‚æœè·¯å¾„æ˜¯ä¸€ä¸ªè½¯é“¾æ¥åˆ™è¿”å›çœŸï¼›</td></tr><tr><td>mount</td><td>åˆ¤æ–­è·¯å¾„æ˜¯å¦æ˜¯ä¸€ä¸ªæŒ‚è½½ç‚¹ï¼Œå¦‚æœè·¯å¾„æ˜¯ä¸€ä¸ªæŒ‚è½½ç‚¹åˆ™è¿”å›çœŸï¼›</td></tr><tr><td>exists</td><td>åˆ¤æ–­è·¯å¾„æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœè·¯å¾„å­˜åœ¨åˆ™è¿”å›çœŸï¼›</td></tr></tbody></table><p>ä¾‹ï¼šåˆ¤æ–­ &#x2F;test_folder æ˜¯å¦å­˜åœ¨ã€‚</p><blockquote><p>è¿™é‡Œåˆ¤æ–­çš„è·¯å¾„æ˜¯ ansible æ§åˆ¶ä¸»æœºçš„è·¯å¾„</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">all</span></span><br><span class="line">  <span class="attr">gather_facts:</span> <span class="literal">no</span></span><br><span class="line">  <span class="attr">vars:</span></span><br><span class="line">    <span class="attr">testpath:</span> <span class="string">/test_folder</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">      <span class="attr">msg:</span> <span class="string">&quot;file exists&quot;</span></span><br><span class="line">    <span class="attr">when:</span> <span class="string">testpath</span> <span class="string">is</span> <span class="string">exists</span></span><br><span class="line">  <span class="comment"># ä¸‹é¢åˆ¤æ–­è¡¨ç¤º testpath è·¯å¾„æ˜¯å¦ä¸å­˜åœ¨</span></span><br><span class="line">  <span class="comment"># when: testpath is not exists</span></span><br></pre></td></tr></table></figure><h3 id="åˆ¤æ–­è¢«æ§æœºå™¨çš„æ–‡ä»¶çŠ¶æ€"><a href="#åˆ¤æ–­è¢«æ§æœºå™¨çš„æ–‡ä»¶çŠ¶æ€" class="headerlink" title="åˆ¤æ–­è¢«æ§æœºå™¨çš„æ–‡ä»¶çŠ¶æ€"></a>åˆ¤æ–­è¢«æ§æœºå™¨çš„æ–‡ä»¶çŠ¶æ€</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">get</span> <span class="string">file</span> <span class="string">stat</span> <span class="string">for</span> <span class="string">gpg</span> <span class="string">key</span></span><br><span class="line">  <span class="attr">stat:</span> <span class="string">path=/usr/share/keyrings/docker-archive-keyring.gpg</span></span><br><span class="line">  <span class="attr">register:</span> <span class="string">vscode_gpg_key</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ¤æ–­è¿œç¨‹æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">add</span> <span class="string">gpg</span> <span class="string">key</span></span><br><span class="line">  <span class="attr">shell:</span></span><br><span class="line">    <span class="attr">cmd:</span> <span class="string">curl</span> <span class="string">-fsSL</span> <span class="string">https://download.docker.com/linux/ubuntu/gpg</span> <span class="string">|</span> <span class="string">gpg</span> <span class="string">--dearmor</span> <span class="string">-o</span> <span class="string">/usr/share/keyrings/docker-archive-keyring.gpg</span></span><br><span class="line">  <span class="attr">become:</span> <span class="literal">yes</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">not</span> <span class="string">vscode_gpg_key.stat.exists</span></span><br></pre></td></tr></table></figure><h2 id="å˜é‡åˆ¤æ–­"><a href="#å˜é‡åˆ¤æ–­" class="headerlink" title="å˜é‡åˆ¤æ–­"></a>å˜é‡åˆ¤æ–­</h2><p>ansible å¯é€šè¿‡å¦‚ä¸‹å‡ ä¸ªå…³é”®å­—å¯¹å˜é‡è¿›è¡Œåˆ¤æ–­ï¼š</p><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>string</td><td>åˆ¤æ–­å¯¹è±¡æ˜¯å¦æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ˜¯å­—ç¬¦ä¸²åˆ™è¿”å›çœŸï¼›</td></tr><tr><td>number</td><td>åˆ¤æ–­å¯¹è±¡æ˜¯å¦æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œæ˜¯æ•°å­—åˆ™è¿”å›çœŸï¼›</td></tr><tr><td>defined</td><td>åˆ¤æ–­å˜é‡æ˜¯å¦å·²ç»å®šä¹‰ï¼Œå·²ç»å®šä¹‰åˆ™è¿”å›çœŸï¼›</td></tr><tr><td>undefind</td><td>åˆ¤æ–­å˜é‡æ˜¯å¦å·²ç»å®šä¹‰ï¼Œæœªå®šä¹‰åˆ™è¿”å›çœŸï¼›</td></tr><tr><td>none</td><td>åˆ¤æ–­å˜é‡å€¼æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœå˜é‡å·²ç»å®šä¹‰ï¼Œä½†æ˜¯å˜é‡å€¼ä¸ºç©ºï¼Œåˆ™è¿”å›çœŸï¼›</td></tr></tbody></table><p>ä¾‹ 1ï¼šå½“å¯¹åº”çš„æ¡ä»¶ä¸ºçœŸæ—¶ï¼Œä½ å¯ä»¥çœ‹åˆ° debug æ¨¡å—å¯¹åº”çš„è¾“å‡ºã€‚</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">all</span></span><br><span class="line">  <span class="attr">gather_facts:</span> <span class="literal">no</span></span><br><span class="line">  <span class="attr">vars:</span></span><br><span class="line">    <span class="attr">defined_var:</span> <span class="string">&quot;test&quot;</span></span><br><span class="line">    <span class="attr">none_var:</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">      <span class="attr">msg:</span> <span class="string">&quot;Variable is defined&quot;</span></span><br><span class="line">    <span class="attr">when:</span> <span class="string">defined_var</span> <span class="string">is</span> <span class="string">defined</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">      <span class="attr">msg:</span> <span class="string">&quot;Variable is undefined&quot;</span></span><br><span class="line">    <span class="attr">when:</span> <span class="string">undefined_var</span> <span class="string">is</span> <span class="string">undefined</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">      <span class="attr">msg:</span> <span class="string">&quot;The variable is defined, but there is no value&quot;</span></span><br><span class="line">    <span class="attr">when:</span> <span class="string">none_var</span> <span class="string">is</span> <span class="string">none</span></span><br></pre></td></tr></table></figure><p>ä¾‹ 2ï¼šåˆ¤æ–­ç»™å®šå˜é‡æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²è¿˜æ˜¯æ•°å­—ã€‚</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">all</span></span><br><span class="line">  <span class="attr">gather_facts:</span> <span class="literal">no</span></span><br><span class="line">  <span class="attr">vars:</span></span><br><span class="line">    <span class="attr">testvar:</span> <span class="string">&quot;a&quot;</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">      <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123;testvar&#125;&#125;</span> is a number&quot;</span></span><br><span class="line">    <span class="attr">when:</span> <span class="string">testvar</span> <span class="string">is</span> <span class="string">number</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">      <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123;testvar&#125;&#125;</span> is a string&quot;</span></span><br><span class="line">    <span class="attr">when:</span> <span class="string">testvar</span> <span class="string">is</span> <span class="string">string</span></span><br></pre></td></tr></table></figure><h2 id="ç»“æœåˆ¤æ–­"><a href="#ç»“æœåˆ¤æ–­" class="headerlink" title="ç»“æœåˆ¤æ–­"></a>ç»“æœåˆ¤æ–­</h2><p>ansible å¯é€šè¿‡å¦‚ä¸‹å‡ ä¸ªå…³é”®å­—æ¥å¯¹ä»»åŠ¡çš„æ‰§è¡Œç»“æœè¿›è¡Œåˆ¤æ–­ï¼š</p><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>success æˆ– succeeded</td><td>é€šè¿‡ä»»åŠ¡çš„è¿”å›ä¿¡æ¯åˆ¤æ–­ä»»åŠ¡çš„æ‰§è¡ŒçŠ¶æ€ï¼Œä»»åŠ¡æ‰§è¡ŒæˆåŠŸåˆ™è¿”å›çœŸ</td></tr><tr><td>failure æˆ– failed</td><td>é€šè¿‡ä»»åŠ¡çš„è¿”å›ä¿¡æ¯åˆ¤æ–­ä»»åŠ¡çš„æ‰§è¡ŒçŠ¶æ€ï¼Œä»»åŠ¡æ‰§è¡Œå¤±è´¥åˆ™è¿”å›çœŸ</td></tr><tr><td>change æˆ– changed</td><td>é€šè¿‡ä»»åŠ¡çš„è¿”å›ä¿¡æ¯åˆ¤æ–­ä»»åŠ¡çš„æ‰§è¡ŒçŠ¶æ€ï¼Œä»»åŠ¡æ‰§è¡ŒçŠ¶æ€ä¸º changed åˆ™è¿”å›çœŸ</td></tr><tr><td>skip æˆ– skipped</td><td>é€šè¿‡ä»»åŠ¡çš„è¿”å›ä¿¡æ¯åˆ¤æ–­ä»»åŠ¡çš„æ‰§è¡ŒçŠ¶æ€ï¼Œå½“ä»»åŠ¡æ²¡æœ‰æ»¡è¶³æ¡ä»¶ï¼Œè€Œè¢«è·³è¿‡æ‰§è¡Œæ—¶ï¼Œåˆ™è¿”å›çœŸ</td></tr></tbody></table><p>ä¾‹ï¼šæ ¹æ®ä»»åŠ¡æ‰§è¡Œç»“æœè¾“å‡ºå¯¹åº”ä¿¡æ¯ã€‚</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">all</span></span><br><span class="line">  <span class="attr">gather_facts:</span> <span class="literal">no</span></span><br><span class="line">  <span class="attr">vars:</span></span><br><span class="line">    <span class="attr">doshell:</span> <span class="string">&quot;yes&quot;</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">shell:</span> <span class="string">&quot;cat /test_folder/test_file&quot;</span></span><br><span class="line">    <span class="attr">when:</span> <span class="string">doshell</span> <span class="string">==</span> <span class="string">&quot;yes&quot;</span></span><br><span class="line">    <span class="attr">register:</span> <span class="string">returnmsg</span></span><br><span class="line">    <span class="attr">ignore_errors:</span> <span class="literal">true</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">      <span class="attr">msg:</span> <span class="string">&quot;success&quot;</span></span><br><span class="line">    <span class="attr">when:</span> <span class="string">returnmsg</span> <span class="string">is</span> <span class="string">success</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">      <span class="attr">msg:</span> <span class="string">&quot;failed&quot;</span></span><br><span class="line">    <span class="attr">when:</span> <span class="string">returnmsg</span> <span class="string">is</span> <span class="string">failure</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">      <span class="attr">msg:</span> <span class="string">&quot;changed&quot;</span></span><br><span class="line">    <span class="attr">when:</span> <span class="string">returnmsg</span> <span class="string">is</span> <span class="string">change</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">      <span class="attr">msg:</span> <span class="string">&quot;skip&quot;</span></span><br><span class="line">    <span class="attr">when:</span> <span class="string">returnmsg</span> <span class="string">is</span> <span class="string">skip</span></span><br></pre></td></tr></table></figure><h2 id="æ•´é™¤åˆ¤æ–­"><a href="#æ•´é™¤åˆ¤æ–­" class="headerlink" title="æ•´é™¤åˆ¤æ–­"></a>æ•´é™¤åˆ¤æ–­</h2><p>ansible å¯é€šè¿‡å¦‚ä¸‹å…³é”®å­—å¯¹ä¸€ä¸ªæ•°å­—è¿›è¡Œæ•´é™¤åˆ¤æ–­ï¼š</p><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>even</td><td>åˆ¤æ–­æ•°å€¼æ˜¯å¦æ˜¯å¶æ•°ï¼Œæ˜¯å¶æ•°åˆ™è¿”å›çœŸ</td></tr><tr><td>odd</td><td>åˆ¤æ–­æ•°å€¼æ˜¯å¦æ˜¯å¥‡æ•°ï¼Œæ˜¯å¥‡æ•°åˆ™è¿”å›çœŸ</td></tr><tr><td>divisibleby(num)</td><td>åˆ¤æ–­æ˜¯å¦å¯ä»¥æ•´é™¤æŒ‡å®šçš„æ•°å€¼ï¼Œå¦‚æœé™¤ä»¥æŒ‡å®šçš„å€¼ä»¥åä½™æ•°ä¸º 0ï¼Œåˆ™è¿”å›çœŸ</td></tr></tbody></table><p>çœ‹å¦‚ä¸‹ç¤ºä¾‹ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">localhost</span></span><br><span class="line">  <span class="attr">gather_facts:</span> <span class="literal">no</span></span><br><span class="line">  <span class="attr">vars:</span></span><br><span class="line">    <span class="attr">num1:</span> <span class="number">2</span></span><br><span class="line">    <span class="attr">num2:</span> <span class="number">3</span></span><br><span class="line">    <span class="attr">num3:</span> <span class="number">8</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">      <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; num1 &#125;&#125;</span> is an even number&quot;</span></span><br><span class="line">    <span class="attr">when:</span> <span class="string">num1</span> <span class="string">is</span> <span class="string">even</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">      <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; num2 &#125;&#125;</span> is an odd number&quot;</span></span><br><span class="line">    <span class="attr">when:</span> <span class="string">num2</span> <span class="string">is</span> <span class="string">odd</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">      <span class="attr">msg:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; num3 &#125;&#125;</span> can be divided exactly by 4&quot;</span></span><br><span class="line">    <span class="attr">when:</span> <span class="string">num3</span> <span class="string">is</span> <span class="string">divisibleby(4)</span></span><br></pre></td></tr></table></figure><h2 id="åˆ—è¡¨çˆ¶å­é›†åˆ¤æ–­"><a href="#åˆ—è¡¨çˆ¶å­é›†åˆ¤æ–­" class="headerlink" title="åˆ—è¡¨çˆ¶å­é›†åˆ¤æ–­"></a>åˆ—è¡¨çˆ¶å­é›†åˆ¤æ–­</h2><p>ansible å¯ä½¿ç”¨å¦‚ä¸‹å…³é”®å­—å¯¹åˆ—è¡¨è¿›è¡Œçˆ¶å­é›†åˆ¤æ–­ï¼š</p><table><thead><tr><th>çˆ¶å­é›†åˆ¤æ–­</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>subset</td><td>åˆ¤æ–­ä¸€ä¸ª list æ˜¯ä¸æ˜¯å¦ä¸€ä¸ª list çš„å­é›†ï¼Œæ˜¯å¦ä¸€ä¸ª list çš„å­é›†æ—¶è¿”å›çœŸ</td></tr><tr><td>superset</td><td>åˆ¤æ–­ä¸€ä¸ª list æ˜¯ä¸æ˜¯å¦ä¸€ä¸ª list çš„çˆ¶é›†ï¼Œæ˜¯å¦ä¸€ä¸ª list çš„çˆ¶é›†æ—¶è¿”å›çœŸ</td></tr></tbody></table><p>çœ‹å¦‚ä¸‹ç¤ºä¾‹ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">localhost</span></span><br><span class="line">  <span class="attr">gather_facts:</span> <span class="literal">no</span></span><br><span class="line">  <span class="attr">vars:</span></span><br><span class="line">    <span class="attr">a:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">2</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">5</span></span><br><span class="line">    <span class="attr">b:</span> [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]</span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">      <span class="attr">msg:</span> <span class="string">&quot;A is a subset of B&quot;</span></span><br><span class="line">    <span class="attr">when:</span> <span class="string">a</span> <span class="string">is</span> <span class="string">subset(b)</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">      <span class="attr">msg:</span> <span class="string">&quot;B is the parent set of A&quot;</span></span><br><span class="line">    <span class="attr">when:</span> <span class="string">b</span> <span class="string">is</span> <span class="string">superset(a)</span></span><br></pre></td></tr></table></figure><h2 id="ç‰ˆæœ¬åˆ¤æ–­"><a href="#ç‰ˆæœ¬åˆ¤æ–­" class="headerlink" title="ç‰ˆæœ¬åˆ¤æ–­"></a>ç‰ˆæœ¬åˆ¤æ–­</h2><p>åœ¨ ansible ä¸­ version å…³é”®å­—å¯ä»¥ç”¨äºå¯¹æ¯”ä¸¤ä¸ªç‰ˆæœ¬å·çš„å¤§å°ï¼Œæˆ–è€…ä¸æŒ‡å®šçš„ç‰ˆæœ¬å·è¿›è¡Œå¯¹æ¯”ï¼Œä½¿ç”¨è¯­æ³•ä¸º version(â€˜ ç‰ˆæœ¬å· â€˜, â€˜ æ¯”è¾ƒæ“ä½œç¬¦ â€˜)ã€‚</p><p>version æ”¯æŒçš„æ¯”è¾ƒæ“ä½œç¬¦å¦‚ä¸‹ï¼š</p><table><thead><tr><th>æ¯”è¾ƒæ“ä½œç¬¦</th><th>ç¬¦å·è¡¨ç¤º</th><th>å­—æ¯è¡¨ç¤º</th></tr></thead><tbody><tr><td>å¤§äº</td><td>&gt;</td><td>gt</td></tr><tr><td>å¤§äºç­‰äº</td><td>&gt;&#x3D;</td><td>ge</td></tr><tr><td>å°äº</td><td>&lt;</td><td>lt</td></tr><tr><td>å°äºç­‰äº</td><td>&lt;&#x3D;</td><td>le</td></tr><tr><td>ç­‰äº</td><td>&#x3D;&#x3D; æˆ– &#x3D;</td><td>eq</td></tr><tr><td>ä¸ç­‰äº</td><td>!&#x3D; æˆ– &lt;&gt;</td><td>ne</td></tr></tbody></table><p>çœ‹å¦‚ä¸‹ç¤ºä¾‹ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">localhost</span></span><br><span class="line">  <span class="attr">vars:</span></span><br><span class="line">    <span class="attr">ver1:</span> <span class="number">18.04</span></span><br><span class="line">    <span class="attr">ver2:</span> <span class="number">22.04</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">      <span class="attr">msg:</span> <span class="string">&quot;This message can be displayed when the ver2 is greater than ver1&quot;</span></span><br><span class="line">    <span class="attr">when:</span> <span class="string">ver2</span> <span class="string">is</span> <span class="string">version(ver1,&quot;&gt;&quot;)</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">      <span class="attr">msg:</span> <span class="string">&quot;system version <span class="template-variable">&#123;&#123;ansible_distribution_version&#125;&#125;</span> greater than 18.04&quot;</span></span><br><span class="line">    <span class="attr">when:</span> <span class="string">ansible_distribution_version</span> <span class="string">is</span> <span class="string">version(&quot;18.04&quot;,&quot;gt&quot;)</span></span><br></pre></td></tr></table></figure><h2 id="åˆå¹¶åˆ¤æ–­"><a href="#åˆå¹¶åˆ¤æ–­" class="headerlink" title="åˆå¹¶åˆ¤æ–­"></a>åˆå¹¶åˆ¤æ–­</h2><p>åœ¨ ansible ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ block å…³é”®å­—å°†å¤šä¸ªä»»åŠ¡æ•´åˆæˆä¸€ä¸ªå—ï¼Œè¿™ä¸ªå—å°†è¢«å½“åšä¸€ä¸ªæ•´ä½“ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹è¿™ä¸ªå—æ·»åŠ åˆ¤æ–­æ¡ä»¶ï¼Œå½“æ¡ä»¶æˆç«‹æ—¶ï¼Œåˆ™æ‰§è¡Œè¿™ä¸ªå—ä¸­çš„æ‰€æœ‰ä»»åŠ¡ã€‚</p><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªå°ç¤ºä¾‹ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">localhost</span></span><br><span class="line">  <span class="attr">gather_facts:</span> <span class="literal">no</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">      <span class="attr">msg:</span> <span class="string">&quot;task1&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">block:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">        <span class="attr">msg:</span> <span class="string">&quot;task2&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">        <span class="attr">msg:</span> <span class="string">&quot;task3&quot;</span></span><br><span class="line">    <span class="attr">when:</span> <span class="number">2</span> <span class="string">&gt;</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><h2 id="çŠ¶æ€åˆ¤æ–­"><a href="#çŠ¶æ€åˆ¤æ–­" class="headerlink" title="çŠ¶æ€åˆ¤æ–­"></a>çŠ¶æ€åˆ¤æ–­</h2><p>failed_when çš„ä½œç”¨å°±æ˜¯ï¼Œå½“å¯¹åº”çš„æ¡ä»¶æˆç«‹æ—¶ï¼Œå°†å¯¹åº”ä»»åŠ¡çš„æ‰§è¡ŒçŠ¶æ€è®¾ç½®ä¸ºå¤±è´¥ï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ© failed_when å…³é”®å­—æ¥å®Œæˆç±»ä¼¼ fail æ¨¡å—çš„åŠŸèƒ½ã€‚</p><p>çœ‹ä¸‹é¢ç¤ºä¾‹ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">localhost</span></span><br><span class="line">  <span class="attr">gather_facts:</span> <span class="literal">no</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">      <span class="attr">msg:</span> <span class="string">&quot;I execute normally&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">shell:</span> <span class="string">&quot;echo &#x27;This is a string for testing error&#x27;&quot;</span></span><br><span class="line">    <span class="attr">register:</span> <span class="string">return_value</span></span><br><span class="line">    <span class="attr">failed_when:</span> <span class="string">&#x27; &quot;error&quot; in return_value.stdout&#x27;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">      <span class="attr">msg:</span> <span class="string">&quot;I never execute,Because the playbook has stopped&quot;</span></span><br></pre></td></tr></table></figure><p>ä¸Šä¾‹ä¸­ï¼Œfailed_when å¯¹åº”çš„æ¡ä»¶æ˜¯ â€œerrorâ€ in return_value.stdoutï¼Œè¡¨ç¤º error å­—ç¬¦ä¸²å¦‚æœå­˜åœ¨äº shell æ¨¡å—æ‰§è¡Œåçš„æ ‡å‡†è¾“å‡ºä¸­ï¼Œåˆ™æ¡ä»¶æˆç«‹ï¼Œå½“æ¡ä»¶æˆç«‹åï¼Œshell æ¨¡å—çš„æ‰§è¡ŒçŠ¶æ€å°†ä¼šè¢«è®¾ç½®ä¸ºå¤±è´¥ï¼Œç”±äº shell æ¨¡å—çš„æ‰§è¡ŒçŠ¶æ€è¢«è®¾ç½®ä¸ºå¤±è´¥ï¼Œæ‰€ä»¥ playbook ä¼šç»ˆæ­¢è¿è¡Œï¼Œäºæ˜¯ï¼Œæœ€åçš„ debug æ¨¡å—å¹¶ä¸ä¼šè¢«æ‰§è¡Œã€‚</p><p>ç†è§£äº† â€˜ failed_whenâ€™ å…³é”®å­—ä»¥åï¼Œé¡ºåŠ¿ç†è§£ â€˜changed_whenâ€™ å…³é”®å­—å°±å®¹æ˜“å¤šäº†ã€‚</p><table><thead><tr><th>çŠ¶æ€åˆ¤æ–­</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>failed_when</td><td>å…³é”®å­—çš„ä½œç”¨æ˜¯åœ¨æ¡ä»¶æˆç«‹æ—¶ï¼Œå°†å¯¹åº”ä»»åŠ¡çš„æ‰§è¡ŒçŠ¶æ€è®¾ç½®ä¸ºå¤±è´¥ã€‚</td></tr><tr><td>changed_when</td><td>å…³é”®å­—çš„ä½œç”¨æ˜¯åœ¨æ¡ä»¶æˆç«‹æ—¶ï¼Œå°†å¯¹åº”ä»»åŠ¡çš„æ‰§è¡ŒçŠ¶æ€è®¾ç½®ä¸º changedã€‚</td></tr></tbody></table><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">localhost</span></span><br><span class="line">  <span class="attr">gather_facts:</span> <span class="literal">no</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">debug:</span></span><br><span class="line">      <span class="attr">msg:</span> <span class="string">&quot;test message&quot;</span></span><br><span class="line">    <span class="attr">changed_when:</span> <span class="number">2</span> <span class="string">&gt;</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><p>debug æ¨¡å—åœ¨æ­£å¸¸æ‰§è¡Œçš„æƒ…å†µä¸‹åªèƒ½æ˜¯ ok çŠ¶æ€ï¼Œä¸Šä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ changed_when å…³é”®å­—å°† debug æ¨¡å—çš„æ‰§è¡Œåçš„çŠ¶æ€å®šä¹‰ä¸ºäº† changedï¼Œä½ å¯ä»¥å°è¯•æ‰§è¡Œä¸Šä¾‹ playbookï¼Œæ‰§è¡Œæ•ˆæœå¦‚ä¸‹ï¼š</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ ansible-playbook test.yml </span><br><span class="line"></span><br><span class="line">PLAY [localhost] **********************************************************************************************************************</span><br><span class="line"></span><br><span class="line">TASK [debug] **************************************************************************************************************************</span><br><span class="line">changed: [localhost] =&gt; &#123;</span><br><span class="line">    &quot;msg&quot;: &quot;test message&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PLAY RECAP ****************************************************************************************************************************</span><br><span class="line">localhost                  : ok=1    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0  </span><br></pre></td></tr></table></figure><blockquote><p>åœ¨ Ansible ä¸­åªæœ‰ä»»åŠ¡ä½œå‡ºäº†å®é™…çš„æ“ä½œæ—¶ï¼ˆæ‰§è¡ŒåçŠ¶æ€ä¸º changedï¼‰ï¼Œæ‰ä¼šçœŸæ­£çš„æ‰§è¡Œå¯¹åº”çš„ handlersï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥æ§åˆ¶å½“å‰ä»»åŠ¡çš„çŠ¶æ€ã€‚</p></blockquote><p>å…¶å®ï¼Œchanged_when é™¤äº†èƒ½å¤Ÿåœ¨æ¡ä»¶æˆç«‹æ—¶å°†ä»»åŠ¡çš„æ‰§è¡ŒçŠ¶æ€è®¾ç½®ä¸º changedï¼Œè¿˜èƒ½è®©å¯¹åº”çš„ä»»åŠ¡æ°¸è¿œä¸èƒ½æ˜¯ changed çŠ¶æ€ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">B</span></span><br><span class="line">  <span class="attr">gather_facts:</span> <span class="literal">no</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">shell:</span> <span class="string">&quot;ls /opt&quot;</span></span><br><span class="line">    <span class="attr">changed_when:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure><p>å½“å°† changed_when ç›´æ¥è®¾ç½®ä¸º false æ—¶ï¼Œå¯¹åº”ä»»åŠ¡çš„çŠ¶æ€å°†ä¸ä¼šè¢«è®¾ç½®ä¸º changedï¼Œå¦‚æœä»»åŠ¡åŸæœ¬çš„æ‰§è¡ŒçŠ¶æ€ä¸º changedï¼Œæœ€ç»ˆåˆ™ä¼šè¢«è®¾ç½®ä¸º okï¼Œæ‰€ä»¥ï¼Œä¸Šä¾‹ playbook æ‰§è¡Œåï¼Œshell æ¨¡å—çš„æ‰§è¡ŒçŠ¶æ€æœ€ç»ˆä¸º okã€‚</p>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ansible </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntuå®‰è£…é…ç½®vncserver</title>
      <link href="/posts/bd65d26a/"/>
      <url>/posts/bd65d26a/</url>
      
        <content type="html"><![CDATA[<p>VNCï¼ˆVirtual Network Computingï¼‰æ˜¯ä¸€ç§è¿œç¨‹æ¡Œé¢åè®®ã€‚</p><p>vnc å¤§è‡´å¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§ç›´æ¥æŸ¥çœ‹ <code>TTY</code> ä¸Šæ­£åœ¨æ˜¾ç¤ºçš„æ¡Œé¢ï¼ˆå’Œæ’ä¸Šæ˜¾ç¤ºå™¨æ˜¾ç¤ºçš„ä¸€è‡´ï¼‰ï¼Œå¦ä¸€ç§æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„æ¡Œé¢ï¼ˆå³ å¯ä»¥åœ¨ä¸€å° linux ä¸Šæ‰“å¼€è‹¥å¹²ä¸ªæ¡Œé¢ä¾›è‹¥å¹²ç”¨æˆ·ä½¿ç”¨ï¼‰å¸¸ç”¨çš„ vnc æœåŠ¡å™¨æœ‰ï¼š<code>x11vnc</code> <code>tigervnc</code> <code>tightvnc</code></p><p>æˆ‘çš„ç³»ç»Ÿæ˜¯ï¼š<code>ubuntu22.04</code>, å¦‚æœä½ ä¸æ˜¯è¿™ä¸ªç³»ç»Ÿï¼Œå¯èƒ½éœ€è¦åšä¸€äº›ä¿®æ”¹ã€‚å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š<a href="https://help.ubuntu.com/community/VNC/Servers">https://help.ubuntu.com/community/VNC/Servers</a> æœ¬æ–‡é…ç½®ç›´æ¥è½¬å‘æ¡Œé¢æ˜¾ç¤ºã€‚ ç›´æ¥è½¬å‘æ¡Œé¢æˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯ <code>x11vnc</code> , åˆ›å»º vnc è™šæ‹Ÿæ¡Œé¢è¯·çœ‹: <a href="/posts/sghylv/">é¦™æ©™æ´¾é…ç½®VNC Server</a></p><h2 id="å®‰è£…æœåŠ¡ç«¯"><a href="#å®‰è£…æœåŠ¡ç«¯" class="headerlink" title="å®‰è£…æœåŠ¡ç«¯"></a>å®‰è£…æœåŠ¡ç«¯</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install x11vnc</span><br></pre></td></tr></table></figure><h2 id="åˆ›å»ºå¯†ç æ–‡ä»¶"><a href="#åˆ›å»ºå¯†ç æ–‡ä»¶" class="headerlink" title="åˆ›å»ºå¯†ç æ–‡ä»¶"></a>åˆ›å»ºå¯†ç æ–‡ä»¶</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">x11vnc -storepasswd</span><br><span class="line"></span><br><span class="line"><span class="comment"># æˆ–è€…ä½¿ç”¨ vncpasswd å‘½ä»¤æ¥åˆ›å»ºï¼Œæ”¯æŒéäº¤äº’å¼åˆ›å»º</span></span><br><span class="line"><span class="comment"># echo 123456 | vncpasswd -f &gt; ~/.vnc/passwd</span></span><br></pre></td></tr></table></figure><p>å¯†ç æ–‡ä»¶åˆ›å»ºåœ¨ï¼š <code>~/.vnc/passwd</code></p><h2 id="é€šè¿‡-systemd-å¯åŠ¨"><a href="#é€šè¿‡-systemd-å¯åŠ¨" class="headerlink" title="é€šè¿‡ systemd å¯åŠ¨"></a>é€šè¿‡ systemd å¯åŠ¨</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">tee</span> /lib/systemd/system/x11vnc.service &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">[Unit]</span></span><br><span class="line"><span class="string">Description=Start x11vnc at startup.</span></span><br><span class="line"><span class="string">After=multi-user.target</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Service]</span></span><br><span class="line"><span class="string">Type=simple</span></span><br><span class="line"><span class="string">ExecStart=/usr/bin/x11vnc -auth guess -forever -loop -noxdamage -repeat -rfbauth /home/orangepi/.vnc/passwd -rfbport 5900 -shared</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Install]</span></span><br><span class="line"><span class="string">WantedBy=multi-user.target</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl <span class="built_in">enable</span> --now x11vnc.service</span><br></pre></td></tr></table></figure><h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><p><code>x11vnc</code> åŒ…å«ä¸€ä¸ª <code>/usr/share/applications/x11vnc.desktop</code> æ¡Œé¢æ–‡ä»¶ï¼Œä½ å¯ä»¥åœ¨æ¡Œé¢ä¸Šæ‰¾åˆ° x11 vnc çš„å›¾æ ‡ï¼Œç„¶åé€šè¿‡å›¾å½¢ç•Œé¢æ¥é…ç½®ã€‚æ¯”å¦‚ï¼š</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202407151440567.png" alt="image.png|654"></p>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ubuntu </tag>
            
            <tag> vnc </tag>
            
            <tag> RemoteControl </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å®‰è£…å’Œé…ç½®sambaå…±äº«</title>
      <link href="/posts/a7c8660c/"/>
      <url>/posts/a7c8660c/</url>
      
        <content type="html"><![CDATA[<blockquote><p>åœ¨ windows å¹³å°åˆ›å»º smb å…±äº«æ˜¯ä¸€ä»¶å¾ˆæ–¹ä¾¿çš„äº‹æƒ…ï¼Œå³é”®å…±äº«å³å¯ï¼Œä¸€ç›´æ²¡æœ‰å…³å¿ƒ linux å¹³å°çš„ smb æœåŠ¡ï¼Œæœ€è¿‘å®¶é‡Œæœ‰ä¸€å°è£…äº† ubuntu çš„ç¬”è®°æœ¬ï¼Œæƒ³æ”¾åœ¨è§’è½é‡Œåš nas ç”¨ï¼Œæ‰€ä»¥çœ‹çœ‹å¦‚ä½•æ­å»º smb å…±äº«ã€‚</p></blockquote><h2 id="å®‰è£…æœåŠ¡"><a href="#å®‰è£…æœåŠ¡" class="headerlink" title="å®‰è£…æœåŠ¡"></a>å®‰è£…æœåŠ¡</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install samba</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸å°å¿ƒåˆ é™¤äº†é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt purge samba-common samba</span><br><span class="line">sudo apt install samba</span><br></pre></td></tr></table></figure><p>æ¥é‡æ–°ç”Ÿæˆ</p><h2 id="åˆ›å»º-samba-ç”¨æˆ·"><a href="#åˆ›å»º-samba-ç”¨æˆ·" class="headerlink" title="åˆ›å»º samba ç”¨æˆ·"></a>åˆ›å»º samba ç”¨æˆ·</h2><p>samba ä½¿ç”¨ Linux çš„ç”¨æˆ·å’Œæƒé™ç³»ç»Ÿï¼Œä½†æ˜¯æœ‰è‡ªå·±çš„è®¤è¯æœºåˆ¶ã€‚</p><p>samba ç”¨æˆ·é¦–å…ˆè¦æ˜¯ä¸€ä¸ª Linux ç”¨æˆ·ï¼Œä¸ç„¶æ˜¯åˆ›å»ºä¸æˆåŠŸçš„ã€‚</p><h3 id="åˆ›å»ºä¸€ä¸ª-Linux-ç”¨æˆ·"><a href="#åˆ›å»ºä¸€ä¸ª-Linux-ç”¨æˆ·" class="headerlink" title="åˆ›å»ºä¸€ä¸ª Linux ç”¨æˆ·"></a>åˆ›å»ºä¸€ä¸ª Linux ç”¨æˆ·</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo useradd -s /bin/bash -m zhanglikun</span><br></pre></td></tr></table></figure><blockquote><p>-m æ˜¯åœ¨ home ç›®å½•è‡ªåŠ¨åˆ›å»ºä¸€ä¸ª zhanglikun ç›®å½•</p></blockquote><h3 id="åˆ›å»ºä¸€ä¸ª-smb-ç”¨æˆ·"><a href="#åˆ›å»ºä¸€ä¸ª-smb-ç”¨æˆ·" class="headerlink" title="åˆ›å»ºä¸€ä¸ª smb ç”¨æˆ·"></a>åˆ›å»ºä¸€ä¸ª smb ç”¨æˆ·</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo smbpasswd -a zhanglikun</span><br></pre></td></tr></table></figure><p>æ‰‹åŠ¨è¾“å…¥ä¸¤éå¯†ç å³å¯,å…¶ä»–æ“ä½œå¯ä»¥é€šè¿‡ <code>smbpass -h</code> æŸ¥çœ‹</p><h2 id="åˆ›å»ºå…±äº«ç›®å½•"><a href="#åˆ›å»ºå…±äº«ç›®å½•" class="headerlink" title="åˆ›å»ºå…±äº«ç›®å½•"></a>åˆ›å»ºå…±äº«ç›®å½•</h2><p>ä½¿ç”¨ zhanglikun ç”¨æˆ·åœ¨å®¶ç›®å½•åˆ›å»ºä¸€ä¸ªå…±äº«ç›®å½•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> samba</span><br></pre></td></tr></table></figure><h2 id="ä¿®æ”¹é…ç½®æ–‡ä»¶"><a href="#ä¿®æ”¹é…ç½®æ–‡ä»¶" class="headerlink" title="ä¿®æ”¹é…ç½®æ–‡ä»¶"></a>ä¿®æ”¹é…ç½®æ–‡ä»¶</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/samba/smb.conf</span><br></pre></td></tr></table></figure><p>ä¿è¯ server role æ˜¯ standalone serverï¼ˆé»˜è®¤æƒ…å†µä¸‹å°±æ˜¯å¦‚æ­¤ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">server role = standalone server</span><br></pre></td></tr></table></figure><h3 id="æ·»åŠ å…±äº«é…ç½®"><a href="#æ·»åŠ å…±äº«é…ç½®" class="headerlink" title="æ·»åŠ å…±äº«é…ç½®"></a>æ·»åŠ å…±äº«é…ç½®</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[samba]</span><br><span class="line">    path = /home/zhanglikun/samba</span><br><span class="line">    browseable = yes</span><br><span class="line">    read only = no</span><br><span class="line">#    force create mode = 0660</span><br><span class="line">#    force directory mode = 2770</span><br><span class="line">    valid users = zhanglikun</span><br><span class="line"></span><br><span class="line"># ä¸‹é¢æ˜¯ä¸€ä¸ªåŒ¿ååªè¯»é…ç½®</span><br><span class="line">[share]</span><br><span class="line">    path = /mnt/samba</span><br><span class="line">    browsable =yes</span><br><span class="line">    writable = no</span><br><span class="line">    guest ok = yes</span><br><span class="line">    read only = yes</span><br></pre></td></tr></table></figure><p>é€‰é¡¹çš„å«ä¹‰å¦‚ä¸‹ï¼š</p><table><thead><tr><th>é…ç½®é¡¹</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>[samba] å’Œ [public]</td><td>ç™»å½•æ—¶å°†ä½¿ç”¨çš„å…±äº«åç§°ã€‚</td></tr><tr><td>path</td><td>åˆ†äº«çš„è·¯å¾„ã€‚</td></tr><tr><td>browseable</td><td>æ˜¯å¦åº”åœ¨å¯ç”¨å…±äº«åˆ—è¡¨ä¸­åˆ—å‡ºè¯¥å…±äº«ã€‚é€šè¿‡è®¾ç½®ä¸º noï¼Œå…¶ä»–ç”¨æˆ·å°†çœ‹ä¸åˆ°å…±äº«ã€‚</td></tr><tr><td>read only</td><td>valid users åˆ—è¡¨ä¸­æŒ‡å®šçš„ç”¨æˆ·æ˜¯å¦èƒ½å¤Ÿå†™å…¥æ­¤å…±äº«ã€‚</td></tr><tr><td>force create mode</td><td>è®¾ç½®æ­¤å…±äº«ä¸­æ–°åˆ›å»ºæ–‡ä»¶çš„æƒé™ã€‚</td></tr><tr><td>force directory mode</td><td>è®¾ç½®æ­¤å…±äº«ä¸­æ–°åˆ›å»ºç›®å½•çš„æƒé™ã€‚</td></tr><tr><td>valid users</td><td>å…è®¸è®¿é—®å…±äº«çš„ç”¨æˆ·å’Œç»„çš„åˆ—è¡¨ã€‚ç¾¤ç»„ä»¥@ç¬¦å·ä¸ºå‰ç¼€ã€‚</td></tr></tbody></table><p>å®Œæˆåï¼Œä½¿ç”¨ä»¥ä¸‹æ–¹æ³•é‡æ–°å¯åŠ¨ Samba æœåŠ¡ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart nmbd.service</span><br></pre></td></tr></table></figure><h2 id="è¿æ¥-samba-å…±äº«"><a href="#è¿æ¥-samba-å…±äº«" class="headerlink" title="è¿æ¥ samba å…±äº«"></a>è¿æ¥ samba å…±äº«</h2><h3 id="ä»-Linux-è¿æ¥åˆ°-Samba-å…±äº«"><a href="#ä»-Linux-è¿æ¥åˆ°-Samba-å…±äº«" class="headerlink" title="ä» Linux è¿æ¥åˆ° Samba å…±äº«"></a>ä» Linux è¿æ¥åˆ° Samba å…±äº«</h3><p>Linux ç”¨æˆ·å¯ä»¥ä½¿ç”¨æ–‡ä»¶ç®¡ç†å™¨ä»å‘½ä»¤è¡Œè®¿é—® samba å…±äº«æˆ–æŒ‚è½½ Samba å…±äº«ã€‚</p><h4 id="æ–¹æ³•-1-ä½¿ç”¨-smbclient-å®¢æˆ·ç«¯"><a href="#æ–¹æ³•-1-ä½¿ç”¨-smbclient-å®¢æˆ·ç«¯" class="headerlink" title="æ–¹æ³• 1. ä½¿ç”¨ smbclient å®¢æˆ·ç«¯"></a>æ–¹æ³• 1. ä½¿ç”¨ smbclient å®¢æˆ·ç«¯</h4><p><code>smbclient</code> æ˜¯å…è®¸æ‚¨ä»å‘½ä»¤è¡Œè®¿é—® <code>Samba</code> çš„å·¥å…·ã€‚ <code>smbclient</code> è½¯ä»¶åŒ…å°šæœªé¢„å…ˆå®‰è£…åœ¨å¤§å¤šæ•° Linux å‘è¡Œç‰ˆä¸­ï¼Œå› æ­¤æ‚¨éœ€è¦ä½¿ç”¨åˆ†å‘è½¯ä»¶åŒ…ç®¡ç†å™¨è¿›è¡Œå®‰è£…ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install smbclient</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install samba-client</span><br></pre></td></tr></table></figure><p>è®¿é—® Samba å…±äº«çš„è¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">smbclient //<span class="string">&quot;&lt;windows_computername&gt;/&lt;windows_sharename&gt;&quot;</span> -U <span class="string">&quot;&lt;windows_username&gt;%&lt;windows_password&gt;&quot;</span></span><br></pre></td></tr></table></figure><p>æ‚¨å°†ç™»å½• Samba å‘½ä»¤è¡Œç•Œé¢ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Try <span class="string">&quot;help&quot;</span> to get a list of possible commands.</span><br><span class="line">smb: \&gt;</span><br></pre></td></tr></table></figure><h4 id="æ–¹æ³•-2-æŒ‚è½½-Samba-å…±äº«"><a href="#æ–¹æ³•-2-æŒ‚è½½-Samba-å…±äº«" class="headerlink" title="æ–¹æ³• 2. æŒ‚è½½ Samba å…±äº«"></a>æ–¹æ³• 2. æŒ‚è½½ Samba å…±äº«</h4><p>è¦åœ¨ Linux ä¸ŠæŒ‚è½½ Samba å…±äº«ï¼Œæ‚¨éœ€è¦å®‰è£… <code>cifs-utils</code> è½¯ä»¶åŒ…ã€‚</p><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">CentOS</button><button type="button" class="tab">Ubuntu</button></div><div class="tab-contents"><div class="tab-item-content active"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install cifs-utils</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install cifs-utils</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div><p>æ¥ä¸‹æ¥ï¼Œåˆ›å»ºå®‰è£…ç‚¹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">mkdir</span> /mnt/smbmount</span><br></pre></td></tr></table></figure><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">æ‰‹åŠ¨æŒ‚è½½</button><button type="button" class="tab">fstabè‡ªåŠ¨æŒ‚è½½</button></div><div class="tab-contents"><div class="tab-item-content active"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># uidå’Œgidæ˜¯æŒ‚è½½åˆ°æœ¬åœ°çš„æƒé™ã€‚é™¤äº†æœ‰è¿œç¨‹æœåŠ¡å™¨æƒé™å¤–ï¼Œæœ¬åœ°ä¹Ÿè¦æœ‰æƒé™æ‰èƒ½ä¿®æ”¹ã€‚</span></span><br><span class="line">sudo mount -t cifs //192.168.1.11/0/ /mnt -o vers=2.0,uid=0,gid=0,dir_mode=0755,file_mode=0755,mfsymlinks,cache=strict,rsize=1048576,wsize=1048576,username=iuxt,password=password</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">//&lt;windows_computername&gt;/&lt;windows_sharename&gt; /mnt/windows_share cifs username=&lt;windows_username&gt;,password=&lt;windows_password&gt;,iocharset=utf8 0 0</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div><h3 id="ä»-Windows-è¿æ¥åˆ°-Samba-å…±äº«"><a href="#ä»-Windows-è¿æ¥åˆ°-Samba-å…±äº«" class="headerlink" title="ä» Windows è¿æ¥åˆ° Samba å…±äº«"></a>ä» Windows è¿æ¥åˆ° Samba å…±äº«</h3><p>Windows ç”¨æˆ·è¿˜å¯ä»¥é€‰æ‹©ä»å‘½ä»¤è¡Œå’Œ GUI è¿æ¥åˆ° Samba å…±äº«ã€‚ä»¥ä¸‹æ­¥éª¤æ˜¾ç¤ºäº†å¦‚ä½•ä½¿ç”¨ Windows File Explorer è®¿é—®å…±äº«ã€‚</p><p>æ‰“å¼€æ–‡ä»¶èµ„æºç®¡ç†å™¨ï¼Œç„¶ååœ¨åœ°å€æ ä¸­ä»¥ä»¥ä¸‹æ ¼å¼è¾“å…¥ Samba å…±äº«çš„åœ°å€ <code>\\samba_hostname_or_server_ip\sharename</code> å›è½¦ï¼Œå°†æç¤ºæ‚¨è¾“å…¥ç™»å½•å‡­æ®<br>å¦‚æœéœ€è¦æŒ‚è½½ï¼Œåˆ™åœ¨èµ„æºç®¡ç†å™¨ä¸­æ‰¾åˆ° <code>æ˜ å°„ç½‘ç»œé©±åŠ¨å™¨</code>,æŒ‰ç…§æç¤ºè¾“å…¥åœ°å€å’Œç”¨æˆ·åå¯†ç å³å¯æŒ‚è½½æˆä¸€ä¸ªç›˜ç¬¦ã€‚</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># æŒ‚è½½å…±äº«</span><br><span class="line"><span class="built_in">net</span> use z: \\<span class="number">192</span>.<span class="number">168</span>.<span class="number">10</span>.<span class="number">163</span>\share /user:&quot;&lt;è®¡ç®—æœºå\ç”¨æˆ·å&gt;&quot; &quot;&lt;å¯†ç &gt;&quot;</span><br><span class="line"></span><br><span class="line"># æŸ¥çœ‹å·²ç»åˆ›å»ºçš„è¿æ¥</span><br><span class="line"><span class="built_in">net</span> use</span><br><span class="line"></span><br><span class="line"># æ–­å¼€å…±äº«</span><br><span class="line"><span class="built_in">net</span> use /delete \\<span class="number">10</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">132</span>\ubuntu</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
            <tag> samba </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç»™ Ubuntu åŠ å¯† Home ç›®å½•</title>
      <link href="/posts/sqln8l/"/>
      <url>/posts/sqln8l/</url>
      
        <content type="html"><![CDATA[<p>Ubuntu åœ¨å®‰è£…çš„æ—¶å€™æ˜¯å¯ä»¥è¿›è¡Œå…¨ç›˜åŠ å¯†çš„ï¼Œä½†æ˜¯å…¨ç›˜åŠ å¯†æ²¡æ³•åƒ Windows åšçš„é‚£æ ·æ— æ„Ÿï¼ˆå¼€æœºéœ€è¦è¾“å…¥å¯†ç æ‰èƒ½è¿›å…¥è¿›å…¥ç³»ç»Ÿï¼ŒmacOS çš„ FileVault ä¹Ÿæ˜¯å¦‚æ­¤ï¼ŒWindows çš„ BitLocker æ˜¯å¯ä»¥åˆ©ç”¨ TPM è¿›è¡Œè‡ªåŠ¨è§£å¯†ï¼Œä½¿ç”¨ä½“éªŒå®Œå…¨å’Œä¸åŠ å¯†ä¸€æ ·ï¼Œå¾®è½¯ç‰›é€¼ï¼‰åœ¨ä¸€äº›éœ€è¦æ— äººå€¼å®ˆçš„æƒ…å†µä¸‹å°±ä¸å¤ªå¥½ç”¨ï¼Œæ¯”å¦‚ä½¿ç”¨è¿œç¨‹æ¡Œé¢è¿æ¥æœºå™¨ï¼Œç„¶åé‡å¯äº†è¿œç¨‹æœºå™¨ï¼Œä½ ä¼šå‘ç°å†ä¹Ÿè¿ä¸ä¸Šäº†ï¼Œå› ä¸ºéœ€è¦å…ˆè§£å¯†ç£ç›˜æ‰èƒ½å¯åŠ¨æ“ä½œç³»ç»Ÿã€‚</p><h2 id="å®‰è£…å·¥å…·"><a href="#å®‰è£…å·¥å…·" class="headerlink" title="å®‰è£…å·¥å…·"></a>å®‰è£…å·¥å…·</h2><p>åŠ å¯† Home æ–‡ä»¶å¤¹ï¼Œéœ€è¦å®‰è£… <code>eCryptfs</code>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install ecryptfs-utils cryptsetup</span><br></pre></td></tr></table></figure><h2 id="å¼€å§‹åŠ å¯†"><a href="#å¼€å§‹åŠ å¯†" class="headerlink" title="å¼€å§‹åŠ å¯†"></a>å¼€å§‹åŠ å¯†</h2><p>åŠ å¯†åˆ‡æ¢åˆ° <code>root</code> ç”¨æˆ·æ‰§è¡Œï¼Œæˆ–è€…ä½ ä¹Ÿå¯ä»¥åˆ›å»ºä¸€ä¸ªç®¡ç†å‘˜è´¦å·æ¥æ‰§è¡Œã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ecryptfs-migrate-home -u &lt;ç”¨æˆ·å&gt;</span><br></pre></td></tr></table></figure><p>è¿‡ç¨‹ä¸­éœ€è¦è¾“å…¥ä½ åŠ å¯†çš„ç”¨æˆ·çš„ç”¨æˆ·åå’Œå¯†ç ã€‚åŠ å¯†åä¼šåˆ›å»ºä¸´æ—¶å¤‡ä»½ç›®å½•ï¼Œå¦‚æœå¯ä»¥æ­£å¸¸è¿›å…¥æ¡Œé¢ï¼Œå¯ä»¥æŠŠå¤‡ä»½ç›®å½•åˆ é™¤ï¼Œå¤‡ä»½ç›®å½•åœ¨ <code>/home/</code> ä¸‹ã€‚</p><p>å¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥è®°å½•ä½ éšæœºç”Ÿæˆçš„å¯†ç ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ecryptfs-unwrap-passphrase</span><br></pre></td></tr></table></figure><h2 id="åŠ å¯†äº¤æ¢åŒº"><a href="#åŠ å¯†äº¤æ¢åŒº" class="headerlink" title="åŠ å¯†äº¤æ¢åŒº"></a>åŠ å¯†äº¤æ¢åŒº</h2><p>åŠ å¯†äº¤æ¢åˆ†åŒºå¯èƒ½ä¼šå¦¨ç¢ä¼‘çœ å’ŒæŒ‚èµ·åŠŸèƒ½</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ecryptfs-setup-swap</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Hyper-V è‡ªå®šä¹‰å†…éƒ¨ç½‘ç»œç½‘æ®µå’ŒIPåœ°å€</title>
      <link href="/posts/6f952944/"/>
      <url>/posts/6f952944/</url>
      
        <content type="html"><![CDATA[<h2 id="å¼€å§‹ä¹‹å‰"><a href="#å¼€å§‹ä¹‹å‰" class="headerlink" title="å¼€å§‹ä¹‹å‰"></a>å¼€å§‹ä¹‹å‰</h2><p>é¦–å…ˆå¦‚æœæ˜¯ä»…ä»…æƒ³è¦ä¸»æœºå’Œè™šæ‹Ÿæœºè¿›è¡Œæ•°æ®äº’é€šï¼Œå…¶å®ä¸éœ€è¦å›ºå®š IPï¼Œç›´æ¥é€šè¿‡è®¡ç®—æœºåå°±å¯ä»¥äº’ç›¸è®¿é—®ã€‚</p><h2 id="Hyper-V-ç½‘ç»œæ¨¡å¼"><a href="#Hyper-V-ç½‘ç»œæ¨¡å¼" class="headerlink" title="Hyper-V ç½‘ç»œæ¨¡å¼"></a>Hyper-V ç½‘ç»œæ¨¡å¼</h2><p>å¤–éƒ¨è™šæ‹Ÿç½‘ç»œ: ç±»ä¼¼äº VMware çš„æ¡¥æ¥ç½‘ç»œæ¨¡å¼, åœ¨å¸Œæœ›å…è®¸è™šæ‹Ÿæœºä¸å¤–éƒ¨æœåŠ¡å™¨å’Œç®¡ç†æ“ä½œç³»ç»Ÿï¼ˆæœ‰æ—¶ç§°ä¸ºçˆ¶åˆ†åŒºï¼‰è¿›è¡Œé€šä¿¡æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æ­¤ç±»å‹çš„è™šæ‹Ÿç½‘ç»œã€‚æ­¤ç±»å‹çš„è™šæ‹Ÿç½‘ç»œè¿˜å…è®¸ä½äºåŒä¸€ç‰©ç†æœåŠ¡å™¨ä¸Šçš„è™šæ‹Ÿæœºäº’ç›¸é€šä¿¡ã€‚</p><p>å†…éƒ¨è™šæ‹Ÿç½‘ç»œ: ç±»ä¼¼äº VMware çš„ NAT ç½‘ç»œæ¨¡å¼, åœ¨å¸Œæœ›å…è®¸åŒä¸€ç‰©ç†æœåŠ¡å™¨ä¸Šçš„è™šæ‹Ÿæœºä¸è™šæ‹Ÿæœºå’Œç®¡ç†æ“ä½œç³»ç»Ÿä¹‹é—´è¿›è¡Œé€šä¿¡æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æ­¤ç±»å‹çš„è™šæ‹Ÿç½‘ç»œã€‚å†…éƒ¨è™šæ‹Ÿç½‘ç»œæ˜¯ä¸€ç§æœªç»‘å®šåˆ°ç‰©ç†ç½‘ç»œé€‚é…å™¨çš„è™šæ‹Ÿç½‘ç»œã€‚å®ƒé€šå¸¸ç”¨æ¥æ„å»ºä»ç®¡ç†æ“ä½œç³»ç»Ÿè¿æ¥åˆ°è™šæ‹Ÿæœºæ‰€éœ€çš„æµ‹è¯•ç¯å¢ƒã€‚</p><p>ä¸“ç”¨è™šæ‹Ÿç½‘ç»œ: åœ¨å¸Œæœ›åªå…è®¸åŒä¸€ç‰©ç†æœåŠ¡å™¨ä¸Šçš„è™šæ‹Ÿæœºä¹‹é—´è¿›è¡Œé€šä¿¡æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æ­¤ç±»å‹çš„è™šæ‹Ÿç½‘ç»œã€‚ä¸“ç”¨è™šæ‹Ÿç½‘ç»œæ˜¯ä¸€ç§æ— éœ€åœ¨ç®¡ç†æ“ä½œç³»ç»Ÿä¸­è£…æœ‰è™šæ‹Ÿç½‘ç»œé€‚é…å™¨çš„è™šæ‹Ÿç½‘ç»œã€‚åœ¨å¸Œæœ›å°†è™šæ‹Ÿæœºä»ç®¡ç†æ“ä½œç³»ç»Ÿä»¥åŠå¤–éƒ¨ç½‘ç»œä¸­çš„ç½‘ç»œé€šä¿¡ä¸­åˆ†ç¦»å‡ºæ¥æ—¶ï¼Œé€šå¸¸ä¼šä½¿ç”¨ä¸“ç”¨è™šæ‹Ÿç½‘ç»œã€‚</p><p>ç”±äº Hyper-V è‡ªå¸¦çš„ Default Switch åœ¨æ¯æ¬¡ç”µè„‘é‡å¯çš„æ—¶å€™ä¼šè‡ªåŠ¨åˆ†é…ä¸€ä¸ªæœªä½¿ç”¨çš„ç½‘æ®µ, æ— æ³•è¾¾åˆ°å›ºå®š IP çš„æ•ˆæœ, Hyper-V é»˜è®¤çš„ Default Switch åŒæ—¶æ”¯æŒäº† NAT ç½‘ç»œä»¥åŠ DHCP</p><p>æ­£å¸¸æ¥è¯´æƒ³è¦å›ºå®š IP æœ‰ä»¥ä¸‹æ–¹å¼:</p><ol><li>åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„ç½‘æ®µ, å›ºå®šç½‘æ®µçš„åœ°å€èŒƒå›´, ç„¶åè™šæ‹Ÿæœºä½¿ç”¨å›ºå®š IP</li><li>å¢åŠ ä¸€ä¸ªæ–°çš„ä»…å†…ç½‘ç½‘å¡, è™šæ‹Ÿæœºæ­£å¸¸è®¿é—®ç½‘ç»œä½¿ç”¨ Default Switch ä¸å˜, ç‰©ç†æœºè®¿é—®è™šæ‹Ÿæœºä½¿ç”¨ä»…å†…ç½‘ç½‘å¡</li><li>ä½¿ç”¨å¤–éƒ¨è™šæ‹Ÿç½‘ç»œ, å’Œä¸»æœºå¤„äºåŒä¸€ä¸ªå†…ç½‘</li></ol><h2 id="æ–¹æ¡ˆä¸€-åˆ›å»ºè‡ªå®šä¹‰-NAT-ç½‘æ®µ"><a href="#æ–¹æ¡ˆä¸€-åˆ›å»ºè‡ªå®šä¹‰-NAT-ç½‘æ®µ" class="headerlink" title="æ–¹æ¡ˆä¸€: åˆ›å»ºè‡ªå®šä¹‰ NAT ç½‘æ®µ"></a>æ–¹æ¡ˆä¸€: åˆ›å»ºè‡ªå®šä¹‰ NAT ç½‘æ®µ</h2><p>å‚è€ƒï¼š<a href="https://learn.microsoft.com/zh-cn/virtualization/hyper-v-on-windows/user-guide/setup-nat-network">https://learn.microsoft.com/zh-cn/virtualization/hyper-v-on-windows/user-guide/setup-nat-network</a></p><h3 id="æ·»åŠ è™šæ‹Ÿäº¤æ¢æœº"><a href="#æ·»åŠ è™šæ‹Ÿäº¤æ¢æœº" class="headerlink" title="æ·»åŠ è™šæ‹Ÿäº¤æ¢æœº"></a>æ·»åŠ è™šæ‹Ÿäº¤æ¢æœº</h3><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">ä½¿ç”¨powershellæ·»åŠ </button><button type="button" class="tab">æ‰‹åŠ¨æ·»åŠ </button></div><div class="tab-contents"><div class="tab-item-content active"><p>ä»¥ç®¡ç†å‘˜èº«ä»½å¯åŠ¨ PowerShell</p><blockquote><p>Win11 å’Œæ–°ä¸€ç‚¹çš„ Win10 ç³»ç»Ÿå¯ä»¥é€šè¿‡å³é”®ç‚¹å‡»å¼€å§‹èœå•ï¼Œé€‰æ‹© <code>Windows ç»ˆç«¯(ç®¡ç†å‘˜)</code> æ‰“å¼€</p></blockquote><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºè™šæ‹Ÿäº¤æ¢æœºï¼Œç­‰åŒäºåœ¨Hyper-Vç®¡ç†å™¨ç•Œé¢ä¸­æ–°å»ºè™šæ‹Ÿç½‘ç»œäº¤æ¢æœº</span></span><br><span class="line"><span class="built_in">New-VMSwitch</span> <span class="literal">-SwitchName</span> <span class="string">&quot;NAT&quot;</span> <span class="literal">-SwitchType</span> Internal</span><br><span class="line"></span><br><span class="line"><span class="comment"># é˜²ç«å¢™æ”¾é€šè¿™ä¸ªç½‘å¡çš„æ‰€æœ‰æµé‡</span></span><br><span class="line"><span class="built_in">New-NetFirewallRule</span> <span class="literal">-DisplayName</span> <span class="string">&quot;å…è®¸NATç½‘å¡&quot;</span> <span class="literal">-InterfaceAlias</span> <span class="string">&quot;vEthernet (NAT)&quot;</span> <span class="literal">-Direction</span> Inbound <span class="literal">-Action</span> Allow</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><p>å¯ä»¥åˆ° Hyper V ç®¡ç†å™¨ è™šæ‹Ÿäº¤æ¢æœºç®¡ç†å™¨ æ–°å»ºè™šæ‹Ÿäº¤æ¢æœº<br>ç±»å‹é€‰æ‹© <code>å†…éƒ¨</code></p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/Snipaste_2022-01-13_09-39-25.png" alt="æ‰‹åŠ¨åˆ›å»ºè™šæ‹Ÿäº¤æ¢æœº|506"></p></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div><h3 id="è®¾ç½®-ip-åœ°å€"><a href="#è®¾ç½®-ip-åœ°å€" class="headerlink" title="è®¾ç½® ip åœ°å€"></a>è®¾ç½® ip åœ°å€</h3><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">ä½¿ç”¨powershellæ·»åŠ </button><button type="button" class="tab">æ‰‹åŠ¨æ·»åŠ </button></div><div class="tab-contents"><div class="tab-item-content active"><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è·å–è™šæ‹Ÿäº¤æ¢æœºçš„ifindexï¼Œå¹¶èµ‹å€¼åˆ°å˜é‡ä¸­</span></span><br><span class="line"><span class="variable">$ifindex</span> = <span class="built_in">Get-NetAdapter</span> <span class="literal">-Name</span> <span class="string">&quot;vEthernet (NAT)&quot;</span> | <span class="built_in">Select-Object</span> <span class="literal">-ExpandProperty</span> <span class="string">&#x27;ifIndex&#x27;</span></span><br><span class="line"><span class="comment"># åœ¨è™šæ‹Ÿäº¤æ¢æœºä¸Šè®¾ç½®å›ºå®šIPï¼Œç”¨äºç½‘å…³IP</span></span><br><span class="line"><span class="built_in">New-NetIPAddress</span> <span class="literal">-IPAddress</span> <span class="number">10.0</span>.<span class="number">0.1</span> <span class="literal">-PrefixLength</span> <span class="number">24</span> <span class="literal">-InterfaceIndex</span> <span class="variable">$ifindex</span></span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><p>è¿›å…¥ windows è®¾ç½®ï¼Œç»™ç½‘å¡ <code>vEthernet (NAT)</code> è®¾ç½®å›ºå®š ip å’Œå­ç½‘æ©ç </p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/Snipaste_2022-01-13_09-43-03.png" alt="æ‰‹åŠ¨è®¾ç½®|520"></p></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div><h3 id="åˆ›å»º-NAT-ç½‘ç»œ"><a href="#åˆ›å»º-NAT-ç½‘ç»œ" class="headerlink" title="åˆ›å»º NAT ç½‘ç»œ"></a>åˆ›å»º NAT ç½‘ç»œ</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">New-NetNat</span> <span class="literal">-Name</span> Internal <span class="literal">-InternalIPInterfaceAddressPrefix</span> <span class="number">10.0</span>.<span class="number">0.0</span>/<span class="number">24</span></span><br></pre></td></tr></table></figure><h3 id="åˆ é™¤-NAT-ç½‘ç»œ"><a href="#åˆ é™¤-NAT-ç½‘ç»œ" class="headerlink" title="åˆ é™¤ NAT ç½‘ç»œ"></a>åˆ é™¤ NAT ç½‘ç»œ</h3><p>å¦‚æœä¸éœ€è¦ NAT ç½‘ç»œäº†ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥åˆ é™¤ï¼ˆNAT ç½‘ç»œåªèƒ½å­˜åœ¨ä¸€ä¸ªï¼‰ã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Get-NetNat</span>                  <span class="comment"># NATç½‘ç»œä¿æŒä¸€ä¸ªå°±è¡Œäº†ï¼Œå¯ä»¥åˆ é™¤åé‡æ–°åˆ›å»º</span></span><br><span class="line"><span class="built_in">Remove-NetNat</span> NAT           <span class="comment"># åˆ é™¤natç½‘ç»œ</span></span><br></pre></td></tr></table></figure><h2 id="æ–¹æ¡ˆäºŒ-åˆ›å»ºä¸€ä¸ªä»…å†…ç½‘äº¤æ¢æœº"><a href="#æ–¹æ¡ˆäºŒ-åˆ›å»ºä¸€ä¸ªä»…å†…ç½‘äº¤æ¢æœº" class="headerlink" title="æ–¹æ¡ˆäºŒ: åˆ›å»ºä¸€ä¸ªä»…å†…ç½‘äº¤æ¢æœº"></a>æ–¹æ¡ˆäºŒ: åˆ›å»ºä¸€ä¸ªä»…å†…ç½‘äº¤æ¢æœº</h2><h3 id="åˆ›å»ºä¸€ä¸ªå†…éƒ¨äº¤æ¢æœº"><a href="#åˆ›å»ºä¸€ä¸ªå†…éƒ¨äº¤æ¢æœº" class="headerlink" title="åˆ›å»ºä¸€ä¸ªå†…éƒ¨äº¤æ¢æœº"></a>åˆ›å»ºä¸€ä¸ªå†…éƒ¨äº¤æ¢æœº</h3><p>è¿›å…¥ Hyper-V è™šæ‹Ÿäº¤æ¢æœºç®¡ç†å™¨, åˆ›å»ºä¸€ä¸ªå†…éƒ¨è™šæ‹Ÿäº¤æ¢æœº</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202309141440799.png" alt="image.png|431"></p><h3 id="ä¿®æ”¹ç½‘å¡-IP-ä¿¡æ¯"><a href="#ä¿®æ”¹ç½‘å¡-IP-ä¿¡æ¯" class="headerlink" title="ä¿®æ”¹ç½‘å¡ IP ä¿¡æ¯"></a>ä¿®æ”¹ç½‘å¡ IP ä¿¡æ¯</h3><p>åœ¨ æ§åˆ¶é¢æ¿ â€“ æ›´æ”¹é€‚é…å™¨è®¾ç½®ç•Œé¢, ç»™å†…éƒ¨è™šæ‹Ÿäº¤æ¢æœºè¿™ä¸ªç½‘å¡è®¾ç½® IP åœ°å€, åªéœ€è¦è®¾ç½® IP å’Œæ©ç å³å¯.</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202309141439136.png" alt="image.png|641"></p><h3 id="è™šæ‹Ÿæœºå¢åŠ ç½‘å¡"><a href="#è™šæ‹Ÿæœºå¢åŠ ç½‘å¡" class="headerlink" title="è™šæ‹Ÿæœºå¢åŠ ç½‘å¡"></a>è™šæ‹Ÿæœºå¢åŠ ç½‘å¡</h3><p>åœ¨è™šæ‹Ÿæœºè®¾ç½®ç•Œé¢, å¢åŠ ä¸€ä¸ªæ–°çš„ç½‘ç»œé€‚é…å™¨, äº¤æ¢æœºé€‰æ‹©å†…éƒ¨è™šæ‹Ÿäº¤æ¢æœº</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202309141440651.png" alt="image.png|478"></p><h3 id="æ“ä½œç³»ç»Ÿç½‘å¡é…ç½®å›ºå®š-IP"><a href="#æ“ä½œç³»ç»Ÿç½‘å¡é…ç½®å›ºå®š-IP" class="headerlink" title="æ“ä½œç³»ç»Ÿç½‘å¡é…ç½®å›ºå®š IP"></a>æ“ä½œç³»ç»Ÿç½‘å¡é…ç½®å›ºå®š IP</h3><p>æ­¤æ—¶åœ¨æ“ä½œç³»ç»Ÿä¸­, ä¼šå¤šå‡ºæ¥ä¸€å¼ ç½‘å¡, å¤šå‡ºæ¥çš„ç½‘å¡é…ç½®ä¸€ä¸‹å›ºå®š IP å’Œæ©ç å³å¯, IP å’Œäº¤æ¢æœºåœ¨åŒä¸€ä¸ªç½‘æ®µ, ä¸è¦é‡å¤.<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202309141443040.png" alt="image.png|593"></p><p>æ­¤æ—¶ä¸»æœºå¯ä»¥é€šè¿‡ 172.16.0.8 è¿™ä¸ªåœ°å€è®¿é—®è™šæ‹Ÿæœº, è™šæ‹Ÿæœºä¹Ÿå¯ä»¥é€šè¿‡ 172.16.0.1 è®¿é—®ä¸»æœº</p><h2 id="æ–¹æ¡ˆä¸‰-ä½¿ç”¨å¤–éƒ¨ç½‘ç»œ"><a href="#æ–¹æ¡ˆä¸‰-ä½¿ç”¨å¤–éƒ¨ç½‘ç»œ" class="headerlink" title="æ–¹æ¡ˆä¸‰: ä½¿ç”¨å¤–éƒ¨ç½‘ç»œ"></a>æ–¹æ¡ˆä¸‰: ä½¿ç”¨å¤–éƒ¨ç½‘ç»œ</h2><p>åˆ›å»ºå¤–éƒ¨è™šæ‹Ÿæœºäº¤æ¢æœº, é€‰æ‹©ä¸€ä¸‹æ¡¥æ¥çš„ç½‘å¡, è¿™ç§æ–¹å¼è™šæ‹Ÿæœºä¹Ÿä¼šè·å¾—ä¸€ä¸ª IP åœ°å€, è™šæ‹Ÿæœºå°±ä¼šåƒä¸»æœºä¸€æ ·å¯ä»¥å¯¹å¤–æä¾›æœåŠ¡, å¸¸ç”¨äºæœåŠ¡å™¨</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202309141444528.png" alt="image.png|429"></p><p>æ“ä½œç³»ç»Ÿå†…è®¾ç½®å¤–éƒ¨è™šæ‹Ÿäº¤æ¢æœºç½‘å¡å³å¯.</p>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hyper-V </tag>
            
            <tag> VirtualMachine </tag>
            
            <tag> Windows </tag>
            
            <tag> Command </tag>
            
            <tag> PowerShell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxçš„crontabæ— æ³•æ‰§è¡Œçš„ä¸€äº›é—®é¢˜</title>
      <link href="/posts/63d10d9c/"/>
      <url>/posts/63d10d9c/</url>
      
        <content type="html"><![CDATA[<p>crontab æ˜¯ linux å¹³å°çš„å®šæ—¶ä»»åŠ¡ç³»ç»Ÿï¼Œä¸è¿‡æœ‰æ—¶å€™å¯ä»¥è¿è¡Œçš„å‘½ä»¤æˆ–è„šæœ¬åœ¨ crontab é‡Œé¢å°±æ˜¯ä¸è¿è¡Œï¼Œä¸‹é¢æ‰¾äº†ä¸€äº›å¯èƒ½çš„åŸå› ä»¥åŠè§£å†³æ–¹æ¡ˆã€‚</p><h2 id="çœ‹ä¸åˆ°æ—¥å¿—"><a href="#çœ‹ä¸åˆ°æ—¥å¿—" class="headerlink" title="çœ‹ä¸åˆ°æ—¥å¿—"></a>çœ‹ä¸åˆ°æ—¥å¿—</h2><p>ä¸€èˆ¬æ¥è¯´ï¼Œcrontab çš„ä»»åŠ¡æ§åˆ¶å°è¾“å‡ºä¼šæ‰“åˆ° <code>/var/spool/mail/&lt;username&gt;</code> é‡Œé¢ï¼Œç„¶åé€šè¿‡ email å‘å‡ºå»<br><code>crontab</code> æœåŠ¡çš„è¿è¡Œçš„æ—¥å¿—ä¸€èˆ¬éƒ½åœ¨ <code>/var/log/cron</code> é‡Œé¢ï¼Œè¿™ä¸ªæ—¥å¿—å¯ä»¥çœ‹åˆ°ä»»åŠ¡æœ‰æ²¡æœ‰æ‰§è¡Œ</p><p>å¦‚æœæƒ³å°†å‘½ä»¤è¾“å‡ºå†…å®¹é‡å®šå‘åˆ°å…¶ä»–æ–‡ä»¶ï¼Œå¯ä»¥åœ¨å‘½ä»¤åæ·»åŠ  <code> &gt;&gt; xxx.log 2&gt;&amp;1</code>, ä¸åŠ  <code>2&gt;&amp;1</code> é”™è¯¯æ—¥å¿—çœ‹ä¸åˆ°</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* * * * * <span class="built_in">date</span> &gt;&gt; /tmp/cron.log 2&gt;&amp;1</span><br></pre></td></tr></table></figure><h2 id="ç¯å¢ƒå˜é‡çš„é—®é¢˜"><a href="#ç¯å¢ƒå˜é‡çš„é—®é¢˜" class="headerlink" title="ç¯å¢ƒå˜é‡çš„é—®é¢˜"></a>ç¯å¢ƒå˜é‡çš„é—®é¢˜</h2><p>crontab ç¯å¢ƒå˜é‡å’Œç™»å½• shell æŸ¥çœ‹çš„ç¯å¢ƒå˜é‡æ˜¯ä¸åŒçš„ï¼Œæ¯”å¦‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* * * * * <span class="built_in">env</span> &gt;&gt; /tmp/env.log 2&gt;&amp;1</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹ä¸€ä¸‹ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">HOME</span>=/home/iuxt</span><br><span class="line"><span class="attr">LOGNAME</span>=iuxt</span><br><span class="line"><span class="attr">PATH</span>=/usr/bin:/bin</span><br><span class="line"><span class="attr">LANG</span>=C.UTF-<span class="number">8</span></span><br><span class="line"><span class="attr">SHELL</span>=/bin/sh</span><br><span class="line"><span class="attr">PWD</span>=/home/iuxt</span><br></pre></td></tr></table></figure><p>æ¯”ç³»ç»Ÿçš„ç¯å¢ƒå˜é‡è¦å°‘å¾ˆå¤šï¼Œæ¯”å¦‚ PATH åªæœ‰ <code>/usr/bin</code> å’Œ <code>/bin</code>ï¼Œ å®‰è£…åœ¨å…¶ä»–ä½ç½®çš„ç¨‹åºæ˜¯ä¼š <code>command not found</code> çš„ï¼Œè§£å†³æ–¹æ³•æœ‰ä¸¤ä¸ªï¼š</p><ol><li><p>å†™ç»å¯¹è·¯å¾„</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* * * * * /usr/bin/env &gt;&gt; /tmp/env.log 2&gt;&amp;1</span><br></pre></td></tr></table></figure><blockquote><p>ä½†æ˜¯è¿™ä¸ªæ–¹æ³•å¯¹äºå¾ˆå¤šè„šæœ¬æ¯”è¾ƒéº»çƒ¦ï¼Œå› ä¸ºè„šæœ¬é‡Œé¢å¯èƒ½ç”¨çš„æ˜¯ç›¸å¯¹è·¯å¾„ä¹Ÿä¼š <code>command not found</code> çš„</p></blockquote></li><li><p>crontab çš„é¦–éƒ¨æ·»åŠ éœ€è¦çš„ç¯å¢ƒå˜é‡</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</span><br><span class="line">SHELL=/bin/bash</span><br><span class="line">LANG=en_US.UTF-8</span><br><span class="line">* * * * * <span class="built_in">env</span> &gt;&gt; /tmp/env.log 2&gt;&amp;1</span><br></pre></td></tr></table></figure></li><li><p>åœ¨å‘½ä»¤çš„å‰æ–¹æ·»åŠ ç¯å¢ƒå˜é‡</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* * * * * TEST=XXX env &gt;&gt; /tmp/env.log 2&gt;&amp;1</span><br></pre></td></tr></table></figure></li><li><p>æŠŠå‘½ä»¤æ”¾è¿› shell è„šæœ¬é‡Œï¼Œåœ¨è„šæœ¬é¡¶éƒ¨å£°æ˜ç¯å¢ƒå˜é‡</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</span><br></pre></td></tr></table></figure></li></ol><h2 id="æƒé™é—®é¢˜"><a href="#æƒé™é—®é¢˜" class="headerlink" title="æƒé™é—®é¢˜"></a>æƒé™é—®é¢˜</h2><p>è¿™ä¸ªæ¯”è¾ƒå¥½ç†è§£äº†ï¼Œcrontab ä¹Ÿæ˜¯åˆ†ç”¨æˆ·æ‰§è¡Œçš„<br>cron é…ç½®æ–‡ä»¶åœ¨ <code>/var/spool/cron/ç”¨æˆ·å</code>(redhat ç³»)ï¼Œæ²¡æœ‰æƒé™è®¿é—®å¯æ‰§è¡Œæ–‡ä»¶ï¼Œæˆ–è€…æ²¡æœ‰æƒé™ç”Ÿæˆä¸´æ—¶æ–‡ä»¶ç­‰éƒ½ä¼šå¯¼è‡´ crontab æ‰§è¡Œå¤±è´¥ã€‚</p><p>ä½¿ç”¨ crontab ç¼–è¾‘çš„æ—¶å€™å¯ä»¥æŒ‡å®šç”¨æˆ·</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">crontab -u iuxt -e</span><br></pre></td></tr></table></figure><h2 id="æ¢è¡Œç¬¦"><a href="#æ¢è¡Œç¬¦" class="headerlink" title="æ¢è¡Œç¬¦"></a>æ¢è¡Œç¬¦</h2><p>è¿™ä¸ªæ¯”è¾ƒå‘äº†ï¼Œman crontab è§£é‡Šå¦‚ä¸‹ï¼š</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Although cron requires that each entry in a crontab end in a newline character, neither the crontab command nor the cron daemon will detect this error. Instead, the crontab will appear to load normally. However, the command will never run. The best choice is to ensure that your crontab has a blank line at the end.</span><br><span class="line"></span><br><span class="line">4th Berkeley Distribution 29 December 1993 CRONTAB(1)</span><br></pre></td></tr></table></figure><p>æ¯ä¸€æ¡ cron è¡¨è¾¾å¼éƒ½è¦ä»¥æ¢è¡Œç¬¦ç»“å°¾ï¼Œä¿é™©èµ·è§ crontab æœ€åç•™ä¸€ä¸ªç©ºè¡Œå§ã€‚</p><h2 id="æœåŠ¡æ²¡å¯åŠ¨"><a href="#æœåŠ¡æ²¡å¯åŠ¨" class="headerlink" title="æœåŠ¡æ²¡å¯åŠ¨"></a>æœåŠ¡æ²¡å¯åŠ¨</h2><p>crontab æœåŠ¡ crond æ²¡æœ‰å¯åŠ¨</p><p>å¯åŠ¨ <code>servicd crond start</code></p><h2 id="æ—¶åŒºé—®é¢˜"><a href="#æ—¶åŒºé—®é¢˜" class="headerlink" title="æ—¶åŒºé—®é¢˜"></a>æ—¶åŒºé—®é¢˜</h2><p>ä¿®æ”¹æ—¶åŒºåéœ€è¦é‡å¯ crond æœåŠ¡æ‰èƒ½ä»¥æ–°çš„æ—¶åŒºä¸ºå‡†ã€‚</p><h2 id="è·¯å¾„é—®é¢˜"><a href="#è·¯å¾„é—®é¢˜" class="headerlink" title="è·¯å¾„é—®é¢˜"></a>è·¯å¾„é—®é¢˜</h2><p>è„šæœ¬é‡Œé¢å†™ç»å¯¹è·¯å¾„æ²¡é—®é¢˜ï¼Œå†™ç›¸å¯¹è·¯å¾„å°±ä¼šé€ æˆè„šæœ¬æ‰§è¡Œä¸å¯¹ï¼Œæ¯”å¦‚ä¸€ä¸ªè„šæœ¬ä¼šå†™å…¥æ–‡ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿›å…¥è„šæœ¬æ‰€åœ¨ç›®å½•</span></span><br><span class="line"><span class="built_in">cd</span> <span class="string">&quot;<span class="subst">$(dirname <span class="string">&quot;<span class="variable">$0</span>&quot;</span>)</span>&quot;</span></span><br><span class="line"></span><br><span class="line">NOW=$(<span class="built_in">date</span> +<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>)</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$NOW</span> &gt;&gt; log.log</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸åŠ  <code>cd &quot;$(dirname &quot;$0&quot;)&quot;</code> é‚£ä¹ˆ crontab ä¼šå°† log.log æ–‡ä»¶å†™å…¥åˆ° Home ç›®å½•ï¼ŒåŠ ä¸Š <code>cd &quot;$(dirname &quot;$0&quot;)&quot;</code> ä¼šå…ˆè¿›å…¥åˆ°è„šæœ¬æ‰€åœ¨ç›®å½•å†æ‰§è¡Œã€‚</p>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Crontab </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸¤å°è®¡ç®—æœºç›´æ¥ä¼ è¾“æ–‡ä»¶çš„å‡ ç§æ–¹å¼</title>
      <link href="/posts/2c246a61/"/>
      <url>/posts/2c246a61/</url>
      
        <content type="html"><![CDATA[<p>è¿™é‡Œçš„è®¡ç®—æœºæŒ‡çš„æ˜¯å¹¿ä¹‰ä¸Šçš„è®¡ç®—æœºï¼ŒåŒ…æ‹¬ä½†ä¸é™äºå®¶ç”¨ç”µè„‘ã€æœåŠ¡å™¨ã€æ‰‹æœºã€æ ‘è“æ´¾ç­‰ç­‰</p><h2 id="scp"><a href="#scp" class="headerlink" title="scp"></a>scp</h2><blockquote><p>scp ä½¿ç”¨çš„æ˜¯ SSH ç«¯å£</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ‹·è´æœ¬åœ°æ–‡ä»¶testfileåˆ°192.168.1.100çš„/tmpç›®å½•ä¸‹</span></span><br><span class="line">scp testfile root@192.168.1.100:/tmp</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‹·è´æœ¬åœ°æ–‡ä»¶å¤¹åˆ°192.168.1.100çš„/tmpç›®å½•ä¸‹</span></span><br><span class="line">scp -r testfolder root@192.168.1.100:/tmp</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‹·è´è¿œç¨‹åˆ°æœ¬åœ°</span></span><br><span class="line">scp root@192.168.1.100:/tmp/testfile .</span><br></pre></td></tr></table></figure><h2 id="ftp"><a href="#ftp" class="headerlink" title="ftp"></a>ftp</h2><blockquote><p>ftp æ§åˆ¶ç«¯å£æ˜¯ 21ï¼Œç”¨äºè´¦å·å¯†ç è®¤è¯ä»¥åŠåå•†ç«¯å£ç­‰ã€‚<br>ä¸»åŠ¨æ¨¡å¼ï¼šæ•°æ®ç«¯å£æ˜¯ 20<br>è¢«åŠ¨æ¨¡å¼ï¼šå®¢æˆ·ç«¯å¯æœåŠ¡ç«¯åå•†ä¸€ä¸ªç«¯å£</p></blockquote><p>ä½¿ç”¨ Python ç®€å•æ­å»ºä¸€ä¸ª ftp æœåŠ¡å™¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip3 install pyftpdlib</span><br><span class="line">python3 -m pyftpdlib -p 21</span><br></pre></td></tr></table></figure><h2 id="sftp"><a href="#sftp" class="headerlink" title="sftp"></a>sftp</h2><blockquote><p>sftp æ˜¯å®‰å…¨çš„ ftpï¼Œèµ°çš„æ˜¯ SSH åè®®</p></blockquote><h3 id="sftp-å¸¸ç”¨å‘½ä»¤"><a href="#sftp-å¸¸ç”¨å‘½ä»¤" class="headerlink" title="sftp å¸¸ç”¨å‘½ä»¤"></a>sftp å¸¸ç”¨å‘½ä»¤</h3><table><thead><tr><th>å‘½ä»¤</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td>cd path</td><td>Change remote directory to â€˜pathâ€™</td></tr><tr><td>get [-afpR] remote [local]</td><td>Download file</td></tr><tr><td>help</td><td>Display this help text</td></tr><tr><td>lcd path</td><td>Change local directory to â€˜pathâ€™</td></tr><tr><td>lls [ls-options [path]]</td><td>Display local directory listing</td></tr><tr><td>lmkdir path</td><td>Create local directory</td></tr><tr><td>ln [-s] oldpath newpath</td><td>Link remote file (-s for symlink)</td></tr><tr><td>lpwd</td><td>Print local working directory</td></tr><tr><td>ls [-1afhlnrSt] [path]</td><td>Display remote directory listing</td></tr><tr><td>mkdir path</td><td>Create remote directory</td></tr><tr><td>put [-afpR] local [remote]</td><td>Upload file</td></tr><tr><td>pwd</td><td>Display remote working directory</td></tr><tr><td>reget [-fpR] remote [local]</td><td>Resume download file</td></tr><tr><td>reput [-fpR] local [remote]</td><td>Resume upload file</td></tr><tr><td>rm path</td><td>Delete remote file</td></tr><tr><td>rmdir path</td><td>Remove remote directory</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sftp root@192.168.1.100</span><br><span class="line"><span class="comment"># å¯ä»¥ç”¨cd lsç­‰å‘½ä»¤ï¼Œæ‰¾åˆ°æ–‡ä»¶åä½¿ç”¨getä¸‹è½½</span></span><br><span class="line">get testfile</span><br></pre></td></tr></table></figure><h2 id="rsync"><a href="#rsync" class="headerlink" title="rsync"></a>rsync</h2><h3 id="ä½¿ç”¨-ssh-åè®®ä¼ è¾“"><a href="#ä½¿ç”¨-ssh-åè®®ä¼ è¾“" class="headerlink" title="ä½¿ç”¨ ssh åè®®ä¼ è¾“"></a>ä½¿ç”¨ ssh åè®®ä¼ è¾“</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rsync -avz <span class="built_in">source</span>/ user@remote_host:/destination</span><br></pre></td></tr></table></figure><p>å¦‚æœ ssh æœ‰å…¶ä»–å‚æ•°ï¼Œéœ€è¦ç‰¹æ®ŠæŒ‡å®š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rsync -avz -e <span class="string">&#x27;ssh -p 2234&#x27;</span> <span class="built_in">source</span>/ user@remote_host:/destination</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨-rsync-åè®®ä¼ è¾“"><a href="#ä½¿ç”¨-rsync-åè®®ä¼ è¾“" class="headerlink" title="ä½¿ç”¨ rsync åè®®ä¼ è¾“"></a>ä½¿ç”¨ rsync åè®®ä¼ è¾“</h3><blockquote><p>ä½¿ç”¨ rsync åè®®éœ€è¦å¯¹æ–¹å®‰è£… rsync å®ˆæŠ¤ç¨‹åº</p></blockquote><p>ä½¿ç”¨ rsync:&#x2F;&#x2F;åè®®ï¼ˆé»˜è®¤ç«¯å£ 873ï¼‰è¿›è¡Œä¼ è¾“ã€‚å…·ä½“å†™æ³•æ˜¯æœåŠ¡å™¨ä¸ç›®æ ‡ç›®å½•ä¹‹é—´ä½¿ç”¨åŒå†’å·åˆ†éš”::ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rsync -av <span class="built_in">source</span>/ 192.168.122.32::module/destination</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œä¸Šé¢åœ°å€ä¸­çš„ module å¹¶ä¸æ˜¯å®é™…è·¯å¾„åï¼Œè€Œæ˜¯ rsync å®ˆæŠ¤ç¨‹åºæŒ‡å®šçš„ä¸€ä¸ªèµ„æºåï¼Œç”±ç®¡ç†å‘˜åˆ†é…ã€‚</p><p>å¦‚æœæƒ³çŸ¥é“ rsync å®ˆæŠ¤ç¨‹åºåˆ†é…çš„æ‰€æœ‰ module åˆ—è¡¨ï¼Œå¯ä»¥æ‰§è¡Œä¸‹é¢å‘½ä»¤ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rsync rsync://192.168.122.32</span><br></pre></td></tr></table></figure><p>rsync åè®®é™¤äº†ä½¿ç”¨åŒå†’å·ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ç”¨ rsync:&#x2F;&#x2F;åè®®æŒ‡å®šåœ°å€ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rsync -av <span class="built_in">source</span>/ rsync://192.168.122.32/module/destination</span><br></pre></td></tr></table></figure><h3 id="æ’é™¤"><a href="#æ’é™¤" class="headerlink" title="æ’é™¤"></a>æ’é™¤</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rsync -av --exclude <span class="string">&quot;snapshot&quot;</span> /var/lib/cass ./bak/</span><br></pre></td></tr></table></figure><h2 id="http"><a href="#http" class="headerlink" title="http"></a>http</h2><p>ä½¿ç”¨ python æ­å»ºä¸€ä¸ªç®€å•çš„ http æœåŠ¡</p><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">Python 2.x</button><button type="button" class="tab">Python 3.x</button></div><div class="tab-contents"><div class="tab-item-content active"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m SimpleHTTPServer 8000</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m http.server 8000</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div><h2 id="nc"><a href="#nc" class="headerlink" title="nc"></a>nc</h2><p>ä¼˜ç‚¹ï¼šæ–¹ä¾¿ã€å¯ä»¥ä½¿ç”¨ udp ç«¯å£è¢«è¿›è¡Œä¼ è¾“</p><p>åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nc -l 1234      <span class="comment"># ç›‘å¬tcp 1234ç«¯å£</span></span><br><span class="line">nc -lu 1234     <span class="comment"># ç›‘å¬udp 1234ç«¯å£</span></span><br></pre></td></tr></table></figure><p>åœ¨å®¢æˆ·ç«¯æ‰§è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nc 10.0.0.131 1234      <span class="comment"># é€šè¿‡tcpè¿æ¥æœåŠ¡å™¨</span></span><br><span class="line">nc 10.0.0.131 -u 1234   <span class="comment"># é€šè¿‡udpè¿æ¥æœåŠ¡å™¨</span></span><br></pre></td></tr></table></figure><p>è¿æ¥ä¸Šåï¼Œåœ¨æ§åˆ¶å°è¾“å…¥æ–‡å­—ï¼ŒæœåŠ¡å™¨ç«¯ä¼šæ˜¾ç¤º</p><p>åŒæ ·çš„ï¼Œå¯ä»¥æŠŠæ§åˆ¶å°çš„æ•°æ®é‡å®šå‘åˆ°æ–‡ä»¶ï¼Œå°±å¯ä»¥å®ç°æ–‡ä»¶çš„ä¼ è¾“äº†</p><p>æ¥å—æ–‡ä»¶ç«¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -l 1234 &gt; file.txt</span><br></pre></td></tr></table></figure><p>ä¼ é€æ–‡ä»¶ç«¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc 10.0.0.131 1234 &lt; file.txt</span><br></pre></td></tr></table></figure><h2 id="smb-æˆ–-nfs-ç­‰"><a href="#smb-æˆ–-nfs-ç­‰" class="headerlink" title="smb æˆ– nfs ç­‰"></a>smb æˆ– nfs ç­‰</h2><p><a href="/4b677f68">æ­å»ºNFSæœåŠ¡</a></p><h2 id="lrzsz"><a href="#lrzsz" class="headerlink" title="lrzsz"></a>lrzsz</h2><p>lrzsz å¯ä»¥åœ¨è¿æ¥ç»ˆç«¯çš„æ—¶å€™ç›´æ¥è¿›è¡Œæ–‡ä»¶ä¼ è¾“ï¼Œæ¯”è¾ƒæ–¹ä¾¿ï¼Œä½†æ˜¯å¯¹ç»ˆç«¯æœ‰è¦æ±‚ï¼Œåœ¨ windows ç«¯æœ‰ xshell å¯ä»¥æ”¯æŒï¼ŒLinux ä¸­ kde çš„ konsole å¯ä»¥æ”¯æŒã€‚lrzsz é€Ÿåº¦æ²¡æœ‰ scp å¿«ï¼Œä½†æ˜¯åœ¨è¿æ¥äº† ssh çš„æ—¶å€™æ¯”è¾ƒæ–¹ä¾¿ã€‚æ¯”è¾ƒé€‚åˆä¼ è¾“å°æ–‡ä»¶ï¼Œå¤§æ–‡ä»¶ä¼šæ¯”è¾ƒå®¹æ˜“å‡ºé”™ã€‚</p><p>xshell ç”šè‡³å¯ä»¥ç›´æ¥æ‹–æ–‡ä»¶åˆ°ç»ˆç«¯çª—å£å®Œæˆä¸Šä¼ æ“ä½œ</p><p>è¿œç¨‹æœåŠ¡å™¨å®‰è£…åŒ…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y lrzsz</span><br></pre></td></tr></table></figure><p>ä¸Šä¼ æ–‡ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rz</span><br></pre></td></tr></table></figure><p>ä¸‹è½½æ–‡ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sz testfile</span><br></pre></td></tr></table></figure><h2 id="ç›´æ¥ä½¿ç”¨-SSH-åŠ ç®¡é“æ¥ä¼ è¾“"><a href="#ç›´æ¥ä½¿ç”¨-SSH-åŠ ç®¡é“æ¥ä¼ è¾“" class="headerlink" title="ç›´æ¥ä½¿ç”¨ SSH åŠ ç®¡é“æ¥ä¼ è¾“"></a>ç›´æ¥ä½¿ç”¨ SSH åŠ ç®¡é“æ¥ä¼ è¾“</h2><blockquote><p>å¤§å®¶çŸ¥é“ Linux ç®¡é“å¯ä»¥ä¼ è¾“æ•°æ®ï¼Œå¦‚æœç®¡é“å’Œ SSH é…åˆä½¿ç”¨çš„è¯ï¼Œä¹Ÿå¯ä»¥è¾¾åˆ°ä¼ è¾“æ–‡ä»¶çš„æ•ˆæœï¼Œæ¯”å¦‚ï¼š</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> 1.txt| ssh iuxt@10.0.0.9 <span class="string">&quot;cd /tmp &amp;&amp; cat &gt; 1.txt&quot;</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±æ˜¯æŠŠä¸»æœºä¸Šçš„ 1.txt æ–‡ä»¶ä¼ è¾“åˆ° 10.0.0.9 çš„ tmp&#x2F;1.txt é‡Œé¢äº†ã€‚</p><p>è¿˜å¯ä»¥é…åˆ tar å®ç°è¾¹å‹ç¼©è¾¹ä¼ è¾“ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar zcv testfolder -f - | ssh iuxt@10.0.0.9 <span class="string">&quot;cd /tmp &amp;&amp; tar zxf -&quot;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Command </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è¿ç»´ä½¿ç”¨çš„Windowsè½¯ä»¶åˆ†äº«</title>
      <link href="/posts/spc5z0/"/>
      <url>/posts/spc5z0/</url>
      
        <content type="html"><![CDATA[<h2 id="ç»ˆç«¯å·¥å…·"><a href="#ç»ˆç«¯å·¥å…·" class="headerlink" title="ç»ˆç«¯å·¥å…·"></a>ç»ˆç«¯å·¥å…·</h2><h3 id="xshell-å…¨å®¶æ¡¶"><a href="#xshell-å…¨å®¶æ¡¶" class="headerlink" title="xshell å…¨å®¶æ¡¶"></a>xshell å…¨å®¶æ¡¶</h3><p>Xmanager Power Suite 8 æ”¯æŒ rdp åè®®è¿æ¥ windowsï¼ŒåŒ…å«å››å¤§é‡‘åˆšç»„ä»¶ï¼ˆxshell xftp xmanager xlpdï¼‰é™„ä¸Š 7 å’Œ 6 ç‰ˆæœ¬å¤‡ç”¨ã€‚ä¸è¿‡ xshell çš„ç¼ºç‚¹æ˜¯ä½¿ç”¨ rz å’Œ sz ä¸Šä¼ ä¸‹è½½æ–‡ä»¶çš„æ—¶å€™å®¹æ˜“ä¹±ç ï¼ˆæ–‡ä»¶ä¼ è¾“å¤±è´¥å¹¶ä¸”ç»ˆç«¯ä¸Šä¼šåˆ·å¾ˆå¤šä¹±ç æ–‡æœ¬ï¼‰</p><table><thead><tr><th>è½¯ä»¶å</th><th>åŒ…å«ç»„ä»¶</th><th>ä¸‹è½½åœ°å€</th></tr></thead><tbody><tr><td>xshell plus 7</td><td>åŒ…å« xshell å’Œ xftp ï¼Œè§£å‹å³ç”¨ï¼Œä¸ç”¨æ‰§è¡Œ batï¼Œä¸å†™æ³¨å†Œè¡¨ï¼Œä¸å¼¹çª—ã€‚</td><td><a href="https://github.com/iuxt/src/releases/download/ops/XshellPlus_v7.0.0023r.7z">github</a></td></tr><tr><td>Xmanager Power Suite 6</td><td>åŒ…å« xshell xftp xmanager xlpdï¼Œéœ€è¦æ‰§è¡Œ bat è„šæœ¬ï¼Œä¸å¼¹çª—ã€‚</td><td><a href="https://github.com/iuxt/src/releases/download/ops/Xmanager.Power.Suite.6.0.0029.zip">github</a></td></tr><tr><td>Xmanager Power Suite 8</td><td>åŒ…å« xshell xftp xmanager xlpdï¼Œä¸ç”¨æ‰§è¡Œ bat è„šæœ¬ï¼Œä¸å¼¹çª—ã€‚</td><td><a href="https://github.com/iuxt/src/releases/download/xmanager/Xmanager.Power.Suite.8.zip">github</a></td></tr></tbody></table><h3 id="mobaxterm"><a href="#mobaxterm" class="headerlink" title="mobaxterm"></a>mobaxterm</h3><p>å¾…å®Œå–„</p><h3 id="securecrt"><a href="#securecrt" class="headerlink" title="securecrt"></a>securecrt</h3><p>å¾…å®Œå–„</p><h3 id="tssh"><a href="#tssh" class="headerlink" title="tssh"></a>tssh</h3><p>tssh æ˜¯çº¯å‘½ä»¤è¡Œè½¯ä»¶ï¼Œå¯ä»¥åœ¨ <code>Windows Terminal</code> ä¸­è¿è¡Œï¼Œçœ‹èµ·æ¥æ›´æå®¢ä¸€ç‚¹ã€‚tssh å¯ä»¥å…¼å®¹ lrzsz ä½¿ç”¨ rz å’Œ sz ä¸Šä¼ ä¸‹è½½æ–‡ä»¶ï¼Œå¹¶ä¸”è‡ªæµ‹æ²¡æœ‰å‘ç”Ÿè¿‡ä¹±ç ã€‚</p><p>tssh å¯ä»¥ç›´æ¥ä½¿ç”¨ windows ç‰ˆæœ¬çš„ï¼Œä¹Ÿå¯ä»¥åœ¨ WSL ä¸­è¿è¡Œ Linux ç‰ˆæœ¬çš„ã€‚å…·ä½“ä½¿ç”¨æ–¹æ³•å¯ä»¥çœ‹ï¼š<a href="/posts/shqeci">trzsz ä½¿ç”¨è®°å½•</a></p><h2 id="è¿æ¥æ•°æ®åº“å·¥å…·"><a href="#è¿æ¥æ•°æ®åº“å·¥å…·" class="headerlink" title="è¿æ¥æ•°æ®åº“å·¥å…·"></a>è¿æ¥æ•°æ®åº“å·¥å…·</h2><h3 id="Navicat"><a href="#Navicat" class="headerlink" title="Navicat"></a>Navicat</h3><table><thead><tr><th>è½¯ä»¶å</th><th>ä¸‹è½½åœ°å€</th><th>æ˜¯å¦æ¨è</th></tr></thead><tbody><tr><td>Navicat Premium 17</td><td>ä¸­æ–‡ è§£å‹å³ç”¨ç‰ˆï¼Œå¯ä»¥è”ç½‘æ›´æ–°ã€‚</td><td><a href="https://github.com/iuxt/src/releases/download/navicat17/Navicat.Premium.17.zip">github</a></td></tr><tr><td>Navicat Premium 17 Portable</td><td>ä¸­æ–‡ ä¾¿æºç‰ˆï¼Œé…ç½®æ–‡ä»¶å­˜å‚¨åœ¨è½¯ä»¶ç›®å½•ã€‚æ³¨æ„ï¼šæ­¤ç‰ˆæœ¬ä¼šé€ æˆå…¶ä»–éä¾¿æºç‰ˆä¿å­˜çš„é“¾æ¥ä¸¢å¤±ï¼Œä¸è¦å’Œæ­£å¸¸ç‰ˆæœ¬å…±ç”¨ã€‚</td><td><a href="https://github.com/iuxt/src/releases/download/navicat17/Navicat.Premium.17.Portable.zip">github</a></td></tr><tr><td>Navicat 16.3.7</td><td>ä¸­æ–‡ è§£å‹å³ç”¨ç‰ˆï¼Œå¯ä»¥è”ç½‘æ›´æ–°ã€‚</td><td><a href="https://github.com/iuxt/src/releases/download/ops/Navicat.Premium.16.3.7.zip">github</a></td></tr><tr><td>Navicat 16.0.6</td><td>ä¸­æ–‡ è§£å‹å³ç”¨ç‰ˆï¼Œä¸å¯æ›´æ–°ã€‚</td><td><a href="https://github.com/iuxt/src/releases/download/ops/Navicat_16.0.6.7z">github</a></td></tr><tr><td>Navicat 12</td><td>ä¸­æ–‡ è§£å‹å³ç”¨ç‰ˆï¼Œä¸å¯æ›´æ–°ã€‚</td><td><a href="https://github.com/iuxt/src/releases/download/ops/Navicat.Premium.12.zip">github</a></td></tr></tbody></table><h3 id="sqlyog"><a href="#sqlyog" class="headerlink" title="sqlyog"></a>sqlyog</h3><p>æœ‰ç¤¾åŒºç‰ˆå’Œæ”¶è´¹ç‰ˆï¼Œä½“ç§¯å°å·§ï¼Œè¿˜ä¸é”™ã€‚</p><h3 id="HeidiSQL"><a href="#HeidiSQL" class="headerlink" title="HeidiSQL"></a>HeidiSQL</h3><p>æ˜¯ä¸ªå…è´¹è½¯ä»¶ï¼Œå®˜ç½‘åœ¨ï¼š<a href="https://www.heidisql.com/">https://www.heidisql.com/</a></p><h3 id="DBeaver"><a href="#DBeaver" class="headerlink" title="DBeaver"></a>DBeaver</h3><p>Java å†™çš„å®¢æˆ·ç«¯ï¼Œåˆé‡åˆä¸å¥½ç”¨ã€‚ä¸è¿‡æ˜¯å¼€æºè½¯ä»¶ï¼Œè·¨å¹³å°ã€‚</p><h2 id="Redis-ç®¡ç†å·¥å…·"><a href="#Redis-ç®¡ç†å·¥å…·" class="headerlink" title="Redis ç®¡ç†å·¥å…·"></a>Redis ç®¡ç†å·¥å…·</h2><p>æ–°ç‰ˆ Navicat å°±æ”¯æŒç®¡ç† Redis äº†ã€‚</p><h2 id="å‰ªåˆ‡æ¿å·¥å…·"><a href="#å‰ªåˆ‡æ¿å·¥å…·" class="headerlink" title="å‰ªåˆ‡æ¿å·¥å…·"></a>å‰ªåˆ‡æ¿å·¥å…·</h2><p>æ‰“æ‚çš„è¿ç»´éœ€è¦ç»å¸¸å¤åˆ¶ç²˜è´´ï¼Œæ‰€ä»¥ä¸€ä¸ªå¥½ç”¨çš„å‰ªåˆ‡æ¿è½¯ä»¶å¿…ä¸å¯å°‘ã€‚</p><h3 id="Windows-è‡ªå¸¦"><a href="#Windows-è‡ªå¸¦" class="headerlink" title="Windows è‡ªå¸¦"></a>Windows è‡ªå¸¦</h3><p>æŒ‰ä¸‹ <code>âŠ Win</code> + <code>v</code> å³å¯æ˜¾ç¤º</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/20241231101650495.png" alt="image.png"></p><h3 id="ditto"><a href="#ditto" class="headerlink" title="ditto"></a>ditto</h3><p>åœ¨å¾®è½¯å•†åº—å³å¯ä¸‹è½½ï¼Œå…è´¹è½¯ä»¶ã€‚</p><h3 id="clipboard-fusion"><a href="#clipboard-fusion" class="headerlink" title="clipboard fusion"></a>clipboard fusion</h3><p>è¿™ä¸ªè½¯ä»¶æŒºå¥½ç”¨çš„ï¼Œä¸è¿‡æœ‰å¯èƒ½æœ‰ä¸€äº›å°é—®é¢˜ï¼Œæ¯”å¦‚æœ‰æ—¶å€™å¤åˆ¶äº†ä¸Šé¢ä¸æ˜¾ç¤ºï¼Œå®ƒæ”¯æŒå°†å¸¸ç”¨çš„å›ºå®šåœ¨ä¸€ä¸ªå•ç‹¬çš„é¡µé¢ä¸Šï¼Œæ–¹ä¾¿ç›´æ¥ç²˜è´´ã€‚å¹¶ä¸”æ”¯æŒè§¦å‘å™¨ï¼Œæ¯”å¦‚åˆ é™¤æ¢è¡Œç¬¦ï¼Œåˆ é™¤ç©ºæ ¼ç­‰ã€‚åŸºæœ¬åŠŸèƒ½å…è´¹ï¼Œé«˜çº§åŠŸèƒ½æ”¶è´¹ã€‚</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/20241231101754204.png" alt="image.png|357"></p><h2 id="æˆªå›¾å·¥å…·"><a href="#æˆªå›¾å·¥å…·" class="headerlink" title="æˆªå›¾å·¥å…·"></a>æˆªå›¾å·¥å…·</h2><h3 id="Snipaste"><a href="#Snipaste" class="headerlink" title="Snipaste"></a>Snipaste</h3><p>åŸºæœ¬åŠŸèƒ½å…è´¹ï¼Œä¸“ä¸šåŠŸèƒ½æ”¶è´¹ã€‚æŒºä¸é”™çš„è½¯ä»¶ã€‚</p><h3 id="pixpin"><a href="#pixpin" class="headerlink" title="pixpin"></a>pixpin</h3><p>ä¹Ÿæ˜¯åŸºæœ¬åŠŸèƒ½å…è´¹ï¼Œä¸“ä¸šåŠŸèƒ½æ”¶è´¹ï¼Œæ”¯æŒå½• GIFï¼Œé•¿æˆªå›¾ç­‰ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨s6-Overlayæ¥ç®¡ç†å¤šè¿›ç¨‹å®¹å™¨</title>
      <link href="/posts/ea811085/"/>
      <url>/posts/ea811085/</url>
      
        <content type="html"><![CDATA[<p>å®¹å™¨ä½¿ç”¨æœ€ä½³å®è·µæ˜¯ï¼šä¸€ä¸ªå®¹å™¨è¿è¡Œä¸€ä¸ªè¿›ç¨‹ï¼Œè¿›ç¨‹é€€å‡ºå®¹å™¨ä¹Ÿå°±é€€å‡ºï¼Œå¾ˆä¼˜é›…æ˜¯ä¸æ˜¯ï¼Ÿä½†æ˜¯â€¦åœ¨æ—¥å¸¸å·¥ä½œä¸­æ€»æœ‰ä¸€äº›ä½ æ‡‚çš„çš„åŸå› ï¼Œå°±éœ€è¦å¤šä¸ªè¿›ç¨‹å¡åœ¨ä¸€ä¸ªå®¹å™¨é‡Œé¢ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æ€ä¹ˆæ¥ç®¡ç†å®¹å™¨å†…è¿›ç¨‹å‘¢ï¼Ÿè¿™ä¸ªæ—¶å€™å®¹å™¨å†…çš„è¿›ç¨‹ç®¡ç†å·¥å…·å°±æ´¾ä¸Šç”¨åœºäº†ã€‚s6-Overlay å°±æ˜¯å…¶ä¸­ä¹‹ä¸€<br>s6-Overlay å®˜æ–¹ github åœ°å€ï¼š<a href="https://github.com/just-containers/s6-overlay">https://github.com/just-containers/s6-overlay</a></p><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>å®¹å™¨æ˜¯é€šè¿‡åˆ¤æ–­ pid&#x3D;1 çš„è¿›ç¨‹æ¥åˆ¤æ–­å®¹å™¨æ˜¯å¦å·¥ä½œæ­£å¸¸çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ s6-Overlay è¿›ç¨‹ pid ä¸º 1</p><p>é€šè¿‡å®˜æ–¹å®‰è£…è„šæœ¬æ¥å®‰è£…</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> ubuntu</span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash"> https://github.com/just-containers/s6-overlay/releases/download/v2.2.0.1/s6-overlay-amd64-installer /tmp/</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">chmod</span> +x /tmp/s6-overlay-amd64-installer &amp;&amp; /tmp/s6-overlay-amd64-installer /</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get update &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    apt-get install -y nginx &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    <span class="built_in">echo</span> <span class="string">&quot;daemon off;&quot;</span> &gt;&gt; /etc/nginx/nginx.conf</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;/init&quot;</span>]</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;nginx&quot;</span>]</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·å³å¯ç”Ÿæ•ˆï¼Œå½“ nginx æŒ‚æ‰çš„æ—¶å€™ï¼Œå®¹å™¨ä¸€æ ·ä¼šé€€å‡ºçš„ã€‚</p><h2 id="é…ç½®æœåŠ¡"><a href="#é…ç½®æœåŠ¡" class="headerlink" title="é…ç½®æœåŠ¡"></a>é…ç½®æœåŠ¡</h2><p>é¦–å…ˆä¸»æœåŠ¡ï¼Œå¯ä»¥è¿™ä¹ˆç†è§£ï¼Œè¿™ä¸ªæœåŠ¡æŒ‚æ‰äº†ï¼Œæ•´ä¸ªå®¹å™¨å°±æ²¡æœ‰å­˜åœ¨çš„æ„ä¹‰äº†ï¼Œè¿™ä¸ªæœåŠ¡åº”è¯¥å†™åœ¨ CMD é‡Œé¢ï¼Œè¿™æ ·éµå¾ªå®¹å™¨è§„èŒƒã€‚</p><p>è¾…åŠ©æœåŠ¡ï¼Œåº”è¯¥æ”¾åœ¨&#x2F;etc&#x2F;service.d&#x2F;é‡Œé¢ï¼Œä»¥é¡¹ç›®ååšåŒºåˆ†ã€‚</p><p>æ–‡ä»¶ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@2ae83d42ee34:/etc/services.d# tree</span><br><span class="line">.</span><br><span class="line">|-- testapp</span><br><span class="line">|   |-- finish</span><br><span class="line">|   `-- run</span><br><span class="line">`-- testapp2</span><br><span class="line">    |-- finish</span><br><span class="line">    `-- run</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ run å’Œ finish éƒ½æ˜¯å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆbash æˆ– python æˆ–äºŒè¿›åˆ¶ç­‰ï¼‰ï¼Œå®¹å™¨å¯åŠ¨ä¼šè¿è¡Œ run ç¨‹åºï¼Œå¦‚æœ run æ„å¤–é€€å‡ºåˆ™ä¼šè¿è¡Œ finishï¼Œå¹¶ä¸”ä¼šè¢«è‡ªåŠ¨æ‹‰èµ·ã€‚æ•´ä¸ªè¿‡ç¨‹å®¹å™¨ä¸ä¼šé€€å‡ºã€‚</p><h3 id="ä¸¾ä¸ªæ —å­"><a href="#ä¸¾ä¸ªæ —å­" class="headerlink" title="ä¸¾ä¸ªæ —å­"></a>ä¸¾ä¸ªæ —å­</h3><ul><li>å®¹å™¨é‡Œé¢è¿è¡Œ crontab</li></ul><p>ä¸€èˆ¬çš„å®¹å™¨é•œåƒéƒ½æ²¡æœ‰ crontabï¼Œé¦–å…ˆå®‰è£… crontab</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install crontabs</span><br></pre></td></tr></table></figure><p>ç„¶åå®¹å™¨é‡Œé¢ç¼–å†™æœåŠ¡å¯åŠ¨è„šæœ¬ run</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">crond -f</span><br></pre></td></tr></table></figure><p>æœåŠ¡ç»“æŸè„šæœ¬ finish</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">exit</span> 0</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±å¯ä»¥åœ¨å®¹å™¨é‡Œé¢è¿è¡Œ crontab äº†</p><h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><p>çæ‰¯ä¸€å¥ï¼Œå¦‚æœæœ‰ä¸€ä¸ªç¨‹åºä¸æä¾›å‰å°è¿è¡Œçš„é€‰é¡¹ï¼Œåªèƒ½åå°è¿è¡Œï¼Œé‚£ä¹ˆåœ¨å®¹å™¨ä¸­ä¹Ÿå¯ä»¥è¿™ä¹ˆåš</p><p>å†™ä¸€ä¸ª <code>entrypoint.sh</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/sbin/sshd &amp;&amp; /bin/bash</span><br></pre></td></tr></table></figure><p>å®¹å™¨çš„ CMD æ‰§è¡Œ <code>entrypoint.sh</code> å³å¯ä¸é€€å‡ºï¼Œä½†æ˜¯é—®é¢˜æ˜¯ sshd é€€å‡ºäº†å®¹å™¨ä¹Ÿä¸ä¼šé€€å‡ºã€‚</p>]]></content>
      
      
      <categories>
          
          <category> å®¹å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Crontab </tag>
            
            <tag> Container </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Flaskä¹‹æœåŠ¡ç«¯æŒä¹…åŒ–session</title>
      <link href="/posts/f2ce6df5/"/>
      <url>/posts/f2ce6df5/</url>
      
        <content type="html"><![CDATA[<p>éœ€æ±‚å¦‚ä¸‹ï¼šå¼€å‘ä¸€ä¸ª web ç•Œé¢ï¼Œç”¨æˆ·ç»è¿‡ oauth è®¤è¯åï¼Œç»™ç”¨æˆ·ç”Ÿæˆä¸€ä¸ªéšæœºå¯†ç æ˜¾ç¤ºå‡ºæ¥ï¼Œå¹¶å°†ç”¨æˆ·åå’Œå¯†ç å‘é€ç»™ radiusserver ç”¨æ¥å½“ä½œ WIFI å¯†ç ã€‚<br>å› ä¸ºå¸Œæœ›å¯†ç ä¸è¦éšä¾¿å°±æ›´æ¢ï¼Œé‚£æ ·å‘˜å·¥å‡ºå»å†è¿›æ¥ï¼Œæ‰‹æœºå°±éœ€è¦é‡æ–°è¾“å…¥æ–°å¯†ç æ‰èƒ½è¿ WIFIï¼Œå®¹æ˜“è¢«äººæ‰“ã€‚æ‰€ä»¥ç”¨ session å­˜å‚¨çš„æ–¹å¼ï¼Œå°†å¯†ç ä¿å­˜ä¸€å®šæ—¶é—´ã€‚</p><h2 id="ä»€ä¹ˆæ˜¯-session"><a href="#ä»€ä¹ˆæ˜¯-session" class="headerlink" title="ä»€ä¹ˆæ˜¯ session"></a>ä»€ä¹ˆæ˜¯ session</h2><p>session åŸºäº cookie å®ç°ï¼Œä¿å­˜åœ¨æœåŠ¡ç«¯çš„é”®å€¼å¯¹ï¼ˆdict ç±»å‹ï¼‰ï¼ŒåŒæ—¶åœ¨æµè§ˆå™¨ä¸­çš„ cookie ä¸­ä¹Ÿå¯¹åº”ä¸€ç›¸åŒçš„éšæœºå­—ç¬¦ä¸²ï¼Œç”¨æ¥å†æ¬¡è¯·æ±‚çš„æ—¶å€™éªŒè¯<br>Flask ä¸­çš„ session æ˜¯åŠ å¯†çš„ï¼Œæ‰€ä»¥éœ€è¦é…ç½® <code>SECRET_KEY</code></p><h2 id="å¼€å§‹ä½¿ç”¨"><a href="#å¼€å§‹ä½¿ç”¨" class="headerlink" title="å¼€å§‹ä½¿ç”¨"></a>å¼€å§‹ä½¿ç”¨</h2><h3 id="å¯¼å…¥æ¨¡å—"><a href="#å¯¼å…¥æ¨¡å—" class="headerlink" title="å¯¼å…¥æ¨¡å—"></a>å¯¼å…¥æ¨¡å—</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template, request, session</span><br></pre></td></tr></table></figure><h3 id="é…ç½®-SECRET-KEY"><a href="#é…ç½®-SECRET-KEY" class="headerlink" title="é…ç½® SECRET_KEY"></a>é…ç½® SECRET_KEY</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.secret_key = os.getenv(<span class="string">&quot;SECRET_KEY&quot;</span>, <span class="string">&quot;not set key&quot;</span>)</span><br></pre></td></tr></table></figure><h3 id="è®¾ç½®-session-ç±»å‹"><a href="#è®¾ç½®-session-ç±»å‹" class="headerlink" title="è®¾ç½® session ç±»å‹"></a>è®¾ç½® session ç±»å‹</h3><p>å¯ä»¥å­˜ä¸´æ—¶æ–‡ä»¶ï¼Œè¿˜å¯ä»¥å­˜ redisã€memcachedã€mongodb ç­‰</p><p>app.config[â€˜SESSION_TYPEâ€™] &#x3D; â€˜filesystemâ€™</p><h3 id="è®¾ç½®-session-è¿‡æœŸæ—¶é—´ï¼Œé»˜è®¤æ˜¯æµè§ˆå™¨å…³é—­å°±è¿‡æœŸ"><a href="#è®¾ç½®-session-è¿‡æœŸæ—¶é—´ï¼Œé»˜è®¤æ˜¯æµè§ˆå™¨å…³é—­å°±è¿‡æœŸ" class="headerlink" title="è®¾ç½® session è¿‡æœŸæ—¶é—´ï¼Œé»˜è®¤æ˜¯æµè§ˆå™¨å…³é—­å°±è¿‡æœŸ"></a>è®¾ç½® session è¿‡æœŸæ—¶é—´ï¼Œé»˜è®¤æ˜¯æµè§ˆå™¨å…³é—­å°±è¿‡æœŸ</h3><p>app.config[â€˜PERMANENT_SESSION_LIFETIMEâ€™] &#x3D; 3600</p><h2 id="è®¾ç½®-session"><a href="#è®¾ç½®-session" class="headerlink" title="è®¾ç½® session"></a>è®¾ç½® session</h2><h3 id="æ·»åŠ -session"><a href="#æ·»åŠ -session" class="headerlink" title="æ·»åŠ  session"></a>æ·»åŠ  session</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®¾ç½®session</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">set</span>():</span><br><span class="line">    session[<span class="string">&#x27;username&#x27;</span>] = <span class="string">&#x27;zhanglikun&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;success&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="è¯»å–-session"><a href="#è¯»å–-session" class="headerlink" title="è¯»å– session"></a>è¯»å– session</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment"># è¯»å–session</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/get&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get</span>():</span><br><span class="line">    <span class="comment"># return session[&#x27;username&#x27;]</span></span><br><span class="line">    <span class="keyword">return</span> session.get(<span class="string">&#x27;username&#x27;</span>)</span><br></pre></td></tr></table></figure><blockquote><p><code>session[&#39;username&#39;]</code> å’Œ <code>session.get(&#39;username&#39;)</code> éƒ½å¯ä»¥è·å–åˆ°å€¼ï¼Œä¸åŒçš„æ˜¯:<br>session[â€˜usernameâ€™] é”®ä¸å­˜åœ¨å°±ä¼šå¼‚å¸¸<br>session.get(â€˜usernameâ€™) é”®ä¸å­˜åœ¨æ—¶è¿”å› None</p></blockquote><h3 id="åˆ é™¤-session"><a href="#åˆ é™¤-session" class="headerlink" title="åˆ é™¤ session"></a>åˆ é™¤ session</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/delete/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delete</span>():</span><br><span class="line">    <span class="built_in">print</span> session.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">    session.pop(<span class="string">&#x27;username&#x27;</span>, <span class="literal">None</span>)</span><br><span class="line">    <span class="built_in">print</span> session.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;success&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="æ¸…é™¤-session-ä¸­æ‰€æœ‰æ•°æ®"><a href="#æ¸…é™¤-session-ä¸­æ‰€æœ‰æ•°æ®" class="headerlink" title="æ¸…é™¤ session ä¸­æ‰€æœ‰æ•°æ®"></a>æ¸…é™¤ session ä¸­æ‰€æœ‰æ•°æ®</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/clear&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">clear</span>():</span><br><span class="line">    <span class="built_in">print</span> session.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">    <span class="comment"># æ¸…é™¤sessionä¸­æ‰€æœ‰æ•°æ®</span></span><br><span class="line">    session.clear()</span><br><span class="line">    <span class="built_in">print</span> session.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;success&#x27;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> Flask </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ£€æŸ¥ç«¯å£æ˜¯å¦èƒ½é€šçš„å‡ ç§æ–¹æ³•</title>
      <link href="/posts/ecf46dbb/"/>
      <url>/posts/ecf46dbb/</url>
      
        <content type="html"><![CDATA[<p>æœåŠ¡å™¨ä¸Šè¿è¡Œäº†ä¸€ä¸ªæœåŠ¡ï¼Œæƒ³æµ‹è¯•ä¸€ä¸‹ç«¯å£é€šä¸é€šï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸€äº›æ–¹æ³•æ¥æµ‹è¯•ã€‚</p><h2 id="telnet"><a href="#telnet" class="headerlink" title="telnet"></a>telnet</h2><p>å¸¸è§çš„ tcp ç«¯å£æµ‹è¯•éƒ½æ˜¯ç”¨çš„ telnetï¼Œç”¨æ³•ä¹Ÿå¾ˆç®€å•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">telnet 10.0.0.7 22</span><br></pre></td></tr></table></figure><p>æˆåŠŸä¼šæ˜¾ç¤ºï¼š</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Trying 10.0.0.7...</span><br><span class="line">Connected to 10.0.0.7.</span><br><span class="line">Escape character is &#x27;^]&#x27;.</span><br><span class="line">SSH-2.0-OpenSSH_7.4</span><br></pre></td></tr></table></figure><p>å¤±è´¥ä¼šæ˜¾ç¤ºï¼š</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Trying 10.0.0.7...</span><br><span class="line">telnet: Unable to connect to remote host: Connection refused</span><br></pre></td></tr></table></figure><h2 id="ssh"><a href="#ssh" class="headerlink" title="ssh"></a>ssh</h2><p>ä½¿ç”¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh root@localhost -p 8000</span><br></pre></td></tr></table></figure><p>å¤±è´¥ä¼šæ˜¾ç¤º</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh: connect to host localhost port 8001: Connection refused</span><br></pre></td></tr></table></figure><h2 id="curl"><a href="#curl" class="headerlink" title="curl"></a>curl</h2><p>curl ip:port</p><p>å¤±è´¥ä¼šæ˜¾ç¤º</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl: (7) Failed to connect to localhost port 8001: Connection refused</span><br></pre></td></tr></table></figure><h2 id="netcat"><a href="#netcat" class="headerlink" title="netcat"></a>netcat</h2><h3 id="æ£€æŸ¥-TCP-ç«¯å£"><a href="#æ£€æŸ¥-TCP-ç«¯å£" class="headerlink" title="æ£€æŸ¥ TCP ç«¯å£"></a>æ£€æŸ¥ TCP ç«¯å£</h3><p>ä¸‹é¢çš„å‘½ä»¤ä¼šæ£€æŸ¥è¿œç¨‹ä¸»æœºä¸Šæ˜¯å¦æ‰“å¼€äº†ç«¯å£ 80ã€22 å’Œ 9000ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -zv 192.168.2.1 80 22 9000</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥æŒ‡å®šç«¯å£æ‰«æçš„èŒƒå›´ (é€Ÿåº¦éå¸¸å¿«)ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -zv 192.168.2.1 20-9000</span><br></pre></td></tr></table></figure><h3 id="æ£€æŸ¥-UDP-ç«¯å£"><a href="#æ£€æŸ¥-UDP-ç«¯å£" class="headerlink" title="æ£€æŸ¥ UDP ç«¯å£"></a>æ£€æŸ¥ UDP ç«¯å£</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -vuz 10.16.83.10 161</span><br></pre></td></tr></table></figure><p>é€šçš„è¯, ä¼šæ˜¾ç¤º:<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202309121124086.png"></p><p>ä¸é€šçš„è¯, ä¼šæ˜¾ç¤º:<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202309121126143.png" alt="image.png"></p>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Command </tag>
            
            <tag> ç½‘ç»œ </tag>
            
            <tag> Bash </tag>
            
            <tag> æµ‹è¯• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨radiuså’ŒOpenLDAPæ¥è®¤è¯unifi AP</title>
      <link href="/posts/c0e7cc9a/"/>
      <url>/posts/c0e7cc9a/</url>
      
        <content type="html"><![CDATA[<blockquote><p>å…¬å¸ç›®å‰ç”¨çš„ WIFI æ˜¯ unifi çš„ APï¼Œå‘˜å·¥ç¦»èŒåä»ç„¶å¯ä»¥è¿æ¥å…¬å¸ WIFIï¼Œæ˜¯ä¸€ä¸ªå®‰å…¨éšæ‚£ï¼Œæ‰€ä»¥å‡†å¤‡å°† AP æ¥å…¥ radius æ¥è®¤è¯ï¼Œæ•°æ®å–è‡ª openldapï¼Œå‘˜å·¥ç¦»èŒåˆ é™¤ openldap è´¦å·å³å¯ã€‚</p></blockquote><p>æœ¬æ¬¡æ“ä½œç³»ç»Ÿä½¿ç”¨çš„æ˜¯ CentOS 7</p><h2 id="OpenLDAP"><a href="#OpenLDAP" class="headerlink" title="OpenLDAP"></a>OpenLDAP</h2><blockquote><p>å‚è€ƒæ–‡ç« ï¼š<a href="https://www.server-world.info/en/note?os=CentOS_7&amp;p=openldap">https://www.server-world.info/en/note?os=CentOS_7&amp;p=openldap</a></p></blockquote><h3 id="å®‰è£…-OpenLDAP"><a href="#å®‰è£…-OpenLDAP" class="headerlink" title="å®‰è£… OpenLDAP"></a>å®‰è£… OpenLDAP</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yum install -y openldap openldap-clients openldap-servers</span><br><span class="line"><span class="built_in">cp</span> /usr/share/openldap-servers/DB_CONFIG.example /var/lib/ldap/DB_CONFIG</span><br><span class="line"><span class="built_in">chown</span> ldap. /var/lib/ldap/DB_CONFIG</span><br><span class="line">systemctl <span class="built_in">enable</span> --now slapd</span><br></pre></td></tr></table></figure><h3 id="OpenLDAP-åŸºç¡€é…ç½®"><a href="#OpenLDAP-åŸºç¡€é…ç½®" class="headerlink" title="OpenLDAP åŸºç¡€é…ç½®"></a>OpenLDAP åŸºç¡€é…ç½®</h3><ol><li><p>ç”Ÿæˆä¸€ä¸ªå¯†ç <br> <code>slappasswd</code><br> å°†ç”Ÿæˆçš„å¯†ç å¤åˆ¶ä¿å­˜</p></li><li><p>è®¾ç½® root å¯†ç </p><p> chrootpw.ldif</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dn: olcDatabase=&#123;0&#125;config,cn=config</span><br><span class="line">changetype: modify</span><br><span class="line">add: olcRootPW</span><br><span class="line">olcRootPW: &#123;SSHA&#125;nLyOWsRyvfvC6zRBL7M2ltlutgrIgnHH</span><br></pre></td></tr></table></figure> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ldapadd -Y EXTERNAL -H ldapi:/// -f chrootpw.ldif</span><br></pre></td></tr></table></figure></li><li><p>å¯¼å…¥åŸºæœ¬ç»“æ„</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/cosine.ldif</span><br><span class="line">ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/nis.ldif</span><br><span class="line">ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/inetorgperson.ldif</span><br></pre></td></tr></table></figure></li></ol><h3 id="è®¾ç½®ç›®å½•ç®¡ç†å‘˜å¯†ç "><a href="#è®¾ç½®ç›®å½•ç®¡ç†å‘˜å¯†ç " class="headerlink" title="è®¾ç½®ç›®å½•ç®¡ç†å‘˜å¯†ç "></a>è®¾ç½®ç›®å½•ç®¡ç†å‘˜å¯†ç </h3><p>chdomain.ldif</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">dn: olcDatabase=&#123;1&#125;monitor,cn=config</span><br><span class="line">changetype: modify</span><br><span class="line">replace: olcAccess</span><br><span class="line">olcAccess: &#123;0&#125;to * by dn.base=<span class="string">&quot;gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth&quot;</span></span><br><span class="line">    <span class="built_in">read</span> by dn.base=<span class="string">&quot;cn=Manager,dc=i,dc=com&quot;</span> <span class="built_in">read</span> by * none</span><br><span class="line"></span><br><span class="line">dn: olcDatabase=&#123;2&#125;hdb,cn=config</span><br><span class="line">changetype: modify</span><br><span class="line">replace: olcSuffix</span><br><span class="line">olcSuffix: dc=i,dc=com</span><br><span class="line"></span><br><span class="line">dn: olcDatabase=&#123;2&#125;hdb,cn=config</span><br><span class="line">changetype: modify</span><br><span class="line">replace: olcRootDN</span><br><span class="line">olcRootDN: cn=Manager,dc=i,dc=com</span><br><span class="line"></span><br><span class="line">dn: olcDatabase=&#123;2&#125;hdb,cn=config</span><br><span class="line">changetype: modify</span><br><span class="line">add: olcRootPW</span><br><span class="line">olcRootPW: &#123;SSHA&#125;nLyOWsRyvfvC6zRBL7M2ltlutgrIgnHH</span><br><span class="line"></span><br><span class="line">dn: olcDatabase=&#123;2&#125;hdb,cn=config</span><br><span class="line">changetype: modify</span><br><span class="line">add: olcAccess</span><br><span class="line">olcAccess: &#123;0&#125;to attrs=userPassword,shadowLastChange by</span><br><span class="line">    dn=<span class="string">&quot;cn=Manager,dc=i,dc=com&quot;</span> write by anonymous auth by self write by * none</span><br><span class="line">olcAccess: &#123;1&#125;to dn.base=<span class="string">&quot;&quot;</span> by * <span class="built_in">read</span></span><br><span class="line">olcAccess: &#123;2&#125;to * by dn=<span class="string">&quot;cn=Manager,dc=i,dc=com&quot;</span> write by * <span class="built_in">read</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ldapmodify -Y EXTERNAL -H ldapi:/// -f chdomain.ldif</span><br></pre></td></tr></table></figure><h3 id="OpenLDAP-åˆ›å»ºç”¨æˆ·"><a href="#OpenLDAP-åˆ›å»ºç”¨æˆ·" class="headerlink" title="OpenLDAP åˆ›å»ºç”¨æˆ·"></a>OpenLDAP åˆ›å»ºç”¨æˆ·</h3><p>basedomain.ldif</p><figure class="highlight ldif"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">dn</span>: dc=i,dc=com</span><br><span class="line"><span class="attribute">objectClass</span>: top</span><br><span class="line"><span class="attribute">objectClass</span>: dcObject</span><br><span class="line"><span class="attribute">objectclass</span>: organization</span><br><span class="line"><span class="attribute">o</span>: Server World</span><br><span class="line"><span class="attribute">dc</span>: i</span><br><span class="line"></span><br><span class="line"><span class="attribute">dn</span>: cn=Manager,dc=i,dc=com</span><br><span class="line"><span class="attribute">objectClass</span>: organizationalRole</span><br><span class="line"><span class="attribute">cn</span>: Manager</span><br><span class="line"><span class="attribute">description</span>: Directory Manager</span><br><span class="line"></span><br><span class="line"><span class="attribute">dn</span>: ou=People,dc=ch,dc=com</span><br><span class="line"><span class="attribute">objectClass</span>: organizationalUnit</span><br><span class="line"><span class="attribute">ou</span>: People</span><br><span class="line"></span><br><span class="line"><span class="attribute">dn</span>: ou=Group,dc=i,dc=com</span><br><span class="line"><span class="attribute">objectClass</span>: organizationalUnit</span><br><span class="line"><span class="attribute">ou</span>: Group</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spawn ldapadd -x -D cn=Manager,dc=i,dc=com -W -f basedomain.ldif</span><br></pre></td></tr></table></figure><p>add_user.ldif</p><figure class="highlight ldif"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">dn</span>: uid=zhangsan,ou=People,dc=i,dc=com</span><br><span class="line"><span class="attribute">ou</span>: People</span><br><span class="line"><span class="attribute">uid</span>: zhangsan</span><br><span class="line"><span class="attribute">cn</span>: zhangsan</span><br><span class="line"><span class="attribute">sn</span>: zhangsan</span><br><span class="line"><span class="attribute">givenName</span>: zhangsan</span><br><span class="line"><span class="attribute">displayName</span>: zhangsan</span><br><span class="line"><span class="attribute">mail</span>: zhangsan@i.net</span><br><span class="line"><span class="attribute">objectClass</span>: person</span><br><span class="line"><span class="attribute">objectClass</span>: organizationalPerson</span><br><span class="line"><span class="attribute">objectClass</span>: inetOrgPerson</span><br><span class="line"><span class="attribute">userpassword</span>: 123456</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spawn ldapadd -x -D cn=Manager,dc=i,dc=com -W -f add_user.ldif</span><br></pre></td></tr></table></figure><h3 id="é˜²ç«å¢™æ”¾å¼€ç«¯å£"><a href="#é˜²ç«å¢™æ”¾å¼€ç«¯å£" class="headerlink" title="é˜²ç«å¢™æ”¾å¼€ç«¯å£"></a>é˜²ç«å¢™æ”¾å¼€ç«¯å£</h3><p>ç•¥</p><h2 id="FreeRadius"><a href="#FreeRadius" class="headerlink" title="FreeRadius"></a>FreeRadius</h2><h3 id="å®‰è£…-FreeRadius"><a href="#å®‰è£…-FreeRadius" class="headerlink" title="å®‰è£… FreeRadius"></a>å®‰è£… FreeRadius</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y freeradius freeradius-utils freeradius-ldap</span><br></pre></td></tr></table></figure><h3 id="é…ç½®-FreeRadius"><a href="#é…ç½®-FreeRadius" class="headerlink" title="é…ç½® FreeRadius"></a>é…ç½® FreeRadius</h3><h4 id="é…ç½®å®¢æˆ·ç«¯è¿æ¥ä¿¡æ¯"><a href="#é…ç½®å®¢æˆ·ç«¯è¿æ¥ä¿¡æ¯" class="headerlink" title="é…ç½®å®¢æˆ·ç«¯è¿æ¥ä¿¡æ¯"></a>é…ç½®å®¢æˆ·ç«¯è¿æ¥ä¿¡æ¯</h4><p>å®¢æˆ·ç«¯è¿æ¥ä¿¡æ¯ï¼š<code>/etc/raddb/clients.conf</code>ï¼Œå®¢æˆ·ç«¯ä½¿ç”¨è¿™ä¸ª <code>secret</code> æ¥è¿æ¥ <code>radius</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">client private-network-1 &#123;</span><br><span class="line">    ipaddr        = 192.168.2.0/23</span><br><span class="line">    secret        = 12345678</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="é…ç½®-LDAP-è¿æ¥ä¿¡æ¯"><a href="#é…ç½®-LDAP-è¿æ¥ä¿¡æ¯" class="headerlink" title="é…ç½® LDAP è¿æ¥ä¿¡æ¯"></a>é…ç½® LDAP è¿æ¥ä¿¡æ¯</h4><p>ldap è¿æ¥ä¿¡æ¯åœ¨ <code>/etc/raddb/mods-available/ldap</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/etc/raddb/mods-enabled</span><br><span class="line"><span class="built_in">ln</span> -s ../mods-available/ldap .</span><br></pre></td></tr></table></figure><p>ç¼–è¾‘ <code>/etc/raddb/mods-enabled/ldap</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ldap &#123;</span><br><span class="line">...</span><br><span class="line">        server = &#x27;localhost&#x27;</span><br><span class="line">        identity = &#x27;cn=Manager,dc=i,dc=com&#x27;</span><br><span class="line">        password = 123456</span><br><span class="line">        base_dn = &#x27;dc=i,dc=com&#x27;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¯åŠ¨-FreeRadius"><a href="#å¯åŠ¨-FreeRadius" class="headerlink" title="å¯åŠ¨ FreeRadius"></a>å¯åŠ¨ FreeRadius</h3><p>è°ƒè¯•æ¨¡å¼å¯åŠ¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">radiusd -X</span><br></pre></td></tr></table></figure><p>æ­£å¸¸å¯åŠ¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> --now radiusd</span><br></pre></td></tr></table></figure><h2 id="unifi"><a href="#unifi" class="headerlink" title="unifi"></a>unifi</h2><p>éœ€è¦å…ˆä¸‹è½½ <a href="https://www.ui.com/download-software/">acæ§åˆ¶å™¨</a>ï¼Œå–å¾—ç®¡ç†åå°æƒé™ã€‚</p><p>åœ¨ Settings â€“ Advanced Features â€“ Radius â€“ Add Radius Profile</p><p>æ‰“å¼€ enable Wireless é€‰é¡¹</p><p>secret ä½ç½®å¡«å†™ä¸Šé¢çš„ <code>/etc/raddb/clients.conf</code> å¯¹åº”çš„ secret</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/unifi_ac_controller_config.png" alt="AC config"></p>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Network </tag>
            
            <tag> Auth </tag>
            
            <tag> Radius </tag>
            
            <tag> OpenLDAP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å°†wslé‡Œçš„æ–‡ä»¶æŒ‚è½½è¿›è™šæ‹Ÿæœº</title>
      <link href="/posts/49e7e3c2/"/>
      <url>/posts/49e7e3c2/</url>
      
        <content type="html"><![CDATA[<blockquote><p>è™½ç„¶ä¸åŒæ“ä½œç³»ç»Ÿä½¿ç”¨èµ·æ¥å¤§è‡´ç±»ä¼¼ï¼Œå¾ˆå¤šå¼€æºè½¯ä»¶åŒæ—¶æ”¯æŒ <a href="/tags/linux/">Linux</a> å’Œ <a href="/tags/windows/">Windows</a>ï¼Œå°±ç®—ä¸æ”¯æŒï¼ŒWindows è¿˜æœ‰ <a href="/tags/cygwin/">cygwin</a> æˆ– <a href="/tags/wsl/">WSL</a>ï¼ŒLinux ä¹Ÿæœ‰ wineï¼Œä½†æ˜¯æˆ‘æ„Ÿè§‰è¿™ä¸¤ç§ç³»ç»Ÿæœ€å¤§çš„åŒºåˆ«è¿˜æ˜¯æ–‡ä»¶ç³»ç»Ÿï¼Œæ¯”å¦‚å°† Linux ä¸‹çš„æ–‡ä»¶å¤åˆ¶åˆ° Windowsï¼Œç„¶åå†å¤åˆ¶å› Linuxï¼Œå¾—åˆ°çš„æ–‡ä»¶å’ŒåŸæ¥çš„æ˜¯ä¸€æ ·çš„å—ï¼Œç­”æ¡ˆæ˜¯å¦å®šçš„ï¼Œå› ä¸ºæ–‡ä»¶æƒé™å¯èƒ½å·²ç»å‘ç”Ÿäº†å˜åŒ–ï¼Œå¦å¤– Windows çš„ NTFS å¤§å°å†™ä¸æ•æ„Ÿï¼Œå¯¼è‡´å¾ˆå¤šæ—¶å€™ä» Linux å¤åˆ¶æ–‡ä»¶åˆ° Windows çš„æ—¶å€™æ€»ä¼šå¼¹ä¸ªçª—é—®æˆ‘æ˜¯å¦è¦†ç›–ï¼Œè¿˜æœ‰ Linux çš„è½¯é“¾æ¥ä¹Ÿæ— æ³•å¤åˆ¶åˆ° Windows é‡Œé¢ã€‚<br>æœ¬äººå¹³æ—¶å†™ä»£ç ç­‰éƒ½æ˜¯åœ¨ linux ä¸Šè¿è¡Œçš„ï¼Œä¸è¿‡æœ€è¿‘ç³»ç»Ÿæ¢æˆäº† Windowsï¼Œä¸ºäº†é¿å…ä»¥ä¸Šé—®é¢˜ï¼Œå°†æ–‡ä»¶æ”¾è¿›äº† WSL é‡Œé¢ï¼ŒåŒæ—¶ç”¨åˆ°äº†è™šæ‹Ÿæœºåšæµ‹è¯•ï¼Œæ‰€ä»¥æƒ³å°† wsl å’Œè™šæ‹Ÿæœºçš„ç›®å½•è¿›è¡ŒåŒæ­¥ï¼Œæ‰æœ‰äº†è¿™ç¯‡æ–‡ç« ã€‚</p></blockquote><h2 id="åœ¨-Windows-ç¯å¢ƒä¸‹æ‰¾åˆ°æƒ³è¦å…±äº«çš„ç›®å½•"><a href="#åœ¨-Windows-ç¯å¢ƒä¸‹æ‰¾åˆ°æƒ³è¦å…±äº«çš„ç›®å½•" class="headerlink" title="åœ¨ Windows ç¯å¢ƒä¸‹æ‰¾åˆ°æƒ³è¦å…±äº«çš„ç›®å½•"></a>åœ¨ Windows ç¯å¢ƒä¸‹æ‰¾åˆ°æƒ³è¦å…±äº«çš„ç›®å½•</h2><blockquote><p>ä»¥ä¸‹ 3 ç§éƒ½å¯ä»¥</p></blockquote><ul><li>åœ¨ Windows ä¸‹å¯ä»¥è¿™æ ·è®¿é—® WSL<code>\\wsl$\å‘è¡Œç‰ˆå</code>ï¼Œæ¯”å¦‚ <code>\\wsl$\Ubuntu</code>ï¼Œå°†å®Œæ•´çš„é“¾æ¥å¤åˆ¶ä¸‹æ¥ã€‚</li><li>å°† <code>\wsl$\Ubuntu</code> æ˜ å°„åˆ°ä¸€ä¸ªè™šæ‹Ÿç›˜ç¬¦ï¼Œæ¯”å¦‚ Z:ï¼Œè¿™ç§æ–¹æ³•å¯ä»¥ç”¨åœ¨æ¯”å¦‚ <a href="/tags/vagrant/">vagrant</a> ä¸Šé¢</li></ul><h2 id="é…ç½®è™šæ‹Ÿæœºå¼€å¯å…±äº«æ–‡ä»¶å¤¹"><a href="#é…ç½®è™šæ‹Ÿæœºå¼€å¯å…±äº«æ–‡ä»¶å¤¹" class="headerlink" title="é…ç½®è™šæ‹Ÿæœºå¼€å¯å…±äº«æ–‡ä»¶å¤¹"></a>é…ç½®è™šæ‹Ÿæœºå¼€å¯å…±äº«æ–‡ä»¶å¤¹</h2><ul><li><p>VMware Workstation è™šæ‹Ÿæœº</p><p>  è™šæ‹Ÿæœºè®¾ç½® - é€‰é¡¹ - å…±äº«æ–‡ä»¶å¤¹ å¡«å†™ä¸Šä¸€æ­¥è·å–åˆ°çš„è·¯å¾„<br>  æœŸé—´ä¼šå¼¹å‡ºæç¤ºã€Šè·¯å¾„æŒ‡å‘ç½‘ç»œä½ç½®ï¼Œè¯·ç¡®ä¿å…¶åœ¨è¿è¡Œè™šæ‹Ÿæœºæ—¶å¯ä¾›è®¿é—®ã€‹ï¼Œå¿½ç•¥å³å¯ã€‚</p></li><li><p>Virtualbox è™šæ‹Ÿæœº</p><p>  è™šæ‹Ÿæœºè®¾ç½® - å…±äº«æ–‡ä»¶å¤¹ - å›ºå®šåˆ†é…, æŒ‚è½½ç‚¹ç•™ç©ºï¼Œè¿›ç³»ç»Ÿæ‰‹åŠ¨æŒ‚è½½</p></li></ul><h2 id="è™šæ‹Ÿæœºé‡ŒæŒ‚è½½ç›®å½•"><a href="#è™šæ‹Ÿæœºé‡ŒæŒ‚è½½ç›®å½•" class="headerlink" title="è™šæ‹Ÿæœºé‡ŒæŒ‚è½½ç›®å½•"></a>è™šæ‹Ÿæœºé‡ŒæŒ‚è½½ç›®å½•</h2><ul><li><p>VMware Workstation è™šæ‹Ÿæœº<br>  éœ€è¦å…ˆå®‰è£… <code>open-vm-tools</code>ï¼Œç„¶åç¼–å†™ä¸ªè„šæœ¬ <code>mount_hgfs.sh</code>ï¼š</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">/usr/bin/vmhgfs-fuse .host:/modules /etc/puppetlabs/code/modules -o subtype=vmhgfs-fuse,allow_other</span><br><span class="line">/usr/bin/vmhgfs-fuse .host:/manifests /etc/puppetlabs/code/environments/production/manifests -o subtype=vmhgfs-fuse,allow_other</span><br></pre></td></tr></table></figure><blockquote><p>allow_other æ·»åŠ çš„è¯ï¼ŒæŒ‚è½½åçš„ç›®å½•æƒé™ä¸º 777ï¼Œå³æ‰€æœ‰äººå¯è¯»å†™ï¼Œä¸åŠ çš„è¯ä»… root å¯è¯»å†™ï¼Œå…¶ä»–äººä¸å¯è¯»å†™ã€‚<br>.host:&#x2F;xxx è¿™ä¸ªæ˜¯å…±äº«åï¼Œæ˜¯åœ¨ VMware è½¯ä»¶ç•Œé¢å¡«å†™çš„ï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤ <code>vmware-hgfsclient</code> æŸ¥çœ‹ã€‚</p></blockquote></li><li><p>Virtualbox è™šæ‹Ÿæœº<br>  ä¹Ÿéœ€è¦å®‰è£… virtual guest toolsï¼Œä¸è¿‡å¯ä»¥ä½¿ç”¨ mount å‘½ä»¤æŒ‚è½½ï¼Œä¹Ÿå¯ä»¥ä¿®æ”¹ fstab è‡ªåŠ¨æŒ‚è½½</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">etc_puppetlabs_code_modules /etc/puppetlabs/code/modules vboxsf dmode=775,fmode=644,_netdev,uid=0,gid=0,_netdev 0 0</span><br><span class="line">etc_puppetlabs_code_environments_production_manifests /etc/puppetlabs/code/environments/production/manifests vboxsf dmode=775,fmode=644,_netdev,uid=0,gid=0,_netdev 0 0</span><br></pre></td></tr></table></figure></li></ul><h2 id="å¼€æœºè‡ªå¯åŠ¨æŒ‚è½½"><a href="#å¼€æœºè‡ªå¯åŠ¨æŒ‚è½½" class="headerlink" title="å¼€æœºè‡ªå¯åŠ¨æŒ‚è½½"></a>å¼€æœºè‡ªå¯åŠ¨æŒ‚è½½</h2><ul><li><p>VMware Workstation è™šæ‹Ÿæœº</p><p>  ä¿®æ”¹ root çš„ crontab</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@reboot /root/mount_hgfs.sh</span><br></pre></td></tr></table></figure></li><li><p>Virtualbox è™šæ‹Ÿæœº<br>  é€šè¿‡ fstab æ¥æŒ‚è½½ã€‚</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> VirtualMachine </tag>
            
            <tag> Windows </tag>
            
            <tag> WSL </tag>
            
            <tag> Crontab </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æœ€åä¸€ä¸ªTyporaå…è´¹ç‰ˆ0.11.18</title>
      <link href="/posts/64b52e0d/"/>
      <url>/posts/64b52e0d/</url>
      
        <content type="html"><![CDATA[<blockquote><p>Typora æ˜¯ä¸€ä¸ªæ‰€è§å³æ‰€å¾—çš„ Markdown è·¨å¹³å°å†™ä½œå·¥å…·ï¼Œç›®å‰å·²ç»å‘å¸ƒæ­£å¼ç‰ˆï¼Œå¹¶ä¸”æ›´æ”¹ä¸ºä»˜è´¹æ¨¡å¼ï¼Œ0.11.18_beta æ˜¯æœ€åä¸€ä¸ªå…è´¹çš„æµ‹è¯•ç‰ˆï¼Œæœ‰éœ€è¦çš„å¯ä»¥é€‰æ‹©ä¸‹è½½ã€‚</p></blockquote><h2 id="Windows-ç”¨æˆ·"><a href="#Windows-ç”¨æˆ·" class="headerlink" title="Windows ç”¨æˆ·"></a>Windows ç”¨æˆ·</h2><p>ä¸‹è½½åœ°å€ï¼š <del><a href="https://github.com/iuxt/src/releases/download/2.0/typora-0-11-18.exe">https://github.com/iuxt/src/releases/download/2.0/typora-0-11-18.exe</a></del></p><p>0.11.18 ç°åœ¨è¢«è¿œç¨‹æ–½æ³•äº†ï¼Œä¼šæç¤ºè¿‡æœŸæ— æ³•ä½¿ç”¨,å¯ä»¥ä½¿ç”¨ <a href="https://github.com/iuxt/src/releases/download/2.0/typora-setup-x64_0.9.96.exe">0.9.96</a> ç‰ˆ</p><h2 id="Mac-ç”¨æˆ·"><a href="#Mac-ç”¨æˆ·" class="headerlink" title="Mac ç”¨æˆ·"></a>Mac ç”¨æˆ·</h2><p>ä¸‹è½½åœ°å€ï¼š <a href="https://github.com/iuxt/src/releases/download/2.0/typora-0-11-18.dmg">https://github.com/iuxt/src/releases/download/2.0/typora-0-11-18.dmg</a></p><h2 id="Ubuntu-ç”¨æˆ·"><a href="#Ubuntu-ç”¨æˆ·" class="headerlink" title="Ubuntu ç”¨æˆ·"></a>Ubuntu ç”¨æˆ·</h2><p>ä¸‹è½½åœ°å€ï¼š<a href="https://github.com/iuxt/src/releases/download/2.0/Typora_Linux_0.11.18_amd64.deb">https://github.com/iuxt/src/releases/download/2.0/Typora_Linux_0.11.18_amd64.deb</a></p><h3 id="å®‰è£…æ–¹æ³•"><a href="#å®‰è£…æ–¹æ³•" class="headerlink" title="å®‰è£…æ–¹æ³•"></a>å®‰è£…æ–¹æ³•</h3><p>ä½¿ç”¨ apt å®‰è£…ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install ./Typora_Linux_0.11.18_amd64.deb</span><br></pre></td></tr></table></figure><h2 id="å…¶ä»–-Linux-ç”¨æˆ·ï¼ˆé-debian-ç³»ï¼‰"><a href="#å…¶ä»–-Linux-ç”¨æˆ·ï¼ˆé-debian-ç³»ï¼‰" class="headerlink" title="å…¶ä»– Linux ç”¨æˆ·ï¼ˆé debian ç³»ï¼‰"></a>å…¶ä»– Linux ç”¨æˆ·ï¼ˆé debian ç³»ï¼‰</h2><p>ä¸‹è½½åœ°å€ï¼š<a href="https://github.com/iuxt/src/releases/download/2.0/typora-0-11-18.tar.gz">https://github.com/iuxt/src/releases/download/2.0/typora-0-11-18.tar.gz</a></p><h3 id="å®‰è£…æ–¹æ³•-1"><a href="#å®‰è£…æ–¹æ³•-1" class="headerlink" title="å®‰è£…æ–¹æ³•"></a>å®‰è£…æ–¹æ³•</h3><p>è§£å‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar xf typora-0-11-18.tar.gz -C /opt/</span><br></pre></td></tr></table></figure><p>åˆ›å»ºæ¡Œé¢æ–‡ä»¶å’Œå›¾æ ‡</p><p>vim ~&#x2F;.local&#x2F;share&#x2F;applications&#x2F;typora.desktop</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Desktop Entry]</span></span><br><span class="line"><span class="attr">Name</span>=Typora</span><br><span class="line"><span class="attr">Comment</span>=A minimal Markdown reading &amp; writing app. Change Log: (https://typora.io/windows/dev_release.html)</span><br><span class="line"><span class="attr">GenericName</span>=Markdown Editor</span><br><span class="line"><span class="attr">Exec</span>=/opt/typora/Typora</span><br><span class="line"><span class="attr">Icon</span>=/opt/typora/resources/assets/icon/icon_256x256@<span class="number">2</span>x.png</span><br><span class="line"><span class="attr">Type</span>=Application</span><br><span class="line"><span class="attr">Categories</span>=<span class="literal">Off</span>ice<span class="comment">;WordProcessor;Development;</span></span><br><span class="line"><span class="attr">MimeType</span>=text/markdown<span class="comment">;text/x-markdown;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¼–è¾‘å™¨ </tag>
            
            <tag> Markdown </tag>
            
            <tag> GUI </tag>
            
            <tag> Tools </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pythonä½¿ç”¨dotenvæ¥ç®¡ç†ç¯å¢ƒå˜é‡</title>
      <link href="/posts/026f1c74/"/>
      <url>/posts/026f1c74/</url>
      
        <content type="html"><![CDATA[<blockquote><p>ç®¡ç†ç¯å¢ƒå˜é‡æ˜¯ä¸€ä»¶æ¯”è¾ƒéº»çƒ¦çš„äº‹æƒ…ï¼Œå¥½åœ¨ python æœ‰ python-dotenv å¯ä»¥å¸®åŠ©æˆ‘ä»¬æ¥ç®€åŒ–è¿™ä¸ªæ“ä½œ</p></blockquote><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>ç›´æ¥ pip æ¥å®‰è£…å°±å¥½</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install python-dotenv</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><p>åˆ›å»º.env æ–‡ä»¶ï¼Œè®°å¾—æ·»åŠ åˆ°.gitignore é‡Œé¢</p><p>.env æ–‡ä»¶å†…å®¹ä¸ºé”®å€¼å¯¹å½¢å¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#è¿™æ˜¯æ³¨é‡Š</span><br><span class="line">FOO=&quot;BAR&quot;</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> dotenv</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">dotenv.load_dotenv()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(os.getenv(<span class="string">&quot;FOO&quot;</span>))</span><br></pre></td></tr></table></figure><h2 id="shell-è„šæœ¬æ€ä¹ˆä½¿ç”¨-env-æ–‡ä»¶"><a href="#shell-è„šæœ¬æ€ä¹ˆä½¿ç”¨-env-æ–‡ä»¶" class="headerlink" title="shell è„šæœ¬æ€ä¹ˆä½¿ç”¨.env æ–‡ä»¶"></a>shell è„šæœ¬æ€ä¹ˆä½¿ç”¨.env æ–‡ä»¶</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> .<span class="built_in">env</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$FOO</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Script </tag>
            
            <tag> Shell </tag>
            
            <tag> é…ç½®æ–‡ä»¶ </tag>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¬”è®°æœ¬ç”µè„‘CPUæ€§èƒ½è¢«é”å®šåœ¨0.78GHzçš„åŸå› åŠè§£å†³æ–¹æ¡ˆ</title>
      <link href="/posts/7a7fe042/"/>
      <url>/posts/7a7fe042/</url>
      
        <content type="html"><![CDATA[<blockquote><p>å®¶é‡Œçš„æ—§ç¬”è®°æœ¬ç”µè„‘ä½¿ç”¨ç”µæ± æ­£å¸¸å·¥ä½œï¼Œä½†æ˜¯æ’ä¸Šç”µæºå°±é”é¢‘ç‡ 800MHzï¼Œéå¸¸çš„å¡ï¼ŒGoogle äº†ä¸€ä¸‹ï¼Œæ€»ç»“å¦‚ä¸‹ã€‚</p></blockquote><h2 id="å‡ºç°è¿™ç§æƒ…å†µçš„åŸå› "><a href="#å‡ºç°è¿™ç§æƒ…å†µçš„åŸå› " class="headerlink" title="å‡ºç°è¿™ç§æƒ…å†µçš„åŸå› "></a>å‡ºç°è¿™ç§æƒ…å†µçš„åŸå› </h2><blockquote><p>å¯èƒ½æ˜¯ç”±äºä¾›ç”µä¸å¥½ï¼Œæ¯”å¦‚å……ç”µå™¨éåŸè£…ï¼Œæˆ–è€…æ•£çƒ­ä¸è¡Œç³»ç»Ÿä¼šè‡ªåŠ¨é™ä½ cpu é¢‘ç‡æ¥ä¿è¯ç³»ç»Ÿç¨³å®šã€‚</p></blockquote><h2 id="ä¸€åŠ³æ°¸é€¸çš„è§£å†³æ–¹æ¡ˆ"><a href="#ä¸€åŠ³æ°¸é€¸çš„è§£å†³æ–¹æ¡ˆ" class="headerlink" title="ä¸€åŠ³æ°¸é€¸çš„è§£å†³æ–¹æ¡ˆ"></a>ä¸€åŠ³æ°¸é€¸çš„è§£å†³æ–¹æ¡ˆ</h2><ol><li>ä½¿ç”¨åŸè£…çš„å……ç”µå™¨</li><li>å®šæœŸæ¸…ç†ç¬”è®°æœ¬ç”µè„‘ç°å°˜</li><li>çœ‹çœ‹ bios é‡Œé¢æœ‰æ²¡æœ‰ç›¸å…³çš„è®¾ç½® BD PROCHOTï¼ŒæŠŠå®ƒå…³æ‰ï¼Œæˆ–è€…å‡çº§ bios è¯•è¯•çœ‹çœ‹ã€‚</li></ol><h2 id="Windows-ç³»ç»Ÿæ€ä¹ˆè§£å†³"><a href="#Windows-ç³»ç»Ÿæ€ä¹ˆè§£å†³" class="headerlink" title="Windows ç³»ç»Ÿæ€ä¹ˆè§£å†³"></a>Windows ç³»ç»Ÿæ€ä¹ˆè§£å†³</h2><p>Just download throttlestop and Disable BD PROCHOT and Turbo<br>ä¸è¿‡æ¯æ¬¡é‡å¯éƒ½éœ€è¦é‡æ–°è®¾ç½®ä¸€ä¸‹<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/throttlestop.png" alt="ThrottleStop"><br>å®˜ç½‘ä¸‹è½½åœ°å€ï¼š<a href="https://www.techpowerup.com/download/techpowerup-throttlestop/">https://www.techpowerup.com/download/techpowerup-throttlestop/</a></p><h2 id="Ubuntu-ç³»ç»Ÿæ€ä¹ˆè§£å†³"><a href="#Ubuntu-ç³»ç»Ÿæ€ä¹ˆè§£å†³" class="headerlink" title="Ubuntu ç³»ç»Ÿæ€ä¹ˆè§£å†³"></a>Ubuntu ç³»ç»Ÿæ€ä¹ˆè§£å†³</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">apt install cpufrequtils msr-tools -y</span><br><span class="line">cpufreq-set -c 0 -g performance</span><br><span class="line">cpufreq-set -c 1 -g performance</span><br><span class="line">cpufreq-set -c 2 -g performance</span><br><span class="line">cpufreq-set -c 3 -g performance</span><br><span class="line">modprobe msr</span><br><span class="line">wrmsr 0x1FC 17422</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ 0123 éœ€è¦å’Œ CPU æ ¸å¿ƒæ•°å¯¹åº”<br>éœ€è¦æ¯æ¬¡å¼€æœºéƒ½è¿è¡Œä¸€éï¼ˆéœ€è¦ ROOT æƒé™ï¼‰</p>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨typoraæ›´å¥½æ›´å¿«åœ°å†™hugoåšå®¢</title>
      <link href="/posts/b4cf69c3/"/>
      <url>/posts/b4cf69c3/</url>
      
        <content type="html"><![CDATA[<blockquote><p>hugo æ˜¯ä¸€ä¸ªé™æ€åšå®¢ç”Ÿæˆå·¥å…·ï¼Œè‡ªå·±æœ‰è‡ªå·±çš„æ–‡ä»¶ç»„ç»‡æ–¹å¼ï¼Œæ‰€ä»¥å¯¼è‡´çš„ç»“æœå°±æ˜¯ä½¿ç”¨ typora ä¸èƒ½æ­£å¸¸æ˜¾ç¤ºå›¾ç‰‡ï¼Œæ’å…¥å›¾ç‰‡ä¹Ÿä¸èƒ½æ”¾åœ¨æ­£ç¡®çš„ä½ç½®ä¸Šã€‚<br>typora å·²ç»æˆä¸ºæ”¶è´¹è½¯ä»¶äº†ï¼Œæœ‰èƒ½åŠ›è¯·æ”¯æŒæ­£ç‰ˆï¼Œæˆ–è€…ä½¿ç”¨æ—§ç‰ˆæœ¬ <a href="/64b52e0d">æœ€åä¸€ä¸ªTyporaå…è´¹ç‰ˆ0.11.18</a></p></blockquote><h2 id="å›¾ç‰‡ç®¡ç†"><a href="#å›¾ç‰‡ç®¡ç†" class="headerlink" title="å›¾ç‰‡ç®¡ç†"></a>å›¾ç‰‡ç®¡ç†</h2><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/typora_config_image.png" alt="typoraé…ç½®å›¾ç‰‡ä½ç½®"></p><p>æŒ‰ç…§å›¾ç¤ºè®¾ç½®åï¼Œå³å¯æ­£å¸¸æ˜¾ç¤ºå›¾ç‰‡ï¼Œå¤åˆ¶ç²˜è´´å›¾ç‰‡ä¹Ÿèƒ½å¤åˆ¶åˆ°æ­£ç¡®çš„ä½ç½®ï¼Œè®¾ç½®å®Œæˆåï¼Œå‘ç° markdown çš„ frontmatter å¢åŠ äº† 2 è¡Œï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">typora-root-url:</span> <span class="string">../../static</span></span><br><span class="line"><span class="attr">typora-copy-images-to:</span> <span class="string">../../static/img</span></span><br></pre></td></tr></table></figure><p>æ„æ€æ˜¯å°†å›¾ç‰‡æ”¾åœ¨ static çš„ img ç›®å½•é‡Œã€‚æ¯æ¬¡éƒ½åœ¨ markdown æ–‡ä»¶æ·»åŠ ä¸Šè¿™ä¸¤è¡Œå³å¯ï¼Œé‚£ä¹ˆæœ‰æ²¡æœ‰åŠæ³•è‡ªåŠ¨æ·»åŠ å‘¢ï¼Ÿ</p><p>å½“ç„¶æœ‰~</p><p>ç¼–è¾‘ hugo ç›®å½•ä¸‹çš„ <code>archetypes/default.md</code>,è¿™ä¸ªæ–‡ä»¶æ˜¯é»˜è®¤åˆ›å»ºçš„æ¨¡ç‰ˆã€‚åœ¨é‡Œé¢æ·»åŠ ä¸Šä¸Šè¿°å†…å®¹ã€‚</p><h2 id="è‡ªåŠ¨ç”Ÿæˆåˆ†ç±»"><a href="#è‡ªåŠ¨ç”Ÿæˆåˆ†ç±»" class="headerlink" title="è‡ªåŠ¨ç”Ÿæˆåˆ†ç±»"></a>è‡ªåŠ¨ç”Ÿæˆåˆ†ç±»</h2><blockquote><p>ä¸æƒ³è®©æ‰€æœ‰çš„ markdown æ–‡ä»¶éƒ½åœ¨ä¸€ä¸ªæ–‡ä»¶å¤¹å†…ï¼Œæ¯”å¦‚æƒ³æŒ‰æ–‡ä»¶å¤¹åˆ†ç±»ï¼ŒA æ–‡ä»¶å¤¹å†…çš„æ–‡ç« å‘å¸ƒåå°±æ˜¯åœ¨ A åˆ†ç±»ä¸‹ã€‚</p></blockquote><p>å¯ä»¥å°† <code>archetypes/default.md</code> é‡Œé¢çš„ <code>categories</code> ä¿®æ”¹æˆ</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">categories:</span> [<span class="string">&quot;<span class="template-variable">&#123;&#123; trim (replace .File.Dir &quot;posts/&quot; &quot;&quot;) &quot;/&quot; &#125;&#125;</span>&quot;</span>]</span><br></pre></td></tr></table></figure><p>ä»¥ååˆ›å»ºæ–°æ–‡ç« çš„æ—¶å€™å°±å¯ä»¥è‡ªåŠ¨ç”Ÿæˆåˆ†ç±»äº†ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Blog </tag>
            
            <tag> hugo </tag>
            
            <tag> ç¼–è¾‘å™¨ </tag>
            
            <tag> markdown </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¼–è¯‘å®‰è£…Redisè®°å½•</title>
      <link href="/posts/1da8e73d/"/>
      <url>/posts/1da8e73d/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸‹è½½è§£å‹"><a href="#ä¸‹è½½è§£å‹" class="headerlink" title="ä¸‹è½½è§£å‹"></a>ä¸‹è½½è§£å‹</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget https://download.redis.io/releases/redis-6.0.9.tar.gz</span><br><span class="line">tar xf redis-6.0.9.tar.gz</span><br><span class="line"><span class="built_in">cd</span> redis-6.2.13</span><br></pre></td></tr></table></figure><h2 id="ç¼–è¯‘"><a href="#ç¼–è¯‘" class="headerlink" title="ç¼–è¯‘"></a>ç¼–è¯‘</h2><p>ç¼–è¯‘éœ€è¦ gcc</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make</span><br></pre></td></tr></table></figure><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">mkdir</span> -p /usr/local/redis/&#123;bin,conf&#125;</span><br><span class="line">sudo <span class="built_in">cp</span> src/&#123;redis-benchmark,redis-check-aof,redis-check-rdb,redis-cli,redis-server&#125; /usr/local/redis/bin/</span><br><span class="line">sudo <span class="built_in">cp</span> redis.conf /usr/local/redis/conf/redis.conf</span><br></pre></td></tr></table></figure><h2 id="å¯åŠ¨"><a href="#å¯åŠ¨" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/redis/bin/redis-server /usr/local/redis/conf/redis.conf</span><br></pre></td></tr></table></figure><h2 id="é€šè¿‡-systemd-ç®¡ç†"><a href="#é€šè¿‡-systemd-ç®¡ç†" class="headerlink" title="é€šè¿‡ systemd ç®¡ç†"></a>é€šè¿‡ systemd ç®¡ç†</h2><p>vim &#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;redis.service</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[unit]</span></span><br><span class="line"><span class="attr">Description</span>=redis-server</span><br><span class="line"><span class="attr">After</span>=network.target</span><br><span class="line"> </span><br><span class="line"><span class="section">[Service]</span></span><br><span class="line"><span class="attr">Type</span>=forking</span><br><span class="line"><span class="attr">ExecStart</span>=/usr/local/redis/bin/redis-server /usr/local/redis/conf/redis.conf</span><br><span class="line"><span class="attr">PrivateTmp</span>=<span class="literal">true</span></span><br><span class="line"> </span><br><span class="line"><span class="section">[Install]</span></span><br><span class="line"><span class="attr">WantedBy</span>=multi-user.target</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¼–è¯‘ </tag>
            
            <tag> è®°å½• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxå¹³å°æ–‡æœ¬ç¼–è¾‘å™¨vim</title>
      <link href="/posts/280100fb/"/>
      <url>/posts/280100fb/</url>
      
        <content type="html"><![CDATA[<p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/vim_keymap.png" alt="keymap"></p><h2 id="å¸¸ç”¨å¿«æ·é”®"><a href="#å¸¸ç”¨å¿«æ·é”®" class="headerlink" title="å¸¸ç”¨å¿«æ·é”®"></a>å¸¸ç”¨å¿«æ·é”®</h2><table><thead><tr><th>å¿«æ·é”®</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>i</td><td>åœ¨å½“å‰å…‰æ ‡ä¹‹å‰æ’å…¥</td></tr><tr><td>a</td><td>åœ¨å½“å‰å…‰æ ‡ä¹‹åæ’å…¥</td></tr><tr><td>I</td><td>åœ¨å½“å‰è¡Œ æœ€å‰é¢æ’å…¥</td></tr><tr><td>o</td><td>åœ¨ä¸‹æ–¹æ–°å»ºä¸€è¡Œ, ç„¶åæ’å…¥</td></tr><tr><td>O</td><td>åœ¨ä¸Šæ–¹æ–°å»ºä¸€è¡Œ, ç„¶åæ’å…¥</td></tr><tr><td>G</td><td>è·³åˆ°æœ€åé¢</td></tr><tr><td>gg</td><td>è·³åˆ°æœ€å‰é¢</td></tr><tr><td>$</td><td>è·³åˆ°è¡Œå°¾</td></tr><tr><td>^</td><td>è·³åˆ°è¡Œé¦–</td></tr><tr><td>v</td><td>å¤šé€‰</td></tr><tr><td>ctrl v</td><td>å—é€‰</td></tr><tr><td>V</td><td>è¡Œé€‰</td></tr><tr><td>yy</td><td>å¤åˆ¶ä¸€è¡Œ</td></tr><tr><td>p</td><td>åœ¨å…‰æ ‡åç²˜è´´</td></tr><tr><td>P</td><td>åœ¨å…‰æ ‡å‰ç²˜è´´</td></tr><tr><td>dd</td><td>æˆªåˆ‡ä¸€è¡Œ</td></tr><tr><td>e</td><td>å¤šé€‰æ¨¡å¼ä¸‹   å‘åä¸€ä¸ªå•è¯</td></tr><tr><td>b</td><td>å¤šé€‰æ¨¡å¼ä¸‹   å‘å‰ä¸€ä¸ªå•è¯</td></tr><tr><td>d^</td><td>åˆ é™¤åˆ°è¡Œé¦–</td></tr><tr><td>d$</td><td>åˆ é™¤åˆ°è¡Œå°¾</td></tr><tr><td>D</td><td>åˆ é™¤åˆ°è¡Œå°¾</td></tr></tbody></table><h2 id="æ›¿æ¢æ–‡æœ¬"><a href="#æ›¿æ¢æ–‡æœ¬" class="headerlink" title="æ›¿æ¢æ–‡æœ¬"></a>æ›¿æ¢æ–‡æœ¬</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç›´æ¥è¿›è¡Œå…¨æ–‡æ›¿æ¢</span></span><br><span class="line">:%s<span class="comment">#åŸæ–‡æœ¬#æ›¿æ¢åçš„æ–‡æœ¬#g</span></span><br><span class="line">:%s/åŸæ–‡æœ¬/æ›¿æ¢åçš„æ–‡æœ¬/g</span><br><span class="line">:%s@åŸæ–‡æœ¬@æ›¿æ¢åçš„æ–‡æœ¬@g</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ›¿æ¢å‰æç¤ºç”¨æˆ·</span></span><br><span class="line">:%s<span class="comment">#åŸæ–‡æœ¬#æ›¿æ¢åçš„æ–‡æœ¬#gc</span></span><br></pre></td></tr></table></figure><h2 id="åŒ¹é…åˆ é™¤"><a href="#åŒ¹é…åˆ é™¤" class="headerlink" title="åŒ¹é…åˆ é™¤"></a>åŒ¹é…åˆ é™¤</h2><p>åˆ é™¤åŒ…å«ç‰¹å®šå­—ç¬¦çš„è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">:g/pattern/d            <span class="comment"># å…¨å±€èŒƒå›´å†…</span></span><br><span class="line">:1,20g/pattern/d        <span class="comment"># åˆ é™¤1~20è¡Œå†…åŒ¹é…çš„è¡Œ</span></span><br></pre></td></tr></table></figure><p>åˆ é™¤ä»¥#å¼€å¤´çš„æ³¨é‡Š</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g/^#/d</span><br></pre></td></tr></table></figure><p>åˆ é™¤ç©ºè¡Œ</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g/^\s*$/d</span><br></pre></td></tr></table></figure><p>åˆ é™¤#åé¢çš„è¡Œ</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g/#.*/d</span><br></pre></td></tr></table></figure><p>åˆ é™¤ä¸åŒ¹é…çš„è¡Œ</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">:v/pattern/d</span><br><span class="line">:g!/pattern/d</span><br></pre></td></tr></table></figure><blockquote><p>patton é‡Œé¢å¯ä»¥æ˜¯æ­£åˆ™è¡¨è¾¾å¼ï¼Œæ¯”å¦‚è¯´ ^10.104</p></blockquote><h3 id="æ¯ä¸€è¡Œæœ€åæ·»åŠ ä¸€ä¸ªå­—ç¬¦"><a href="#æ¯ä¸€è¡Œæœ€åæ·»åŠ ä¸€ä¸ªå­—ç¬¦" class="headerlink" title="æ¯ä¸€è¡Œæœ€åæ·»åŠ ä¸€ä¸ªå­—ç¬¦"></a>æ¯ä¸€è¡Œæœ€åæ·»åŠ ä¸€ä¸ªå­—ç¬¦</h3><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:%s/$/,/</span><br></pre></td></tr></table></figure><h3 id="ç”¨-sudo-æ‰“å¼€"><a href="#ç”¨-sudo-æ‰“å¼€" class="headerlink" title="ç”¨ sudo æ‰“å¼€"></a>ç”¨ sudo æ‰“å¼€</h3><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:<span class="keyword">w</span> !sudo tee %</span><br></pre></td></tr></table></figure><h2 id="å‘½ä»¤æ¨¡å¼"><a href="#å‘½ä»¤æ¨¡å¼" class="headerlink" title="å‘½ä»¤æ¨¡å¼"></a>å‘½ä»¤æ¨¡å¼</h2><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">:<span class="keyword">wq</span>     ä¿å­˜é€€å‡º</span><br><span class="line">:q      ä¸ä¿å­˜é€€å‡º</span><br><span class="line">:q!     å¼ºåˆ¶ä¸ä¿å­˜é€€å‡º</span><br><span class="line">:<span class="keyword">x</span>      ä¿å­˜é€€å‡º</span><br><span class="line"></span><br><span class="line">ZZ      ä¿å­˜é€€å‡ºï¼Œç›¸å½“äº:<span class="keyword">wq</span></span><br><span class="line">ZQ      ä¸ä¿å­˜é€€å‡ºï¼Œç›¸å½“äº:q!</span><br></pre></td></tr></table></figure><h2 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h2><blockquote><p>å…¨å±€é…ç½®æ–‡ä»¶ <code>/etc/vim/vimrc</code><br>å½“å‰ç”¨æˆ·é…ç½®æ–‡ä»¶ <code>~/.vimrc</code></p></blockquote><h3 id="é¼ æ ‡æ¨¡å¼"><a href="#é¼ æ ‡æ¨¡å¼" class="headerlink" title="é¼ æ ‡æ¨¡å¼"></a>é¼ æ ‡æ¨¡å¼</h3><blockquote><p>Vim7.1 ä½¿ç”¨é¼ æ ‡æ—¶ä¼šé»˜è®¤è¿›å…¥è™šæ‹Ÿé€‰ä¸­æ¨¡å¼ (visual mode)ï¼Œå°±å¥½åƒé€šè¿‡ v é€‰ä¸­çš„ä¸€æ ·ã€‚</p></blockquote><p>å‘½ä»¤æ¨¡å¼æ‰§è¡Œï¼š</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:<span class="keyword">set</span> mouse-=<span class="keyword">a</span></span><br></pre></td></tr></table></figure><p>æˆ–è€…å°†å…¶å†™å…¥é…ç½®æ–‡ä»¶é‡Œ</p><h2 id="åˆ†å±æ“ä½œ"><a href="#åˆ†å±æ“ä½œ" class="headerlink" title="åˆ†å±æ“ä½œ"></a>åˆ†å±æ“ä½œ</h2><table><thead><tr><th>æ“ä½œ</th><th>å‘½ä»¤</th></tr></thead><tbody><tr><td>æ¨ªå‘åˆ†å±</td><td>:sp</td></tr><tr><td>çºµå‘åˆ†å±</td><td>:vsp</td></tr><tr><td>æ¨ªå‘åˆ†å±å¹¶æ‰“å¼€æ–°æ–‡ä»¶</td><td>:sp test.sh</td></tr><tr><td>çºµå‘åˆ†å±å¹¶æ‰“å¼€æ–°æ–‡ä»¶</td><td>:vsp test.sh</td></tr><tr><td>åˆ‡åˆ°å…¶ä»–åˆ†å±</td><td>å…ˆæŒ‰ Ctrl w å†æŒ‰ hjkl è°ƒæ•´å…‰æ ‡æ–¹å‘</td></tr></tbody></table><h2 id="å®‰è£…æ’ä»¶"><a href="#å®‰è£…æ’ä»¶" class="headerlink" title="å®‰è£…æ’ä»¶"></a>å®‰è£…æ’ä»¶</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/preservim/nerdtree.git ~/.vim/pack/vendor/start/nerdtree</span><br><span class="line">vim -u NONE -c <span class="string">&quot;helptags ~/.vim/pack/vendor/start/nerdtree/doc&quot;</span> -c q</span><br></pre></td></tr></table></figure><p>vim ~&#x2F;.vimrc</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">let NERDTreeWinPos=&quot;left&quot;</span><br><span class="line">noremap &lt;F10&gt; :NERDTreeToggle&lt;CR&gt;</span><br><span class="line">let g:NERDTreeDirArrowExpandable = &#x27;â–¸&#x27;</span><br><span class="line">let g:NERDTreeDirArrowCollapsible = &#x27;â–¾&#x27;</span><br></pre></td></tr></table></figure><blockquote><p>å¿«æ·é”®è®¾ç½®ä¸º F10</p></blockquote><h2 id="vim-æ‰“å¼€ä¸­æ–‡ä¹±ç "><a href="#vim-æ‰“å¼€ä¸­æ–‡ä¹±ç " class="headerlink" title="vim æ‰“å¼€ä¸­æ–‡ä¹±ç "></a>vim æ‰“å¼€ä¸­æ–‡ä¹±ç </h2><p>åœ¨ <code>~/.vimrc</code> é‡Œå¢åŠ å‡ è¡Œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> termencoding=utf-8</span><br><span class="line"><span class="built_in">set</span> encoding=utf8</span><br><span class="line"><span class="built_in">set</span> fileencodings=utf8,ucs-bom,gbk,cp936,gb2312,gb18030</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vagrantå¸¸è§æŠ¥é”™è§£å†³æ–¹æ¡ˆ</title>
      <link href="/posts/1e258e64/"/>
      <url>/posts/1e258e64/</url>
      
        <content type="html"><![CDATA[<p>vagrant æ˜¯ä¸€æ¬¾è™šæ‹Ÿæœºç®¡ç†å·¥å…·ï¼Œå¯ä»¥é€šè¿‡ä»£ç æ¥æ§åˆ¶è™šæ‹Ÿæœºçš„çŠ¶æ€ï¼Œå¸®åŠ©æå‡å¼€å‘æ•ˆç‡</p><h2 id="æç¤º-umount-mnt-not-mounted"><a href="#æç¤º-umount-mnt-not-mounted" class="headerlink" title="æç¤º umount: &#x2F;mnt: not mounted"></a>æç¤º umount: &#x2F;mnt: not mounted</h2><blockquote><p>å‡ºç°è¿™ç§æƒ…å†µä¸€èˆ¬æ˜¯ç”±äºå®‰è£…äº† <code>vagrant-vbguest</code> æ’ä»¶, ä½†æ˜¯è¿™ä¸ªæ’ä»¶å¹¶ä¸èƒ½è‡ªåŠ¨å¸®åŠ©æˆ‘ä»¬å®‰è£… vbguest<br>è¿™ç§æƒ…å†µå¯èƒ½æ˜¯ç”±äºå†…æ ¸ç‰ˆæœ¬æ¯”è¾ƒä½å¯¼è‡´çš„</p></blockquote><ul><li><p>æ–¹æ¡ˆ 1: å‡çº§å†…æ ¸<br>  vagrantfile å¢åŠ ä¸€è¡Œ</p>  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">config.vbguest.installer_options = &#123; <span class="symbol">allow_kernel_upgrade:</span> <span class="literal">true</span> &#125;</span><br></pre></td></tr></table></figure></li><li><p>æ–¹æ¡ˆ 2: é™çº§ vagrant-vbguest</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vagrant plugin uninstall vagrant-vbguest</span><br><span class="line">vagrant plugin install vagrant-vbguest --plugin-version 0.21</span><br></pre></td></tr></table></figure></li></ul><h2 id="æŠ¥é”™ç½‘æ®µä¸åœ¨-nat-ç½‘æ®µé‡Œé¢"><a href="#æŠ¥é”™ç½‘æ®µä¸åœ¨-nat-ç½‘æ®µé‡Œé¢" class="headerlink" title="æŠ¥é”™ç½‘æ®µä¸åœ¨ nat ç½‘æ®µé‡Œé¢"></a>æŠ¥é”™ç½‘æ®µä¸åœ¨ nat ç½‘æ®µé‡Œé¢</h2><p>vagrantfile æ·»åŠ  <code>virtualbox__intnet</code> å‚æ•°</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node.vm.network <span class="string">&quot;private_network&quot;</span>, <span class="symbol">ip:</span> <span class="string">&quot;10.0.0.12&quot;</span>, <span class="symbol">virtualbox__intnet:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><h2 id="å¸¸è§æŠ¥é”™"><a href="#å¸¸è§æŠ¥é”™" class="headerlink" title="å¸¸è§æŠ¥é”™"></a>å¸¸è§æŠ¥é”™</h2><blockquote><p>Stderr: VBoxManage: error: Could not find the VirtualBox Remote Desktop Extension library<br>éœ€è¦å®‰è£… <code>LibVNCServer-devel</code></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> VirtualMachine </tag>
            
            <tag> Vagrant </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨expectæ¥è§£å†³å‘½ä»¤äº¤äº’é—®é¢˜</title>
      <link href="/posts/751c3cf9/"/>
      <url>/posts/751c3cf9/</url>
      
        <content type="html"><![CDATA[<p>linux é‡Œé¢å¾ˆå¤šå‘½ä»¤éƒ½æ˜¯éœ€è¦äººä¸ºäº¤äº’çš„ï¼Œå¯¹äºåšæˆè„šæœ¬æ¥è¯´ï¼Œæœ‰ç‚¹ä¸åˆé€‚äº†ï¼Œæ¯”å¦‚é€šè¿‡å¯†ç è¿æ¥ SSH å¿…é¡»è¦åœ¨æ§åˆ¶å°è¾“å…¥å¯†ç ï¼ˆå®‰å…¨èµ·è§è¿˜æ˜¯ç”¨ rsa keyï¼‰ï¼Œ<code>expect</code> æ˜¯é¢„æœŸçš„æ„æ€ï¼Œå®ƒå¯ä»¥å®ç°æˆ‘ä»¬é¢„æœŸçš„ç»“æœã€‚</p><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ubuntu/debian</span></span><br><span class="line">sudo apt install -y expect</span><br><span class="line">  </span><br><span class="line"><span class="comment"># centos/rhel</span></span><br><span class="line">sudo yum install -y ecpect</span><br></pre></td></tr></table></figure><h2 id="è§£é‡Šå™¨ä½¿ç”¨-expect"><a href="#è§£é‡Šå™¨ä½¿ç”¨-expect" class="headerlink" title="è§£é‡Šå™¨ä½¿ç”¨ expect"></a>è§£é‡Šå™¨ä½¿ç”¨ expect</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/expect</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> IP     [lindex <span class="variable">$argv</span> 0] <span class="comment"># è¯»å–ç¬¬1ä¸ªå‚æ•°è®¾ç½®ä¸º IP å˜é‡</span></span><br><span class="line"><span class="built_in">set</span> PASSWD [lindex <span class="variable">$argv</span> 1] <span class="comment"># è¯»å–ç¬¬2ä¸ªå‚æ•°è®¾ç½®ä¸º PASSWD å˜é‡</span></span><br><span class="line"><span class="built_in">set</span> CMD    [lindex <span class="variable">$argv</span> 2] <span class="comment"># è¯»å–ç¬¬3ä¸ªå‚æ•°è®¾ç½®ä¸º CMD å˜é‡</span></span><br><span class="line"></span><br><span class="line">spawn ssh <span class="variable">$IP</span> <span class="variable">$CMD</span> <span class="comment"># spawn æ¥ç»™å‘½ä»¤åŠ å£³ï¼Œä»¥ä¾¿äºæ–­è¨€è¾“å‡º</span></span><br><span class="line">expect &#123; <span class="comment"># expect æ˜¯æ–­è¨€å‘½ä»¤</span></span><br><span class="line">  <span class="comment"># å¦‚æœè¯»å–åˆ°å±å¹•ä¸Šè¾“å‡º (yes/no) ä¿¡æ¯ï¼Œåˆ™è¾“å…¥ &quot;yes&quot; å¹¶æŒ‰ä¸‹å›è½¦é”®</span></span><br><span class="line">  <span class="comment"># exp_continue æ˜¯ç»§ç»­ç­‰å¾…èŠ±æ‹¬å·å†…çš„æ–­è¨€, å¦‚æœä¸åŠ è¿™ä¸€å¥ä¼šç›´æ¥è·³å‡º expect</span></span><br><span class="line">  <span class="string">&quot;(yes/no)?&quot;</span> &#123; send <span class="string">&quot;yes\r&quot;</span>; exp_continue &#125;</span><br><span class="line"></span><br><span class="line">  <span class="string">&quot;password:&quot;</span> &#123; send <span class="string">&quot;<span class="variable">$PASSWD</span>\r&quot;</span> &#125; <span class="comment"># å¦‚æœè¯»å–åˆ°å±å¹•ä¸Šè¾“å‡º password ä¿¡æ¯ï¼Œåˆ™è¾“å…¥ PASSWD å˜é‡ä¸­çš„å†…å®¹</span></span><br><span class="line">  <span class="string">&quot;*host &quot;</span> &#123; <span class="built_in">exit</span> 1 &#125; <span class="comment"># å¦‚æœè¯»å–åˆ° &quot;No route to host&quot; ç­‰å†…å®¹ï¼Œ å°±ä»¥é0çŠ¶æ€é€€å‡º</span></span><br><span class="line">&#125;</span><br><span class="line">expect eof <span class="comment"># ç­‰å¾…å‘½ä»¤æ‰§è¡Œç»“æŸ</span></span><br></pre></td></tr></table></figure><p>è¿™ç§æ–¹å¼ç”±äºè§£é‡Šå™¨ä½¿ç”¨äº† expectï¼Œæ‰€ä»¥åªèƒ½ä½¿ç”¨æœ‰é™çš„å‘½ä»¤ï¼Œä¸æ˜¯å¾ˆæ¨è</p><h3 id="æ‰§è¡Œç»“æœèµ‹äºˆå˜é‡"><a href="#æ‰§è¡Œç»“æœèµ‹äºˆå˜é‡" class="headerlink" title="æ‰§è¡Œç»“æœèµ‹äºˆå˜é‡"></a>æ‰§è¡Œç»“æœèµ‹äºˆå˜é‡</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/expect</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> result [<span class="built_in">exec</span> hostname -I]</span><br><span class="line">puts <span class="string">&quot;æœ¬æœºIPåœ°å€æ˜¯: <span class="variable">$result</span>&quot;</span></span><br></pre></td></tr></table></figure><h2 id="è§£é‡Šå™¨ä½¿ç”¨-bash"><a href="#è§£é‡Šå™¨ä½¿ç”¨-bash" class="headerlink" title="è§£é‡Šå™¨ä½¿ç”¨ bash"></a>è§£é‡Šå™¨ä½¿ç”¨ bash</h2><blockquote><p>å‡è®¾ certbot ä¸æ”¯æŒéäº¤äº’ä½¿ç”¨</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">export</span> LC_CTYPE=<span class="string">&quot;en_US.UTF-8&quot;</span></span><br><span class="line">expect -c <span class="string">&#x27;</span></span><br><span class="line"><span class="string">set timeout 3</span></span><br><span class="line"><span class="string">spawn ssh user@&lt;host&gt; -p 60022</span></span><br><span class="line"><span class="string">expect &quot;password&quot;</span></span><br><span class="line"><span class="string">send &quot;password\r&quot;</span></span><br><span class="line"><span class="string">interact</span></span><br><span class="line"><span class="string">&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="ç›´æ¥ä½¿ç”¨-expect-å‘½ä»¤"><a href="#ç›´æ¥ä½¿ç”¨-expect-å‘½ä»¤" class="headerlink" title="ç›´æ¥ä½¿ç”¨ expect å‘½ä»¤"></a>ç›´æ¥ä½¿ç”¨ expect å‘½ä»¤</h2><blockquote><p>è¿™ç§å’Œåˆ‡æ¢è§£é‡Šå™¨ç±»ä¼¼ï¼Œ ç±»æ¯”äº <code>./test.sh</code> å’Œ <code>bash test.sh</code> çš„å…³ç³»ã€‚</p></blockquote><p>vim test.sh</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">spawn ldapadd -x -D cn=Manager,dc=i,dc=com -W -f /vagrant/basedomain.ldif</span><br><span class="line">expect &#123;</span><br><span class="line"><span class="string">&quot;Enter LDAP Password:&quot;</span> &#123;send <span class="string">&quot;123456\n&quot;</span>;exp_continue&#125;</span><br><span class="line">eof</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expect test.sh</span><br></pre></td></tr></table></figure><h2 id="ä¸€äº›ä¾‹å­ğŸŒ°"><a href="#ä¸€äº›ä¾‹å­ğŸŒ°" class="headerlink" title="ä¸€äº›ä¾‹å­ğŸŒ°"></a>ä¸€äº›ä¾‹å­ğŸŒ°</h2><h3 id="è‡ªåŠ¨ç™»å½•å¸¦ä¸¤æ­¥éªŒè¯ç çš„è·³æ¿æœº"><a href="#è‡ªåŠ¨ç™»å½•å¸¦ä¸¤æ­¥éªŒè¯ç çš„è·³æ¿æœº" class="headerlink" title="è‡ªåŠ¨ç™»å½•å¸¦ä¸¤æ­¥éªŒè¯ç çš„è·³æ¿æœº"></a>è‡ªåŠ¨ç™»å½•å¸¦ä¸¤æ­¥éªŒè¯ç çš„è·³æ¿æœº</h3><p>æ‰‹åŠ¨ç™»å½•çš„æ–¹å¼ï¼š</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202408131814901.gif" alt="yuanshi.gif"></p><p>ä½¿ç”¨è„šæœ¬è‡ªåŠ¨ç™»å½•ï¼Œæ•ˆæœå¦‚ä¸‹å›¾ï¼š</p><p>è„šæœ¬åšäº†ï¼š</p><ol><li>è‡ªåŠ¨è¾“å…¥å¯†ç </li><li>è‡ªåŠ¨è¾“å…¥ä¸¤æ­¥éªŒè¯ç ï¼ˆè°·æ­ŒéªŒè¯å™¨ 6 ä½æ•°å­—åŠ¨æ€å¯†ç ï¼‰</li></ol><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202408131815193.gif" alt="test.gif"></p><p>totp.py è·å–éªŒè¯ç çš„è„šæœ¬</p><blockquote><p>è¿™ä¸ªè„šæœ¬éœ€è¦æ¥æ”¶ä¸€ä¸ªå‚æ•°ï¼Œå‚æ•°ä¸º TOTP Seedï¼Œä¹Ÿå°±æ˜¯äºŒç»´ç è§£æå‡ºæ¥çš„å†…å®¹ã€‚</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pyotp</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">totp = pyotp.TOTP(sys.argv[<span class="number">1</span>])</span><br><span class="line">totp_password = totp.now()</span><br><span class="line"><span class="built_in">print</span>(totp_password, end=<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure><p>ç™»å½•è„šæœ¬ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/expect -f</span></span><br><span class="line"><span class="comment"># æ•è·çª—å£å¤§å°å˜åŒ–çš„ä¿¡å·ï¼Œå¹¶è°ƒæ•´spawnè¿›ç¨‹çš„ç»ˆç«¯å¤§å°</span></span><br><span class="line"><span class="built_in">trap</span> &#123;</span><br><span class="line">  <span class="comment"># è·å–å½“å‰ç»ˆç«¯çš„è¡Œæ•°å’Œåˆ—æ•°</span></span><br><span class="line">  <span class="built_in">set</span> rows [<span class="built_in">stty</span> rows]</span><br><span class="line">  <span class="built_in">set</span> cols [<span class="built_in">stty</span> columns]</span><br><span class="line">  </span><br><span class="line">  <span class="comment"># è°ƒæ•´spawnè¿›ç¨‹çš„ç»ˆç«¯è¡Œæ•°å’Œåˆ—æ•°</span></span><br><span class="line">  <span class="built_in">stty</span> rows <span class="variable">$rows</span> columns <span class="variable">$cols</span> &lt; <span class="variable">$spawn_out</span>(slave,name)</span><br><span class="line">&#125; WINCH</span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> user root</span><br><span class="line"><span class="built_in">set</span> host 10.0.0.10</span><br><span class="line"><span class="built_in">set</span> password 123456</span><br><span class="line"><span class="built_in">set</span> <span class="built_in">timeout</span> 30</span><br><span class="line"></span><br><span class="line">spawn ssh <span class="variable">$user</span>@<span class="variable">$host</span> -p 60022</span><br><span class="line"></span><br><span class="line"><span class="comment"># è‡ªåŠ¨è¾“å…¥å¯†ç </span></span><br><span class="line">expect &#123;</span><br><span class="line">    <span class="string">&quot;yes/no&quot;</span> &#123;send <span class="string">&quot;yes\r&quot;</span>&#125;</span><br><span class="line">    <span class="string">&quot;*assword:*&quot;</span> &#123;send <span class="string">&quot;<span class="variable">$password</span>\r&quot;</span>&#125;</span><br><span class="line">    <span class="comment"># TOTPä¸¤æ­¥éªŒè¯ç ï¼Œé€šè¿‡è°ƒç”¨Pythonè„šæœ¬è·å–åˆ°ã€‚</span></span><br><span class="line">    <span class="string">&quot;*OTP verification code*&quot;</span> &#123;</span><br><span class="line">        <span class="comment"># expect_user -re &quot;(.*)\n&quot;</span></span><br><span class="line">        <span class="comment"># set veri_code $expect_out(1,string)</span></span><br><span class="line">        <span class="comment"># ä¸Šé¢é‚£ä¸¤è¡Œæ˜¯æ‰‹åŠ¨è¾“å…¥ï¼Œä¸‹é¢è¿™ä¸ªåˆ™æ˜¯ä¾é è‡ªåŠ¨è®¡ç®—</span></span><br><span class="line">        <span class="built_in">set</span> veri_code [ <span class="built_in">exec</span> sh -c &#123;python3 totp.py &lt;totp_seed&gt;&#125; ]</span><br><span class="line">        send <span class="string">&quot;<span class="variable">$&#123;veri_code&#125;</span>\r&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿›å…¥äº¤äº’æ¨¡å¼ï¼Œä¿æŒä¼šè¯æ‰“å¼€</span></span><br><span class="line">interact</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Script </tag>
            
            <tag> Bash </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ­å»ºNFSæœåŠ¡</title>
      <link href="/posts/4b677f68/"/>
      <url>/posts/4b677f68/</url>
      
        <content type="html"><![CDATA[<blockquote><p>k8s é›†ç¾¤éœ€è¦å­˜å‚¨ï¼Œæœ¬åœ°æµ‹è¯•ç¯å¢ƒæ‡’å¾—æäº›å¤æ‚çš„ï¼Œå¼€å§‹å›å¿†å›å¿†å…¥é—¨æ—¶å­¦çš„ nfs çš„æ­å»ºï¼Œè®°å½•ä¸‹å§ï¼Œæ–¹ä¾¿æŸ¥çœ‹</p></blockquote><h2 id="æ­å»ºæœåŠ¡å™¨"><a href="#æ­å»ºæœåŠ¡å™¨" class="headerlink" title="æ­å»ºæœåŠ¡å™¨"></a>æ­å»ºæœåŠ¡å™¨</h2><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">Ubuntuå’ŒDebian</button><button type="button" class="tab">CentOSå’ŒFedora</button></div><div class="tab-contents"><div class="tab-item-content active"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install -y nfs-kernel-server</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y nfs-utils</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºå…±äº«ç›®å½•</span></span><br><span class="line">sudo <span class="built_in">mkdir</span> /nfs</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤æƒé™é™åˆ¶</span></span><br><span class="line">sudo <span class="built_in">chown</span> -R nobody:nogroup /nfs</span><br><span class="line"></span><br><span class="line"><span class="comment"># RHEL 9 ç³»ç»Ÿ</span></span><br><span class="line"><span class="comment"># sudo chown -R nobody:nobody /nfs</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹é…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;/nfs *(rw,sync,no_subtree_check,no_root_squash)&quot;</span> &gt;&gt; /etc/exports</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿é…ç½®ç”Ÿæ•ˆ</span></span><br><span class="line">sudo exportfs -a</span><br></pre></td></tr></table></figure><p>é‡å¯æœåŠ¡</p><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">Ubuntuå’ŒDebian</button><button type="button" class="tab">CentOS 7</button><button type="button" class="tab">CentOS 9 æˆ– RHEL 9</button></div><div class="tab-contents"><div class="tab-item-content active"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart nfs-server</span><br><span class="line">sudo systemctl <span class="built_in">enable</span> nfs-server</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># CentOS 7</span></span><br><span class="line">sudo systemctl restart nfs</span><br><span class="line">sudo systemctl <span class="built_in">enable</span> nfs</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart nfs-server</span><br><span class="line">sudo systemctl <span class="built_in">enable</span> nfs-server</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div><h2 id="æ­å»ºå®¢æˆ·ç«¯"><a href="#æ­å»ºå®¢æˆ·ç«¯" class="headerlink" title="æ­å»ºå®¢æˆ·ç«¯"></a>æ­å»ºå®¢æˆ·ç«¯</h2><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">Ubuntuå’ŒDebian</button><button type="button" class="tab">CentOSå’ŒFedora</button></div><div class="tab-contents"><div class="tab-item-content active"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install -y nfs-common</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y nfs-utils</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºå¾…æŒ‚è½½çš„ç›®å½•</span></span><br><span class="line"><span class="built_in">mkdir</span> /mnt/nfs</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‚è½½</span></span><br><span class="line">sudo mount 10.0.0.3:/nfs /mnt/nfs</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹ /etc/fstab å¼€æœºè‡ªåŠ¨æŒ‚è½½</span></span><br><span class="line">10.0.0.3:/nfs    /mnt/nfs    nfs    defaults    0 0 </span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
            <tag> NFS </tag>
            
            <tag> å­˜å‚¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dockerä¸æ”¯æŒä¸­æ–‡è§£å†³æ–¹æ¡ˆ</title>
      <link href="/posts/581a1bd9/"/>
      <url>/posts/581a1bd9/</url>
      
        <content type="html"><![CDATA[<blockquote><p>ubuntu å®˜æ–¹é•œåƒé»˜è®¤çš„å­—ç¬¦é›†æ”¯æŒ <code>C</code>, <code>C.UTF-8</code>, and <code>POSIX</code></p></blockquote><p>æŸ¥çœ‹å®¹å™¨ä½¿ç”¨çš„å­—ç¬¦é›†</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">root@huige-demo-web-0:/var/www/html/forum/files# locale</span><br><span class="line">LANG=</span><br><span class="line">LANGUAGE=</span><br><span class="line">LC_CTYPE=&quot;POSIX&quot;</span><br><span class="line">LC_NUMERIC=&quot;POSIX&quot;</span><br><span class="line">LC_TIME=&quot;POSIX&quot;</span><br><span class="line">LC_COLLATE=&quot;POSIX&quot;</span><br><span class="line">LC_MONETARY=&quot;POSIX&quot;</span><br><span class="line">LC_MESSAGES=&quot;POSIX&quot;</span><br><span class="line">LC_PAPER=&quot;POSIX&quot;</span><br><span class="line">LC_NAME=&quot;POSIX&quot;</span><br><span class="line">LC_ADDRESS=&quot;POSIX&quot;</span><br><span class="line">LC_TELEPHONE=&quot;POSIX&quot;</span><br><span class="line">LC_MEASUREMENT=&quot;POSIX&quot;</span><br><span class="line">LC_IDENTIFICATION=&quot;POSIX&quot;</span><br><span class="line">LC_ALL=</span><br></pre></td></tr></table></figure><p>è¦ä½¿å®¹å™¨å†…è¿›ç¨‹å¯ä»¥æ‰“å¼€ä¸­æ–‡æ–‡ä»¶ï¼Œéœ€è¦å°† <code>locale</code> è®¾ç½®æˆ <code>C.UTF-8</code> å³å¯</p><p>ä¿®æ”¹ <code>Dockerfile</code>ï¼Œæ·»åŠ  <code>ENV</code></p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ENV</span> LANG C.UTF-<span class="number">8</span></span><br></pre></td></tr></table></figure><p>é‡æ–°æ„å»ºï¼Œè¿è¡Œï¼Œå†æ¬¡æŸ¥çœ‹ <code>locale</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">root@4d4501013874:/# locale</span><br><span class="line">LANG=c.utf8</span><br><span class="line">LANGUAGE=</span><br><span class="line">LC_CTYPE=&quot;c.utf8&quot;</span><br><span class="line">LC_NUMERIC=&quot;c.utf8&quot;</span><br><span class="line">LC_TIME=&quot;c.utf8&quot;</span><br><span class="line">LC_COLLATE=&quot;c.utf8&quot;</span><br><span class="line">LC_MONETARY=&quot;c.utf8&quot;</span><br><span class="line">LC_MESSAGES=&quot;c.utf8&quot;</span><br><span class="line">LC_PAPER=&quot;c.utf8&quot;</span><br><span class="line">LC_NAME=&quot;c.utf8&quot;</span><br><span class="line">LC_ADDRESS=&quot;c.utf8&quot;</span><br><span class="line">LC_TELEPHONE=&quot;c.utf8&quot;</span><br><span class="line">LC_MEASUREMENT=&quot;c.utf8&quot;</span><br><span class="line">LC_IDENTIFICATION=&quot;c.utf8&quot;</span><br><span class="line">LC_ALL=</span><br></pre></td></tr></table></figure><p>å¦‚æœæƒ³è®©å®¹å™¨å†…å¯ä»¥æ­£å¸¸æ˜¾ç¤ºä¸­æ–‡ï¼ˆåº”è¯¥æ²¡äººæƒ³è¿™ä¹ˆå¹²å§ï¼‰ï¼Œéœ€è¦å…ˆå®‰è£… <code>locale</code> ç„¶åå°† <code>locale</code> è®¾ç½®æˆ <code>zh_CN.UTF-8</code></p><p>ä¿®æ”¹ <code>Dockerfile</code>ï¼Œæ·»åŠ </p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get update &amp;&amp; apt-get install -y locales &amp;&amp; <span class="built_in">rm</span> -rf /var/lib/apt/lists/* \</span></span><br><span class="line"><span class="language-bash">    &amp;&amp; localedef -i zh_CN -c -f UTF-8 -A /usr/share/locale/locale.alias zh_CN.UTF-8</span></span><br><span class="line"><span class="keyword">ENV</span> LANG zh_CN.utf8</span><br></pre></td></tr></table></figure><p>ç„¶åå°±å¯ä»¥å®Œç¾æ˜¾ç¤ºä¸­æ–‡äº†</p>]]></content>
      
      
      <categories>
          
          <category> å®¹å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
            <tag> ç¼–ç  </tag>
            
            <tag> Container </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨pythonæ§åˆ¶windowsé¼ æ ‡å’Œé”®ç›˜</title>
      <link href="/posts/2426edfc/"/>
      <url>/posts/2426edfc/</url>
      
        <content type="html"><![CDATA[<blockquote><p><code>python</code> åœ¨ <code>windows</code> ä¸‹æ“ä½œé”®ç›˜é¼ æ ‡ï¼ˆæœ‰ç‚¹ç±»ä¼¼äºæŒ‰é”®ç²¾çµï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ <code>PyUserInput</code> æ¨¡å—ï¼Œ<code>PyUserInput</code> ä¾èµ– <code>pywin32</code> å’Œ <code>pyHook</code> æ¨¡å—ã€‚<br><code>pyautogui</code> æ„Ÿè§‰å¾ˆä¸é”™ï¼Œå¯ä»¥å®ç° <code>PyUserInput</code> çš„æ‰€æœ‰åŠŸèƒ½ï¼Œå¹¶ä¸”å¯ä»¥æ ¹æ®æä¾›çš„æˆªå›¾æ¥è¿›è¡Œå›¾åƒè¯†åˆ«ã€‚</p></blockquote><h2 id="PyUserInput"><a href="#PyUserInput" class="headerlink" title="PyUserInput"></a>PyUserInput</h2><h3 id="å®‰è£…-PyUserInput"><a href="#å®‰è£…-PyUserInput" class="headerlink" title="å®‰è£… PyUserInput"></a>å®‰è£… PyUserInput</h3><p>PyUserInput æ¨¡å—å®‰è£…å‰éœ€è¦å®‰è£… pywin32 å’Œ pyHook æ¨¡å—<br><code>pip install pywin32</code></p><p>pyHook æ¨¡å—å¯ä»è¿™é‡Œä¸‹è½½ï¼Œéœ€è¦ä¸‹è½½å¯¹åº”ç‰ˆæœ¬çš„ whl æ–‡ä»¶<a href="http://www.lfd.uci.edu/~gohlke/pythonlibs/">http://www.lfd.uci.edu/~gohlke/pythonlibs/</a><br>å®‰è£…: <code>pip install xxx.whl</code></p><p>PyUserInput æ¨¡å—<br>å®˜ç½‘: <a href="https://github.com/PyUserInput/PyUserInput">https://github.com/PyUserInput/PyUserInput</a></p><blockquote><p>è¿™ä¸ªæ¨¡å—å®˜æ–¹å·²ç»ä¸ç»´æŠ¤äº†ï¼Œç›®å‰æ¥çœ‹ <code>python</code>3.7+<code>win11</code> è¿˜å¯ä»¥ç”¨ï¼Œåç»­æœ‰éœ€è¦çš„åŒå­¦å¯ä»¥çœ‹çœ‹ <a href="https://github.com/moses-palmer/pynput">Pynput</a></p></blockquote><h3 id="ä½¿ç”¨-PyUserInput"><a href="#ä½¿ç”¨-PyUserInput" class="headerlink" title="ä½¿ç”¨ PyUserInput"></a>ä½¿ç”¨ PyUserInput</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pymouse <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pykeyboard <span class="keyword">import</span> PyKeyboard</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ†åˆ«å®šä¹‰ä¸€ä¸ªå®ä¾‹</span></span><br><span class="line">m = PyMouse()</span><br><span class="line">k = PyKeyboard()</span><br><span class="line"></span><br><span class="line"><span class="comment"># é¼ æ ‡æ“ä½œï¼š</span></span><br><span class="line"><span class="comment"># x,y       åæ ‡ä½ç½®</span></span><br><span class="line"><span class="comment"># button    1è¡¨ç¤ºå·¦é”®ï¼Œ2è¡¨ç¤ºç‚¹å‡»å³é”®</span></span><br><span class="line"><span class="comment"># n         ç‚¹å‡»æ¬¡æ•°ï¼Œé»˜è®¤æ˜¯1æ¬¡ï¼Œ2è¡¨ç¤ºåŒå‡»</span></span><br><span class="line">m.click(x,y,button,n)</span><br><span class="line">m.move(x,y)     <span class="comment"># é¼ æ ‡ç§»åŠ¨åˆ°åæ ‡(x,y)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å¾—å±å¹•å°ºå¯¸</span></span><br><span class="line">x_dim, y_dim = m.screen_size()</span><br><span class="line"></span><br><span class="line"><span class="comment"># é”®ç›˜æ“ä½œï¼š</span></span><br><span class="line">k.type_string(â€˜Hello, World!â€™)      <span class="comment"># æ¨¡æ‹Ÿé”®ç›˜è¾“å…¥å­—ç¬¦ä¸²</span></span><br><span class="line">k.press_key(â€˜Hâ€™)                    <span class="comment"># æ¨¡æ‹Ÿé”®ç›˜æŒ‰Hé”®</span></span><br><span class="line">k.release_key(â€˜Hâ€™)                  <span class="comment"># æ¨¡æ‹Ÿé”®ç›˜æ¾å¼€Hé”®</span></span><br><span class="line">k.tap_key(â€œHâ€)                      <span class="comment"># æ¨¡æ‹Ÿç‚¹å‡»Hé”®</span></span><br><span class="line">k.tap_key(â€˜Hâ€™,n=<span class="number">2</span>,interval=<span class="number">5</span>)       <span class="comment"># æ¨¡æ‹Ÿç‚¹å‡»Hé”®ï¼Œ2æ¬¡ï¼Œæ¯æ¬¡é—´éš”5ç§’</span></span><br><span class="line">k.tap_key(k.function_keys[<span class="number">5</span>])       <span class="comment"># ç‚¹å‡»åŠŸèƒ½é”®F5</span></span><br><span class="line">k.tap_key(k.numpad_keys[<span class="number">5</span>],<span class="number">3</span>)       <span class="comment"># ç‚¹å‡»å°é”®ç›˜5ï¼Œ3æ¬¡</span></span><br><span class="line"></span><br><span class="line">k.press_keys([k.windows_l_key,<span class="string">&#x27;r&#x27;</span>]) <span class="comment"># æŒ‰ä¸‹ WIN + R</span></span><br><span class="line"></span><br><span class="line">k.control_key                       <span class="comment"># Ctrl æŒ‰é”®</span></span><br><span class="line">k.alt_key                           <span class="comment"># Alt é”®</span></span><br><span class="line">k.tab_key                           <span class="comment"># Tab é”®</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹ï¼Œå®Œæˆç‚¹å‡»å±å¹•ä¸­å¤®å¹¶é”®å…¥â€œHello, World!â€çš„åŠŸèƒ½ï¼š</span></span><br><span class="line">x_dim, y_dim = m.screen_size()</span><br><span class="line">m.click(x_dim//<span class="number">2</span>, y_dim//<span class="number">2</span>, <span class="number">1</span>)</span><br><span class="line">k.type_string(<span class="string">&#x27;Hello, World!&#x27;</span>)</span><br></pre></td></tr></table></figure><h2 id="pyautogui"><a href="#pyautogui" class="headerlink" title="pyautogui"></a>pyautogui</h2><p>å®˜ç½‘æ–‡æ¡£ï¼š<a href="https://pyautogui.readthedocs.io/en/latest/">https://pyautogui.readthedocs.io/en/latest/</a><br>å®˜æ–¹æ”¯æŒ windowsã€macã€linuxã€‚</p><h3 id="å®‰è£…-pyautogui"><a href="#å®‰è£…-pyautogui" class="headerlink" title="å®‰è£… pyautogui"></a>å®‰è£… pyautogui</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install pyautogui opencv-python</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨ç¤ºä¾‹"><a href="#ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="ä½¿ç”¨ç¤ºä¾‹"></a>ä½¿ç”¨ç¤ºä¾‹</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pyautogui</span><br><span class="line"></span><br><span class="line">pyautogui.FAILSAFE = <span class="literal">True</span>     <span class="comment"># å‡ºç°æ•…éšœï¼Œé¼ æ ‡ç§»åŠ¨åˆ°å·¦ä¸Šè§’å¯ä»¥é€€å‡ºç¨‹åº</span></span><br><span class="line">pyautogui.PAUSE = <span class="number">0.3</span>         <span class="comment"># æ¯ä¸€æ­¥çš„ç­‰å¾…æ—¶é—´</span></span><br><span class="line"></span><br><span class="line">screenWidth, screenHeight = pyautogui.size()    <span class="comment"># è·å–ä¸»æ˜¾ç¤ºå™¨å°ºå¯¸</span></span><br><span class="line">currentMouseX, currentMouseY = pyautogui.position() <span class="comment"># è·å–é¼ æ ‡å½“å‰ä½ç½®</span></span><br><span class="line"></span><br><span class="line">pyautogui.moveTo(<span class="number">100</span>, <span class="number">150</span>) <span class="comment"># é¼ æ ‡ç§»åŠ¨åˆ°æŒ‡å®šåæ ‡</span></span><br><span class="line"></span><br><span class="line">pyautogui.click()          <span class="comment"># ç‚¹å‡»é¼ æ ‡å·¦é”®</span></span><br><span class="line">pyautogui.click(<span class="number">100</span>, <span class="number">200</span>)  <span class="comment"># ç‚¹å‡»æŒ‡å®šåæ ‡</span></span><br><span class="line">pyautogui.click(<span class="string">&#x27;button.png&#x27;</span>) <span class="comment"># ç‚¹å‡»æŒ‡å®šå›¾ç‰‡</span></span><br><span class="line"></span><br><span class="line">pyautogui.move(<span class="number">400</span>, <span class="number">0</span>)      <span class="comment"># é¼ æ ‡ç›¸å¯¹ç§»åŠ¨</span></span><br><span class="line">pyautogui.doubleClick()     <span class="comment"># åŒå‡»</span></span><br><span class="line">pyautogui.moveTo(<span class="number">500</span>, <span class="number">500</span>, duration=<span class="number">2</span>, tween=pyautogui.easeInOutQuad)  <span class="comment"># Use tweening/easing function to move mouse over 2 seconds.</span></span><br><span class="line"></span><br><span class="line">pyautogui.write(<span class="string">&#x27;Hello world!&#x27;</span>, interval=<span class="number">0.25</span>)  <span class="comment"># type with quarter-second pause in between each key</span></span><br><span class="line">pyautogui.press(<span class="string">&#x27;esc&#x27;</span>)     <span class="comment"># Press the Esc key. All key names are in pyautogui.KEY_NAMES</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> pyautogui.hold(<span class="string">&#x27;shift&#x27;</span>):  <span class="comment"># Press the Shift key down and hold it.</span></span><br><span class="line">    pyautogui.press([<span class="string">&#x27;left&#x27;</span>, <span class="string">&#x27;left&#x27;</span>, <span class="string">&#x27;left&#x27;</span>, <span class="string">&#x27;left&#x27;</span>])  <span class="comment"># Press the left arrow key 4 times.</span></span><br><span class="line"><span class="comment"># Shift key is released automatically.</span></span><br><span class="line"></span><br><span class="line">pyautogui.hotkey(<span class="string">&#x27;ctrl&#x27;</span>, <span class="string">&#x27;c&#x27;</span>) <span class="comment"># Press the Ctrl-C hotkey combination.</span></span><br><span class="line"></span><br><span class="line">pyautogui.alert(<span class="string">&#x27;This is the message to display.&#x27;</span>) <span class="comment"># Make an alert box appear and pause the program until OK is clicked.</span></span><br><span class="line"></span><br><span class="line">pyautogui.locateOnScreen(<span class="string">&#x27;looksLikeThis.png&#x27;</span>)  <span class="comment"># å›¾åƒè¯†åˆ«ï¼Œè¿”å›åæ ‡å€¼</span></span><br><span class="line">pyautogui.locateOnScreen(<span class="string">&#x27;looksLikeThis.png&#x27;</span>, confidence=<span class="number">0.9</span>)  <span class="comment"># ç”¨åˆ°opencvè¿›è¡Œå›¾åƒè¯†åˆ«ï¼ŒåŒ¹é…ç›¸ä¼¼åº¦90%</span></span><br></pre></td></tr></table></figure><h3 id="å¸¸è§é—®é¢˜"><a href="#å¸¸è§é—®é¢˜" class="headerlink" title="å¸¸è§é—®é¢˜"></a>å¸¸è§é—®é¢˜</h3><p>åœ¨ win server ä¸­ï¼Œ å¯èƒ½ä¼šå‡ºç°æ˜æ˜å·²ç»å®‰è£…äº† opencv-python ä½†æ˜¯å´æŠ¥é”™ï¼š <code>NotImplementedError: The confidence keyword argument is only available if OpenCV</code> ï¼Œ ä½ éœ€è¦å®‰è£… æ¡Œé¢ä½“éªŒ åŠŸèƒ½ï¼š</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202305041257094.png" alt="æœåŠ¡å™¨ç®¡ç†å™¨"></p>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Script </tag>
            
            <tag> Automatic </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¿«é€Ÿä¸Šæ‰‹vagrant</title>
      <link href="/posts/ca1596c5/"/>
      <url>/posts/ca1596c5/</url>
      
        <content type="html"><![CDATA[<blockquote><p><code>vagrant</code> æ˜¯ä¸€ä¸ªè™šæ‹Ÿæœºç®¡ç†å·¥å…· (è™šæ‹Ÿæœºç¼–æ’å·¥å…·)ï¼Œä½¿ç”¨æ–¹å¼æœ‰ç‚¹ç±»ä¼¼äº <code>docker-compose</code>ï¼Œè¿™ä¸ªå·¥å…·çš„ä¼˜åŠ¿å°±æ˜¯å¯ä»¥æŠŠæ‰‹åŠ¨å®‰è£…è™šæ‹Ÿæœºè¿™ä¸ªæ“ä½œè½¬æ¢æˆé€šè¿‡ä»£ç æ¥æ§åˆ¶è™šæ‹Ÿæœº<br>æœ‰ç‚¹ç±»ä¼¼äºä½¿ç”¨ <code>dockerfile</code> æ¥æ„å»º docker é•œåƒçš„æ„Ÿè§‰ã€‚</p></blockquote><h2 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h2><table><thead><tr><th>å‘½ä»¤</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>vagrant init</td><td>ç”Ÿæˆ vagrantfile æ–‡ä»¶</td></tr><tr><td>vagrant up</td><td>å¯åŠ¨è™šæ‹Ÿæœº</td></tr><tr><td>vagent halt</td><td>å…³é—­è™šæ‹Ÿæœº</td></tr><tr><td>vagrant box list</td><td>æŸ¥çœ‹å®‰è£…çš„ boxï¼ˆè™šæ‹Ÿæœºé•œåƒï¼‰</td></tr><tr><td>vagrant box add centos&#x2F;7</td><td>å®‰è£… boxï¼ˆè™šæ‹Ÿæœºé•œåƒï¼‰</td></tr><tr><td>vagrant ssh (hostname)</td><td>é€šè¿‡ ssh è¿æ¥</td></tr></tbody></table><h2 id="å¸¸ç”¨-vagrantfile"><a href="#å¸¸ç”¨-vagrantfile" class="headerlink" title="å¸¸ç”¨ vagrantfile"></a>å¸¸ç”¨ vagrantfile</h2><h3 id="æ‰¹é‡åˆ›å»ºè™šæ‹Ÿæœº"><a href="#æ‰¹é‡åˆ›å»ºè™šæ‹Ÿæœº" class="headerlink" title="æ‰¹é‡åˆ›å»ºè™šæ‹Ÿæœº"></a>æ‰¹é‡åˆ›å»ºè™šæ‹Ÿæœº</h3><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- mode: ruby -*-</span></span><br><span class="line"><span class="comment"># vi: set ft=ruby :</span></span><br><span class="line"></span><br><span class="line">servers = &#123;</span><br><span class="line">    <span class="symbol">:client</span> =&gt; <span class="string">&#x27;172.16.2.10&#x27;</span>,</span><br><span class="line">    <span class="symbol">:master1</span> =&gt; <span class="string">&#x27;172.16.2.11&#x27;</span>,</span><br><span class="line">    <span class="symbol">:master2</span> =&gt; <span class="string">&#x27;172.16.2.12&#x27;</span>,</span><br><span class="line">    <span class="symbol">:master3</span> =&gt; <span class="string">&#x27;172.16.2.13&#x27;</span>,</span><br><span class="line">    <span class="symbol">:worker1</span> =&gt; <span class="string">&#x27;172.16.2.21&#x27;</span>,</span><br><span class="line">    <span class="symbol">:worker2</span> =&gt; <span class="string">&#x27;172.16.2.22&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Vagrant</span>.configure(<span class="string">&quot;2&quot;</span>) <span class="keyword">do</span> |<span class="params">config</span>|</span><br><span class="line">  config.vm.box = <span class="string">&quot;ubuntu/focal64&quot;</span></span><br><span class="line">  config.vm.box_check_update = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># è‡ªåŠ¨æ’å…¥hosts</span></span><br><span class="line">  <span class="comment"># vagrant plugin install vagrant-hostmanager</span></span><br><span class="line">  config.hostmanager.enabled = <span class="literal">true</span></span><br><span class="line">  config.hostmanager.manage_host = <span class="literal">true</span></span><br><span class="line">  config.hostmanager.manage_guest = <span class="literal">true</span></span><br><span class="line">  config.hostmanager.ignore_private_ip = <span class="literal">false</span></span><br><span class="line">  config.hostmanager.include_offline = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">  servers.each <span class="keyword">do</span> |<span class="params">server_name, server_ip</span>|</span><br><span class="line">    config.vm.define server_name <span class="keyword">do</span> |<span class="params">server_config</span>|</span><br><span class="line">      server_config.vm.hostname = <span class="string">&quot;<span class="subst">#&#123;server_name.to_s&#125;</span>&quot;</span></span><br><span class="line">      server_config.vm.network <span class="symbol">:private_network</span>, <span class="symbol">ip:</span> server_ip</span><br><span class="line">      server_config.vm.provider <span class="string">&quot;virtualbox&quot;</span> <span class="keyword">do</span> |<span class="params">vb</span>|</span><br><span class="line">        vb.name = server_name.to_s</span><br><span class="line">        vb.memory = <span class="string">&quot;4096&quot;</span></span><br><span class="line">        vb.cpus = <span class="number">4</span></span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><h3 id="å¾ªç¯åˆ›å»ºè™šæ‹Ÿæœº"><a href="#å¾ªç¯åˆ›å»ºè™šæ‹Ÿæœº" class="headerlink" title="å¾ªç¯åˆ›å»ºè™šæ‹Ÿæœº"></a>å¾ªç¯åˆ›å»ºè™šæ‹Ÿæœº</h3><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Vagrant</span>.configure(<span class="string">&quot;2&quot;</span>) <span class="keyword">do</span> |<span class="params">config</span>|</span><br><span class="line"></span><br><span class="line">  (<span class="number">1</span>..<span class="number">3</span>).each <span class="keyword">do</span> |<span class="params">i</span>|</span><br><span class="line">    config.vm.define <span class="string">&quot;node<span class="subst">#&#123;i&#125;</span>&quot;</span> <span class="keyword">do</span> |<span class="params">node</span>|</span><br><span class="line">      node.vm.box = <span class="string">&quot;ubuntu/trusty64&quot;</span></span><br><span class="line">      node.vm.hostname=<span class="string">&quot;node<span class="subst">#&#123;i&#125;</span>&quot;</span></span><br><span class="line">      node.vm.network <span class="string">&quot;private_network&quot;</span>, <span class="symbol">ip:</span> <span class="string">&quot;192.168.59.<span class="subst">#&#123;i&#125;</span>&quot;</span></span><br><span class="line">      node.vm.provider <span class="string">&quot;virtualbox&quot;</span> <span class="keyword">do</span> |<span class="params">v</span>|</span><br><span class="line">        v.name = <span class="string">&quot;node<span class="subst">#&#123;i&#125;</span>&quot;</span></span><br><span class="line">        v.memory = <span class="number">2048</span></span><br><span class="line">        v.cpus = <span class="number">1</span></span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line">                  </span><br><span class="line">      node.vm.provision <span class="string">&quot;shell&quot;</span>, <span class="symbol">inline:</span> <span class="string">&lt;&lt;-SHELL</span></span><br><span class="line"><span class="string">        wget -qO- https://get.docker.com/ | sed &#x27;s/docker-engine/docker-engine=1.11.0-0~trusty/&#x27; | sh</span></span><br><span class="line"><span class="string">        usermod -aG docker vagrant</span></span><br><span class="line"><span class="string">      SHELL</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><h3 id="å¤šæ¬¡å®šä¹‰å®‰è£…è™šæ‹Ÿæœº"><a href="#å¤šæ¬¡å®šä¹‰å®‰è£…è™šæ‹Ÿæœº" class="headerlink" title="å¤šæ¬¡å®šä¹‰å®‰è£…è™šæ‹Ÿæœº"></a>å¤šæ¬¡å®šä¹‰å®‰è£…è™šæ‹Ÿæœº</h3><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- mode: ruby -*-</span></span><br><span class="line"><span class="comment"># vi: set ft=ruby :</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vagrant</span>.configure(<span class="string">&quot;2&quot;</span>) <span class="keyword">do</span> |<span class="params">config</span>|</span><br><span class="line">  config.vm.define <span class="string">&quot;master&quot;</span> <span class="keyword">do</span> |<span class="params">master</span>|</span><br><span class="line">    master.vm.box = <span class="string">&quot;centos/7&quot;</span></span><br><span class="line">    master.vm.provider <span class="string">&quot;virtualbox&quot;</span></span><br><span class="line">    master.vm.network <span class="string">&quot;private_network&quot;</span>, <span class="symbol">ip:</span> <span class="string">&quot;10.10.0.10&quot;</span></span><br><span class="line">    master.vm.synced_folder <span class="string">&quot;/home/iuxt/code/system-deployment/configuration/puppet/modules&quot;</span>, <span class="string">&quot;/etc/puppetlabs/code/modules&quot;</span>,<span class="symbol">create:</span> <span class="literal">true</span>,<span class="symbol">owner:</span> <span class="string">&quot;root&quot;</span>, <span class="symbol">group:</span> <span class="string">&quot;root&quot;</span>,<span class="symbol">mount_options:</span>[<span class="string">&quot;dmode=775&quot;</span>,<span class="string">&quot;fmode=644&quot;</span>]</span><br><span class="line">    master.vm.synced_folder <span class="string">&quot;/home/iuxt/code/system-deployment/configuration/puppet/environments/production/manifests&quot;</span>, <span class="string">&quot;/etc/puppetlabs/code/environments/production/manifests&quot;</span>,<span class="symbol">create:</span> <span class="literal">true</span>,<span class="symbol">owner:</span> <span class="string">&quot;root&quot;</span>, <span class="symbol">group:</span> <span class="string">&quot;root&quot;</span>,<span class="symbol">mount_options:</span>[<span class="string">&quot;dmode=775&quot;</span>,<span class="string">&quot;fmode=644&quot;</span>]</span><br><span class="line">    master.vm.hostname = <span class="string">&quot;puppet-master&quot;</span></span><br><span class="line">    master.vm.provider <span class="string">&quot;virtualbox&quot;</span> <span class="keyword">do</span> |<span class="params">vb</span>|</span><br><span class="line">      vb.gui = <span class="literal">false</span></span><br><span class="line">      vb.memory = <span class="string">&quot;4096&quot;</span></span><br><span class="line">      vb.cpus = <span class="string">&quot;2&quot;</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    master.vm.provision <span class="string">&quot;shell&quot;</span>, <span class="symbol">inline:</span> <span class="string">&lt;&lt;-SHELL</span></span><br><span class="line"><span class="string">       sudo rpm -Uvh https://yum.puppet.com/puppet6-release-el-7.noarch.rpm</span></span><br><span class="line"><span class="string">       yum install puppetserver -y</span></span><br><span class="line"><span class="string">       echo &quot;127.0.0.1 puppet&quot; &gt;&gt; /etc/hosts</span></span><br><span class="line"><span class="string">    SHELL</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  config.vm.define <span class="string">&quot;agent&quot;</span> <span class="keyword">do</span> |<span class="params">agent</span>|</span><br><span class="line">    agent.vm.box = <span class="string">&quot;centos/7&quot;</span></span><br><span class="line">    agent.vm.provider <span class="string">&quot;virtualbox&quot;</span></span><br><span class="line">    agent.vm.network <span class="string">&quot;private_network&quot;</span>, <span class="symbol">ip:</span> <span class="string">&quot;10.10.0.11&quot;</span></span><br><span class="line">    agent.vm.hostname = <span class="string">&quot;puppet-agent&quot;</span></span><br><span class="line">    agent.vm.provider <span class="string">&quot;virtualbox&quot;</span> <span class="keyword">do</span> |<span class="params">vb</span>|</span><br><span class="line">      vb.gui = <span class="literal">false</span></span><br><span class="line">      vb.memory = <span class="string">&quot;4096&quot;</span></span><br><span class="line">      vb.cpus = <span class="string">&quot;2&quot;</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    agent.vm.provision <span class="string">&quot;shell&quot;</span>, <span class="symbol">inline:</span> <span class="string">&lt;&lt;-SHELL</span></span><br><span class="line"><span class="string">       sudo rpm -Uvh https://yum.puppet.com/puppet6-release-el-7.noarch.rpm</span></span><br><span class="line"><span class="string">       yum install puppet -y</span></span><br><span class="line"><span class="string">       echo &quot;10.0.0.10 puppet&quot; &gt;&gt; /etc/hosts</span></span><br><span class="line"><span class="string">    SHELL</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="å¸¸ç”¨æ’ä»¶"><a href="#å¸¸ç”¨æ’ä»¶" class="headerlink" title="å¸¸ç”¨æ’ä»¶"></a>å¸¸ç”¨æ’ä»¶</h2><h3 id="è‡ªåŠ¨ç®¡ç†-hosts"><a href="#è‡ªåŠ¨ç®¡ç†-hosts" class="headerlink" title="è‡ªåŠ¨ç®¡ç† hosts"></a>è‡ªåŠ¨ç®¡ç† hosts</h3><blockquote><p>æ’ä»¶å®˜ç½‘ï¼š<a href="https://github.com/devopsgroup-io/vagrant-hostmanager">https://github.com/devopsgroup-io/vagrant-hostmanager</a></p></blockquote><p>å®‰è£…æ’ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vagrant plugin install vagrant-hostmanager</span><br></pre></td></tr></table></figure><p>å¯ç”¨</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Vagrant</span>.configure(<span class="string">&quot;2&quot;</span>) <span class="keyword">do</span> |<span class="params">config</span>|</span><br><span class="line">  config.hostmanager.enabled = <span class="literal">true</span></span><br><span class="line">  config.hostmanager.manage_host = <span class="literal">true</span></span><br><span class="line">  config.hostmanager.manage_guest = <span class="literal">true</span></span><br><span class="line">  config.hostmanager.ignore_private_ip = <span class="literal">false</span></span><br><span class="line">  config.hostmanager.include_offline = <span class="literal">true</span></span><br><span class="line">  config.vm.define <span class="string">&#x27;example-box&#x27;</span> <span class="keyword">do</span> |<span class="params">node</span>|</span><br><span class="line">    node.vm.hostname = <span class="string">&#x27;example-box-hostname&#x27;</span></span><br><span class="line">    node.vm.network <span class="symbol">:private_network</span>, <span class="symbol">ip:</span> <span class="string">&#x27;192.168.42.42&#x27;</span></span><br><span class="line">    node.hostmanager.aliases = <span class="string">%w(example-box.localdomain example-box-alias)</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><h3 id="æŒ‚è½½æœ¬æœºç›®å½•åˆ°è™šæ‹Ÿæœº"><a href="#æŒ‚è½½æœ¬æœºç›®å½•åˆ°è™šæ‹Ÿæœº" class="headerlink" title="æŒ‚è½½æœ¬æœºç›®å½•åˆ°è™šæ‹Ÿæœº"></a>æŒ‚è½½æœ¬æœºç›®å½•åˆ°è™šæ‹Ÿæœº</h3><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Vagrant</span>.configure(<span class="string">&quot;2&quot;</span>) <span class="keyword">do</span> |<span class="params">config</span>|</span><br><span class="line">    config.vm.define <span class="string">&quot;master&quot;</span> <span class="keyword">do</span> |<span class="params">master</span>|</span><br><span class="line">    master.vm.box = <span class="string">&quot;centos/7&quot;</span></span><br><span class="line">    master.vm.provider <span class="string">&quot;virtualbox&quot;</span></span><br><span class="line">    master.vm.network <span class="string">&quot;private_network&quot;</span>, <span class="symbol">ip:</span> <span class="string">&quot;10.10.0.10&quot;</span></span><br><span class="line">    master.vm.synced_folder <span class="string">&quot;/home/iuxt/code/system-deployment/configuration/puppet/modules&quot;</span>, <span class="string">&quot;/etc/puppetlabs/code/modules&quot;</span>,<span class="symbol">create:</span> <span class="literal">true</span>,<span class="symbol">owner:</span> <span class="string">&quot;root&quot;</span>, <span class="symbol">group:</span> <span class="string">&quot;root&quot;</span>,<span class="symbol">mount_options:</span>[<span class="string">&quot;dmode=775&quot;</span>,<span class="string">&quot;fmode=644&quot;</span>]</span><br></pre></td></tr></table></figure><blockquote><p>è¿™é‡Œå¯èƒ½ä¼šæç¤ºï¼š<code>mount: unknown filesystem type &#39;vboxsf&#39;</code>ï¼Œè¿™æ˜¯å› ä¸ºè™šæ‹Ÿæœºæ²¡æœ‰è‡ªå¸¦ <code>vbox guest agent</code>, ä»¥å‰çš„ centos æ˜¯ vagrant è‡ªå·±æ‰“åŒ…çš„ï¼Œéƒ½æ˜¯å¸¦ vbox guest agent çš„ï¼Œä½†æ˜¯ç°åœ¨ vagrant ä¸‹è½½ centos çš„ box çš„æ—¶å€™ä¼šé‡å®šå‘åˆ° centos å®˜ç½‘ï¼Œè¿™ä¸ª box æ˜¯ä¸å¸¦ vbox guest agent çš„ï¼Œè§£å†³åŠæ³•æœ‰ä»¥ä¸‹ï¼š</p><ol><li>æ›´æ¢é•œåƒä¸º <code>generic/centos7</code>, é•œåƒå®˜ç½‘ï¼š<a href="https://roboxes.org/">https://roboxes.org/</a></li><li>è‡ªå·±å®‰è£…å¥½å†é‡æ–°æ‰“åŒ… box</li><li>å®‰è£… <code>vagrant plugin install vagrant-vbguest</code>ï¼Œè¿™ä¸ªæ’ä»¶å¯ä»¥è‡ªåŠ¨æŒ‚è½½ isoï¼Œç„¶åå®‰è£…ã€‚</li><li>æ›´æ¢å¢åŠ  <code>type</code> å‚æ•°ï¼Œä½¿ç”¨ nfs æˆ– smb æ¥å’Œè™šæ‹Ÿæœºå…±äº«ï¼Œéœ€è¦ä¸»æœºå®‰è£… nfs æˆ– smb æœåŠ¡ã€‚</li></ol></blockquote>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> VirtualMachine </tag>
            
            <tag> vagrant </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hexo butterfly ä¸»é¢˜ä½¿ç”¨è®°å½•</title>
      <link href="/posts/sm3z1i/"/>
      <url>/posts/sm3z1i/</url>
      
        <content type="html"><![CDATA[<h2 id="å¼€å§‹ä½¿ç”¨"><a href="#å¼€å§‹ä½¿ç”¨" class="headerlink" title="å¼€å§‹ä½¿ç”¨"></a>å¼€å§‹ä½¿ç”¨</h2><p>nodejs ä½¿ç”¨ <code>v20.17.0</code> ç‰ˆæœ¬<br>åŒ…ç®¡ç†ä½¿ç”¨ npm</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆå§‹åŒ–ä¸»é¢˜ï¼Œç¬¬ä¸€æ¬¡éœ€è¦æ‰§è¡Œ</span></span><br><span class="line">git submodule init</span><br><span class="line">git submodule update</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…ä¾èµ–åŒ…</span></span><br><span class="line">npm i</span><br><span class="line"></span><br><span class="line"><span class="comment">## æŸ¥çœ‹æ•ˆæœ</span></span><br><span class="line">npx hexo s</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºæ–°æ–‡ç« </span></span><br><span class="line">npx hexo new <span class="string">&quot;æµ‹è¯•æ–‡ç« &quot;</span></span><br></pre></td></tr></table></figure><p>ç„¶åå°† <code>source/_posts/æµ‹è¯•æ–‡ç« .md</code> ç§»åŠ¨åˆ°å¯¹åº”çš„åˆ†ç±»ç›®å½•ä¸‹ã€‚</p><p><del>ç”±äº hexo-abbrlink å’Œ hexo-auto-category çš„å†²çªï¼Œéœ€è¦æ‰§è¡Œ 2 æ¬¡ <code>npx hexo g</code> æ‰èƒ½æ­£ç¡®ç”Ÿæˆéœ€è¦çš„ front matter</del>è¿™ä¸ªé—®é¢˜å·²ç»è§£å†³äº†, æ›¿æ¢æˆäº†åŒ… <code>hexo-abbrlink-iuxt</code> è§£å†³äº†è¿™ä¸ªé—®é¢˜, æ‰§è¡Œ <code>npx hexo g</code> å³å¯è‡ªåŠ¨ç”Ÿæˆå›ºå®šé“¾æ¥å’Œåˆ†ç±»</p><h2 id="å°é¢å›¾"><a href="#å°é¢å›¾" class="headerlink" title="å°é¢å›¾"></a>å°é¢å›¾</h2><p>1280 x 720 æˆ–è€… 3:2 çš„æ¯”ä¾‹</p><h2 id="å¸¸ç”¨-shortcode-è®°å½•"><a href="#å¸¸ç”¨-shortcode-è®°å½•" class="headerlink" title="å¸¸ç”¨ shortcode è®°å½•"></a>å¸¸ç”¨ shortcode è®°å½•</h2><p>æ ‡ç­¾å¤–æŒ‚å®˜æ–¹æ–‡æ¡£ï¼š <a href="https://butterfly.js.org/posts/2df239ce/">https://butterfly.js.org/posts/2df239ce/</a><br><a href="https://butterfly.js.org/posts/ceeb73f/">https://butterfly.js.org/posts/ceeb73f/</a></p><h3 id="tabs"><a href="#tabs" class="headerlink" title="tabs"></a>tabs</h3><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">ç¬¬ä¸€ä¸ªæ ‡ç­¾é¡µ</button><button type="button" class="tab">ç¬¬äºŒä¸ªæ ‡ç­¾é¡µ</button></div><div class="tab-contents"><div class="tab-item-content active"><p>&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;è¿™é‡Œæ˜¯ç¬¬ä¸€ä¸ªæ ‡ç­¾é¡µçš„å†…å®¹&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</p></div><div class="tab-item-content"><p>&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;è¿™é‡Œæ˜¯ç¬¬äºŒä¸ªæ ‡ç­¾é¡µçš„å†…å®¹&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</p></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div><h3 id="å›¾åº“"><a href="#å›¾åº“" class="headerlink" title="å›¾åº“"></a>å›¾åº“</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;% gallery %&#125;</span><br><span class="line">![](https://i.loli.net/2019/12/25/Fze9jchtnyJXMHN.jpg)</span><br><span class="line">![](https://i.loli.net/2019/12/25/ryLVePaqkYm4TEK.jpg)</span><br><span class="line">![](https://i.loli.net/2019/12/25/gEy5Zc1Ai6VuO4N.jpg)</span><br><span class="line">![](https://i.loli.net/2019/12/25/d6QHbytlSYO4FBG.jpg)</span><br><span class="line">![](https://i.loli.net/2019/12/25/6nepIJ1xTgufatZ.jpg)</span><br><span class="line">![](https://i.loli.net/2019/12/25/E7Jvr4eIPwUNmzq.jpg)</span><br><span class="line">![](https://i.loli.net/2019/12/25/mh19anwBSWIkGlH.jpg)</span><br><span class="line">![](https://i.loli.net/2019/12/25/2tu9JC8ewpBFagv.jpg)</span><br><span class="line">&#123;% endgallery %&#125;</span><br></pre></td></tr></table></figure><h3 id="è¡Œå†…å›¾ç‰‡"><a href="#è¡Œå†…å›¾ç‰‡" class="headerlink" title="è¡Œå†…å›¾ç‰‡"></a>è¡Œå†…å›¾ç‰‡</h3><p>æˆ‘è¦ºå¾—å¾ˆæ¼‚äº® <img class="inline-img" src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="/%3Chttps:/i.loli.net/2021/03/19/5M4jUB3ynq7ePgw.png%3E" style="height:150px" /></p><h3 id="æ–‡å­—é«˜äº®"><a href="#æ–‡å­—é«˜äº®" class="headerlink" title="æ–‡å­—é«˜äº®"></a>æ–‡å­—é«˜äº®</h3><p>é«˜äº®æ‰€éœ€çš„æ–‡å­—</p><mark class="hl-label color">text</mark><table><thead><tr><th>å‚æ•°</th><th>è§£é‡Š</th></tr></thead><tbody><tr><td>text</td><td>æ–‡å­—</td></tr><tr><td>color</td><td>ã€å¯é€‰ã€‘èƒŒæ™¯é¢œè‰²ï¼Œ default&#x2F;blue&#x2F;pink&#x2F;red&#x2F;purple&#x2F;orange&#x2F;green</td></tr></tbody></table><h3 id="æç¤º-è­¦å‘Š"><a href="#æç¤º-è­¦å‘Š" class="headerlink" title="æç¤º&#x2F;è­¦å‘Š"></a>æç¤º&#x2F;è­¦å‘Š</h3><p><a href="https://butterfly.js.org/posts/2df239ce/">https://butterfly.js.org/posts/2df239ce/</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note flat %&#125;</span><br><span class="line">é»˜èª æç¤ºå¡Šæ¨™ç±¤</span><br><span class="line">&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note default flat %&#125;</span><br><span class="line">default æç¤ºå¡Šæ¨™ç±¤</span><br><span class="line">&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note primary flat %&#125;</span><br><span class="line">primary æç¤ºå¡Šæ¨™ç±¤</span><br><span class="line">&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note success flat %&#125;</span><br><span class="line">success æç¤ºå¡Šæ¨™ç±¤</span><br><span class="line">&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note info flat %&#125;</span><br><span class="line">info æç¤ºå¡Šæ¨™ç±¤</span><br><span class="line">&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note warning flat %&#125;</span><br><span class="line">warning æç¤ºå¡Šæ¨™ç±¤</span><br><span class="line">&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note danger flat %&#125;</span><br><span class="line">danger æç¤ºå¡Šæ¨™ç±¤</span><br><span class="line">&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure><h2 id="å¦‚æœä¸æƒ³ä½¿ç”¨å›¾åºŠ"><a href="#å¦‚æœä¸æƒ³ä½¿ç”¨å›¾åºŠ" class="headerlink" title="å¦‚æœä¸æƒ³ä½¿ç”¨å›¾åºŠ"></a>å¦‚æœä¸æƒ³ä½¿ç”¨å›¾åºŠ</h2><p>åœ¨ source&#x2F;img ç›®å½•ä¸‹æ”¾ä½ çš„å›¾ç‰‡ï¼Œ ç”Ÿæˆçš„é™æ€æ–‡ä»¶åœ¨ï¼š <a href="https://xxx.com/img/1.png">https://xxx.com/img/1.png</a>ï¼Œ å¯ä»¥ç›´æ¥ä½¿ç”¨ &#x2F;img&#x2F;1.png æ¥å¼•ç”¨</p>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hexo </tag>
            
            <tag> åšå®¢ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸€ä¸ªç‰¹æ®Šçš„ç©ºæ ¼--ç¡¬ç©ºæ ¼</title>
      <link href="/posts/8e49530e/"/>
      <url>/posts/8e49530e/</url>
      
        <content type="html"><![CDATA[<h2 id="äº‹æƒ…çš„èµ·å› "><a href="#äº‹æƒ…çš„èµ·å› " class="headerlink" title="äº‹æƒ…çš„èµ·å› "></a>äº‹æƒ…çš„èµ·å› </h2><p>æˆ‘åœ¨æµ‹è¯•ä¸€ä¸ª <code>nginx</code> é…ç½®æ–‡ä»¶ï¼Œé…ç½®æ–‡ä»¶æ¥è‡ªäºå°è±¡ç¬”è®°ç½‘é¡µç‰ˆå¤åˆ¶ï¼ˆæœ¬äººç”¨çš„ linuxï¼Œæ²¡æœ‰å°è±¡ç¬”è®°å®¢æˆ·ç«¯å¯ç”¨ï¼‰ï¼Œç¼–è¾‘çš„æ—¶å€™å‘ç°äº†è¹Šè··ï¼š</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/image-20211028180909688.png" alt="image-20211028180909688"></p><p>ä¸è¿‡æ²¡æœ‰å¤ªåœ¨æ„ï¼Œè¿˜æœ‰ä¸€ç‚¹è¹Šè··çš„æ˜¯ <code>vim</code> ç¼–è¾‘çš„æ—¶å€™è¯¥é«˜äº®çš„åœ°æ–¹ä¹Ÿä¸é«˜äº®äº†ï¼Œæ¥ç€æ”¹å¥½äº†é…ç½®æ–‡ä»¶åï¼Œå‘ç° <code>nginx -t</code> æ€ä¹ˆæµ‹è¯•éƒ½ä¸é€šè¿‡ã€‚</p><h2 id="æ’æŸ¥é—®é¢˜"><a href="#æ’æŸ¥é—®é¢˜" class="headerlink" title="æ’æŸ¥é—®é¢˜"></a>æ’æŸ¥é—®é¢˜</h2><p>å½“ç„¶æ€€ç–‘æ˜¯ nginx é…ç½®æ–‡ä»¶çš„é—®é¢˜ï¼Œå°†é…ç½®æ–‡ä»¶å¤åˆ¶åˆ° <code>windows</code> ä¸‹ï¼Œä½¿ç”¨ <code>notepad++</code> ç¼–è¾‘ï¼ˆæ˜¾ç¤ºæ‰€æœ‰ç¬¦å·ï¼‰å‘ç°é‡Œé¢çš„ç©ºæ ¼å¹¶ä¸æ˜¯ç©ºæ ¼</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/image-20211028181420775.png" alt="image-20211028181420775"></p><p>çœŸæ­£çš„ç©ºæ ¼åº”è¯¥æ˜¾ç¤ºçš„æ˜¯ <code>.</code>ï¼Œtab æ˜¾ç¤ºçš„åº”è¯¥æ˜¯ <code>â¡ï¸</code>ã€‚å°†è¿™ä¸ª â€œ ç©ºæ ¼ â€œ å¤åˆ¶å‡ºæ¥ï¼Œç„¶åæ‰¾ä¸ªåœ¨çº¿è½¬æ¢å™¨<a href="http://www.hiencode.com/jinzhi.html">http://www.hiencode.com/jinzhi.html</a>è½¬æ¢æˆ 16 è¿›åˆ¶æ•°æ®ï¼Œå‘ç°æ˜¯ <code>a0</code></p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/image-20211028181809194.png" alt="image-20211028181809194"></p><p>ç„¶ååˆ°<a href="https://zh.wikipedia.org/wiki/Unicode%E5%AD%97%E7%AC%A6%E5%88%97%E8%A1%A8">https://zh.wikipedia.org/wiki/Unicode%E5%AD%97%E7%AC%A6%E5%88%97%E8%A1%A8</a>æœäº†ä¸‹ <code>a0</code>ï¼Œå‘ç°æ˜¯ä¸€ä¸ªå«åšä¸æ¢è¡Œç©ºæ ¼çš„ä¸œè¥¿ï¼Œåˆå«ç¡¬ç©ºæ ¼ï¼ˆhard spaceã€fixed spaceï¼‰</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/image-20211028180646950.png" alt="image-20211028180646950"></p><p>ç”¨é€”æ˜¯ç¦æ­¢æ¢è¡Œï¼Œå¸¸ç”¨äº <code>html</code>ï¼Œæ¯”å¦‚åœ°å€ <code>xxçœxxå¸‚ xxå¿ xxé•‡ xxæ‘</code> è¿™ä¸ªæˆ‘ä»¬å¸Œæœ›åœ¨ç½‘é¡µä¸Šä¸è¦æ¢è¡Œæ˜¾ç¤ºï¼Œå°±ä¼šæ‰“ä¸Š <code>&amp;nbsp;</code> å–ä»£ç©ºæ ¼ï¼Œè¡¨ç¤ºæˆ‘å¸Œæœ›åœ¨é¡µé¢å˜çª„çš„æ—¶å€™æ¢è¡Œæ˜¾ç¤ºã€‚</p>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¼–ç  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxç½‘ç»œè®¾å¤‡å‘½åè§„åˆ™åŠä¿®æ”¹</title>
      <link href="/posts/69bcc649/"/>
      <url>/posts/69bcc649/</url>
      
        <content type="html"><![CDATA[<h2 id="å‘½åè§„åˆ™"><a href="#å‘½åè§„åˆ™" class="headerlink" title="å‘½åè§„åˆ™"></a>å‘½åè§„åˆ™</h2><p>centos ä» 7 å¼€å§‹ç½‘å¡åç§°é»˜è®¤ä¸å†æ˜¯ç†Ÿæ‚‰çš„ eth0ã€è€Œæ˜¯ç±»ä¼¼äº ens33ã€enps0f0 ç­‰<br><a href="https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/7/html/networking_guide/ch-consistent_network_device_naming">rhel7å®˜æ–¹æ–‡æ¡£</a></p><h3 id="è¿™ä¹ˆåšçš„å¥½å¤„æ˜¯"><a href="#è¿™ä¹ˆåšçš„å¥½å¤„æ˜¯" class="headerlink" title="è¿™ä¹ˆåšçš„å¥½å¤„æ˜¯"></a>è¿™ä¹ˆåšçš„å¥½å¤„æ˜¯</h3><p>åœ¨ Red Hat Enterprise Linux 7 ä¸­ï¼Œudev æ”¯æŒå¤§é‡ä¸åŒçš„å‘½åæ–¹æ¡ˆã€‚é»˜è®¤æ˜¯æ ¹æ®å›ºä»¶ã€æ‹“æ‰‘åŠä½ç½®ä¿¡æ¯åˆ†é…å›ºå®šåç§°ã€‚è¿™æ ·åšçš„ä¼˜ç‚¹æ˜¯å‘½åå¯å®Œå…¨è‡ªåŠ¨è¿›è¡Œï¼Œå¹¶å¯é¢„æœŸï¼Œå³ä½¿æ·»åŠ æˆ–åˆ é™¤ç¡¬ä»¶åä¹Ÿä¼šä¿ç•™å…¶åç§°ï¼ˆä¸ä¼šå‡ºç°é‡å¤æšä¸¾çš„æƒ…å†µï¼‰ï¼ŒåŒæ—¶å¯é¡ºåˆ©æ›´æ¢æŸåçš„ç¡¬ä»¶ã€‚ä¸è¶³ä¹‹å¤„æ˜¯ï¼Œç›¸æ¯”ä¼ ç»Ÿçš„åç§°ï¼Œæ¯”å¦‚ eth0 æˆ– wlan0ï¼Œè¿™äº›åç§°æœ‰æ—¶ä¼šæ¯”è¾ƒéš¾ç†è§£ã€‚ä¾‹å¦‚ï¼šenp5s0ã€‚</p><h3 id="è®¾å¤‡å‘½åçš„è¿‡ç¨‹"><a href="#è®¾å¤‡å‘½åçš„è¿‡ç¨‹" class="headerlink" title="è®¾å¤‡å‘½åçš„è¿‡ç¨‹"></a>è®¾å¤‡å‘½åçš„è¿‡ç¨‹</h3><ol><li><code>/usr/lib/udev/rules.d/60-net.rules</code> æ–‡ä»¶ä¸­çš„è§„åˆ™ä¼šè®© udev å¸®åŠ©å·¥å…· <code>/lib/udev/rename_device</code> æŸ¥çœ‹æ‰€æœ‰ <code>/etc/sysconfig/network-scripts/ifcfg-suffix</code> æ–‡ä»¶ã€‚å¦‚æœå‘ç°åŒ…å« HWADDR æ¡ç›®çš„ ifcfg æ–‡ä»¶ä¸æŸä¸ªæ¥å£çš„ MAC åœ°å€åŒ¹é…ï¼Œå®ƒä¼šå°†è¯¥æ¥å£é‡å‘½åä¸º ifcfg æ–‡ä»¶ä¸­ç”± DEVICE æŒ‡ä»¤ç»™å‡ºçš„åç§°ã€‚</li><li><code>/usr/lib/udev/rules.d/71-biosdevname.rules</code> ä¸­çš„è§„åˆ™è®© biosdevname æ ¹æ®å…¶å‘½åç­–ç•¥é‡å‘½åè¯¥æ¥å£ï¼Œå³åœ¨ä¸Šä¸€æ­¥ä¸­æ²¡æœ‰é‡å‘½åè¯¥æ¥å£ã€å·²å®‰è£… biosdevnameã€ä¸”åœ¨ boot å‘½ä»¤è¡Œä¸­å°† <code>biosdevname=0</code> ä½œä¸ºå†…æ ¸å‘½ä»¤ç»™å‡ºã€‚</li><li><code>/lib/udev/rules.d/75-net-description.rules</code> ä¸­çš„è§„åˆ™è®© udev é€šè¿‡æ£€æŸ¥ç½‘ç»œæ¥å£è®¾å¤‡ï¼Œå¡«å†™å†…éƒ¨ udev è®¾å¤‡å±æ€§å€¼ ID_NET_NAME_ONBOARDã€ID_NET_NAME_SLOTã€ID_NET_NAME_PATHã€‚æ³¨ï¼šæœ‰äº›è®¾å¤‡å±æ€§å¯èƒ½å¤„äºæœªå®šä¹‰çŠ¶æ€ã€‚</li><li><code>/usr/lib/udev/rules.d/80-net-name-slot.rules</code> ä¸­çš„è§„åˆ™è®© udev é‡å‘½åè¯¥æ¥å£ï¼Œä¼˜å…ˆé¡ºåºå¦‚ä¸‹ï¼šID_NET_NAME_ONBOARDã€ID_NET_NAME_SLOTã€ID_NET_NAME_PATHã€‚å¹¶æä¾›å¦‚ä¸‹ä¿¡æ¯ï¼šæ²¡æœ‰åœ¨æ­¥éª¤ 1 æˆ– 2 ä¸­é‡å‘½åè¯¥æ¥å£ï¼ŒåŒæ—¶æœªç»™å‡ºå†…æ ¸å‚æ•° <code>net.ifnames=0</code>ã€‚å¦‚æœä¸€ä¸ªå‚æ•°æœªè®¾å®šï¼Œåˆ™ä¼šæŒ‰åˆ—è¡¨çš„é¡ºåºè®¾å®šä¸‹ä¸€ä¸ªã€‚å¦‚æœæ²¡æœ‰è®¾å®šä»»ä½•å‚æ•°ï¼Œåˆ™ä¸ä¼šé‡å‘½åè¯¥æ¥å£ã€‚</li></ol><h2 id="ä¿®æ”¹ç½‘ç»œè®¾å¤‡å‘½å"><a href="#ä¿®æ”¹ç½‘ç»œè®¾å¤‡å‘½å" class="headerlink" title="ä¿®æ”¹ç½‘ç»œè®¾å¤‡å‘½å"></a>ä¿®æ”¹ç½‘ç»œè®¾å¤‡å‘½å</h2><h3 id="debian-ç³»ã€ubuntu-ç­‰"><a href="#debian-ç³»ã€ubuntu-ç­‰" class="headerlink" title="debian ç³»ã€ubuntu ç­‰"></a>debian ç³»ã€ubuntu ç­‰</h3><p>vim &#x2F;etc&#x2F;default&#x2F;grub</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¦‚æœè¿™é¡¹æœ‰å‚æ•°äº†ï¼Œå’Œç°æœ‰å‚æ•°ç”¨ç©ºæ ¼åˆ†å¼€</span></span><br><span class="line"><span class="attr">GRUB_CMDLINE_LINUX</span>=<span class="string">&quot;net.ifnames=0 biosdevname=0&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo update-grub</span><br><span class="line">sudo reboot</span><br></pre></td></tr></table></figure><p>é‡å¯åæ‰§è¡Œ <code>ip a</code> æŸ¥çœ‹è®¾å¤‡åä¿®æ”¹æˆåŠŸäº†æ²¡æœ‰</p><p>ç„¶åä¿®æ”¹ç½‘ç»œï¼š<br>vim &#x2F;etc&#x2F;netplan&#x2F;xx.yaml</p><p>è®¾å¤‡åä¿®æ”¹åï¼Œæ‰§è¡Œ <code>netplan try</code></p><h3 id="redhat-ç³»ã€centos-ç­‰"><a href="#redhat-ç³»ã€centos-ç­‰" class="headerlink" title="redhat ç³»ã€centos ç­‰"></a>redhat ç³»ã€centos ç­‰</h3><p>vim &#x2F;etc&#x2F;sysconfig&#x2F;grub</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">GRUB_CMDLINE_LINUX</span>=<span class="string">&quot;... net.ifnames=0 biosdevname=0&quot;</span></span><br></pre></td></tr></table></figure><p>ç„¶åæ›´æ–° grubã€é‡å¯ã€æ›´æ”¹ç½‘ç»œé…ç½®æ–‡ä»¶</p><h4 id="åœ¨å®‰è£…ç³»ç»Ÿæ—¶ä¿®æ”¹"><a href="#åœ¨å®‰è£…ç³»ç»Ÿæ—¶ä¿®æ”¹" class="headerlink" title="åœ¨å®‰è£…ç³»ç»Ÿæ—¶ä¿®æ”¹"></a>åœ¨å®‰è£…ç³»ç»Ÿæ—¶ä¿®æ”¹</h4><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">Debian</button><button type="button" class="tab">CentOS</button></div><div class="tab-contents"><div class="tab-item-content active"><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202404262259986.png" alt="image.png"></p><p>è¿™ä¸ªç•Œé¢æŒ‰ä¸‹ <code>e</code></p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202404262301459.png" alt="image.png"></p><p>å‚æ•°æ·»åŠ å®Œæˆåï¼ŒæŒ‰ä¸‹ <code>F10</code> å¯åŠ¨</p></div><div class="tab-item-content"><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202401301209674.png" alt="202401301209674.png|592"></p><p>å…‰æ ‡æ”¾åœ¨ install ä¸Šï¼Œ æŒ‰ä¸‹ tab é”®ï¼Œ åœ¨ quiet åé¢è¾“å…¥ <code> net.ifnames=0 biosdevname=0</code></p></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div><h2 id="kickstart-é¢„å®‰è£…å›ºå®šè®¾å¤‡å"><a href="#kickstart-é¢„å®‰è£…å›ºå®šè®¾å¤‡å" class="headerlink" title="kickstart é¢„å®‰è£…å›ºå®šè®¾å¤‡å"></a>kickstart é¢„å®‰è£…å›ºå®šè®¾å¤‡å</h2><h3 id="centos-ç³»"><a href="#centos-ç³»" class="headerlink" title="centos ç³»"></a>centos ç³»</h3><p>ä¸€å…±æœ‰ä¸¤ä¸ªåœ°æ–¹éœ€è¦ä¿®æ”¹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">virt-install \</span><br><span class="line">    --hvm --virt-type kvm \</span><br><span class="line">    --accelerate \</span><br><span class="line">    --name vm-conghua \</span><br><span class="line">    --os-type linux \</span><br><span class="line">    --vcpus 2 \</span><br><span class="line">    --ram 4096 \</span><br><span class="line">    --disk path=/dev/mapper/ssd_data-vm_conghua \</span><br><span class="line">    --network bridge:br13,model=virtio \</span><br><span class="line">    --nographics \</span><br><span class="line">    --location http://cn.archive.ubuntu.com/ubuntu/dists/focal/main/installer-amd64/ \</span><br><span class="line">    --initrd-inject=/tmp/tmp.HotM405TfF/ks.cfg \</span><br><span class="line">    --cpu host \</span><br><span class="line">    --extra-args <span class="string">&#x27;ks=file:/ks.cfg console=tty0 console=ttyS0,115200n8 net.ifnames=0 biosdevname=0&#x27;</span></span><br></pre></td></tr></table></figure><p>ks.cfg</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">bootloader --location=mbr --driveorder=vda --append=&quot; crashkernel=auto console=ttyS0,115200n8 net.ifnames=0 biosdevname=0&quot;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Network </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Puppet Serverä»éƒ¨ç½²åˆ°ä¸Šçº¿ä½¿ç”¨</title>
      <link href="/posts/e8243516/"/>
      <url>/posts/e8243516/</url>
      
        <content type="html"><![CDATA[<p>è¿™æ˜¯ä¸€ç¯‡ todo æ–‡ç« ï¼Œå¯ä»¥å¿«é€Ÿå°† puppetserver éƒ¨ç½²èµ·æ¥ï¼Œç»å¸¸é‡åˆ°çš„å‘ä¹Ÿä¼šå†™å‡ºæ¥ï¼Œä½†æ˜¯è‡ªå·±ä¸è¸©å­è®°å¿†æ˜¯æ²¡æœ‰æˆé•¿çš„ï¼ˆä¸ä»…ä»…æ˜¯æ”¶è·ç»éªŒï¼Œé‡è¦çš„æ˜¯å¢åŠ äº†å­¦ä¹ çš„èƒ½åŠ›ï¼‰ï¼Œå¦‚æœä¸ç¼ºæ—¶é—´çš„è¯ï¼Œå¼ºçƒˆå»ºè®®çœ‹å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://puppet.com/docs/puppet/7/server/install_from_packages.html">https://puppet.com/docs/puppet/7/server/install_from_packages.html</a></p><h2 id="å®‰è£…-master"><a href="#å®‰è£…-master" class="headerlink" title="å®‰è£… master"></a>å®‰è£… master</h2><h3 id="é€šè¿‡æºæ¥å®‰è£…"><a href="#é€šè¿‡æºæ¥å®‰è£…" class="headerlink" title="é€šè¿‡æºæ¥å®‰è£…"></a>é€šè¿‡æºæ¥å®‰è£…</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo rpm -Uvh https://yum.puppet.com/puppet7-release-el-8.noarch.rpm</span><br><span class="line">sudo yum install puppetserver</span><br></pre></td></tr></table></figure><h3 id="å¯åŠ¨-master-æœåŠ¡"><a href="#å¯åŠ¨-master-æœåŠ¡" class="headerlink" title="å¯åŠ¨ master æœåŠ¡"></a>å¯åŠ¨ master æœåŠ¡</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl start puppetserver</span><br></pre></td></tr></table></figure><blockquote><p>å¦‚æœæŠ¥é”™ <code>Found master private key &#39;/etc/puppetlabs/puppet/ssl/private_keys/localhost.localdomain.pem&#39; but master public key &#39;/etc/puppetlabs/puppet/ssl/public...</code> éœ€è¦æŠŠ ssl ç›®å½•åˆ é™¤ <code>sudo rm -rf /etc/puppetlabs/puppet/ssl/*</code>ï¼ˆ<strong>å·²ç»ä¸Šçº¿çš„ masterï¼Œè¯·è‡ªå·±è€ƒè™‘åæœå†å†³å®š</strong>ï¼‰ï¼Œå†å°è¯•å¯åŠ¨</p></blockquote><h3 id="ä¿®æ”¹-dns-è§£æ"><a href="#ä¿®æ”¹-dns-è§£æ" class="headerlink" title="ä¿®æ”¹ dns è§£æ"></a>ä¿®æ”¹ dns è§£æ</h3><p>è§£æ puppet åˆ° master çš„ ip å³å¯</p><blockquote><p>æˆ–è€…ç»‘å®š hosts, å¦‚æœæ˜¯ hostsï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½éœ€è¦ç»‘å®š hosts åˆ° master çš„ ip</p></blockquote><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">10.10.0.10  puppet</span><br></pre></td></tr></table></figure><h2 id="å®‰è£…-puppet-agent"><a href="#å®‰è£…-puppet-agent" class="headerlink" title="å®‰è£… puppet-agent"></a>å®‰è£… puppet-agent</h2><blockquote><p>å®‰è£… agnet éœ€è¦å…ˆå¯ç”¨ä»“åº“</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo rpm -Uvh https://yum.puppet.com/puppet7-release-el-8.noarch.rpm</span><br><span class="line">sudo yum install puppet-agent</span><br></pre></td></tr></table></figure><h2 id="anget-è¿æ¥-server"><a href="#anget-è¿æ¥-server" class="headerlink" title="anget è¿æ¥ server"></a>anget è¿æ¥ server</h2><h3 id="æ‰‹åŠ¨ç­¾åè®¤è¯"><a href="#æ‰‹åŠ¨ç­¾åè®¤è¯" class="headerlink" title="æ‰‹åŠ¨ç­¾åè®¤è¯"></a>æ‰‹åŠ¨ç­¾åè®¤è¯</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#] puppet agent --test</span></span><br><span class="line"></span><br><span class="line">Info: Creating a new RSA SSL key <span class="keyword">for</span> agent</span><br><span class="line">Info: csr_attributes file loading from /etc/puppetlabs/puppet/csr_attributes.yaml</span><br><span class="line">Info: Creating a new SSL certificate request <span class="keyword">for</span> agent</span><br><span class="line">Info: Certificate Request fingerprint (SHA256): A3:CA:C3:B1:69:C9:97:3D:3A:BB:A4:F0:E5:15:34:A5:74:B5:86:08:E1:A9:02:A6:D4:91:12:04:6A:89:76:70</span><br><span class="line">Info: Certificate <span class="keyword">for</span> agent has not been signed yet</span><br><span class="line">Couldn<span class="string">&#x27;t fetch certificate from CA server; you might still need to sign this agent&#x27;</span>s certificate (agent).</span><br><span class="line">Exiting now because the waitforcert setting is <span class="built_in">set</span> to 0.</span><br></pre></td></tr></table></figure><p>è¿™æ—¶å€™éœ€è¦åœ¨ master èŠ‚ç‚¹ä¸Šé¢å…è®¸ agnet çš„è¯ä¹¦ï¼Œä»¥ä¸‹æ˜¯ master èŠ‚ç‚¹æ‰§è¡Œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹è¿˜æ²¡ç­¾åçš„è¯ä¹¦</span></span><br><span class="line">puppetserver ca list</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»™æ‰€æœ‰è¯ä¹¦ç­¾å</span></span><br><span class="line">puppetserver ca sign --all</span><br></pre></td></tr></table></figure><h3 id="è‡ªåŠ¨ç­¾åè®¤è¯"><a href="#è‡ªåŠ¨ç­¾åè®¤è¯" class="headerlink" title="è‡ªåŠ¨ç­¾åè®¤è¯"></a>è‡ªåŠ¨ç­¾åè®¤è¯</h3><p>è‡ªåŠ¨è®¤è¯éœ€è¦ç¼–å†™ ACL è§„åˆ™ï¼Œä¸€ä¸ªç®€å•çš„è§„åˆ™å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#] vim /etc/puppetlabs/puppet/autosign.conf</span></span><br><span class="line"></span><br><span class="line">*.localhost.com</span><br></pre></td></tr></table></figure><p>ç„¶åé‡æ–°å¯åŠ¨ master æœåŠ¡å³å¯</p><h2 id="éƒ¨ç½²ä»£ç "><a href="#éƒ¨ç½²ä»£ç " class="headerlink" title="éƒ¨ç½²ä»£ç "></a>éƒ¨ç½²ä»£ç </h2><p>ç„¶åæŠŠæ¸…å•æ–‡ä»¶ (.pp) æ”¾åˆ° master çš„ <code>/etc/puppetlabs/code/environments/production/manifests</code><br><code>modules</code> æ”¾åˆ° <code>/etc/puppetlabs/code/modules</code></p><h2 id="å…¶ä»–è¯ä¹¦æ“ä½œ"><a href="#å…¶ä»–è¯ä¹¦æ“ä½œ" class="headerlink" title="å…¶ä»–è¯ä¹¦æ“ä½œ"></a>å…¶ä»–è¯ä¹¦æ“ä½œ</h2><h3 id="åŠé”€è¯ä¹¦"><a href="#åŠé”€è¯ä¹¦" class="headerlink" title="åŠé”€è¯ä¹¦"></a>åŠé”€è¯ä¹¦</h3><p>å¦‚æœä¸æƒ³è®©æŸä¸ª agent æ¥è¿æ¥ masterï¼Œå¯ä»¥åœ¨ master ä¸Šé¢æŠŠè¯ä¹¦æ’¤é”€</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">puppetserver ca revoke --certname agent_name</span><br></pre></td></tr></table></figure><h3 id="æ¸…ç†è¯ä¹¦"><a href="#æ¸…ç†è¯ä¹¦" class="headerlink" title="æ¸…ç†è¯ä¹¦"></a>æ¸…ç†è¯ä¹¦</h3><p>æ¯”å¦‚è¯´é‡è£…äº†ç³»ç»Ÿï¼Œéœ€è¦ master é‡æ–°ç”Ÿæˆè¯ä¹¦</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">puppetserver ca clean --certname agent_name</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Puppet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxç½‘ç»œç®¡ç†å‘½ä»¤</title>
      <link href="/posts/211e1b4c/"/>
      <url>/posts/211e1b4c/</url>
      
        <content type="html"><![CDATA[<blockquote><p>2009 å¹´ Debian å¼€å‘è€…é‚®ä»¶åˆ—è¡¨å®£å¸ƒæ”¾å¼ƒä½¿ç”¨ç¼ºä¹ç»´æŠ¤çš„ net-tools å·¥å…·åŒ…ï¼Œnet-tools åŒ…å«å†å²æ‚ ä¹…çš„ ifconfig, netstat ç­‰ç½‘ç»œç›¸å…³çš„å‘½ä»¤<br>iproute2 ç”¨äºå–ä»£ net-toolsï¼Œåœ¨å¤§éƒ¨åˆ†çš„å‘è¡Œç‰ˆéƒ½è‡ªå¸¦äº†ã€‚å‘½ä»¤æœ‰ ip, ss, net ç­‰å‘½ä»¤æ›¿ä»£äº†ä¹‹å‰çš„ç½‘ç»œæ“ä½œå‘½ä»¤ã€‚</p></blockquote><h2 id="å‘½ä»¤å¯¹ç…§è¡¨"><a href="#å‘½ä»¤å¯¹ç…§è¡¨" class="headerlink" title="å‘½ä»¤å¯¹ç…§è¡¨"></a>å‘½ä»¤å¯¹ç…§è¡¨</h2><table><thead><tr><th>net-tools</th><th>iproute2</th></tr></thead><tbody><tr><td>arp -na</td><td>ip neigh</td></tr><tr><td>ifconfig</td><td>ip link</td></tr><tr><td>ifconfig -a</td><td>ip addr show</td></tr><tr><td>ifconfig -s</td><td>ip -s link</td></tr><tr><td>ifconfig eth0 up</td><td>ip link set eth0 up</td></tr><tr><td>ipmaddr</td><td>ip maddr</td></tr><tr><td>iptunnel</td><td>ip tunnel</td></tr><tr><td>netstat</td><td>ss</td></tr><tr><td>netstat -i</td><td>ip -s link</td></tr><tr><td>netstat -g</td><td>ip maddr</td></tr><tr><td>netstat -l</td><td>ss -l</td></tr><tr><td>netstat -r</td><td>ip route</td></tr><tr><td>route add</td><td>ip route add</td></tr><tr><td>route del</td><td>ip route del</td></tr><tr><td>route -n</td><td>ip route show</td></tr><tr><td>vconfig</td><td>ip link</td></tr></tbody></table><h2 id="ip-å‘½ä»¤"><a href="#ip-å‘½ä»¤" class="headerlink" title="ip å‘½ä»¤"></a>ip å‘½ä»¤</h2><h3 id="é…ç½®-ip-æˆ–è€…æ¥å£"><a href="#é…ç½®-ip-æˆ–è€…æ¥å£" class="headerlink" title="é…ç½® ip æˆ–è€…æ¥å£"></a>é…ç½® ip æˆ–è€…æ¥å£</h3><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>ip a</td><td>æ˜¾ç¤ºæ‰€æœ‰ç½‘ç»œæ¥å£</td></tr><tr><td>ip -4 a</td><td>æ˜¾ç¤ºæ‰€æœ‰ IPv4 ç›¸å…³ç½‘ç»œæ¥å£</td></tr><tr><td>ip a show eth0</td><td>æŸ¥çœ‹ç‰¹å®šçš„ç½‘ç»œæ¥å£</td></tr><tr><td>ip a add 192.168.80.174 dev eth0</td><td>æ·»åŠ  ip åœ°å€</td></tr><tr><td>ip a del 192.168.80.174 dev eth0</td><td>åˆ é™¤ ip åœ°å€</td></tr><tr><td>ip -s -s a f to 192.168.1.0&#x2F;24</td><td>æ¸…é™¤æ‰€æœ‰æ¥å£ä¸Šçš„æ‰€æœ‰åœ°å€</td></tr><tr><td>ip link set dev eth0 address 00:0c:29:33:4e:aa</td><td>æ·»åŠ  MAC åœ°å€</td></tr><tr><td>ip link set eth0 down</td><td>ç¦ç”¨ç½‘ç»œæ¥å£</td></tr><tr><td>ip link set eth0 up</td><td>å¯ç”¨ç½‘ç»œæ¥å£</td></tr><tr><td>ip link ls up</td><td>åˆ—å‡ºæ­£åœ¨è¿è¡Œçš„ç½‘ç»œæ¥å£</td></tr><tr><td>ip link set dev eth0 arp on</td><td>å¯ç”¨ ARP åè®®</td></tr><tr><td>ip link set txqueuelen 10000 dev eth0</td><td>è®¾ç½®é˜Ÿåˆ—ä¼ è¾“é•¿åº¦</td></tr><tr><td>ip link set mtu 9000 dev eth0</td><td>è®¾ç½®æœ€å¤§ä¼ è¾“å•å…ƒ</td></tr></tbody></table><h3 id="é…ç½®è·¯ç”±"><a href="#é…ç½®è·¯ç”±" class="headerlink" title="é…ç½®è·¯ç”±"></a>é…ç½®è·¯ç”±</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹æ‰€æœ‰è·¯ç”±è¡¨</span></span><br><span class="line">ip r</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ /åˆ é™¤é»˜è®¤çš„ç½‘å…³</span></span><br><span class="line">ip route add default via 192.168.1.254</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ è·¯ç”±</span></span><br><span class="line">ip route add 192.168.1.0/24 dev eth0</span><br><span class="line">ip route add 192.168.1.0/24 via 192.168.1.1</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤è·¯ç”±</span></span><br><span class="line">ip route del 192.168.1.0/24 dev eth0</span><br><span class="line">ip route del 192.168.1.0/24 via 192.168.1.1</span><br></pre></td></tr></table></figure><h2 id="ss-å‘½ä»¤"><a href="#ss-å‘½ä»¤" class="headerlink" title="ss å‘½ä»¤"></a>ss å‘½ä»¤</h2><blockquote><p>ss æ˜¯ Socket Statistics çš„ç¼©å†™ï¼Œç”¨æ¥è·å– socket ç»Ÿè®¡ä¿¡æ¯ï¼Œå¯ä»¥æ˜¾ç¤ºå’Œ netstat ç±»ä¼¼çš„å†…å®¹ã€‚ss çš„ä¼˜åŠ¿åœ¨äºå®ƒèƒ½å¤Ÿæ˜¾ç¤ºæ›´å¤šæ›´è¯¦ç»†çš„æœ‰å…³ TCP å’Œè¿æ¥çŠ¶æ€çš„ä¿¡æ¯ï¼Œè€Œä¸”æ¯” netstat æ›´å¿«é€Ÿæ›´é«˜æ•ˆã€‚</p></blockquote><h3 id="SS-å‘½ä»¤ä½¿ç”¨å®ä¾‹"><a href="#SS-å‘½ä»¤ä½¿ç”¨å®ä¾‹" class="headerlink" title="SS å‘½ä»¤ä½¿ç”¨å®ä¾‹"></a>SS å‘½ä»¤ä½¿ç”¨å®ä¾‹</h3><table><thead><tr><th>å¸¸ç”¨å‘½ä»¤</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>ss -t -a</td><td>æ˜¾ç¤º TCP è¿æ¥</td></tr><tr><td>ss -s</td><td>æ˜¾ç¤º Sockets æ‘˜è¦</td></tr><tr><td>ss -l</td><td>åˆ—å‡ºæ‰€æœ‰æ‰“å¼€çš„ç½‘ç»œè¿æ¥ç«¯å£</td></tr><tr><td>ss -pl</td><td>æŸ¥çœ‹è¿›ç¨‹ä½¿ç”¨çš„ socket</td></tr><tr><td>ss -u -a</td><td>æ˜¾ç¤ºæ‰€æœ‰ UDP Sockets</td></tr><tr><td>ss -anltp</td><td>æ˜¾ç¤ºæ‰€æœ‰ç›‘å¬çš„ tcp ç«¯å£</td></tr></tbody></table><h3 id="ç”¨-TCP-çŠ¶æ€è¿‡æ»¤-Sockets"><a href="#ç”¨-TCP-çŠ¶æ€è¿‡æ»¤-Sockets" class="headerlink" title="ç”¨ TCP çŠ¶æ€è¿‡æ»¤ Sockets"></a>ç”¨ TCP çŠ¶æ€è¿‡æ»¤ Sockets</h3><p>æ˜¾ç¤ºæ‰€æœ‰çŠ¶æ€ä¸º Established çš„ HTTP è¿æ¥ï¼ˆhttp å¯ä»¥æ¢æˆ ssh æˆ–æ•°å­—ï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ss -anltp state established <span class="string">&#x27;( dport = :http or sport = :http )&#x27;</span></span><br></pre></td></tr></table></figure><blockquote><p>state å¯é€‰çš„æœ‰</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">established</span><br><span class="line">syn-sent</span><br><span class="line">syn-recv</span><br><span class="line">fin-wait-1</span><br><span class="line">fin-wait-2</span><br><span class="line">time-wait</span><br><span class="line">closed</span><br><span class="line">close-wait</span><br><span class="line">last-ack</span><br><span class="line">listen</span><br><span class="line">closing</span><br><span class="line"></span><br><span class="line">all :           æ‰€æœ‰ä»¥ä¸ŠçŠ¶æ€</span><br><span class="line">connected :     é™¤äº†listen and closedçš„æ‰€æœ‰çŠ¶æ€</span><br><span class="line">synchronized :  æ‰€æœ‰å·²è¿æ¥çš„çŠ¶æ€é™¤äº†syn-sent</span><br><span class="line">bucket :        æ˜¾ç¤ºçŠ¶æ€ä¸ºmaintained as minisockets,å¦‚ï¼štime-waitå’Œsyn-recv</span><br><span class="line">big :           å’Œbucketç›¸å</span><br></pre></td></tr></table></figure><h2 id="NetworkManager"><a href="#NetworkManager" class="headerlink" title="NetworkManager"></a>NetworkManager</h2><blockquote><p>NetworkManager æ˜¯ä¸€ä¸ªå®ˆæŠ¤è¿›ç¨‹ï¼Œç”¨æˆ·ä¸ä¸ NetworkManager ç³»ç»ŸæœåŠ¡ç›´æ¥äº’åŠ¨ï¼Œè€Œæ˜¯é€šè¿‡å›¾å½¢åŠå‘½ä»¤è¡Œç”¨æˆ·ç•Œé¢å·¥å…·æ‰§è¡Œç½‘ç»œé…ç½®ä»»åŠ¡ã€‚Red Hat Enterprise Linux 7 ä¸­æœ‰ä»¥ä¸‹å·¥å…·å¯ç”¨ï¼š<br>nmtui nmcli å’Œä¸€äº›å›¾å½¢ç•Œé¢ç®¡ç†å·¥å…·ç­‰</p></blockquote><p>å‚è€ƒæ–‡æ¡£: <a href="https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/7/html/networking_guide/ch-introduction_to_rhel_networking">https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/7/html/networking_guide/ch-introduction_to_rhel_networking</a></p><p>æŸ¥çœ‹ NetworkManager çŠ¶æ€</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl status NetworkManager</span><br></pre></td></tr></table></figure><h3 id="nmcli"><a href="#nmcli" class="headerlink" title="nmcli"></a>nmcli</h3><p>å¸¸ç”¨å‘½ä»¤ï¼Œconnection å¯ä»¥ç®€å†™æˆ c</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">nmcli c reload                      é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶</span><br><span class="line">nmcli connection show               è¦æ˜¾ç¤ºæ‰€æœ‰é“¾æ¥</span><br><span class="line">nmcli device status                 æ˜¾ç¤ºç”± NetworkManager è¯†åˆ«åˆ°è®¾å¤‡åŠå…¶çŠ¶æ€ï¼š</span><br><span class="line">nmcli dev disconnect iface bond0    åœæ­¢ç½‘ç»œæ¥å£</span><br><span class="line">nmcli con up ens33                  æ¿€æ´»ç½‘ç»œè¿æ¥</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="nmtui"><a href="#nmtui" class="headerlink" title="nmtui"></a>nmtui</h3><p>å®‰è£…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install NetworkManager-tui</span><br></pre></td></tr></table></figure><p>æ–‡æœ¬å›¾å½¢å·¥å…·ï¼Œä½¿ç”¨æ–¹æ³•ç•¥</p>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Command </tag>
            
            <tag> Linux </tag>
            
            <tag> Network </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦ç”¨å®¹å™¨(æˆ–è€…è¯´k8s)</title>
      <link href="/posts/cb400b2a/"/>
      <url>/posts/cb400b2a/</url>
      
        <content type="html"><![CDATA[<h2 id="èµ·å› æˆ–ç°çŠ¶"><a href="#èµ·å› æˆ–ç°çŠ¶" class="headerlink" title="èµ·å› æˆ–ç°çŠ¶"></a>èµ·å› æˆ–ç°çŠ¶</h2><blockquote><p>å…¬å¸å‡†å¤‡ä¸Šçº¿ k8s é›†ç¾¤ï¼Œç›®å‰åœ¨äº‘ä¸Šæœ‰å¾®è½¯ azure æ‰˜ç®¡çš„ aksï¼Œaks ä¸Šé¢çš„ç”¨æ¥éƒ¨ç½²ä¸€äº›å¯¹å¤–çš„ä¸šåŠ¡ï¼Œæ•°æ®ä¸­å¿ƒï¼ˆæœ‰ä¸¤ä¸ª - ç§»åŠ¨å’Œç”µä¿¡ï¼‰æ˜¯æˆ‘è‡ªå»ºçš„ï¼Œä¸»è¦æ˜¯å¯¹å†…ç½‘æœåŠ¡</p></blockquote><p>ç°åœ¨çš„é—®é¢˜æ˜¯æˆ‘ä»¬æ„ä½¿ç”¨çš„æ˜¯ jenkinsï¼Œæ„å»ºæ–¹å¼å’Œä¼ ç»Ÿè™šæ‹Ÿæœºå‘å¸ƒæ²¡ä»€ä¹ˆåŒºåˆ«ï¼Œåªæ˜¯æ¢æˆäº†å®¹å™¨ï¼Œç®€å•æ¥è¯´å°±æ˜¯:</p><blockquote><p>ä¼ ç»Ÿå‘å¸ƒï¼ˆæ‰€æœ‰ç¯å¢ƒæµç¨‹ä¸€è‡´ï¼‰ï¼š æ‹‰ä»£ç  - æ„å»º - å¯æ‰§è¡Œæ–‡ä»¶ä¸Šä¼ æœåŠ¡å™¨<br>ç°åœ¨å‘å¸ƒï¼ˆæ‰€æœ‰ç¯å¢ƒæµç¨‹ä¸€è‡´ï¼‰ï¼š æ‹‰å®¹å™¨é•œåƒï¼ˆåŸºç¡€ç¯å¢ƒï¼‰ - æ‹‰ä»£ç  - æ„å»º - ä¸Šä¼ é•œåƒä»“åº“</p></blockquote><p>æ‰€æœ‰ç¯å¢ƒçš„å‘å¸ƒéƒ½éœ€è¦å‡†å¤‡ä¸€å¥—ç¯å¢ƒï¼Œä¹Ÿå°±æ˜¯è¯´å®¹å™¨å¹¶æ²¡æœ‰è§£å†³æˆ‘ä»¬çš„ç¯å¢ƒæ ‡å‡†åŒ–çš„é—®é¢˜ï¼Œæ¯”å¦‚ï¼š</p><blockquote><p>æˆ‘ä»¬çš„ jenkins çš„ node èŠ‚ç‚¹åœ¨æ•°æ®ä¸­å¿ƒã€åŠå…¬å®¤å†…ç½‘ã€azure äº‘ä¸Šéƒ½æœ‰ï¼Œå› ä¸ºè¿™äº›ç¯å¢ƒéƒ½éœ€è¦æ„å»ºä¸€éé•œåƒ<br>å›´ç»•æ„å»ºéœ€è¦æä¾›ä¸€äº›åŸºç¡€è®¾æ–½ï¼Œæ¯”å¦‚æˆ‘ä»¬ aptã€mavenã€pypi ç­‰çš„ç¼“å­˜æœåŠ¡ï¼ˆç”¨çš„ nexusï¼‰ï¼Œå®¹å™¨é•œåƒä»“åº“ï¼ˆç”¨çš„ jfrogï¼‰è¿™äº›éƒ½éœ€è¦åœ¨æ¯ä¸ªç¯å¢ƒå‡†å¤‡ä¸€å¥—ï¼Œæ¯ä¸ªæœåŠ¡è¿˜éœ€è¦åšé«˜å¯ç”¨ï¼Œç®€å•ç®—ä¸‹æ¥ä¹Ÿæœ‰ 6 ä¸ª nexus å’Œ 4 ä¸ª jfrog</p></blockquote><p>å¦‚æœæˆ‘ä»¬æ¢æˆåŠå…¬å®¤æ„å»ºå®Œæˆï¼Œä¸Šä¼ åˆ°å…¬ç½‘çš„ jfrog ä»“åº“ï¼Œåé¢æ‰€æœ‰çš„æ“ä½œéƒ½ä»¥å®¹å™¨é•œåƒä¸ºå•ä½è¿›è¡Œï¼ˆæ¯”å¦‚æµ‹è¯•æµ‹è¯•çš„å°±æ˜¯é•œåƒã€å‘å¸ƒå‘å¸ƒçš„ä¹Ÿæ˜¯é•œåƒè€Œä¸æ˜¯ä»£ç ï¼‰ï¼Œnexus ç¼“å­˜å’Œ jfrog åªéœ€è¦ 1 ä¸ªå°±å¯ä»¥äº†ï¼Œè€Œä¸”å¯ä»¥ä¿è¯æµ‹è¯•ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒä¸€è‡´ã€‚</p><h2 id="ä¸ºä»€ä¹ˆä¼šè¿™æ ·"><a href="#ä¸ºä»€ä¹ˆä¼šè¿™æ ·" class="headerlink" title="ä¸ºä»€ä¹ˆä¼šè¿™æ ·"></a>ä¸ºä»€ä¹ˆä¼šè¿™æ ·</h2><p>æˆ‘è§‰å¾—è¿˜æ˜¯å…¬å¸åœ¨æŠŠå®¹å™¨å½“ä½œè™šæ‹Ÿæœºåœ¨ç”¨ï¼Œå¹¶æ²¡æœ‰å‘æŒ¥å®¹å™¨çš„ä¼˜åŠ¿ï¼Œåè€Œå¢åŠ äº†å¾ˆå¤šç»´æŠ¤æˆæœ¬ã€‚<br>å’Œé¢†å¯¼æè¿‡è¿™ä¸ªæ–¹æ¡ˆï¼Œè¢«å¦å®šäº†ã€‚åŸå› å¦‚ä¸‹ï¼š<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/Screenshot_20211015_111956.png" alt="å»ºè®®"></p><h2 id="åæ€"><a href="#åæ€" class="headerlink" title="åæ€"></a>åæ€</h2><h3 id="é¦–å…ˆç¬¬ä¸€ç‚¹ï¼šæˆ‘ä»¬ä¸ºä»€ä¹ˆè¦ç”¨å®¹å™¨ï¼ˆk8sï¼‰ï¼Œå®ƒè§£å†³äº†æˆ‘ä»¬ä»€ä¹ˆé—®é¢˜"><a href="#é¦–å…ˆç¬¬ä¸€ç‚¹ï¼šæˆ‘ä»¬ä¸ºä»€ä¹ˆè¦ç”¨å®¹å™¨ï¼ˆk8sï¼‰ï¼Œå®ƒè§£å†³äº†æˆ‘ä»¬ä»€ä¹ˆé—®é¢˜" class="headerlink" title="é¦–å…ˆç¬¬ä¸€ç‚¹ï¼šæˆ‘ä»¬ä¸ºä»€ä¹ˆè¦ç”¨å®¹å™¨ï¼ˆk8sï¼‰ï¼Œå®ƒè§£å†³äº†æˆ‘ä»¬ä»€ä¹ˆé—®é¢˜"></a>é¦–å…ˆç¬¬ä¸€ç‚¹ï¼šæˆ‘ä»¬ä¸ºä»€ä¹ˆè¦ç”¨å®¹å™¨ï¼ˆk8sï¼‰ï¼Œå®ƒè§£å†³äº†æˆ‘ä»¬ä»€ä¹ˆé—®é¢˜</h3><p>æˆ‘è§‰å¾—å®¹å™¨çš„å¥½å¤„æœ‰ï¼š</p><ul><li>ä¸€ä¸ªæ˜¯æ ‡å‡†åŒ–ï¼Œè¿è¡Œç¯å¢ƒåœ¨æµ‹è¯•ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒå®Œå…¨ä¸€è‡´ï¼ˆé™¤äº†å†…æ ¸å±‚ï¼‰ï¼Œæ ‡å‡†åŒ–çš„å¦ä¸€ä¸ªå¥½å¤„æ˜¯ CICD æˆ–è€…è¯´è¿ç»´ã€å¼€å‘çš„æ•ˆç‡æ›´é«˜</li><li>å¦ä¸€ä¸ªå¥½å¤„æ˜¯èŠ‚çœèµ„æºï¼ŒåŒ…æ‹¬ k8s çš„å®¹å™¨è°ƒåº¦ä¸ä¼šåƒè™šæ‹Ÿæœºé‚£æ ·å¾ˆå¤šè·‘äº†ä¸€ä¸¤ä¸ªæœåŠ¡ï¼Œå¾ˆå¤šèµ„æºéƒ½æµªè´¹æ‰äº†ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> å®¹å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Container </tag>
            
            <tag> Kubernetes </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨ docker buildx æ„å»ºä¸åŒå¹³å°çš„é•œåƒ</title>
      <link href="/posts/ffacccf0/"/>
      <url>/posts/ffacccf0/</url>
      
        <content type="html"><![CDATA[<blockquote><p>ä¸€ç›´ä½¿ç”¨ oracle æä¾›çš„å…è´¹ arm äº‘æœåŠ¡å™¨ï¼Œè‡ªå·±çš„ pc åˆæ˜¯ x86 æ¶æ„ï¼Œx86 æ„å»ºå‡ºæ¥çš„é•œåƒä¸èƒ½åœ¨ arm å¹³å°ä½¿ç”¨</p></blockquote><p>ä½¿ç”¨ buildx å¯ä»¥ç”Ÿæˆè·¨å¹³å°é•œåƒï¼Œè·¨å¹³å°é•œåƒå°±æ˜¯åŒä¸€ä¸ªé•œåƒåç§°ï¼ŒåŒä¸€ä¸ª tagï¼Œä½†æ˜¯ arm æœºå™¨å’Œ amd64 æœºå™¨æ‹‰ä¸‹æ¥çš„é•œåƒ hash æ˜¯ä¸ä¸€æ ·çš„</p><h2 id="åˆ›å»º-docker-buildx-æ„å»ºç¯å¢ƒ"><a href="#åˆ›å»º-docker-buildx-æ„å»ºç¯å¢ƒ" class="headerlink" title="åˆ›å»º docker buildx æ„å»ºç¯å¢ƒ"></a>åˆ›å»º docker buildx æ„å»ºç¯å¢ƒ</h2><blockquote><p>è¿™é‡Œçš„ driver æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯ docker-containerï¼Œä¸€ç§æ˜¯ dockerï¼Œæ„å»ºå¤šå¹³å°ç‰ˆæœ¬åªèƒ½ä½¿ç”¨ docker-container, â€“use æ˜¯å°†åˆ‡æ¢ä¸ºé»˜è®¤</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker buildx create --use --name buildx --node buildx --driver-opt network=host</span><br></pre></td></tr></table></figure><h2 id="å‡†å¤‡-qemu-æ¨¡æ‹Ÿå™¨"><a href="#å‡†å¤‡-qemu-æ¨¡æ‹Ÿå™¨" class="headerlink" title="å‡†å¤‡ qemu æ¨¡æ‹Ÿå™¨"></a>å‡†å¤‡ qemu æ¨¡æ‹Ÿå™¨</h2><p>æ„å»ºä¸é€šæ¶æ„çš„é•œåƒæ˜¯é€šè¿‡ qemu æ¥æ¨¡æ‹Ÿçš„ï¼Œä½ ä¼šå‘ç°æ„å»ºè¿‡ç¨‹ä¸­ï¼Œå’Œ build æœºå™¨åŒæ¶æ„çš„ä¼šæ„å»ºå¾ˆå¿«ï¼Œä¸åŒæ¶æ„æ„å»ºå¾ˆæ…¢ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…å…¨éƒ¨æ¨¡æ‹Ÿå™¨</span></span><br><span class="line">docker run --privileged --<span class="built_in">rm</span> tonistiigi/binfmt --install all</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…æŒ‡å®šçš„æ¨¡æ‹Ÿå™¨</span></span><br><span class="line">docker run --privileged --<span class="built_in">rm</span> tonistiigi/binfmt --install arm64,riscv64,arm</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¸è½½æŒ‡å®šæ¨¡æ‹Ÿå™¨</span></span><br><span class="line">docker run --privileged --<span class="built_in">rm</span> tonistiigi/binfmt --uninstall qemu-aarch64</span><br></pre></td></tr></table></figure><h2 id="buildx-æ„å»ºé•œåƒ"><a href="#buildx-æ„å»ºé•œåƒ" class="headerlink" title="buildx æ„å»ºé•œåƒ"></a>buildx æ„å»ºé•œåƒ</h2><p>å‡†å¤‡ä¸€ä¸ªç®€å•çš„ Dockerfile</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> ubuntu</span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;uname&quot;</span>, <span class="string">&quot;-i&quot;</span>]</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker buildx build --push \</span><br><span class="line">    --tag iuxt/ubuntu:latest \</span><br><span class="line">    --platform linux/amd64,linux/arm64 .</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ—¶å€™ç™»å½• dockerhub æŸ¥çœ‹</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/20220518103637.png" alt="dockeré•œåƒ"><br>å¯ä»¥çœ‹åˆ°å·²ç»æ˜¯å¤šå¹³å°æ”¯æŒäº†ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker run --<span class="built_in">rm</span> iuxt/test</span><br><span class="line"></span><br><span class="line">&gt; x86_64</span><br></pre></td></tr></table></figure><p>æ­£å¸¸æ„å»ºçš„æ—¶å€™ï¼Œä¹Ÿéœ€è¦è€ƒè™‘åˆ°ä¸åŒçš„æ¶æ„åŒºåˆ«ï¼Œåœ¨æ„å»ºå‘½ä»¤é‡Œé¢åšåˆ¤æ–­ï¼Œæ¯”å¦‚</p><p><strong>Dockerfile</strong></p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> ubuntu:latest</span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash"> build.sh /</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> /build.sh</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENV</span> REDIS_ADDR=<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span></span><br><span class="line"><span class="keyword">ENV</span> REDIS_PASSWORD=<span class="number">111111</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> /redis_exporter -redis.addr <span class="variable">$&#123;REDIS_ADDR&#125;</span> -redis.password <span class="variable">$&#123;REDIS_PASSWORD&#125;</span></span></span><br></pre></td></tr></table></figure><p><strong>build.sh</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">apt update &amp;&amp; apt install curl -y &amp;&amp; apt clean all</span><br><span class="line"><span class="built_in">cd</span> /tmp/ </span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> $(<span class="built_in">uname</span> -m) <span class="keyword">in</span></span><br><span class="line">x86_64)</span><br><span class="line">    filename=<span class="string">&quot;redis_exporter-v1.37.0.linux-amd64.tar.gz&quot;</span></span><br><span class="line">    bin=<span class="string">&quot;redis_exporter-v1.37.0.linux-amd64/redis_exporter&quot;</span></span><br><span class="line">    ;;</span><br><span class="line">aarch64)</span><br><span class="line">    filename=<span class="string">&quot;redis_exporter-v1.37.0.linux-arm64.tar.gz&quot;</span></span><br><span class="line">    bin=<span class="string">&quot;redis_exporter-v1.37.0.linux-arm64/redis_exporter&quot;</span></span><br><span class="line">    ;;</span><br><span class="line">*)</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;don&#x27;t support <span class="subst">$(uname -i)</span>&quot;</span></span><br><span class="line">    ;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"></span><br><span class="line">curl -OL https://github.com/oliver006/redis_exporter/releases/download/v1.37.0/<span class="variable">$filename</span></span><br><span class="line">tar xf <span class="variable">$filename</span> &amp;&amp; <span class="built_in">mv</span> <span class="variable">$bin</span> /</span><br><span class="line"><span class="built_in">rm</span> -rf /tmp/*</span><br></pre></td></tr></table></figure><h2 id="docker-buildx-å¸¸ç”¨å‘½ä»¤"><a href="#docker-buildx-å¸¸ç”¨å‘½ä»¤" class="headerlink" title="docker buildx å¸¸ç”¨å‘½ä»¤"></a>docker buildx å¸¸ç”¨å‘½ä»¤</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹æ‰€æœ‰çš„builderåˆ—è¡¨</span></span><br><span class="line">docker buildx <span class="built_in">ls</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤åˆ›å»ºçš„builder</span></span><br><span class="line">docker buildx <span class="built_in">rm</span> mybuilder</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ‡æ¢é»˜è®¤builder</span></span><br><span class="line">docker buildx use mybuilder</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å®¹å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
            <tag> Container </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨certbotè‡ªåŠ¨ç”³è¯·sslè¯ä¹¦</title>
      <link href="/posts/28c679c3/"/>
      <url>/posts/28c679c3/</url>
      
        <content type="html"><![CDATA[<blockquote><p>certbot å¯ä»¥è‡ªåŠ¨ç”³è¯· letâ€™s encrypt https è¯ä¹¦, å¹¶ä¸”å¯ä»¥è‡ªåŠ¨ç»­æœŸï¼Œå¦è§ï¼š<a href="/posts/1e777b9e">ä½¿ç”¨acme.shæ¥è‡ªåŠ¨æ›´æ–°httpsè¯ä¹¦</a></p></blockquote><h2 id="ç”³è¯·è¯ä¹¦å‰å‡†å¤‡"><a href="#ç”³è¯·è¯ä¹¦å‰å‡†å¤‡" class="headerlink" title="ç”³è¯·è¯ä¹¦å‰å‡†å¤‡"></a>ç”³è¯·è¯ä¹¦å‰å‡†å¤‡</h2><h3 id="æ·»åŠ -DNS-è§£æ"><a href="#æ·»åŠ -DNS-è§£æ" class="headerlink" title="æ·»åŠ  DNS è§£æ"></a>æ·»åŠ  DNS è§£æ</h3><p>åŸŸåä¸ºä½ éœ€è¦ç”³è¯· https è¯ä¹¦çš„åŸŸåï¼Œæ·»åŠ  A è®°å½•åˆ°æœåŠ¡å™¨ IP</p><h3 id="å®‰è£…-certbot-å’Œ-certbot-nginx-plugin"><a href="#å®‰è£…-certbot-å’Œ-certbot-nginx-plugin" class="headerlink" title="å®‰è£… certbot å’Œ certbot nginx plugin"></a>å®‰è£… certbot å’Œ certbot nginx plugin</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install certbot</span><br><span class="line">sudo apt install python3-certbot-nginx</span><br></pre></td></tr></table></figure><h2 id="ç”³è¯·è¯ä¹¦"><a href="#ç”³è¯·è¯ä¹¦" class="headerlink" title="ç”³è¯·è¯ä¹¦"></a>ç”³è¯·è¯ä¹¦</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo certbot --non-interactive --redirect --agree-tos --nginx -d password.zahui.fan -m captain@zahui.fan</span><br></pre></td></tr></table></figure><blockquote><p>ä»¥ä¸Šæ“ä½œé™¤äº†ç”³è¯·è¯ä¹¦å¤–ï¼Œè¿˜å¯ä»¥è‡ªåŠ¨æ·»åŠ  https é…ç½®åˆ° nginxï¼Œå¾ˆæ–¹ä¾¿ã€‚</p></blockquote><h2 id="è¯ä¹¦ç»­æœŸ"><a href="#è¯ä¹¦ç»­æœŸ" class="headerlink" title="è¯ä¹¦ç»­æœŸ"></a>è¯ä¹¦ç»­æœŸ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo certbot renew</span><br></pre></td></tr></table></figure><blockquote><p>æ·»åŠ åˆ° root ç”¨æˆ·çš„ crontab é‡Œé¢å°±å¯ä»¥å®ç°è‡ªåŠ¨ç»­æœŸï¼Œè·ç¦»åˆ°æœŸæ—¶é—´å¤ªé•¿ä¼šè‡ªåŠ¨è·³è¿‡ç»­æœŸ</p></blockquote><h2 id="åˆ é™¤è¯ä¹¦"><a href="#åˆ é™¤è¯ä¹¦" class="headerlink" title="åˆ é™¤è¯ä¹¦"></a>åˆ é™¤è¯ä¹¦</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo certbot delete</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
            <tag> Crontab </tag>
            
            <tag> Linux </tag>
            
            <tag> SSL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Systemdå…¥é—¨æ•™ç¨‹all in One</title>
      <link href="/posts/f94fbe20/"/>
      <url>/posts/f94fbe20/</url>
      
        <content type="html"><![CDATA[<blockquote><p>å‚è€ƒè‡ª<a href="https://www.ruanyifeng.com/blog/2016/03/systemd-tutorial-commands.html">https://www.ruanyifeng.com/blog/2016/03/systemd-tutorial-commands.html</a>ï¼Œæ„Ÿè°¢é˜®ä¸€å³°è€å“¥ã€‚<br>åŒæ ·å¯ä»¥çœ‹ Arch Wikiï¼š<a href="https://wiki.archlinux.org/title/Systemd_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)">systemd</a> ï¼ŒArch Wiki çœŸçš„ä¸é”™ã€‚</p></blockquote><h2 id="ç”±æ¥"><a href="#ç”±æ¥" class="headerlink" title="ç”±æ¥"></a>ç”±æ¥</h2><p>å†å²ä¸Šï¼ŒLinux çš„å¯åŠ¨ä¸€ç›´é‡‡ç”¨ init è¿›ç¨‹ã€‚</p><p>ä¸‹é¢çš„å‘½ä»¤ç”¨æ¥å¯åŠ¨æœåŠ¡ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo /etc/init.d/apache2 start</span><br><span class="line"><span class="comment"># æˆ–è€…</span></span><br><span class="line">service apache2 start</span><br></pre></td></tr></table></figure><p>è¿™ç§æ–¹æ³•æœ‰ä¸¤ä¸ªç¼ºç‚¹ã€‚</p><ul><li>ä¸€æ˜¯å¯åŠ¨æ—¶é—´é•¿ã€‚init è¿›ç¨‹æ˜¯ä¸²è¡Œå¯åŠ¨ï¼Œåªæœ‰å‰ä¸€ä¸ªè¿›ç¨‹å¯åŠ¨å®Œï¼Œæ‰ä¼šå¯åŠ¨ä¸‹ä¸€ä¸ªè¿›ç¨‹ã€‚</li><li>äºŒæ˜¯å¯åŠ¨è„šæœ¬å¤æ‚ã€‚init è¿›ç¨‹åªæ˜¯æ‰§è¡Œå¯åŠ¨è„šæœ¬ï¼Œä¸ç®¡å…¶ä»–äº‹æƒ…ã€‚è„šæœ¬éœ€è¦è‡ªå·±å¤„ç†å„ç§æƒ…å†µï¼Œè¿™å¾€å¾€ä½¿å¾—è„šæœ¬å˜å¾—å¾ˆé•¿ã€‚</li></ul><h2 id="systemd-çš„è¯ç”Ÿ"><a href="#systemd-çš„è¯ç”Ÿ" class="headerlink" title="systemd çš„è¯ç”Ÿ"></a>systemd çš„è¯ç”Ÿ</h2><p>Systemd å°±æ˜¯ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜è€Œè¯ç”Ÿçš„ã€‚å®ƒçš„è®¾è®¡ç›®æ ‡æ˜¯ï¼Œä¸ºç³»ç»Ÿçš„å¯åŠ¨å’Œç®¡ç†æä¾›ä¸€å¥—å®Œæ•´çš„è§£å†³æ–¹æ¡ˆã€‚<br>systemd æˆä¸ºç³»ç»Ÿçš„ç¬¬ä¸€ä¸ªè¿›ç¨‹ï¼ˆä¹Ÿå°±æ˜¯ PID&#x3D;1ï¼‰ï¼Œå…¶ä»–è¿›ç¨‹éƒ½æ˜¯å®ƒçš„å­è¿›ç¨‹ã€‚</p><h2 id="systemd-åŒ…æ‹¬çš„å‘½ä»¤"><a href="#systemd-åŒ…æ‹¬çš„å‘½ä»¤" class="headerlink" title="systemd åŒ…æ‹¬çš„å‘½ä»¤"></a>systemd åŒ…æ‹¬çš„å‘½ä»¤</h2><blockquote><p>systemd ä¸æ˜¯ä¸€ä¸ªå‘½ä»¤ï¼Œè€Œæ˜¯ä¸€ç»„å‘½ä»¤ã€‚æ¯”å¦‚ systemctl hostnamectl timedatectl ç­‰</p></blockquote><h3 id="systemctl"><a href="#systemctl" class="headerlink" title="systemctl"></a>systemctl</h3><p>å¸¸ç”¨å‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é‡å¯ç³»ç»Ÿ</span></span><br><span class="line">sudo systemctl reboot</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…³é—­ç³»ç»Ÿï¼Œåˆ‡æ–­ç”µæº</span></span><br><span class="line">sudo systemctl poweroff</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨è¿›å…¥æ•‘æ´çŠ¶æ€ï¼ˆå•ç”¨æˆ·çŠ¶æ€ï¼‰</span></span><br><span class="line">sudo systemctl rescue</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡å¯è¿›å…¥UEFIç•Œé¢</span></span><br><span class="line">sudo systemctl reboot --firmware-setup</span><br></pre></td></tr></table></figure><h3 id="systemd-analyze"><a href="#systemd-analyze" class="headerlink" title="systemd-analyze"></a>systemd-analyze</h3><p>systemd-analyze å‘½ä»¤ç”¨äºæŸ¥çœ‹å¯åŠ¨è€—æ—¶ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å¯åŠ¨è€—æ—¶</span></span><br><span class="line">systemd-analyze                                                                                       </span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ¯ä¸ªæœåŠ¡çš„å¯åŠ¨è€—æ—¶</span></span><br><span class="line">systemd-analyze blame</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ˜¾ç¤ºç€‘å¸ƒçŠ¶çš„å¯åŠ¨è¿‡ç¨‹æµ</span></span><br><span class="line">systemd-analyze critical-chain</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ˜¾ç¤ºæŒ‡å®šæœåŠ¡çš„å¯åŠ¨æµ</span></span><br><span class="line">systemd-analyze critical-chain atd.service</span><br></pre></td></tr></table></figure><h3 id="hostnamectl"><a href="#hostnamectl" class="headerlink" title="hostnamectl"></a>hostnamectl</h3><p>hostnamectl å‘½ä»¤ç”¨äºæŸ¥çœ‹å½“å‰ä¸»æœºçš„ä¿¡æ¯ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ˜¾ç¤ºå½“å‰ä¸»æœºçš„ä¿¡æ¯</span></span><br><span class="line">hostnamectl</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®ä¸»æœºåã€‚</span></span><br><span class="line">sudo hostnamectl set-hostname rhel7</span><br></pre></td></tr></table></figure><h3 id="localectl"><a href="#localectl" class="headerlink" title="localectl"></a>localectl</h3><p>localectl å‘½ä»¤ç”¨äºæŸ¥çœ‹æœ¬åœ°åŒ–è®¾ç½®ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹æœ¬åœ°åŒ–è®¾ç½®</span></span><br><span class="line">localectl</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®æœ¬åœ°åŒ–å‚æ•°ã€‚</span></span><br><span class="line">sudo localectl set-locale LANG=en_US.utf8</span><br><span class="line">sudo localectl set-keymap en_US</span><br></pre></td></tr></table></figure><h3 id="timedatectl"><a href="#timedatectl" class="headerlink" title="timedatectl"></a>timedatectl</h3><blockquote><p>timedatectl å‘½ä»¤ç”¨äºæŸ¥çœ‹å½“å‰æ—¶åŒºè®¾ç½®ã€‚</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å½“å‰æ—¶åŒºè®¾ç½®</span></span><br><span class="line">timedatectl</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ˜¾ç¤ºæ‰€æœ‰å¯ç”¨çš„æ—¶åŒº</span></span><br><span class="line">timedatectl list-timezones                                                                                   </span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®å½“å‰æ—¶åŒº</span></span><br><span class="line">sudo timedatectl set-timezone Asia/Shanghai</span><br><span class="line">sudo timedatectl set-time YYYY-MM-DD</span><br><span class="line">sudo timedatectl set-time HH:MM:SS</span><br></pre></td></tr></table></figure><h3 id="loginctl"><a href="#loginctl" class="headerlink" title="loginctl"></a>loginctl</h3><blockquote><p>loginctl å‘½ä»¤ç”¨äºæŸ¥çœ‹å½“å‰ç™»å½•çš„ç”¨æˆ·ã€‚</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ—å‡ºå½“å‰session</span></span><br><span class="line">loginctl list-sessions</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ—å‡ºå½“å‰ç™»å½•ç”¨æˆ·</span></span><br><span class="line">loginctl list-users</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ—å‡ºæ˜¾ç¤ºæŒ‡å®šç”¨æˆ·çš„ä¿¡æ¯</span></span><br><span class="line">loginctl show-user iuxt</span><br></pre></td></tr></table></figure><h2 id="Unit"><a href="#Unit" class="headerlink" title="Unit"></a>Unit</h2><h3 id="å«ä¹‰"><a href="#å«ä¹‰" class="headerlink" title="å«ä¹‰"></a>å«ä¹‰</h3><p>Systemd å¯ä»¥ç®¡ç†æ‰€æœ‰ç³»ç»Ÿèµ„æºã€‚ä¸åŒçš„èµ„æºç»Ÿç§°ä¸º Unitï¼ˆå•ä½ï¼‰ã€‚</p><p>Unit ä¸€å…±åˆ†æˆ 12 ç§ã€‚</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Service unitï¼š      ç³»ç»ŸæœåŠ¡</span><br><span class="line">Target unitï¼š       å¤šä¸ª Unit æ„æˆçš„ä¸€ä¸ªç»„</span><br><span class="line">Device Unitï¼š       ç¡¬ä»¶è®¾å¤‡</span><br><span class="line">Mount Unitï¼š        æ–‡ä»¶ç³»ç»Ÿçš„æŒ‚è½½ç‚¹</span><br><span class="line">Automount Unitï¼š    è‡ªåŠ¨æŒ‚è½½ç‚¹</span><br><span class="line">Path Unitï¼š         æ–‡ä»¶æˆ–è·¯å¾„</span><br><span class="line">Scope Unitï¼š        ä¸æ˜¯ç”± Systemd å¯åŠ¨çš„å¤–éƒ¨è¿›ç¨‹</span><br><span class="line">Slice Unitï¼š        è¿›ç¨‹ç»„</span><br><span class="line">Snapshot Unitï¼š     Systemd å¿«ç…§ï¼Œå¯ä»¥åˆ‡å›æŸä¸ªå¿«ç…§</span><br><span class="line">Socket Unitï¼š       è¿›ç¨‹é—´é€šä¿¡çš„ socket</span><br><span class="line">Swap Unitï¼š         swap æ–‡ä»¶</span><br><span class="line">Timer Unitï¼š        å®šæ—¶å™¨</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ—å‡ºæ­£åœ¨è¿è¡Œçš„ Unit</span></span><br><span class="line">systemctl list-units</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ—å‡ºæ‰€æœ‰Unitï¼ŒåŒ…æ‹¬æ²¡æœ‰æ‰¾åˆ°é…ç½®æ–‡ä»¶çš„æˆ–è€…å¯åŠ¨å¤±è´¥çš„</span></span><br><span class="line">systemctl list-units --all</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ—å‡ºæ‰€æœ‰æ²¡æœ‰è¿è¡Œçš„ Unit</span></span><br><span class="line">systemctl list-units --all --state=inactive</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ—å‡ºæ‰€æœ‰åŠ è½½å¤±è´¥çš„ Unit</span></span><br><span class="line">systemctl list-units --failed</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ—å‡ºæ‰€æœ‰æ­£åœ¨è¿è¡Œçš„ã€ç±»å‹ä¸º service çš„ Unit</span></span><br><span class="line">systemctl list-units --<span class="built_in">type</span>=service</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="Unit-çš„çŠ¶æ€"><a href="#Unit-çš„çŠ¶æ€" class="headerlink" title="Unit çš„çŠ¶æ€"></a>Unit çš„çŠ¶æ€</h3><p>systemctl status å‘½ä»¤ç”¨äºæŸ¥çœ‹ç³»ç»ŸçŠ¶æ€å’Œå•ä¸ª Unit çš„çŠ¶æ€ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ˜¾ç¤ºç³»ç»ŸçŠ¶æ€</span></span><br><span class="line">systemctl status</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ˜¾ç¤ºå•ä¸ª Unit çš„çŠ¶æ€</span></span><br><span class="line">sysystemctl status bluetooth.service</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ˜¾ç¤ºè¿œç¨‹ä¸»æœºçš„æŸä¸ª Unit çš„çŠ¶æ€</span></span><br><span class="line">systemctl -H root@rhel7.example.com status httpd.service</span><br></pre></td></tr></table></figure><p>é™¤äº† status å‘½ä»¤ï¼Œsystemctl è¿˜æä¾›äº†ä¸‰ä¸ªæŸ¥è¯¢çŠ¶æ€çš„ç®€å•æ–¹æ³•ï¼Œä¸»è¦ä¾›è„šæœ¬å†…éƒ¨çš„åˆ¤æ–­è¯­å¥ä½¿ç”¨ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ˜¾ç¤ºæŸä¸ª Unit æ˜¯å¦æ­£åœ¨è¿è¡Œ</span></span><br><span class="line">systemctl is-active application.service</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ˜¾ç¤ºæŸä¸ª Unit æ˜¯å¦å¤„äºå¯åŠ¨å¤±è´¥çŠ¶æ€</span></span><br><span class="line">systemctl is-failed application.service</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ˜¾ç¤ºæŸä¸ª Unit æœåŠ¡æ˜¯å¦å»ºç«‹äº†å¯åŠ¨é“¾æ¥</span></span><br><span class="line">systemctl is-enabled application.service</span><br></pre></td></tr></table></figure><h3 id="Unit-ç®¡ç†"><a href="#Unit-ç®¡ç†" class="headerlink" title="Unit ç®¡ç†"></a>Unit ç®¡ç†</h3><p>å¯¹äºç”¨æˆ·æ¥è¯´ï¼Œæœ€å¸¸ç”¨çš„æ˜¯ä¸‹é¢è¿™äº›å‘½ä»¤ï¼Œç”¨äºå¯åŠ¨å’Œåœæ­¢ Unitï¼ˆä¸»è¦æ˜¯ serviceï¼‰ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç«‹å³å¯åŠ¨ä¸€ä¸ªæœåŠ¡</span></span><br><span class="line">sudo systemctl start apache.service</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç«‹å³åœæ­¢ä¸€ä¸ªæœåŠ¡</span></span><br><span class="line">sudo systemctl stop apache.service</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡å¯ä¸€ä¸ªæœåŠ¡</span></span><br><span class="line">sudo systemctl restart apache.service</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ€æ­»ä¸€ä¸ªæœåŠ¡çš„æ‰€æœ‰å­è¿›ç¨‹</span></span><br><span class="line">sudo systemctl <span class="built_in">kill</span> apache.service</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡æ–°åŠ è½½ä¸€ä¸ªæœåŠ¡çš„é…ç½®æ–‡ä»¶</span></span><br><span class="line">sudo systemctl reload apache.service</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡è½½æ‰€æœ‰ä¿®æ”¹è¿‡çš„é…ç½®æ–‡ä»¶</span></span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ˜¾ç¤ºæŸä¸ª Unit çš„æ‰€æœ‰åº•å±‚å‚æ•°</span></span><br><span class="line">systemctl show httpd.service</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ˜¾ç¤ºæŸä¸ª Unit çš„æŒ‡å®šå±æ€§çš„å€¼</span></span><br><span class="line">systemctl show -p CPUShares httpd.service</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®æŸä¸ª Unit çš„æŒ‡å®šå±æ€§</span></span><br><span class="line">sudo systemctl set-property httpd.service CPUShares=500</span><br></pre></td></tr></table></figure><h3 id="ä¾èµ–å…³ç³»"><a href="#ä¾èµ–å…³ç³»" class="headerlink" title="ä¾èµ–å…³ç³»"></a>ä¾èµ–å…³ç³»</h3><p>Unit ä¹‹é—´å­˜åœ¨ä¾èµ–å…³ç³»ï¼šA ä¾èµ–äº Bï¼Œå°±æ„å‘³ç€ Systemd åœ¨å¯åŠ¨ A çš„æ—¶å€™ï¼ŒåŒæ—¶ä¼šå»å¯åŠ¨ Bã€‚<br>systemctl list-dependencies å‘½ä»¤åˆ—å‡ºä¸€ä¸ª Unit çš„æ‰€æœ‰ä¾èµ–ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl list-dependencies nginx.service</span><br><span class="line">ä¸Šé¢å‘½ä»¤çš„è¾“å‡ºç»“æœä¹‹ä¸­ï¼Œæœ‰äº›ä¾èµ–æ˜¯ Target ç±»å‹ï¼ˆè¯¦è§ä¸‹æ–‡ï¼‰ï¼Œé»˜è®¤ä¸ä¼šå±•å¼€æ˜¾ç¤ºã€‚å¦‚æœè¦å±•å¼€ Targetï¼Œå°±éœ€è¦ä½¿ç”¨--allå‚æ•°ã€‚</span><br><span class="line">systemctl list-dependencies --all nginx.service</span><br></pre></td></tr></table></figure><h2 id="Unit-çš„é…ç½®æ–‡ä»¶"><a href="#Unit-çš„é…ç½®æ–‡ä»¶" class="headerlink" title="Unit çš„é…ç½®æ–‡ä»¶"></a>Unit çš„é…ç½®æ–‡ä»¶</h2><h3 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h3><p>æ¯ä¸€ä¸ª Unit éƒ½æœ‰ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œå‘Šè¯‰ Systemd æ€ä¹ˆå¯åŠ¨è¿™ä¸ª Unit ã€‚<br>Systemd é»˜è®¤ä»ç›®å½• <code>/etc/systemd/system/</code> è¯»å–é…ç½®æ–‡ä»¶ã€‚ä½†æ˜¯ï¼Œé‡Œé¢å­˜æ”¾çš„å¤§éƒ¨åˆ†æ–‡ä»¶éƒ½æ˜¯ç¬¦å·é“¾æ¥ï¼ŒæŒ‡å‘ç›®å½• <code>/usr/lib/systemd/system/</code>ï¼ŒçœŸæ­£çš„é…ç½®æ–‡ä»¶å­˜æ”¾åœ¨é‚£ä¸ªç›®å½•ã€‚<br>systemctl enable å‘½ä»¤ç”¨äºåœ¨ä¸Šé¢ä¸¤ä¸ªç›®å½•ä¹‹é—´ï¼Œå»ºç«‹ç¬¦å·é“¾æ¥å…³ç³»ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl <span class="built_in">enable</span> clamd@scan.service</span><br><span class="line"><span class="comment"># ç­‰åŒäº</span></span><br><span class="line">sudo <span class="built_in">ln</span> -s <span class="string">&#x27;/usr/lib/systemd/system/clamd@scan.service&#x27;</span> <span class="string">&#x27;/etc/systemd/system/multi-user.target.wants/clamd@scan.service&#x27;</span></span><br><span class="line">å¦‚æœé…ç½®æ–‡ä»¶é‡Œé¢è®¾ç½®äº†å¼€æœºå¯åŠ¨ï¼Œsystemctl <span class="built_in">enable</span>å‘½ä»¤ç›¸å½“äºæ¿€æ´»å¼€æœºå¯åŠ¨ã€‚</span><br><span class="line"></span><br><span class="line">ä¸ä¹‹å¯¹åº”çš„ï¼Œsystemctl <span class="built_in">disable</span>å‘½ä»¤ç”¨äºåœ¨ä¸¤ä¸ªç›®å½•ä¹‹é—´ï¼Œæ’¤é”€ç¬¦å·é“¾æ¥å…³ç³»ï¼Œç›¸å½“äºæ’¤é”€å¼€æœºå¯åŠ¨ã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sudo systemctl <span class="built_in">disable</span> clamd@scan.service</span><br><span class="line">é…ç½®æ–‡ä»¶çš„åç¼€åï¼Œå°±æ˜¯è¯¥ Unit çš„ç§ç±»ï¼Œæ¯”å¦‚sshd.socketã€‚å¦‚æœçœç•¥ï¼ŒSystemd é»˜è®¤åç¼€åä¸º.serviceï¼Œæ‰€ä»¥sshdä¼šè¢«ç†è§£æˆsshd.serviceã€‚</span><br></pre></td></tr></table></figure><h3 id="é…ç½®æ–‡ä»¶çš„çŠ¶æ€"><a href="#é…ç½®æ–‡ä»¶çš„çŠ¶æ€" class="headerlink" title="é…ç½®æ–‡ä»¶çš„çŠ¶æ€"></a>é…ç½®æ–‡ä»¶çš„çŠ¶æ€</h3><p>systemctl list-unit-files å‘½ä»¤ç”¨äºåˆ—å‡ºæ‰€æœ‰é…ç½®æ–‡ä»¶ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ—å‡ºæ‰€æœ‰é…ç½®æ–‡ä»¶</span></span><br><span class="line">systemctl list-unit-files</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ—å‡ºæŒ‡å®šç±»å‹çš„é…ç½®æ–‡ä»¶</span></span><br><span class="line">systemctl list-unit-files --<span class="built_in">type</span>=service</span><br><span class="line">è¿™ä¸ªå‘½ä»¤ä¼šè¾“å‡ºä¸€ä¸ªåˆ—è¡¨ã€‚</span><br></pre></td></tr></table></figure><p>systemctl list-unit-files</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">UNIT FILE              STATE</span><br><span class="line">chronyd.service        enabled</span><br><span class="line">clamd@.service         static</span><br><span class="line">clamd@scan.service     disabled</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªåˆ—è¡¨æ˜¾ç¤ºæ¯ä¸ªé…ç½®æ–‡ä»¶çš„çŠ¶æ€ï¼Œä¸€å…±æœ‰å››ç§ã€‚</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">enabledï¼šå·²å»ºç«‹å¯åŠ¨é“¾æ¥</span><br><span class="line">disabledï¼šæ²¡å»ºç«‹å¯åŠ¨é“¾æ¥</span><br><span class="line">staticï¼šè¯¥é…ç½®æ–‡ä»¶æ²¡æœ‰[Install]éƒ¨åˆ†ï¼ˆæ— æ³•æ‰§è¡Œï¼‰ï¼Œåªèƒ½ä½œä¸ºå…¶ä»–é…ç½®æ–‡ä»¶çš„ä¾èµ–</span><br><span class="line">maskedï¼šè¯¥é…ç½®æ–‡ä»¶è¢«ç¦æ­¢å»ºç«‹å¯åŠ¨é“¾æ¥</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œä»é…ç½®æ–‡ä»¶çš„çŠ¶æ€æ— æ³•çœ‹å‡ºï¼Œè¯¥ Unit æ˜¯å¦æ­£åœ¨è¿è¡Œã€‚è¿™å¿…é¡»æ‰§è¡Œå‰é¢æåˆ°çš„ systemctl status å‘½ä»¤ã€‚</p><p>ä¸€æ—¦ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œå°±è¦è®© Systemd é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶ï¼Œç„¶åé‡æ–°å¯åŠ¨ï¼Œå¦åˆ™ä¿®æ”¹ä¸ä¼šç”Ÿæ•ˆã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart httpd.service</span><br></pre></td></tr></table></figure><h3 id="é…ç½®æ–‡ä»¶çš„æ ¼å¼"><a href="#é…ç½®æ–‡ä»¶çš„æ ¼å¼" class="headerlink" title="é…ç½®æ–‡ä»¶çš„æ ¼å¼"></a>é…ç½®æ–‡ä»¶çš„æ ¼å¼</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">æŸ¥çœ‹é…ç½®æ–‡ä»¶çš„å†…å®¹</span><br><span class="line">systemctl <span class="built_in">cat</span> atd.service</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=ATD daemon</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">ExecStart=/usr/bin/atd</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure><h3 id="é…ç½®æ–‡ä»¶çš„åŒºå—"><a href="#é…ç½®æ–‡ä»¶çš„åŒºå—" class="headerlink" title="é…ç½®æ–‡ä»¶çš„åŒºå—"></a>é…ç½®æ–‡ä»¶çš„åŒºå—</h3><p>[Unit] åŒºå—é€šå¸¸æ˜¯é…ç½®æ–‡ä»¶çš„ç¬¬ä¸€ä¸ªåŒºå—ï¼Œç”¨æ¥å®šä¹‰ Unit çš„å…ƒæ•°æ®ï¼Œä»¥åŠé…ç½®ä¸å…¶ä»– Unit çš„å…³ç³»ã€‚å®ƒçš„ä¸»è¦å­—æ®µå¦‚ä¸‹ã€‚</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Descriptionï¼š       ç®€çŸ­æè¿°</span><br><span class="line">Documentationï¼š     æ–‡æ¡£åœ°å€</span><br><span class="line">Requiresï¼š          å½“å‰ Unit ä¾èµ–çš„å…¶ä»– Unitï¼Œå¦‚æœå®ƒä»¬æ²¡æœ‰è¿è¡Œï¼Œå½“å‰ Unit ä¼šå¯åŠ¨å¤±è´¥</span><br><span class="line">Wantsï¼š             ä¸å½“å‰ Unit é…åˆçš„å…¶ä»– Unitï¼Œå¦‚æœå®ƒä»¬æ²¡æœ‰è¿è¡Œï¼Œå½“å‰ Unit ä¸ä¼šå¯åŠ¨å¤±è´¥</span><br><span class="line">BindsToï¼š           ä¸Requiresç±»ä¼¼ï¼Œå®ƒæŒ‡å®šçš„ Unit å¦‚æœé€€å‡ºï¼Œä¼šå¯¼è‡´å½“å‰ Unit åœæ­¢è¿è¡Œ</span><br><span class="line">Beforeï¼š            å¦‚æœè¯¥å­—æ®µæŒ‡å®šçš„ Unit ä¹Ÿè¦å¯åŠ¨ï¼Œé‚£ä¹ˆå¿…é¡»åœ¨å½“å‰ Unit ä¹‹åå¯åŠ¨</span><br><span class="line">Afterï¼š             å¦‚æœè¯¥å­—æ®µæŒ‡å®šçš„ Unit ä¹Ÿè¦å¯åŠ¨ï¼Œé‚£ä¹ˆå¿…é¡»åœ¨å½“å‰ Unit ä¹‹å‰å¯åŠ¨</span><br><span class="line">Conflictsï¼š         è¿™é‡ŒæŒ‡å®šçš„ Unit ä¸èƒ½ä¸å½“å‰ Unit åŒæ—¶è¿è¡Œ</span><br><span class="line">Condition...ï¼š      å½“å‰ Unit è¿è¡Œå¿…é¡»æ»¡è¶³çš„æ¡ä»¶ï¼Œå¦åˆ™ä¸ä¼šè¿è¡Œ</span><br><span class="line">Assert...ï¼š         å½“å‰ Unit è¿è¡Œå¿…é¡»æ»¡è¶³çš„æ¡ä»¶ï¼Œå¦åˆ™ä¼šæŠ¥å¯åŠ¨å¤±è´¥</span><br></pre></td></tr></table></figure><p>[Install] é€šå¸¸æ˜¯é…ç½®æ–‡ä»¶çš„æœ€åä¸€ä¸ªåŒºå—ï¼Œç”¨æ¥å®šä¹‰å¦‚ä½•å¯åŠ¨ï¼Œä»¥åŠæ˜¯å¦å¼€æœºå¯åŠ¨ã€‚å®ƒçš„ä¸»è¦å­—æ®µå¦‚ä¸‹ã€‚</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">WantedByï¼š          å®ƒçš„å€¼æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ª Targetï¼Œå½“å‰ Unit æ¿€æ´»æ—¶ï¼ˆenableï¼‰ç¬¦å·é“¾æ¥ä¼šæ”¾å…¥/etc/systemd/systemç›®å½•ä¸‹é¢ä»¥ Target å + .wantsåç¼€æ„æˆçš„å­ç›®å½•ä¸­</span><br><span class="line">RequiredByï¼š        å®ƒçš„å€¼æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ª Targetï¼Œå½“å‰ Unit æ¿€æ´»æ—¶ï¼Œç¬¦å·é“¾æ¥ä¼šæ”¾å…¥/etc/systemd/systemç›®å½•ä¸‹é¢ä»¥ Target å + .requiredåç¼€æ„æˆçš„å­ç›®å½•ä¸­</span><br><span class="line">Aliasï¼š             å½“å‰ Unit å¯ç”¨äºå¯åŠ¨çš„åˆ«å</span><br><span class="line">Alsoï¼š              å½“å‰ Unit æ¿€æ´»ï¼ˆenableï¼‰æ—¶ï¼Œä¼šè¢«åŒæ—¶æ¿€æ´»çš„å…¶ä»– Unit</span><br></pre></td></tr></table></figure><p>[Service] åŒºå—ç”¨æ¥ Service çš„é…ç½®ï¼Œåªæœ‰ Service ç±»å‹çš„ Unit æ‰æœ‰è¿™ä¸ªåŒºå—ã€‚å®ƒçš„ä¸»è¦å­—æ®µå¦‚ä¸‹ã€‚</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Typeï¼š          å®šä¹‰å¯åŠ¨æ—¶çš„è¿›ç¨‹è¡Œä¸ºã€‚å®ƒæœ‰ä»¥ä¸‹å‡ ç§å€¼ã€‚</span><br><span class="line">Type=simpleï¼š   é»˜è®¤å€¼ï¼Œæ‰§è¡ŒExecStartæŒ‡å®šçš„å‘½ä»¤ï¼Œå¯åŠ¨ä¸»è¿›ç¨‹</span><br><span class="line">Type=forkingï¼š  ä»¥ fork æ–¹å¼ä»çˆ¶è¿›ç¨‹åˆ›å»ºå­è¿›ç¨‹ï¼Œåˆ›å»ºåçˆ¶è¿›ç¨‹ä¼šç«‹å³é€€å‡º</span><br><span class="line">Type=oneshotï¼š  ä¸€æ¬¡æ€§è¿›ç¨‹ï¼ŒSystemd ä¼šç­‰å½“å‰æœåŠ¡é€€å‡ºï¼Œå†ç»§ç»­å¾€ä¸‹æ‰§è¡Œ</span><br><span class="line">Type=dbusï¼š     å½“å‰æœåŠ¡é€šè¿‡D-Buså¯åŠ¨</span><br><span class="line">Type=notifyï¼š   å½“å‰æœåŠ¡å¯åŠ¨å®Œæ¯•ï¼Œä¼šé€šçŸ¥Systemdï¼Œå†ç»§ç»­å¾€ä¸‹æ‰§è¡Œ</span><br><span class="line">Type=idleï¼š     è‹¥æœ‰å…¶ä»–ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œå½“å‰æœåŠ¡æ‰ä¼šè¿è¡Œ</span><br><span class="line">ExecStartï¼š     å¯åŠ¨å½“å‰æœåŠ¡çš„å‘½ä»¤</span><br><span class="line">ExecStartPreï¼š  å¯åŠ¨å½“å‰æœåŠ¡ä¹‹å‰æ‰§è¡Œçš„å‘½ä»¤</span><br><span class="line">ExecStartPostï¼š å¯åŠ¨å½“å‰æœåŠ¡ä¹‹åæ‰§è¡Œçš„å‘½ä»¤</span><br><span class="line">ExecReloadï¼š    é‡å¯å½“å‰æœåŠ¡æ—¶æ‰§è¡Œçš„å‘½ä»¤</span><br><span class="line">ExecStopï¼š      åœæ­¢å½“å‰æœåŠ¡æ—¶æ‰§è¡Œçš„å‘½ä»¤</span><br><span class="line">ExecStopPostï¼š  åœæ­¢å½“å…¶æœåŠ¡ä¹‹åæ‰§è¡Œçš„å‘½ä»¤</span><br><span class="line">RestartSecï¼š    è‡ªåŠ¨é‡å¯å½“å‰æœåŠ¡é—´éš”çš„ç§’æ•°</span><br><span class="line">Restartï¼š       å®šä¹‰ä½•ç§æƒ…å†µ Systemd ä¼šè‡ªåŠ¨é‡å¯å½“å‰æœåŠ¡ï¼Œå¯èƒ½çš„å€¼åŒ…æ‹¬alwaysï¼ˆæ€»æ˜¯é‡å¯ï¼‰ã€on-successã€on-failureã€on-abnormalã€on-abortã€on-watchdog</span><br><span class="line">TimeoutSecï¼š    å®šä¹‰ Systemd åœæ­¢å½“å‰æœåŠ¡ä¹‹å‰ç­‰å¾…çš„ç§’æ•°</span><br><span class="line">Environmentï¼š   æŒ‡å®šç¯å¢ƒå˜é‡</span><br></pre></td></tr></table></figure><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>å¯åŠ¨è®¡ç®—æœºçš„æ—¶å€™ï¼Œéœ€è¦å¯åŠ¨å¤§é‡çš„ Unitã€‚å¦‚æœæ¯ä¸€æ¬¡å¯åŠ¨ï¼Œéƒ½è¦ä¸€ä¸€å†™æ˜æœ¬æ¬¡å¯åŠ¨éœ€è¦å“ªäº› Unitï¼Œæ˜¾ç„¶éå¸¸ä¸æ–¹ä¾¿ã€‚Systemd çš„è§£å†³æ–¹æ¡ˆå°±æ˜¯ Targetã€‚</p><p>ç®€å•è¯´ï¼ŒTarget å°±æ˜¯ä¸€ä¸ª Unit ç»„ï¼ŒåŒ…å«è®¸å¤šç›¸å…³çš„ Unit ã€‚å¯åŠ¨æŸä¸ª Target çš„æ—¶å€™ï¼ŒSystemd å°±ä¼šå¯åŠ¨é‡Œé¢æ‰€æœ‰çš„ Unitã€‚ä»è¿™ä¸ªæ„ä¹‰ä¸Šè¯´ï¼ŒTarget è¿™ä¸ªæ¦‚å¿µç±»ä¼¼äº â€œ çŠ¶æ€ç‚¹ â€œï¼Œå¯åŠ¨æŸä¸ª Target å°±å¥½æ¯”å¯åŠ¨åˆ°æŸç§çŠ¶æ€ã€‚</p><p>ä¼ ç»Ÿçš„ init å¯åŠ¨æ¨¡å¼é‡Œé¢ï¼Œæœ‰ RunLevel çš„æ¦‚å¿µï¼Œè·Ÿ Target çš„ä½œç”¨å¾ˆç±»ä¼¼ã€‚ä¸åŒçš„æ˜¯ï¼ŒRunLevel æ˜¯äº’æ–¥çš„ï¼Œä¸å¯èƒ½å¤šä¸ª RunLevel åŒæ—¶å¯åŠ¨ï¼Œä½†æ˜¯å¤šä¸ª Target å¯ä»¥åŒæ—¶å¯åŠ¨ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å½“å‰ç³»ç»Ÿçš„æ‰€æœ‰ Target</span></span><br><span class="line">systemctl list-unit-files --<span class="built_in">type</span>=target</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ä¸€ä¸ª Target åŒ…å«çš„æ‰€æœ‰ Unit</span></span><br><span class="line">systemctl list-dependencies multi-user.target</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å¯åŠ¨æ—¶çš„é»˜è®¤ Target</span></span><br><span class="line">systemctl get-default</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®å¯åŠ¨æ—¶çš„é»˜è®¤ Target</span></span><br><span class="line">sudo systemctl set-default multi-user.target</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ‡æ¢ Target æ—¶ï¼Œé»˜è®¤ä¸å…³é—­å‰ä¸€ä¸ª Target å¯åŠ¨çš„è¿›ç¨‹ï¼Œ</span></span><br><span class="line"><span class="comment"># systemctl isolate å‘½ä»¤æ”¹å˜è¿™ç§è¡Œä¸ºï¼Œ</span></span><br><span class="line"><span class="comment"># å…³é—­å‰ä¸€ä¸ª Target é‡Œé¢æ‰€æœ‰ä¸å±äºåä¸€ä¸ª Target çš„è¿›ç¨‹</span></span><br><span class="line">sudo systemctl isolate multi-user.target</span><br></pre></td></tr></table></figure><p>Target ä¸ ä¼ ç»Ÿ RunLevel çš„å¯¹åº”å…³ç³»å¦‚ä¸‹ã€‚</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Traditional runlevel      New target name     Symbolically linked to...</span><br><span class="line"></span><br><span class="line">Runlevel 0           |    runlevel0.target -&gt; poweroff.target</span><br><span class="line">Runlevel 1           |    runlevel1.target -&gt; rescue.target</span><br><span class="line">Runlevel 2           |    runlevel2.target -&gt; multi-user.target</span><br><span class="line">Runlevel 3           |    runlevel3.target -&gt; multi-user.target</span><br><span class="line">Runlevel 4           |    runlevel4.target -&gt; multi-user.target</span><br><span class="line">Runlevel 5           |    runlevel5.target -&gt; graphical.target</span><br><span class="line">Runlevel 6           |    runlevel6.target -&gt; reboot.target</span><br></pre></td></tr></table></figure><p>å®ƒä¸ init è¿›ç¨‹çš„ä¸»è¦å·®åˆ«å¦‚ä¸‹ã€‚</p><p>ï¼ˆ1ï¼‰é»˜è®¤çš„ RunLevelï¼ˆåœ¨&#x2F;etc&#x2F;inittab æ–‡ä»¶è®¾ç½®ï¼‰ç°åœ¨è¢«é»˜è®¤çš„ Target å–ä»£ï¼Œä½ç½®æ˜¯&#x2F;etc&#x2F;systemd&#x2F;system&#x2F;default.targetï¼Œé€šå¸¸ç¬¦å·é“¾æ¥åˆ° graphical.targetï¼ˆå›¾å½¢ç•Œé¢ï¼‰æˆ–è€… multi-user.targetï¼ˆå¤šç”¨æˆ·å‘½ä»¤è¡Œï¼‰ã€‚</p><p>ï¼ˆ2ï¼‰å¯åŠ¨è„šæœ¬çš„ä½ç½®ï¼Œä»¥å‰æ˜¯&#x2F;etc&#x2F;init.d ç›®å½•ï¼Œç¬¦å·é“¾æ¥åˆ°ä¸åŒçš„ RunLevel ç›®å½• ï¼ˆæ¯”å¦‚&#x2F;etc&#x2F;rc3.dã€&#x2F;etc&#x2F;rc5.d ç­‰ï¼‰ï¼Œç°åœ¨åˆ™å­˜æ”¾åœ¨&#x2F;lib&#x2F;systemd&#x2F;system å’Œ&#x2F;etc&#x2F;systemd&#x2F;system ç›®å½•ã€‚</p><p>ï¼ˆ3ï¼‰é…ç½®æ–‡ä»¶çš„ä½ç½®ï¼Œä»¥å‰ init è¿›ç¨‹çš„é…ç½®æ–‡ä»¶æ˜¯&#x2F;etc&#x2F;inittabï¼Œå„ç§æœåŠ¡çš„é…ç½®æ–‡ä»¶å­˜æ”¾åœ¨&#x2F;etc&#x2F;sysconfig ç›®å½•ã€‚ç°åœ¨çš„é…ç½®æ–‡ä»¶ä¸»è¦å­˜æ”¾åœ¨&#x2F;lib&#x2F;systemd ç›®å½•ï¼Œåœ¨&#x2F;etc&#x2F;systemd ç›®å½•é‡Œé¢çš„ä¿®æ”¹å¯ä»¥è¦†ç›–åŸå§‹è®¾ç½®ã€‚</p><h2 id="æ—¥å¿—ç®¡ç†"><a href="#æ—¥å¿—ç®¡ç†" class="headerlink" title="æ—¥å¿—ç®¡ç†"></a>æ—¥å¿—ç®¡ç†</h2><p>Systemd ç»Ÿä¸€ç®¡ç†æ‰€æœ‰ Unit çš„å¯åŠ¨æ—¥å¿—ã€‚å¸¦æ¥çš„å¥½å¤„å°±æ˜¯ï¼Œå¯ä»¥åªç”¨ journalctl ä¸€ä¸ªå‘½ä»¤ï¼ŒæŸ¥çœ‹æ‰€æœ‰æ—¥å¿—ï¼ˆå†…æ ¸æ—¥å¿—å’Œåº”ç”¨æ—¥å¿—ï¼‰ã€‚æ—¥å¿—çš„é…ç½®æ–‡ä»¶æ˜¯&#x2F;etc&#x2F;systemd&#x2F;journald.confã€‚</p><p>journalctl åŠŸèƒ½å¼ºå¤§ï¼Œç”¨æ³•éå¸¸å¤šã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—ï¼ˆé»˜è®¤æƒ…å†µä¸‹ ï¼Œåªä¿å­˜æœ¬æ¬¡å¯åŠ¨çš„æ—¥å¿—ï¼‰</span></span><br><span class="line">sudo journalctl</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å†…æ ¸æ—¥å¿—ï¼ˆä¸æ˜¾ç¤ºåº”ç”¨æ—¥å¿—ï¼‰</span></span><br><span class="line">sudo journalctl -k</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ç³»ç»Ÿæœ¬æ¬¡å¯åŠ¨çš„æ—¥å¿—</span></span><br><span class="line">sudo journalctl -b</span><br><span class="line">sudo journalctl -b -0</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ä¸Šä¸€æ¬¡å¯åŠ¨çš„æ—¥å¿—ï¼ˆéœ€æ›´æ”¹è®¾ç½®ï¼‰</span></span><br><span class="line">sudo journalctl -b -1</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æŒ‡å®šæ—¶é—´çš„æ—¥å¿—</span></span><br><span class="line">sudo journalctl --since=<span class="string">&quot;2012-10-30 18:17:16&quot;</span></span><br><span class="line">sudo journalctl --since <span class="string">&quot;20 min ago&quot;</span></span><br><span class="line">sudo journalctl --since yesterday</span><br><span class="line">sudo journalctl --since <span class="string">&quot;2015-01-10&quot;</span> --<span class="keyword">until</span> <span class="string">&quot;2015-01-11 03:00&quot;</span></span><br><span class="line">sudo journalctl --since 09:00 --<span class="keyword">until</span> <span class="string">&quot;1 hour ago&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ˜¾ç¤ºå°¾éƒ¨çš„æœ€æ–°10è¡Œæ—¥å¿—</span></span><br><span class="line">sudo journalctl -n</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ˜¾ç¤ºå°¾éƒ¨æŒ‡å®šè¡Œæ•°çš„æ—¥å¿—</span></span><br><span class="line">sudo journalctl -n 20</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®æ—¶æ»šåŠ¨æ˜¾ç¤ºæœ€æ–°æ—¥å¿—</span></span><br><span class="line">sudo journalctl -f</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æŒ‡å®šæœåŠ¡çš„æ—¥å¿—</span></span><br><span class="line">sudo journalctl /usr/lib/systemd/systemd</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æŒ‡å®šè¿›ç¨‹çš„æ—¥å¿—</span></span><br><span class="line">sudo journalctl _PID=1</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æŸä¸ªè·¯å¾„çš„è„šæœ¬çš„æ—¥å¿—</span></span><br><span class="line">sudo journalctl /usr/bin/bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æŒ‡å®šç”¨æˆ·çš„æ—¥å¿—</span></span><br><span class="line">sudo journalctl _UID=33 --since today</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æŸä¸ª Unit çš„æ—¥å¿—</span></span><br><span class="line">sudo journalctl -u nginx.service</span><br><span class="line">sudo journalctl -u nginx.service --since today</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®æ—¶æ»šåŠ¨æ˜¾ç¤ºæŸä¸ª Unit çš„æœ€æ–°æ—¥å¿—</span></span><br><span class="line">sudo journalctl -u nginx.service -f</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆå¹¶æ˜¾ç¤ºå¤šä¸ª Unit çš„æ—¥å¿—</span></span><br><span class="line">journalctl -u nginx.service -u php-fpm.service --since today</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æŒ‡å®šä¼˜å…ˆçº§ï¼ˆåŠå…¶ä»¥ä¸Šçº§åˆ«ï¼‰çš„æ—¥å¿—ï¼Œå…±æœ‰8çº§</span></span><br><span class="line"><span class="comment"># 0: emerg</span></span><br><span class="line"><span class="comment"># 1: alert</span></span><br><span class="line"><span class="comment"># 2: crit</span></span><br><span class="line"><span class="comment"># 3: err</span></span><br><span class="line"><span class="comment"># 4: warning</span></span><br><span class="line"><span class="comment"># 5: notice</span></span><br><span class="line"><span class="comment"># 6: info</span></span><br><span class="line"><span class="comment"># 7: debug</span></span><br><span class="line">sudo journalctl -p err -b</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ—¥å¿—é»˜è®¤åˆ†é¡µè¾“å‡ºï¼Œ--no-pager æ”¹ä¸ºæ­£å¸¸çš„æ ‡å‡†è¾“å‡º</span></span><br><span class="line">sudo journalctl --no-pager</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»¥ JSON æ ¼å¼ï¼ˆå•è¡Œï¼‰è¾“å‡º</span></span><br><span class="line">sudo journalctl -b -u nginx.service -o json</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»¥ JSON æ ¼å¼ï¼ˆå¤šè¡Œï¼‰è¾“å‡ºï¼Œå¯è¯»æ€§æ›´å¥½</span></span><br><span class="line">sudo journalctl -b -u nginx.serviceqq</span><br><span class="line"> -o json-pretty</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ˜¾ç¤ºæ—¥å¿—å æ®çš„ç¡¬ç›˜ç©ºé—´</span></span><br><span class="line">sudo journalctl --disk-usage</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®šæ—¥å¿—æ–‡ä»¶å æ®çš„æœ€å¤§ç©ºé—´</span></span><br><span class="line">sudo journalctl --vacuum-size=1G</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®šæ—¥å¿—æ–‡ä»¶ä¿å­˜å¤šä¹…</span></span><br><span class="line">sudo journalctl --vacuum-time=1years</span><br></pre></td></tr></table></figure><h2 id="user"><a href="#user" class="headerlink" title="user"></a>user</h2><blockquote><p><a href="https://wiki.archlinux.org/title/Systemd_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)">systemd</a> ä¼šç»™æ¯ä¸ªç”¨æˆ·ç”Ÿæˆä¸€ä¸ª systemd å®ä¾‹ï¼Œç”¨æˆ·å¯ä»¥åœ¨è¿™ä¸ªå®ä¾‹ä¸‹ç®¡ç†æœåŠ¡ï¼Œå¯åŠ¨ã€åœæ­¢ã€å¯ç”¨ä»¥åŠç¦ç”¨ä»–ä»¬è‡ªå·±çš„å•å…ƒã€‚è¿™ä¸ªèƒ½åŠ›å¤§å¤§æ–¹ä¾¿äº†é‚£äº›é€šå¸¸åœ¨ç‰¹å®šç”¨æˆ·ä¸‹è¿è¡Œçš„å®ˆæŠ¤è¿›ç¨‹å’ŒæœåŠ¡</p></blockquote><ul><li><code>/usr/lib/systemd/user/</code> è¿™é‡Œå­˜æ”¾çš„æ˜¯å„ä¸ªè½¯ä»¶åŒ…å®‰è£…çš„æœåŠ¡ã€‚</li><li><code>~/.local/share/systemd/user/</code> è¿™é‡Œå­˜æ”¾çš„æ˜¯ HOME ç›®å½•ä¸­å·²å®‰è£…çš„è½¯ä»¶åŒ…çš„å•å…ƒã€‚</li><li><code>/etc/systemd/user/</code> è¿™é‡Œå­˜æ”¾çš„æ˜¯ç”±ç³»ç»Ÿç®¡ç†å‘˜ç»´æŠ¤çš„ç³»ç»ŸèŒƒå›´çš„ç”¨æˆ·æœåŠ¡ã€‚</li><li><code>~/.config/systemd/user/</code> è¿™é‡Œå­˜æ”¾çš„æ˜¯ç”¨æˆ·è‡ªèº«çš„æœåŠ¡ã€‚</li></ul><p>å½“ systemd ç”¨æˆ·å®ä¾‹å¯åŠ¨æ—¶ï¼Œå®ƒä¼šå°† <code>default.target</code> å¸¦èµ·æ¥ã€‚å…¶ä»–ç”¨æˆ·å•å…ƒå¯ä»¥é€šè¿‡ <code>systemctl --user</code> æ¥ç®¡ç†ã€‚</p><h2 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h2><h3 id="æ‰§è¡Œè‡ªå®šä¹‰è„šæœ¬"><a href="#æ‰§è¡Œè‡ªå®šä¹‰è„šæœ¬" class="headerlink" title="æ‰§è¡Œè‡ªå®šä¹‰è„šæœ¬"></a>æ‰§è¡Œè‡ªå®šä¹‰è„šæœ¬</h3><p>é€šè¿‡ systemd è¿›è¡Œå¼€æœºè‡ªå¯åŠ¨è„šæœ¬</p><p>vim &#x2F;etc&#x2F;systemd&#x2F;system&#x2F;custom.service</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Unit]</span></span><br><span class="line"><span class="attr">Description</span> = Custom Startup Service</span><br><span class="line"></span><br><span class="line"><span class="section">[Service]</span></span><br><span class="line"><span class="attr">Type</span> = simple</span><br><span class="line"><span class="attr">ExecStart</span> = /opt/scripts/custom.sh</span><br><span class="line"></span><br><span class="line"><span class="section">[Install]</span></span><br><span class="line"><span class="attr">WantedBy</span> = multi-user.target</span><br></pre></td></tr></table></figure><p><code>sudo systemctl enable custom.service</code></p><h3 id="æ‰§è¡Œå®šæ—¶ä»»åŠ¡"><a href="#æ‰§è¡Œå®šæ—¶ä»»åŠ¡" class="headerlink" title="æ‰§è¡Œå®šæ—¶ä»»åŠ¡"></a>æ‰§è¡Œå®šæ—¶ä»»åŠ¡</h3><p>timer ç±»ä¼¼äº crontab çš„å®šæ—¶ä»»åŠ¡åŠŸèƒ½</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹æ‰€æœ‰ Service å•å…ƒ</span></span><br><span class="line">systemctl list-unit-files --<span class="built_in">type</span>Â service</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ‰€æœ‰çš„ timer å•å…ƒ</span></span><br><span class="line">systemctl list-unit-files --<span class="built_in">type</span>Â timer</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ‰€æœ‰ mount å•å…ƒ</span></span><br><span class="line">systemctl list-unit-files --<span class="built_in">type</span>Â mount</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ‰€æœ‰çš„å•å…ƒ</span></span><br><span class="line">systemctl list-unit-files</span><br></pre></td></tr></table></figure><p>æ¯”å¦‚åˆ›å»ºä¸€ä¸ª serviceï¼š <code>/usr/lib/systemd/system/hello.service</code></p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Unit]</span></span><br><span class="line"><span class="attr">Description</span>=my hello.sh</span><br><span class="line"></span><br><span class="line"><span class="section">[Service]</span></span><br><span class="line"><span class="attr">ExecStart</span>=/bin/bash /root/hello.sh</span><br></pre></td></tr></table></figure><p>åœ¨åˆ›å»ºä¸€ä¸ª timerï¼š <code>/usr/lib/systemd/system/hello.timer</code></p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Timer]</span></span><br><span class="line"><span class="attr">OnUnitActiveSec</span>=<span class="number">5</span>sÂ <span class="comment"># æ¯éš”å¤šä¹…æ‰§è¡Œä»»åŠ¡</span></span><br><span class="line"><span class="attr">AccuracySec</span>=<span class="number">1</span>msÂ <span class="comment">#è®¾ç½®æ—¶é—´ç²¾åº¦ï¼Œå¦‚æœä¸è®¾ç½®çš„è¯ï¼Œå…·ä½“çš„æ‰§è¡Œæ—¶é—´å°±ä¸ä¸€å®šäº†</span></span><br><span class="line"><span class="attr">Unit</span>=hello.serviceÂ <span class="comment"># è¦æ‰§è¡Œå“ªä¸ªä»»åŠ¡</span></span><br><span class="line"></span><br><span class="line"><span class="section">[Install]</span></span><br><span class="line"><span class="attr">WantedBy</span>=multi-user.target</span><br></pre></td></tr></table></figure><p>å¯åŠ¨å®šæ—¶å™¨ï¼Œå¹¶å¼€æœºè‡ªå¯åŠ¨ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> --now hello.timer</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
            <tag> Linux </tag>
            
            <tag> Systemd </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nginxåå‘ä»£ç†wordpresså¹¶å¯ç”¨https</title>
      <link href="/posts/990b6b62/"/>
      <url>/posts/990b6b62/</url>
      
        <content type="html"><![CDATA[<blockquote><p>åå‘ä»£ç† wordpress é‡åˆ°äº†é—®é¢˜ï¼Œnginx ä¸å¯ç”¨ httpsï¼Œåå‘ä»£ç†æ²¡é—®é¢˜ï¼ˆwordpress å’Œ nginx ä¹‹é—´èµ° httpï¼‰ï¼Œä½†æ˜¯ nginx å¯ç”¨äº† httpsï¼Œé¡µé¢ä¸Šçš„æ ·å¼å°±æ²¡æœ‰äº†ï¼Œf12 æŸ¥çœ‹ï¼Œå‘ç° js å’Œ css èµ°çš„è¿˜æ˜¯ httpï¼Œæ‰€ä»¥ 404</p></blockquote><p>æ ¹æœ¬åŸå› ï¼šwordpress ä»£ç é‡Œæ²¡æœ‰å¼€å¯ httpsï¼Œï¼ˆwordpress è®¤ä¸ºè‡ªå·±æ˜¯è¢« http è®¿é—®çš„ï¼Œæ¯•ç«Ÿ nginx æ˜¯é€šè¿‡ http æ¥è®¿é—®å®ƒçš„ï¼‰</p><h2 id="ä¿®æ”¹-wordpress-é…ç½®"><a href="#ä¿®æ”¹-wordpress-é…ç½®" class="headerlink" title="ä¿®æ”¹ wordpress é…ç½®"></a>ä¿®æ”¹ wordpress é…ç½®</h2><blockquote><p>æ„Ÿè§‰è¿™ç§æ–¹æ¡ˆæœ€é è°±ï¼Œè°çš„å€ºè°æ¥è¿˜ã€‚ã€‚</p></blockquote><p>åœ¨ <code>wp-config.php</code> çš„ <code>if ( ! defined( â€˜ABSPATHâ€™ ) )</code> å‰é¢æ·»åŠ ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTPS&#x27;</span>] = <span class="string">&#x27;on&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&#x27;FORCE_SSL_LOGIN&#x27;</span>, <span class="literal">true</span>);</span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&#x27;FORCE_SSL_ADMIN&#x27;</span>, <span class="literal">true</span>);</span><br></pre></td></tr></table></figure><h3 id="å¦‚æœæ˜¯å®˜æ–¹-Docker-å®¹å™¨çš„è¯"><a href="#å¦‚æœæ˜¯å®˜æ–¹-Docker-å®¹å™¨çš„è¯" class="headerlink" title="å¦‚æœæ˜¯å®˜æ–¹ Docker å®¹å™¨çš„è¯"></a>å¦‚æœæ˜¯å®˜æ–¹ Docker å®¹å™¨çš„è¯</h3><p>å¼ºçƒˆå»ºè®® Nginx çš„ location &#x2F;é‡Œé¢æ·»åŠ ä¸€ä¸ªå¤´ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxy_set_header X-Forwarded-Proto $scheme;</span><br></pre></td></tr></table></figure><p>wordpress å®˜æ–¹ Docker é•œåƒä¼šæ£€æµ‹è¿™ä¸ªå¤´æ¥åˆ¤æ–­æ˜¯å¦ä»£ç é‡Œå¼€å¯ https</p><p>åŸå› æ˜¯åœ¨ï¼š<br>wp-config.php é‡Œé¢ï¼Œ ä¸ºäº†å¼€å¯ä¸‹é¢çš„å‚æ•°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_FORWARDED_PROTO&#x27;</span>]) &amp;&amp; <span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_FORWARDED_PROTO&#x27;</span>] === <span class="string">&#x27;https&#x27;</span>) &#123;</span><br><span class="line">    <span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTPS&#x27;</span>] = <span class="string">&#x27;on&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‚è€ƒï¼š<br><a href="https://github.com/docker-library/wordpress/pull/142">https://github.com/docker-library/wordpress/pull/142</a></p><p><a href="https://hub.docker.com/_/wordpress">https://hub.docker.com/_/wordpress</a></p>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Nginx </tag>
            
            <tag> Proxy </tag>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>openSUSEå¸¸ç”¨é…ç½®</title>
      <link href="/posts/9f2e533a/"/>
      <url>/posts/9f2e533a/</url>
      
        <content type="html"><![CDATA[<h2 id="å®‰è£…-vscode"><a href="#å®‰è£…-vscode" class="headerlink" title="å®‰è£… vscode"></a>å®‰è£… vscode</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo rpm --import https://packages.microsoft.com/keys/microsoft.asc</span><br><span class="line">sudo sh -c <span class="string">&#x27;echo -e &quot;[code]\nname=Visual Studio Code\nbaseurl=https://packages.microsoft.com/yumrepos/vscode\nenabled=1\ntype=rpm-md\ngpgcheck=1\ngpgkey=https://packages.microsoft.com/keys/microsoft.asc&quot; &gt; /etc/zypp/repos.d/vscode.repo&#x27;</span></span><br><span class="line"></span><br><span class="line">sudo zypper refresh</span><br><span class="line">sudo zypper install code</span><br></pre></td></tr></table></figure><h2 id="å®‰è£…-vmware-workstation"><a href="#å®‰è£…-vmware-workstation" class="headerlink" title="å®‰è£… vmware workstation"></a>å®‰è£… vmware workstation</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo zypper install gcc gcc-c++ kernel-source kernel-syms</span><br></pre></td></tr></table></figure><p>ç„¶åæ­£å¸¸å®‰è£… vmware-workstation</p><h2 id="å…³é—­ä¼‘çœ ï¼Œè™šæ‹Ÿæœºå»ºè®®æ“ä½œä¸€ä¸‹"><a href="#å…³é—­ä¼‘çœ ï¼Œè™šæ‹Ÿæœºå»ºè®®æ“ä½œä¸€ä¸‹" class="headerlink" title="å…³é—­ä¼‘çœ ï¼Œè™šæ‹Ÿæœºå»ºè®®æ“ä½œä¸€ä¸‹"></a>å…³é—­ä¼‘çœ ï¼Œè™šæ‹Ÿæœºå»ºè®®æ“ä½œä¸€ä¸‹</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl stop sleep.target suspend.target hibernate.target hybrid-sleep.target</span><br><span class="line">sudo systemctl <span class="built_in">disable</span> sleep.target suspend.target hibernate.target hybrid-sleep.target</span><br><span class="line">sudo systemctl mask sleep.target suspend.target hibernate.target hybrid-sleep.target</span><br></pre></td></tr></table></figure><h2 id="å®‰è£…è¾“å…¥æ³•"><a href="#å®‰è£…è¾“å…¥æ³•" class="headerlink" title="å®‰è£…è¾“å…¥æ³•"></a>å®‰è£…è¾“å…¥æ³•</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo zypper install fcitx-rime</span><br></pre></td></tr></table></figure><p>åœ¨ wayland ä¸‹ä¸èƒ½è‡ªåŠ¨å¯åŠ¨è¾“å…¥æ³•ï¼Œè§£å†³æ–¹æ¡ˆï¼š<br>æœ€æ–°çš„ç¨³å®šç‰ˆ Fcitx å’Œ iBus éƒ½å·²ç»äº†åŸºæœ¬çš„ Wayland æ”¯æŒï¼Œé€šè¿‡ X çš„åè®®è½¬æ¥ç°ã€‚ä¸‹ä¸€ä»£çš„ Fcitx å°†ä¼šæä¾›å¯¹ Wayland çš„ç›´æ¥æ”¯æŒã€‚<br>Wayland è¯»å–çš„ç¯å¢ƒé…ç½®æ–‡ä»¶æ˜¯ &#x2F;etc&#x2F;environment è€Œä¸æ˜¯ X æ‰€è¯»å–çš„ç¯å¢ƒå˜é‡æ–‡ä»¶ã€‚å› æ­¤å¯¹ X æœ‰æ•ˆçš„è¾“å…¥æ³•é…ç½®åœ¨ Wayland ä¸Šä¸èµ·æ•ˆæœäº†ã€‚ä»¥ç®¡ç†å‘˜æƒé™ç¼–è¾‘å®ƒï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vi /etc/environment</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ–‡ä»¶åº”è¯¥æ˜¯ç©ºçš„ï¼Œåªæœ‰å‡ è¡Œæ³¨é‡Šã€‚</p><ul><li><p>ä»¥ Fcitx ä¸ºä¾‹ï¼š</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">INPUT_METHOD=fcitx</span><br><span class="line">GTK_IM_MODULE=fcitx</span><br><span class="line">QT_IM_MODULE=fcitx</span><br><span class="line">XMODIFIERS=@im=fcitx</span><br></pre></td></tr></table></figure></li><li><p>å¦‚æœæ‚¨ä½¿ç”¨ iBus çš„è¯ï¼Œé‚£ä¹ˆåº”è¯¥æ·»åŠ è¿™å‡ è¡Œï¼š</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">INPUT_METHOD=ibus</span><br><span class="line">GTK_IM_MODULE=ibus</span><br><span class="line">QT_IM_MODULE=ibus</span><br><span class="line">XMODIFIERS=@im=ibus</span><br></pre></td></tr></table></figure></li></ul><p>ä¹‹åè¯·é‡å¯æ‚¨çš„ç³»ç»Ÿã€‚</p><h2 id="å®‰è£…-RDP-å®¢æˆ·ç«¯"><a href="#å®‰è£…-RDP-å®¢æˆ·ç«¯" class="headerlink" title="å®‰è£… RDP å®¢æˆ·ç«¯"></a>å®‰è£… RDP å®¢æˆ·ç«¯</h2><h3 id="ä½¿ç”¨-freerdp"><a href="#ä½¿ç”¨-freerdp" class="headerlink" title="ä½¿ç”¨ freerdp"></a>ä½¿ç”¨ freerdp</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo zypper install freerdp</span><br></pre></td></tr></table></figure><blockquote><p>å¦‚æœæç¤º <code>Failed to find libav H.264 codec</code>ï¼Œåˆ™éœ€è¦å®‰è£…<br><code>wget https://opensuse-community.org/codecs-kde.ymp</code> ï¼Œåœ¨ dolphin é‡Œé¢æ‰“å¼€è¿™ä¸ªæ–‡ä»¶<br>å®˜æ–¹è¯´æ˜ï¼š<a href="https://opensuse-guide.org/codecs.php">https://opensuse-guide.org/codecs.php</a></p></blockquote><p>è¿æ¥ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xfreerdp /v:192.168.2.138 /u:&lt;your username&gt; /p:&lt;your password&gt; /w:1920 /h:1080 /cert:ignore</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨-remmina"><a href="#ä½¿ç”¨-remmina" class="headerlink" title="ä½¿ç”¨ remmina"></a>ä½¿ç”¨ remmina</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo zypper install remmina remmina-plugin-rdp</span><br></pre></td></tr></table></figure><h2 id="å®‰è£…æ˜¾å¡é©±åŠ¨"><a href="#å®‰è£…æ˜¾å¡é©±åŠ¨" class="headerlink" title="å®‰è£…æ˜¾å¡é©±åŠ¨"></a>å®‰è£…æ˜¾å¡é©±åŠ¨</h2><p>64-bit : zypper install Mesa-libGL1 Mesa<br>32-bit : zypper install Mesa-libGL1-32bit Mesa-32bit</p><h2 id="åŒ…ç®¡ç†-zypper"><a href="#åŒ…ç®¡ç†-zypper" class="headerlink" title="åŒ…ç®¡ç† zypper"></a>åŒ…ç®¡ç† zypper</h2><h3 id="æœç´¢æ–‡ä»¶å±äºå“ªä¸ªåŒ…"><a href="#æœç´¢æ–‡ä»¶å±äºå“ªä¸ªåŒ…" class="headerlink" title="æœç´¢æ–‡ä»¶å±äºå“ªä¸ªåŒ…"></a>æœç´¢æ–‡ä»¶å±äºå“ªä¸ªåŒ…</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo zypper search --provides /usr/bin/python3</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é€šè¿‡inodeåˆ é™¤æ–‡ä»¶</title>
      <link href="/posts/33d6f438/"/>
      <url>/posts/33d6f438/</url>
      
        <content type="html"><![CDATA[<blockquote><p>æœ‰æ—¶å€™ä¼šæœ‰ä¸€äº›æ–‡ä»¶åæ˜¯ä¹±ç çš„æ–‡ä»¶æ— æ³•åˆ é™¤ï¼Œè¿™æ—¶å€™å¯ä»¥é€šè¿‡ inode æ¥åˆ é™¤ã€‚</p></blockquote><h2 id="è·å–æ–‡ä»¶çš„-inode"><a href="#è·å–æ–‡ä»¶çš„-inode" class="headerlink" title="è·å–æ–‡ä»¶çš„ inode"></a>è·å–æ–‡ä»¶çš„ inode</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> -ali</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€åˆ—å°±æ˜¯æ–‡ä»¶çš„ inode</p><h2 id="é€šè¿‡-inode-åˆ é™¤"><a href="#é€šè¿‡-inode-åˆ é™¤" class="headerlink" title="é€šè¿‡ inode åˆ é™¤"></a>é€šè¿‡ inode åˆ é™¤</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find -inum 527084 -<span class="built_in">exec</span> <span class="built_in">rm</span> -rf &#123;&#125; \;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Command </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Bashä¸­åŒæ¨ªçº¿çš„ä½œç”¨</title>
      <link href="/posts/314a3942/"/>
      <url>/posts/314a3942/</url>
      
        <content type="html"><![CDATA[<p>çœ‹ä¸ªä¾‹å­ï¼š</p><blockquote><p>å‡è®¾æœ‰ä¸ªæ–‡ä»¶å« <code>-f</code>ï¼Œ æˆ‘æƒ³æŠŠè¿™ä¸ªæ–‡ä»¶åˆ é™¤<br>å‡è®¾æˆ‘è¦ç”¨ <code>rm -f -f</code> æ¥åˆ é™¤ï¼Œä¼šå‘ç°æ— æ³•åˆ é™¤ï¼Œbash æŠŠç¬¬äºŒä¸ª <code>-f</code> å½“ä½œå‚æ•°äº†</p></blockquote><p>è¿™ä¸ªæ—¶å€™å¯ä»¥ä½¿ç”¨ <code>--</code>(å½“ç„¶æœ‰å…¶ä»–æ–¹æ³•ï¼Œè¿™é‡Œå…ˆä¸è®¨è®º)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">rm</span> -f -- -f</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„ <code>--</code> è¡¨ç¤ºè¿™ä¸ªç¨‹åºçš„å‚æ•°å·²ç»ç»“æŸäº†ï¼Œåé¢æ‰€æœ‰çš„å†…å®¹éƒ½æ˜¯å‚æ•°çš„å€¼äº†ï¼Œæ¯”å¦‚ç¬¬äºŒä¸ª <code>-f</code> å°±ä¸ä¼šè®¤ä¸ºå®ƒæ˜¯ rm çš„å‚æ•°äº†</p><p>ç°åœ¨ä½¿ç”¨ kubectl exec ä¹Ÿä¼šæ¨èä½ ç”¨ â€“ åé¢å†æ¥ä¸Šå‘½ä»¤</p>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Unixå£ä»¤ç”Ÿæˆä¸ä½¿ç”¨</title>
      <link href="/posts/6447a6a9/"/>
      <url>/posts/6447a6a9/</url>
      
        <content type="html"><![CDATA[<p>è¿™ä¸ªå¯†ç æœ‰ä»€ä¹ˆç”¨:<br>&#x2F;etc&#x2F;shadow linux ç”¨æˆ·å¯†ç å°±æ˜¯é€šè¿‡è¿™ç§æ–¹æ³• hash çš„<br>http basic auth çš„å¯†ç ä¹Ÿæ˜¯é€šè¿‡è¿™ç§æ–¹å¼ç”Ÿæˆçš„</p><h2 id="é€šè¿‡-openssl-ç”Ÿæˆ"><a href="#é€šè¿‡-openssl-ç”Ÿæˆ" class="headerlink" title="é€šè¿‡ openssl ç”Ÿæˆ"></a>é€šè¿‡ openssl ç”Ÿæˆ</h2><p>æ‰§è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ubuntu</span></span><br><span class="line">openssl passwd -6 123456</span><br><span class="line"></span><br><span class="line">å‚æ•°çš„å«ä¹‰ï¼š</span><br><span class="line"> -6                  SHA512-based password algorithm</span><br><span class="line"> -5                  SHA256-based password algorithm</span><br><span class="line"> -apr1               MD5-based password algorithm, Apache variant</span><br><span class="line"> -1                  MD5-based password algorithm</span><br><span class="line"></span><br><span class="line"><span class="comment"># centos</span></span><br><span class="line">openssl passwd -1 123456</span><br></pre></td></tr></table></figure><blockquote><p>å°±èƒ½ç”Ÿæˆä¸€ä¸²å­—ç¬¦ä¸²ï¼Œå…¶ä¸­å‚æ•° 6 æ˜¯æœ€é•¿çš„ï¼Œ1 æ˜¯æœ€çŸ­çš„ï¼Œåé¢ 123456 æ˜¯è¦åŠ å¯†çš„å¯†ç <br>ä»”ç»†è§‚å¯Ÿä¼šå‘ç°æ¯æ¬¡ç”Ÿæˆçš„å¯†ç éƒ½æ˜¯ä¸åŒçš„ï¼Œé‚£æ˜¯å› ä¸ºæ¯æ¬¡æ‰§è¡Œ openssl ä¼šéšæœºç”Ÿæˆä¸€ä¸ª salt å€¼ï¼Œ<br>å¯ä»¥æœ‰æ•ˆé˜²æ­¢å­—å…¸åæ¨ï¼Œæ¯”å¦‚ 123456 è¿™ç§å¼±å¯†ç </p></blockquote><p>æ‰‹åŠ¨æŒ‡å®š salt å€¼åï¼Œæ¯æ¬¡ç”Ÿæˆçš„å¯†ç éƒ½æ˜¯ä¸€æ ·çš„äº†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl passwd -salt zlk -6 123456</span><br></pre></td></tr></table></figure><h2 id="é€šè¿‡-htpasswd-ç”Ÿæˆ"><a href="#é€šè¿‡-htpasswd-ç”Ÿæˆ" class="headerlink" title="é€šè¿‡ htpasswd ç”Ÿæˆ"></a>é€šè¿‡ htpasswd ç”Ÿæˆ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Ubuntu or Debian</span></span><br><span class="line">apt install apache2-utils</span><br><span class="line"></span><br><span class="line"><span class="comment"># Rhel or CentOS:</span></span><br><span class="line">yum install httpd-tools</span><br></pre></td></tr></table></figure><p>ç”Ÿæˆå¯†ç , å¯†ç æ–‡ä»¶ä¸º <code>.htpasswd</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">htpasswd -bcd .htpasswd username password</span><br></pre></td></tr></table></figure><h2 id="é€šè¿‡-python-ç”Ÿæˆ"><a href="#é€šè¿‡-python-ç”Ÿæˆ" class="headerlink" title="é€šè¿‡ python ç”Ÿæˆ"></a>é€šè¿‡ python ç”Ÿæˆ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c <span class="string">&#x27;import crypt; print(crypt.crypt(&quot;123456&quot;,&quot;salt&quot;))&#x27;</span></span><br></pre></td></tr></table></figure><blockquote><p>salt æ˜¯ç›å€¼ï¼Œåœ¨å¯†ç å­¦ä¸­ï¼Œæ˜¯æŒ‡é€šè¿‡åœ¨å¯†ç ä»»æ„å›ºå®šä½ç½®æ’å…¥ç‰¹å®šçš„å­—ç¬¦ä¸²ï¼Œè®©æ•£åˆ—åçš„ç»“æœå’Œä½¿ç”¨åŸå§‹å¯†ç çš„æ•£åˆ—ç»“æœä¸ç›¸ç¬¦ï¼Œè¿™ç§è¿‡ç¨‹ç§°ä¹‹ä¸ºâ€œåŠ ç›â€ã€‚ä¸åŒç›å€¼ç”Ÿæˆçš„å¯†ç æ˜¯ä¸åŒçš„ï¼Œèƒ½ä¸€å®šç¨‹åº¦ä¸Šé˜²æ­¢åæ¨å‡ºå¯†ç ã€‚</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Auth </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åœ¨æ²¡æœ‰å¯†ç çš„æƒ…å†µä¸‹ç»™Windowsæ¤å…¥æ¶æ„è½¯ä»¶ï¼ˆç¦»çº¿æ”»å‡»ï¼‰</title>
      <link href="/posts/shtwtk/"/>
      <url>/posts/shtwtk/</url>
      
        <content type="html"><![CDATA[<p>ä»€ä¹ˆæ˜¯ç¦»çº¿æ”»å‡»ï¼Œé€šä¿—ç‚¹è¯´å°±æ˜¯ç”µè„‘ä¸»äººç¦»å¼€äº†ç”µè„‘ï¼Œé»‘å®¢è·‘åˆ°ç”µè„‘é¢å‰è¿›è¡Œç ´è§£çš„æ–¹æ³•ğŸ¤£ã€‚è¿™ç§ç ´è§£æ–¹å¼ä¸»è¦æ˜¯é€šè¿‡ä¿®æ”¹ Windows çš„ SAM æ–‡ä»¶æ¥è¾¾åˆ°è·å–æƒé™çš„ç›®çš„ã€‚</p><h2 id="Windows-çš„-SAM-æ–‡ä»¶"><a href="#Windows-çš„-SAM-æ–‡ä»¶" class="headerlink" title="Windows çš„ SAM æ–‡ä»¶"></a>Windows çš„ SAM æ–‡ä»¶</h2><p>Windows çš„ SAM æ–‡ä»¶ï¼ˆSecurity Accounts Managerï¼‰æ˜¯ä¸€ä¸ªç”¨äºå­˜å‚¨æœ¬åœ°ç”¨æˆ·è´¦æˆ·å’Œå¯†ç æ•£åˆ—å€¼çš„æ•°æ®åº“æ–‡ä»¶ã€‚å®ƒåœ¨ Windows æ“ä½œç³»ç»Ÿä¸­æ‰®æ¼”ç€è‡³å…³é‡è¦çš„è§’è‰²ï¼Œç”¨äºç®¡ç†æœ¬åœ°å®‰å…¨å’Œè´¦æˆ·ä¿¡æ¯ã€‚SAM æ–‡ä»¶é€šå¸¸ä½äº C:\Windows\System32\config ç›®å½•ä¸­ã€‚</p><p>SAM æ–‡ä»¶çš„åŸç†</p><ul><li>è´¦æˆ·ä¿¡æ¯å­˜å‚¨ï¼šSAM æ–‡ä»¶åŒ…å«äº†æœ¬åœ°ç”¨æˆ·è´¦æˆ·çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç”¨æˆ·åå’Œç›¸å…³çš„å®‰å…¨æ ‡è¯†ç¬¦ï¼ˆSIDï¼‰ã€‚æ¯ä¸ªç”¨æˆ·éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„ SIDï¼Œç”¨äºæ ‡è¯†ç”¨æˆ·å’Œæ§åˆ¶è®¿é—®æƒé™ã€‚</li><li>å¯†ç å­˜å‚¨ï¼šä¸ºäº†å®‰å…¨èµ·è§ï¼ŒSAM æ–‡ä»¶ä¸ç›´æ¥å­˜å‚¨ç”¨æˆ·çš„æ˜æ–‡å¯†ç ï¼Œè€Œæ˜¯å­˜å‚¨å¯†ç çš„æ•£åˆ—å€¼ã€‚Windows ä½¿ç”¨ NTLMï¼ˆNT LAN Managerï¼‰åè®®ç”Ÿæˆè¿™äº›æ•£åˆ—å€¼ã€‚å…·ä½“è€Œè¨€ï¼ŒNTLM é‡‡ç”¨ MD4 æ•£åˆ—ç®—æ³•å¯¹ç”¨æˆ·å¯†ç è¿›è¡Œæ•£åˆ—ã€‚</li><li>åŠ å¯†ä¿æŠ¤ï¼šä¸ºäº†è¿›ä¸€æ­¥ä¿æŠ¤ SAM æ–‡ä»¶ä¸­çš„æ•°æ®ï¼ŒWindows å¯¹å…¶è¿›è¡ŒåŠ å¯†ã€‚åŠ å¯†å¯†é’¥å­˜å‚¨åœ¨ä¸€ä¸ªåä¸º SYSTEM çš„æ–‡ä»¶ä¸­ã€‚æ”»å‡»è€…éœ€è¦åŒæ—¶è®¿é—® SAM å’Œ SYSTEM æ–‡ä»¶æ‰èƒ½è§£å¯†å’Œç ´è§£å¯†ç æ•£åˆ—å€¼ã€‚</li><li>æ³¨å†Œè¡¨è®¿é—®ï¼šåœ¨ç³»ç»Ÿè¿è¡Œæ—¶ï¼ŒSAM æ–‡ä»¶ä½œä¸º Windows æ³¨å†Œè¡¨çš„ä¸€éƒ¨åˆ†ï¼Œé€šè¿‡ <code>HKEY_LOCAL_MACHINE\SAM</code> è·¯å¾„è®¿é—®ã€‚ç”±äºå®‰å…¨åŸå› ï¼Œåªæœ‰å…·æœ‰ç³»ç»Ÿçº§æƒé™çš„ç”¨æˆ·ï¼ˆå¦‚ SYSTEM è´¦æˆ·ï¼‰æ‰èƒ½ç›´æ¥è®¿é—®è¯¥è·¯å¾„ã€‚</li></ul><h2 id="æå‰è¦æ±‚"><a href="#æå‰è¦æ±‚" class="headerlink" title="æå‰è¦æ±‚"></a>æå‰è¦æ±‚</h2><ul><li>ç‰©ç†æ¥è§¦ï¼Œèƒ½æ‘¸åˆ°ç”µè„‘ï¼Œå¯ä»¥æ’å…¥ U ç›˜</li><li>BIOS&#x2F;UEFI ä¸èƒ½è®¾ç½®å¯†ç ï¼Œå¯ä»¥é€šè¿‡ U ç›˜å¯åŠ¨ç”µè„‘</li><li>Windows ç³»ç»Ÿç›˜ä¸èƒ½å¼€å¯ BitLocker ç£ç›˜åŠ å¯†</li></ul><p>æ»¡è¶³è¿™äº›æ¡ä»¶åï¼Œå¯ä»¥å°è¯•è¿›è¡Œæ¤å…¥æœ¨é©¬ç—…æ¯’ã€‚</p><h2 id="ç¡®å®šä¸‹ä½¿ç”¨çš„è´¦æˆ·"><a href="#ç¡®å®šä¸‹ä½¿ç”¨çš„è´¦æˆ·" class="headerlink" title="ç¡®å®šä¸‹ä½¿ç”¨çš„è´¦æˆ·"></a>ç¡®å®šä¸‹ä½¿ç”¨çš„è´¦æˆ·</h2><p>ä¸€èˆ¬æ¥è¯´ä¸€å°ç”µè„‘åªæœ‰ä¸€ä¸ª Windows ç”¨æˆ·ï¼Œè®°å½•ä¸‹æ—¥å¸¸ä½¿ç”¨çš„ç”¨æˆ·åã€‚</p><h2 id="ä½¿ç”¨-U-ç›˜è¿›å…¥-PE-ç³»ç»Ÿ"><a href="#ä½¿ç”¨-U-ç›˜è¿›å…¥-PE-ç³»ç»Ÿ" class="headerlink" title="ä½¿ç”¨ U ç›˜è¿›å…¥ PE ç³»ç»Ÿ"></a>ä½¿ç”¨ U ç›˜è¿›å…¥ PE ç³»ç»Ÿ</h2><p>è¿›å…¥ PE ç³»ç»Ÿï¼Œå°† SAM æ–‡ä»¶å¤‡ä»½ï¼ˆç”¨äºä¹‹åæ¢å¤å¯†ç ï¼‰<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202408071251917.png" alt="image.png"></p><p>ç”¨ NTPWEdit æˆ–è€… Dism++ ä¿®æ”¹è´¦æˆ·å¯†ç <br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202408071253647.png" alt="image.png"></p><p>ä¿å­˜é‡å¯åï¼Œå³å¯æ­£å¸¸è¿›å…¥æ¡Œé¢ã€‚æ¤å…¥æœ¨é©¬ç¨‹åºåï¼Œå†æ¬¡é‡å¯è¿›å…¥ PEï¼Œ å°†ä¸Šé¢å¤‡ä»½çš„ SAM æ–‡ä»¶æ¢å¤åˆ°åŸå§‹ä½ç½®ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Shellæ•°å­¦è¿ç®—</title>
      <link href="/posts/cd044a59/"/>
      <url>/posts/cd044a59/</url>
      
        <content type="html"><![CDATA[<h2 id="bash-è‡ªå¸¦çš„æ•°å­¦è¿ç®—"><a href="#bash-è‡ªå¸¦çš„æ•°å­¦è¿ç®—" class="headerlink" title="bash è‡ªå¸¦çš„æ•°å­¦è¿ç®—"></a>bash è‡ªå¸¦çš„æ•°å­¦è¿ç®—</h2><blockquote><p>ä¸ä¾èµ–å…¶ä»–åŒ…ï¼Œåªè¦ä½ çš„ shell æ˜¯ bash</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> $(( <span class="number">1</span>  + <span class="number">1</span> ))</span><br><span class="line"><span class="built_in">echo</span> $(( <span class="number">1</span>  - <span class="number">3</span> ))</span><br><span class="line"><span class="built_in">echo</span> $(( <span class="number">10</span> * <span class="number">3</span> ))</span><br><span class="line"><span class="built_in">echo</span> $(( <span class="number">10</span> / <span class="number">3</span> ))</span><br></pre></td></tr></table></figure><h2 id="expr"><a href="#expr" class="headerlink" title="expr"></a>expr</h2><blockquote><p>expr å¯ä»¥å½“è®¡ç®—å™¨ç”¨ä¸è¿‡å®ƒä¸»è¦è¿˜æ˜¯ä¸ªè®¡æ•°å™¨</p></blockquote><h3 id="å­—ç¬¦ä¸²æ“ä½œ"><a href="#å­—ç¬¦ä¸²æ“ä½œ" class="headerlink" title="å­—ç¬¦ä¸²æ“ä½œ"></a>å­—ç¬¦ä¸²æ“ä½œ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®¡ç®—å­—ç¬¦ä¸²é•¿åº¦</span></span><br><span class="line"><span class="built_in">expr</span> length <span class="string">&quot;hello world&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŠ“å–å­—ç¬¦ä¸²ï¼Œ3è¡¨ç¤ºä»ç¬¬3ä¸ªå­—ç¬¦å¼€å§‹ï¼Œ5è¡¨ç¤ºæŠ“å–çš„å­—ç¬¦ä¸²é•¿åº¦</span></span><br><span class="line"><span class="built_in">expr</span> substr <span class="string">&quot;hello world&quot;</span> 3 5</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŠ“å–ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²å‡ºç°çš„ä½ç½®</span></span><br><span class="line"><span class="built_in">expr</span> index <span class="string">&quot;hello world&quot;</span> o</span><br></pre></td></tr></table></figure><h3 id="å››åˆ™è¿ç®—"><a href="#å››åˆ™è¿ç®—" class="headerlink" title="å››åˆ™è¿ç®—"></a>å››åˆ™è¿ç®—</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">expr</span> 10 % 3</span><br><span class="line"><span class="built_in">expr</span> 10 + 10</span><br><span class="line"><span class="built_in">expr</span> 30 / 3 / 2</span><br><span class="line"><span class="built_in">expr</span> 30 \* 3        <span class="comment"># ä½¿ç”¨ä¹˜å·æ—¶ï¼Œå¿…é¡»ç”¨åæ–œçº¿å±è”½å…¶ç‰¹å®šå«ä¹‰ã€‚</span></span><br></pre></td></tr></table></figure><h2 id="bc"><a href="#bc" class="headerlink" title="bc"></a>bc</h2><blockquote><p>bc æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œçš„è®¡ç®—å™¨å·¥å…·ï¼Œæœ‰äº›è¿‡äºç²¾ç®€çš„å‘è¡Œç‰ˆæ²¡æœ‰è‡ªå¸¦ã€‚</p></blockquote><p>æ”¯æŒæµ®ç‚¹æ•°å››åˆ™è¿ç®—</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;1.1 + 2.2&quot;</span> | bc</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;1.1 - 2.2&quot;</span> | bc</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;2 * 2.2&quot;</span> | bc</span><br><span class="line"></span><br><span class="line"><span class="comment"># é™¤æ³•å–å¾—æ˜¯æ•´æ•°éƒ¨åˆ†ï¼Œå°æ•°éƒ¨åˆ†èˆå¼ƒ</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;9 / 6&quot;</span> | bc</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿ç•™å°æ•°ç‚¹åä¸¤ä½</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;scale=2; 9/6&quot;</span> | bc</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¼€æ ¹å·</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;sqrt(100)&quot;</span> | bc</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡æ•°</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;10^3&quot;</span> | bc</span><br><span class="line"></span><br><span class="line"><span class="comment"># å–ä½™æ•°</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;10 % 3&quot;</span> | bc</span><br></pre></td></tr></table></figure><h2 id="awk"><a href="#awk" class="headerlink" title="awk"></a>awk</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">awk <span class="string">&#x27;BEGIN&#123;print 4.5+3.4 &#125;&#x27;</span></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;print 4.5-3.4 &#125;&#x27;</span></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;print 4.5*3.4 &#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é™¤æ³•awkä¼šä¿ç•™å°æ•°ç‚¹å6ä½</span></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;print 1/3 &#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ··åˆè¿ç®—</span></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;print (2.2 - 1.1)*2+3 &#125;&#x27;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Script </tag>
            
            <tag> Shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Centos7å‡çº§åˆ°RHEL8</title>
      <link href="/posts/6d586ed1/"/>
      <url>/posts/6d586ed1/</url>
      
        <content type="html"><![CDATA[<p>æœ¬æ–‡ä¾ç…§ redhat å®˜æ–¹æ–‡æ¡£åˆ¶ä½œï¼Œæ€»å…±åˆ†ä¸ºä¸¤æ­¥ï¼Œå…ˆå°† centos7 è½¬æ¢ä¸º rhel7ï¼Œç„¶åå†å°† rhel7 å‡çº§ä¸º rhel8</p><blockquote><p>å‚è€ƒæ–‡æ¡£ï¼š<br><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/converting_from_an_rpm-based_linux_distribution_to_rhel/index">CentOSè½¬æ¢ä¸ºrhel7</a><br><a href="https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/8/html/upgrading_from_rhel_6_to_rhel_8/preparing-the-rhel-7-system-for-an-upgrade-to-rhel-8_upgrading-from-rhel-6-to-rhel-8">rhel7å‡çº§ä¸ºrhel8</a></p></blockquote><h2 id="centos7-å‡çº§ä¸º-rhel7"><a href="#centos7-å‡çº§ä¸º-rhel7" class="headerlink" title="centos7 å‡çº§ä¸º rhel7"></a>centos7 å‡çº§ä¸º rhel7</h2><h3 id="å‡çº§åˆ°-centos7-æœ€æ–°ç‰ˆ"><a href="#å‡çº§åˆ°-centos7-æœ€æ–°ç‰ˆ" class="headerlink" title="å‡çº§åˆ° centos7 æœ€æ–°ç‰ˆ"></a>å‡çº§åˆ° centos7 æœ€æ–°ç‰ˆ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum update -y &amp;&amp; reboot</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…-convert2rhel"><a href="#å®‰è£…-convert2rhel" class="headerlink" title="å®‰è£… convert2rhel"></a>å®‰è£… convert2rhel</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">curl -o /etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release https://www.redhat.com/security/data/fd431d51.txt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">curl -o /etc/yum.repos.d/convert2rhel.repo https://ftp.redhat.com/redhat/convert2rhel/7/convert2rhel.repo</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">yum install -y convert2rhel</span><br></pre></td></tr></table></figure><h3 id="å¼€å§‹è½¬æ¢"><a href="#å¼€å§‹è½¬æ¢" class="headerlink" title="å¼€å§‹è½¬æ¢"></a>å¼€å§‹è½¬æ¢</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">convert2rhel --username &lt;æ›¿æ¢ä¸ºä½ çš„ç”¨æˆ·å&gt; --password &lt;æ›¿æ¢ä¸ºä½ çš„å¯†ç &gt;</span><br><span class="line">ä¸åŠ --pool ä¼šæç¤ºæ‰‹åŠ¨é€‰æ‹©ï¼Œä¸ºäº†å®‰å…¨ä¹Ÿå¯ä»¥ä¸åŠ å‚æ•°ç›´æ¥è¿è¡Œconvert2rhel</span><br></pre></td></tr></table></figure><h2 id="rhel7-å‡çº§-rhel8"><a href="#rhel7-å‡çº§-rhel8" class="headerlink" title="rhel7 å‡çº§ rhel8"></a>rhel7 å‡çº§ rhel8</h2><h3 id="å¯ç”¨è¿™ä¸¤ä¸ªä»“åº“"><a href="#å¯ç”¨è¿™ä¸¤ä¸ªä»“åº“" class="headerlink" title="å¯ç”¨è¿™ä¸¤ä¸ªä»“åº“"></a>å¯ç”¨è¿™ä¸¤ä¸ªä»“åº“</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">subscription-manager repos --<span class="built_in">enable</span> rhel-7-server-rpms &amp;&amp; \</span><br><span class="line">subscription-manager repos --<span class="built_in">enable</span> rhel-7-server-extras-rpms</span><br></pre></td></tr></table></figure><h3 id="å–æ¶ˆç‰ˆæœ¬é”å®šï¼Ÿ"><a href="#å–æ¶ˆç‰ˆæœ¬é”å®šï¼Ÿ" class="headerlink" title="å–æ¶ˆç‰ˆæœ¬é”å®šï¼Ÿ"></a>å–æ¶ˆç‰ˆæœ¬é”å®šï¼Ÿ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">subscription-manager release --<span class="built_in">unset</span></span><br><span class="line">yum versionlock clear</span><br></pre></td></tr></table></figure><h3 id="ç¡®ä¿-locale-æ˜¯-en-US"><a href="#ç¡®ä¿-locale-æ˜¯-en-US" class="headerlink" title="ç¡®ä¿ locale æ˜¯ en_US"></a>ç¡®ä¿ locale æ˜¯ en_US</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /etc/locale.conf</span><br><span class="line">LANG=<span class="string">&quot;en_US.UTF-8&quot;</span></span><br></pre></td></tr></table></figure><h3 id="å®‰è£…-leapp"><a href="#å®‰è£…-leapp" class="headerlink" title="å®‰è£… leapp"></a>å®‰è£… leapp</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum update &amp;&amp; reboot</span><br><span class="line">yum install leapp leapp-repository</span><br></pre></td></tr></table></figure><h3 id="Leapp-å®ç”¨ç¨‹åºæ‰€éœ€çš„æ•°æ®"><a href="#Leapp-å®ç”¨ç¨‹åºæ‰€éœ€çš„æ•°æ®" class="headerlink" title="Leapp å®ç”¨ç¨‹åºæ‰€éœ€çš„æ•°æ®"></a>Leapp å®ç”¨ç¨‹åºæ‰€éœ€çš„æ•°æ®</h3><blockquote><p>æ•°æ®æ¥è‡ªäº<a href="https://access.redhat.com/articles/3664871">https://access.redhat.com/articles/3664871</a></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -xzf leapp-data14.tar.gz -C /etc/leapp/files &amp;&amp; <span class="built_in">rm</span> leapp-data14.tar.gz</span><br></pre></td></tr></table></figure><h3 id="å‡†å¤‡å‡çº§ï¼Œæ£€æŸ¥é—®é¢˜"><a href="#å‡†å¤‡å‡çº§ï¼Œæ£€æŸ¥é—®é¢˜" class="headerlink" title="å‡†å¤‡å‡çº§ï¼Œæ£€æŸ¥é—®é¢˜"></a>å‡†å¤‡å‡çº§ï¼Œæ£€æŸ¥é—®é¢˜</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">leapp preupgrade</span><br></pre></td></tr></table></figure><h3 id="åˆ›å»ºåº”ç­”æ–‡ä»¶ï¼Œåšå‡ºå“åº”"><a href="#åˆ›å»ºåº”ç­”æ–‡ä»¶ï¼Œåšå‡ºå“åº”" class="headerlink" title="åˆ›å»ºåº”ç­”æ–‡ä»¶ï¼Œåšå‡ºå“åº”"></a>åˆ›å»ºåº”ç­”æ–‡ä»¶ï¼Œåšå‡ºå“åº”</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">leapp answer --section remove_pam_pkcs11_module_check.confirm=True</span><br></pre></td></tr></table></figure><p>æˆ–è€…ä¿®æ”¹ <code>/var/log/leapp/answerfile</code></p><h3 id="å¼€å§‹å‡çº§ï¼Œåœ¨ç»ˆç«¯æ¥å‡çº§ï¼Œä¸è¦è¿œç¨‹è¿æ¥"><a href="#å¼€å§‹å‡çº§ï¼Œåœ¨ç»ˆç«¯æ¥å‡çº§ï¼Œä¸è¦è¿œç¨‹è¿æ¥" class="headerlink" title="å¼€å§‹å‡çº§ï¼Œåœ¨ç»ˆç«¯æ¥å‡çº§ï¼Œä¸è¦è¿œç¨‹è¿æ¥"></a>å¼€å§‹å‡çº§ï¼Œåœ¨ç»ˆç«¯æ¥å‡çº§ï¼Œä¸è¦è¿œç¨‹è¿æ¥</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">leapp upgrade</span><br></pre></td></tr></table></figure><h3 id="å‡çº§å®Œæˆæ¸…ç†ä»“åº“"><a href="#å‡çº§å®Œæˆæ¸…ç†ä»“åº“" class="headerlink" title="å‡çº§å®Œæˆæ¸…ç†ä»“åº“"></a>å‡çº§å®Œæˆæ¸…ç†ä»“åº“</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum remove epel-release puppet5-release ...</span><br><span class="line">/etc/yum.repos.d/</span><br></pre></td></tr></table></figure><h3 id="æ‰“å¼€-selinux"><a href="#æ‰“å¼€-selinux" class="headerlink" title="æ‰“å¼€ selinux"></a>æ‰“å¼€ selinux</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/selinux/config</span><br></pre></td></tr></table></figure><h3 id="å‡çº§å®Œæ£€æŸ¥"><a href="#å‡çº§å®Œæ£€æŸ¥" class="headerlink" title="å‡çº§å®Œæ£€æŸ¥"></a>å‡çº§å®Œæ£€æŸ¥</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">subscription-manager list --installed</span><br><span class="line"><span class="built_in">uname</span> -r</span><br><span class="line">subscription-manager release</span><br><span class="line"><span class="built_in">cat</span> /etc/redhat-release</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> CentOS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å†…æ ¸çº§è´Ÿè½½å‡è¡¡ LVS DRæ¨¡å¼ éƒ¨ç½²è®°å½•</title>
      <link href="/posts/5fdc91d7/"/>
      <url>/posts/5fdc91d7/</url>
      
        <content type="html"><![CDATA[<blockquote><p>DR æ¨¡å¼ï¼ŒDirector å’Œ realserver éƒ½åœ¨ä¸€ä¸ªå†…ç½‘é‡Œé¢ï¼Œä»–ä»¬éƒ½ç»‘å®šä¸ŠåŒä¸€ä¸ª VIP, åŸç†æ˜¯é€šè¿‡ Director Server ä¿®æ”¹æ•°æ®åŒ…çš„ MAC åœ°å€ï¼Œ æ‰€ä»¥å¾—è®© realserver ä¸å“åº” arpï¼Œä¸ç„¶è‚¯å®šä¼šé€ æˆå†…ç½‘ IP å†²çª</p></blockquote><p>è§„åˆ’ï¼š</p><table><thead><tr><th>æœºå™¨</th><th>IP</th></tr></thead><tbody><tr><td>VIP</td><td>10.0.0.8</td></tr><tr><td>director</td><td>10.0.0.41</td></tr><tr><td>realserver1</td><td>10.0.0.42</td></tr><tr><td>realserver2</td><td>10.0.0.43</td></tr><tr><td>ç½‘å¡ interface</td><td>eth0</td></tr></tbody></table><h2 id="RealServer-è®¾ç½®"><a href="#RealServer-è®¾ç½®" class="headerlink" title="RealServer è®¾ç½®"></a>RealServer è®¾ç½®</h2><h3 id="åˆ›å»ºè™šæ‹Ÿç½‘å¡"><a href="#åˆ›å»ºè™šæ‹Ÿç½‘å¡" class="headerlink" title="åˆ›å»ºè™šæ‹Ÿç½‘å¡"></a>åˆ›å»ºè™šæ‹Ÿç½‘å¡</h3><p>ä¸ªäººä¹ æƒ¯ï¼Œå¯é€‰ï¼Œå¯ä»¥ç»‘å®šåœ¨ä»»ä½•ç½‘å¡ä¸Šé¢</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip <span class="built_in">link</span> add ipvs0 <span class="built_in">type</span> dummy</span><br></pre></td></tr></table></figure><h3 id="é…ç½®ä¸å“åº”-ARP-è¯·æ±‚"><a href="#é…ç½®ä¸å“åº”-ARP-è¯·æ±‚" class="headerlink" title="é…ç½®ä¸å“åº” ARP è¯·æ±‚"></a>é…ç½®ä¸å“åº” ARP è¯·æ±‚</h3><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">æ–¹æ³•1: è°ƒæ•´å†…æ ¸å‚æ•°</button><button type="button" class="tab">æ–¹æ³•2: é‡‡ç”¨arptables</button></div><div class="tab-contents"><div class="tab-item-content active"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸å“åº”ARPè¯·æ±‚, ä¿®æ”¹å†…æ ¸å‚æ•°</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;1&quot;</span> &gt; /proc/sys/net/ipv4/conf/ipvs0/arp_ignore</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;1&quot;</span> &gt; /proc/sys/net/ipv4/conf/all/arp_ignore</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;2&quot;</span> &gt; /proc/sys/net/ipv4/conf/ipvs0/arp_announce</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;2&quot;</span> &gt; /proc/sys/net/ipv4/conf/all/arp_announce</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">arptables -A IN -d &lt;virtual_ip&gt; -j DROP</span><br><span class="line">arptables-A OUT -s &lt;virtual_ip&gt; -j mangle --mangle-ip-s &lt;real_ip&gt;</span><br></pre></td></tr></table></figure><blockquote><p>ä¸Šé¢çš„æ„æ€æ˜¯ï¼šè¿›æ¥çš„ ARPï¼Œå¦‚æœç›®çš„ IP æ˜¯ VIP çš„ï¼Œä¸¢å¼ƒ; å‘å‡ºå»çš„ ARP åŒ…ï¼Œå¦‚æœæº IP æ˜¯ VIP çš„ï¼Œæ”¹æˆ realserver çš„ IPã€‚ä¸å†…æ ¸ ARP å‚æ•° arp_ignore&#x3D;1,arp_announce&#x3D;2 çš„ä½œç”¨æ˜¯ä¸€æ ·çš„ã€‚</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Disable arp requests on virtual_ip</span></span><br><span class="line">arptables -I INPUT -j DROP -d 10.0.0.8</span><br><span class="line">arptables -I OUTPUT -j mangle -s 10.0.0.8 --mangle-ip-s 10.0.0.42</span><br></pre></td></tr></table></figure><blockquote><p>ç‰¹åˆ«æ³¨æ„ï¼šarptables åªæ˜¯è¿‡è™‘äº† ARP å¹¿æ’­åŒ…ï¼Œå¦‚æœæ‰‹åŠ¨ç»‘å®š IP å’Œ MACï¼Œæˆ–è€…å­˜åœ¨æ­£ç¡®çš„ MAC ç¼“å­˜ï¼Œä¹Ÿæ˜¯å¯ä»¥å’Œä¸»æœºé€šä¿¡çš„</p></blockquote></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div><h3 id="ç»‘å®š-VIP"><a href="#ç»‘å®š-VIP" class="headerlink" title="ç»‘å®š VIP"></a>ç»‘å®š VIP</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip addr add 10.0.0.8/32 dev ipvs0</span><br></pre></td></tr></table></figure><h2 id="Director-è®¾ç½®"><a href="#Director-è®¾ç½®" class="headerlink" title="Director è®¾ç½®"></a>Director è®¾ç½®</h2><h3 id="æ·»åŠ -VIP"><a href="#æ·»åŠ -VIP" class="headerlink" title="æ·»åŠ  VIP"></a>æ·»åŠ  VIP</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip address add 10.0.0.8/24 dev eth0</span><br></pre></td></tr></table></figure><h3 id="é…ç½®-ipvs-è§„åˆ™"><a href="#é…ç½®-ipvs-è§„åˆ™" class="headerlink" title="é…ç½® ipvs è§„åˆ™"></a>é…ç½® ipvs è§„åˆ™</h3><p>rr æ˜¯è½®è¯¢</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ipvsadm -A -t 10.0.0.8:80 -s rr</span><br><span class="line">ipvsadm -a -t 10.0.0.8:80 -r 10.0.0.42:80 -g</span><br><span class="line">ipvsadm -a -t 10.0.0.8:80 -r 10.0.0.43:80 -g</span><br><span class="line">ipvsadm</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨è„šæœ¬å®Œæˆä»¥ä¸Šæ“ä½œ"><a href="#ä½¿ç”¨è„šæœ¬å®Œæˆä»¥ä¸Šæ“ä½œ" class="headerlink" title="ä½¿ç”¨è„šæœ¬å®Œæˆä»¥ä¸Šæ“ä½œ"></a>ä½¿ç”¨è„šæœ¬å®Œæˆä»¥ä¸Šæ“ä½œ</h2><h3 id="start-lvs-realserver-sh"><a href="#start-lvs-realserver-sh" class="headerlink" title="start_lvs_realserver.sh"></a>start_lvs_realserver.sh</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">VIP=10.0.0.8</span><br><span class="line">REALIP=10.0.0.42</span><br><span class="line"></span><br><span class="line"><span class="comment"># Disable arp requests on virtual_ip</span></span><br><span class="line">arptables -I INPUT -j DROP -d <span class="variable">$VIP</span></span><br><span class="line">arptables -I OUTPUT -j mangle -s <span class="variable">$VIP</span> --mangle-ip-s <span class="variable">$REALIP</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Add vip after arptables is initialized</span></span><br><span class="line">ip <span class="built_in">link</span> add ipvs0 <span class="built_in">type</span> dummy</span><br><span class="line">ip addr add <span class="variable">$VIP</span>/32 brd + dev ipvs0</span><br></pre></td></tr></table></figure><h3 id="stop-lvs-realserver-sh"><a href="#stop-lvs-realserver-sh" class="headerlink" title="stop_lvs_realserver.sh"></a>stop_lvs_realserver.sh</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">VIP=10.0.0.8</span><br><span class="line">REALIP=10.0.0.42</span><br><span class="line"></span><br><span class="line"><span class="comment"># stop realserver</span></span><br><span class="line">ip addr del <span class="variable">$VIP</span>/32 brd + dev ipvs0</span><br><span class="line">ip <span class="built_in">link</span> del ipvs0</span><br><span class="line">arptables -D INPUT -j DROP -d <span class="variable">$VIP</span></span><br><span class="line">arptables -D OUTPUT -j mangle -s <span class="variable">$VIP</span> --mangle-ip-s <span class="variable">$REALIP</span></span><br></pre></td></tr></table></figure><h3 id="start-lvs-directserver-sh"><a href="#start-lvs-directserver-sh" class="headerlink" title="start_lvs_directserver.sh"></a>start_lvs_directserver.sh</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ip addr add 10.0.0.8 dev eth0</span><br><span class="line">ipvsadm -A -t 10.0.0.8:80 -s rr</span><br><span class="line">ipvsadm -a -t 10.0.0.8:80 -r 10.0.0.42:80 -g</span><br><span class="line">ipvsadm -a -t 10.0.0.8:80 -r 10.0.0.43:80 -g</span><br></pre></td></tr></table></figure><h3 id="stop-lvs-directserver-sh"><a href="#stop-lvs-directserver-sh" class="headerlink" title="stop_lvs_directserver.sh"></a>stop_lvs_directserver.sh</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ip addr del 10.0.0.8 dev eth0</span><br><span class="line">ipvsadm -C</span><br></pre></td></tr></table></figure><h2 id="é«˜å¯ç”¨æ–¹æ¡ˆ"><a href="#é«˜å¯ç”¨æ–¹æ¡ˆ" class="headerlink" title="é«˜å¯ç”¨æ–¹æ¡ˆ"></a>é«˜å¯ç”¨æ–¹æ¡ˆ</h2><p><a href="/posts/675d47a9">ä½¿ç”¨keepalivedå®ŒæˆLVSé«˜å¯ç”¨</a></p>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
            <tag> Network </tag>
            
            <tag> LoadBalance </tag>
            
            <tag> keepalived </tag>
            
            <tag> HA </tag>
            
            <tag> lvs </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ShellæŒ‡å®šåˆ†éš”ç¬¦</title>
      <link href="/posts/e93bd813/"/>
      <url>/posts/e93bd813/</url>
      
        <content type="html"><![CDATA[<blockquote><p>ä¸ºä»€ä¹ˆè¦æŒ‡å®šæ¢è¡Œç¬¦ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸ªä¾‹å­</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">data=<span class="string">&quot;</span></span><br><span class="line"><span class="string">a b c</span></span><br><span class="line"><span class="string">d e f</span></span><br><span class="line"><span class="string">&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="variable">$data</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$i</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><p>è¾“å‡ºçš„ç»“æœæ˜¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">a</span><br><span class="line">b</span><br><span class="line">c</span><br><span class="line">d</span><br><span class="line">e</span><br><span class="line">f</span><br></pre></td></tr></table></figure><p>å› ä¸ºç³»ç»Ÿé»˜è®¤æŠŠç©ºæ ¼å’Œæ¢è¡Œéƒ½å½“ä½œäº†åˆ†éš”ç¬¦ã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨æŒ‡å®šåˆ†éš”ç¬¦ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">data=<span class="string">&quot;</span></span><br><span class="line"><span class="string">a b c</span></span><br><span class="line"><span class="string">d e f</span></span><br><span class="line"><span class="string">&quot;</span></span><br><span class="line"></span><br><span class="line">IFS=$<span class="string">&#x27;\n&#x27;</span>        <span class="comment"># æŒ‡å®šåˆ†éš”ç¬¦ä¸ºæ¢è¡Œ</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="variable">$data</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$i</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·æ‰“å°å‡ºæ¥çš„å°±æ˜¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a b c</span><br><span class="line">d e f</span><br></pre></td></tr></table></figure><p>å†çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">a=<span class="string">&quot;aa,bb,cc,dd,ee&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="variable">$a</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$i</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><p>è¾“å‡ºä¸ºï¼š<br><code>aa,bb,cc,dd,ee</code></p><p>æˆ‘ä»¬æƒ³è¦çš„è¾“å‡ºç»“æœå¯èƒ½æ˜¯è¿™æ ·</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">aa</span><br><span class="line">bb</span><br><span class="line">cc</span><br><span class="line"><span class="built_in">dd</span></span><br><span class="line">ee</span><br></pre></td></tr></table></figure><p>å¯ä»¥ä¿®æ”¹æˆè¿™æ ·:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">oldIFS=<span class="variable">$IFS</span>        <span class="comment">#å®šä¹‰å˜é‡ä¸ºé»˜è®¤çš„IFS</span></span><br><span class="line">IFS=,              <span class="comment">#è®¾ç½®é»˜è®¤çš„åˆ†éš”ç¬¦</span></span><br><span class="line">a=<span class="string">&quot;aa,bb,cc,dd,ee&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="variable">$a</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$i</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">IFS=<span class="variable">$oldIFS</span>        <span class="comment">#è¿˜åŸé»˜è®¤å€¼</span></span><br></pre></td></tr></table></figure><blockquote><p>è¿˜åŸé»˜è®¤å€¼è¿™ä¸€æ­¥ä¹Ÿå¯ä»¥ä¸æ“ä½œï¼Œå…·ä½“çœ‹è¿™ä¸ªæ“ä½œä¼šä¸ä¼šå½±å“åˆ°åé¢çš„ shell å‘½ä»¤ã€‚</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Script </tag>
            
            <tag> Shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Github Actionsè‡ªåŠ¨å‘å¸ƒåšå®¢</title>
      <link href="/posts/3debc8f2/"/>
      <url>/posts/3debc8f2/</url>
      
        <content type="html"><![CDATA[<blockquote><p>å¶ç„¶å‘ç° github actions å¯ä»¥æ‰§è¡Œä¸€äº›å‘½ä»¤ï¼Œè¿™ä¸‹å¯ä»¥æŠŠæˆ‘çš„ crontab åœæ‰äº†ï¼Œä¹Ÿä¸ç”¨å ç”¨ä¸€å°æœºå™¨ä¸“é—¨ç”¨æ¥å‘å¸ƒåšå®¢äº†ï¼Œå¹¶ä¸”å®Œå…¨å…è´¹ï¼ï¼</p></blockquote><blockquote><p>é¦–å…ˆæˆ‘çš„ GitHub pages å’Œåšå®¢åŸå§‹æ–‡ä»¶æ˜¯åˆ†ä¸ºä¸¤ä¸ªä»“åº“çš„ï¼Œåœ¨ GitHub Pages ä»“åº“é‡Œæ·»åŠ äº†ä¸€ä¸ª Actions ç”¨æ¥é’‰é’‰å‘é€šçŸ¥ï¼š</p></blockquote><h2 id="GitHub-ä»“åº“é…ç½®-Secret"><a href="#GitHub-ä»“åº“é…ç½®-Secret" class="headerlink" title="GitHub ä»“åº“é…ç½® Secret"></a>GitHub ä»“åº“é…ç½® Secret</h2><p>éœ€è¦å…ˆå°†ç¯å¢ƒå˜é‡é…ç½®åœ¨ Settings â€“&gt; Secrets and Variables â€“&gt; Actions é‡Œé¢</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202304111133670.png" alt="github Acrions ç¯å¢ƒå˜é‡é…ç½®"></p><p>é…ç½®åï¼Œå¯ä»¥åœ¨ actions é‡Œé¢é€šè¿‡ <code>$&#123;&#123; secrets.dingtalk_secret &#125;&#125;</code> è°ƒç”¨åˆ°å¯¹åº”çš„æ•°æ®</p><h2 id="é’ˆå¯¹-Hexo-åšå®¢çš„æ„å»º"><a href="#é’ˆå¯¹-Hexo-åšå®¢çš„æ„å»º" class="headerlink" title="é’ˆå¯¹ Hexo åšå®¢çš„æ„å»º"></a>é’ˆå¯¹ Hexo åšå®¢çš„æ„å»º</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">Deploy</span> <span class="string">GitHub</span> <span class="string">Pages</span></span><br><span class="line"></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="attr">push:</span></span><br><span class="line">    <span class="attr">branches:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">master</span></span><br><span class="line"></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">deploy_github_pages:</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">uses:</span> <span class="string">actions/checkout@v2</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">submodules:</span> <span class="string">recursive</span></span><br><span class="line">          <span class="attr">fetch-depth:</span> <span class="number">0</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Use</span> <span class="string">Node.js</span> <span class="number">16.</span><span class="string">x</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/setup-node@v1</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">node-version:</span> <span class="number">16.</span><span class="string">x</span></span><br><span class="line"></span><br><span class="line">      <span class="comment"># ä¸ºäº†è§£å†³æ›´æ–°æ—¥æœŸé—®é¢˜,ä»gitè¯»å–æäº¤æ—¶é—´,ç„¶åæ‰¹é‡touchä¸€ä¸‹</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">build_hexo</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">          git ls-files -z | while read -d &#x27;&#x27; path; do touch -d &quot;$(git log -1 --format=&quot;@%ct&quot; &quot;$path&quot;)&quot; &quot;$path&quot;; done</span></span><br><span class="line"><span class="string">          npm install</span></span><br><span class="line"><span class="string">          npx hexo clean</span></span><br><span class="line"><span class="string">          npx hexo g</span></span><br><span class="line"><span class="string"></span>          </span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Deploy</span> <span class="string">ğŸš€</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">JamesIves/github-pages-deploy-action@4.1.5</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">BRANCH:</span> <span class="string">main</span> <span class="comment"># The branch the action should deploy to.</span></span><br><span class="line">          <span class="attr">FOLDER:</span> <span class="string">public</span> <span class="comment"># The folder the action should deploy.</span></span><br><span class="line">          <span class="attr">ssh-key:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.DEPLOY_SSH_KEY</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">repository-name:</span> <span class="string">iuxt/iuxt.github.io</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="é’ˆå¯¹äº-Hugo-åšå®¢çš„æ„å»º"><a href="#é’ˆå¯¹äº-Hugo-åšå®¢çš„æ„å»º" class="headerlink" title="é’ˆå¯¹äº Hugo åšå®¢çš„æ„å»º"></a>é’ˆå¯¹äº Hugo åšå®¢çš„æ„å»º</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">Deploy</span> <span class="string">GitHub</span> <span class="string">Pages</span></span><br><span class="line"></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="attr">push:</span></span><br><span class="line">    <span class="attr">branches:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">master</span>                                                  <span class="comment"># masteræ›´æ–°åæ‰§è¡Œ</span></span><br><span class="line">  <span class="attr">schedule:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">cron:</span>  <span class="string">&#x27;0 0 * * *&#x27;</span>                                        <span class="comment"># æ¯å¤©0ç‚¹è‡ªåŠ¨æ‰§è¡Œ</span></span><br><span class="line"></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">deploy_github_pages:</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">uses:</span> <span class="string">actions/checkout@v2</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">submodules:</span> <span class="string">recursive</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Setup</span> <span class="string">Hugo</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">peaceiris/actions-hugo@v2</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">hugo-version:</span> <span class="string">&#x27;0.80.0&#x27;</span></span><br><span class="line">          <span class="attr">extended:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Build</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">          git config core.quotePath false</span></span><br><span class="line"><span class="string">          hugo</span></span><br><span class="line"><span class="string"></span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Deploy</span> <span class="string">ğŸš€</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">JamesIves/github-pages-deploy-action@4.1.4</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">BRANCH:</span> <span class="string">main</span>                                          <span class="comment"># ä½ è¦å‘å¸ƒåˆ°å“ªä¸ªåˆ†æ”¯ï¼ˆGitHub Pagesçš„ä»“åº“åˆ†æ”¯ï¼Œä¸æ˜¯ä½ hugoä»£ç çš„åˆ†æ”¯ï¼‰</span></span><br><span class="line">          <span class="attr">FOLDER:</span> <span class="string">public</span>                                        <span class="comment"># å‘å¸ƒçš„æ–‡ä»¶å¤¹ï¼Œé»˜è®¤å°±æ˜¯public</span></span><br><span class="line">          <span class="attr">ssh-key:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.DEPLOY_SSH_KEY</span> <span class="string">&#125;&#125;</span>                <span class="comment"># æˆ‘å‘å¸ƒåˆ°ä¸åŒçš„ä»“åº“ï¼Œéœ€è¦ç”¨åˆ°ç§é’¥ï¼Œç§é’¥ç”¨GitHub Secretæ¥ç®¡ç†ï¼Œå‘å¸ƒåŒä»“åº“å¯ä»¥å»æ‰è¿™ä¸ªé…ç½®</span></span><br><span class="line">          <span class="attr">repository-name:</span> <span class="string">iuxt/iuxt.github.io</span>                  <span class="comment"># å‘å¸ƒåˆ°åŒä»“åº“çš„ä¸åŒåˆ†æ”¯è¦å»æ‰è¿™ä¸ªé…ç½®</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Use</span> <span class="string">Node.js</span> <span class="number">10.</span><span class="string">x</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/setup-node@v1</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">node-version:</span> <span class="number">10.</span><span class="string">x</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">algolia</span> <span class="string">upload</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">          npm install</span></span><br><span class="line"><span class="string">          npm run algolia                                       # ä½¿ç”¨algoliaçš„ï¼Œå¯ä»¥åŒæ—¶æ¨é€åˆ°algolia</span></span><br><span class="line"><span class="string"></span>        <span class="attr">env:</span></span><br><span class="line">          <span class="attr">ALGOLIA_APP_ID:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.ALGOLIA_APP_ID</span> <span class="string">&#125;&#125;</span>         <span class="comment"># ä¸€æ ·çš„ï¼Œéœ€è¦åœ¨GitHub Secreté‡Œé¢åˆ›å»ºé”®å€¼å¯¹ã€‚</span></span><br><span class="line">          <span class="attr">ALGOLIA_INDEX_NAME:</span> <span class="string">blog</span></span><br><span class="line">          <span class="attr">ALGOLIA_INDEX_FILE:</span> <span class="string">public/index.json</span></span><br><span class="line">          <span class="attr">ALGOLIA_ADMIN_KEY:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.ALGOLIA_ADMIN_KEY</span> <span class="string">&#125;&#125;</span></span><br></pre></td></tr></table></figure><h2 id="æ¨é€åˆ°ç™¾åº¦ï¼ŒåŠ å¿«æ”¶å½•"><a href="#æ¨é€åˆ°ç™¾åº¦ï¼ŒåŠ å¿«æ”¶å½•" class="headerlink" title="æ¨é€åˆ°ç™¾åº¦ï¼ŒåŠ å¿«æ”¶å½•"></a>æ¨é€åˆ°ç™¾åº¦ï¼ŒåŠ å¿«æ”¶å½•</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">Baidu</span> <span class="string">push</span></span><br><span class="line"></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="attr">push:</span></span><br><span class="line">    <span class="attr">branches:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">master</span></span><br><span class="line">  <span class="attr">schedule:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">cron:</span>  <span class="string">&#x27;0 0 * * *&#x27;</span>                            <span class="comment"># ä½¿ç”¨crontabå®šæ—¶æ‰§è¡Œï¼Œ0ç‚¹å®é™…æ‰§è¡Œæ—¶é—´æ˜¯9ç‚¹ï¼Œå¯èƒ½æ˜¯æ—¶åŒºé—®é¢˜</span></span><br><span class="line"></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">baidu-push:</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">uses:</span> <span class="string">actions/checkout@v2</span>                   <span class="comment"># æ‹‰å–ä»£ç ï¼Œå¹¶æ‹‰å–git submodule</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">submodules:</span> <span class="string">recursive</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Setup</span> <span class="string">Hugo</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">peaceiris/actions-hugo@v2</span>             <span class="comment"># hugoç¯å¢ƒï¼Œç”¨çš„æ˜¯åˆ«äººå†™å¥½çš„actions</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">hugo-version:</span> <span class="string">&#x27;0.80.0&#x27;</span></span><br><span class="line">          <span class="attr">extended:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Build</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">          git config core.quotePath false</span></span><br><span class="line"><span class="string">          hugo                                      # ä½¿ç”¨hugoå‘½ä»¤ç”Ÿæˆé™æ€æ–‡ä»¶</span></span><br><span class="line"><span class="string"></span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">requests</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">pip</span> <span class="string">install</span> <span class="string">requests</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Push</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">          python &lt;&lt;END</span></span><br><span class="line"><span class="string">          import requests</span></span><br><span class="line"><span class="string">          import re</span></span><br><span class="line"><span class="string">          with open(&#x27;public/sitemap.xml&#x27;, &#x27;r&#x27;) as sitemap:</span></span><br><span class="line"><span class="string">            pattern = re.compile(r&#x27;(?&lt;=&lt;loc&gt;).+?(?=&lt;/loc&gt;)&#x27;)</span></span><br><span class="line"><span class="string">            result = pattern.findall(sitemap.read())[:9]</span></span><br><span class="line"><span class="string">            req = requests.post(&#x27;http://data.zz.baidu.com/urls?site=https://zahui.fan&amp;token=$&#123;&#123; secrets.BAIDU_PUSH_TOKEN &#125;&#125;&#x27;, &#x27;\n&#x27;.join(result))</span></span><br><span class="line"><span class="string">            print(req.text)</span></span><br><span class="line"><span class="string">          END</span></span><br></pre></td></tr></table></figure><p>æ¨é€åˆ°ç™¾åº¦æœ‰å¯èƒ½ä¼šå¤±è´¥ï¼Œ éœ€è¦å‡å°‘æ¨é€çš„æ•°é‡ï¼Œ å¯¹äºæˆ‘æ¥è¯´ï¼Œæ¨é€ 9 æ¡ä¸ä¼šæŠ¥é”™ã€‚</p><h2 id="å‘é€é’‰é’‰é€šçŸ¥"><a href="#å‘é€é’‰é’‰é€šçŸ¥" class="headerlink" title="å‘é€é’‰é’‰é€šçŸ¥"></a>å‘é€é’‰é’‰é€šçŸ¥</h2><blockquote><p>è¿™ä¸ªæˆ‘é…ç½®åœ¨äº†é™æ€æ–‡ä»¶æ‰€åœ¨çš„ä»“åº“ï¼Œå°±æ˜¯ hexo æ„å»ºå®Œæˆæ¨é€åˆ°çš„ä»“åº“ï¼Œæ¯å½“ä»“åº“å‘ç”Ÿäº†æ›´æ–°ï¼Œ å°±ä¼šæ¨é€ä¸€æ¡é€šçŸ¥åˆ°é’‰é’‰</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">dingtalk_notify</span></span><br><span class="line"></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="attr">push:</span>                                 <span class="comment"># åœ¨æ”¶åˆ°pushçš„æ—¶å€™è§¦å‘</span></span><br><span class="line">    <span class="attr">branches:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">main</span>                            <span class="comment"># ç›‘æ§mainåˆ†æ”¯</span></span><br><span class="line"></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">dingtalk_notify:</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span>              <span class="comment"># ç”¨ubuntuç³»ç»Ÿæ¥æ‰§è¡Œ</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">dingtalk_notify</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">          python &lt;&lt;END</span></span><br><span class="line"><span class="string">          import time</span></span><br><span class="line"><span class="string">          import hmac</span></span><br><span class="line"><span class="string">          import hashlib</span></span><br><span class="line"><span class="string">          import base64</span></span><br><span class="line"><span class="string">          import urllib.parse</span></span><br><span class="line"><span class="string">          import requests</span></span><br><span class="line"><span class="string"></span></span><br><span class="line">          <span class="string">now</span> <span class="string">=</span> <span class="string">str(time.strftime(&quot;%Y-%m-%d</span> <span class="string">%H:%M:%S&quot;,</span> <span class="string">time.localtime()))</span></span><br><span class="line"></span><br><span class="line">          <span class="string">secret</span> <span class="string">=</span> <span class="string">&quot;$<span class="template-variable">&#123;&#123; secrets.dingtalk_secret &#125;&#125;</span>&quot;</span>                         <span class="comment"># è¿™é‡Œæ˜¯GitHub Secretï¼Œ éœ€è¦åœ¨ä»“åº“è®¾ç½®é‡Œåˆ›å»ºå¯¹åº”çš„é”®å€¼å¯¹</span></span><br><span class="line">          <span class="string">webhook_url</span> <span class="string">=</span> <span class="string">&quot;$<span class="template-variable">&#123;&#123; secrets.dingtalk_url &#125;&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">          <span class="comment"># æ ¹æ®æ—¶é—´æˆ³ç”Ÿæˆç­¾å</span></span><br><span class="line">          <span class="string">timestamp</span> <span class="string">=</span> <span class="string">str(round(time.time()</span> <span class="string">*</span> <span class="number">1000</span><span class="string">))</span></span><br><span class="line">          <span class="string">secret_enc</span> <span class="string">=</span> <span class="string">secret.encode(&#x27;utf-8&#x27;)</span></span><br><span class="line">          <span class="string">string_to_sign</span> <span class="string">=</span> <span class="string">&#x27;&#123;&#125;\n&#123;&#125;&#x27;</span><span class="string">.format(timestamp,</span> <span class="string">secret)</span></span><br><span class="line">          <span class="string">string_to_sign_enc</span> <span class="string">=</span> <span class="string">string_to_sign.encode(&#x27;utf-8&#x27;)</span></span><br><span class="line">          <span class="string">hmac_code</span> <span class="string">=</span> <span class="string">hmac.new(secret_enc,</span> <span class="string">string_to_sign_enc,</span> <span class="string">digestmod=hashlib.sha256).digest()</span></span><br><span class="line">          <span class="string">sign</span> <span class="string">=</span> <span class="string">urllib.parse.quote_plus(base64.b64encode(hmac_code))</span></span><br><span class="line"></span><br><span class="line">          <span class="comment"># è¦å‘é€çš„æ•°æ®</span></span><br><span class="line">          <span class="string">data</span> <span class="string">=</span> <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">          &#123;</span></span><br><span class="line"><span class="string">              &quot;</span><span class="string">msgtype&quot;:&quot;text&quot;,</span></span><br><span class="line">              <span class="attr">&quot;text&quot;:</span> &#123;</span><br><span class="line">                  <span class="attr">&quot;content&quot;:</span> <span class="string">&quot;%s %s&quot;</span></span><br><span class="line">              &#125;</span><br><span class="line">          <span class="string">&#125;</span></span><br><span class="line">          <span class="string">&quot;&quot;</span><span class="string">&quot; %(now, &quot;</span><span class="string">åšå®¢è‡ªåŠ¨å‘å¸ƒæˆåŠŸ&quot;)</span></span><br><span class="line"></span><br><span class="line">          <span class="comment"># urlå‚æ•°</span></span><br><span class="line">          <span class="string">params=&#123;</span></span><br><span class="line">              <span class="attr">&#x27;timestamp&#x27;:</span> <span class="string">timestamp,</span></span><br><span class="line">              <span class="attr">&#x27;sign&#x27;:</span> <span class="string">sign</span></span><br><span class="line">          <span class="string">&#125;</span></span><br><span class="line"></span><br><span class="line">          <span class="comment"># header</span></span><br><span class="line">          <span class="string">header</span> <span class="string">=</span> &#123;<span class="attr">&#x27;Content-Type&#x27;:</span> <span class="string">&#x27;application/json&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line">          <span class="comment"># postæ¶ˆæ¯å‡ºå»</span></span><br><span class="line">          <span class="string">r</span> <span class="string">=</span> <span class="string">requests.post(webhook_url,</span> <span class="string">headers=header,</span> <span class="string">params=params,</span> <span class="string">data=data.encode(&#x27;utf-8&#x27;))</span></span><br><span class="line">          <span class="string">print(r.text)</span></span><br><span class="line">          <span class="string">END</span></span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨-Github-Actions-é€ æˆçš„æ–‡ç« æ›´æ–°æ—¶é—´é—®é¢˜"><a href="#ä½¿ç”¨-Github-Actions-é€ æˆçš„æ–‡ç« æ›´æ–°æ—¶é—´é—®é¢˜" class="headerlink" title="ä½¿ç”¨ Github Actions é€ æˆçš„æ–‡ç« æ›´æ–°æ—¶é—´é—®é¢˜"></a>ä½¿ç”¨ Github Actions é€ æˆçš„æ–‡ç« æ›´æ–°æ—¶é—´é—®é¢˜</h2><p>å‚è€ƒåŸæ–‡ï¼š<a href="https://mrseawave.github.io/blogs/articles/2021/01/07/ci-hexo-update-time/">https://mrseawave.github.io/blogs/articles/2021/01/07/ci-hexo-update-time/</a></p><p>å½“ä½¿ç”¨ Travis CI or Github Actions è‡ªåŠ¨åŒ–éƒ¨ç½²æ—¶ï¼Œå‘ç°éƒ¨ç½²æˆåŠŸåï¼Œæ‰€æœ‰æ–‡ç« çš„æ›´æ–°æ—¶é—´éƒ½å˜æˆäº†æ­¤æ¬¡æäº¤ä¿®æ”¹çš„æ—¶é—´ï¼Œä½†æœ‰äº›æ–‡ç« åœ¨ä¸Šä¸€æ¬¡æäº¤åæ˜¯æ²¡æœ‰å‘ç”Ÿè¿‡ä»»ä½•ä¿®æ”¹çš„ã€‚</p><p>è¿™æ˜¯å› ä¸º git åœ¨æ¨é€æ›´æ–°æ—¶ï¼Œå¹¶ä¸è®°å½•ä¿å­˜æ–‡ä»¶çš„è®¿é—®æ—¶é—´ã€ä¿®æ”¹æ—¶é—´ç­‰å…ƒä¿¡æ¯ï¼Œï¼ˆ<a href="https://archive.kernel.org/oldwiki/git.wiki.kernel.org/index.php/Git_FAQ.html?spm=a2c4e.10696291.0.0.671919a4OeAqE1#Why_isn.27t_Git_preserving_modification_time_on_files.3F">åŸå› åœ¨è¿™é‡Œ</a>ï¼‰æ‰€ä»¥æ¯æ¬¡ä½¿ç”¨ git æŠŠé¡¹ç›® clone ä¸‹æ¥æ—¶ï¼Œæ–‡ä»¶çš„æ—¶é—´éƒ½æ˜¯å…‹éš†æ—¶çš„æ—¶é—´ã€‚åˆå› ä¸ºå¦‚æœæ²¡æœ‰åœ¨ front-matter ä¸­æŒ‡å®š updatedï¼ŒHexo ä¼šé»˜è®¤ä½¿ç”¨æ–‡ä»¶çš„æœ€åä¿®æ”¹æ—¶é—´ä½œä¸ºæ–‡ç« çš„æ›´æ–°æ—¶é—´ï¼Œæ‰€ä»¥ä¼šå‡ºç°æ‰€æœ‰æ–‡ç« çš„æ›´æ–°æ—¶é—´éƒ½å‘ç”Ÿå˜åŒ–çš„æƒ…å†µã€‚</p><p>æ€»çš„æ¥è¯´ï¼Œä½¿ç”¨ git clone ä¸‹æ¥çš„æ–‡ä»¶çš„æ—¶é—´éƒ½ä¸æ˜¯åŸæ¥æ–‡ä»¶çš„æ—¶é—´ï¼Œè€Œè‡ªåŠ¨åŒ–éƒ¨ç½²æ¯æ¬¡éƒ½éœ€è¦ clone æºç æ‰èƒ½è¿›è¡Œåé¢çš„ç”Ÿæˆå’Œéƒ¨ç½²æ“ä½œï¼Œæ‰€ä»¥ç›®å‰å¦‚æœæƒ³æ­£ç¡®æ˜¾ç¤ºæ›´æ–°æ—¶é—´ã€‚å¯¹äº Github Actions å¯ä»¥ä½¿ç”¨å‘½ä»¤åœ¨æ„å»ºä¹‹å‰è¿›è¡Œå¤„ç†</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">deploy_gh_pages:</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Restore</span> <span class="string">file</span> <span class="string">modification</span> <span class="string">time</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line">          <span class="string">git</span> <span class="string">ls-files</span> <span class="string">-z</span> <span class="string">|</span> <span class="string">while</span> <span class="string">read</span> <span class="string">-d</span> <span class="string">&#x27;&#x27;</span> <span class="string">path;</span> <span class="string">do</span> <span class="string">touch</span> <span class="string">-d</span> <span class="string">&quot;$(git log -1 --format=&quot;</span><span class="string">@%ct&quot;</span> <span class="string">&quot;$path&quot;</span><span class="string">)&quot;</span> <span class="string">&quot;$path&quot;</span><span class="string">;</span> <span class="string">done</span></span><br></pre></td></tr></table></figure><p>å¦‚æœ git å‘½ä»¤ä¸å¥½ç”¨ï¼Œ ä¹Ÿå¯ä»¥ä½¿ç”¨ find å‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find <span class="built_in">source</span>/_posts -name <span class="string">&#x27;*.md&#x27;</span> | <span class="keyword">while</span> <span class="built_in">read</span> file; <span class="keyword">do</span> <span class="built_in">touch</span> -d <span class="string">&quot;<span class="subst">$(git log -1 --format=<span class="string">&quot;@%ct&quot;</span> <span class="string">&quot;<span class="variable">$file</span>&quot;</span>)</span>&quot;</span> <span class="string">&quot;<span class="variable">$file</span>&quot;</span>; <span class="keyword">done</span></span><br></pre></td></tr></table></figure><p>å®é™…ä¸Šï¼Œclone ä¸‹æ¥çš„æ–‡ä»¶çš„æ—¶é—´è¿˜æ˜¯å…‹éš†æ—¶çš„æ—¶é—´ï¼Œç„¶åé€šè¿‡ä¸Šé¢çš„å‘½ä»¤ï¼Œå®ƒå°† clone ä¸‹æ¥çš„æ–‡ä»¶çš„æ—¶é—´æ”¹æˆäº†è¯¥æ–‡ä»¶æœ€è¿‘ä¸€æ¬¡å˜åŠ¨çš„æ¨é€æ—¶é—´ï¼ˆä¹Ÿå³æ–‡ä»¶æœ€åä¸€æ¬¡ä¿®æ”¹çš„ push æ—¶é—´ï¼‰ã€‚</p><p>æ³¨ï¼šå¦‚æœ github actions ä¸­ä½¿ç”¨ actions&#x2F;checkout@v2ï¼Œè¯·è®¾å®šå®ƒçš„å‚æ•° fetch-depth: 0ï¼Œå› ä¸º 0 è¡¨ç¤ºè·å–æ‰€æœ‰åˆ†æ”¯å’Œæ ‡ç­¾çš„æ‰€æœ‰å†å²è®°å½•ã€‚é»˜è®¤å€¼ä¸º 1</p><h2 id="æ—¶åŒºé—®é¢˜"><a href="#æ—¶åŒºé—®é¢˜" class="headerlink" title="æ—¶åŒºé—®é¢˜"></a>æ—¶åŒºé—®é¢˜</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">notify</span></span><br><span class="line"></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="attr">push:</span></span><br><span class="line">    <span class="attr">branches:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">main</span></span><br><span class="line"><span class="attr">env:</span></span><br><span class="line">  <span class="attr">TZ:</span> <span class="string">Asia/Shanghai</span></span><br><span class="line"></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">dingtalk_notify:</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">    <span class="string">.........</span></span><br></pre></td></tr></table></figure><h2 id="æ¨é€æ¡ä»¶"><a href="#æ¨é€æ¡ä»¶" class="headerlink" title="æ¨é€æ¡ä»¶"></a>æ¨é€æ¡ä»¶</h2><p>æˆ‘ä¸å¸Œæœ›ä»»ä½•æ›´æ”¹éƒ½å»æ‰§è¡Œ <code>GitHub Actions</code> æ„å»ºï¼ŒæŸ¥æ‰¾äº†æ–‡æ¡£ï¼Œ å¯ä»¥è¿™ä¹ˆé…ç½®ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="attr">push:</span></span><br><span class="line">    <span class="attr">branches:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">master</span></span><br><span class="line">    <span class="comment"># ä¸‹é¢è¿™äº›ç›®å½•å‘ç”Ÿå˜åŒ–æ‰ä¼šè§¦å‘ GitHub Actions</span></span><br><span class="line">    <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;source/_posts/å·¥å…·/**&#x27;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;source/_posts/åŸºç¡€è¿ç»´/**&#x27;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;source/_posts/ç›‘æ§/**&#x27;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;source/_posts/å¼€å‘/**&#x27;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;source/_posts/æ—¥å¿—/**&#x27;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;source/_posts/æ•°æ®åº“/**&#x27;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;source/_posts/Kubernetes/**&#x27;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;source/_posts/Windows/**&#x27;</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·é…ç½®ï¼Œåªæœ‰æ›´æ–°äº†è¿™äº›ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œæ‰ä¼šè‡ªåŠ¨æ‰§è¡Œ <code>Github Actions</code></p>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Automatic </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Windowsä¸ªäººæ–‡ä»¶å¤¹åå­—å˜è‹±æ–‡</title>
      <link href="/posts/f6f77df5/"/>
      <url>/posts/f6f77df5/</url>
      
        <content type="html"><![CDATA[<blockquote><p>æœ‰æ—¶å€™ windows ç”¨æˆ·æ–‡ä»¶å¤¹é‡Œé¢æœ‰äº›ä¼šå˜æˆè‹±æ–‡,è™½ç„¶æ²¡ä»€ä¹ˆå½±å“,ä¸è¿‡å¼ºè¿«ç—‡ä¼šä¸èˆ’æœ (æ¯”å¦‚æˆ‘)<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/3356113696516.png" alt="ç°è±¡"></p></blockquote><p>è¿™ç§æƒ…å†µæ˜¯ç”±äºæ–‡ä»¶å¤¹å†…æ²¡æœ‰ <code>desktop.ini</code> å¯¼è‡´çš„,æˆ–è€… <code>desktop.ini</code> æƒé™ä¸æ­£ç¡®</p><blockquote><p>desktop.ini æ–‡ä»¶æ˜¯ä¸€ä¸ªéšè—æ–‡ä»¶</p></blockquote><h2 id="windows10-çš„-desktop-ini-æ–‡ä»¶å†…å®¹"><a href="#windows10-çš„-desktop-ini-æ–‡ä»¶å†…å®¹" class="headerlink" title="windows10 çš„ desktop.ini æ–‡ä»¶å†…å®¹"></a>windows10 çš„ desktop.ini æ–‡ä»¶å†…å®¹</h2><p>ä¸‹è½½:</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[.ShellClassInfo]</span></span><br><span class="line"><span class="attr">LocalizedResourceName</span>=@%SystemRoot%\system32\shell32.dll,-<span class="number">21798</span></span><br><span class="line"><span class="attr">IconResource</span>=%SystemRoot%\system32\imageres.dll,-<span class="number">184</span></span><br></pre></td></tr></table></figure><p>æ¡Œé¢:</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[.ShellClassInfo]</span></span><br><span class="line"><span class="attr">LocalizedResourceName</span>=@%SystemRoot%\system32\shell32.dll,-<span class="number">21769</span></span><br><span class="line"><span class="attr">IconResource</span>=%SystemRoot%\system32\imageres.dll,-<span class="number">183</span></span><br><span class="line"><span class="section">[&#123;E8A54E83-A4A0-4C7F-B391-DF76B9DB9690&#125;]</span></span><br><span class="line"><span class="attr">AppID</span>=&#123;<span class="number">1</span>EC9B-E1972AA-E5401EC-<span class="number">9</span>BE1-<span class="number">932</span>A-EE540&#125;</span><br></pre></td></tr></table></figure><p>æ–‡æ¡£:</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[.ShellClassInfo]</span></span><br><span class="line"><span class="attr">LocalizedResourceName</span>=@%SystemRoot%\system32\shell32.dll,-<span class="number">21770</span></span><br><span class="line"><span class="attr">IconResource</span>=%SystemRoot%\system32\imageres.dll,-<span class="number">112</span></span><br><span class="line"><span class="attr">IconFile</span>=%SystemRoot%\system32\shell32.dll</span><br><span class="line"><span class="attr">IconIndex</span>=-<span class="number">235</span></span><br></pre></td></tr></table></figure><p>å›¾ç‰‡:</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[.ShellClassInfo]</span></span><br><span class="line"><span class="attr">LocalizedResourceName</span>=@%SystemRoot%\system32\shell32.dll,-<span class="number">21779</span></span><br><span class="line"><span class="attr">InfoTip</span>=@%SystemRoot%\system32\shell32.dll,-<span class="number">12688</span></span><br><span class="line"><span class="attr">IconResource</span>=%SystemRoot%\system32\imageres.dll,-<span class="number">113</span></span><br><span class="line"><span class="attr">IconFile</span>=%SystemRoot%\system32\shell32.dll</span><br><span class="line"><span class="attr">IconIndex</span>=-<span class="number">236</span></span><br></pre></td></tr></table></figure><p>è§†é¢‘:</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[.ShellClassInfo]</span></span><br><span class="line"><span class="attr">LocalizedResourceName</span>=@%SystemRoot%\system32\shell32.dll,-<span class="number">21779</span></span><br><span class="line"><span class="attr">InfoTip</span>=@%SystemRoot%\system32\shell32.dll,-<span class="number">12688</span></span><br><span class="line"><span class="attr">IconResource</span>=%SystemRoot%\system32\imageres.dll,-<span class="number">113</span></span><br><span class="line"><span class="attr">IconFile</span>=%SystemRoot%\system32\shell32.dll</span><br><span class="line"><span class="attr">IconIndex</span>=-<span class="number">236</span></span><br></pre></td></tr></table></figure><p>éŸ³ä¹:</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[.ShellClassInfo]</span></span><br><span class="line"><span class="attr">LocalizedResourceName</span>=@%SystemRoot%\system32\shell32.dll,-<span class="number">21790</span></span><br><span class="line"><span class="attr">InfoTip</span>=@%SystemRoot%\system32\shell32.dll,-<span class="number">12689</span></span><br><span class="line"><span class="attr">IconResource</span>=%SystemRoot%\system32\imageres.dll,-<span class="number">108</span></span><br><span class="line"><span class="attr">IconFile</span>=%SystemRoot%\system32\shell32.dll</span><br><span class="line"><span class="attr">IconIndex</span>=-<span class="number">237</span></span><br></pre></td></tr></table></figure><p>3D å¯¹è±¡:</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[.ShellClassInfo]</span></span><br><span class="line"><span class="attr">LocalizedResourceName</span>=@%SystemRoot%\system32\windows.storage.dll,-<span class="number">21825</span></span><br><span class="line"><span class="attr">IconResource</span>=%SystemRoot%\system32\imageres.dll,-<span class="number">198</span></span><br></pre></td></tr></table></figure><h2 id="é‡æ–°æˆæƒ"><a href="#é‡æ–°æˆæƒ" class="headerlink" title="é‡æ–°æˆæƒ"></a>é‡æ–°æˆæƒ</h2><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">attrib</span> +R &quot;<span class="variable">%UserProFile%</span>\<span class="number">3</span>D Objects&quot;</span><br><span class="line"><span class="built_in">attrib</span> +R &quot;<span class="variable">%UserProFile%</span>\Videos&quot;</span><br><span class="line"><span class="built_in">attrib</span> +R &quot;<span class="variable">%UserProFile%</span>\Pictures&quot;</span><br><span class="line"><span class="built_in">attrib</span> +R &quot;<span class="variable">%UserProFile%</span>\Documents&quot;</span><br><span class="line"><span class="built_in">attrib</span> +R &quot;<span class="variable">%UserProFile%</span>\Downloads&quot;</span><br><span class="line"><span class="built_in">attrib</span> +R &quot;<span class="variable">%UserProFile%</span>\Music&quot;</span><br><span class="line"><span class="built_in">attrib</span> +R &quot;<span class="variable">%UserProFile%</span>\Desktop&quot;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>KVMè™šæ‹Ÿæœºå¸¸ç”¨æ“ä½œè®°å½•</title>
      <link href="/posts/4926dc90/"/>
      <url>/posts/4926dc90/</url>
      
        <content type="html"><![CDATA[<h2 id="æ£€æŸ¥å‰ææ¡ä»¶"><a href="#æ£€æŸ¥å‰ææ¡ä»¶" class="headerlink" title="æ£€æŸ¥å‰ææ¡ä»¶"></a>æ£€æŸ¥å‰ææ¡ä»¶</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¦‚æœæ˜¯ Intel çš„ CPU, è¾“å‡º VMX;å¦‚æœæ˜¯ AMD çš„ CPU, è¾“å‡º SVM</span></span><br><span class="line">grep -Eoc <span class="string">&#x27;(vmx|svm)&#x27;</span> /proc/cpuinfo</span><br><span class="line"></span><br><span class="line"><span class="comment"># æˆ–è€…ä½¿ç”¨ kvm-ok å·¥å…·ç›‘æµ‹</span></span><br><span class="line">sudo apt update</span><br><span class="line">sudo apt install cpu-checker</span><br><span class="line">kvm-ok</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="å®‰è£…-kvm"><a href="#å®‰è£…-kvm" class="headerlink" title="å®‰è£… kvm"></a>å®‰è£… kvm</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install qemu-kvm libvirt-daemon-system libvirt-clients bridge-utils virtinst libvirt-daemon</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…å›¾å½¢ç®¡ç†å·¥å…·ï¼ˆå¯é€‰ï¼‰</span></span><br><span class="line"><span class="comment"># apt install virt-manager -y</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># éªŒè¯</span></span><br><span class="line">sudo systemctl is-active libvirtd</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¢åŠ ç”¨æˆ·æƒé™</span></span><br><span class="line">sudo usermod -aG libvirt <span class="variable">$USER</span></span><br><span class="line">sudo usermod -aG kvm <span class="variable">$USER</span></span><br></pre></td></tr></table></figure><h2 id="æ·»åŠ å’Œåˆ é™¤ç½‘å¡ï¼ˆè™šæ‹Ÿç¡¬ä»¶ï¼‰"><a href="#æ·»åŠ å’Œåˆ é™¤ç½‘å¡ï¼ˆè™šæ‹Ÿç¡¬ä»¶ï¼‰" class="headerlink" title="æ·»åŠ å’Œåˆ é™¤ç½‘å¡ï¼ˆè™šæ‹Ÿç¡¬ä»¶ï¼‰"></a>æ·»åŠ å’Œåˆ é™¤ç½‘å¡ï¼ˆè™šæ‹Ÿç¡¬ä»¶ï¼‰</h2><p>è¦åˆ—å‡ºè¦åœ¨ KVM è™šæ‹Ÿæœºä¸­ä½¿ç”¨çš„å¯ç”¨ç½‘ç»œï¼Œè¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">virsh net-list --all</span><br></pre></td></tr></table></figure><p>é»˜è®¤æƒ…å†µä¸‹æ˜¯ä¸æ´»è·ƒçš„ï¼Œéœ€è¦å¯åŠ¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">virsh net-start default</span><br><span class="line">virsh net-autostart default</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹ç½‘å¡åˆ—è¡¨"><a href="#æŸ¥çœ‹ç½‘å¡åˆ—è¡¨" class="headerlink" title="æŸ¥çœ‹ç½‘å¡åˆ—è¡¨"></a>æŸ¥çœ‹ç½‘å¡åˆ—è¡¨</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo virsh domiflist vm-yaohai</span><br></pre></td></tr></table></figure><h3 id="æ·»åŠ ç½‘å¡-æ¨¡å¼æ¡¥æ¥åˆ°-br0"><a href="#æ·»åŠ ç½‘å¡-æ¨¡å¼æ¡¥æ¥åˆ°-br0" class="headerlink" title="æ·»åŠ ç½‘å¡ (æ¨¡å¼æ¡¥æ¥åˆ° br0)"></a>æ·»åŠ ç½‘å¡ (æ¨¡å¼æ¡¥æ¥åˆ° br0)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo virsh attach-interface vm-yaohai --<span class="built_in">type</span> bridge --<span class="built_in">source</span> br0 --model virtio --config</span><br></pre></td></tr></table></figure><h3 id="åˆ é™¤ç½‘å¡-æŒ‡å®š-mac-åœ°å€åˆ é™¤"><a href="#åˆ é™¤ç½‘å¡-æŒ‡å®š-mac-åœ°å€åˆ é™¤" class="headerlink" title="åˆ é™¤ç½‘å¡ (æŒ‡å®š mac åœ°å€åˆ é™¤)"></a>åˆ é™¤ç½‘å¡ (æŒ‡å®š mac åœ°å€åˆ é™¤)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo virsh detach-interface vm-yaohai --<span class="built_in">type</span> bridge --mac 52:54:00:61:4c:f3 --config</span><br></pre></td></tr></table></figure><p><del>æ·»åŠ ç½‘å¡æˆ–åˆ é™¤ç½‘å¡åéœ€è¦é‡æ–°å®šä¹‰,ä¸ç„¶é‡å¯ä¼šå¤±æ•ˆ</del></p><p><del>virsh dumpxml vm-yaohai &gt; &#x2F;etc&#x2F;libvirt&#x2F;qemu&#x2F;vm-yaohai.xml</del><br><del>virsh define &#x2F;etc&#x2F;libvirt&#x2F;qemu&#x2F;vm-yaohai.xml</del></p><h2 id="kvm-é»˜è®¤ç½‘æ¡¥"><a href="#kvm-é»˜è®¤ç½‘æ¡¥" class="headerlink" title="kvm é»˜è®¤ç½‘æ¡¥"></a>kvm é»˜è®¤ç½‘æ¡¥</h2><blockquote><p>libvirt é»˜è®¤ä½¿ç”¨äº†ä¸€ä¸ªåä¸º default çš„ nat ç½‘ç»œï¼Œè¿™ä¸ªç½‘ç»œé»˜è®¤ä½¿ç”¨ virbr0 ä½œä¸ºæ¡¥æ¥æ¥å£ï¼Œä½¿ç”¨ dnsmasq æ¥ä¸ºä½¿ç”¨ nat ç½‘ç»œçš„è™šæ‹Ÿæœºæä¾› dns åŠ dhcp æœåŠ¡ï¼Œdnsmasq ç”Ÿæ•ˆåçš„é…ç½®æ–‡ä»¶ï¼š<code>/var/lib/libvirt/network/default.xml</code><br>å½“ libvirtd æœåŠ¡å¯åŠ¨çš„æ—¶å€™ï¼Œå®ƒä¼šå°†å®ƒç®¡ç†çš„è¢«æ ‡è®°ä¸º autostart çš„ network ä¸€å¹¶å¯åŠ¨èµ·æ¥ï¼Œè€Œå¯åŠ¨ network çš„æ—¶å€™å°±ä¼šè‡ªåŠ¨è°ƒç”¨ dnsmasq å¹¶èµ‹äºˆå…¶é€‚å®œçš„é…ç½®æ–‡ä»¶æ¥è¿è¡ŒæœåŠ¡ã€‚</p></blockquote><h3 id="KVM-ç½‘æ¡¥å¯åŠ¨"><a href="#KVM-ç½‘æ¡¥å¯åŠ¨" class="headerlink" title="KVM ç½‘æ¡¥å¯åŠ¨"></a>KVM ç½‘æ¡¥å¯åŠ¨</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># defaultç½‘å¡è‡ªåŠ¨å¯åŠ¨ï¼ˆvirbr0ï¼‰</span></span><br><span class="line">virsh net-autostart default</span><br><span class="line"></span><br><span class="line"><span class="comment"># defaultç½‘å¡å¯åŠ¨ï¼ˆvirbr0ï¼‰</span></span><br><span class="line">virsh net-start default</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ç½‘å¡åˆ—è¡¨</span></span><br><span class="line">virsh net-list --all</span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹ç½‘æ®µ"><a href="#ä¿®æ”¹ç½‘æ®µ" class="headerlink" title="ä¿®æ”¹ç½‘æ®µ"></a>ä¿®æ”¹ç½‘æ®µ</h3><p>ç¼–è¾‘é…ç½®æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo virsh net-edit default</span><br></pre></td></tr></table></figure><p><del>é‡æ–°å®šä¹‰</del></p><p><del>&#96;&#96;&#96;bash</del><br><del>sudo virsh net-define &#x2F;etc&#x2F;libvirt&#x2F;qemu&#x2F;networks&#x2F;default.xml</del><br><del>&#96;&#96;&#96;</del></p><p>é‡æ–°å¯åŠ¨ç½‘å¡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo virsh net-destroy default</span><br><span class="line">sudo virsh net-start default</span><br></pre></td></tr></table></figure><h2 id="virsh-å¸¸ç”¨å‘½ä»¤"><a href="#virsh-å¸¸ç”¨å‘½ä»¤" class="headerlink" title="virsh å¸¸ç”¨å‘½ä»¤"></a>virsh å¸¸ç”¨å‘½ä»¤</h2><h3 id="æŸ¥çœ‹è™šæ‹Ÿæœº"><a href="#æŸ¥çœ‹è™šæ‹Ÿæœº" class="headerlink" title="æŸ¥çœ‹è™šæ‹Ÿæœº"></a>æŸ¥çœ‹è™šæ‹Ÿæœº</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">virsh list --all</span><br></pre></td></tr></table></figure><h3 id="é”€æ¯è™šæ‹Ÿæœº"><a href="#é”€æ¯è™šæ‹Ÿæœº" class="headerlink" title="é”€æ¯è™šæ‹Ÿæœº"></a>é”€æ¯è™šæ‹Ÿæœº</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">virsh destroy debian11</span><br><span class="line">virsh undefine debian11</span><br></pre></td></tr></table></figure><h3 id="å…³é—­è™šæ‹Ÿæœº"><a href="#å…³é—­è™šæ‹Ÿæœº" class="headerlink" title="å…³é—­è™šæ‹Ÿæœº"></a>å…³é—­è™šæ‹Ÿæœº</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">virsh shutdown debian11</span><br></pre></td></tr></table></figure><h3 id="åˆ›å»º-Linux-è™šæ‹Ÿæœº"><a href="#åˆ›å»º-Linux-è™šæ‹Ÿæœº" class="headerlink" title="åˆ›å»º Linux è™šæ‹Ÿæœº"></a>åˆ›å»º Linux è™šæ‹Ÿæœº</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºè™šæ‹Ÿæœºç£ç›˜</span></span><br><span class="line">qemu-img create -f qcow2 /var/lib/libvirt/images/debian11.qcow2 20G</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">virt-install \</span><br><span class="line">    --name debian11 \</span><br><span class="line">    --memory memory=1024,currentMemory=512 \</span><br><span class="line">    --disk path=/var/lib/libvirt/images/debian11.qcow2,size=20 \</span><br><span class="line">    --vcpus 1 \</span><br><span class="line">    --os-type linux \</span><br><span class="line">    --os-variant debian10 \</span><br><span class="line">    --network bridge=br0,model=virtio \</span><br><span class="line">    --graphics none \</span><br><span class="line">    --console pty,target_type=serial \</span><br><span class="line">    --location <span class="string">&#x27;http://mirrors.tencent.com/debian/dists/bullseye/main/installer-amd64/&#x27;</span> \</span><br><span class="line">    --extra-args <span class="string">&#x27;console=ttyS0,115200n8 serial&#x27;</span> \</span><br><span class="line">    --debug</span><br></pre></td></tr></table></figure><h3 id="åˆ›å»º-windows-è™šæ‹Ÿæœº"><a href="#åˆ›å»º-windows-è™šæ‹Ÿæœº" class="headerlink" title="åˆ›å»º windows è™šæ‹Ÿæœº"></a>åˆ›å»º windows è™šæ‹Ÿæœº</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">virt-install \</span><br><span class="line">    --name win10 \</span><br><span class="line">    --ram 2048 \</span><br><span class="line">    --disk path=/var/lib/libvirt/images/win10.qcow2,size=20 \</span><br><span class="line">    --vcpus 2 \</span><br><span class="line">    --os-type windows \</span><br><span class="line">    --os-variant win10 \</span><br><span class="line">    --network bridge=br0,model=virtio \</span><br><span class="line">    --graphics none \</span><br><span class="line">    --console pty,target_type=serial \</span><br><span class="line">    --cdrom /home/test/Downloads/Win10_21H1_Chinese(Simplified)_x64.iso \</span><br><span class="line">    --extra-args <span class="string">&#x27;console=ttyS0,115200n8 serial&#x27;</span></span><br></pre></td></tr></table></figure><p>å¼€å¯ vnc</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">virsh vncdisplay win10</span><br></pre></td></tr></table></figure><h3 id="å¯¼å…¥è™šæ‹Ÿæœº"><a href="#å¯¼å…¥è™šæ‹Ÿæœº" class="headerlink" title="å¯¼å…¥è™šæ‹Ÿæœº"></a>å¯¼å…¥è™šæ‹Ÿæœº</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">virt-install \</span><br><span class="line">--name debian11 \</span><br><span class="line">--ram 2048 \</span><br><span class="line">--disk path=/var/lib/libvirt/images/debian11.qcow2,size=20 \</span><br><span class="line">--vcpus 2 \</span><br><span class="line">--os-type linux \</span><br><span class="line">--os-variant debian11 \</span><br><span class="line">--network bridge=br0,model=virtio \</span><br><span class="line">--graphics none \</span><br><span class="line">--console pty,target_type=serial \</span><br><span class="line">--import</span><br></pre></td></tr></table></figure><h3 id="å¯¼å‡ºè™šæ‹Ÿæœºä¸º-qcow2"><a href="#å¯¼å‡ºè™šæ‹Ÿæœºä¸º-qcow2" class="headerlink" title="å¯¼å‡ºè™šæ‹Ÿæœºä¸º qcow2"></a>å¯¼å‡ºè™šæ‹Ÿæœºä¸º qcow2</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">virt-clone --original debian11 --name debian11-clone --file /var/lib/libvirt/images/debian11-clone.qcow2</span><br></pre></td></tr></table></figure><h2 id="kickstart-è‡ªåŠ¨è£…æœº"><a href="#kickstart-è‡ªåŠ¨è£…æœº" class="headerlink" title="kickstart è‡ªåŠ¨è£…æœº"></a>kickstart è‡ªåŠ¨è£…æœº</h2><h3 id="virt-install-å‘½ä»¤"><a href="#virt-install-å‘½ä»¤" class="headerlink" title="virt-install å‘½ä»¤"></a>virt-install å‘½ä»¤</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">virt-install \</span><br><span class="line">    --hvm --virt-type kvm \</span><br><span class="line">    --accelerate \</span><br><span class="line">    --name vm-1 \</span><br><span class="line">    --os-type linux \</span><br><span class="line">    --os-variant centos-stream8 \</span><br><span class="line">    --vcpus 2 \</span><br><span class="line">    --ram 4096 \</span><br><span class="line">    --disk path=/dev/mapper/lv_name \</span><br><span class="line">    --network <span class="string">&quot;bridge:br0,model=virtio&quot;</span> \</span><br><span class="line">    --nographics \</span><br><span class="line">    --location https://mirrors.aliyun.com/centos/8-stream/BaseOS/x86_64/os/ \</span><br><span class="line">    --initrd-inject=./ks.cfg \</span><br><span class="line">    --cpu host \</span><br><span class="line">    --extra-args <span class="string">&quot;ks=file:/ks.cfg console=tty0 console=ttyS0,115200n8 net.ifnames=0 biosdevname=0&quot;</span></span><br></pre></td></tr></table></figure><blockquote><p>åé¢çš„ <code>net.ifnames=0 biosdevname=0</code> æ˜¯å†…æ ¸å‚æ•°,å°†ç½‘å¡è®¾å¤‡åå›ºå®šä¸º eth0..eth1 ç­‰<br>â€“os-type å¯ä»¥é€šè¿‡å‘½ä»¤ <code>osinfo-query os</code> è·å–</p></blockquote><h3 id="kickstart-å†…å®¹"><a href="#kickstart-å†…å®¹" class="headerlink" title="kickstart å†…å®¹"></a>kickstart å†…å®¹</h3><blockquote><p>åœ¨ç³»ç»Ÿå®‰è£…åæ¡Œé¢ä¸Šä¼šç”Ÿæˆä¸€ä»½ <code>anaconda-ks.cfg</code> è¿™ä¸ªå°±æ˜¯å®‰è£…è¿™ä¸ªç³»ç»Ÿä½¿ç”¨çš„ kickstart é…ç½®</p></blockquote><p>å®‰è£… <code>centos8 stream</code> çš„ <code>ks.cfg</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Kickstart file automatically generated by anaconda.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#version=DEVEL</span></span><br><span class="line">install</span><br><span class="line">url --url=<span class="string">&quot;https://mirrors.aliyun.com/centos/8-stream/BaseOS/x86_64/os/&quot;</span></span><br><span class="line">repo --name=<span class="string">&quot;CentOS&quot;</span>  --baseurl=<span class="string">&quot;https://mirrors.aliyun.com/centos/8-stream/BaseOS/x86_64/os/&quot;</span> --cost=100</span><br><span class="line"></span><br><span class="line">lang en_US.UTF-8</span><br><span class="line">keyboard us</span><br><span class="line">network --onboot <span class="built_in">yes</span> --device eth0 --bootproto static --ip 10.0.0.120 --netmask 255.255.0.0 --gateway 10.0.0.8 --noipv6 --nameserver 10.0.0.35,10.0.0.30</span><br><span class="line">network  --hostname=vm-name</span><br><span class="line"></span><br><span class="line"><span class="comment">#default pwd is R/)ydu.?egUdT&#x27;Xl</span></span><br><span class="line">rootpw  --iscrypted $6$7ljjIEi8rX8ydAOv<span class="variable">$N4qtXrPQZIp5n5pbLf</span>/BQ/1BgE0ODHoXGJzCiWCYl006hOhZeITXl.yz0kpRvolScvAMOZ..XzPIX7iiRtV5v/</span><br><span class="line">firewall --service=ssh</span><br><span class="line">authconfig --enableshadow --passalgo=sha512</span><br><span class="line">selinux --enforcing</span><br><span class="line">timezone --utc Asia/Shanghai</span><br><span class="line">text</span><br><span class="line">bootloader --location=mbr --driveorder=vda --append=<span class="string">&quot; crashkernel=auto console=ttyS0,115200n8 net.ifnames=0 biosdevname=0&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The following is the partition information you requested</span></span><br><span class="line"><span class="comment"># Note that any partitions you deleted are not expressed</span></span><br><span class="line"><span class="comment"># here so unless you clear all partitions first, this is</span></span><br><span class="line"><span class="comment"># not guaranteed to work</span></span><br><span class="line"></span><br><span class="line">clearpart --all --drives=vda</span><br><span class="line">part /boot --fstype=xfs --size=500</span><br><span class="line">part pv.01 --grow</span><br><span class="line">volgroup vg_os pv.01</span><br><span class="line">logvol / --fstype=xfs --name=lv_root --vgname=vg_os --percent 90</span><br><span class="line"></span><br><span class="line"><span class="comment"># any invalid partition tables found on disks are initialized</span></span><br><span class="line"></span><br><span class="line">zerombr</span><br><span class="line"></span><br><span class="line">%packages</span><br><span class="line">@core</span><br><span class="line">curl</span><br><span class="line"></span><br><span class="line"><span class="comment"># install puppet agent. But it could be very slow, so you have to install it manually</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#%post</span></span><br><span class="line"><span class="comment">#(</span></span><br><span class="line"><span class="comment">#    echo &#x27;Install Puppet&#x27;</span></span><br><span class="line"><span class="comment">#    curl -OL https://yum.puppetlabs.com/puppet6-release-el-7.noarch.rpm</span></span><br><span class="line"><span class="comment">#    rpm -i puppet6-release-el-7.noarch.rpm</span></span><br><span class="line"><span class="comment">#    yum update -y</span></span><br><span class="line"><span class="comment">#    yum install -y puppet-agent</span></span><br><span class="line"><span class="comment">#) 1&gt;&gt; /root/post_install.log 2&gt;&amp;1</span></span><br><span class="line"></span><br><span class="line">%end</span><br></pre></td></tr></table></figure><h2 id="kvm-é€ä¼ ä¸»æœº-usb-è®¾å¤‡"><a href="#kvm-é€ä¼ ä¸»æœº-usb-è®¾å¤‡" class="headerlink" title="kvm é€ä¼ ä¸»æœº usb è®¾å¤‡"></a>kvm é€ä¼ ä¸»æœº usb è®¾å¤‡</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo usermod -aG kvm <span class="variable">$USER</span></span><br></pre></td></tr></table></figure><h2 id="kvm-ä¿®æ”¹é…ç½®"><a href="#kvm-ä¿®æ”¹é…ç½®" class="headerlink" title="kvm ä¿®æ”¹é…ç½®"></a>kvm ä¿®æ”¹é…ç½®</h2><h3 id="ä¿®æ”¹å†…å­˜å¤§å°"><a href="#ä¿®æ”¹å†…å­˜å¤§å°" class="headerlink" title="ä¿®æ”¹å†…å­˜å¤§å°"></a>ä¿®æ”¹å†…å­˜å¤§å°</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo virsh setmaxmem &lt;vm-name&gt; 16G --config</span><br><span class="line">sudo virsh setmem &lt;vm-name&gt; 16G --config</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> VirtualMachine </tag>
            
            <tag> é…ç½®è®°å½• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pythonè„šæœ¬æ¥å—å‚æ•°</title>
      <link href="/posts/6c12bda4/"/>
      <url>/posts/6c12bda4/</url>
      
        <content type="html"><![CDATA[<p>å®Œå–„ä¸€ä¸‹ python è„šæœ¬ï¼Œè®©å®ƒæ”¯æŒæ›´å®Œå–„çš„å‚æ•°ï¼ˆé•¿å‚æ•°ã€çŸ­å‚æ•°ï¼‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> getopt, sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">parse_args</span>(<span class="params">args=sys.argv[<span class="number">1</span>:]</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        opts, args = getopt.getopt(args, <span class="string">&quot;hvc:w:&quot;</span>, [<span class="string">&quot;help&quot;</span>, <span class="string">&quot;short&quot;</span>, <span class="string">&quot;verbose&quot;</span>, <span class="string">&quot;critical_num=&quot;</span>, <span class="string">&quot;warning_num=&quot;</span>])</span><br><span class="line">    <span class="keyword">except</span> getopt.GetoptError <span class="keyword">as</span> err:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Input parameter error&quot;</span>)</span><br><span class="line">        sys.exit()</span><br><span class="line"></span><br><span class="line">    verbose = <span class="literal">False</span></span><br><span class="line">    short = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">for</span> opt, arg <span class="keyword">in</span> opts:</span><br><span class="line">        <span class="keyword">if</span> opt <span class="keyword">in</span> (<span class="string">&quot;-h&quot;</span>, <span class="string">&quot;--help&quot;</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            useage:</span></span><br><span class="line"><span class="string">                -h --help          : print help</span></span><br><span class="line"><span class="string">                -v --verbose       : show dmesg oom kill log</span></span><br><span class="line"><span class="string">                -c --critical_num  : How many times is called a critical</span></span><br><span class="line"><span class="string">                -w --warning_num   : How many times is called a warning</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span>)</span><br><span class="line">            sys.exit()</span><br><span class="line">        <span class="keyword">elif</span> opt <span class="keyword">in</span> (<span class="string">&quot;-c&quot;</span>, <span class="string">&quot;--critical_num&quot;</span>):</span><br><span class="line">            critical_num = arg</span><br><span class="line">        <span class="keyword">elif</span> opt <span class="keyword">in</span> (<span class="string">&quot;-w&quot;</span>, <span class="string">&quot;--warning_num&quot;</span>):</span><br><span class="line">            warning_num = arg</span><br><span class="line">        <span class="keyword">elif</span> opt <span class="keyword">in</span> (<span class="string">&quot;-s&quot;</span>):</span><br><span class="line">            short = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">elif</span> opt <span class="keyword">in</span> (<span class="string">&quot;-v&quot;</span>):</span><br><span class="line">            verbose = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> warning_num, critical_num, short, verbose</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="built_in">print</span>(parse_args())</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Script </tag>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨mimikatzè¯»å–windowså¯†ç </title>
      <link href="/posts/a80bd06b/"/>
      <url>/posts/a80bd06b/</url>
      
        <content type="html"><![CDATA[<p><a href="https://github.com/gentilkiwi/mimikatz">githubåœ°å€</a></p><p>mimikatz æ˜¯ä¸€ä¸ªå°å·¥å…·ï¼Œå¯ä»¥æŸ¥çœ‹åˆ° windows åŠ è½½è¿›å†…å­˜çš„å¯†ç æ•°æ®ï¼Œé¦–å…ˆæœ€èµ·ç è¦ä½¿ç”¨ Administrator æƒé™å¯åŠ¨</p><p>ä¾æ¬¡æ‰§è¡Œï¼š</p><p>ä» administrator æå‡åˆ° system</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">privilege::<span class="title">debug</span>  </span></span><br></pre></td></tr></table></figure><p>è·å–æ˜æ–‡å¯†ç </p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">sekurlsa::<span class="title">logonpasswords</span></span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> bat </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Puppetéå†hashç”Ÿæˆarray</title>
      <link href="/posts/bee2f20f/"/>
      <url>/posts/bee2f20f/</url>
      
        <content type="html"><![CDATA[<blockquote><p>å…¬å¸çš„ nagios ç›‘æ§æ˜¯ä½¿ç”¨ puppet æ¥è¿›è¡Œè‡ªåŠ¨éƒ¨ç½²çš„ï¼Œä½†æ˜¯éœ€è¦æ‰‹åŠ¨ä¿®æ”¹ puppet é…ç½®æ‰èƒ½ç”Ÿæ•ˆï¼Œç°åœ¨çš„é—®é¢˜æ˜¯æ·»åŠ ä¸€ä¸ªæ–°æœºå™¨å¾—å…ˆåœ¨ puppet ä¸Šæ·»åŠ æœºå™¨ï¼Œç„¶åæ·»åŠ åˆ°ç›¸å¯¹åº”çš„ç»„ï¼Œæˆ‘ä»¬æƒ³èƒ½å¦è®©å®ƒè‡ªåŠ¨æ·»åŠ åˆ°å¯¹åº”çš„ç»„é‡Œé¢ã€‚</p></blockquote><p>vim nagios_server.pp</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">nagios::nagios::add_linux_remote &#123;</span><br><span class="line">        <span class="string">&#x27;guangzhou.localhost.com&#x27;</span> :</span><br><span class="line">        addr     =&gt; <span class="string">&#x27;10.0.0.9&#x27;</span>,</span><br><span class="line">        services =&gt; [&#123;<span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;check_load&#x27;</span>, <span class="string">&#x27;desc&#x27;</span> =&gt; <span class="string">&#x27;Current Load&#x27;</span>, <span class="string">&#x27;notify&#x27;</span> =&gt; <span class="number">1</span>&#125;,</span><br><span class="line">                     ...</span><br><span class="line">                     &#123;<span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;check_zombie_procs&#x27;</span>, <span class="string">&#x27;desc&#x27;</span> =&gt; <span class="string">&#x27;Zombie Processes&#x27;</span>, <span class="string">&#x27;notify&#x27;</span> =&gt; <span class="number">1</span>&#125;];</span><br><span class="line">        <span class="string">&#x27;tianjin.localhost.com&#x27;</span> :</span><br><span class="line">        addr     =&gt; <span class="string">&#x27;10.0.0.90&#x27;</span>,</span><br><span class="line">        services =&gt; [&#123;<span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;check_load&#x27;</span>, <span class="string">&#x27;desc&#x27;</span> =&gt; <span class="string">&#x27;Current Load&#x27;</span>, <span class="string">&#x27;notify&#x27;</span> =&gt; <span class="number">1</span>&#125;,</span><br><span class="line">                     ...</span><br><span class="line">                     &#123;<span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;check_zombie_procs&#x27;</span>, <span class="string">&#x27;desc&#x27;</span> =&gt; <span class="string">&#x27;Zombie Processes&#x27;</span>, <span class="string">&#x27;notify&#x27;</span> =&gt; <span class="number">1</span>&#125;];</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> &#123; <span class="string">&#x27;nagios::nagios&#x27;</span>:</span><br><span class="line">        hostgroups =&gt; [&#123;<span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;supermicro&#x27;</span>,</span><br><span class="line">                        <span class="string">&#x27;alias&#x27;</span> =&gt; <span class="string">&#x27;Supermicro Machines&#x27;</span>,</span><br><span class="line">                        <span class="string">&#x27;members&#x27;</span> =&gt; [<span class="string">&#x27;guangzhou.localhost.com&#x27;</span> ... <span class="string">&#x27;yingtan.localhost.com&#x27;</span>]&#125;,</span><br><span class="line">                       &#123;<span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;windows&#x27;</span>,</span><br><span class="line">                        <span class="string">&#x27;alias&#x27;</span> =&gt; <span class="string">&#x27;Windows Machines&#x27;</span>,</span><br><span class="line">                        <span class="string">&#x27;members&#x27;</span> =&gt; [<span class="string">&#x27;win2016-dc.localhost.com&#x27;</span> ... <span class="string">&#x27;win2016-oos8.localhost.com&#x27;</span>]&#125;,</span><br><span class="line">                       &#123;<span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;vms&#x27;</span>,</span><br><span class="line">                        <span class="string">&#x27;alias&#x27;</span> =&gt; <span class="string">&#x27;Virtual Machines&#x27;</span>,</span><br><span class="line">                        <span class="string">&#x27;members&#x27;</span> =&gt; [<span class="string">&#x27;tianjin.localhost.com&#x27;</span> ... <span class="string">&#x27;erdao.localhost.com&#x27;</span>]&#125;,</span><br><span class="line">                       &#123;<span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;edc&#x27;</span>,</span><br><span class="line">                        <span class="string">&#x27;alias&#x27;</span>  =&gt; <span class="string">&#x27;edc servers&#x27;</span>,</span><br><span class="line">                        <span class="string">&#x27;members&#x27;</span> =&gt; [<span class="string">&#x27;bjedc1.localhost.com&#x27;</span> ... <span class="string">&#x27;cdcbjedc3.localhost.com&#x27;</span>]&#125;,</span><br><span class="line">                      ]</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><blockquote><p>é€šè¿‡å¾ªç¯æ¥è°ƒç”¨ add_linux_remote æ¥åˆ›å»ºå¾ˆå¤šä¸ªé…ç½®æ–‡ä»¶ã€‚å®‰è£… nagiosï¼ˆçœç•¥ï¼‰å’Œç”Ÿæˆ hostgroup.cfg é…ç½®æ–‡ä»¶,è¿™é‡Œçš„åˆ—è¡¨æ˜¯æ‰‹åŠ¨å¡«ä¸Šå»çš„ã€‚</p></blockquote><p>nagios æ¨¡å— add_linux_remote å†…å®¹ï¼š</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">define nagios::nagios::add_linux_remote (</span><br><span class="line">    <span class="variable">$addr</span>=<span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">    <span class="variable">$port</span>=<span class="number">5666</span>,</span><br><span class="line">    <span class="variable">$check_command</span>=<span class="string">&quot;check-host-alive&quot;</span>,</span><br><span class="line">    <span class="variable">$services</span>) &#123;</span><br><span class="line">    file &#123; <span class="string">&quot;/etc/nagios/objects/$&#123;name&#125;.cfg&quot;</span>:</span><br><span class="line">        <span class="keyword">ensure</span>     =&gt; <span class="string">&#x27;present&#x27;</span>,</span><br><span class="line">        content    =&gt; template(<span class="string">&#x27;nagios/linux-host.cfg.erb&#x27;</span>),</span><br><span class="line">        owner      =&gt; <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">        group      =&gt; <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">        mode       =&gt; <span class="string">&#x27;0664&#x27;</span>,</span><br><span class="line">        <span class="keyword">require</span>    =&gt; <span class="title class_">File</span>[<span class="string">&#x27;/etc/nagios/objects&#x27;</span>],</span><br><span class="line">        notify     =&gt; <span class="title class_">Class</span>[<span class="string">&#x27;nagios::nagios::service&#x27;</span>],</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä¿®æ”¹å˜é‡ä¸º-hash"><a href="#ä¿®æ”¹å˜é‡ä¸º-hash" class="headerlink" title="ä¿®æ”¹å˜é‡ä¸º hash"></a>ä¿®æ”¹å˜é‡ä¸º hash</h2><p>ç°åœ¨ä¼ ç»™ add_linux_remote çš„å˜é‡æ˜¯å¾ˆå¤šä¸ª hashï¼Œé‡‡ç”¨å¾ªç¯çš„æ–¹å¼ï¼Œå¾—å…ˆè®©å®ƒå…ˆæˆä¸€ä¸ª hashï¼Œæ‰èƒ½æ–¹ä¾¿æˆ‘ä»¬è¿›è¡Œéå†<br>æ·»åŠ äº†ä¸€ä¸ªæ–°çš„å‚æ•° hostgroup æ¥åˆ¤æ–­åº”è¯¥æ”¾åœ¨å“ªä¸ªåˆ†ç»„ä¸‹ã€‚</p><p>vim nagios_server.pp</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">monitor_list = &#123;</span><br><span class="line">        <span class="string">&#x27;guangzhou.localhost.com&#x27;</span> =&gt; &#123;</span><br><span class="line">        addr     =&gt; <span class="string">&#x27;10.0.0.9&#x27;</span>,</span><br><span class="line">        hostgroup =&gt; <span class="string">&#x27;supermicro&#x27;</span>,</span><br><span class="line">        services =&gt; [&#123;<span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;check_load&#x27;</span>, <span class="string">&#x27;desc&#x27;</span> =&gt; <span class="string">&#x27;Current Load&#x27;</span>, <span class="string">&#x27;notify&#x27;</span> =&gt; <span class="number">1</span>&#125;,</span><br><span class="line">                     ...</span><br><span class="line">                     &#123;<span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;check_zombie_procs&#x27;</span>, <span class="string">&#x27;desc&#x27;</span> =&gt; <span class="string">&#x27;Zombie Processes&#x27;</span>, <span class="string">&#x27;notify&#x27;</span> =&gt; <span class="number">1</span>&#125;],</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&#x27;tianjin.localhost.com&#x27;</span> =&gt; &#123;</span><br><span class="line">        addr     =&gt; <span class="string">&#x27;10.0.0.90&#x27;</span>,</span><br><span class="line">        hostgroup =&gt; <span class="string">&#x27;vms&#x27;</span>,</span><br><span class="line">        services =&gt; [&#123;<span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;check_load&#x27;</span>, <span class="string">&#x27;desc&#x27;</span> =&gt; <span class="string">&#x27;Current Load&#x27;</span>, <span class="string">&#x27;notify&#x27;</span> =&gt; <span class="number">1</span>&#125;,</span><br><span class="line">                     ...</span><br><span class="line">                     &#123;<span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;check_zombie_procs&#x27;</span>, <span class="string">&#x27;desc&#x27;</span> =&gt; <span class="string">&#x27;Zombie Processes&#x27;</span>, <span class="string">&#x27;notify&#x27;</span> =&gt; <span class="number">1</span>&#125;],</span><br><span class="line">        &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨è¿™ç§æ ¼å¼æ˜¯ monitor_list æ˜¯ä¸€ä¸ªå¤§ hashï¼Œå¤§ hash é‡Œé¢æœ‰å¾ˆå¤šå° hash</p><h2 id="ä¸æ”¹å˜åŸå…ˆæ¨¡å—çš„å·¥ä½œæ–¹å¼"><a href="#ä¸æ”¹å˜åŸå…ˆæ¨¡å—çš„å·¥ä½œæ–¹å¼" class="headerlink" title="ä¸æ”¹å˜åŸå…ˆæ¨¡å—çš„å·¥ä½œæ–¹å¼"></a>ä¸æ”¹å˜åŸå…ˆæ¨¡å—çš„å·¥ä½œæ–¹å¼</h2><p>è¿™é‡Œæ‰§è¡Œ add_linux_remote æˆ–è€… add_windows_remote</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$monitor_list</span>.each |<span class="params">$key, $value</span>| &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="variable">$value</span>[<span class="string">&quot;hostgroup&quot;</span>] =~ <span class="regexp">/(supermicro|edc|vms)/</span> &#123;</span><br><span class="line">            nagios::nagios::add_linux_remote &#123; <span class="variable">$key</span>:</span><br><span class="line">            addr     =&gt; <span class="variable">$value</span>[<span class="string">&quot;addr&quot;</span>],</span><br><span class="line">            services =&gt; <span class="variable">$value</span>[<span class="string">&quot;services&quot;</span>],</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">elsif</span> <span class="variable">$value</span>[<span class="string">&quot;hostgroup&quot;</span>] =~ <span class="regexp">/windows/</span> &#123;</span><br><span class="line">            nagios::nagios::add_windows_remote &#123; <span class="variable">$key</span>:</span><br><span class="line">            addr     =&gt; <span class="variable">$value</span>[<span class="string">&quot;addr&quot;</span>],</span><br><span class="line">            services =&gt; <span class="variable">$value</span>[<span class="string">&quot;services&quot;</span>],</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ä¿®æ”¹æ·»åŠ  hostgroup çš„éƒ¨åˆ†</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> &#123; <span class="string">&#x27;nagios::nagios&#x27;</span>:</span><br><span class="line">        hostgroups =&gt; [&#123;<span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;supermicro&#x27;</span>,</span><br><span class="line">                        <span class="string">&#x27;alias&#x27;</span> =&gt; <span class="string">&#x27;Supermicro Machines&#x27;</span>,</span><br><span class="line">                        <span class="string">&#x27;members&#x27;</span> =&gt; <span class="variable">$monitor_list</span>.map |<span class="params">$key, $value</span>| &#123;<span class="keyword">if</span> <span class="variable">$value</span>[<span class="string">&quot;hostgroup&quot;</span>] == <span class="string">&quot;supermicro&quot;</span> &#123; <span class="variable">$key</span> &#125;&#125;.filter |<span class="params">$items</span>| &#123; <span class="variable">$items</span> &#125;&#125;,</span><br><span class="line">                       &#123;<span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;windows&#x27;</span>,</span><br><span class="line">                        <span class="string">&#x27;alias&#x27;</span> =&gt; <span class="string">&#x27;Windows Machines&#x27;</span>,</span><br><span class="line">                        <span class="string">&#x27;members&#x27;</span> =&gt; <span class="variable">$monitor_list</span>.map |<span class="params">$key, $value</span>| &#123;<span class="keyword">if</span> <span class="variable">$value</span>[<span class="string">&quot;hostgroup&quot;</span>] == <span class="string">&quot;windows&quot;</span> &#123; <span class="variable">$key</span> &#125;&#125;.filter |<span class="params">$items</span>| &#123; <span class="variable">$items</span> &#125;&#125;,</span><br><span class="line">                       &#123;<span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;vms&#x27;</span>,</span><br><span class="line">                        <span class="string">&#x27;alias&#x27;</span> =&gt; <span class="string">&#x27;Virtual Machines&#x27;</span>,</span><br><span class="line">                        <span class="string">&#x27;members&#x27;</span> =&gt; <span class="variable">$monitor_list</span>.map |<span class="params">$key, $value</span>| &#123;<span class="keyword">if</span> <span class="variable">$value</span>[<span class="string">&quot;hostgroup&quot;</span>] == <span class="string">&quot;vms&quot;</span> &#123; <span class="variable">$key</span> &#125;&#125;.filter |<span class="params">$items</span>| &#123; <span class="variable">$items</span> &#125;&#125;,</span><br><span class="line">                       &#123;<span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;edc&#x27;</span>,</span><br><span class="line">                        <span class="string">&#x27;alias&#x27;</span>  =&gt; <span class="string">&#x27;edc servers&#x27;</span>,</span><br><span class="line">                        <span class="string">&#x27;members&#x27;</span> =&gt; <span class="variable">$monitor_list</span>.map |<span class="params">$key, $value</span>| &#123;<span class="keyword">if</span> <span class="variable">$value</span>[<span class="string">&quot;hostgroup&quot;</span>] == <span class="string">&quot;edc&quot;</span> &#123; <span class="variable">$key</span> &#125;&#125;.filter |<span class="params">$items</span>| &#123; <span class="variable">$items</span> &#125;&#125;,</span><br><span class="line">                      ]</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><blockquote><p>è¿™é‡Œçš„æ“ä½œæ˜¯ å…ˆ mapï¼Œé€šè¿‡åˆ¤æ–­ç”Ÿæˆ arrayï¼Œç„¶åè°ƒç”¨ filter å»æ‰ array é‡Œé¢çš„ç©ºå€¼ã€‚</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Puppet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hugoåšå®¢æ·»åŠ live2dçœ‹æ¿å¨˜</title>
      <link href="/posts/23f4c55d/"/>
      <url>/posts/23f4c55d/</url>
      
        <content type="html"><![CDATA[<blockquote><p>çœ‹æ¿å¨˜å°±æ˜¯ç½‘é¡µä¸Šé¢æ¼‚æµ®çš„å°äººï¼Œå¯ä»¥éšç€é¼ æ ‡çš„ç§»åŠ¨è€Œåšå‡ºååº”ï¼Œåœ¨ hexo ä¸Šé¢æ˜¯æœ‰ç°æˆçš„ npm moduleï¼Œåœ¨ hugo ä¸Šé¢åªèƒ½è‡ªå·±å¼•å…¥ js å•¦ã€‚</p></blockquote><p>æˆ‘ç”¨çš„æ˜¯ <code>hugo v0.84.1-4BD65E22+extended</code>ï¼Œ LoveIt ç‰ˆæœ¬æ˜¯ 0.2.10</p><h2 id="æ–¹æ³•-1-ä½¿ç”¨-html-æ¨¡æ¿ï¼Œå¼•å…¥-js-æ–‡ä»¶"><a href="#æ–¹æ³•-1-ä½¿ç”¨-html-æ¨¡æ¿ï¼Œå¼•å…¥-js-æ–‡ä»¶" class="headerlink" title="æ–¹æ³• 1: ä½¿ç”¨ html æ¨¡æ¿ï¼Œå¼•å…¥ js æ–‡ä»¶"></a>æ–¹æ³• 1: ä½¿ç”¨ html æ¨¡æ¿ï¼Œå¼•å…¥ js æ–‡ä»¶</h2><p>ç¼–è¾‘ <code>themes/LoveIt/layouts/partials/footer.html</code> ï¼Œ åœ¨ <code>&#123;&#123;- end -&#125;&#125;</code> çš„ä¸Šä¸€è¡Œæ·»åŠ </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Live2Dï¼Œç½‘é¡µä¸Šçš„å°äººï¼Œå¯ä»¥ä¿®æ”¹live2d_config.jsæ¥ä¿®æ”¹æ¨¡å‹ï¼Œæ¨¡å‹éƒ½åœ¨static/live2d_modelsé‡Œé¢ --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- ä½ ä¹Ÿå¯ä»¥æŠŠjsæ–‡ä»¶ä¸‹è½½ä¸‹æ¥ï¼Œæ”¾åˆ°static/js/ç›®å½•ä¸‹ï¼Œå°±ä¸ä¾èµ–åˆ«äººçš„æœåŠ¡äº† --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/live2d-widget@3.1.4/lib/L2Dwidget.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/live2d-widget@3.1.4/lib/L2Dwidget.0.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    L2Dwidget.<span class="title function_">init</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">model</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">scale</span>: <span class="number">1</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">hHeadPos</span>: <span class="number">0.5</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">vHeadPos</span>: <span class="number">0.618</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">jsonPath</span>: <span class="string">&#x27;https://cdn.jsdelivr.net/npm/live2d-widget-model-hibiki@1.0.5/assets/hibiki.model.json&#x27;</span>,       <span class="comment">// xxx.model.json çš„è·¯å¾„,æ¢äººç‰©ä¿®æ”¹è¿™ä¸ª</span></span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">display</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">superSample</span>: <span class="number">1</span>,     <span class="comment">// è¶…é‡‡æ ·ç­‰çº§</span></span></span><br><span class="line"><span class="language-javascript">            <span class="attr">width</span>: <span class="number">120</span>,         <span class="comment">// canvasçš„å®½åº¦</span></span></span><br><span class="line"><span class="language-javascript">            <span class="attr">height</span>: <span class="number">300</span>,        <span class="comment">// canvasçš„é«˜åº¦</span></span></span><br><span class="line"><span class="language-javascript">            <span class="attr">position</span>: <span class="string">&#x27;left&#x27;</span>,   <span class="comment">// æ˜¾ç¤ºä½ç½®ï¼šå·¦æˆ–å³</span></span></span><br><span class="line"><span class="language-javascript">            <span class="attr">hOffset</span>: <span class="number">0</span>,         <span class="comment">// canvasæ°´å¹³åç§»</span></span></span><br><span class="line"><span class="language-javascript">            <span class="attr">vOffset</span>: <span class="number">0</span>,         <span class="comment">// canvaså‚ç›´åç§»</span></span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">mobile</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">show</span>: <span class="literal">true</span>,         <span class="comment">// æ˜¯å¦åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šæ˜¾ç¤º</span></span></span><br><span class="line"><span class="language-javascript">            <span class="attr">scale</span>: <span class="number">1</span>,           <span class="comment">// ç§»åŠ¨è®¾å¤‡ä¸Šçš„ç¼©æ”¾</span></span></span><br><span class="line"><span class="language-javascript">            <span class="attr">motion</span>: <span class="literal">true</span>,       <span class="comment">// ç§»åŠ¨è®¾å¤‡æ˜¯å¦å¼€å¯é‡åŠ›æ„Ÿåº”</span></span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">react</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">opacityDefault</span>: <span class="number">1</span>,  <span class="comment">// é»˜è®¤é€æ˜åº¦</span></span></span><br><span class="line"><span class="language-javascript">            <span class="attr">opacityOnHover</span>: <span class="number">1</span>,  <span class="comment">// é¼ æ ‡ç§»ä¸Šé€æ˜åº¦</span></span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">     &#125;);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="æ–¹æ³•-2-ç›´æ¥åœ¨-config-toml-é‡Œé¢å¼•å…¥-js-æ–‡ä»¶"><a href="#æ–¹æ³•-2-ç›´æ¥åœ¨-config-toml-é‡Œé¢å¼•å…¥-js-æ–‡ä»¶" class="headerlink" title="æ–¹æ³• 2: ç›´æ¥åœ¨ config.toml é‡Œé¢å¼•å…¥ js æ–‡ä»¶"></a>æ–¹æ³• 2: ç›´æ¥åœ¨ config.toml é‡Œé¢å¼•å…¥ js æ–‡ä»¶</h2><p><code>vim config.toml</code>ï¼Œ è¦ç¡®ä¿é‡Œé¢çš„ js æ–‡ä»¶å¯ä»¥ç›´æ¥è®¿é—®</p><figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¬¬ä¸‰æ–¹åº“é…ç½®</span></span><br><span class="line"><span class="section">[params.page.library]</span></span><br><span class="line">  <span class="section">[params.page.library.css]</span></span><br><span class="line">  <span class="section">[params.page.library.js]</span></span><br><span class="line">    <span class="attr">live2d-widget1</span> = <span class="string">&quot;https://cdn.jsdelivr.net/npm/live2d-widget@3.1.4/lib/L2Dwidget.min.js&quot;</span></span><br><span class="line">    <span class="attr">live2d-widget2</span> = <span class="string">&quot;https://cdn.jsdelivr.net/npm/live2d-widget@3.1.4/lib/L2Dwidget.0.min.js&quot;</span></span><br><span class="line">    <span class="attr">live2d-config</span> = <span class="string">&quot;/js/live2d_config.js&quot;</span></span><br></pre></td></tr></table></figure><p><code>vim static/js/live2d_config.js</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">L2Dwidget.<span class="title function_">init</span>(&#123;</span><br><span class="line">    <span class="attr">model</span>: &#123;</span><br><span class="line">        <span class="attr">scale</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">hHeadPos</span>: <span class="number">0.5</span>,</span><br><span class="line">        <span class="attr">vHeadPos</span>: <span class="number">0.618</span>,</span><br><span class="line">        <span class="attr">jsonPath</span>: <span class="string">&#x27;https://cdn.jsdelivr.net/npm/live2d-widget-model-hibiki@1.0.5/assets/hibiki.model.json&#x27;</span>,       <span class="comment">// xxx.model.json çš„è·¯å¾„,æ¢äººç‰©ä¿®æ”¹è¿™ä¸ª</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">display</span>: &#123;</span><br><span class="line">        <span class="attr">superSample</span>: <span class="number">1</span>,     <span class="comment">// è¶…é‡‡æ ·ç­‰çº§</span></span><br><span class="line">        <span class="attr">width</span>: <span class="number">120</span>,         <span class="comment">// canvasçš„å®½åº¦</span></span><br><span class="line">        <span class="attr">height</span>: <span class="number">300</span>,        <span class="comment">// canvasçš„é«˜åº¦</span></span><br><span class="line">        <span class="attr">position</span>: <span class="string">&#x27;left&#x27;</span>,   <span class="comment">// æ˜¾ç¤ºä½ç½®ï¼šå·¦æˆ–å³</span></span><br><span class="line">        <span class="attr">hOffset</span>: <span class="number">0</span>,         <span class="comment">// canvasæ°´å¹³åç§»</span></span><br><span class="line">        <span class="attr">vOffset</span>: <span class="number">0</span>,         <span class="comment">// canvaså‚ç›´åç§»</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">mobile</span>: &#123;</span><br><span class="line">        <span class="attr">show</span>: <span class="literal">true</span>,         <span class="comment">// æ˜¯å¦åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šæ˜¾ç¤º</span></span><br><span class="line">        <span class="attr">scale</span>: <span class="number">1</span>,           <span class="comment">// ç§»åŠ¨è®¾å¤‡ä¸Šçš„ç¼©æ”¾</span></span><br><span class="line">        <span class="attr">motion</span>: <span class="literal">true</span>,       <span class="comment">// ç§»åŠ¨è®¾å¤‡æ˜¯å¦å¼€å¯é‡åŠ›æ„Ÿåº”</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">react</span>: &#123;</span><br><span class="line">        <span class="attr">opacityDefault</span>: <span class="number">1</span>,  <span class="comment">// é»˜è®¤é€æ˜åº¦</span></span><br><span class="line">        <span class="attr">opacityOnHover</span>: <span class="number">1</span>,  <span class="comment">// é¼ æ ‡ç§»ä¸Šé€æ˜åº¦</span></span><br><span class="line">    &#125;,</span><br><span class="line"> &#125;);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Blog </tag>
            
            <tag> hugo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Shellè„šæœ¬æ¥å—å‚æ•°</title>
      <link href="/posts/7635ef7e/"/>
      <url>/posts/7635ef7e/</url>
      
        <content type="html"><![CDATA[<h2 id="ç›´æ¥ä¼ å‚"><a href="#ç›´æ¥ä¼ å‚" class="headerlink" title="ç›´æ¥ä¼ å‚"></a>ç›´æ¥ä¼ å‚</h2><p>ä¸€èˆ¬æƒ…å†µä¸‹ç›´æ¥ä¼ å‚ï¼Œæ¯”å¦‚</p><p>test.sh</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">echo</span> hello <span class="variable">$1</span></span><br></pre></td></tr></table></figure><p>.&#x2F;test.sh world<br>hello world</p><h2 id="ä½¿ç”¨-getopts-è§£æå‚æ•°"><a href="#ä½¿ç”¨-getopts-è§£æå‚æ•°" class="headerlink" title="ä½¿ç”¨ getopts è§£æå‚æ•°"></a>ä½¿ç”¨ getopts è§£æå‚æ•°</h2><p>è¿™ç§æ–¹æ³•å¯ä»¥å¿½ç•¥å‚æ•°ä½ç½®ï¼Œä½¿è„šæœ¬æ›´å®Œå–„</p><p>test.sh</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="built_in">getopts</span> <span class="string">&quot;a:b:c&quot;</span> arg           <span class="comment">#é€‰é¡¹åé¢çš„å†’å·è¡¨ç¤ºè¯¥é€‰é¡¹éœ€è¦å‚æ•°</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="keyword">case</span> <span class="variable">$arg</span> <span class="keyword">in</span></span><br><span class="line">        a)</span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;a <span class="variable">$OPTARG</span>&quot;</span>    <span class="comment">#å‚æ•°å­˜åœ¨$OPTARGä¸­</span></span><br><span class="line">        ;;</span><br><span class="line">        b)</span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;b <span class="variable">$OPTARG</span>&quot;</span></span><br><span class="line">        ;;</span><br><span class="line">        c)</span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;c&quot;</span></span><br><span class="line">        ;;</span><br><span class="line">        ?)                     <span class="comment">#å½“æœ‰ä¸è®¤è¯†çš„é€‰é¡¹çš„æ—¶å€™argä¸º?</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;unkonw argument&quot;</span></span><br><span class="line">            <span class="built_in">exit</span> 1</span><br><span class="line">        ;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~$ ./test.sh -a 1 -b 2 -c  </span><br><span class="line">a 1  </span><br><span class="line">b 2  </span><br><span class="line">c</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨-shift"><a href="#ä½¿ç”¨-shift" class="headerlink" title="ä½¿ç”¨ shift"></a>ä½¿ç”¨ shift</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">help</span></span>() &#123;</span><br><span class="line">    <span class="built_in">cat</span> &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">è¿™é‡Œæ˜¯å¸®åŠ©æ–‡æ¡£</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[ <span class="variable">$#</span> -eq 0 ] &amp;&amp; <span class="built_in">help</span> &amp;&amp; <span class="built_in">exit</span> 0</span><br><span class="line"><span class="keyword">while</span> [[ <span class="variable">$#</span> -gt 0 ]]; <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$1</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">    -n | --name)</span><br><span class="line">        name=<span class="string">&quot;<span class="variable">$2</span>&quot;</span></span><br><span class="line">        <span class="built_in">shift</span></span><br><span class="line">        ;;</span><br><span class="line">    -c | --count)</span><br><span class="line">        count=<span class="string">&quot;<span class="variable">$2</span>&quot;</span></span><br><span class="line">        <span class="built_in">shift</span></span><br><span class="line">        ;;</span><br><span class="line">    -h | --<span class="built_in">help</span>)</span><br><span class="line">        <span class="built_in">help</span></span><br><span class="line">        <span class="built_in">exit</span> 0</span><br><span class="line">        ;;</span><br><span class="line">    --)</span><br><span class="line">        <span class="built_in">shift</span></span><br><span class="line">        ;;</span><br><span class="line">    *)</span><br><span class="line">        <span class="built_in">help</span></span><br><span class="line">        <span class="built_in">exit</span> 0</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line">    <span class="built_in">shift</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> name: <span class="variable">$name</span></span><br><span class="line"><span class="built_in">echo</span> count: <span class="variable">$count</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Script </tag>
            
            <tag> Shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nginxè´Ÿè½½å‡è¡¡(åå‘ä»£ç†)</title>
      <link href="/posts/0f0ebc52/"/>
      <url>/posts/0f0ebc52/</url>
      
        <content type="html"><![CDATA[<h2 id="7-å±‚è´Ÿè½½å‡è¡¡"><a href="#7-å±‚è´Ÿè½½å‡è¡¡" class="headerlink" title="7 å±‚è´Ÿè½½å‡è¡¡"></a>7 å±‚è´Ÿè½½å‡è¡¡</h2><blockquote><p>7 å±‚å°±æ˜¯ç”¨åŸŸåæ¥è¿›è¡Œè½¬å‘</p></blockquote><p>ç±»ä¼¼é…ç½®æ–‡ä»¶ï¼š</p><p><code>vim /etc/nginx/conf.d/xxx.conf</code></p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">upstream  wordpress &#123;</span><br><span class="line">    server  192.168.1.20:8000 weight=5 max_fails=3 fail_timeout=30s;</span><br><span class="line">    server  192.168.1.21:8000 weight=5 max_fails=3 fail_timeout=30s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen 80 ;</span><br><span class="line">    server_name wordpress.zahui.fan;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_pass http://wordpress;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="åä»£åˆ°è™šæ‹Ÿä¸»æœºçš„å¦ä¸€å°-Nginx"><a href="#åä»£åˆ°è™šæ‹Ÿä¸»æœºçš„å¦ä¸€å°-Nginx" class="headerlink" title="åä»£åˆ°è™šæ‹Ÿä¸»æœºçš„å¦ä¸€å° Nginx"></a>åä»£åˆ°è™šæ‹Ÿä¸»æœºçš„å¦ä¸€å° Nginx</h3><p>æ¯”å¦‚ç°åœ¨æœ‰ä¸€å°æœåŠ¡å™¨ï¼Œéƒ¨ç½²äº† aã€b ä¸¤ä¸ªæœåŠ¡ï¼Œæ¯”å¦‚ a.com åˆ° a æœåŠ¡ï¼Œb.com åˆ° b æœåŠ¡ï¼Œè¿™ç§æƒ…å†µæˆ‘çš„ Nginx æƒ³è¦ä»£ç† b æœåŠ¡ï¼Œå°±éœ€è¦æŒ‡å®šåä»£ header <code>proxy_set_header Host &quot;b.com&quot;</code>ï¼Œé…ç½®å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">  listen 80;</span><br><span class="line">  listen [::]:80;</span><br><span class="line">  server_name c.com;</span><br><span class="line">  client_max_body_size 1024m;</span><br><span class="line"></span><br><span class="line">  location / &#123;</span><br><span class="line">    proxy_pass https://x.x.x.x;      # bæœåŠ¡çš„ipï¼Œä¹Ÿå¯ä»¥ç”¨åŸŸåï¼Œç”¨åŸŸåç†è®ºä¸Šä¸éœ€è¦ä¸‹é¢è¿™æ¡ã€‚</span><br><span class="line">    proxy_set_header HOST b.com;     # ä»£ç†æœåŠ¡å™¨è¯·æ±‚åç«¯ä½¿ç”¨çš„Header</span><br><span class="line">    proxy_set_header X-Forwarded-Proto $scheme;</span><br><span class="line">    proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-å±‚è´Ÿè½½"><a href="#4-å±‚è´Ÿè½½" class="headerlink" title="4 å±‚è´Ÿè½½"></a>4 å±‚è´Ÿè½½</h2><blockquote><p>4 å±‚è´Ÿè½½å°±æ˜¯ç±»ä¼¼ç«¯å£è½¬å‘</p></blockquote><p><code>vim /etc/nginx.conf</code> æœ€åæ·»åŠ ï¼š</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">stream &#123;</span><br><span class="line">    include port_forward.conf;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>vim /etc/nginx/port_forward.conf</code></p><h3 id="ç®€å•é…ç½®"><a href="#ç®€å•é…ç½®" class="headerlink" title="ç®€å•é…ç½®"></a>ç®€å•é…ç½®</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># è®¿é—®æœ¬æœºçš„5555ç«¯å£ï¼Œ è½¬å‘åˆ°172.16.1.7çš„22ç«¯å£</span><br><span class="line">server &#123;</span><br><span class="line">    listen 5555;</span><br><span class="line">    proxy_pass 172.16.1.7:22;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¤æ‚é…ç½®"><a href="#å¤æ‚é…ç½®" class="headerlink" title="å¤æ‚é…ç½®"></a>å¤æ‚é…ç½®</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">upstream mysql-server &#123;</span><br><span class="line">    server 192.168.1.20:3306 weight=5 max_fails=3 fail_timeout=10s;</span><br><span class="line">    server 192.168.1.21:3306 weight=5 max_fails=3 fail_timeout=10s;</span><br><span class="line">    server 192.168.1.22:3306 weight=5 max_fails=3 fail_timeout=10s;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">    listen 3306;</span><br><span class="line">    proxy_connect_timeout 1s;</span><br><span class="line">    proxy_timeout 10s;</span><br><span class="line">    proxy_pass mysql-server;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Nginx </tag>
            
            <tag> LoadBalance </tag>
            
            <tag> Proxy </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxç½‘ç»œä¹‹Bridgeå’ŒBond</title>
      <link href="/posts/8ec7155e/"/>
      <url>/posts/8ec7155e/</url>
      
        <content type="html"><![CDATA[<blockquote><p>ç½‘æ¡¥ç›¸å½“äºä¸€å°è™šæ‹Ÿäº¤æ¢æœºï¼Œä½ å¯ä»¥æŠŠè‡ªå·±çš„ç½‘å¡ç»‘å®šåœ¨è™šæ‹Ÿäº¤æ¢æœºä¸Šï¼Œå¹¶æŠŠå…¶ä»–æ¥å£ï¼ˆæ¯”å¦‚è™šæ‹Ÿæœºçš„ç½‘ç»œï¼‰æ¡¥æ¥åˆ°è¿™ä¸ªç½‘å¡ä¸Šé¢æ¥ï¼Œç›¸å½“äºå¤§å®¶éƒ½æ˜¯åœ¨ä¸€ä¸ªå†…ç½‘é‡Œé¢ã€‚</p></blockquote><p>åˆ›å»ºç½‘æ¡¥æ–¹æ³•, ä»¥ Redhat ç³»ä¸ºä¾‹ã€‚</p><h2 id="ä½¿ç”¨-nmtui-åˆ›å»ºç½‘æ¡¥"><a href="#ä½¿ç”¨-nmtui-åˆ›å»ºç½‘æ¡¥" class="headerlink" title="ä½¿ç”¨ nmtui åˆ›å»ºç½‘æ¡¥"></a>ä½¿ç”¨ nmtui åˆ›å»ºç½‘æ¡¥</h2><ol><li>åˆ é™¤ç½‘å¡é…ç½®æ–‡ä»¶<br>å¯ä»¥åˆ° <code>/etc/sysconfig/network-scripts/</code> é‡Œé¢åˆ é™¤ <code>ifcfg-</code> å¼€å¤´çš„é…ç½®</li><li>ä½¿ç”¨ nmtui åˆ›å»ºç½‘æ¡¥ï¼Œå¹¶å°†ç½‘å¡è®¾å¤‡ç»‘å®šåˆ°ç½‘æ¡¥ï¼Œ ä¸€èˆ¬å…³é—­ç”Ÿæˆæ ‘åè®®ï¼ˆSTPï¼‰</li><li>æ£€æŸ¥ <code>/etc/sysconfig/network-scripts/</code> é‡Œé¢æœ‰æ²¡æœ‰å¤šä½™çš„é…ç½®æ–‡ä»¶ï¼Œæœ‰çš„è¯éœ€è¦åˆ é™¤ä»¥å…å†²çª</li><li>ç½‘å¡å’Œç½‘æ¡¥éƒ½éœ€è¦å¼€æœºè‡ªå¯åŠ¨<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/nmtui.gif" alt="nmtui"></li></ol><h2 id="ä½¿ç”¨é…ç½®æ–‡ä»¶åˆ›å»ºç½‘æ¡¥"><a href="#ä½¿ç”¨é…ç½®æ–‡ä»¶åˆ›å»ºç½‘æ¡¥" class="headerlink" title="ä½¿ç”¨é…ç½®æ–‡ä»¶åˆ›å»ºç½‘æ¡¥"></a>ä½¿ç”¨é…ç½®æ–‡ä»¶åˆ›å»ºç½‘æ¡¥</h2><blockquote><p>ç”Ÿæˆ uuid <code>cat /proc/sys/kernel/random/uuid</code> æˆ–è€… <code>uuidgen</code></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">set</span> -euf -o pipefail</span><br><span class="line"></span><br><span class="line">BRIDGE_UUID=$(uuidgen)</span><br><span class="line">BRIDGE_NAME=br13</span><br><span class="line">NET_UUID=$(uuidgen)</span><br><span class="line">NET_DEVICE=ens33</span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &gt;/etc/sysconfig/network-scripts/ifcfg-<span class="variable">$&#123;NET_DEVICE&#125;</span> &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">TYPE=Ethernet</span></span><br><span class="line"><span class="string">NAME=$&#123;NET_DEVICE&#125;</span></span><br><span class="line"><span class="string">UUID=$&#123;NET_UUID&#125;</span></span><br><span class="line"><span class="string">DEVICE=$&#123;NET_DEVICE&#125;</span></span><br><span class="line"><span class="string">ONBOOT=yes</span></span><br><span class="line"><span class="string">BRIDGE=$&#123;BRIDGE_NAME&#125;</span></span><br><span class="line"><span class="string">BRIDGE_UUID=$&#123;BRIDGE_UUID&#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &gt;/etc/sysconfig/network-scripts/ifcfg-<span class="variable">$&#123;BRIDGE_NAME&#125;</span> &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">STP=no</span></span><br><span class="line"><span class="string">BRIDGING_OPTS=multicast_snooping=0</span></span><br><span class="line"><span class="string">TYPE=Bridge</span></span><br><span class="line"><span class="string">PROXY_METHOD=none</span></span><br><span class="line"><span class="string">BROWSER_ONLY=no</span></span><br><span class="line"><span class="string">IPV6INIT=no</span></span><br><span class="line"><span class="string">NAME=$&#123;BRIDGE_NAME&#125;</span></span><br><span class="line"><span class="string">UUID=$&#123;BRIDGE_UUID&#125;</span></span><br><span class="line"><span class="string">DEVICE=$&#123;BRIDGE_NAME&#125;</span></span><br><span class="line"><span class="string">BOOTPROTO=dhcp</span></span><br><span class="line"><span class="string">ONBOOT=yes</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨é…ç½®æ–‡ä»¶åˆ›å»º-bond-å¹¶ç»‘å®šç½‘æ¡¥"><a href="#ä½¿ç”¨é…ç½®æ–‡ä»¶åˆ›å»º-bond-å¹¶ç»‘å®šç½‘æ¡¥" class="headerlink" title="ä½¿ç”¨é…ç½®æ–‡ä»¶åˆ›å»º bond å¹¶ç»‘å®šç½‘æ¡¥"></a>ä½¿ç”¨é…ç½®æ–‡ä»¶åˆ›å»º bond å¹¶ç»‘å®šç½‘æ¡¥</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF &gt; /etc/sysconfig/network-scripts/ifcfg-eno1</span></span><br><span class="line"><span class="string">TYPE=&quot;Ethernet&quot;</span></span><br><span class="line"><span class="string">BOOTPROTO=&quot;none&quot;</span></span><br><span class="line"><span class="string">DEVICE=&quot;eno1&quot;</span></span><br><span class="line"><span class="string">ONBOOT=&quot;yes&quot;</span></span><br><span class="line"><span class="string">MASTER=bond0</span></span><br><span class="line"><span class="string">SLAVE=yes</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF &gt; /etc/sysconfig/network-scripts/ifcfg-eno2</span></span><br><span class="line"><span class="string">TYPE=&quot;Ethernet&quot;</span></span><br><span class="line"><span class="string">BOOTPROTO=&quot;none&quot;</span></span><br><span class="line"><span class="string">DEVICE=&quot;eno2&quot;</span></span><br><span class="line"><span class="string">ONBOOT=&quot;yes&quot;</span></span><br><span class="line"><span class="string">MASTER=bond0</span></span><br><span class="line"><span class="string">SLAVE=yes</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF &gt; /etc/sysconfig/network-scripts/ifcfg-bond0</span></span><br><span class="line"><span class="string">DEVICE=bond0</span></span><br><span class="line"><span class="string">TYPE=Bond</span></span><br><span class="line"><span class="string">ONBOOT=yes</span></span><br><span class="line"><span class="string">BONDING_OPTS=&quot;downdelay=0 updelay=0 miimon=100 mode=802.3ad xmit_hash_policy=1&quot;</span></span><br><span class="line"><span class="string">BRIDGE=br13</span></span><br><span class="line"><span class="string">BONDING_MASTER=yes</span></span><br><span class="line"><span class="string">NAME=&quot;bond0&quot;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF &gt; /etc/sysconfig/network-scripts/ifcfg-br13</span></span><br><span class="line"><span class="string">DEVICE=br13</span></span><br><span class="line"><span class="string">TYPE=Bridge</span></span><br><span class="line"><span class="string">ONBOOT=yes</span></span><br><span class="line"><span class="string">BOOTPROTO=dhcp</span></span><br><span class="line"><span class="string">STP=no</span></span><br><span class="line"><span class="string">BRIDGING_OPTS=multicast_snooping=0</span></span><br><span class="line"><span class="string">PROXY_METHOD=none</span></span><br><span class="line"><span class="string">BROWSER_ONLY=no</span></span><br><span class="line"><span class="string">DEFROUTE=yes</span></span><br><span class="line"><span class="string">IPV4_FAILURE_FATAL=no</span></span><br><span class="line"><span class="string">IPV6INIT=no</span></span><br><span class="line"><span class="string">NAME=br13</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Network </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>notepad++å®åŠŸèƒ½è‡ªåŠ¨æ“ä½œæ–‡æ¡£</title>
      <link href="/posts/2208175c/"/>
      <url>/posts/2208175c/</url>
      
        <content type="html"><![CDATA[<blockquote><p>notepad++ æ˜¯ä¸€æ¬¾ windows å¹³å°çš„æ–‡æœ¬ç¼–è¾‘å™¨, æ¯”è¾ƒè½»é‡å’ŒåŠŸèƒ½å¼ºå¤§<br>å®åŠŸèƒ½ç±»ä¼¼äºå½•åƒå›æ”¾, å°†è‡ªå·±çš„æ“ä½œå½•åˆ¶ä¸‹æ¥, å¹¶è¿›è¡Œé‡å¤æ‰§è¡Œ, è§£æ”¾åŒæ‰‹</p></blockquote><h2 id="ç®€å•æ“ä½œ"><a href="#ç®€å•æ“ä½œ" class="headerlink" title="ç®€å•æ“ä½œ"></a>ç®€å•æ“ä½œ</h2><p>å…ˆçœ‹ä¸ªä¾‹å­, æˆ‘è¦åˆ é™¤æ‰€æœ‰çš„å¥‡æ•°è¡Œ, æˆ‘çš„æ“ä½œæ˜¯: ç‚¹å‡»å½•åˆ¶, å…‰æ ‡æ”¾åœ¨ç¬¬ä¸€è¡Œ, æŒ‰ä¸‹ <code>home</code> é”®, æŒ‰ä½ <code>shift</code> é”®,å†æŒ‰ <code>end</code> é”® (é€‰ä¸­æ•´è¡Œ), æŒ‰ä¸€ä¸‹ <code>delete</code> é”®, ä¸ºäº†æ–¹ä¾¿é‡å¤æ‰§è¡Œ, å†æŒ‰ä¸¤ä¸‹ <code>â†“</code>, åœæ­¢å½•åˆ¶<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/notepad++.gif" alt="notepad++"></p><h2 id="ç»“åˆæœç´¢åŠŸèƒ½"><a href="#ç»“åˆæœç´¢åŠŸèƒ½" class="headerlink" title="ç»“åˆæœç´¢åŠŸèƒ½"></a>ç»“åˆæœç´¢åŠŸèƒ½</h2><p>æ¯”å¦‚è¿™ä¸ªæ–‡ä»¶æœ‰å‡ åƒè¡Œ, æˆ‘è¦åœ¨æ¯ä¸ª service é‡Œé¢æ·»åŠ ä¸€æ¡æ•°æ®<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/search.png" alt="search"></p><p>å¯ä»¥è¿™æ ·æ“ä½œ<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/auto_search.gif" alt="auto_search"></p>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxå®šæ—¶æ‰§è¡Œä»»åŠ¡crontab</title>
      <link href="/posts/2de1df7e/"/>
      <url>/posts/2de1df7e/</url>
      
        <content type="html"><![CDATA[<p><a href="/posts/63d10d9c/">crontab å¸¸è§çš„æ•…éšœå¤„ç†</a></p><h2 id="å¸¸ç”¨æ“ä½œ"><a href="#å¸¸ç”¨æ“ä½œ" class="headerlink" title="å¸¸ç”¨æ“ä½œ"></a>å¸¸ç”¨æ“ä½œ</h2><h3 id="å¯åŠ¨åœæ­¢æœåŠ¡"><a href="#å¯åŠ¨åœæ­¢æœåŠ¡" class="headerlink" title="å¯åŠ¨åœæ­¢æœåŠ¡"></a>å¯åŠ¨åœæ­¢æœåŠ¡</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl start cron</span><br><span class="line">systemctl stop cron</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·-crontab"><a href="#æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·-crontab" class="headerlink" title="æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ· crontab"></a>æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ· crontab</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /etc/passwd | <span class="built_in">cut</span> -f 1 -d : |xargs -I &#123;&#125; crontab -l -u &#123;&#125;</span><br></pre></td></tr></table></figure><h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h2><h3 id="å…¨å±€é…ç½®"><a href="#å…¨å±€é…ç½®" class="headerlink" title="å…¨å±€é…ç½®"></a>å…¨å±€é…ç½®</h3><p>crontab åœ¨&#x2F;etc ç›®å½•ä¸‹é¢å­˜åœ¨ cron.hourlyã€cron.dailyã€cron.weeklyã€cron.monthlyã€cron.d äº”ä¸ªç›®å½•, è¿™äº›ç›¸å½“äºå¿«æ·æ–¹å¼, ç›´æ¥å°†ä½ çš„è„šæœ¬æ‰”è¿›å»å°±å¯ä»¥<br>å’Œ crontabã€cron.deny äºŒä¸ªæ–‡ä»¶ã€‚</p><table><thead><tr><th>ç›®å½•</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>cron.daily</td><td>æ¯å¤©æ‰§è¡Œ</td></tr><tr><td>cron.weekly</td><td>æ¯å‘¨æ‰§è¡Œ</td></tr><tr><td>cron.monthly</td><td>æ¯æœˆæ‰§è¡Œ</td></tr><tr><td>cron.hourly</td><td>æ¯å°æ—¶æ‰§è¡Œ</td></tr><tr><td>crontab</td><td>ç³»ç»Ÿçº§ä»»åŠ¡, åœ¨è¿™é‡Œé¢è°ƒç”¨äº†ä¸Šé¢å‡ ä¸ª</td></tr></tbody></table><h3 id="ç”¨æˆ·é…ç½®æ–‡ä»¶"><a href="#ç”¨æˆ·é…ç½®æ–‡ä»¶" class="headerlink" title="ç”¨æˆ·é…ç½®æ–‡ä»¶"></a>ç”¨æˆ·é…ç½®æ–‡ä»¶</h3><p>ç›´æ¥ä½¿ç”¨ <code>crontab -e</code> ç¼–è¾‘å°±è¡Œ, <code>-e</code> ä½¿ç”¨çš„ç¼–è¾‘å™¨å¯ä»¥é€šè¿‡ <code>select-editor</code> æ¥æŒ‡å®š<br>æˆ–è€…ä½¿ç”¨ <code>crontab -u www-data -e</code> æŒ‡å®šç”¨æˆ·æ‰§è¡Œã€‚</p><p>é…ç½®æ–‡ä»¶åœ¨ <code>/var/spool/cron</code> ä¸‹</p><h3 id="crontab-æ–‡ä»¶æ ¼å¼"><a href="#crontab-æ–‡ä»¶æ ¼å¼" class="headerlink" title="crontab æ–‡ä»¶æ ¼å¼"></a>crontab æ–‡ä»¶æ ¼å¼</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example of job definition:</span></span><br><span class="line"><span class="comment"># .---------------- minute (0 - 59)</span></span><br><span class="line"><span class="comment"># |  .------------- hour (0 - 23)</span></span><br><span class="line"><span class="comment"># |  |  .---------- day of month (1 - 31)</span></span><br><span class="line"><span class="comment"># |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...</span></span><br><span class="line"><span class="comment"># |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat</span></span><br><span class="line"><span class="comment"># |  |  |  |  |</span></span><br><span class="line"><span class="comment"># *  *  *  *  * user-name command to be executed</span></span><br><span class="line">17 *    * * *    root    <span class="built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.hourly</span><br><span class="line">25 6    * * *    root    <span class="built_in">test</span> -x /usr/sbin/anacron || ( <span class="built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.daily )</span><br><span class="line">47 6    * * 7    root    <span class="built_in">test</span> -x /usr/sbin/anacron || ( <span class="built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.weekly )</span><br><span class="line">52 6    1 * *    root    <span class="built_in">test</span> -x /usr/sbin/anacron || ( <span class="built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.monthly )</span><br></pre></td></tr></table></figure><h3 id="ç‰¹æ®Šå­—ç¬¦"><a href="#ç‰¹æ®Šå­—ç¬¦" class="headerlink" title="ç‰¹æ®Šå­—ç¬¦"></a>ç‰¹æ®Šå­—ç¬¦</h3><table><thead><tr><th>ç¬¦å·</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>*</td><td>ä»£è¡¨æ¯çš„æ„æ€ï¼Œä¾‹å¦‚ month å­—æ®µå¦‚æœæ˜¯æ˜Ÿå·ï¼Œåˆ™è¡¨ç¤ºæ¯æœˆéƒ½æ‰§è¡Œè¯¥å‘½ä»¤æ“ä½œã€‚</td></tr><tr><td>,</td><td>è¡¨ç¤ºåˆ†éš”æ—¶æ®µçš„æ„æ€ï¼Œä¾‹å¦‚ï¼Œâ€œ1,3,5,7,9â€ã€‚</td></tr><tr><td>-</td><td>è¡¨ç¤ºä¸€ä¸ªæ—¶é—´èŒƒå›´ï¼Œä¾‹å¦‚â€œ2-6â€è¡¨ç¤ºâ€œ2,3,4,5,6â€ã€‚</td></tr><tr><td>&#x2F;</td><td>å¯ä»¥ç”¨æ­£æ–œçº¿æŒ‡å®šæ—¶é—´çš„é—´éš”é¢‘ç‡ï¼Œä¾‹å¦‚ <code>0-23/2</code> è¡¨ç¤ºæ¯ä¸¤å°æ—¶æ‰§è¡Œä¸€æ¬¡ã€‚åŒæ—¶æ­£æ–œçº¿å¯ä»¥å’Œæ˜Ÿå·ä¸€èµ·ä½¿ç”¨ï¼Œä¾‹å¦‚ <code>*/10</code></td></tr></tbody></table><h2 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ¯æœˆæ¯å¤©æ¯å°æ—¶çš„ç¬¬ 0 åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ /bin/ls</span></span><br><span class="line">0 * * * * /bin/ls</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨ 12 æœˆå†…, æ¯å¤©çš„æ—©ä¸Š 6 ç‚¹åˆ° 12 ç‚¹ï¼Œæ¯éš” 3 ä¸ªå°æ—¶ 0 åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ /usr/bin/backup</span></span><br><span class="line">0 6-12/3 * 12 * /usr/bin/backup</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‘¨ä¸€åˆ°å‘¨äº”æ¯å¤©ä¸‹åˆ 5:00 å¯„ä¸€å°ä¿¡ç»™ alex@domain.name</span></span><br><span class="line">0 17 * * 1-5 mail -s <span class="string">&quot;hi&quot;</span> alex@domain.name &lt; /tmp/maildata</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¯æœˆæ¯å¤©çš„åˆå¤œ 0 ç‚¹ 20 åˆ†, 2 ç‚¹ 20 åˆ†, 4 ç‚¹ 20 åˆ†....æ‰§è¡Œ echo &quot;haha&quot;</span></span><br><span class="line">20 0-23/2 * * * <span class="built_in">echo</span> <span class="string">&quot;haha&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># crontab ä¹Ÿå¯å®ç°ç¨‹åºå¼€æœºè‡ªå¯åŠ¨çš„ä½œç”¨ï¼Œæ¯”å¦‚ä¸€äº›å¼€æœºä¸€æ¬¡æ€§ä»»åŠ¡ç­‰</span></span><br><span class="line">@reboot <span class="built_in">echo</span> <span class="string">&quot;test&quot;</span> &gt;&gt; /tmp/test</span><br></pre></td></tr></table></figure><p>ä¸‹é¢å†çœ‹çœ‹å‡ ä¸ªå…·ä½“çš„ä¾‹å­ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">0 */2 * * * /sbin/service httpd restart         <span class="comment"># æ„æ€æ˜¯æ¯ä¸¤ä¸ªå°æ—¶é‡å¯ä¸€æ¬¡apache</span></span><br><span class="line">50 7 * * * /sbin/service sshd start             <span class="comment"># æ„æ€æ˜¯æ¯å¤©7ï¼š50å¼€å¯sshæœåŠ¡</span></span><br><span class="line">50 22 * * * /sbin/service sshd stop             <span class="comment"># æ„æ€æ˜¯æ¯å¤©22ï¼š50å…³é—­sshæœåŠ¡</span></span><br><span class="line">0 0 1,15 * * fsck /home                         <span class="comment"># æ¯æœˆ1å·å’Œ15å·æ£€æŸ¥/home ç£ç›˜</span></span><br><span class="line">1 * * * * /home/bruce/backup                    <span class="comment"># æ¯å°æ—¶çš„ç¬¬ä¸€åˆ†æ‰§è¡Œ /home/bruce/backupè¿™ä¸ªæ–‡ä»¶</span></span><br><span class="line">00 03 * * 1-5 find /home <span class="string">&quot;*.xxx&quot;</span> -mtime +4 -<span class="built_in">exec</span> <span class="built_in">rm</span> &#123;&#125; \;   <span class="comment"># æ¯å‘¨ä¸€è‡³å‘¨äº”3ç‚¹é’Ÿï¼Œåœ¨ç›®å½•/homeä¸­ï¼ŒæŸ¥æ‰¾æ–‡ä»¶åä¸º*.xxxçš„æ–‡ä»¶ï¼Œå¹¶åˆ é™¤4å¤©å‰çš„æ–‡ä»¶ã€‚</span></span><br><span class="line">30 6 */10 * * <span class="built_in">ls</span>                                            <span class="comment"># æ„æ€æ˜¯æ¯æœˆçš„1ã€11ã€21ã€31æ—¥æ˜¯çš„6ï¼š30æ‰§è¡Œä¸€æ¬¡lså‘½ä»¤</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šå½“ç¨‹åºåœ¨ä½ æ‰€æŒ‡å®šçš„æ—¶é—´æ‰§è¡Œåï¼Œç³»ç»Ÿä¼šå¯„ä¸€å°ä¿¡ç»™ä½ ï¼Œæ˜¾ç¤ºè¯¥ç¨‹åºæ‰§è¡Œçš„å†…å®¹ï¼Œè‹¥æ˜¯ä½ ä¸å¸Œæœ›æ”¶åˆ°è¿™æ ·çš„ä¿¡ï¼Œè¯·åœ¨æ¯ä¸€è¡Œç©ºä¸€æ ¼ä¹‹ååŠ ä¸Š <code>&gt; /dev/null 2&gt;&amp;1</code> å³å¯</p>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Automatic </tag>
            
            <tag> Crontab </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxä½¿ç”¨nologinç”¨æˆ·æ‰§è¡Œå‘½ä»¤</title>
      <link href="/posts/2c88f7f6/"/>
      <url>/posts/2c88f7f6/</url>
      
        <content type="html"><![CDATA[<blockquote><p>æˆ‘ä»¬çŸ¥é“å¯ä»¥é€šè¿‡ç¼–è¾‘ <code>/etc/passwd</code> ç»™æŸäº›ç”¨æˆ·è®¾ç½® shell ä¸º <code>nologin</code> æˆ– <code>false</code> å¯ä»¥é˜»æ­¢è¿™äº›ç”¨æˆ·ç™»å½•<br>ä½†æŸäº›æ—¶å€™éœ€è¦ç‰¹å®šçš„ç”¨æˆ·æ¥æ‰§è¡Œå‘½ä»¤ï¼Œå¯ä»¥ä½¿ç”¨ sudo æˆ– su æ¥ä¸´æ—¶åˆ‡æ¢ç”¨æˆ·æ‰§è¡Œ</p></blockquote><h2 id="ä½¿ç”¨-su"><a href="#ä½¿ç”¨-su" class="headerlink" title="ä½¿ç”¨ su"></a>ä½¿ç”¨ su</h2><p><code>su -s</code> æ˜¯æŒ‡å®š shellï¼Œè¿™é‡Œ <code>www</code> ç”¨æˆ·é»˜è®¤ <code>shell</code> æ˜¯ <code>nologin</code> è¿™é‡ŒæŒ‡å®šä½¿ç”¨ <code>/bin/bash</code>, <code>-c</code> åé¢æ¥éœ€è¦è¿è¡Œçš„å‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su www -s /bin/bash -c <span class="string">&quot;mkdir /tmp/111&quot;</span></span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨-sudo"><a href="#ä½¿ç”¨-sudo" class="headerlink" title="ä½¿ç”¨ sudo"></a>ä½¿ç”¨ sudo</h2><p>ä½¿ç”¨ www ç”¨æˆ·æ¥æ‰§è¡Œ <code>mkdir /tmp/111</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -u www <span class="built_in">mkdir</span> /tmp/111</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å®ˆæŠ¤è¿›ç¨‹å·¥å…·supervisor</title>
      <link href="/posts/4d9192f8/"/>
      <url>/posts/4d9192f8/</url>
      
        <content type="html"><![CDATA[<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">apt-get install supervisor</span><br><span class="line">yum install supervisor</span><br><span class="line">pip install supervisor</span><br></pre></td></tr></table></figure><h2 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[program:nginx]</span><br><span class="line">user=gsw945</span><br><span class="line">directory=/data/exec/nginx/sbin/</span><br><span class="line">command=/data/exec/nginx/sbin/nginx -g &quot;daemon off;&quot;</span><br><span class="line">numprocs=1</span><br><span class="line">autostart=true</span><br><span class="line">autorestart=true</span><br><span class="line"></span><br><span class="line">startsecs=5</span><br><span class="line">startretries=3</span><br><span class="line">stopsignal=HUP</span><br><span class="line">stopasgroup=true</span><br><span class="line">stopwaitsecs=5</span><br><span class="line"></span><br><span class="line">redirect_stderr=false</span><br><span class="line">stdout_logfile_maxbytes=20MB</span><br><span class="line">stdout_logfile_backups = 1</span><br><span class="line">stdout_logfile=/var/log/supervisor/%(program_name)s-out.log</span><br><span class="line">stderr_logfile_maxbytes=20MB</span><br><span class="line">stderr_logfile=/var/log/supervisor/%(program_name)s-err.log</span><br><span class="line"></span><br><span class="line">environment=JAVA_HOME=&quot;xxxxxx&quot;,aaa=&quot;bbb&quot;</span><br></pre></td></tr></table></figure><blockquote><p>è¿™ä¸ª directory ç”¨å¤„ï¼š ç¨‹åºè·¯å¾„è¿˜æ˜¯è¦ç”¨ç»å¯¹è·¯å¾„ï¼Œä½†æ˜¯åé¢åŠ çš„å‚æ•°å°±å¯ä»¥ç”Ÿæ•ˆäº†ã€‚</p></blockquote><h3 id="å¯åŠ¨å¤šä¸ªè¿›ç¨‹"><a href="#å¯åŠ¨å¤šä¸ªè¿›ç¨‹" class="headerlink" title="å¯åŠ¨å¤šä¸ªè¿›ç¨‹"></a>å¯åŠ¨å¤šä¸ªè¿›ç¨‹</h3><blockquote><p>numprocs&#x3D;1 å¤§äº 1 ä¸ªè¿›ç¨‹çš„æ—¶å€™ï¼šéœ€è¦åŠ ä¸Šï¼Œ æ¯”å¦‚ç¨‹åºå testï¼Œå¯åŠ¨ 3 ä¸ªè¿›ç¨‹</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">numprocs=3</span><br><span class="line">process_name=%(program_name)s_%(process_num)02d</span><br><span class="line"></span><br><span class="line">è¿›ç¨‹åä¸º:</span><br><span class="line">test:test_00</span><br><span class="line">test:test_01</span><br><span class="line">test:test_02</span><br></pre></td></tr></table></figure><h2 id="å¸¸ç”¨æ“ä½œ"><a href="#å¸¸ç”¨æ“ä½œ" class="headerlink" title="å¸¸ç”¨æ“ä½œ"></a>å¸¸ç”¨æ“ä½œ</h2><h3 id="é‡å¯-daemon-è¿›ç¨‹"><a href="#é‡å¯-daemon-è¿›ç¨‹" class="headerlink" title="é‡å¯ daemon è¿›ç¨‹"></a>é‡å¯ daemon è¿›ç¨‹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo supervisorctl reload</span><br></pre></td></tr></table></figure><h3 id="é‡å¯æœåŠ¡"><a href="#é‡å¯æœåŠ¡" class="headerlink" title="é‡å¯æœåŠ¡"></a>é‡å¯æœåŠ¡</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">supervisorctl restart æœåŠ¡åæˆ–all</span><br></pre></td></tr></table></figure><h3 id="é‡å¯ä¸€ç»„æœåŠ¡"><a href="#é‡å¯ä¸€ç»„æœåŠ¡" class="headerlink" title="é‡å¯ä¸€ç»„æœåŠ¡"></a>é‡å¯ä¸€ç»„æœåŠ¡</h3><p>é‡å¯ test:801-803</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">supervisorctl restart <span class="built_in">test</span>:80&#123;1..3&#125;</span><br></pre></td></tr></table></figure><h3 id="é‡å¯æ‰€æœ‰-test-å¼€å¤´çš„æœåŠ¡"><a href="#é‡å¯æ‰€æœ‰-test-å¼€å¤´çš„æœåŠ¡" class="headerlink" title="é‡å¯æ‰€æœ‰ test å¼€å¤´çš„æœåŠ¡"></a>é‡å¯æ‰€æœ‰ test å¼€å¤´çš„æœåŠ¡</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">supervisorctl restart <span class="built_in">test</span>:</span><br></pre></td></tr></table></figure><h2 id="å¸¸è§é—®é¢˜"><a href="#å¸¸è§é—®é¢˜" class="headerlink" title="å¸¸è§é—®é¢˜"></a>å¸¸è§é—®é¢˜</h2><p>ç”¨ supervisor å®ˆæŠ¤ Prometheus å‘ç° Prometheus ç»å¸¸æŠ¥é”™ max open files ï¼Œ ä½†æ˜¯æ“ä½œç³»ç»Ÿå·²ç»å°† open files è°ƒæ•´åˆ°éå¸¸é«˜äº†ã€‚æ£€æŸ¥ä¸‹æ¥å‘ç°æ˜¯ supervisor ä¸»é…ç½®æ–‡ä»¶é‡Œé¢é™åˆ¶äº† open files æ•°é‡</p><p>vim &#x2F;etc&#x2F;supervisord.conf</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[supervisord]</span></span><br><span class="line"><span class="attr">logfile</span>=/var/log/supervisor/supervisord.log  <span class="comment">; (main log file;default $CWD/supervisord.log)</span></span><br><span class="line"><span class="attr">logfile_maxbytes</span>=<span class="number">50</span>MB       <span class="comment">; (max main logfile bytes b4 rotation;default 50MB)</span></span><br><span class="line"><span class="attr">logfile_backups</span>=<span class="number">10</span>          <span class="comment">; (num of main logfile rotation backups;default 10)</span></span><br><span class="line"><span class="attr">loglevel</span>=info               <span class="comment">; (log level;default info; others: debug,warn,trace)</span></span><br><span class="line"><span class="attr">pidfile</span>=/var/run/supervisord.pid <span class="comment">; (supervisord pidfile;default supervisord.pid)</span></span><br><span class="line"><span class="attr">nodaemon</span>=<span class="literal">false</span>              <span class="comment">; (start in foreground if true;default false)</span></span><br><span class="line"><span class="attr">minfds</span>=<span class="number">1024</span>                 <span class="comment">; (min. avail startup file descriptors;default 1024)</span></span><br><span class="line"><span class="attr">minprocs</span>=<span class="number">200</span>                <span class="comment">; (min. avail process descriptors;default 200)</span></span><br><span class="line"><span class="comment">;umask=022                  ; (process file creation umask;default 022)</span></span><br><span class="line"><span class="comment">;user=chrism                 ; (default is current user, required if root)</span></span><br><span class="line"><span class="comment">;identifier=supervisor       ; (supervisord identifier, default is &#x27;supervisor&#x27;)</span></span><br><span class="line"><span class="comment">;directory=/tmp              ; (default is not to cd during start)</span></span><br><span class="line"><span class="comment">;nocleanup=true              ; (don&#x27;t clean up tempfiles at start;default false)</span></span><br><span class="line"><span class="comment">;childlogdir=/tmp            ; (&#x27;AUTO&#x27; child log dir, default $TEMP)</span></span><br><span class="line"><span class="comment">;environment=KEY=value       ; (key value pairs to add to environment)</span></span><br><span class="line"><span class="comment">;strip_ansi=false            ; (strip ansi escape codes in logs; def. false)</span></span><br></pre></td></tr></table></figure><p>å…¶ä¸­ <code>minfds</code> æ˜¯é™åˆ¶æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œ å°†å€¼è°ƒå¤§å³å¯ï¼Œ éœ€è¦é‡å¯ supervisord æœåŠ¡ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nginxå¼€å¯åŸºæœ¬httpè®¤è¯</title>
      <link href="/posts/5855bc56/"/>
      <url>/posts/5855bc56/</url>
      
        <content type="html"><![CDATA[<blockquote><p>Nginx ä½¿ç”¨ <code>ngx_http_auth_basic_module</code> æ¨¡å—æ”¯æŒ HTTP åŸºæœ¬èº«ä»½éªŒè¯åŠŸèƒ½</p></blockquote><h2 id="nginx-é…ç½®"><a href="#nginx-é…ç½®" class="headerlink" title="nginx é…ç½®"></a>nginx é…ç½®</h2><p>æ¯”å¦‚éœ€è¦&#x2F;api è·¯å¾„ä¸‹çš„èµ„æºéœ€è¦è®¤è¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">location ^~ /api &#123;</span><br><span class="line">    auth_basic &quot;authentication&quot;;</span><br><span class="line">    auth_basic_user_file conf.d/.htpasswd;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é…ç½®å¯†ç æ–‡ä»¶-htpasswd"><a href="#é…ç½®å¯†ç æ–‡ä»¶-htpasswd" class="headerlink" title="é…ç½®å¯†ç æ–‡ä»¶.htpasswd"></a>é…ç½®å¯†ç æ–‡ä»¶.htpasswd</h2><p>ä¸¤ç§æ–¹æ³•äºŒé€‰ä¸€</p><h3 id="ä½¿ç”¨-htpasswd-ç”Ÿæˆ"><a href="#ä½¿ç”¨-htpasswd-ç”Ÿæˆ" class="headerlink" title="ä½¿ç”¨ htpasswd ç”Ÿæˆ"></a>ä½¿ç”¨ htpasswd ç”Ÿæˆ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Ubuntu or Debian</span></span><br><span class="line">apt install apache2-utils</span><br><span class="line"></span><br><span class="line"><span class="comment"># Rhel or CentOS:</span></span><br><span class="line">yum install httpd-tools</span><br></pre></td></tr></table></figure><p>ç”Ÿæˆå¯†ç , å¯†ç æ–‡ä»¶ä¸º <code>.htpasswd</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">htpasswd -bcd .htpasswd username password</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨-openssl-ç”Ÿæˆ"><a href="#ä½¿ç”¨-openssl-ç”Ÿæˆ" class="headerlink" title="ä½¿ç”¨ openssl ç”Ÿæˆ"></a>ä½¿ç”¨ openssl ç”Ÿæˆ</h3><blockquote><p><code>echo -n xxx</code> ä¸æ‰“å°æ¢è¡Œç¬¦</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span>  -n <span class="string">&#x27;username:&#x27;</span> &gt;&gt; .htpasswd</span><br><span class="line">openssl passwd -1 password &gt;&gt; .htpasswd</span><br><span class="line"><span class="comment"># -1 å‚æ•°å¯ä»¥æ¢æˆ -2 -3 ... -6, æ•°å­—è¶Šå¤§,å¯†ç è¶Šé•¿(md5ç®—æ³•). è¿˜å¯ä»¥ -apr1 (Apache variant of the BSD algorithm).</span></span><br></pre></td></tr></table></figure><blockquote><p>openssl ç”Ÿæˆçš„å¯†ç ä¹Ÿå¯ä»¥ç”¨åˆ° linux çš„&#x2F;etc&#x2F;shadow é‡Œé¢</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Nginx </tag>
            
            <tag> Auth </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxæ€§èƒ½åˆ†æ</title>
      <link href="/posts/8ea6978b/"/>
      <url>/posts/8ea6978b/</url>
      
        <content type="html"><![CDATA[<h2 id="vmstat"><a href="#vmstat" class="headerlink" title="vmstat"></a>vmstat</h2><blockquote><p>é—´éš” 1s, ä¸€å…± 5 æ¬¡</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vmstat 1 5</span><br></pre></td></tr></table></figure><p>æ¯ä¸€åˆ—çš„è¯´æ˜</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">Procsï¼ˆè¿›ç¨‹ï¼‰:</span><br><span class="line">- r: è¿è¡Œé˜Ÿåˆ—ä¸­è¿›ç¨‹æ•°é‡</span><br><span class="line">- b: ç­‰å¾…IOçš„è¿›ç¨‹æ•°é‡</span><br><span class="line"></span><br><span class="line">Memoryï¼ˆå†…å­˜ï¼‰:</span><br><span class="line">- swpd: ä½¿ç”¨è™šæ‹Ÿå†…å­˜å¤§å°</span><br><span class="line">- free: å¯ç”¨å†…å­˜å¤§å°</span><br><span class="line">- buff: ç”¨ä½œç¼“å†²çš„å†…å­˜å¤§å°</span><br><span class="line">- cache: ç”¨ä½œç¼“å­˜çš„å†…å­˜å¤§å°</span><br><span class="line"></span><br><span class="line">Swap:</span><br><span class="line">- si: æ¯ç§’ä»äº¤æ¢åŒºå†™åˆ°å†…å­˜çš„å¤§å°</span><br><span class="line">- so: æ¯ç§’å†™å…¥äº¤æ¢åŒºçš„å†…å­˜å¤§å°</span><br><span class="line">- IOï¼šï¼ˆç°åœ¨çš„Linuxç‰ˆæœ¬å—çš„å¤§å°ä¸º1024bytesï¼‰</span><br><span class="line">- bi: æ¯ç§’è¯»å–çš„å—æ•°</span><br><span class="line">- bo: æ¯ç§’å†™å…¥çš„å—æ•°</span><br><span class="line"></span><br><span class="line">systemï¼š</span><br><span class="line">- <span class="keyword">in</span>: æ¯ç§’ä¸­æ–­æ•°ï¼ŒåŒ…æ‹¬æ—¶é’Ÿä¸­æ–­</span><br><span class="line">- cs: æ¯ç§’ä¸Šä¸‹æ–‡åˆ‡æ¢æ•°</span><br><span class="line"></span><br><span class="line">CPUï¼ˆä»¥ç™¾åˆ†æ¯”è¡¨ç¤ºï¼‰</span><br><span class="line">- us: ç”¨æˆ·è¿›ç¨‹æ‰§è¡Œæ—¶é—´(user time)</span><br><span class="line">- sy: ç³»ç»Ÿè¿›ç¨‹æ‰§è¡Œæ—¶é—´(system time)</span><br><span class="line">- <span class="built_in">id</span>: ç©ºé—²æ—¶é—´(åŒ…æ‹¬IOç­‰å¾…æ—¶é—´)</span><br><span class="line">- wa: ç­‰å¾…IOæ—¶é—´</span><br></pre></td></tr></table></figure><h2 id="sar"><a href="#sar" class="headerlink" title="sar"></a>sar</h2><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum  install sysstat</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹ç‰©ç†ç½‘å¡å ç”¨"><a href="#æŸ¥çœ‹ç‰©ç†ç½‘å¡å ç”¨" class="headerlink" title="æŸ¥çœ‹ç‰©ç†ç½‘å¡å ç”¨"></a>æŸ¥çœ‹ç‰©ç†ç½‘å¡å ç”¨</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sar -n DEV 1 5</span><br></pre></td></tr></table></figure><blockquote><p>sar -n é€‰é¡¹ä½¿ç”¨ 6 ä¸ªä¸åŒçš„å¼€å…³ï¼šDEVï¼ŒEDEVï¼ŒNFSï¼ŒNFSDï¼ŒSOCKï¼ŒIPï¼ŒEIPï¼ŒICMPï¼ŒEICMPï¼ŒTCPï¼ŒETCPï¼ŒUDPï¼ŒSOCK6ï¼ŒIP6ï¼ŒEIP6ï¼ŒICMP6ï¼ŒEICMP6 å’Œ UDP6 ï¼ŒDEV æ˜¾ç¤ºç½‘ç»œæ¥å£ä¿¡æ¯ï¼ŒEDEV æ˜¾ç¤ºå…³äºç½‘ç»œé”™è¯¯çš„ç»Ÿè®¡æ•°æ®ï¼ŒNFS ç»Ÿè®¡æ´»åŠ¨çš„ NFS å®¢æˆ·ç«¯çš„ä¿¡æ¯ï¼ŒNFSD ç»Ÿè®¡ NFS æœåŠ¡å™¨çš„ä¿¡æ¯ï¼ŒSOCK æ˜¾ç¤ºå¥—æ¥å­—ä¿¡æ¯ï¼ŒALL æ˜¾ç¤ºæ‰€æœ‰ 5 ä¸ªå¼€å…³ã€‚å®ƒä»¬å¯ä»¥å•ç‹¬æˆ–è€…ä¸€èµ·ä½¿ç”¨ã€‚<br>1 è¡¨ç¤º 1 ç§’ä¸€æ¬¡, 5 è¡¨ç¤ºä¸€å…± 5 æ¬¡</p></blockquote><h3 id="æŸ¥çœ‹-swap"><a href="#æŸ¥çœ‹-swap" class="headerlink" title="æŸ¥çœ‹ swap"></a>æŸ¥çœ‹ swap</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sar -W 1 5</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Command </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxè™šæ‹Ÿå†…å­˜swap</title>
      <link href="/posts/25938561/"/>
      <url>/posts/25938561/</url>
      
        <content type="html"><![CDATA[<h2 id="å¢åŠ -swap-æ–‡ä»¶"><a href="#å¢åŠ -swap-æ–‡ä»¶" class="headerlink" title="å¢åŠ  swap(æ–‡ä»¶)"></a>å¢åŠ  swap(æ–‡ä»¶)</h2><h3 id="åˆ›å»º-swap"><a href="#åˆ›å»º-swap" class="headerlink" title="åˆ›å»º swap"></a>åˆ›å»º swap</h3><p>ç”Ÿæˆä¸€ä¸ªç©ºæ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ª4Gçš„swapæ–‡ä»¶</span></span><br><span class="line">sudo fallocate -l 4G /swapfile</span><br><span class="line"></span><br><span class="line"><span class="comment"># æˆ–è€…ä½¿ç”¨ddå‘½ä»¤æ¥åˆ›å»ºï¼Œå»ºè®®ç”¨fallocateï¼Œæ˜¯ç¬é—´ç”Ÿæˆçš„ï¼Œä¸åƒddçœŸçš„è¦å†™å…¥æ–‡ä»¶å†…å®¹ã€‚</span></span><br><span class="line"><span class="comment"># sudo dd if=/dev/zero of=/swapfile bs=1M count=2048</span></span><br><span class="line"></span><br><span class="line">sudo <span class="built_in">chmod</span> 600 /swapfile</span><br></pre></td></tr></table></figure><p>æ ‡è®°æˆ swap æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mkswap /swapfile</span><br></pre></td></tr></table></figure><h3 id="æ‰‹åŠ¨æŒ‚è½½-swap"><a href="#æ‰‹åŠ¨æŒ‚è½½-swap" class="headerlink" title="æ‰‹åŠ¨æŒ‚è½½ swap"></a>æ‰‹åŠ¨æŒ‚è½½ swap</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">æŒ‚è½½ï¼š </span><br><span class="line">sudo swapon /swapfile</span><br><span class="line"></span><br><span class="line">å¸è½½ï¼š </span><br><span class="line">sudo swapoff /swapfile</span><br></pre></td></tr></table></figure><h3 id="å¼€æœºè‡ªåŠ¨æŒ‚è½½"><a href="#å¼€æœºè‡ªåŠ¨æŒ‚è½½" class="headerlink" title="å¼€æœºè‡ªåŠ¨æŒ‚è½½"></a>å¼€æœºè‡ªåŠ¨æŒ‚è½½</h3><p><code>vim /etc/fstab</code> æ·»åŠ ä¸€è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/swapfile   none  swap  sw  0  0</span><br></pre></td></tr></table></figure><h2 id="åˆ é™¤-swap-æ–‡ä»¶"><a href="#åˆ é™¤-swap-æ–‡ä»¶" class="headerlink" title="åˆ é™¤ swap(æ–‡ä»¶)"></a>åˆ é™¤ swap(æ–‡ä»¶)</h2><h3 id="æŸ¥çœ‹-swap-æ–‡ä»¶åœ°å€"><a href="#æŸ¥çœ‹-swap-æ–‡ä»¶åœ°å€" class="headerlink" title="æŸ¥çœ‹ swap æ–‡ä»¶åœ°å€"></a>æŸ¥çœ‹ swap æ–‡ä»¶åœ°å€</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">swapon</span><br></pre></td></tr></table></figure><h3 id="æ‰‹åŠ¨å…³é—­-swap"><a href="#æ‰‹åŠ¨å…³é—­-swap" class="headerlink" title="æ‰‹åŠ¨å…³é—­ swap"></a>æ‰‹åŠ¨å…³é—­ swap</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo swapoff /swapfile</span><br></pre></td></tr></table></figure><h3 id="åˆ é™¤-swap-æ–‡ä»¶-1"><a href="#åˆ é™¤-swap-æ–‡ä»¶-1" class="headerlink" title="åˆ é™¤ swap æ–‡ä»¶"></a>åˆ é™¤ swap æ–‡ä»¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">rm</span> -f /swapfile</span><br></pre></td></tr></table></figure><h3 id="å–æ¶ˆå¼€æœºè‡ªåŠ¨æŒ‚è½½"><a href="#å–æ¶ˆå¼€æœºè‡ªåŠ¨æŒ‚è½½" class="headerlink" title="å–æ¶ˆå¼€æœºè‡ªåŠ¨æŒ‚è½½"></a>å–æ¶ˆå¼€æœºè‡ªåŠ¨æŒ‚è½½</h3><p><code>vim /etc/fstab</code>, åˆ é™¤åŒ…å« <code>swapfile</code> çš„ä¸€è¡Œ</p><h2 id="åˆ é™¤-swapï¼ˆLVM-åˆ†åŒºï¼‰"><a href="#åˆ é™¤-swapï¼ˆLVM-åˆ†åŒºï¼‰" class="headerlink" title="åˆ é™¤ swapï¼ˆLVM åˆ†åŒºï¼‰"></a>åˆ é™¤ swapï¼ˆLVM åˆ†åŒºï¼‰</h2><h3 id="åˆ¤æ–­æ˜¯å¦æ˜¯-LVM-åˆ†åŒº"><a href="#åˆ¤æ–­æ˜¯å¦æ˜¯-LVM-åˆ†åŒº" class="headerlink" title="åˆ¤æ–­æ˜¯å¦æ˜¯ LVM åˆ†åŒº"></a>åˆ¤æ–­æ˜¯å¦æ˜¯ LVM åˆ†åŒº</h3><p>LVM åˆ†åŒºåš swapï¼Œå¦‚æœä½ ç”¨ centos7 é»˜è®¤å®‰è£…çš„è¯ï¼Œ å°±æ˜¯ç”¨çš„ LV åš swapï¼Œå¯ä»¥ <code>cat /etc/fstab</code> å’Œ <code>lvdisplay</code> ç¡®è®¤ä¸‹<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202404241305360.png" alt="image.png"></p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202404241305675.png" alt="image.png"></p><p>ä¸Šå›¾æ‰€ç¤ºï¼Œ å°±æ˜¯ç”¨çš„ lv åš swap åˆ†åŒº</p><h3 id="å…³é—­-swap"><a href="#å…³é—­-swap" class="headerlink" title="å…³é—­ swap"></a>å…³é—­ swap</h3><p>é©¬ä¸Šå…³é—­ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">swapoff -a</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹é…ç½®æ°¸ä¹…å…³é—­ï¼š<br><code>vim /etc/fstab</code> åˆ é™¤åŒ…å« swap çš„é‚£ä¸€è¡Œ</p><p>ä¿å®ˆä¸€ç‚¹ï¼Œå¦‚æœ swap å ç”¨ç©ºé—´ä¸è¦äº†ï¼Œlvm ä¹Ÿä¸åŠ¨äº†ï¼Œé‚£ä¹ˆå°±åˆ°æ­¤ä¸ºæ­¢å°±è¡Œã€‚</p><h3 id="åˆ é™¤-swap-çš„-LV"><a href="#åˆ é™¤-swap-çš„-LV" class="headerlink" title="åˆ é™¤ swap çš„ LV"></a>åˆ é™¤ swap çš„ LV</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># lvremove &lt;vgåå­—&gt; &lt;lvåå­—&gt;</span></span><br><span class="line">lvremove centos swap</span><br></pre></td></tr></table></figure><p>æ‰©å®¹å‰©ä¸‹çš„ LV</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lvextend -l +100%FREE /dev/mapper/centos-root</span><br></pre></td></tr></table></figure><p>åŠ¨æ€å¢åŠ ç£ç›˜å¤§å°</p><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">extæ–‡ä»¶ç³»ç»Ÿ</button><button type="button" class="tab">xfsæ–‡ä»¶ç³»ç»Ÿ</button><button type="button" class="tab">RHEL</button></div><div class="tab-contents"><div class="tab-item-content active"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo resize2fs  /dev/sdb1</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo xfs_growfs /dev/sdb1</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><p>åœ¨æ—©æœŸçš„ RHEL ä¸­ï¼Œç”±äº resize2fs æ— åœ¨çº¿ resize åŠŸèƒ½ï¼Œæ•…é¢å¤–æä¾›äº† ext2onlineã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ext2online /dev/sdb1</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div><h3 id="ä¿®æ”¹å†…æ ¸å‚æ•°"><a href="#ä¿®æ”¹å†…æ ¸å‚æ•°" class="headerlink" title="ä¿®æ”¹å†…æ ¸å‚æ•°"></a>ä¿®æ”¹å†…æ ¸å‚æ•°</h3><p>CentOS7 ç³»ç»Ÿä¿®æ”¹ <code>/etc/default/grub</code></p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202404241418956.png" alt="image.png"></p><p>ç„¶åæ‰§è¡Œ:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grub2-mkconfig -o /boot/grub2/grub.cfg</span><br></pre></td></tr></table></figure><p>æ›´æ–° grub é…ç½®</p><p>å¦‚æœä½ å·²ç»åˆ é™¤äº† LVï¼Œä½†æ˜¯å¿˜è®°ä¿®æ”¹å†…æ ¸å‚æ•°äº†ï¼Œé‚£ä¹ˆé‡å¯åä¼šæ— æ³•å¯åŠ¨ï¼Œè§£å†³æ–¹æ³•è§ï¼š<a href="/posts/scfoaz/">centosåˆ é™¤swapåæ— æ³•å¯åŠ¨</a></p><h2 id="è°ƒæ•´å†…æ ¸-swap-ç­–ç•¥"><a href="#è°ƒæ•´å†…æ ¸-swap-ç­–ç•¥" class="headerlink" title="è°ƒæ•´å†…æ ¸ swap ç­–ç•¥"></a>è°ƒæ•´å†…æ ¸ swap ç­–ç•¥</h2><p>swap ä½¿ç”¨æ˜¯æ ¹æ®å†…æ ¸å‚æ•° <code>vm.swappiness</code> å†³å®šçš„ï¼Œ æ•°å€¼è¶Šå¤§è¡¨ç¤ºå†…æ ¸ä¼šæ›´åŠ ç§¯æçš„å°†å†…å­˜ä¸­çš„æ•°æ®ç§»åŠ¨åˆ° Swap åˆ†åŒº</p><table><thead><tr><th>vm.swappiness</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>0</td><td>æŒ‡ç¤ºå†…æ ¸å°½å¯èƒ½é¿å…äº¤æ¢ã€‚</td></tr><tr><td>10-50</td><td>æŒ‡ç¤ºå†…æ ¸åœ¨æ¢å‡ºå†…å­˜é¡µé¢æ—¶ç¨å¾®ç§¯æä¸€äº›</td></tr><tr><td>50-100</td><td>æŒ‡ç¤ºå†…æ ¸åœ¨æ¢å‡ºå†…å­˜é¡µé¢æ—¶é€‚åº¦ç§¯æ</td></tr><tr><td>100</td><td>æŒ‡ç¤ºå†…æ ¸åœ¨æ¢å‡ºå†…å­˜é¡µé¢æ—¶éå¸¸ç§¯æ</td></tr></tbody></table><h3 id="æŸ¥çœ‹å†…æ ¸å‚æ•°"><a href="#æŸ¥çœ‹å†…æ ¸å‚æ•°" class="headerlink" title="æŸ¥çœ‹å†…æ ¸å‚æ•°"></a>æŸ¥çœ‹å†…æ ¸å‚æ•°</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sysctl -a</span><br><span class="line">sysctl vm.swappiness</span><br></pre></td></tr></table></figure><h3 id="ä¸´æ—¶ä¿®æ”¹"><a href="#ä¸´æ—¶ä¿®æ”¹" class="headerlink" title="ä¸´æ—¶ä¿®æ”¹"></a>ä¸´æ—¶ä¿®æ”¹</h3><h4 id="æ–¹æ³•ä¸€"><a href="#æ–¹æ³•ä¸€" class="headerlink" title="æ–¹æ³•ä¸€"></a>æ–¹æ³•ä¸€</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysctl vm.swappiness=80</span><br></pre></td></tr></table></figure><h4 id="æ–¹æ³•äºŒ"><a href="#æ–¹æ³•äºŒ" class="headerlink" title="æ–¹æ³•äºŒ"></a>æ–¹æ³•äºŒ</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;80&quot;</span> &gt; /proc/sys/vm/swappiness</span><br></pre></td></tr></table></figure><h3 id="æ°¸ä¹…ä¿®æ”¹"><a href="#æ°¸ä¹…ä¿®æ”¹" class="headerlink" title="æ°¸ä¹…ä¿®æ”¹"></a>æ°¸ä¹…ä¿®æ”¹</h3><p><code>vim /etc/sysctl.conf</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vm.swappiness = 80</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œ <code>sysctl -p</code> é©¬ä¸Šç”Ÿæ•ˆã€‚</p>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pythonç¯å¢ƒæ‰“åŒ…</title>
      <link href="/posts/15e02d6d/"/>
      <url>/posts/15e02d6d/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸ºä»€ä¹ˆè¦æ‰“åŒ…"><a href="#ä¸ºä»€ä¹ˆè¦æ‰“åŒ…" class="headerlink" title="ä¸ºä»€ä¹ˆè¦æ‰“åŒ…"></a>ä¸ºä»€ä¹ˆè¦æ‰“åŒ…</h2><p>å…¬å¸æœ‰ä¸ªè¿œå¤é¡¹ç›®, ç”¨åˆ°çš„æ˜¯ <code>fabric1.x</code>, åªæ”¯æŒ <code>python2</code> ç‰ˆæœ¬, å¹¶ä¸”å¯¹ç¯å¢ƒè¦æ±‚æ¯”è¾ƒè‹›åˆ», è€Œä¸”ä»£ç å·²ç»æ— äººç»´æŠ¤, è¿™ç§æƒ…å†µä¸‹å°†åŒ…å›ºå®šä¸‹æ¥, ä¿è¯ä»£ç å¯ä»¥è¿è¡Œ</p><h2 id="å®‰è£…-pyenv-ç¯å¢ƒ"><a href="#å®‰è£…-pyenv-ç¯å¢ƒ" class="headerlink" title="å®‰è£… pyenv ç¯å¢ƒ"></a>å®‰è£… pyenv ç¯å¢ƒ</h2><blockquote><p>pyenv å®˜ç½‘ <a href="https://github.com/pyenv/pyenv">https://github.com/pyenv/pyenv</a>ï¼Œpyenv å’Œå…¶ä»–çš„è™šæ‹Ÿç¯å¢ƒä¸åŒä¹‹å¤„åœ¨äºå®ƒå¯ä»¥å®‰è£…ä»»æ„ç‰ˆæœ¬çš„ python ç¯å¢ƒï¼ˆæºç ç¼–è¯‘ï¼‰<br>æ‰€ä»¥éœ€è¦å®‰è£…ç¼–è¯‘ python çš„ç¯å¢ƒã€‚</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install -y git zlib zlib-devel libffi-devel openssl openssl-devel readline-devel bzip2-devel sqlite-devel</span><br><span class="line">curl https://pyenv.run | bash</span><br></pre></td></tr></table></figure><h2 id="åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ"><a href="#åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ" class="headerlink" title="åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ"></a>åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ</h2><blockquote><p>å®‰è£… python2.7.18 çš„è™šæ‹Ÿç¯å¢ƒ, æ­¤ç¯å¢ƒåªç»™ fabric ç”¨, æ‰€ä»¥å°±æ²¡æœ‰æ·»åŠ åˆ°ç¯å¢ƒå˜é‡, ä»¥å…å½±å“å…¶ä»– python ç¨‹åº</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install sqlite-devel bzip2-devel readline-devel</span><br><span class="line"></span><br><span class="line">/root/.pyenv/bin/pyenv install 2.7.18</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒå®‰è£…éœ€è¦çš„åŒ…"><a href="#ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒå®‰è£…éœ€è¦çš„åŒ…" class="headerlink" title="ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒå®‰è£…éœ€è¦çš„åŒ…"></a>ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒå®‰è£…éœ€è¦çš„åŒ…</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/root/.pyenv/versions/2.7.18/bin/pip install fabric==1.14.1</span><br></pre></td></tr></table></figure><p>å®‰è£…å®Œæˆååœ¨ <code>/root/.pyenv/versions/2.7.18/bin</code> çœ‹åˆ°äº† fab å¯æ‰§è¡Œç¨‹åº</p><h2 id="åˆ›å»ºè½¯é“¾æ¥"><a href="#åˆ›å»ºè½¯é“¾æ¥" class="headerlink" title="åˆ›å»ºè½¯é“¾æ¥"></a>åˆ›å»ºè½¯é“¾æ¥</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ln</span> -sf /root/.pyenv/versions/2.7.18/bin/fab /usr/local/bin/fab</span><br></pre></td></tr></table></figure><p>è¿™æ · fab çš„ç¯å¢ƒå°±å‡†å¤‡å¥½äº†, åé¢åªéœ€è¦æŠŠ <code>/root/.pyenv</code> æ‰“åŒ…åˆ†å‘ç»™å…¶ä»–æœºå™¨<br>å…¶å®è¿˜å¯ä»¥ä½¿ç”¨ pyinstaller æ‰“åŒ…, ä¸è¿‡æˆ‘æ„Ÿè§‰æ²¡å•¥å¿…è¦äº†.</p>]]></content>
      
      
      <categories>
          
          <category> å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Windowsç³»ç»Ÿç¯å¢ƒå˜é‡</title>
      <link href="/posts/7468bc35/"/>
      <url>/posts/7468bc35/</url>
      
        <content type="html"><![CDATA[<blockquote><p>ç¯å¢ƒå˜é‡ç®€å•æ¥è¯´å°±æ˜¯ä¸€ä¸ªé”®å€¼å¯¹ï¼Œæ¯”è¾ƒå¸¸è§çš„æ˜¯ <code>path</code> ç¯å¢ƒå˜é‡ï¼Œå®šä¹‰çš„æ˜¯å…¨å±€ç¨‹åºå­˜æ”¾çš„ä½ç½®</p></blockquote><p>Windows æŸ¥çœ‹ç¯å¢ƒå˜é‡ ä½¿ç”¨ <code>echo %date%</code></p><h2 id="ç”¨æˆ·ç¯å¢ƒå˜é‡"><a href="#ç”¨æˆ·ç¯å¢ƒå˜é‡" class="headerlink" title="ç”¨æˆ·ç¯å¢ƒå˜é‡"></a>ç”¨æˆ·ç¯å¢ƒå˜é‡</h2><p>æ³¨å†Œè¡¨ä½ç½®ï¼š<code>HKEY_CURRENT_USER\Environment</code> ç”¨æˆ·ç¯å¢ƒå˜é‡åªå¯¹å½“å‰ç”¨æˆ·èµ·ä½œç”¨</p><h2 id="ç³»ç»Ÿç¯å¢ƒå˜é‡"><a href="#ç³»ç»Ÿç¯å¢ƒå˜é‡" class="headerlink" title="ç³»ç»Ÿç¯å¢ƒå˜é‡"></a>ç³»ç»Ÿç¯å¢ƒå˜é‡</h2><p>æ³¨å†Œè¡¨ä½ç½®ï¼š<code>HKEY_LOCAL_MACHINE\SYSTEM\ControlSet001\Control\Session Manager\Environment</code></p><h3 id="å¸¸ç”¨ç³»ç»Ÿè‡ªå¸¦å˜é‡"><a href="#å¸¸ç”¨ç³»ç»Ÿè‡ªå¸¦å˜é‡" class="headerlink" title="å¸¸ç”¨ç³»ç»Ÿè‡ªå¸¦å˜é‡"></a>å¸¸ç”¨ç³»ç»Ÿè‡ªå¸¦å˜é‡</h3><table><thead><tr><th>å˜é‡</th><th>ç±»ä¼¼æ ¼å¼</th></tr></thead><tbody><tr><td>%COMMONPROGRAMFILES%</td><td>C:\Program Files\Common Files</td></tr><tr><td>%COMMONPROGRAMFILES(x86)%</td><td>C:\Program Files (x86)\Common Files</td></tr><tr><td>%PROGRAMFILES%</td><td>C:\Program Files</td></tr><tr><td>%PROGRAMFILES(X86)%</td><td>C:\Program Files (x86)</td></tr><tr><td>%COMSPEC%</td><td>C:\Windows\System32\cmd.exe</td></tr><tr><td>%HOMEDRIVE%</td><td>C:</td></tr><tr><td>%HOMEPATH%</td><td>C:\Users\iuxt</td></tr><tr><td>%SYSTEMROOT%</td><td>C:\Windows</td></tr><tr><td>%WINDIR%</td><td>C:\Windows</td></tr><tr><td>%TMP%</td><td>C:\Users\iuxt\AppData\Local\Temp</td></tr><tr><td>%TEMP%</td><td>C:\Users\iuxt\AppData\Local\Temp</td></tr><tr><td>%CD%</td><td>å½“å‰ç›®å½•</td></tr><tr><td>%DATE%</td><td>å½“å‰æ—¥æœŸ</td></tr><tr><td>%TIME%</td><td>æ—¶é—´</td></tr><tr><td>%APPDATA%</td><td>C:\Users\iuxt\AppData\Roaming</td></tr><tr><td>%LOCALAPPDATA%</td><td>C:\Users\iuxt\AppData\Local</td></tr><tr><td>%SYSTEMDRIVE%</td><td>C:</td></tr><tr><td>%USERNAME%</td><td>iuxt</td></tr><tr><td>%USERPROFILE%</td><td>C:\Users\iuxt</td></tr><tr><td>%ONEDRIVE%</td><td>C:\Users\iuxt\OneDrive</td></tr><tr><td>%ERRORLEVEL%</td><td>ä¸Šä¸€ä¸ªå‘½ä»¤çš„é”™è¯¯ç ï¼Œ ç±»ä¼¼äº linux é‡Œé¢çš„ $?</td></tr><tr><td>%PROGRAMDATA%</td><td>C:\ProgramData</td></tr><tr><td>%PUBLIC%</td><td>C:\Users\Public</td></tr><tr><td>%COMPUTERNAME%</td><td>è®¡ç®—æœºå</td></tr><tr><td>%RANDOM%</td><td>éšæœºæ•°ï¼ˆ0-32767ï¼‰</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linuxç£ç›˜æ‰©å®¹(éLVM)</title>
      <link href="/posts/33420276/"/>
      <url>/posts/33420276/</url>
      
        <content type="html"><![CDATA[<p>LVM æ˜¯ <code>Logical Volume Manager</code> çš„ç¼©å†™ï¼Œä¸­æ–‡é€»è¾‘å·ç®¡ç†ï¼ŒLVM æ˜¯å»ºç«‹åœ¨ç£ç›˜åˆ†åŒºå’Œæ–‡ä»¶ç³»ç»Ÿä¹‹é—´çš„ä¸€ä¸ªé€»è¾‘å±‚ï¼ŒLVM ä¼šæ›´åŠ çµæ´»ï¼Œå¯ä»¥åŠ¨æ€æ‰©å®¹ç¼©å®¹åˆ†åŒºå¤§å°ã€‚è°ƒæ•´åˆ†åŒºå¤§å°æœ‰é£é™©ï¼Œè¯·åšå¥½å……åˆ†æµ‹è¯•å†å†³å®šæ˜¯å¦æ‰§è¡Œã€‚<br>å¦‚æœå¯ç”¨äº† <code>lvm</code>ï¼Œè¯·æŸ¥çœ‹ <a href="/posts/f4ea28c3/">LVMé€»è¾‘å·ç®¡ç†</a><br>é‚£ä¹ˆæ€ä¹ˆçŸ¥é“æœºå™¨æœ‰æ²¡æœ‰å¯ç”¨ LVM å‘¢ï¼Œå¯ä»¥æ‰§è¡Œ <code>sudo lvdisplay</code> æŸ¥çœ‹æœ‰æ²¡æœ‰å·²å­˜åœ¨çš„ LVï¼Œ<code>lsblk</code> æŸ¥çœ‹ç°æœ‰çš„æ–‡ä»¶ç³»ç»Ÿæœ‰æ²¡æœ‰ <code>LVM</code></p><blockquote><p>ç½‘ä¸ŠæŸ¥åˆ°çš„æ–¹æ³•éƒ½æ˜¯ä½¿ç”¨ <code>fdisk</code> åˆ é™¤åˆ†åŒºåå†é‡æ–°åˆ›å»º, è¿™ç§æ–¹å¼ä¼šæœ‰å®‰å…¨é—®é¢˜, è€Œ <code>growpart</code> å‘½ä»¤æ˜¯å®‰å…¨çš„.</p></blockquote><h2 id="æ‰©å®¹å™¨æŸ¥çœ‹å®¹é‡å¤§å°"><a href="#æ‰©å®¹å™¨æŸ¥çœ‹å®¹é‡å¤§å°" class="headerlink" title="æ‰©å®¹å™¨æŸ¥çœ‹å®¹é‡å¤§å°"></a>æ‰©å®¹å™¨æŸ¥çœ‹å®¹é‡å¤§å°</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@elk4 ~]<span class="comment"># df -h</span></span><br><span class="line">Filesystem      Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/vdb1       985G  165G  770G  18% /data</span><br></pre></td></tr></table></figure><blockquote><p>å¦‚æœä½ è¦æ‰©å®¹çš„è·¯å¾„å¯¹åº”çš„ <code>Filesystem</code> ä¸æ˜¯ <code>/dev/sdx</code> è¯·ä¸è¦çœ‹è¿™ç¯‡æ–‡ç« </p></blockquote><h2 id="å…ˆå¢åŠ ç¡¬ç›˜å®¹é‡"><a href="#å…ˆå¢åŠ ç¡¬ç›˜å®¹é‡" class="headerlink" title="å…ˆå¢åŠ ç¡¬ç›˜å®¹é‡"></a>å…ˆå¢åŠ ç¡¬ç›˜å®¹é‡</h2><blockquote><p>éœ€è¦ growpart å‘½ä»¤, æ²¡æœ‰è¯·å®‰è£…</p></blockquote><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">Ubuntuå’ŒDebian</button><button type="button" class="tab">CentOSå’ŒFedora</button></div><div class="tab-contents"><div class="tab-item-content active"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install cloud-guest-utils</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install cloud-utils-growpart</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div><h2 id="æ‰§è¡Œ-growpart-å‘½ä»¤"><a href="#æ‰§è¡Œ-growpart-å‘½ä»¤" class="headerlink" title="æ‰§è¡Œ growpart å‘½ä»¤"></a>æ‰§è¡Œ growpart å‘½ä»¤</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@elk4 ~]<span class="comment"># growpart /dev/vdb 1</span></span><br><span class="line">CHANGED: partition=1 start=2048 old: size=2097149952 end=2097152000 new: size=3145725919 end=3145727967</span><br></pre></td></tr></table></figure><h2 id="æœ€åè°ƒæ•´æ–‡ä»¶ç³»ç»Ÿå¤§å°"><a href="#æœ€åè°ƒæ•´æ–‡ä»¶ç³»ç»Ÿå¤§å°" class="headerlink" title="æœ€åè°ƒæ•´æ–‡ä»¶ç³»ç»Ÿå¤§å°"></a>æœ€åè°ƒæ•´æ–‡ä»¶ç³»ç»Ÿå¤§å°</h2><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">extæ–‡ä»¶ç³»ç»Ÿ</button><button type="button" class="tab">xfsæ–‡ä»¶ç³»ç»Ÿ</button><button type="button" class="tab">RHEL</button></div><div class="tab-contents"><div class="tab-item-content active"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo resize2fs  /dev/sdb1</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo xfs_growfs /dev/sdb1</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><p>åœ¨æ—©æœŸçš„ RHEL ä¸­ï¼Œç”±äº resize2fs æ— åœ¨çº¿ resize åŠŸèƒ½ï¼Œæ•…é¢å¤–æä¾›äº† ext2onlineã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ext2online /dev/sdb1</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Disk </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>zookeeperé›†ç¾¤æ­å»º</title>
      <link href="/posts/sds4db/"/>
      <url>/posts/sds4db/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸‹è½½"><a href="#ä¸‹è½½" class="headerlink" title="ä¸‹è½½"></a>ä¸‹è½½</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://dlcdn.apache.org/zookeeper/zookeeper-3.8.4/apache-zookeeper-3.8.4-bin.tar.gz</span><br></pre></td></tr></table></figure><p>Zookeeper æ˜¯ä¸ºå…¶ä»–åˆ†å¸ƒå¼ç¨‹åºæä¾›æœåŠ¡çš„ï¼Œæ‰€ä»¥æœ¬èº«è‡ªå·±ä¸èƒ½éšä¾¿å°±æŒ‚äº†ï¼Œæ‰€ä»¥ zookeeper è‡ªèº«çš„é›†ç¾¤æœºåˆ¶å°±å¾ˆé‡è¦ã€‚zookeeper çš„é›†ç¾¤æœºåˆ¶é‡‡ç”¨çš„æ˜¯åŠæ•°å­˜æ´»æœºåˆ¶ï¼Œä¹Ÿå°±æ˜¯æ•´ä¸ªé›†ç¾¤èŠ‚ç‚¹ä¸­æœ‰åŠæ•°ä»¥ä¸Šçš„èŠ‚ç‚¹å­˜æ´»ï¼Œé‚£ä¹ˆæ•´ä¸ªé›†ç¾¤ç¯å¢ƒå¯ç”¨ã€‚è¿™ä¹Ÿå°±æ˜¯è¯´ä»¬çš„é›†ç¾¤èŠ‚ç‚¹æœ€å¥½æ˜¯å¥‡æ•°ä¸ªèŠ‚ç‚¹ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y java-1.8.0-openjdk</span><br></pre></td></tr></table></figure><h2 id="åˆ›å»ºé…ç½®æ–‡ä»¶"><a href="#åˆ›å»ºé…ç½®æ–‡ä»¶" class="headerlink" title="åˆ›å»ºé…ç½®æ–‡ä»¶"></a>åˆ›å»ºé…ç½®æ–‡ä»¶</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /data/zookeeper_&#123;<span class="built_in">log</span>,data&#125;</span><br></pre></td></tr></table></figure><p>è°ƒæ•´é…ç½®æ–‡ä»¶ <code>/data/apache-zookeeper-3.8.4-bin/conf/zoo.cfg</code></p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">tickTime</span>=<span class="number">2000</span></span><br><span class="line"><span class="attr">initLimit</span>=<span class="number">10</span></span><br><span class="line"><span class="attr">syncLimit</span>=<span class="number">5</span></span><br><span class="line"><span class="attr">dataLogDir</span>=/data/zookeeper_log</span><br><span class="line"><span class="attr">dataDir</span>=/data/zookeeper_data</span><br><span class="line"><span class="attr">clientPort</span>=<span class="number">2181</span></span><br><span class="line"><span class="attr">autopurge.snapRetainCount</span>=<span class="number">500</span></span><br><span class="line"><span class="attr">autopurge.purgeInterval</span>=<span class="number">24</span></span><br><span class="line"><span class="attr">server.1</span>=<span class="number">10.0</span>.<span class="number">0.11</span>:<span class="number">2888</span>:<span class="number">3888</span></span><br><span class="line"><span class="attr">server.2</span>=<span class="number">10.0</span>.<span class="number">0.12</span>:<span class="number">2888</span>:<span class="number">3888</span></span><br><span class="line"><span class="attr">server.3</span>=<span class="number">10.0</span>.<span class="number">0.13</span>:<span class="number">2888</span>:<span class="number">3888</span></span><br></pre></td></tr></table></figure><h2 id="myid-é…ç½®"><a href="#myid-é…ç½®" class="headerlink" title="myid é…ç½®"></a>myid é…ç½®</h2><p>é™¤äº†ä¿®æ”¹ zoo.cfg é…ç½®æ–‡ä»¶å¤–,zookeeper é›†ç¾¤æ¨¡å¼ä¸‹è¿˜è¦é…ç½®ä¸€ä¸ª myid æ–‡ä»¶,è¿™ä¸ªæ–‡ä»¶éœ€è¦æ”¾åœ¨ dataDir ç›®å½•ä¸‹<br>è¿™ä¸ªæ–‡ä»¶é‡Œé¢æœ‰ä¸€ä¸ªæ•°æ®å°±æ˜¯ A çš„å€¼ï¼ˆè¯¥ A å°±æ˜¯ zoo.cfg æ–‡ä»¶ä¸­ server.A&#x3D;B:C:D ä¸­çš„ Aï¼‰,åœ¨ zoo.cfg æ–‡ä»¶ä¸­é…ç½®çš„ dataDir è·¯å¾„ä¸­åˆ›å»º myid æ–‡ä»¶ã€‚</p><p>ä¸åŒæœåŠ¡å™¨é…ç½®ä¸ä¸€æ ·</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¬¬ä¸€å°æœåŠ¡å™¨</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;1&quot;</span> &gt; /data/zookeeper_data/myid</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¬¬äºŒå°æœåŠ¡å™¨</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;2&quot;</span> &gt; /data/zookeeper_data/myid</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¬¬ä¸‰å°æœåŠ¡å™¨</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;3&quot;</span> &gt; /data/zookeeper_data/myid</span><br></pre></td></tr></table></figure><h2 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯åŠ¨zookeeper</span></span><br><span class="line">/data/apache-zookeeper-3.8.4-bin/bin/zkServer.sh start</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹zookeeperæœåŠ¡çŠ¶æ€</span></span><br><span class="line">/data/apache-zookeeper-3.8.4-bin/bin/zkServer.sh status</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æ—¥å¿— </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
            <tag> æ­å»º </tag>
            
            <tag> HA </tag>
            
            <tag> æœ‰çŠ¶æ€æœåŠ¡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Windowsç½‘ç»œç®¡ç†å‘½ä»¤netsh</title>
      <link href="/posts/f85b3ad3/"/>
      <url>/posts/f85b3ad3/</url>
      
        <content type="html"><![CDATA[<blockquote><p>netsh æ˜¯ windows å¹³å°ç½‘ç»œç®¡ç†å‘½ä»¤</p></blockquote><h2 id="é˜²ç«å¢™è®¾ç½®"><a href="#é˜²ç«å¢™è®¾ç½®" class="headerlink" title="é˜²ç«å¢™è®¾ç½®"></a>é˜²ç«å¢™è®¾ç½®</h2><h3 id="å¼€å¯é˜²ç«å¢™"><a href="#å¼€å¯é˜²ç«å¢™" class="headerlink" title="å¼€å¯é˜²ç«å¢™"></a>å¼€å¯é˜²ç«å¢™</h3><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sc config mpsdrv <span class="built_in">start</span>= auto</span><br><span class="line">sc config mpssvc <span class="built_in">start</span>= auto</span><br><span class="line">sc <span class="built_in">start</span> mpsdrv</span><br><span class="line">sc <span class="built_in">start</span> mpssvc</span><br><span class="line"></span><br><span class="line">netsh advfirewall <span class="built_in">set</span> allprofiles state on</span><br></pre></td></tr></table></figure><h3 id="è§„åˆ™é…ç½®"><a href="#è§„åˆ™é…ç½®" class="headerlink" title="è§„åˆ™é…ç½®"></a>è§„åˆ™é…ç½®</h3><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">:: æ‹’ç»æŒ‡å®šIPè®¿é—®æŒ‡å®šç«¯å£</span><br><span class="line">netsh advfirewall firewall add rule name=BlockRTX <span class="built_in">dir</span>=<span class="keyword">in</span> protocol=tcp localport=<span class="number">8000</span> action=block enable=yes remoteip=<span class="number">192</span>.<span class="number">168</span>.<span class="number">5</span>.<span class="number">2</span></span><br><span class="line"></span><br><span class="line">:: å¼€æ”¾ä¸€ä¸ªç«¯å£</span><br><span class="line">netsh advfirewall firewall add rule name=&quot;<span class="number">445</span>&quot; protocol=TCP <span class="built_in">dir</span>=<span class="keyword">in</span> localport=<span class="number">445</span> action=allow</span><br><span class="line"></span><br><span class="line">:: windows xp ä½¿ç”¨</span><br><span class="line">netsh firewall <span class="built_in">set</span> portopening TCP <span class="number">445</span> ENABLE</span><br></pre></td></tr></table></figure><h3 id="é˜²ç«å¢™é…ç½®"><a href="#é˜²ç«å¢™é…ç½®" class="headerlink" title="é˜²ç«å¢™é…ç½®"></a>é˜²ç«å¢™é…ç½®</h3><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">:: å…³é—­é˜²ç«å¢™</span><br><span class="line">netsh firewall <span class="built_in">set</span> opmode <span class="built_in">mode</span>=disable</span><br><span class="line"></span><br><span class="line">:: é˜²ç«å¢™æ¢å¤é»˜è®¤é…ç½®</span><br><span class="line">netsh firewall reset</span><br></pre></td></tr></table></figure><h2 id="ä¿®æ”¹ç½‘ç»œè®¾ç½®"><a href="#ä¿®æ”¹ç½‘ç»œè®¾ç½®" class="headerlink" title="ä¿®æ”¹ç½‘ç»œè®¾ç½®"></a>ä¿®æ”¹ç½‘ç»œè®¾ç½®</h2><h3 id="ä¿®æ”¹-ipã€dns-ç­‰"><a href="#ä¿®æ”¹-ipã€dns-ç­‰" class="headerlink" title="ä¿®æ”¹ ipã€dns ç­‰"></a>ä¿®æ”¹ ipã€dns ç­‰</h3><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># STATIC</span><br><span class="line">netsh interface ip <span class="built_in">set</span> address &quot;ä»¥å¤ªç½‘&quot; static <span class="number">192</span>.<span class="number">168</span>.<span class="number">8</span>.<span class="number">88</span> <span class="number">255</span>.<span class="number">255</span>.<span class="number">252</span>.<span class="number">0</span> <span class="number">192</span>.<span class="number">168</span>.<span class="number">8</span>.<span class="number">3</span></span><br><span class="line">netsh interface ip <span class="built_in">set</span> dns &quot;ä»¥å¤ªç½‘&quot; static <span class="number">114</span>.<span class="number">114</span>.<span class="number">114</span>.<span class="number">114</span></span><br><span class="line">netsh interface ip add dns &quot;ä»¥å¤ªç½‘&quot; <span class="number">114</span>.<span class="number">114</span>.<span class="number">115</span>.<span class="number">115</span></span><br><span class="line"></span><br><span class="line"># DHCP</span><br><span class="line">netsh interface ip <span class="built_in">set</span> address &quot;ä»¥å¤ªç½‘&quot; dhcp</span><br><span class="line">netsh interface ip <span class="built_in">set</span> dns &quot;ä»¥å¤ªç½‘&quot; dhcp</span><br></pre></td></tr></table></figure><h2 id="ç«¯å£è½¬å‘"><a href="#ç«¯å£è½¬å‘" class="headerlink" title="ç«¯å£è½¬å‘"></a>ç«¯å£è½¬å‘</h2><h3 id="å¯ç”¨-IP-Helper-æœåŠ¡"><a href="#å¯ç”¨-IP-Helper-æœåŠ¡" class="headerlink" title="å¯ç”¨ IP Helper æœåŠ¡"></a>å¯ç”¨ IP Helper æœåŠ¡</h3><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sc config iphlpsvc <span class="built_in">start</span>=auto</span><br><span class="line"><span class="built_in">net</span> <span class="built_in">start</span> iphlpsvc</span><br></pre></td></tr></table></figure><h3 id="å¼€å¯-IPv4-è½¬å‘"><a href="#å¼€å¯-IPv4-è½¬å‘" class="headerlink" title="å¼€å¯ IPv4 è½¬å‘"></a>å¼€å¯ IPv4 è½¬å‘</h3><p>åœ¨æ³¨å†Œè¡¨ä¸­ä¿®æ”¹ï¼š</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reg add HKLM\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters /v IPEnableRouter /t REG_DWORD /d <span class="number">1</span> /f</span><br></pre></td></tr></table></figure><p>ç„¶åé‡å¯ç”µè„‘ä½¿å…¶ç”Ÿæ•ˆã€‚</p><h3 id="è½¬å‘é…ç½®"><a href="#è½¬å‘é…ç½®" class="headerlink" title="è½¬å‘é…ç½®"></a>è½¬å‘é…ç½®</h3><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">ä½¿ç”¨ netsh å°†æœ¬åœ° <span class="number">8080</span> ç«¯å£çš„æµé‡è½¬å‘åˆ° <span class="number">192</span>.<span class="number">168</span>.<span class="number">1</span>.<span class="number">100</span>:<span class="number">80</span></span><br><span class="line">netsh interface portproxy add v4tov4 listenport=<span class="number">8080</span> listenaddress=<span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span> connectport=<span class="number">80</span> connectaddress=<span class="number">192</span>.<span class="number">168</span>.<span class="number">1</span>.<span class="number">100</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">æŸ¥çœ‹å½“å‰ç«¯å£è½¬å‘è§„åˆ™</span><br><span class="line">netsh interface portproxy show all</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">åˆ é™¤æŒ‡å®šç«¯å£è½¬å‘</span><br><span class="line">netsh interface portproxy delete v4tov4 listenport=<span class="number">8080</span> listenaddress=<span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">æµ‹è¯•è½¬å‘æ˜¯å¦ç”Ÿæ•ˆ</span><br><span class="line">netstat -ano | <span class="built_in">findstr</span> :<span class="number">8080</span></span><br></pre></td></tr></table></figure><h3 id="é˜²ç«å¢™é…ç½®-1"><a href="#é˜²ç«å¢™é…ç½®-1" class="headerlink" title="é˜²ç«å¢™é…ç½®"></a>é˜²ç«å¢™é…ç½®</h3><p>é˜²ç«å¢™è¦å…è®¸ç«¯å£å¯ä»¥è¢«è®¿é—®</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netsh advfirewall firewall add rule name=&quot;Allow Port <span class="number">8080</span>&quot; <span class="built_in">dir</span>=<span class="keyword">in</span> action=allow protocol=TCP localport=<span class="number">8080</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LVMé€»è¾‘å·ç®¡ç†</title>
      <link href="/posts/f4ea28c3/"/>
      <url>/posts/f4ea28c3/</url>
      
        <content type="html"><![CDATA[<p>LVM æ˜¯ <code>Logical Volume Manager</code> çš„ç¼©å†™ï¼Œä¸­æ–‡é€»è¾‘å·ç®¡ç†ï¼ŒLVM æ˜¯å»ºç«‹åœ¨ç£ç›˜åˆ†åŒºå’Œæ–‡ä»¶ç³»ç»Ÿä¹‹é—´çš„ä¸€ä¸ªé€»è¾‘å±‚ï¼ŒLVM ä¼šæ›´åŠ çµæ´»ï¼Œå¯ä»¥åŠ¨æ€æ‰©å®¹ç¼©å®¹åˆ†åŒºå¤§å°ã€‚è°ƒæ•´åˆ†åŒºå¤§å°æœ‰é£é™©ï¼Œè¯·åšå¥½å……åˆ†æµ‹è¯•å†å†³å®šæ˜¯å¦æ‰§è¡Œã€‚<br>å¦‚æœæ²¡æœ‰å¯ç”¨ <code>lvm</code>ï¼Œè¯·æŸ¥çœ‹ <a href="/33420276/">linuxç£ç›˜æ‰©å®¹ - éLVM</a><br>é‚£ä¹ˆæ€ä¹ˆçŸ¥é“æœºå™¨æœ‰æ²¡æœ‰å¯ç”¨ LVM å‘¢ï¼Œå¯ä»¥æ‰§è¡Œ <code>sudo lvdisplay</code> æŸ¥çœ‹æœ‰æ²¡æœ‰å·²å­˜åœ¨çš„ LVï¼Œå¯¹æ¯” <code>df -hT</code> é‡Œé¢çš„ <code>Filesystem</code>ï¼Œä¹Ÿå¯ä»¥ç”¨ <code>lsblk</code> æŸ¥çœ‹æœ‰æ²¡æœ‰ lvmã€‚</p><div class="note warning simple"><p>è®°ä½ä¸€ç‚¹ï¼Œ å¦‚æœä½ çš„ç£ç›˜æ²¡æœ‰åˆ†åŒºå¹¶å·²ç»åœ¨ä½¿ç”¨ä¸­ï¼Œ é‚£ä¹ˆåƒä¸‡ä¸è¦ä½¿ç”¨ fdisk æ¥åˆ†åŒºï¼Œä¼šæŸåæ•°æ®ï¼ï¼ï¼</p></div><h2 id="LVM-çš„ä¸€äº›æ¦‚å¿µ"><a href="#LVM-çš„ä¸€äº›æ¦‚å¿µ" class="headerlink" title="LVM çš„ä¸€äº›æ¦‚å¿µ"></a>LVM çš„ä¸€äº›æ¦‚å¿µ</h2><p>PVï¼š ç‰©ç†å·ï¼Œæ¯”å¦‚ä¸€ä¸ªåˆ†åŒºï¼Œä¸€ä¸ªç£ç›˜<br>VGï¼š å·ç»„ï¼Œå°†å¤šä¸ª PV æ•´åˆåœ¨ä¸€èµ·ï¼Œå½¢æˆä¸€ä¸ªå¤§çš„æ± å­<br>LVï¼š é€»è¾‘å·ï¼Œä» VG åˆ’åˆ†å‡ºæ¥ä¸€ä¸ªä¸ªç©ºé—´ï¼Œå¯ä»¥å½“ä½œåˆ†åŒºæ¥çœ‹å¾…ï¼Œå¯ä»¥æ ¼å¼åŒ–ï¼Œå¯ä»¥æŒ‚è½½</p><h3 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h3><table><thead><tr><th></th><th>æŸ¥çœ‹</th><th>æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯</th><th>æ‰©å±•</th><th>åˆ›å»º</th></tr></thead><tbody><tr><td>å·ç»„ VG</td><td>vgs</td><td>vgdisplay</td><td>vgextend</td><td>vgcreate</td></tr><tr><td>é€»è¾‘å· LV</td><td>lvs</td><td>lvdisplay</td><td>lvextend</td><td>lvcreate</td></tr><tr><td>ç‰©ç†å· PV</td><td>pvs</td><td>pvdisplay</td><td>pvresize</td><td>pvcreate</td></tr></tbody></table><h2 id="æ‰©å®¹æ–‡ä»¶ç³»ç»Ÿ"><a href="#æ‰©å®¹æ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="æ‰©å®¹æ–‡ä»¶ç³»ç»Ÿ"></a>æ‰©å®¹æ–‡ä»¶ç³»ç»Ÿ</h2><h3 id="ç‰©ç†æ‰©å®¹"><a href="#ç‰©ç†æ‰©å®¹" class="headerlink" title="ç‰©ç†æ‰©å®¹"></a>ç‰©ç†æ‰©å®¹</h3><blockquote><p>è™šæ‹Ÿæœºæ‰©å®¹å°±æ˜¯æ‰©å®¹è™šæ‹Ÿç£ç›˜ï¼Œç‰©ç†æœºæ‰©å®¹æ¯”å¦‚å¯ä»¥å¢åŠ ç¡¬ç›˜ã€‚</p></blockquote><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">åˆ›å»ºæ–°çš„PV</button><button type="button" class="tab">æ‰©å±•ç°æœ‰çš„PV</button></div><div class="tab-contents"><div class="tab-item-content active"><blockquote><p>å¦‚æœæ˜¯æ–°å¢ç¡¬ç›˜ï¼Œåªèƒ½åˆ›å»ºæ–°çš„ PV</p></blockquote><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">åˆ›å»ºæ–°åˆ†åŒº</button><button type="button" class="tab">ä¸åˆ†åŒºç›´æ¥ä½¿ç”¨è£¸è®¾å¤‡</button></div><div class="tab-contents"><div class="tab-item-content active"><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202404261039315.png" alt="image.png"></p><blockquote><p>è¿™é‡Œæœ‰ä¸ªç–‘é—®ï¼Œå¦‚æœä¸è®¾ç½®åˆ†åŒº ID ä¸º <code>8e</code>ï¼Œä¹Ÿä¸å½±å“åç»­æ“ä½œï¼Œä½†æ˜¯ <code>fdisk -l /dev/sda</code> çš„æ—¶å€™ï¼ŒæŸ¥çœ‹åˆ°çš„æ–°åˆ†åŒº Type ä¸º Linuxï¼Œè€Œä¸æ˜¯ Linux LVMï¼Œä¸çŸ¥é“è¿™ä¸¤ç§æœ‰ä»€ä¹ˆä¸åŒï¼ŒçŸ¥é“çš„å¤§ä½¬éº»çƒ¦å‘Šè¯‰æˆ‘ä¸€ä¸‹ã€‚ã€‚</p></blockquote><p>åˆ›å»º pv</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pvcreate /dev/vdb1</span><br><span class="line">pvdisplay</span><br></pre></td></tr></table></figure><p>æ·»åŠ  PV åˆ° VG</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vgextend vg1 /dev/vdb1</span><br></pre></td></tr></table></figure><blockquote><p>æ·»åŠ å®Œæˆ <code>sudo vgdisplay</code> å¯ä»¥çœ‹åˆ° <code>Free PE / Size</code> çš„ç©ºé—´å¤§å°</p></blockquote></div><div class="tab-item-content"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pvcreate /dev/vdb</span><br><span class="line">pvdisplay</span><br></pre></td></tr></table></figure><p>æ·»åŠ  PV åˆ° VG</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vgextend vg1 /dev/vdb</span><br></pre></td></tr></table></figure><blockquote><p>æ·»åŠ å®Œæˆ <code>sudo vgdisplay</code> å¯ä»¥çœ‹åˆ° <code>Free PE / Size</code> çš„ç©ºé—´å¤§å°</p></blockquote></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><div class="tab-item-content"><blockquote><p>å¦‚æœè™šæ‹Ÿæœºæ˜¯é€šè¿‡æ‰©å®¹ç°æœ‰ç¡¬ç›˜çš„æ–¹å¼æ¥æ‰©å®¹ï¼Œå¯ä»¥æ‰©å±•ç°æœ‰ PVï¼Œå¦‚æœæ˜¯æ–°å¢çš„ç¡¬ç›˜ï¼Œåªèƒ½æ–°å»º PV æ¥æ‰©å®¹</p></blockquote><p>å®‰è£… cloud-utils</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Ubuntuå’ŒDebian</span></span><br><span class="line">sudo apt install cloud-guest-utils</span><br><span class="line"></span><br><span class="line"><span class="comment"># CentOSå’ŒRHEL</span></span><br><span class="line">sudo yum install cloud-utils-growpart</span><br></pre></td></tr></table></figure><p>å¦‚ä½•åˆ¤æ–­ pv æ˜¯ä¸€ä¸ªè®¾å¤‡è¿˜æ˜¯ä¸€ä¸ªåˆ†åŒº</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202404252228062.png" alt="image.png"></p><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">PVæ˜¯ä¸€ä¸ªåˆ†åŒº</button><button type="button" class="tab">PVæ˜¯ä¸€ä¸ªç£ç›˜è®¾å¤‡</button></div><div class="tab-contents"><div class="tab-item-content active"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">growpart /dev/vdb 1</span><br><span class="line">pvs</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pvresize /dev/vdb</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div><h3 id="åˆ›å»ºæˆ–æ‰©å±•-LV"><a href="#åˆ›å»ºæˆ–æ‰©å±•-LV" class="headerlink" title="åˆ›å»ºæˆ–æ‰©å±• LV"></a>åˆ›å»ºæˆ–æ‰©å±• LV</h3><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">æ‰©å±•ç°æœ‰çš„LV</button><button type="button" class="tab">åˆ›å»ºæ–°çš„LV</button></div><div class="tab-contents"><div class="tab-item-content active"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">lvextend /dev/mapper/vg1-lv1 /dev/sda4</span><br><span class="line">lvextend -l +100%FREE /dev/mapper/vg1-lv1</span><br><span class="line">lvextend -L +1024M /dev/mapper/vg1-lv1</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªæŒ‡å®šå¤§å°çš„lvï¼Œå¹¶æŒ‡å®šåå­—ä¸ºlv2</span></span><br><span class="line">lvcreate -L 2G -n lv2 vg1</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªå å…¨éƒ¨å·ç»„å¤§å°çš„lvï¼Œå¹¶æŒ‡å®šåå­—ä¸ºlv3</span></span><br><span class="line">lvcreate -l 100%VG -n lv3 vg1</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªç©ºé—²ç©ºé—´80%å¤§å°çš„lvï¼Œå¹¶æŒ‡å®šåå­—ä¸ºlv4</span></span><br><span class="line">lvcreate -l 80%Free -n lv4 vg1</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div><h3 id="æ ¼å¼åŒ–å¹¶æŒ‚è½½"><a href="#æ ¼å¼åŒ–å¹¶æŒ‚è½½" class="headerlink" title="æ ¼å¼åŒ–å¹¶æŒ‚è½½"></a>æ ¼å¼åŒ–å¹¶æŒ‚è½½</h3><blockquote><p>æ–°åˆ›å»ºçš„ <code>LV</code> ç±»ä¼¼äºç¡¬ç›˜åˆ†åŒºï¼Œéœ€è¦æ ¼å¼åŒ–åå†æŒ‚è½½</p></blockquote><p>æ ¼å¼åŒ–</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkfs.xfs /dev/mapper/vg1-lv1</span><br></pre></td></tr></table></figure><p>æŒ‚è½½</p><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">æ‰‹åŠ¨æŒ‚è½½</button><button type="button" class="tab">fstabè‡ªåŠ¨æŒ‚è½½</button></div><div class="tab-contents"><div class="tab-item-content active"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount /dev/mapper/vg1-lv1 /opt</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/dev/mapper/vg1-lv1 /opt xfs defaults 0 0</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div><h3 id="è°ƒæ•´æ–‡ä»¶ç³»ç»Ÿå¤§å°"><a href="#è°ƒæ•´æ–‡ä»¶ç³»ç»Ÿå¤§å°" class="headerlink" title="è°ƒæ•´æ–‡ä»¶ç³»ç»Ÿå¤§å°"></a>è°ƒæ•´æ–‡ä»¶ç³»ç»Ÿå¤§å°</h3><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">extæ–‡ä»¶ç³»ç»Ÿ</button><button type="button" class="tab">xfsæ–‡ä»¶ç³»ç»Ÿ</button><button type="button" class="tab">RHEL</button></div><div class="tab-contents"><div class="tab-item-content active"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo resize2fs /dev/mapper/vg1-lv1</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo xfs_growfs /dev/mapper/vg1-lv1</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><p>åœ¨æ—©æœŸçš„ RHEL ä¸­ï¼Œç”±äº resize2fs æ— åœ¨çº¿ resize åŠŸèƒ½ï¼Œæ•…é¢å¤–æä¾›äº† ext2onlineã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ext2online /dev/mapper/vg1-lv1</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div><h2 id="ç¼©å°æ–‡ä»¶ç³»ç»Ÿ"><a href="#ç¼©å°æ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="ç¼©å°æ–‡ä»¶ç³»ç»Ÿ"></a>ç¼©å°æ–‡ä»¶ç³»ç»Ÿ</h2><ol><li><p>å¸è½½æ–‡ä»¶ç³»ç»Ÿ</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">umount /dev/vg_name/lv_name</span><br></pre></td></tr></table></figure></li><li><p>æ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿæ˜¯å¦æœ‰é”™è¯¯</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">e2fsck -f /dev/vg0/lvm1</span><br></pre></td></tr></table></figure></li><li><p>è°ƒæ•´æ–‡ä»¶ç³»ç»Ÿå¤§å°</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">resize2fs /dev/vg0/lvm1 10G</span><br></pre></td></tr></table></figure></li><li><p>è°ƒæ•´ LV çš„å¤§å°</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lvreduce -L 10G /dev/vg0/lvm1</span><br></pre></td></tr></table></figure></li><li><p>é‡æ–°æŒ‚è½½ LV</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount /dev/vg0/lvm1 /lvm1</span><br></pre></td></tr></table></figure></li></ol><h2 id="ç§»é™¤-PV"><a href="#ç§»é™¤-PV" class="headerlink" title="ç§»é™¤ PV"></a>ç§»é™¤ PV</h2><blockquote><p>æ¯”å¦‚æŸä¸ª PV å¯¹åº”çš„ç¡¬ç›˜æŸåï¼Œéœ€è¦æ›´æ¢ï¼Œæ¯”å¦‚éœ€è¦æ›´æ¢ <code>/dev/sdb</code></p></blockquote><ol><li><p>æŸ¥çœ‹ pv ä½¿ç”¨æƒ…å†µ</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pvdisplay</span><br></pre></td></tr></table></figure><p> æŸ¥çœ‹å¯¹åº”çš„ PV å‚æ•° <code>Allocated PE</code>ï¼Œè‹¥ä¸ä¸º 0 è¡¨ç¤ºæœ‰é€»è¾‘å·åœ¨ä½¿ç”¨ï¼Œéœ€è¦ä½¿ç”¨ <code>pvmove /dev/sdb</code> å°†æ•°æ®è½¬ç§»åˆ°å…¶ä»–ç©ºé—²çš„ PV ä¸Šé¢</p></li><li><p>å°† PV ä» VG ç§»å‡º</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vgreduce vg_name /dev/sdb</span><br></pre></td></tr></table></figure></li><li><p>ç§»é™¤ PV</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pvremove /dev/sdb</span><br></pre></td></tr></table></figure></li><li><p>æ›´æ¢ç¡¬ç›˜ï¼Œç„¶åé‡æ–°åˆ›å»º PVï¼Œæ·»åŠ  VG ç­‰</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
            <tag> Linux </tag>
            
            <tag> Disk </tag>
            
            <tag> æ‰©å®¹ </tag>
            
            <tag> åˆ†åŒº </tag>
            
            <tag> æŒ‚è½½ </tag>
            
            <tag> æ ¼å¼åŒ– </tag>
            
            <tag> ç£ç›˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linuxç”¨æˆ·ç®¡ç†</title>
      <link href="/posts/sd9in4/"/>
      <url>/posts/sd9in4/</url>
      
        <content type="html"><![CDATA[<h2 id="å¢åŠ ç”¨æˆ·"><a href="#å¢åŠ ç”¨æˆ·" class="headerlink" title="å¢åŠ ç”¨æˆ·"></a>å¢åŠ ç”¨æˆ·</h2><p>useradd [é€‰é¡¹] ç”¨æˆ·å</p><table><thead><tr><th>é€‰é¡¹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>-g</td><td>æŒ‡å®šç”¨æˆ·çš„ç”¨æˆ·ä¸»ç»„,ï¼ˆæŸ¥çœ‹ç”¨æˆ·å±äºå“ªä¸ªç»„ç›´æ¥ä» passwd æ–‡ä»¶æŸ¥çœ‹ï¼‰</td></tr><tr><td>-G</td><td>æŒ‡å®šç”¨æˆ·çš„é™„åŠ ç»„     ï¼ˆæŸ¥çœ‹ç”¨æˆ·å±äºå“ªä¸ªé™„åŠ ç»„ç›´æ¥ä» group æ–‡ä»¶æŸ¥çœ‹ï¼‰</td></tr><tr><td>-u</td><td>æŒ‡å®šç”¨æˆ· IDï¼Œå³æŒ‡å®šç”¨æˆ·æ ‡è¯†ç¬¦ ((ID æ˜¯å”¯ä¸€çš„),ä¸æƒ³ä½¿ç”¨ç³»ç»Ÿé»˜è®¤æŒ‡å®šçš„ ID åˆ™å¯ä»¥ä½¿ç”¨ -u æŒ‡å®š ID,é»˜è®¤ Centos6.x500 ä¹‹åé€’å¢ï¼ŒCentos7.x ä» 1000 ä¹‹åé€’å¢</td></tr><tr><td>-d</td><td>è‡ªå®šä¹‰ç”¨æˆ·çš„å®¶ç›®å½•,ä¸è¦ç³»ç»Ÿé»˜è®¤åˆ›å»ºçš„å®¶ç›®å½•</td></tr><tr><td>-m</td><td>åˆ›å»ºç”¨æˆ·çš„å®¶ç›®å½•</td></tr><tr><td>-M</td><td>ä¸åˆ›å»ºå®¶ç›®å½•</td></tr><tr><td>-c</td><td>å¤‡æ³¨ä¿¡æ¯,å¯å†™å¯ä¸å†™</td></tr><tr><td>-s</td><td>æŒ‡å®šç”¨æˆ·ç™»å½•çš„ shell,ä¸å†™é»˜è®¤æ˜¯&#x2F;bin&#x2F;sh,é€šå¸¸ä¼šç»™ç¨‹åºåˆ›å»ºä¸€ä¸ªä¸å…è®¸ç™»é™†çš„è´¦å· -s &#x2F;sbin&#x2F;nologin æˆ– -s &#x2F;bin&#x2F;false</td></tr><tr><td>-r</td><td>åˆ›å»ºä¸€ä¸ªç³»ç»Ÿè´¦å·,centos7 ç³»ç»Ÿè´¦å·çš„ UID æ˜¯ä» 1-999 ä¹‹é—´çš„,centos6 æ˜¯ä» 1-499 ä¹‹é—´çš„</td></tr></tbody></table><p>å¸¸ç”¨æ ¼å¼ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">useradd -m -s /bin/bash iuxt            <span class="comment"># å¸¸ç”¨æ“ä½œï¼Œåˆ›å»ºç”¨æˆ·å’Œå®¶ç›®å½•ã€‚</span></span><br><span class="line">useradd iuxt<span class="comment">#åˆ›å»ºiuxtç”¨æˆ·å’Œè‡ªåŠ¨é»˜è®¤åˆ›å»ºåŒåçš„iuxtç»„ï¼Œé»˜è®¤åˆ†é…ç”¨æˆ·ID</span></span><br><span class="line">useradd -M -s /sbin/nologin nginx<span class="comment">#åˆ›å»ºä¸€ä¸ªæ²¡æœ‰å®¶ç›®å½•åŠä¸èƒ½ç™»å½•çš„nginxç”¨æˆ·</span></span><br><span class="line">useradd -g 1001 -G 1002 -u 8989 -d /home/iuxt -s /bin/bash iuxt</span><br></pre></td></tr></table></figure><h2 id="ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯"><a href="#ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯" class="headerlink" title="ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯"></a>ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯</h2><p>usermod ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯<br>usermod å‘½ä»¤ç”¨äºä¿®æ”¹ç”¨æˆ·ä¿¡æ¯ï¼Œå…¶è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š</p><p>usermod [é€‰é¡¹] ç”¨æˆ·å</p><table><thead><tr><th>é€‰é¡¹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>-g</td><td>ä¿®æ”¹ç”¨æˆ·çš„ç”¨æˆ·ç»„,å…¶åå¯æ¥ç»„åæˆ– gidï¼ˆæŸ¥çœ‹ç”¨æˆ·å±äºå“ªä¸ªç»„ç›´æ¥ä» passwd æ–‡ä»¶æŸ¥çœ‹ï¼‰ï¼ˆä¸€ä¸ªç”¨æˆ·åªèƒ½æœ‰ä¸€ä¸ªä¸»ç»„ï¼‰</td></tr><tr><td>-G</td><td>ä¿®æ”¹ç”¨æˆ·çš„é™„åŠ ç»„,å…¶åå¯æ¥ç»„åæˆ– gidï¼ˆæŸ¥çœ‹ç”¨æˆ·å±äºå“ªä¸ªé™„åŠ ç»„ç›´æ¥ä» group æ–‡ä»¶æŸ¥çœ‹ï¼‰ï¼ˆä¸€ä¸ªç”¨æˆ·å¯ä»¥æœ‰å¤šä¸ªé™„å±ç»„,æ¢å¥è¯è¯´,ä¸€ä¸ªç»„å¯ä»¥æœ‰å¤šä¸ªç”¨æˆ·,ä½†è¿™ä¸ªç»„å¯¹ç”¨æˆ·æ¥è¯´å¿…é¡»æ˜¯é™„åŠ ç»„ï¼‰</td></tr><tr><td>-u</td><td>ä¿®æ”¹ç”¨æˆ· IDï¼Œå³ä¿®æ”¹ç”¨æˆ·æ ‡è¯†ç¬¦</td></tr><tr><td>-l</td><td>ä¿®æ”¹ç”¨æˆ·åï¼ˆusermod -l new_name old_nameï¼‰</td></tr><tr><td>-s</td><td>ä¿®æ”¹ç”¨æˆ·ç™»å½•çš„ shell</td></tr><tr><td>-L</td><td>é”ä½ç”¨æˆ·</td></tr><tr><td>-U</td><td>è§£é”ç”¨æˆ·</td></tr><tr><td>-d</td><td>ä¿®æ”¹ç”¨æˆ·çš„å®¶ç›®å½•</td></tr><tr><td>-m</td><td>å¿…é¡»ä¸ -d ä¸€èµ·ä½¿ç”¨ï¼Œè¡¨ç¤ºç§»åŠ¨å®¶ç›®å½•é‡Œé¢æ–‡ä»¶</td></tr></tbody></table><p>å¸¸ç”¨æ“ä½œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">usermod -l iuxt old_name     <span class="comment"># å°†ç”¨æˆ·åold_nameæ”¹ä¸ºiuxt,ä»…ä»…æ˜¯ä¿®æ”¹ç”¨æˆ·å,å®¶ç›®å½•åold_nameæˆ–é»˜è®¤ç»„old_nameå¹¶æ²¡æœ‰è¢«ä¿®æ”¹</span></span><br><span class="line">usermod -L iuxt<span class="comment"># é”ä½ç”¨æˆ·iuxt</span></span><br><span class="line">usermod -md /home/iuxt1 iuxt<span class="comment"># ä¿®æ”¹ç”¨æˆ·iuxtçš„å®¶ç›®å½•,iuxt1ç›®å½•å¿…é¡»å®ç°åˆ›å»º,è€Œä¸”åˆ›å»ºåæ³¨æ„å±ä¸»å±ç»„æƒé™</span></span><br><span class="line">usermod -s /sbin/nologin iuxt<span class="comment"># ä¿®æ”¹ç”¨æˆ·çš„ç™»å½•shell</span></span><br><span class="line">usermod -g 6688 iuxt<span class="comment"># ä¿®æ”¹ç”¨æˆ·çš„ä¸»ç»„</span></span><br><span class="line">usermod -G zhangsan,zabbix lisi<span class="comment"># -GæŒ‡å®šä¿®æ”¹lisié™„å±ç»„ä¸ºzhangsanï¼Œzabbix</span></span><br><span class="line"><span class="built_in">id</span> lisi<span class="comment"># æŸ¥çœ‹lisiçš„ä¿¡æ¯</span></span><br></pre></td></tr></table></figure><p>è¯´æ˜ï¼š<br>ä¸€ä¸ªç”¨æˆ·åªèƒ½æœ‰ä¸€ä¸ªä¸»ç»„ï¼Œä½†å¯ä»¥æœ‰å¤šä¸ªé™„åŠ ç»„ã€‚ä½¿ç”¨ id user_name æ¥æŸ¥çœ‹ã€‚<br>ä¿®æ”¹ç”¨æˆ·å®¶ç›®å½•å¿…é¡»ä½¿ç”¨å‚æ•° -md é…åˆä½¿ç”¨ã€‚</p><h2 id="åˆ é™¤ç”¨æˆ·"><a href="#åˆ é™¤ç”¨æˆ·" class="headerlink" title="åˆ é™¤ç”¨æˆ·"></a>åˆ é™¤ç”¨æˆ·</h2><p>userdel åˆ é™¤ç”¨æˆ·<br>userdel å‘½ä»¤ç”¨äºåˆ é™¤ç”¨æˆ·ï¼Œå…¶è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š</p><p>userdel [é€‰é¡¹] ç”¨æˆ·å</p><table><thead><tr><th>é€‰é¡¹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>-f</td><td>å¼ºåˆ¶åˆ é™¤,å³ä½¿ç”¨æˆ·æ­£åœ¨ç™»å½•</td></tr><tr><td>-r</td><td>åˆ é™¤ç”¨æˆ·,å…¶å®¶ç›®å½•å’Œ mail spool ä¹Ÿä¸€å¹¶åˆ é™¤</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å‘½ä»¤è¡Œå·¥å…· </tag>
            
            <tag> Linux </tag>
            
            <tag> Shell </tag>
            
            <tag> å¸¸ç”¨æ“ä½œ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>adbå¸¸ç”¨æ“ä½œè®°å½•</title>
      <link href="/posts/b1ffa547/"/>
      <url>/posts/b1ffa547/</url>
      
        <content type="html"><![CDATA[<h2 id="æ‰“å¼€åº”ç”¨"><a href="#æ‰“å¼€åº”ç”¨" class="headerlink" title="æ‰“å¼€åº”ç”¨"></a>æ‰“å¼€åº”ç”¨</h2><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># am <span class="built_in">start</span> åº”ç”¨åŒ…å/activityå</span><br><span class="line">adb shell am <span class="built_in">start</span> com.ss.android.lark/com.ss.android.lark.main.app.MainActivity</span><br></pre></td></tr></table></figure><h3 id="è·å–-Activity-å"><a href="#è·å–-Activity-å" class="headerlink" title="è·å– Activity å"></a>è·å– Activity å</h3><p>æ‰‹æœºæ‰“å¼€ Appï¼Œç”µè„‘ä½¿ç”¨å‘½ä»¤ï¼š</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell dumpsys activity activities</span><br></pre></td></tr></table></figure><p>æœç´¢ä¸€ä¸‹ <code>mActivityComponent</code> :</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202406241352443.png" alt="image.png"></p><h2 id="è·å–ç³»ç»Ÿä¿¡æ¯"><a href="#è·å–ç³»ç»Ÿä¿¡æ¯" class="headerlink" title="è·å–ç³»ç»Ÿä¿¡æ¯"></a>è·å–ç³»ç»Ÿä¿¡æ¯</h2><h3 id="è·å–æ˜¯å¦è§£é”çŠ¶æ€"><a href="#è·å–æ˜¯å¦è§£é”çŠ¶æ€" class="headerlink" title="è·å–æ˜¯å¦è§£é”çŠ¶æ€"></a>è·å–æ˜¯å¦è§£é”çŠ¶æ€</h3><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell dumpsys window policy</span><br></pre></td></tr></table></figure><p>ä¸åŒç‰ˆæœ¬å¯èƒ½å‚æ•°ä¸ä¸€æ ·ï¼Œä¸€ä¸ªé€šç”¨çš„åŠæ³•æ˜¯åœ¨ç†„å±å…ˆæ‰§è¡Œæ­¤å‘½ä»¤ï¼Œè®°å½•ä¸‹æ¥ï¼Œç„¶åäº®å±å†æ‰§è¡Œä¸€æ¬¡ï¼Œå¯¹æ¯”ä¸€ä¸‹å·®å¼‚å°±èƒ½çŸ¥é“æ˜¯å“ªä¸ªå‚æ•°äº†ã€‚å°ç±³ 11 å‚æ•°ä¸º <code>mIsScreenOn</code></p><h2 id="å¸è½½æ— æ³•å¸è½½çš„ç³»ç»Ÿåº”ç”¨"><a href="#å¸è½½æ— æ³•å¸è½½çš„ç³»ç»Ÿåº”ç”¨" class="headerlink" title="å¸è½½æ— æ³•å¸è½½çš„ç³»ç»Ÿåº”ç”¨"></a>å¸è½½æ— æ³•å¸è½½çš„ç³»ç»Ÿåº”ç”¨</h2><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">adb shell pm uninstall --user <span class="number">0</span> com.miui.systemAdSolution</span><br><span class="line"></span><br><span class="line">ç­‰åŒäºå…ˆè¿›å…¥adb shell ï¼Œç„¶åå†æ‰§è¡Œå‘½ä»¤</span><br><span class="line">adb shell</span><br><span class="line">&gt; pm uninstall --user <span class="number">0</span> com.miui.systemAdSolution</span><br></pre></td></tr></table></figure><h3 id="æŸ¥è¯¢-APP-åˆ—è¡¨"><a href="#æŸ¥è¯¢-APP-åˆ—è¡¨" class="headerlink" title="æŸ¥è¯¢ APP åˆ—è¡¨"></a>æŸ¥è¯¢ APP åˆ—è¡¨</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">ç”¨ä¸‹é¢å‘½ä»¤æŸ¥è¯¢å·²å®‰è£…çš„è½¯ä»¶åˆ—è¡¨ï¼ˆä¹‹åå¸è½½è½¯ä»¶éœ€è¦çŸ¥é“è½¯ä»¶åŒ…åç§°ï¼‰</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ—å‡ºæ‰€æœ‰è½¯ä»¶</span></span><br><span class="line">adb shell pm list packages</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ—å‡ºç³»ç»Ÿè½¯ä»¶</span></span><br><span class="line">adb shell pm list packages -s</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ—å‡ºå…¶ä»–è½¯ä»¶</span></span><br><span class="line">adb shell pm list packages -3</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ—å‡ºå·²ç¦ç”¨è½¯ä»¶</span></span><br><span class="line">adb shell pm list packages -d</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ—å‡ºå·²å¯ç”¨è½¯ä»¶</span></span><br><span class="line">adb shell pm list packages -e</span><br></pre></td></tr></table></figure><h3 id="æŸ¥è¯¢è½¯ä»¶è¯¦æƒ…"><a href="#æŸ¥è¯¢è½¯ä»¶è¯¦æƒ…" class="headerlink" title="æŸ¥è¯¢è½¯ä»¶è¯¦æƒ…"></a>æŸ¥è¯¢è½¯ä»¶è¯¦æƒ…</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹è½¯ä»¶è¯¦ç»†ä¿¡æ¯</span></span><br><span class="line">adb shell dumpsys package com.mipay.wallet</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹è½¯ä»¶å®‰è£…è·¯å¾„</span></span><br><span class="line">adb shell pm path com.mipay.wallet</span><br></pre></td></tr></table></figure><h3 id="åœæ­¢-ç¦ç”¨-å¸è½½"><a href="#åœæ­¢-ç¦ç”¨-å¸è½½" class="headerlink" title="åœæ­¢ &amp; ç¦ç”¨ &amp; å¸è½½"></a>åœæ­¢ &amp; ç¦ç”¨ &amp; å¸è½½</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœæ­¢ APP</span></span><br><span class="line">adb shell am force-stop com.mipay.wallet</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¦ç”¨ APP</span></span><br><span class="line">adb shell pm disable-user com.mipay.wallet</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯ç”¨ APP</span></span><br><span class="line">adb shell pm <span class="built_in">enable</span> com.mipay.wallet</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¸è½½ APPï¼Œä¿ç•™ç¼“å­˜ä¸æ•°æ®ã€‚</span></span><br><span class="line">adb shell pm uninstall -k --user 0 com.mipay.wallet</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¸è½½ APPï¼Œä¸ä¿ç•™ç¼“å­˜ä¸æ•°æ®ã€‚</span></span><br><span class="line">adb shell pm uninstall --user 0 com.mipay.wallet</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¸è½½å æ¢å¤å®‰è£…</span></span><br><span class="line">adb shell pm install-existing --user 0 com.miui.securitycenter</span><br></pre></td></tr></table></figure><blockquote><p>æ¢å¤å‡ºå‚è®¾ç½®ä¼šæ¢å¤æ‰€æœ‰è¢«ç¦ç”¨å’Œåˆ é™¤çš„ APP</p></blockquote><h3 id="MIUI-å¸¸ç”¨å¸è½½è½¯ä»¶è®°å½•"><a href="#MIUI-å¸¸ç”¨å¸è½½è½¯ä»¶è®°å½•" class="headerlink" title="MIUI å¸¸ç”¨å¸è½½è½¯ä»¶è®°å½•"></a>MIUI å¸¸ç”¨å¸è½½è½¯ä»¶è®°å½•</h3><blockquote><p>ä»¥å°ç±³ 11 HyperOS 1.0 ä¸ºä¾‹ï¼ˆMIUI ç±»ä¼¼ï¼‰:</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°ç±³ç³»ç»Ÿå¹¿å‘Šè§£å†³æ–¹æ¡ˆ</span></span><br><span class="line">adb shell pm uninstall -k --user 0 com.miui.systemAdSolution</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°ç±³å¹¿å‘Šåˆ†æ</span></span><br><span class="line">adb shell pm uninstall -k --user 0 com.miui.analytics</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°ç±³æ¸¸æˆä¸­å¿ƒæœåŠ¡</span></span><br><span class="line">adb shell pm uninstall -k --user 0 com.xiaomi.gamecenter.sdk.service</span><br><span class="line"></span><br><span class="line"><span class="comment"># bugåé¦ˆ</span></span><br><span class="line">adb shell pm uninstall -k --user 0 com.miui.bugreport</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¿«åº”ç”¨æœåŠ¡æ¡†æ¶</span></span><br><span class="line">adb shell pm uninstall -k --user 0 com.miui.hybrid</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°ç±³è‡ªå¸¦æµè§ˆå™¨ï¼ˆå¸è½½åéœ€è¦è‡ªè¡Œå®‰è£…æµè§ˆå™¨ï¼‰</span></span><br><span class="line">adb shell pm uninstall -k --user 0 com.android.browser</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°ç±³æ‰‹æœºç®¡å®¶ï¼ˆæ‰‹æœºç®¡å®¶ä¸€é”®ä¿®å¤ä¼šå…³é—­ adb è°ƒè¯•ï¼Œæ‰€ä»¥æŠŠå®ƒå¸è½½æ‰ï¼‰</span></span><br><span class="line">adb shell pm uninstall -k --user 0 com.miui.securitycenter</span><br></pre></td></tr></table></figure><h2 id="æ¨¡æ‹Ÿç‚¹å‡»"><a href="#æ¨¡æ‹Ÿç‚¹å‡»" class="headerlink" title="æ¨¡æ‹Ÿç‚¹å‡»"></a>æ¨¡æ‹Ÿç‚¹å‡»</h2><blockquote><p>å¼€å‘è€…é€‰é¡¹é‡Œé¢è¦å¼€å¯ usb è°ƒè¯• (å®‰å…¨è®¾ç½®) å’Œ usb è°ƒè¯•ä¸¤ä¸ªå¼€å…³</p></blockquote><h3 id="æ¨¡æ‹Ÿç‚¹å‡»-500-1000-åæ ‡"><a href="#æ¨¡æ‹Ÿç‚¹å‡»-500-1000-åæ ‡" class="headerlink" title="æ¨¡æ‹Ÿç‚¹å‡» (500,1000) åæ ‡"></a>æ¨¡æ‹Ÿç‚¹å‡» (500,1000) åæ ‡</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell input tap 500 1000</span><br></pre></td></tr></table></figure><blockquote><p>å¼€å‘è€…é€‰é¡¹ä¸­æ‰“å¼€æŒ‡é’ˆä½ç½®å¯ä»¥çœ‹åˆ°ç‚¹çš„åæ ‡</p></blockquote><h3 id="æ¨¡æ‹Ÿæ»‘åŠ¨"><a href="#æ¨¡æ‹Ÿæ»‘åŠ¨" class="headerlink" title="æ¨¡æ‹Ÿæ»‘åŠ¨"></a>æ¨¡æ‹Ÿæ»‘åŠ¨</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä»ï¼ˆ250ï¼Œ250ï¼‰æ»‘åŠ¨åˆ°ï¼ˆ300ï¼Œ300ï¼‰</span></span><br><span class="line">adb shell input swipe 250 250 300 300 </span><br></pre></td></tr></table></figure><h3 id="æ¨¡æ‹Ÿè¾“å…¥"><a href="#æ¨¡æ‹Ÿè¾“å…¥" class="headerlink" title="æ¨¡æ‹Ÿè¾“å…¥"></a>æ¨¡æ‹Ÿè¾“å…¥</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell input text <span class="string">&#x27;hello world&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="æ¨¡æ‹ŸæŒ‰é”®"><a href="#æ¨¡æ‹ŸæŒ‰é”®" class="headerlink" title="æ¨¡æ‹ŸæŒ‰é”®"></a>æ¨¡æ‹ŸæŒ‰é”®</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ¨¡æ‹Ÿback</span></span><br><span class="line">adb shell input keyevent 4</span><br></pre></td></tr></table></figure><blockquote><p>keyevent code:</p></blockquote><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">KEYCODE_UNKNOWN</span>=<span class="number">0</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_SOFT_LEFT</span>=<span class="number">1</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_SOFT_RIGHT</span>=<span class="number">2</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_HOME</span>=<span class="number">3</span><span class="comment">;     //homeé”®</span></span><br><span class="line"><span class="attr">KEYCODE_BACK</span>=<span class="number">4</span><span class="comment">;     //backé”®</span></span><br><span class="line"><span class="attr">KEYCODE_CALL</span>=<span class="number">5</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_ENDCALL</span>=<span class="number">6</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_0</span>=<span class="number">7</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_1</span>=<span class="number">8</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_2</span>=<span class="number">9</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_3</span>=<span class="number">10</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_4</span>=<span class="number">11</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_5</span>=<span class="number">12</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_6</span>=<span class="number">13</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_7</span>=<span class="number">14</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_8</span>=<span class="number">15</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_9</span>=<span class="number">16</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_STAR</span>=<span class="number">17</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_POUND</span>=<span class="number">18</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_DPAD_UP</span>=<span class="number">19</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_DPAD_DOWN</span>=<span class="number">20</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_DPAD_LEFT</span>=<span class="number">21</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_DPAD_RIGHT</span>=<span class="number">22</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_DPAD_CENTER</span>=<span class="number">23</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_VOLUME_UP</span>=<span class="number">24</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_VOLUME_DOWN</span>=<span class="number">25</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_POWER</span>=<span class="number">26</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_CAMERA</span>=<span class="number">27</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_CLEAR</span>=<span class="number">28</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_A</span>=<span class="number">29</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_B</span>=<span class="number">30</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_C</span>=<span class="number">31</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_D</span>=<span class="number">32</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_E</span>=<span class="number">33</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_F</span>=<span class="number">34</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_G</span>=<span class="number">35</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_H</span>=<span class="number">36</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_I</span>=<span class="number">37</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_J</span>=<span class="number">38</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_K</span>=<span class="number">39</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_L</span>=<span class="number">40</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_M</span>=<span class="number">41</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_N</span>=<span class="number">42</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_O</span>=<span class="number">43</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_P</span>=<span class="number">44</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_Q</span>=<span class="number">45</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_R</span>=<span class="number">46</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_S</span>=<span class="number">47</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_T</span>=<span class="number">48</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_U</span>=<span class="number">49</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_V</span>=<span class="number">50</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_W</span>=<span class="number">51</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_X</span>=<span class="number">52</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_Y</span>=<span class="number">53</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_Z</span>=<span class="number">54</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_COMMA</span>=<span class="number">55</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_PERIOD</span>=<span class="number">56</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_ALT_LEFT</span>=<span class="number">57</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_ALT_RIGHT</span>=<span class="number">58</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_SHIFT_LEFT</span>=<span class="number">59</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_SHIFT_RIGHT</span>=<span class="number">60</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_TAB</span>=<span class="number">61</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_SPACE</span>=<span class="number">62</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_SYM</span>=<span class="number">63</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_EXPLORER</span>=<span class="number">64</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_ENVELOPE</span>=<span class="number">65</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_ENTER</span>=<span class="number">66</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_DEL</span>=<span class="number">67</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_GRAVE</span>=<span class="number">68</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_MINUS</span>=<span class="number">69</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_EQUALS</span>=<span class="number">70</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_LEFT_BRACKET</span>=<span class="number">71</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_RIGHT_BRACKET</span>=<span class="number">72</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_BACKSLASH</span>=<span class="number">73</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_SEMICOLON</span>=<span class="number">74</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_APOSTROPHE</span>=<span class="number">75</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_SLASH</span>=<span class="number">76</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_AT</span>=<span class="number">77</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_NUM</span>=<span class="number">78</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_HEADSETHOOK</span>=<span class="number">79</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_FOCUS</span>=<span class="number">80</span><span class="comment">;//*Camera*focus</span></span><br><span class="line"><span class="attr">KEYCODE_PLUS</span>=<span class="number">81</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_MENU</span>=<span class="number">82</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_NOTIFICATION</span>=<span class="number">83</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_SEARCH</span>=<span class="number">84</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_MEDIA_PLAY_PAUSE</span>=<span class="number">85</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_MEDIA_STOP</span>=<span class="number">86</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_MEDIA_NEXT</span>=<span class="number">87</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_MEDIA_PREVIOUS</span>=<span class="number">88</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_MEDIA_REWIND</span>=<span class="number">89</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_MEDIA_FAST_FORWARD</span>=<span class="number">90</span><span class="comment">;</span></span><br><span class="line"><span class="attr">KEYCODE_MUTE</span>=<span class="number">91</span><span class="comment">;</span></span><br></pre></td></tr></table></figure><h2 id="å¸¸è§é—®é¢˜"><a href="#å¸¸è§é—®é¢˜" class="headerlink" title="å¸¸è§é—®é¢˜"></a>å¸¸è§é—®é¢˜</h2><h3 id="Ubuntu-ç­‰-Linux-ç³»ç»Ÿæ— æ³•è¿æ¥-ADB"><a href="#Ubuntu-ç­‰-Linux-ç³»ç»Ÿæ— æ³•è¿æ¥-ADB" class="headerlink" title="Ubuntu ç­‰ Linux ç³»ç»Ÿæ— æ³•è¿æ¥ ADB"></a>Ubuntu ç­‰ Linux ç³»ç»Ÿæ— æ³•è¿æ¥ ADB</h3><p>å®˜æ–¹è¯´æ˜ï¼š<a href="https://developer.android.com/studio/run/device?hl=zh-cn">https://developer.android.com/studio/run/device?hl=zh-cn</a></p><p>æ¯”å¦‚æŠ¥é”™ <code>no permissions (user in plugdev group; are your udev rules wrong?)</code></p><p>åœ¨ Linux ç³»ç»Ÿä¸‹ï¼Œéœ€è¦ä¿è¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo usermod -aG plugdev <span class="variable">$LOGNAME</span></span><br><span class="line">sudo apt-get install android-sdk-platform-tools-common adb</span><br></pre></td></tr></table></figure><p>ç„¶åæ³¨é”€é‡æ–°ç™»å½•ï¼Œå†æ¬¡æ‰§è¡Œ adb å‘½ä»¤ï¼Œæ‰‹æœºä¸Šåº”è¯¥å°±ä¼šæœ‰æˆæƒå¼¹çª—äº†ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> adb </tag>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨kubeadméƒ¨ç½²ä¸€å¥—é«˜å¯ç”¨k8sé›†ç¾¤ for Ubuntu</title>
      <link href="/posts/526ffc9a/"/>
      <url>/posts/526ffc9a/</url>
      
        <content type="html"><![CDATA[<blockquote><p>åŸºäº ubuntu ä½¿ç”¨ kubeadm æ­å»ºé›†ç¾¤ï¼Œ <a href="/posts/b86d9e9f/">centoséƒ¨ç½²æ–‡æ¡£</a>, æœ‰ç–‘é—®çš„åœ°æ–¹å¯ä»¥çœ‹ <a href="https://kubernetes.io/zh/docs/setup/production-environment/tools/kubeadm/">å®˜æ–¹æ–‡æ¡£</a></p></blockquote><h2 id="å‡†å¤‡æœºå™¨"><a href="#å‡†å¤‡æœºå™¨" class="headerlink" title="å‡†å¤‡æœºå™¨"></a>å‡†å¤‡æœºå™¨</h2><blockquote><p>æˆ‘çš„æœºå™¨è¯¦æƒ…å¦‚ä¸‹, é…ç½®è‡³å°‘ä¸º 4C4G</p></blockquote><table><thead><tr><th>hostname</th><th>IP</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>public</td><td>10.0.0.3</td><td>ingressã€apiserver è´Ÿè½½å‡è¡¡ï¼Œnfs å­˜å‚¨</td></tr><tr><td>master1</td><td>10.0.0.11</td><td>k8s master èŠ‚ç‚¹</td></tr><tr><td>master2</td><td>10.0.0.12</td><td>k8s master èŠ‚ç‚¹</td></tr><tr><td>master3</td><td>10.0.0.13</td><td>k8s master èŠ‚ç‚¹</td></tr><tr><td>worker1</td><td>10.0.0.21</td><td>k8s worker èŠ‚ç‚¹</td></tr><tr><td>worker2</td><td>10.0.0.22</td><td>k8s worker èŠ‚ç‚¹</td></tr></tbody></table><p>æ¯å°æœºå™¨éƒ½åšåŸŸåè§£æï¼Œæˆ–è€…ç»‘å®š hosts(å¯é€‰ä½†å»ºè®®)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/hosts</span><br><span class="line"></span><br><span class="line">10.0.0.3  public kube-apiserver</span><br><span class="line">10.0.0.11 master1</span><br><span class="line">10.0.0.12 master2</span><br><span class="line">10.0.0.13 master3</span><br></pre></td></tr></table></figure><h2 id="åŸºç¡€ç¯å¢ƒé…ç½®"><a href="#åŸºç¡€ç¯å¢ƒé…ç½®" class="headerlink" title="åŸºç¡€ç¯å¢ƒé…ç½®"></a>åŸºç¡€ç¯å¢ƒé…ç½®</h2><blockquote><p>åŸºç¡€ç¯å¢ƒæ˜¯ä¸ç®¡ master è¿˜æ˜¯ worker éƒ½éœ€è¦çš„ç¯å¢ƒ</p></blockquote><ol><li>ç¦ç”¨ swap</li><li>ç¡®ä¿æ¯ä¸ªèŠ‚ç‚¹ä¸Š MAC åœ°å€å’Œ product_uuid çš„å”¯ä¸€æ€§ <code>sudo cat /sys/class/dmi/id/product_uuid</code></li><li>ä¿®æ”¹ hostname</li><li>å…è®¸ iptables æ£€æŸ¥æ¡¥æ¥æµé‡</li><li>å…³é—­é˜²ç«å¢™</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl <span class="built_in">disable</span> --now ufw</span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF | sudo tee /etc/modules-load.d/k8s.conf</span></span><br><span class="line"><span class="string">br_netfilter</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF | sudo tee /etc/sysctl.d/k8s.conf</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-ip6tables = 1</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-iptables = 1</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">sudo sysctl --system</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…-runtime"><a href="#å®‰è£…-runtime" class="headerlink" title="å®‰è£… runtime"></a>å®‰è£… runtime</h3><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">Containerd</button><button type="button" class="tab">Docker</button></div><div class="tab-contents"><div class="tab-item-content active"><h4 id="å…ˆå†³æ¡ä»¶"><a href="#å…ˆå†³æ¡ä»¶" class="headerlink" title="å…ˆå†³æ¡ä»¶"></a>å…ˆå†³æ¡ä»¶</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF | sudo tee /etc/modules-load.d/containerd.conf</span></span><br><span class="line"><span class="string">overlay</span></span><br><span class="line"><span class="string">br_netfilter</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">sudo modprobe overlay</span><br><span class="line">sudo modprobe br_netfilter</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®å¿…éœ€çš„ sysctl å‚æ•°ï¼Œè¿™äº›å‚æ•°åœ¨é‡æ–°å¯åŠ¨åä»ç„¶å­˜åœ¨ã€‚</span></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF | sudo tee /etc/sysctl.d/99-kubernetes-cri.conf</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-iptables  = 1</span></span><br><span class="line"><span class="string">net.ipv4.ip_forward                 = 1</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-ip6tables = 1</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åº”ç”¨ sysctl å‚æ•°è€Œæ— éœ€é‡æ–°å¯åŠ¨</span></span><br><span class="line">sudo sysctl --system</span><br></pre></td></tr></table></figure><h4 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…ä¾èµ–</span></span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install -y ca-certificates curl gnupg lsb-release</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿¡ä»»å¯†é’¥</span></span><br><span class="line">curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ ä»“åº“</span></span><br><span class="line"><span class="built_in">echo</span> \</span><br><span class="line"><span class="string">&quot;deb [arch=<span class="subst">$(dpkg --print-architecture)</span> signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu \</span></span><br><span class="line"><span class="string"><span class="subst">$(lsb_release -cs)</span> stable&quot;</span> | sudo <span class="built_in">tee</span> /etc/apt/sources.list.d/docker.list &gt; /dev/null</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…containerd</span></span><br><span class="line">sudo apt update</span><br><span class="line">sudo apt install -y containerd.io</span><br></pre></td></tr></table></figure><h4 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h4><p>ç”Ÿæˆé»˜è®¤é…ç½®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">mkdir</span> -p /etc/containerd</span><br><span class="line">containerd config default | sudo <span class="built_in">tee</span> /etc/containerd/config.toml</span><br></pre></td></tr></table></figure><p>ç»“åˆ runc ä½¿ç”¨ systemd cgroup é©±åŠ¨ï¼Œåœ¨ <code>/etc/containerd/config.toml</code> ä¸­è®¾ç½®</p><figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.runtimes.runc]</span></span><br><span class="line">...</span><br><span class="line"><span class="section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.runtimes.runc.options]</span></span><br><span class="line">   <span class="attr">SystemdCgroup</span> = <span class="literal">true</span></span><br></pre></td></tr></table></figure><p><code>sudo systemctl restart containerd</code></p><h4 id="crictl-é…ç½®"><a href="#crictl-é…ç½®" class="headerlink" title="crictl é…ç½®"></a>crictl é…ç½®</h4><p>ä¹‹å‰ä½¿ç”¨ docker çš„æ—¶å€™ï¼Œdocker ç»™æˆ‘ä»¬åšäº†å¾ˆå¤šå¥½ç”¨çš„å·¥å…·ï¼Œç°åœ¨ç”¨äº† containerdï¼Œç®¡ç†å®¹å™¨æˆ‘ä»¬ç”¨ cri ç®¡ç†å·¥å…· crictlï¼Œåˆ›å»ºé…ç½®æ–‡ä»¶</p><p>vim &#x2F;etc&#x2F;crictl.yaml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">runtime-endpoint:</span> <span class="string">unix:///run/containerd/containerd.sock</span></span><br><span class="line"><span class="attr">debug:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><h4 id="å®‰è£…-Docker"><a href="#å®‰è£…-Docker" class="headerlink" title="å®‰è£… Docker"></a>å®‰è£… Docker</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -fsSL get.docker.com | bash</span><br></pre></td></tr></table></figure><h4 id="é…ç½®-Doker"><a href="#é…ç½®-Doker" class="headerlink" title="é…ç½® Doker"></a>é…ç½® Doker</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir /etc/docker</span><br><span class="line">cat &lt;&lt;EOF | sudo tee /etc/docker/daemon.json</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;exec-opts&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;native.cgroupdriver=systemd&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;log-driver&quot;</span><span class="punctuation">:</span> <span class="string">&quot;json-file&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;log-opts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;max-size&quot;</span><span class="punctuation">:</span> <span class="string">&quot;100m&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;storage-driver&quot;</span><span class="punctuation">:</span> <span class="string">&quot;overlay2&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">sudo systemctl enable --now docker</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div><h3 id="å®‰è£…-kubeadmã€kubelet-å’Œ-kubectl"><a href="#å®‰è£…-kubeadmã€kubelet-å’Œ-kubectl" class="headerlink" title="å®‰è£… kubeadmã€kubelet å’Œ kubectl"></a>å®‰è£… kubeadmã€kubelet å’Œ kubectl</h3><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">ä½¿ç”¨å®˜æ–¹ä»“åº“</button><button type="button" class="tab">ä½¿ç”¨é˜¿é‡Œäº‘é•œåƒä»“åº“</button></div><div class="tab-contents"><div class="tab-item-content active"><blockquote><p>è¿™ä¸€æ­¥éœ€è¦ç§‘å­¦ä¸Šç½‘, ä¸èƒ½ç§‘å­¦ä¸Šç½‘çš„å¯ä»¥çœ‹çœ‹å›½å†…çš„æºã€‚</p></blockquote><p>æ›´æ–° apt åŒ…ç´¢å¼•å¹¶å®‰è£…ä½¿ç”¨ Kubernetes apt ä»“åº“æ‰€éœ€è¦çš„åŒ…ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt install -y apt-transport-https ca-certificates curl</span><br></pre></td></tr></table></figure><p>ä¸‹è½½ Google Cloud å…¬å¼€ç­¾åç§˜é’¥ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -fsSL https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo gpg --dearmor -o /etc/apt/keyrings/kubernetes-archive-keyring.gpg</span><br></pre></td></tr></table></figure><p>æ·»åŠ  Kubernetes apt ä»“åº“ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;deb [signed-by=/etc/apt/keyrings/kubernetes-archive-keyring.gpg] https://apt.kubernetes.io/ kubernetes-xenial main&quot;</span> | sudo <span class="built_in">tee</span> /etc/apt/sources.list.d/kubernetes.list</span><br></pre></td></tr></table></figure><p>æ›´æ–° apt åŒ…ç´¢å¼•ï¼Œå®‰è£… kubeletã€kubeadm å’Œ kubectlï¼Œå¹¶é”å®šå…¶ç‰ˆæœ¬ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å¯ç”¨çš„ç‰ˆæœ¬å·</span></span><br><span class="line">sudo apt-cache madison kubeadm</span><br><span class="line">sudo apt install -y kubeadm=1.21.10-00 kubelet=1.21.10-00 kubectl=1.21.10-00</span><br><span class="line"></span><br><span class="line"><span class="comment"># é”å®šç‰ˆæœ¬ï¼Œä¸éš apt upgrade æ›´æ–°</span></span><br><span class="line">sudo apt-mark hold kubelet kubeadm kubectl</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">apt-get update &amp;&amp; apt-get install -y apt-transport-https</span><br><span class="line"></span><br><span class="line">curl https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg | apt-key add - </span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF &gt;/etc/apt/sources.list.d/kubernetes.list</span></span><br><span class="line"><span class="string">deb https://mirrors.aliyun.com/kubernetes/apt/ kubernetes-xenial main</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å¯ç”¨çš„ç‰ˆæœ¬å·</span></span><br><span class="line">sudo apt-cache madison kubeadm</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…æŒ‡å®šç‰ˆæœ¬</span></span><br><span class="line">sudo apt install -y kubeadm=1.21.10-00 kubelet=1.21.10-00 kubectl=1.21.10-00</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…æœ€æ–°ç‰ˆæœ¬</span></span><br><span class="line"><span class="comment"># sudo apt install -y kubeadm kubelet kubectl</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é”å®šç‰ˆæœ¬ï¼Œä¸éš apt upgrade æ›´æ–°</span></span><br><span class="line">sudo apt-mark hold kubelet kubeadm kubectl</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div><h2 id="å‡†å¤‡é«˜å¯ç”¨æ–¹æ¡ˆ"><a href="#å‡†å¤‡é«˜å¯ç”¨æ–¹æ¡ˆ" class="headerlink" title="å‡†å¤‡é«˜å¯ç”¨æ–¹æ¡ˆ"></a>å‡†å¤‡é«˜å¯ç”¨æ–¹æ¡ˆ</h2><p><a href="/posts/10cef768/">Kubernetesä¹‹masteré«˜å¯ç”¨æ–¹æ¡ˆ</a></p><h2 id="åˆ›å»ºé›†ç¾¤"><a href="#åˆ›å»ºé›†ç¾¤" class="headerlink" title="åˆ›å»ºé›†ç¾¤"></a>åˆ›å»ºé›†ç¾¤</h2><h3 id="kubeadm-init"><a href="#kubeadm-init" class="headerlink" title="kubeadm init"></a>kubeadm init</h3><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">å®˜æ–¹é•œåƒæº</button><button type="button" class="tab">å›½å†…é˜¿é‡Œäº‘é•œåƒæº</button></div><div class="tab-contents"><div class="tab-item-content active"><p>åœ¨ init ä¹‹å‰å…ˆå°†é•œåƒæ‹‰å–åˆ°æœ¬åœ°ï¼ˆå¯é€‰æ­¥éª¤ï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubeadm config images pull --kubernetes-version 1.21.10</span><br></pre></td></tr></table></figure><p>åœ¨ k8s-master0 ä¸Šæ‰§è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo kubeadm init \</span><br><span class="line">--kubernetes-version 1.21.10 \</span><br><span class="line">--control-plane-endpoint <span class="string">&quot;kube-apiserver:6443&quot;</span> \</span><br><span class="line">--upload-certs \</span><br><span class="line">--service-cidr=10.96.0.0/12 \</span><br><span class="line">--pod-network-cidr=10.244.0.0/16</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><p>åœ¨ init ä¹‹å‰å…ˆå°†é•œåƒæ‹‰å–åˆ°æœ¬åœ°ï¼ˆå¯é€‰æ­¥éª¤ï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubeadm config images pull --kubernetes-version 1.21.10 --image-repository registry.cn-hangzhou.aliyuncs.com/google_containers</span><br></pre></td></tr></table></figure><p>åœ¨ k8s-master0 ä¸Šæ‰§è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo kubeadm init \</span><br><span class="line">--kubernetes-version 1.21.10 \</span><br><span class="line">--control-plane-endpoint <span class="string">&quot;kube-apiserver:6443&quot;</span> \</span><br><span class="line">--image-repository registry.cn-hangzhou.aliyuncs.com/google_containers \</span><br><span class="line">--upload-certs \</span><br><span class="line">--service-cidr=10.96.0.0/12 \</span><br><span class="line">--pod-network-cidr=10.244.0.0/16</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div><blockquote><p>ä¹Ÿå¯ä»¥ç”¨ <code>kubeadm config print init-defaults &gt; init.yaml</code> ç”Ÿæˆ kubeadm çš„é…ç½®ï¼Œå¹¶ç”¨<br><code>kubeadm init --config=init.yaml</code> æ¥åˆ›å»ºé›†ç¾¤ã€‚</p></blockquote><h3 id="å®‰è£…ç½‘ç»œæ’ä»¶"><a href="#å®‰è£…ç½‘ç»œæ’ä»¶" class="headerlink" title="å®‰è£…ç½‘ç»œæ’ä»¶"></a>å®‰è£…ç½‘ç»œæ’ä»¶</h3><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">å®‰è£…flannelæ’ä»¶</button><button type="button" class="tab">å®‰è£…calicoæ’ä»¶</button></div><div class="tab-contents"><div class="tab-item-content active"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å¾…è¡¥å……</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div><h2 id="å¸¸è§é—®é¢˜"><a href="#å¸¸è§é—®é¢˜" class="headerlink" title="å¸¸è§é—®é¢˜"></a>å¸¸è§é—®é¢˜</h2><p><a href="/posts/sepu3k/">kubeadm éƒ¨ç½²çš„é›†ç¾¤ å¸¸è§é—®é¢˜æ±‡æ€»</a></p>]]></content>
      
      
      <categories>
          
          <category> å®¹å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
            <tag> Linux </tag>
            
            <tag> Docker </tag>
            
            <tag> keepalived </tag>
            
            <tag> Container </tag>
            
            <tag> Kubernetes </tag>
            
            <tag> kubeadm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Windowsæ˜ å°„ç½‘ç»œé©±åŠ¨å™¨</title>
      <link href="/posts/88695286/"/>
      <url>/posts/88695286/</url>
      
        <content type="html"><![CDATA[<h2 id="net-use-å‘½ä»¤å¸¸ç”¨æ“ä½œ"><a href="#net-use-å‘½ä»¤å¸¸ç”¨æ“ä½œ" class="headerlink" title="net use å‘½ä»¤å¸¸ç”¨æ“ä½œ"></a>net use å‘½ä»¤å¸¸ç”¨æ“ä½œ</h2><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">:: å–æ¶ˆæ‰€æœ‰è¿æ¥</span><br><span class="line"><span class="built_in">net</span> use * /<span class="built_in">del</span> /y</span><br><span class="line"></span><br><span class="line">:: æ˜ å°„åšæœäº‘webdav, PERSISTENT:noè¡¨ç¤ºä¸ä¼šè®°å¿†æ˜ å°„, é‡å¯ä¼šä¸¢å¤±.</span><br><span class="line"><span class="built_in">net</span> use Z: https://dav.jianguoyun.com/dav/ /user:iuxt@qq.com &lt;ä½ çš„åº”ç”¨å¯†ç &gt; /PERSISTENT:no</span><br></pre></td></tr></table></figure><h2 id="subst-å‘½ä»¤"><a href="#subst-å‘½ä»¤" class="headerlink" title="subst å‘½ä»¤"></a>subst å‘½ä»¤</h2><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">:: æ˜ å°„C:\Filesåˆ°D: æŸäº›è½¯ä»¶ä¸æ”¯æŒ</span><br><span class="line"><span class="built_in">subst</span> D: C:\Files</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>alpineå¸¸ç”¨é…ç½®</title>
      <link href="/posts/c43764dd/"/>
      <url>/posts/c43764dd/</url>
      
        <content type="html"><![CDATA[<h2 id="åŒ…ç®¡ç†-apk"><a href="#åŒ…ç®¡ç†-apk" class="headerlink" title="åŒ…ç®¡ç† apk"></a>åŒ…ç®¡ç† apk</h2><h3 id="å®‰è£…åŒ…"><a href="#å®‰è£…åŒ…" class="headerlink" title="å®‰è£…åŒ…"></a>å®‰è£…åŒ…</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">apk add busybox-extras busybox vim python3 git</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸ç¼“å­˜ï¼Œæ‰“å®¹å™¨é•œåƒå¸¸ç”¨</span></span><br><span class="line">apk add --no-cache busybox</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹å®‰è£…çš„åŒ…"><a href="#æŸ¥çœ‹å®‰è£…çš„åŒ…" class="headerlink" title="æŸ¥çœ‹å®‰è£…çš„åŒ…"></a>æŸ¥çœ‹å®‰è£…çš„åŒ…</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ—å‡ºæ‰€æœ‰å·²å®‰è£…çš„åŒ…ï¼š</span></span><br><span class="line">apk info</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ç‰¹å®šåŒ…çš„è¯¦ç»†ä¿¡æ¯ï¼š</span></span><br><span class="line">apk info &lt;package_name&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ‰€æœ‰å·²å®‰è£…åŒ…çš„ç‰ˆæœ¬å·ï¼š</span></span><br><span class="line">apk info -v</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‰å­—æ¯é¡ºåºåˆ—å‡ºå·²å®‰è£…çš„åŒ…ï¼š</span></span><br><span class="line">apk info -vv</span><br></pre></td></tr></table></figure><h3 id="æ›´æ¢æº"><a href="#æ›´æ¢æº" class="headerlink" title="æ›´æ¢æº"></a>æ›´æ¢æº</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i <span class="string">&#x27;s/dl-cdn.alpinelinux.org/mirrors.tuna.tsinghua.edu.cn/g&#x27;</span> /etc/apk/repositories</span><br></pre></td></tr></table></figure><h3 id="å¸è½½åŒ…"><a href="#å¸è½½åŒ…" class="headerlink" title="å¸è½½åŒ…"></a>å¸è½½åŒ…</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apk del git</span><br></pre></td></tr></table></figure><h2 id="ç»ˆç«¯"><a href="#ç»ˆç«¯" class="headerlink" title="ç»ˆç«¯"></a>ç»ˆç«¯</h2><p>alpine é»˜è®¤çš„æ˜¯ ash shell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.profile</span><br></pre></td></tr></table></figure><h2 id="alpine-æœåŠ¡ç®¡ç†å·¥å…·"><a href="#alpine-æœåŠ¡ç®¡ç†å·¥å…·" class="headerlink" title="alpine æœåŠ¡ç®¡ç†å·¥å…·"></a>alpine æœåŠ¡ç®¡ç†å·¥å…·</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹æ‰€æœ‰æœåŠ¡</span></span><br><span class="line">rc-service --list</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ å¼€æœºè‡ªå¯åŠ¨</span></span><br><span class="line">rc-update add &#123;service-name&#125;</span><br></pre></td></tr></table></figure><h2 id="ç½‘ç»œé…ç½®"><a href="#ç½‘ç»œé…ç½®" class="headerlink" title="ç½‘ç»œé…ç½®"></a>ç½‘ç»œé…ç½®</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># dns</span></span><br><span class="line">/etc/resolv.conf</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç½‘å¡é…ç½®æ–‡ä»¶ /etc/network/interface</span></span><br><span class="line">iface eth0 inet static</span><br><span class="line">    address 192.168.1.150</span><br><span class="line">    netmask 255.255.255.0</span><br><span class="line">    gateway 192.168.1.1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">æˆ–è€…iface eth0 inet dhcp</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
            <tag> Linux </tag>
            
            <tag> Alpine </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>gitå¸¸ç”¨æ“ä½œè®°å½•</title>
      <link href="/posts/518e617c/"/>
      <url>/posts/518e617c/</url>
      
        <content type="html"><![CDATA[<h2 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h2><h3 id="æŸ¥çœ‹-GIT-æœ¬åœ°é…ç½®"><a href="#æŸ¥çœ‹-GIT-æœ¬åœ°é…ç½®" class="headerlink" title="æŸ¥çœ‹ GIT æœ¬åœ°é…ç½®"></a>æŸ¥çœ‹ GIT æœ¬åœ°é…ç½®</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --list</span><br></pre></td></tr></table></figure><h3 id="ç¼–è¾‘-git-é…ç½®æ–‡ä»¶"><a href="#ç¼–è¾‘-git-é…ç½®æ–‡ä»¶" class="headerlink" title="ç¼–è¾‘ git é…ç½®æ–‡ä»¶"></a>ç¼–è¾‘ git é…ç½®æ–‡ä»¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --global --edit</span><br></pre></td></tr></table></figure><h3 id="è®¾ç½®-GIT-ç”¨æˆ·ä¿¡æ¯"><a href="#è®¾ç½®-GIT-ç”¨æˆ·ä¿¡æ¯" class="headerlink" title="è®¾ç½® GIT ç”¨æˆ·ä¿¡æ¯"></a>è®¾ç½® GIT ç”¨æˆ·ä¿¡æ¯</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name <span class="string">&quot;zhanglikun&quot;</span></span><br><span class="line">git config --global user.email <span class="string">&quot;iuxt@qq.com&quot;</span></span><br></pre></td></tr></table></figure><h3 id="git-è®°ä½å¯†ç "><a href="#git-è®°ä½å¯†ç " class="headerlink" title="git è®°ä½å¯†ç "></a>git è®°ä½å¯†ç </h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --global credential.helper store</span><br></pre></td></tr></table></figure><h3 id="é…ç½®æ–‡ä»¶-gitconfig-å†…å®¹"><a href="#é…ç½®æ–‡ä»¶-gitconfig-å†…å®¹" class="headerlink" title="é…ç½®æ–‡ä»¶ ~/.gitconfig å†…å®¹"></a>é…ç½®æ–‡ä»¶ <code>~/.gitconfig</code> å†…å®¹</h3><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[user]</span></span><br><span class="line">        <span class="attr">name</span> = zhanglikun</span><br><span class="line">        <span class="attr">email</span> = iuxt@qq.com</span><br><span class="line"><span class="section">[credential]</span></span><br><span class="line">        <span class="attr">helper</span> = store</span><br></pre></td></tr></table></figure><h3 id="å¿½ç•¥è¿½è¸ªæ–‡ä»¶æƒé™"><a href="#å¿½ç•¥è¿½è¸ªæ–‡ä»¶æƒé™" class="headerlink" title="å¿½ç•¥è¿½è¸ªæ–‡ä»¶æƒé™"></a>å¿½ç•¥è¿½è¸ªæ–‡ä»¶æƒé™</h3><blockquote><p>å»ºè®® windows ä»£ç ä½¿ç”¨</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config core.filemode <span class="literal">false</span></span><br></pre></td></tr></table></figure><h2 id="åˆ†æ”¯ç®¡ç†"><a href="#åˆ†æ”¯ç®¡ç†" class="headerlink" title="åˆ†æ”¯ç®¡ç†"></a>åˆ†æ”¯ç®¡ç†</h2><table><thead><tr><th>å‘½ä»¤</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>git branch -a</td><td>æŸ¥çœ‹æ‰€æœ‰åˆ†æ”¯</td></tr><tr><td>git branch -r</td><td>æŸ¥çœ‹è¿œç¨‹åˆ†æ”¯</td></tr><tr><td>git fetch</td><td>æ›´æ–°ç´¢å¼•</td></tr><tr><td>git checkout åˆ†æ”¯å</td><td>åˆ‡æ¢åˆ°åˆ†æ”¯</td></tr><tr><td>git checkout -b æœ¬åœ°åˆ†æ”¯å</td><td>åœ¨æœ¬åœ°åˆ›å»ºä¸€ä¸ªåˆ†æ”¯, å¹¶åˆ‡æ¢åˆ°è¿™ä¸ªåˆ†æ”¯</td></tr><tr><td>git reset â€“hard 6e52</td><td>å›é€€åˆ°æŸä¸ª ID</td></tr><tr><td>git add -u</td><td>å°†åˆ é™¤æ“ä½œä¹Ÿæ·»åŠ åˆ°æš‚å­˜åŒº</td></tr><tr><td>git rm â€“cached filename</td><td>å°†æš‚å­˜åŒºçš„æ–‡ä»¶ç§»å‡ºæš‚å­˜åŒº</td></tr></tbody></table><h3 id="ä½¿ç”¨-git-checkout-æ’¤é”€æœ¬åœ°ä¿®æ”¹"><a href="#ä½¿ç”¨-git-checkout-æ’¤é”€æœ¬åœ°ä¿®æ”¹" class="headerlink" title="ä½¿ç”¨ git checkout æ’¤é”€æœ¬åœ°ä¿®æ”¹"></a>ä½¿ç”¨ git checkout æ’¤é”€æœ¬åœ°ä¿®æ”¹</h3><blockquote><p>checkout å°±æ˜¯æ’¤é”€ä½ çš„ä¿®æ”¹, æš‚å­˜åŒºæ˜¯ä¼šä¿ç•™.</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ’¤é”€æ‰€æœ‰ä¿®æ”¹</span></span><br><span class="line">git checkout .</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ’¤é”€å•ä¸ªæ–‡ä»¶çš„ä¿®æ”¹</span></span><br><span class="line">git checkout readme.md</span><br></pre></td></tr></table></figure><h3 id="git-å›æ»šä¸€ä¸ªæ–‡ä»¶åˆ°æŒ‡å®šç‰ˆ"><a href="#git-å›æ»šä¸€ä¸ªæ–‡ä»¶åˆ°æŒ‡å®šç‰ˆ" class="headerlink" title="git å›æ»šä¸€ä¸ªæ–‡ä»¶åˆ°æŒ‡å®šç‰ˆ"></a>git å›æ»šä¸€ä¸ªæ–‡ä»¶åˆ°æŒ‡å®šç‰ˆ</h3><p>æ ¹æ® commitid æ¥å›æ»š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span> /path/to/file</span><br><span class="line">git checkout &lt;commit-hashcode&gt; /path/to/file</span><br></pre></td></tr></table></figure><p>å›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout HEAD^ /path/to/file</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨-git-reset-å›é€€é¡¹ç›®ç‰ˆæœ¬"><a href="#ä½¿ç”¨-git-reset-å›é€€é¡¹ç›®ç‰ˆæœ¬" class="headerlink" title="ä½¿ç”¨ git reset å›é€€é¡¹ç›®ç‰ˆæœ¬"></a>ä½¿ç”¨ git reset å›é€€é¡¹ç›®ç‰ˆæœ¬</h3><blockquote><p>git reflog æŸ¥çœ‹å‘½ä»¤å†å²</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git reset --hard &lt;commit-hashcode&gt;</span><br><span class="line">git reset --hard HEAD^                  <span class="comment"># HEADè¡¨ç¤ºå½“å‰ç‰ˆæœ¬ HEAD^ è¡¨ç¤ºä¸Šä¸€ä¸ªç‰ˆæœ¬ HEAD^^ ä¸Šä¸¤ä¸ªç‰ˆæœ¬ HEAD~100 ä¸Š100ä¸ªç‰ˆæœ¬</span></span><br></pre></td></tr></table></figure><h3 id="æ·»åŠ å…³è”çš„è¿œç¨‹-git-ä»“åº“"><a href="#æ·»åŠ å…³è”çš„è¿œç¨‹-git-ä»“åº“" class="headerlink" title="æ·»åŠ å…³è”çš„è¿œç¨‹ git ä»“åº“"></a>æ·»åŠ å…³è”çš„è¿œç¨‹ git ä»“åº“</h3><blockquote><p>origin æ˜¯è¿œç«¯çš„åå­—, å¤šä¸ªè¿œç«¯åå­—ä¸èƒ½ç›¸åŒ</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote add origin https://github.com/iuxt/test.git</span><br></pre></td></tr></table></figure><h3 id="ä¸Šä¼ ï¼Œå¹¶å…³è”åˆ°-master-åˆ†æ”¯"><a href="#ä¸Šä¼ ï¼Œå¹¶å…³è”åˆ°-master-åˆ†æ”¯" class="headerlink" title="ä¸Šä¼ ï¼Œå¹¶å…³è”åˆ° master åˆ†æ”¯"></a>ä¸Šä¼ ï¼Œå¹¶å…³è”åˆ° master åˆ†æ”¯</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push -u origin master</span><br></pre></td></tr></table></figure><h3 id="åˆå¹¶ä»£ç "><a href="#åˆå¹¶ä»£ç " class="headerlink" title="åˆå¹¶ä»£ç "></a>åˆå¹¶ä»£ç </h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git checkout master</span><br><span class="line">git merge dev            <span class="comment"># å°†devä»£ç åˆå¹¶åˆ°master</span></span><br></pre></td></tr></table></figure><blockquote><p>åˆå¹¶æ–¹å¼å¦‚æœæ˜¯ fast-forward æ¨¡å¼, è¡¨ç¤º git åªæ˜¯åˆ‡æ¢äº†ä¸€ä¸‹æŒ‡é’ˆ</p></blockquote><h3 id="åˆ é™¤åˆ†æ”¯-åˆ†æ”¯æ”¹å"><a href="#åˆ é™¤åˆ†æ”¯-åˆ†æ”¯æ”¹å" class="headerlink" title="åˆ é™¤åˆ†æ”¯, åˆ†æ”¯æ”¹å"></a>åˆ é™¤åˆ†æ”¯, åˆ†æ”¯æ”¹å</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é‡å‘½åæœ¬åœ°åˆ†æ”¯</span></span><br><span class="line">git branch -m oldbranch newbranch</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤è¿œç¨‹åˆ†æ”¯</span></span><br><span class="line">git push --delete origin oldbranch</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†é‡å‘½ååçš„åˆ†æ”¯æ¨åˆ°è¿œç«¯</span></span><br><span class="line">git push origin newbranch</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸è¿œç¨‹åˆ†æ”¯å…³è”</span></span><br><span class="line">git branch --set-upstream-to origin/newbranch</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœè¿œç¨‹å·²ç»åˆ é™¤äº†åˆ†æ”¯, æœ¬åœ°è¿˜æ²¡æ›´æ–°, å¯ä»¥ä½¿ç”¨</span></span><br><span class="line">git fetch -p</span><br></pre></td></tr></table></figure><h3 id="rebase"><a href="#rebase" class="headerlink" title="rebase"></a>rebase</h3><p>åˆ©ç”¨ rebase åˆ é™¤å†å²æäº¤è®°å½•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git rebase -i &lt;ä½ è¦åŸºäºé‚£ä¸ªæäº¤çš„<span class="built_in">id</span>&gt;</span><br></pre></td></tr></table></figure><p>commit å‰é¢çš„ pick æ”¹æˆ d å³å¯ï¼Œè¡¨ç¤ºä¸¢å¼ƒè¿™ä¸ª commitï¼Œå¦‚æœéœ€è¦æ¨é€åˆ°è¿œç«¯çš„è¯ï¼Œéœ€è¦ <code>git push -f</code></p><blockquote><p>æ³¨æ„ï¼šå¤šäººåä½œæ…ç”¨ <code>git push -f</code></p></blockquote><h2 id="æ ‡ç­¾ç®¡ç†"><a href="#æ ‡ç­¾ç®¡ç†" class="headerlink" title="æ ‡ç­¾ç®¡ç†"></a>æ ‡ç­¾ç®¡ç†</h2><h3 id="æŸ¥çœ‹æ ‡ç­¾"><a href="#æŸ¥çœ‹æ ‡ç­¾" class="headerlink" title="æŸ¥çœ‹æ ‡ç­¾"></a>æŸ¥çœ‹æ ‡ç­¾</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹æ ‡ç­¾</span></span><br><span class="line">git tag</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ ‡ç­¾è¯¦æƒ…</span></span><br><span class="line">git show v1.0</span><br></pre></td></tr></table></figure><h3 id="åˆ›å»ºæ ‡ç­¾"><a href="#åˆ›å»ºæ ‡ç­¾" class="headerlink" title="åˆ›å»ºæ ‡ç­¾"></a>åˆ›å»ºæ ‡ç­¾</h3><p>åˆ‡æ¢åˆ°å¯¹åº”çš„åˆ†æ”¯, é»˜è®¤æ˜¯æ‰“åœ¨æœ€æ–°çš„ commit ä¸Šçš„ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git tag v1</span><br></pre></td></tr></table></figure><p>å¦‚æœæƒ³è¦æ‰“åˆ°å†å²çš„ commit id</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å†å²çš„commit id</span></span><br><span class="line">git <span class="built_in">log</span> --pretty=oneline --abbrev-commit</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¹ commit id æ‰“æ ‡ç­¾</span></span><br><span class="line">git tag v0.9 f52c633</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰“æ ‡ç­¾å¸¦ä¸Šè¯´æ˜</span></span><br><span class="line">git tag -a v0.1 -m <span class="string">&quot;version 0.1 released&quot;</span> 1094adb</span><br></pre></td></tr></table></figure><h3 id="æ¨é€æ ‡ç­¾"><a href="#æ¨é€æ ‡ç­¾" class="headerlink" title="æ¨é€æ ‡ç­¾"></a>æ¨é€æ ‡ç­¾</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸€æ¬¡æ€§å…¨éƒ¨æ¨é€æ ‡ç­¾</span></span><br><span class="line">git push origin --tags</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¨é€ä¸€ä¸ªæ ‡ç­¾åˆ°è¿œç¨‹</span></span><br><span class="line">git push origin refs/tags/v0.1</span><br></pre></td></tr></table></figure><h3 id="åˆ é™¤æ ‡ç­¾"><a href="#åˆ é™¤æ ‡ç­¾" class="headerlink" title="åˆ é™¤æ ‡ç­¾"></a>åˆ é™¤æ ‡ç­¾</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ é™¤æœ¬åœ°æ ‡ç­¾</span></span><br><span class="line">git tag -d v0.1</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤è¿œç¨‹æ ‡ç­¾ï¼Œéœ€è¦å…ˆåˆ é™¤æœ¬åœ°æ ‡ç­¾</span></span><br><span class="line">git tag -d v0.1</span><br><span class="line">git push origin :refs/tags/v0.1</span><br></pre></td></tr></table></figure><h2 id="submodule"><a href="#submodule" class="headerlink" title="submodule"></a>submodule</h2><h3 id="æ·»åŠ -submodule"><a href="#æ·»åŠ -submodule" class="headerlink" title="æ·»åŠ  submodule"></a>æ·»åŠ  submodule</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git submodule add https://github.com/HEIGE-PCloud/DoIt.git themes/DoIt</span><br></pre></td></tr></table></figure><p>åç»­ä½¿ç”¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/HEIGE-PCloud/DoIt.git</span><br><span class="line"><span class="built_in">cd</span> DoIt</span><br><span class="line">git submodule init</span><br><span class="line">git submodule update</span><br></pre></td></tr></table></figure><h3 id="åˆ é™¤-submodule"><a href="#åˆ é™¤-submodule" class="headerlink" title="åˆ é™¤ submodule"></a>åˆ é™¤ submodule</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git submodule deinit -f -- themes/eureka</span><br><span class="line"><span class="built_in">rm</span> -rf .git/modules/themes/eureka</span><br><span class="line">git <span class="built_in">rm</span> -f themes/eureka</span><br></pre></td></tr></table></figure><p>æœ€åæ›´æ–°ä¸€ä¸‹ <code>.gitmodules</code> å³å¯</p><h3 id="ä¿®æ”¹-submodule-çš„-url"><a href="#ä¿®æ”¹-submodule-çš„-url" class="headerlink" title="ä¿®æ”¹ submodule çš„ url"></a>ä¿®æ”¹ submodule çš„ url</h3><p>1.æ›´æ–° <code>.gitsubmodule</code> ä¸­å¯¹åº” <code>submodule</code> çš„æ¡ç›® URL</p><p>2.æ›´æ–° <code>.git/config</code> ä¸­å¯¹åº” <code>submodule</code> çš„æ¡ç›®çš„ URL</p><p>3.æ‰§è¡Œ <code>git submodule sync</code></p><h2 id="git-lfs-å¤§æ–‡ä»¶å­˜å‚¨"><a href="#git-lfs-å¤§æ–‡ä»¶å­˜å‚¨" class="headerlink" title="git-lfs å¤§æ–‡ä»¶å­˜å‚¨"></a>git-lfs å¤§æ–‡ä»¶å­˜å‚¨</h2><p>git lfs æ˜¯å¤§æ–‡ä»¶å­˜å‚¨, ç‹¬ç«‹äº git ä»“åº“, é€šè¿‡æ–‡ä»¶æŒ‡é’ˆçš„æ–¹å¼æ¥è°ƒç”¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆå§‹åŒ–ä»“åº“, ç³»ç»Ÿå…¨å±€é…ç½®, æ‰§è¡Œä¸€æ¬¡å³å¯, é…ç½®ä¿å­˜åœ¨ ~/.gitconfig</span></span><br><span class="line">git lfs install</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·Ÿè¸ªæ–‡ä»¶ï¼Œ å³ä¸ºæŠŠæŒ‡å®šçš„æ–‡ä»¶ä½¿ç”¨ lfs æ¥ç®¡ç†, æ‰§è¡Œåä¼šæ·»åŠ ä¿¡æ¯åˆ° .gitattributes æ–‡ä»¶ä¸­ã€‚</span></span><br><span class="line">git lfs track *.rpm</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹è¢« lfs ç®¡ç†çš„æ–‡ä»¶</span></span><br><span class="line">git lfs ls-files</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æŸä¸ªæ–‡ä»¶æ˜¯å¦è¢« lfs ç®¡ç†</span></span><br><span class="line">git check-attr filter xxx.png</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸‹è½½æ‰€æœ‰lfsæ–‡ä»¶</span></span><br><span class="line">git lfs fetch --all</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸Šä¼ æ‰€æœ‰lfsæ–‡ä»¶</span></span><br><span class="line">git lfs push origin master --all</span><br><span class="line">git lfs push --all</span><br></pre></td></tr></table></figure><h2 id="å°æŠ€å·§"><a href="#å°æŠ€å·§" class="headerlink" title="å°æŠ€å·§"></a>å°æŠ€å·§</h2><h3 id="æŒ‡å®šå¯†ç æ‹‰å–-git"><a href="#æŒ‡å®šå¯†ç æ‹‰å–-git" class="headerlink" title="æŒ‡å®šå¯†ç æ‹‰å– git"></a>æŒ‡å®šå¯†ç æ‹‰å– git</h3><blockquote><p>ä¸å®‰å…¨, æ¨èä½¿ç”¨ ssh å¯†é’¥æ–¹å¼</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># %40 è¡¨ç¤º @</span></span><br><span class="line">git <span class="built_in">clone</span> http://admin:admin%401234@203.156.235.84:10000/r/app/client.git</span><br></pre></td></tr></table></figure><h3 id="åˆ é™¤å†å²è®°å½•ä¸­çš„å¤§æ–‡ä»¶"><a href="#åˆ é™¤å†å²è®°å½•ä¸­çš„å¤§æ–‡ä»¶" class="headerlink" title="åˆ é™¤å†å²è®°å½•ä¸­çš„å¤§æ–‡ä»¶"></a>åˆ é™¤å†å²è®°å½•ä¸­çš„å¤§æ–‡ä»¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£… git-filter-repo å·¥å…·</span></span><br><span class="line">sudo apt install git-filter-repo</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‡è®¾æ–‡ä»¶ä¸ºï¼šlarge_file.zip ï¼Œä»æ‰€æœ‰å†å²è®°å½•ä¸­åˆ é™¤ã€‚</span></span><br><span class="line">git filter-repo --path large_file.zip --invert-paths</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤æ–‡ä»¶å¤¹</span></span><br><span class="line">git filter-repo --path 123/ --invert-paths</span><br></pre></td></tr></table></figure><h3 id="windows-å»ºè®®é…ç½®"><a href="#windows-å»ºè®®é…ç½®" class="headerlink" title="windows å»ºè®®é…ç½®"></a>windows å»ºè®®é…ç½®</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æäº¤æ—¶è½¬æ¢ä¸ºLFï¼Œ æ‹‰å–æ—¶ä¸è½¬æ¢</span></span><br><span class="line"><span class="comment"># æˆ–è€…é…ç½®æˆfalseï¼Œé‚£ä¹ˆgitä¸å¤„ç†æ¢è¡Œç¬¦ï¼Œç”±ç”¨æˆ·è‡ªå·±å¤„ç†ã€‚</span></span><br><span class="line">git config --global core.autocrlf input</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¿½ç•¥è¿½è¸ªæ–‡ä»¶æƒé™</span></span><br><span class="line">git config --global core.filemode <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è§£å†³æ§åˆ¶å°ä¸èƒ½æ­£å¸¸æ˜¾ç¤ºä¸­æ–‡çš„é—®é¢˜</span></span><br><span class="line">git config --global core.quotepath <span class="literal">false</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
            <tag> Linux </tag>
            
            <tag> Git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ ‘è“æ´¾å¸¸ç”¨æ“ä½œè®°å½•</title>
      <link href="/posts/16fcf6b8/"/>
      <url>/posts/16fcf6b8/</url>
      
        <content type="html"><![CDATA[<h2 id="å®‰è£…-Docker"><a href="#å®‰è£…-Docker" class="headerlink" title="å®‰è£… Docker"></a>å®‰è£… Docker</h2><h3 id="æ›¿æ¢æˆæ¸…åæº"><a href="#æ›¿æ¢æˆæ¸…åæº" class="headerlink" title="æ›¿æ¢æˆæ¸…åæº"></a>æ›¿æ¢æˆæ¸…åæº</h3><blockquote><p>æ¸…åæºåœ°å€<a href="https://mirrors.tuna.tsinghua.edu.cn/help/docker-ce/">https://mirrors.tuna.tsinghua.edu.cn/help/docker-ce/</a></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;deb [arch=armhf] https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/debian \</span></span><br><span class="line"><span class="string">     <span class="subst">$(lsb_release -cs)</span> stable&quot;</span> | \</span><br><span class="line">    sudo <span class="built_in">tee</span> /etc/apt/sources.list.d/docker.list</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install docker-ce</span><br></pre></td></tr></table></figure><h2 id="æ›¿æ¢è½¯ä»¶æº"><a href="#æ›¿æ¢è½¯ä»¶æº" class="headerlink" title="æ›¿æ¢è½¯ä»¶æº"></a>æ›¿æ¢è½¯ä»¶æº</h2><p>ä¸­ç§‘å¤§æº<a href="https://mirrors.ustc.edu.cn/help/raspbian.html">https://mirrors.ustc.edu.cn/help/raspbian.html</a><br>æ¸…åæº<a href="https://mirrors.tuna.tsinghua.edu.cn/help/raspbian/">https://mirrors.tuna.tsinghua.edu.cn/help/raspbian/</a></p>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
            <tag> Linux </tag>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>VMware Workstationå¸¸ç”¨æ“ä½œè®°å½•</title>
      <link href="/posts/4bef6e47/"/>
      <url>/posts/4bef6e47/</url>
      
        <content type="html"><![CDATA[<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><h3 id="å®˜æ–¹ä¸‹è½½é“¾æ¥"><a href="#å®˜æ–¹ä¸‹è½½é“¾æ¥" class="headerlink" title="å®˜æ–¹ä¸‹è½½é“¾æ¥"></a>å®˜æ–¹ä¸‹è½½é“¾æ¥</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">https://download3.vmware.com/software/wkst/file/VMware-workstation-full-10.0.7-2844087.exe </span><br><span class="line"></span><br><span class="line">ä¸Šé¢çš„ç‰ˆæœ¬ä¸æ”¯æŒ64ä½Windowsç³»ç»Ÿ </span><br><span class="line">https://download3.vmware.com/software/wkst/file/VMware-workstation-full-12.0.0-2985596.exe</span><br><span class="line">https://download3.vmware.com/software/wkst/file/VMware-workstation-full-12.5.4-5192485.exe</span><br><span class="line">https://download3.vmware.com/software/wkst/file/VMware-workstation-full-12.5.5-5234757.exe </span><br><span class="line">https://download3.vmware.com/software/wkst/file/VMware-workstation-full-12.5.9-7535481.exe </span><br><span class="line">https://download3.vmware.com/software/wkst/file/VMware-workstation-full-14.0.0-6661328.exe </span><br><span class="line">https://download3.vmware.com/software/wkst/file/VMware-workstation-full-14.1.0-7370693.exe </span><br><span class="line">https://download3.vmware.com/software/wkst/file/VMware-workstation-full-14.1.1-7528167.exe </span><br><span class="line">https://download3.vmware.com/software/wkst/file/VMware-workstation-full-14.1.2-8497320.exe </span><br><span class="line">http://download3.vmware.com/software/wkst/file/VMware-workstation-full-14.1.3-9474260.exe </span><br><span class="line">https://download3.vmware.com/software/wkst/file/VMware-workstation-full-14.1.4-10722678.exe </span><br><span class="line">https://download3.vmware.com/software/wkst/file/VMware-workstation-full-14.1.5-10950780.exe </span><br><span class="line">https://download3.vmware.com/software/wkst/file/VMware-workstation-full-14.1.6-12368378.exe </span><br><span class="line">https://download3.vmware.com/software/wkst/file/VMware-workstation-full-14.1.7-12989993.exe </span><br><span class="line">https://download3.vmware.com/software/wkst/file/VMware-workstation-full-14.1.8-14921873.exe </span><br><span class="line">https://download3.vmware.com/software/wkst/file/VMware-workstation-full-15.0.0-10134415.exe </span><br><span class="line">https://download3.vmware.com/software/wkst/file/VMware-workstation-full-15.0.1-10737736.exe </span><br><span class="line">https://download3.vmware.com/software/wkst/file/VMware-workstation-full-15.0.2-10952284.exe </span><br><span class="line">https://download3.vmware.com/software/wkst/file/VMware-workstation-full-15.0.3-12422535.exe</span><br><span class="line">https://download3.vmware.com/software/wkst/file/VMware-workstation-full-15.0.4-12990004.exe</span><br><span class="line">https://download3.vmware.com/software/wkst/file/VMware-workstation-full-15.1.0-13591040.exe </span><br><span class="line">https://download3.vmware.com/software/wkst/file/VMware-workstation-full-15.5.0-14665864.exe</span><br><span class="line">https://download3.vmware.com/software/wkst/file/VMware-workstation-full-15.5.1-15018445.exe</span><br><span class="line">https://download3.vmware.com/software/wkst/file/VMware-workstation-full-15.5.2-15785246.exe </span><br><span class="line"></span><br><span class="line">ä¸Šé¢çš„ç‰ˆæœ¬ä¸èƒ½å’Œhyper-vï¼ˆåŒ…æ‹¬wsl2ï¼‰å…±å­˜ </span><br><span class="line">https://download3.vmware.com/software/wkst/file/VMware-workstation-full-15.5.5-16285975.exe </span><br><span class="line">https://download3.vmware.com/software/wkst/file/VMware-workstation-full-15.5.6-16341506.exe </span><br><span class="line">https://download3.vmware.com/software/wkst/file/VMware-workstation-full-15.5.7-17171714.exe </span><br><span class="line">https://download3.vmware.com/software/wkst/file/VMware-workstation-full-16.0.0-16894299.exe </span><br><span class="line">https://download3.vmware.com/software/wkst/file/VMware-workstation-full-16.1.0-17198959.exe </span><br><span class="line">https://download3.vmware.com/software/wkst/file/VMware-workstation-full-16.1.1-17801498.exe </span><br><span class="line">https://download3.vmware.com/software/wkst/file/VMware-workstation-full-16.1.2-17966106.exe </span><br><span class="line">https://download3.vmware.com/software/wkst/file/VMware-workstation-full-16.2.0-18760230.exe </span><br><span class="line">https://download3.vmware.com/software/wkst/file/VMware-workstation-full-16.2.1-18811642.exe </span><br><span class="line">https://download3.vmware.com/software/wkst/file/VMware-workstation-full-16.2.2-19200509.exe </span><br><span class="line">https://download3.vmware.com/software/WKST-1623-WIN-New/VMware-workstation-full-16.2.3-19376536.exe </span><br><span class="line">https://download3.vmware.com/software/WKST-1624-WIN/VMware-workstation-full-16.2.4-20089737.exe </span><br><span class="line">https://download3.vmware.com/software/WKST-1625-WIN/VMware-workstation-full-16.2.5-20904516.exe </span><br><span class="line">https://download3.vmware.com/software/WKST-1625-WIN/VMware-workstation-full-16.2.5-20904516.exe </span><br><span class="line">https://download3.vmware.com/software/WKST-1700-WIN/VMware-workstation-full-17.0.0-20800274.exe </span><br><span class="line">https://download3.vmware.com/software/WKST-1701-WIN/VMware-workstation-full-17.0.1-21139696.exe </span><br><span class="line">https://download3.vmware.com/software/WKST-1702-WIN/VMware-workstation-full-17.0.2-21581411.exe </span><br><span class="line">https://download3.vmware.com/software/WKST-1750-WIN/VMware-workstation-full-17.5.0-22583795.exe</span><br></pre></td></tr></table></figure><h3 id="åºåˆ—å·"><a href="#åºåˆ—å·" class="headerlink" title="åºåˆ—å·"></a>åºåˆ—å·</h3><table><thead><tr><th>ç‰ˆæœ¬</th><th>æ‰¹é‡æ¿€æ´»åºåˆ—å·</th></tr></thead><tbody><tr><td>10.x</td><td>1Z0G9-67285-FZG78-ZL3Q2-234JG</td></tr><tr><td>11.x</td><td>YG74R-86G1M-M8DLP-XEQNT-XAHW2</td></tr><tr><td>12.x</td><td>ZC3TK-63GE6-481JY-WWW5T-Z7ATA</td></tr><tr><td>14.x</td><td>AU108-FLF9P-H8EJZ-7XMQ9-XG0U8</td></tr><tr><td>15.x</td><td>FC7D0-D1YDL-M8DXZ-CYPZE-P2AY6</td></tr><tr><td>16.x</td><td>ZF3R0-FHED2-M80TY-8QYGC-NPKYF</td></tr><tr><td>17.x</td><td>VG7TK-AZX8N-0888Y-PYQ7E-MKRW8</td></tr></tbody></table><p><a href="https://www.vmware.com/products/workstation-pro/workstation-pro-evaluation.html">æœ€æ–°ç‰ˆä¸‹è½½åœ°å€</a></p><h3 id="ubuntu-å®‰è£…ä¾èµ–"><a href="#ubuntu-å®‰è£…ä¾èµ–" class="headerlink" title="ubuntu å®‰è£…ä¾èµ–"></a>ubuntu å®‰è£…ä¾èµ–</h3><p>Ubuntu ä¸‹é¢å®‰è£… VMWareï¼Œæç¤ºï¼šBuild environment error! A required application is missing and Modconfig can not</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install gcc libcanberra*</span><br></pre></td></tr></table></figure><h2 id="å‡å°å¯¼å‡º-ova-çš„ä½“ç§¯"><a href="#å‡å°å¯¼å‡º-ova-çš„ä½“ç§¯" class="headerlink" title="å‡å°å¯¼å‡º ova çš„ä½“ç§¯"></a>å‡å°å¯¼å‡º ova çš„ä½“ç§¯</h2><blockquote><p>å¯¼å‡º OVF æ¨¡æ¿ä¹‹å‰å‹ç¼©ä¼šå¤§å¹…åº¦ç¼©å° OVF çš„ä½“ç§¯</p></blockquote><h3 id="å‹ç¼©-linux-è™šæ‹Ÿæœºç£ç›˜"><a href="#å‹ç¼©-linux-è™šæ‹Ÿæœºç£ç›˜" class="headerlink" title="å‹ç¼© linux è™šæ‹Ÿæœºç£ç›˜"></a>å‹ç¼© linux è™šæ‹Ÿæœºç£ç›˜</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -E sh -c <span class="string">&#x27;cat /dev/zero &gt; zero;sync;sleep 1;sync;rm -f zero &amp;&amp; vmware-toolbox-cmd disk shrinkonly &amp;&amp; poweroff&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="å‹ç¼©-windows-è™šæ‹Ÿæœºç£ç›˜"><a href="#å‹ç¼©-windows-è™šæ‹Ÿæœºç£ç›˜" class="headerlink" title="å‹ç¼© windows è™šæ‹Ÿæœºç£ç›˜"></a>å‹ç¼© windows è™šæ‹Ÿæœºç£ç›˜</h3><p>åœ¨è™šæ‹Ÿæœºåˆ—è¡¨ä¸Šå³é”®ğŸ‘‰ğŸ»ï¸ç®¡ç†ğŸ‘‰ğŸ»ï¸æ¸…ç†ç£ç›˜</p><h2 id="vmdk-ç£ç›˜æ–‡ä»¶ç®¡ç†"><a href="#vmdk-ç£ç›˜æ–‡ä»¶ç®¡ç†" class="headerlink" title="vmdk ç£ç›˜æ–‡ä»¶ç®¡ç†"></a>vmdk ç£ç›˜æ–‡ä»¶ç®¡ç†</h2><h3 id="å°†å•ä¸ªæ–‡ä»¶-vmdk-åˆ†å‰²æˆæ¯ä¸ªä¸è¶…è¿‡-2G-çš„å¤šä¸ª-vmdk-æ–‡ä»¶"><a href="#å°†å•ä¸ªæ–‡ä»¶-vmdk-åˆ†å‰²æˆæ¯ä¸ªä¸è¶…è¿‡-2G-çš„å¤šä¸ª-vmdk-æ–‡ä»¶" class="headerlink" title="å°†å•ä¸ªæ–‡ä»¶ vmdk åˆ†å‰²æˆæ¯ä¸ªä¸è¶…è¿‡ 2G çš„å¤šä¸ª vmdk æ–‡ä»¶"></a>å°†å•ä¸ªæ–‡ä»¶ vmdk åˆ†å‰²æˆæ¯ä¸ªä¸è¶…è¿‡ 2G çš„å¤šä¸ª vmdk æ–‡ä»¶</h3><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;C:\Program Files (x86)\VMware\VMware Workstation\vmware-vdiskmanager.exe&quot; -r source.vmdk -t <span class="number">1</span> split.vmdk</span><br></pre></td></tr></table></figure><h3 id="åˆå¹¶-vmdk-æ–‡ä»¶"><a href="#åˆå¹¶-vmdk-æ–‡ä»¶" class="headerlink" title="åˆå¹¶ vmdk æ–‡ä»¶"></a>åˆå¹¶ vmdk æ–‡ä»¶</h3><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;C:\Program Files (x86)\VMware\VMware Workstation\vmware-vdiskmanager.exe&quot; -r split.vmdk -t <span class="number">0</span> merged.vmdk</span><br></pre></td></tr></table></figure><h2 id="è™šæ‹Ÿæœº-Linux-å’Œä¸»æœºæ–‡ä»¶å…±äº«"><a href="#è™šæ‹Ÿæœº-Linux-å’Œä¸»æœºæ–‡ä»¶å…±äº«" class="headerlink" title="è™šæ‹Ÿæœº Linux å’Œä¸»æœºæ–‡ä»¶å…±äº«"></a>è™šæ‹Ÿæœº Linux å’Œä¸»æœºæ–‡ä»¶å…±äº«</h2><p>è™šæ‹Ÿæœºéœ€è¦å®‰è£… <code>open-vm-tools</code></p><h3 id="ä½¿ç”¨å‘½ä»¤æ‰‹åŠ¨æŒ‚è½½"><a href="#ä½¿ç”¨å‘½ä»¤æ‰‹åŠ¨æŒ‚è½½" class="headerlink" title="ä½¿ç”¨å‘½ä»¤æ‰‹åŠ¨æŒ‚è½½"></a>ä½¿ç”¨å‘½ä»¤æ‰‹åŠ¨æŒ‚è½½</h3><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">4.0å†…æ ¸ä»¥ä¸Š</button><button type="button" class="tab">4.0å†…æ ¸ä»¥ä¸‹</button></div><div class="tab-contents"><div class="tab-item-content active"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°†æ‰€æœ‰å…±äº«æ–‡ä»¶å¤¹æŒ‚è½½åˆ°/mnt/hgfs</span></span><br><span class="line">sudo vmhgfs-fuse .host:/ /mnt/hgfs -o allow_other</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†åç§°sharedfolderçš„å…±äº«æŒ‚è½½åˆ°/mnt/hgfs</span></span><br><span class="line">sudo /usr/bin/vmhgfs-fuse .host:/sharedfolder /mnt/hgfs -o subtype=vmhgfs-fuse,allow_other </span><br></pre></td></tr></table></figure><blockquote><p>å¯ä»¥ç”¨ <code>vmhgfs-fuse -h</code> æŸ¥çœ‹å‘½ä»¤å¯ç”¨çš„æ‰€æœ‰å‚æ•°ã€‚æŒ‚è½½ç‚¹å¯ä»¥è‡ªå·±è®¾ç½®ï¼Œä¸ä¸€å®šè¦æ”¾åœ¨é»˜è®¤ç›®å½•ã€‚</p></blockquote></div><div class="tab-item-content"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°†æ‰€æœ‰å…±äº«æ–‡ä»¶å¤¹æŒ‚è½½åˆ°/mnt/hgfs</span></span><br><span class="line">sudo mount -t vmhgfs .host:/ /mnt/hgfs</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†åç§°sharedfolderçš„å…±äº«æŒ‚è½½åˆ°/mnt/hgfs</span></span><br><span class="line">sudo mount -t vmhgfs .host:/sharedfolder /mnt/hgfs </span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div><h3 id="ä½¿ç”¨-fstab-è‡ªåŠ¨æŒ‚è½½"><a href="#ä½¿ç”¨-fstab-è‡ªåŠ¨æŒ‚è½½" class="headerlink" title="ä½¿ç”¨ fstab è‡ªåŠ¨æŒ‚è½½"></a>ä½¿ç”¨ fstab è‡ªåŠ¨æŒ‚è½½</h3><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">4.0å†…æ ¸ä»¥ä¸Š</button><button type="button" class="tab">4.0å†…æ ¸ä»¥ä¸‹</button></div><div class="tab-contents"><div class="tab-item-content active"><blockquote><p>åœ¨ <code>/etc/fstab</code> æ·»åŠ ä¸€è¡Œ</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é»˜è®¤å‚æ•°</span></span><br><span class="line">.host:/ /mnt/hgfs fuse.vmhgfs-fuse allow_other,defaults 0 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹ç”¨æˆ·å’Œæ‰€æœ‰è€…ï¼Œä¿®æ”¹é»˜è®¤umaskä¸º022ï¼Œé»˜è®¤æƒé™æ˜¯755</span></span><br><span class="line">.host:/ /mnt/hgfs/ fuse.vmhgfs-fuse allow_other,uid=1000,gid=1000,<span class="built_in">umask</span>=022 0 0</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><blockquote><p>åœ¨ <code>/etc/fstab</code> æ·»åŠ ä¸€è¡Œ</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.host:/ /mnt/hgfs vmhgfs defaults 0 0</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> VirtualMachine </tag>
            
            <tag> Windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Windowsæœç´¢å·¥å…·everything</title>
      <link href="/posts/542f557/"/>
      <url>/posts/542f557/</url>
      
        <content type="html"><![CDATA[<h2 id="æ— æ³•å¼¹å‡ºç§»åŠ¨ç¡¬ç›˜"><a href="#æ— æ³•å¼¹å‡ºç§»åŠ¨ç¡¬ç›˜" class="headerlink" title="æ— æ³•å¼¹å‡ºç§»åŠ¨ç¡¬ç›˜?"></a>æ— æ³•å¼¹å‡ºç§»åŠ¨ç¡¬ç›˜?</h2><p>è®¾ç½®ğŸ‘‰ğŸ»ï¸ç´¢å¼•ğŸ‘‰ğŸ»ï¸NTFS å’Œ REFS<br>å–æ¶ˆå‹¾é€‰ <code>è‡ªåŠ¨åŒ…å«æ–°å¢å›ºå®šå·</code></p><h2 id="æ’é™¤æœç´¢ç»“æœ"><a href="#æ’é™¤æœç´¢ç»“æœ" class="headerlink" title="æ’é™¤æœç´¢ç»“æœ"></a>æ’é™¤æœç´¢ç»“æœ</h2><p>è®¾ç½®ğŸ‘‰ğŸ»ï¸ç´¢å¼•ğŸ‘‰ğŸ»ï¸æ’é™¤åˆ—è¡¨ğŸ‘‰ğŸ»ï¸æ·»åŠ ç­›é€‰å™¨</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$RECYCLE.BIN</span><br><span class="line">*AppData\Roaming\Microsoft\Windows\Recent*</span><br><span class="line">*Windows\Prefetch*</span><br><span class="line">*AppData\Local\Packages\Microsoft.Windows.Search_*</span><br></pre></td></tr></table></figure><h2 id="ç›´æ¥ä¿®æ”¹é…ç½®æ–‡ä»¶"><a href="#ç›´æ¥ä¿®æ”¹é…ç½®æ–‡ä»¶" class="headerlink" title="ç›´æ¥ä¿®æ”¹é…ç½®æ–‡ä»¶"></a>ç›´æ¥ä¿®æ”¹é…ç½®æ–‡ä»¶</h2><p>éœ€è¦å°† everything è¿›ç¨‹å®Œå…¨åœæ­¢åæ‰èƒ½è¿›è¡Œä¿®æ”¹ï¼Œä¸ç„¶ everything å…³é—­çš„æ—¶å€™ä¼šè¦†ç›–æ‰‹åŠ¨ä¿®æ”¹çš„é…ç½®æ–‡ä»¶ã€‚</p><ul><li><p>é€€å‡º everything</p></li><li><p>åœæ­¢ everything æœåŠ¡</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">net</span> stop everything</span><br></pre></td></tr></table></figure></li></ul><p>é…ç½®æ–‡ä»¶åœ°å€:<code>%appdata%\Everything\Everything.ini</code> ä¿®æ”¹å…¶ä¸­ä¸€è¡Œ</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">exclude_folders</span>=<span class="string">&quot;$RECYCLE.BIN&quot;</span>,<span class="string">&quot;*AppData\\Roaming\\Microsoft\\Windows\\Recent*&quot;</span>,<span class="string">&quot;*Windows\\Prefetch*&quot;</span>,<span class="string">&quot;*AppData\\Local\\Packages\\Microsoft.Windows.Search_*&quot;</span></span><br></pre></td></tr></table></figure><p>å¯åŠ¨ everything æœåŠ¡</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">net</span> <span class="built_in">start</span> everything</span><br></pre></td></tr></table></figure><p>å¯åŠ¨ evething è½¯ä»¶</p>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu_Charmed_Kubernetes</title>
      <link href="/posts/efee88da/"/>
      <url>/posts/efee88da/</url>
      
        <content type="html"><![CDATA[<blockquote><p>å®˜æ–¹æ–‡æ¡£: <a href="https://ubuntu.com/kubernetes/docs">https://ubuntu.com/kubernetes/docs</a></p></blockquote><h2 id="å¼€å§‹ä¹‹å‰"><a href="#å¼€å§‹ä¹‹å‰" class="headerlink" title="å¼€å§‹ä¹‹å‰"></a>å¼€å§‹ä¹‹å‰</h2><p>é›†ç¾¤ ip è§„åˆ’ï¼Œæ‰€æœ‰æœºå™¨ç³»ç»Ÿéƒ½æ˜¯ <code>ubuntu 20.04</code></p><table><thead><tr><th>hostname</th><th>ip</th></tr></thead><tbody><tr><td>juju-client</td><td>10.0.0.10</td></tr><tr><td>juju-controller-1</td><td>10.0.0.11</td></tr><tr><td>juju-master-1</td><td>10.0.0.21</td></tr><tr><td>juju-master-2</td><td>10.0.0.22</td></tr><tr><td>juju-master-3</td><td>10.0.0.23</td></tr><tr><td>juju-worker-1</td><td>10.0.0.31</td></tr><tr><td>juju-worker-2</td><td>10.0.0.32</td></tr></tbody></table><blockquote><p>juju-client ä¸º juju å®¢æˆ·ç«¯å’Œ haproxy æœºå™¨<br>juju-controller-1 ä¸º juju æ§åˆ¶å™¨èŠ‚ç‚¹ (å¯ä»¥åšé«˜å¯ç”¨)</p></blockquote><p>ä»¥ä¸‹æ“ä½œéƒ½æ˜¯åœ¨ juju-client ä¸Šæ‰§è¡Œ</p><h3 id="å®‰è£…-juju"><a href="#å®‰è£…-juju" class="headerlink" title="å®‰è£… juju"></a>å®‰è£… juju</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo snap install juju --classic</span><br></pre></td></tr></table></figure><h3 id="è®¾ç½®äº‘ç±»å‹"><a href="#è®¾ç½®äº‘ç±»å‹" class="headerlink" title="è®¾ç½®äº‘ç±»å‹"></a>è®¾ç½®äº‘ç±»å‹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">juju add-cloud</span><br><span class="line">è¾“å…¥manual</span><br></pre></td></tr></table></figure><h3 id="æ·»åŠ æœºå™¨-ä¸€å…±-5-å°"><a href="#æ·»åŠ æœºå™¨-ä¸€å…±-5-å°" class="headerlink" title="æ·»åŠ æœºå™¨ (ä¸€å…± 5 å°)"></a>æ·»åŠ æœºå™¨ (ä¸€å…± 5 å°)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">juju bootstrap</span><br><span class="line">juju add-machine ssh:root@x.x.x.x</span><br></pre></td></tr></table></figure><blockquote><p>æœºå™¨æ·»åŠ å®Œæˆå, <code>juju machines</code> èƒ½çœ‹åˆ°æœºå™¨ id</p></blockquote><h3 id="ç”Ÿæˆ-yaml"><a href="#ç”Ÿæˆ-yaml" class="headerlink" title="ç”Ÿæˆ yaml"></a>ç”Ÿæˆ yaml</h3><p><del>åœ¨<a href="https://jujucharms.com/new/">https://jujucharms.com/new/</a>ç”»å›¾ï¼Œç„¶åå¯¼å‡ºæˆ yaml</del><br><code>etcd</code> è¿˜æ˜¯ å’Œ <code>master</code> åˆ†å¼€éƒ¨ç½²<br>etcd.yaml</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">description:</span> <span class="string">Kubernetes</span> <span class="string">Cluster</span> <span class="string">Deploy.</span></span><br><span class="line"><span class="attr">series:</span> <span class="string">focal</span></span><br><span class="line"><span class="attr">machines:</span></span><br><span class="line">  <span class="attr">&#x27;0&#x27;:</span></span><br><span class="line">    <span class="attr">series:</span> <span class="string">focal</span></span><br><span class="line">  <span class="attr">&#x27;1&#x27;:</span></span><br><span class="line">    <span class="attr">series:</span> <span class="string">focal</span></span><br><span class="line">  <span class="attr">&#x27;2&#x27;:</span></span><br><span class="line">    <span class="attr">series:</span> <span class="string">focal</span></span><br><span class="line">  <span class="attr">&#x27;3&#x27;:</span></span><br><span class="line">    <span class="attr">series:</span> <span class="string">focal</span></span><br><span class="line">  <span class="attr">&#x27;4&#x27;:</span></span><br><span class="line">    <span class="attr">series:</span> <span class="string">focal</span></span><br><span class="line"><span class="attr">applications:</span></span><br><span class="line">  <span class="attr">easyrsa:</span></span><br><span class="line">    <span class="attr">charm:</span> <span class="string">cs:~containers/easyrsa-345</span></span><br><span class="line">    <span class="attr">num_units:</span> <span class="number">1</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="attr">easyrsa:</span> <span class="number">5</span></span><br><span class="line">    <span class="attr">to:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&#x27;0&#x27;</span></span><br><span class="line">  <span class="attr">etcd:</span></span><br><span class="line">    <span class="attr">charm:</span> <span class="string">cs:~containers/etcd-553</span></span><br><span class="line">    <span class="attr">num_units:</span> <span class="number">5</span></span><br><span class="line">    <span class="attr">options:</span></span><br><span class="line">      <span class="attr">channel:</span> <span class="number">3.4</span><span class="string">/stable</span></span><br><span class="line">      <span class="attr">bind_to_all_interfaces:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="attr">core:</span> <span class="number">0</span></span><br><span class="line">      <span class="attr">etcd:</span> <span class="number">3</span></span><br><span class="line">      <span class="attr">snapshot:</span> <span class="number">0</span></span><br><span class="line">    <span class="attr">to:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&#x27;0&#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&#x27;1&#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&#x27;2&#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&#x27;4&#x27;</span></span><br><span class="line"><span class="attr">relations:</span></span><br><span class="line"><span class="bullet">-</span> <span class="bullet">-</span> <span class="string">etcd:certificates</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">easyrsa:client</span></span><br></pre></td></tr></table></figure><p>core.yaml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">description:</span> <span class="string">Kubernetes</span> <span class="string">Cluster</span> <span class="string">Deploy.</span></span><br><span class="line"><span class="attr">series:</span> <span class="string">focal</span></span><br><span class="line"><span class="attr">machines:</span></span><br><span class="line">  <span class="attr">&#x27;0&#x27;:</span></span><br><span class="line">    <span class="attr">series:</span> <span class="string">focal</span></span><br><span class="line">  <span class="attr">&#x27;1&#x27;:</span></span><br><span class="line">    <span class="attr">series:</span> <span class="string">focal</span></span><br><span class="line">  <span class="attr">&#x27;2&#x27;:</span></span><br><span class="line">    <span class="attr">series:</span> <span class="string">focal</span></span><br><span class="line">  <span class="attr">&#x27;3&#x27;:</span></span><br><span class="line">    <span class="attr">series:</span> <span class="string">focal</span></span><br><span class="line">  <span class="attr">&#x27;4&#x27;:</span></span><br><span class="line">    <span class="attr">series:</span> <span class="string">focal</span></span><br><span class="line">  <span class="attr">&#x27;5&#x27;:</span></span><br><span class="line">    <span class="attr">series:</span> <span class="string">focal</span></span><br><span class="line">  <span class="attr">&#x27;6&#x27;:</span></span><br><span class="line">    <span class="attr">series:</span> <span class="string">focal</span></span><br><span class="line">  <span class="attr">&#x27;7&#x27;:</span></span><br><span class="line">    <span class="attr">series:</span> <span class="string">focal</span></span><br><span class="line">  <span class="attr">&#x27;8&#x27;:</span></span><br><span class="line">    <span class="attr">series:</span> <span class="string">focal</span></span><br><span class="line"><span class="attr">applications:</span></span><br><span class="line">  <span class="attr">containerd:</span></span><br><span class="line">    <span class="attr">charm:</span> <span class="string">cs:~containers/containerd-102</span></span><br><span class="line">    <span class="attr">resources:</span> &#123;&#125;</span><br><span class="line">  <span class="attr">easyrsa:</span></span><br><span class="line">    <span class="attr">charm:</span> <span class="string">cs:~containers/easyrsa-345</span></span><br><span class="line">    <span class="attr">num_units:</span> <span class="number">1</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="attr">easyrsa:</span> <span class="number">5</span></span><br><span class="line">    <span class="attr">to:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&#x27;0&#x27;</span></span><br><span class="line">  <span class="attr">etcd:</span></span><br><span class="line">    <span class="attr">charm:</span> <span class="string">cs:~containers/etcd-553</span></span><br><span class="line">    <span class="attr">num_units:</span> <span class="number">5</span></span><br><span class="line">    <span class="attr">options:</span></span><br><span class="line">      <span class="attr">channel:</span> <span class="number">3.4</span><span class="string">/stable</span></span><br><span class="line">      <span class="attr">bind_to_all_interfaces:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="attr">core:</span> <span class="number">0</span></span><br><span class="line">      <span class="attr">etcd:</span> <span class="number">3</span></span><br><span class="line">      <span class="attr">snapshot:</span> <span class="number">0</span></span><br><span class="line">    <span class="attr">to:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&#x27;0&#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&#x27;1&#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&#x27;2&#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&#x27;4&#x27;</span></span><br><span class="line">  <span class="attr">kubeapi-load-balancer:</span></span><br><span class="line">    <span class="attr">charm:</span> <span class="string">cs:~containers/kubeapi-load-balancer-757</span></span><br><span class="line">    <span class="attr">expose:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">num_units:</span> <span class="number">1</span></span><br><span class="line">    <span class="attr">resources:</span> &#123;&#125;</span><br><span class="line">    <span class="attr">to:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&#x27;5&#x27;</span></span><br><span class="line">  <span class="attr">kubernetes-master:</span></span><br><span class="line">    <span class="attr">charm:</span> <span class="string">cs:~containers/kubernetes-master-955</span></span><br><span class="line">    <span class="attr">expose:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">num_units:</span> <span class="number">3</span></span><br><span class="line">    <span class="attr">options:</span></span><br><span class="line">      <span class="attr">channel:</span> <span class="number">1.20</span><span class="string">/stable</span></span><br><span class="line">      <span class="attr">service-cidr:</span> <span class="number">172.31</span><span class="number">.64</span><span class="number">.0</span><span class="string">/21</span></span><br><span class="line">      <span class="attr">enable-dashboard-addons:</span> <span class="literal">false</span></span><br><span class="line">      <span class="attr">proxy-extra-args:</span> <span class="string">proxy-mode=ipvs</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="attr">cdk-addons:</span> <span class="number">0</span></span><br><span class="line">      <span class="attr">core:</span> <span class="number">0</span></span><br><span class="line">      <span class="attr">kube-apiserver:</span> <span class="number">0</span></span><br><span class="line">      <span class="attr">kube-controller-manager:</span> <span class="number">0</span></span><br><span class="line">      <span class="attr">kube-proxy:</span> <span class="number">0</span></span><br><span class="line">      <span class="attr">kube-scheduler:</span> <span class="number">0</span></span><br><span class="line">      <span class="attr">kubectl:</span> <span class="number">0</span></span><br><span class="line">    <span class="attr">to:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&#x27;5&#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&#x27;6&#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&#x27;7&#x27;</span></span><br><span class="line">  <span class="attr">kubernetes-worker:</span></span><br><span class="line">    <span class="attr">charm:</span> <span class="string">cs:~containers/kubernetes-worker-726</span></span><br><span class="line">    <span class="attr">expose:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">num_units:</span> <span class="number">1</span></span><br><span class="line">    <span class="attr">options:</span></span><br><span class="line">      <span class="attr">channel:</span> <span class="number">1.20</span><span class="string">/stable</span></span><br><span class="line">      <span class="attr">proxy-extra-args:</span> <span class="string">proxy-mode=ipvs</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="attr">cni-amd64:</span> <span class="number">708</span></span><br><span class="line">      <span class="attr">cni-arm64:</span> <span class="number">699</span></span><br><span class="line">      <span class="attr">cni-s390x:</span> <span class="number">711</span></span><br><span class="line">      <span class="attr">core:</span> <span class="number">0</span></span><br><span class="line">      <span class="attr">kube-proxy:</span> <span class="number">0</span></span><br><span class="line">      <span class="attr">kubectl:</span> <span class="number">0</span></span><br><span class="line">      <span class="attr">kubelet:</span> <span class="number">0</span></span><br><span class="line">    <span class="attr">to:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&#x27;8&#x27;</span></span><br><span class="line">  <span class="attr">canal:</span></span><br><span class="line">    <span class="attr">charm:</span> <span class="string">&#x27;cs:~containers/canal-755&#x27;</span></span><br><span class="line">    <span class="attr">options:</span></span><br><span class="line">      <span class="attr">cidr:</span> <span class="number">172.31</span><span class="number">.0</span><span class="number">.0</span><span class="string">/18</span></span><br><span class="line">      <span class="attr">iface:</span> <span class="string">eth0</span></span><br><span class="line">      <span class="attr">ignore-loose-rpf:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">series:</span> <span class="string">focal</span></span><br><span class="line"><span class="attr">relations:</span></span><br><span class="line"><span class="bullet">-</span> <span class="bullet">-</span> <span class="string">kubernetes-master:kube-api-endpoint</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">kubeapi-load-balancer:apiserver</span></span><br><span class="line"><span class="bullet">-</span> <span class="bullet">-</span> <span class="string">kubernetes-master:loadbalancer</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">kubeapi-load-balancer:loadbalancer</span></span><br><span class="line"><span class="bullet">-</span> <span class="bullet">-</span> <span class="string">kubernetes-worker:kube-api-endpoint</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">kubeapi-load-balancer:website</span></span><br><span class="line"><span class="bullet">-</span> <span class="bullet">-</span> <span class="string">kubernetes-master:kube-control</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">kubernetes-worker:kube-control</span></span><br><span class="line"><span class="bullet">-</span> <span class="bullet">-</span> <span class="string">kubernetes-master:certificates</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">easyrsa:client</span></span><br><span class="line"><span class="bullet">-</span> <span class="bullet">-</span> <span class="string">kubeapi-load-balancer:certificates</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">easyrsa:client</span></span><br><span class="line"><span class="bullet">-</span> <span class="bullet">-</span> <span class="string">kubernetes-master:etcd</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">etcd:db</span></span><br><span class="line"><span class="bullet">-</span> <span class="bullet">-</span> <span class="string">kubernetes-worker:certificates</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">easyrsa:client</span></span><br><span class="line"><span class="bullet">-</span> <span class="bullet">-</span> <span class="string">etcd:certificates</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">easyrsa:client</span></span><br><span class="line"><span class="bullet">-</span> <span class="bullet">-</span> <span class="string">canal:etcd</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">etcd:db</span></span><br><span class="line"><span class="bullet">-</span> <span class="bullet">-</span> <span class="string">canal:cni</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">kubernetes-master:cni</span></span><br><span class="line"><span class="bullet">-</span> <span class="bullet">-</span> <span class="string">canal:cni</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">kubernetes-worker:cni</span></span><br><span class="line"><span class="bullet">-</span> <span class="bullet">-</span> <span class="string">containerd:containerd</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">kubernetes-worker:container-runtime</span></span><br><span class="line"><span class="bullet">-</span> <span class="bullet">-</span> <span class="string">containerd:containerd</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">kubernetes-master:container-runtime</span></span><br></pre></td></tr></table></figure><h3 id="æ ¹æ®-yml-æ¥éƒ¨ç½²"><a href="#æ ¹æ®-yml-æ¥éƒ¨ç½²" class="headerlink" title="æ ¹æ® yml æ¥éƒ¨ç½²"></a>æ ¹æ® yml æ¥éƒ¨ç½²</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">juju deploy ./etcd.yaml --map-machines=existing,0=0,1=1,2=2,3=3,4=4</span><br><span class="line">juju deploy ./core.yaml --map-machines=existing,0=0,1=1,2=2,3=3,4=4,5=5,6=6,7=7,8=8</span><br></pre></td></tr></table></figure><p>juju status å…¨éƒ¨ idle å°±ç®—æ­£å¸¸äº†</p><h3 id="æ‰©å®¹-worker-èŠ‚ç‚¹"><a href="#æ‰©å®¹-worker-èŠ‚ç‚¹" class="headerlink" title="æ‰©å®¹ worker èŠ‚ç‚¹"></a>æ‰©å®¹ worker èŠ‚ç‚¹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">juju add-machine ssh:root@x.x.x.x</span><br><span class="line">juju add-unit kubernetes-worker --to &lt;machine_id&gt;</span><br></pre></td></tr></table></figure><h2 id="kata-å®¹å™¨"><a href="#kata-å®¹å™¨" class="headerlink" title="kata å®¹å™¨"></a>kata å®¹å™¨</h2><h3 id="éƒ¨ç½²"><a href="#éƒ¨ç½²" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">juju deploy cs:~containers/kata</span><br><span class="line">juju add-relation kata kubernetes-master</span><br><span class="line">juju add-relation kata kubernetes-worker</span><br><span class="line">juju add-relation kata:untrusted containerd:untrusted</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><p>éƒ¨ç½²çš„æ—¶å€™åŠ ä¸Š <code>io.kubernetes.cri.untrusted-workload: &quot;true&quot;</code></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-untrusted</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">io.kubernetes.cri.untrusted-workload:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx</span></span><br></pre></td></tr></table></figure><h3 id="åˆ é™¤-kata-è¿è¡Œæ—¶"><a href="#åˆ é™¤-kata-è¿è¡Œæ—¶" class="headerlink" title="åˆ é™¤ kata è¿è¡Œæ—¶"></a>åˆ é™¤ kata è¿è¡Œæ—¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">juju remove-relation --force kata kubernetes-master</span><br><span class="line">juju remove-relation --force kata kubernetes-worker</span><br><span class="line">juju remove-relation --force kata:untrusted containerd:untrusted</span><br><span class="line">juju remove-application kata</span><br></pre></td></tr></table></figure><h2 id="æ›´æ¢-master-èŠ‚ç‚¹"><a href="#æ›´æ¢-master-èŠ‚ç‚¹" class="headerlink" title="æ›´æ¢ master èŠ‚ç‚¹"></a>æ›´æ¢ master èŠ‚ç‚¹</h2><h3 id="å…ˆåˆ é™¤èŠ‚ç‚¹"><a href="#å…ˆåˆ é™¤èŠ‚ç‚¹" class="headerlink" title="å…ˆåˆ é™¤èŠ‚ç‚¹"></a>å…ˆåˆ é™¤èŠ‚ç‚¹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">juju remove-unit etcd/1 --force --no-wait</span><br><span class="line">juju remove-unit kubernetes-master/1 --force --no-wait</span><br><span class="line">juju remove-machine 1 --force --no-wait</span><br></pre></td></tr></table></figure><h3 id="etcd-é›†ç¾¤åˆ é™¤è¿™ä¸ª-member"><a href="#etcd-é›†ç¾¤åˆ é™¤è¿™ä¸ª-member" class="headerlink" title="etcd é›†ç¾¤åˆ é™¤è¿™ä¸ª member"></a>etcd é›†ç¾¤åˆ é™¤è¿™ä¸ª member</h3><blockquote><p><a href="https://ubuntu.com/kubernetes/docs/charm-etcd">https://ubuntu.com/kubernetes/docs/charm-etcd</a></p></blockquote><p>éœ€è¦å…ˆä¸‹è½½è¯ä¹¦åˆ°æœ¬åœ° (è¦è§£å‹)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">juju run-action --<span class="built_in">wait</span> etcd/0 package-client-credentials</span><br><span class="line">juju scp etcd/0:etcd_credentials.tar.gz etcd_credentials.tar.gz</span><br></pre></td></tr></table></figure><p>ç„¶åä½¿ç”¨ etcdctl åˆ é™¤èŠ‚ç‚¹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> ETCDCTL_KEY_FILE=$(<span class="built_in">pwd</span>)/client.key</span><br><span class="line"><span class="built_in">export</span> ETCDCTL_CERT_FILE=$(<span class="built_in">pwd</span>)/client.crt</span><br><span class="line"><span class="built_in">export</span> ETCDCTL_CA_FILE=$(<span class="built_in">pwd</span>)/ca.crt</span><br><span class="line"><span class="built_in">export</span> ETCDCTL_ENDPOINT=https://10.0.0.21:2379</span><br><span class="line">etcdctl member list</span><br><span class="line"></span><br><span class="line">etcdctl member remove c2499df1988d1925</span><br></pre></td></tr></table></figure><h3 id="å¢åŠ èŠ‚ç‚¹"><a href="#å¢åŠ èŠ‚ç‚¹" class="headerlink" title="å¢åŠ èŠ‚ç‚¹"></a>å¢åŠ èŠ‚ç‚¹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">juju add-machine ssh:root@100.64.1.167</span><br><span class="line">juju machines</span><br><span class="line">è®°ä½èŠ‚ç‚¹ID,å‡å¦‚æ˜¯9</span><br></pre></td></tr></table></figure><h3 id="æ‰©å®¹-master-åˆ°èŠ‚ç‚¹-9"><a href="#æ‰©å®¹-master-åˆ°èŠ‚ç‚¹-9" class="headerlink" title="æ‰©å®¹ master åˆ°èŠ‚ç‚¹ 9"></a>æ‰©å®¹ master åˆ°èŠ‚ç‚¹ 9</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">juju add-unit kubernetes-master --to 9</span><br></pre></td></tr></table></figure><h3 id="æ‰©å®¹-etcd-åˆ°èŠ‚ç‚¹-9"><a href="#æ‰©å®¹-etcd-åˆ°èŠ‚ç‚¹-9" class="headerlink" title="æ‰©å®¹ etcd åˆ°èŠ‚ç‚¹ 9"></a>æ‰©å®¹ etcd åˆ°èŠ‚ç‚¹ 9</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">juju add-unit etcd --to 9</span><br></pre></td></tr></table></figure><h2 id="master-èŠ‚ç‚¹é«˜å¯ç”¨"><a href="#master-èŠ‚ç‚¹é«˜å¯ç”¨" class="headerlink" title="master èŠ‚ç‚¹é«˜å¯ç”¨"></a>master èŠ‚ç‚¹é«˜å¯ç”¨</h2><h3 id="æ–¹æ¡ˆ-1-æ­å»º-haproxy-è´Ÿè½½å‡è¡¡"><a href="#æ–¹æ¡ˆ-1-æ­å»º-haproxy-è´Ÿè½½å‡è¡¡" class="headerlink" title="æ–¹æ¡ˆ 1 æ­å»º haproxy è´Ÿè½½å‡è¡¡"></a>æ–¹æ¡ˆ 1 æ­å»º haproxy è´Ÿè½½å‡è¡¡</h3><blockquote><p>æ·»åŠ äº†å‚æ•° <code>proxy-extra-args: proxy-mode=ipvs</code> è¡¨ç¤ºä½¿ç”¨ lvs åšè´Ÿè½½å‡è¡¡ï¼Œå¯ä»¥ä¸ç”¨ haproxy</p></blockquote><ol><li><p>haproxy é…ç½®æ–‡ä»¶</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">...çœç•¥</span><br><span class="line"></span><br><span class="line">frontend http_ingress_traffic_fe</span><br><span class="line">    bind 0.0.0.0:80</span><br><span class="line">    mode tcp</span><br><span class="line">    default_backend   http_ingress_traffic_be</span><br><span class="line"></span><br><span class="line">backend http_ingress_traffic_be</span><br><span class="line">    mode tcp</span><br><span class="line">    balance     roundrobin</span><br><span class="line">    server      juju-worker-1 10.0.0.31:80 check</span><br><span class="line">    server      juju-worker-2 10.0.0.32:80 check</span><br><span class="line"></span><br><span class="line">frontend https_ingress_traffic_fe</span><br><span class="line">    bind 0.0.0.0:443</span><br><span class="line">    mode tcp</span><br><span class="line">    default_backend   https_ingress_traffic_be</span><br><span class="line"></span><br><span class="line">backend https_ingress_traffic_be</span><br><span class="line">    mode tcp</span><br><span class="line">    balance     roundrobin</span><br><span class="line">    server      juju-worker-1 10.0.0.31:443 check</span><br><span class="line">    server      juju-worker-2 10.0.0.32:443 check</span><br><span class="line"></span><br><span class="line">frontend k8s_api_fe</span><br><span class="line">    bind 0.0.0.0:6443</span><br><span class="line">    mode tcp</span><br><span class="line">    default_backend   k8s_api_be</span><br><span class="line"></span><br><span class="line">backend k8s_api_be</span><br><span class="line">    mode tcp</span><br><span class="line">    balance     roundrobin</span><br><span class="line">    server      juju-master-1 10.0.0.21:6443 check</span><br><span class="line">    server      juju-master-2 10.0.0.22:6443 check</span><br><span class="line">    server      juju-master-3 10.0.0.23:6443 check</span><br></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹è´Ÿè½½å‡è¡¡çš„ ip</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">juju config kubernetes-master loadbalancer-ips=<span class="string">&quot;10.0.0.10&quot;</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="æ–¹æ¡ˆ-2-ä½¿ç”¨-keepalived"><a href="#æ–¹æ¡ˆ-2-ä½¿ç”¨-keepalived" class="headerlink" title="æ–¹æ¡ˆ 2 ä½¿ç”¨ keepalived"></a>æ–¹æ¡ˆ 2 ä½¿ç”¨ keepalived</h3><p>å‚è€ƒæ–‡ç« ï¼š<a href="https://ubuntu.com/kubernetes/docs/keepalived">https://ubuntu.com/kubernetes/docs/keepalived</a></p><h2 id="juju-controller-é«˜å¯ç”¨"><a href="#juju-controller-é«˜å¯ç”¨" class="headerlink" title="juju-controller é«˜å¯ç”¨"></a>juju-controller é«˜å¯ç”¨</h2><h3 id="å¢åŠ æ–°çš„-controller-èŠ‚ç‚¹"><a href="#å¢åŠ æ–°çš„-controller-èŠ‚ç‚¹" class="headerlink" title="å¢åŠ æ–°çš„ controller èŠ‚ç‚¹"></a>å¢åŠ æ–°çš„ controller èŠ‚ç‚¹</h3><p>é¦–å…ˆåˆ‡æ¢åˆ° controller</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">juju switch controller</span><br><span class="line"><span class="comment"># juju switch default åˆ‡æ¢å›æ¥</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">juju add-machine ssh:root@100.64.1.169</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹ controller æœºå™¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">juju machines</span><br></pre></td></tr></table></figure><h3 id="å¼€å¯é«˜å¯ç”¨"><a href="#å¼€å¯é«˜å¯ç”¨" class="headerlink" title="å¼€å¯é«˜å¯ç”¨"></a>å¼€å¯é«˜å¯ç”¨</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">juju enable-ha --to 5,6</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹ controller ä¿¡æ¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">juju controllers --refresh</span><br><span class="line">juju controllers</span><br></pre></td></tr></table></figure><h2 id="å…¶ä»–å¸¸è§é—®é¢˜"><a href="#å…¶ä»–å¸¸è§é—®é¢˜" class="headerlink" title="å…¶ä»–å¸¸è§é—®é¢˜"></a>å…¶ä»–å¸¸è§é—®é¢˜</h2><h3 id="å®‰è£…-kubectl"><a href="#å®‰è£…-kubectl" class="headerlink" title="å®‰è£… kubectl"></a>å®‰è£… kubectl</h3><ol><li><p>å®‰è£…</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo snap install kubectl --classic</span><br></pre></td></tr></table></figure></li><li><p>è·å–æ–°çš„ kubeconfig é…ç½®æ–‡ä»¶</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">juju scp kubernetes-master/0:config ~/.kube/config</span><br></pre></td></tr></table></figure></li></ol><h3 id="æ“ä½œ-etcd"><a href="#æ“ä½œ-etcd" class="headerlink" title="æ“ä½œ etcd"></a>æ“ä½œ etcd</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">juju run-action --<span class="built_in">wait</span> etcd/10 package-client-credentials</span><br><span class="line">juju scp etcd/25:etcd_credentials.tar.gz etcd_credentials.tar.gz</span><br><span class="line"></span><br><span class="line">etcdctl --cacert=$(<span class="built_in">pwd</span>)/ca.crt --cert=$(<span class="built_in">pwd</span>)/client.crt --key=$(<span class="built_in">pwd</span>)/client.key --endpoints=<span class="string">&quot;https://172.31.72.5:2379&quot;</span> member list</span><br></pre></td></tr></table></figure><h3 id="é‡æ–°æ·»åŠ èŠ‚ç‚¹"><a href="#é‡æ–°æ·»åŠ èŠ‚ç‚¹" class="headerlink" title="é‡æ–°æ·»åŠ èŠ‚ç‚¹"></a>é‡æ–°æ·»åŠ èŠ‚ç‚¹</h3><blockquote><p>æ¯”å¦‚å·²ç»æ·»åŠ è¿‡çš„æœºå™¨ï¼Œç”±äºé…ç½®å‡ºé”™æˆ–è€…å…¶ä»–åŸå› æƒ³é‡æ–°æ·»åŠ è¿›æ¥åˆå§‹åŒ–ï¼Œå¯ä»¥å…ˆç§»é™¤å†æ·»åŠ ã€‚</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">juju remove-machine &lt;machine-id&gt; --force</span><br></pre></td></tr></table></figure><p>åœ¨ç›®æ ‡æœºå™¨ä¸Šæ‰§è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo /sbin/remove-juju-services</span><br><span class="line">sudo <span class="built_in">rm</span> -rf /root/cdk /var/lib/juju/ /opt/calicoctl</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å®¹å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
            <tag> Ubuntu </tag>
            
            <tag> keepalived </tag>
            
            <tag> Container </tag>
            
            <tag> Kubernetes </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ­å»ºç½‘å…³æœåŠ¡å™¨</title>
      <link href="/posts/11e2a998/"/>
      <url>/posts/11e2a998/</url>
      
        <content type="html"><![CDATA[<p>ç½‘å…³æœåŠ¡å™¨çš„å¸¸è§ç”¨é€”:<br>1.ä¼ä¸šå±€åŸŸç½‘æƒ³è¦è®¿é—®å¤–ç½‘,å¯ä»¥ä½¿ç”¨ç½‘å…³æœåŠ¡å™¨ä¸Šç½‘<br>2.å¯ä»¥ä¸€ä¸ªç½‘å¡è¿æ¥å…¬ç½‘,ä¸€ä¸ªç½‘å¡è¿æ¥å±€åŸŸç½‘äº¤æ¢æœº,è®©ç½‘å…³æœåŠ¡å™¨åšè·¯ç”±å™¨ä½¿ç”¨</p><h2 id="Windows-å¹³å°"><a href="#Windows-å¹³å°" class="headerlink" title="Windows å¹³å°"></a>Windows å¹³å°</h2><h3 id="å¤–ç½‘é€‚é…å™¨æ‰“å¼€å…±äº«"><a href="#å¤–ç½‘é€‚é…å™¨æ‰“å¼€å…±äº«" class="headerlink" title="å¤–ç½‘é€‚é…å™¨æ‰“å¼€å…±äº«"></a>å¤–ç½‘é€‚é…å™¨æ‰“å¼€å…±äº«</h3><p>æ‰“å¼€ æ§åˆ¶é¢æ¿\ç½‘ç»œå’Œ Internet\ç½‘ç»œè¿æ¥<br>å³é”®å¤–ç½‘ç½‘å¡, å±æ€§, å…±äº«</p><ul><li><input checked="" disabled="" type="checkbox"> å…è®¸å…¶ä»–ç”¨æˆ·é€šè¿‡æ­¤è®¡ç®—æœºçš„ Internet è¿æ¥æ¥è¿æ¥</li></ul><blockquote><p>æ³¨æ„: å¤–ç½‘æ‰“å¼€å…è®¸å…¶ä»–ç”¨æˆ·è¿æ¥å,å†…ç½‘çš„ IP åœ°å€ä¼šè‡ªåŠ¨æ”¹å˜,è¿™æ—¶å€™å¾—æ‰‹åŠ¨ä¿®æ”¹ä¸€ä¸‹å†…ç½‘é€‚é…å™¨çš„ IP åœ°å€.</p></blockquote><h3 id="å†…ç½‘æœºå™¨è®¾ç½®"><a href="#å†…ç½‘æœºå™¨è®¾ç½®" class="headerlink" title="å†…ç½‘æœºå™¨è®¾ç½®"></a>å†…ç½‘æœºå™¨è®¾ç½®</h3><blockquote><p>å†…ç½‘æœºå™¨ç½‘å…³é…ç½®æˆ ç½‘å…³æœåŠ¡å™¨ çš„å†…ç½‘ IP</p></blockquote><p><em>æ³¨æ„:</em><br>å†…ç½‘é€‚é…å™¨çš„å›ºå®š IP ä¸è¦å¡«å†™ç½‘å…³,å¦åˆ™ä¼šå¯¼è‡´è·¯ç”±æ··ä¹±.</p><h2 id="Liunx-æœåŠ¡ç«¯-ç”¨-firewalld"><a href="#Liunx-æœåŠ¡ç«¯-ç”¨-firewalld" class="headerlink" title="Liunx æœåŠ¡ç«¯ (ç”¨ firewalld)"></a>Liunx æœåŠ¡ç«¯ (ç”¨ firewalld)</h2><blockquote><p>å¤šç½‘å¡æœºå™¨åšç½‘å…³åš nat è½¬å‘, å±€åŸŸç½‘å…¶ä»–æœºå™¨éœ€è¦é…ç½®ç½‘å…³åœ°å€.</p></blockquote><p>å¼€å¯å†…æ ¸è½¬å‘</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/sysctl.conf</span><br><span class="line">---</span><br><span class="line">net.ipv4.ip_forward = 1</span><br></pre></td></tr></table></figure><p>ç«‹å³ç”Ÿæ•ˆ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo sysctl -p</span><br></pre></td></tr></table></figure><p>å¼€å¯ NAT è½¬å‘</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --permanent --zone=public --add-masquerade</span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure><p>æ£€æŸ¥æ˜¯å¦å…è®¸ NAT è½¬å‘</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --query-masquerade</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸æƒ³ç”¨äº†, ç¦æ­¢é˜²ç«å¢™ NAT è½¬å‘</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --remove-masquerade</span><br></pre></td></tr></table></figure><h2 id="åœ¨-Linux-å¹³å°æ­å»º-ä½¿ç”¨-iptables"><a href="#åœ¨-Linux-å¹³å°æ­å»º-ä½¿ç”¨-iptables" class="headerlink" title="åœ¨ Linux å¹³å°æ­å»º (ä½¿ç”¨ iptables)"></a>åœ¨ Linux å¹³å°æ­å»º (ä½¿ç”¨ iptables)</h2><blockquote><p>è¿™é‡ŒæœåŠ¡ç«¯å¹³å°ç”¨ Centos 7 1804 ç‰ˆæœ¬,å®¢æˆ·ç«¯ç”¨çš„æ˜¯ Win7<br>å¤–ç½‘ IP:192.168.111.0&#x2F;24 å†…ç½‘ IP:192.168.222.0&#x2F;24</p></blockquote><h3 id="å…³é—­-firewalld-æ‰“å¼€-iptables-æœåŠ¡"><a href="#å…³é—­-firewalld-æ‰“å¼€-iptables-æœåŠ¡" class="headerlink" title="å…³é—­ firewalld,æ‰“å¼€ iptables æœåŠ¡"></a>å…³é—­ firewalld,æ‰“å¼€ iptables æœåŠ¡</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl mask firewalld</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…-iptables-services"><a href="#å®‰è£…-iptables-services" class="headerlink" title="å®‰è£… iptables-services"></a>å®‰è£… iptables-services</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install iptables-service</span><br></pre></td></tr></table></figure><p>è®¾ç½®å¼€æœºå¯åŠ¨é˜²ç«å¢™</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> iptables</span><br></pre></td></tr></table></figure><p>å¼€å¯å†…æ ¸è½¬å‘</p><p>vim &#x2F;etc&#x2F;sysctl.conf</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net.ipv4.ip_forward = 1</span><br></pre></td></tr></table></figure><p>é…ç½® iptables</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -t nat -A POSTROUTING -s 192.168.222.0/24 -j MASQUERADE</span><br></pre></td></tr></table></figure><p>ä¿å­˜&amp;é‡å¯ iptables</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">service iptables save</span><br><span class="line">service iptables restart</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Network </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Windowsç³»ç»Ÿéšè—æ–‡ä»¶</title>
      <link href="/posts/adfa6bbb/"/>
      <url>/posts/adfa6bbb/</url>
      
        <content type="html"><![CDATA[<h2 id="attrib-å‘½ä»¤"><a href="#attrib-å‘½ä»¤" class="headerlink" title="attrib å‘½ä»¤"></a>attrib å‘½ä»¤</h2><blockquote><p>è¿™ä¸ªåªæ˜¯éšè—, å¹¶æ²¡æœ‰æŠŠæ–‡ä»¶åŠ å¯†</p></blockquote><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">attrib</span> +S +H &lt;æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹&gt;</span><br></pre></td></tr></table></figure><ul><li>ä¼˜ç‚¹: ä¸ç”¨åŠ å¯†è§£å¯†, è®¿é—®ç®€å•</li><li>ç¼ºç‚¹: ä¸å®‰å…¨</li></ul><h2 id="åˆ›å»º-vhd-å¹¶ä½¿ç”¨-bitlocker"><a href="#åˆ›å»º-vhd-å¹¶ä½¿ç”¨-bitlocker" class="headerlink" title="åˆ›å»º vhd å¹¶ä½¿ç”¨ bitlocker"></a>åˆ›å»º vhd å¹¶ä½¿ç”¨ bitlocker</h2><p>åœ¨ç£ç›˜ç®¡ç†é‡Œé¢åˆ›å»º vhd ç£ç›˜, æŒ‚åœ¨å¥½åä½¿ç”¨ BitLocker åŠ å¯† (å¯é€‰)</p><ul><li>ä¼˜ç‚¹: æ•°æ®å®‰å…¨,æ²¡æœ‰å¯†ç æ— æ³•è§£å¯†</li><li>ç¼ºç‚¹: å®¹æ˜“æŸå,é€ æˆæ•°æ®<strong>å…¨éƒ¨ä¸¢å¤±</strong></li></ul><h2 id="ä½¿ç”¨ç¬¬ä¸‰æ–¹åŠ å¯†è½¯ä»¶"><a href="#ä½¿ç”¨ç¬¬ä¸‰æ–¹åŠ å¯†è½¯ä»¶" class="headerlink" title="ä½¿ç”¨ç¬¬ä¸‰æ–¹åŠ å¯†è½¯ä»¶"></a>ä½¿ç”¨ç¬¬ä¸‰æ–¹åŠ å¯†è½¯ä»¶</h2><p>ç•¥</p><h2 id="ä½¿ç”¨å‹ç¼©è½¯ä»¶åŠ å¯†"><a href="#ä½¿ç”¨å‹ç¼©è½¯ä»¶åŠ å¯†" class="headerlink" title="ä½¿ç”¨å‹ç¼©è½¯ä»¶åŠ å¯†"></a>ä½¿ç”¨å‹ç¼©è½¯ä»¶åŠ å¯†</h2><p>ç•¥</p>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> bat </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Windowsä½¿ç”¨å‘½ä»¤æ“ä½œè¿›ç¨‹</title>
      <link href="/posts/222b586e/"/>
      <url>/posts/222b586e/</url>
      
        <content type="html"><![CDATA[<h2 id="æŸ¥æ‰¾è¿›ç¨‹"><a href="#æŸ¥æ‰¾è¿›ç¨‹" class="headerlink" title="æŸ¥æ‰¾è¿›ç¨‹"></a>æŸ¥æ‰¾è¿›ç¨‹</h2><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tasklist | <span class="built_in">findstr</span> xxx</span><br></pre></td></tr></table></figure><h2 id="æ ¹æ®è¿›ç¨‹åæ€è¿›ç¨‹"><a href="#æ ¹æ®è¿›ç¨‹åæ€è¿›ç¨‹" class="headerlink" title="æ ¹æ®è¿›ç¨‹åæ€è¿›ç¨‹"></a>æ ¹æ®è¿›ç¨‹åæ€è¿›ç¨‹</h2><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">taskkill</span> /F /IM npc.exe</span><br></pre></td></tr></table></figure><h2 id="æ ¹æ®è¿›ç¨‹-PID-æ€è¿›ç¨‹"><a href="#æ ¹æ®è¿›ç¨‹-PID-æ€è¿›ç¨‹" class="headerlink" title="æ ¹æ®è¿›ç¨‹ PID æ€è¿›ç¨‹"></a>æ ¹æ®è¿›ç¨‹ PID æ€è¿›ç¨‹</h2><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">TASKKILL</span> /PID <span class="number">1230</span> /PID <span class="number">1241</span> /PID <span class="number">1253</span> /T</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> bat </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Windowséšè—cmdè¿è¡Œçª—å£</title>
      <link href="/posts/3b6d9935/"/>
      <url>/posts/3b6d9935/</url>
      
        <content type="html"><![CDATA[<h2 id="ä½¿ç”¨å¼€æºè½¯ä»¶å®ç°-æ¨è"><a href="#ä½¿ç”¨å¼€æºè½¯ä»¶å®ç°-æ¨è" class="headerlink" title="ä½¿ç”¨å¼€æºè½¯ä»¶å®ç° (æ¨è)"></a>ä½¿ç”¨å¼€æºè½¯ä»¶å®ç° (æ¨è)</h2><blockquote><p>hidecon.exe <a href="http://code.kliu.org/misc/">å®˜ç½‘åœ°å€</a></p></blockquote><p>ä½¿ç”¨æ–¹æ³•ï¼Œå°† hidecon.exe å’Œå…¶ä»–å¯æ‰§è¡Œæ”¾åœ¨ä¸€å—ï¼Œåœ¨ bat è„šæœ¬å‰é¢åŠ ä¸Š</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hidecon.exe</span><br><span class="line">npc -server=xxx:<span class="number">8888</span> -vkey=xxxxxxxxxxxxxxxx -<span class="built_in">type</span>=tcp</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨-vbs-å®ç°ï¼ˆæ¨èï¼‰"><a href="#ä½¿ç”¨-vbs-å®ç°ï¼ˆæ¨èï¼‰" class="headerlink" title="ä½¿ç”¨ vbs å®ç°ï¼ˆæ¨èï¼‰"></a>ä½¿ç”¨ vbs å®ç°ï¼ˆæ¨èï¼‰</h2><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CreateObject(&quot;WScript.Shell&quot;).Run &quot;D:\syncthing\syncthing.exe&quot;,<span class="number">0</span></span><br></pre></td></tr></table></figure><p>æˆ–è€…æ‰¹é‡è¿è¡Œï¼š</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Set</span> ws = CreateObject(&quot;Wscript.Shell&quot;)</span><br><span class="line">ws.run &quot;<span class="built_in">cmd</span> /c <span class="built_in">start</span> <span class="number">1</span>.exe&quot;,vbhide</span><br><span class="line">ws.run &quot;<span class="built_in">cmd</span> /c <span class="built_in">start</span> <span class="number">2</span>.exe&quot;,vbhide</span><br><span class="line">ws.run &quot;<span class="built_in">cmd</span> /c <span class="built_in">start</span> <span class="number">3</span>.exe&quot;,vbhide</span><br></pre></td></tr></table></figure><p>å¤åˆ¶ä¿å­˜æˆ vbs æ–‡ä»¶å³å¯ã€‚</p><h2 id="ä½¿ç”¨-cmd-å®ç°ï¼ˆä¼šæœ‰ä¸€é—ªè€Œè¿‡çš„é»‘çª—ï¼‰"><a href="#ä½¿ç”¨-cmd-å®ç°ï¼ˆä¼šæœ‰ä¸€é—ªè€Œè¿‡çš„é»‘çª—ï¼‰" class="headerlink" title="ä½¿ç”¨ cmd å®ç°ï¼ˆä¼šæœ‰ä¸€é—ªè€Œè¿‡çš„é»‘çª—ï¼‰"></a>ä½¿ç”¨ cmd å®ç°ï¼ˆä¼šæœ‰ä¸€é—ªè€Œè¿‡çš„é»‘çª—ï¼‰</h2><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line"><span class="keyword">if</span> &quot;%<span class="number">1</span>&quot;==&quot;h&quot; <span class="keyword">goto</span> begin</span><br><span class="line"><span class="built_in">start</span> mshta vbscript:createobject(&quot;wscript.shell&quot;).run(&quot;&quot;&quot;%~nx0&quot;&quot; h&quot;,<span class="number">0</span>)(window.close)&amp;&amp;<span class="keyword">exit</span></span><br><span class="line">:begin</span><br><span class="line">::ä»¥ä¸‹ä¸ºæ­£å¸¸æ‰¹å¤„ç†å‘½ä»¤ï¼Œä¸å¯å«æœ‰<span class="built_in">pause</span> <span class="built_in">set</span>/pç­‰äº¤äº’å‘½ä»¤</span><br></pre></td></tr></table></figure><p>å¤åˆ¶ä¿å­˜ä¸º bat æ–‡ä»¶å³å¯ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> bat </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxå¸¸ç”¨å‘½ä»¤ä¹‹awk</title>
      <link href="/posts/c4a2fe4/"/>
      <url>/posts/c4a2fe4/</url>
      
        <content type="html"><![CDATA[<h2 id="awk-å¤šä¸ªåˆ†éš”ç¬¦"><a href="#awk-å¤šä¸ªåˆ†éš”ç¬¦" class="headerlink" title="awk å¤šä¸ªåˆ†éš”ç¬¦"></a>awk å¤šä¸ªåˆ†éš”ç¬¦</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;abcdefg&quot;</span> | awk -F <span class="string">&#x27;[ce]&#x27;</span> <span class="string">&#x27;&#123;print $1,$2,$3&#125;&#x27;</span></span><br><span class="line">ab d <span class="built_in">fg</span></span><br></pre></td></tr></table></figure><blockquote><p>ä½†æ˜¯æˆ‘æƒ³è¦æå– dmesg é‡Œé¢çš„æ—¶é—´ï¼Œæƒ³ä»¥ <code>[]</code> æ¥åšåˆ†å‰²ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥åå†™ <code>[]</code> å–ä¸ªå·§</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dmesg | awk -F <span class="string">&#x27;[][]&#x27;</span> <span class="string">&#x27;&#123;print $2&#125;&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="æ‰“å°æŸä¸€åˆ—ä¸ºç‰¹å®šå€¼çš„è¡Œ"><a href="#æ‰“å°æŸä¸€åˆ—ä¸ºç‰¹å®šå€¼çš„è¡Œ" class="headerlink" title="æ‰“å°æŸä¸€åˆ—ä¸ºç‰¹å®šå€¼çš„è¡Œ"></a>æ‰“å°æŸä¸€åˆ—ä¸ºç‰¹å®šå€¼çš„è¡Œ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk <span class="string">&#x27;$8==&quot;500&quot;&#x27;</span> nginx_access.log</span><br></pre></td></tr></table></figure><h2 id="awk-äº¤æ¢ä¸€ä¸ªæ–‡ä»¶çš„ä¸¤åˆ—"><a href="#awk-äº¤æ¢ä¸€ä¸ªæ–‡ä»¶çš„ä¸¤åˆ—" class="headerlink" title="awk äº¤æ¢ä¸€ä¸ªæ–‡ä»¶çš„ä¸¤åˆ—"></a>awk äº¤æ¢ä¸€ä¸ªæ–‡ä»¶çš„ä¸¤åˆ—</h2><p>æ¯”å¦‚æ–‡ä»¶ <code>test.txt</code></p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a;b;c</span><br><span class="line">d;e;f</span><br><span class="line">1;2;3</span><br><span class="line">4;5;6</span><br></pre></td></tr></table></figure><h3 id="æ–¹æ³•-1"><a href="#æ–¹æ³•-1" class="headerlink" title="æ–¹æ³• 1"></a>æ–¹æ³• 1</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk -F <span class="string">&#x27;;&#x27;</span> <span class="string">&#x27;&#123;printf(&quot;%s;%s;%s\n&quot;,$3,$2,$1)&#125;&#x27;</span> test.txt</span><br></pre></td></tr></table></figure><h3 id="æ–¹æ³•-2"><a href="#æ–¹æ³•-2" class="headerlink" title="æ–¹æ³• 2"></a>æ–¹æ³• 2</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">awk -F <span class="string">&#x27;;&#x27;</span> <span class="string">&#x27;&#123;temp = $3 ; $3 = $1; $1 = temp&#125;1&#x27;</span> OFS=<span class="string">&#x27;;&#x27;</span> test.txt</span><br><span class="line"></span><br><span class="line">è¿™é‡Œçš„1 å’Œ &#123;<span class="built_in">print</span>&#125;æ˜¯ä¸€æ ·çš„, OFSä»£è¡¨åˆ†éš”ç¬¦ã€‚</span><br></pre></td></tr></table></figure><h2 id="æ‰¾å‡ºæŸä¸€åˆ—æ˜¯æŒ‡å®šå€¼çš„è¡Œ"><a href="#æ‰¾å‡ºæŸä¸€åˆ—æ˜¯æŒ‡å®šå€¼çš„è¡Œ" class="headerlink" title="æ‰¾å‡ºæŸä¸€åˆ—æ˜¯æŒ‡å®šå€¼çš„è¡Œ"></a>æ‰¾å‡ºæŸä¸€åˆ—æ˜¯æŒ‡å®šå€¼çš„è¡Œ</h2><p>æ¯”å¦‚æˆ‘æƒ³çŸ¥é“æ ¹ç›®å½•çš„ç£ç›˜å ç”¨æƒ…å†µ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Filesystem     Type      Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/sdc       ext4      251G   13G  226G   6% /</span><br><span class="line">none           tmpfs     3.9G   68K  3.9G   1% /mnt/wslg</span><br><span class="line">none           tmpfs     3.9G  4.0K  3.9G   1% /mnt/wsl</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">df</span> -hT | awk <span class="string">&#x27;($NF==&quot;/&quot;)&#123;print $(NF - 1)&#125;&#x27;</span></span><br><span class="line"><span class="comment"># $(NF - 1) å€’æ•°ç¬¬äºŒåˆ—</span></span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœä¸ºï¼š</p><p>6%</p><h2 id="awk-å¤šä¸ªæ¡ä»¶åˆ¤æ–­"><a href="#awk-å¤šä¸ªæ¡ä»¶åˆ¤æ–­" class="headerlink" title="awk å¤šä¸ªæ¡ä»¶åˆ¤æ–­"></a>awk å¤šä¸ªæ¡ä»¶åˆ¤æ–­</h2><p>åŸå§‹è¾“å‡º:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@qz_k8s_m1 data]<span class="comment"># kubectl get pod -n dev</span></span><br><span class="line">NAME                                              READY   STATUS    RESTARTS   AGE</span><br><span class="line">test-7b47f8cccb-cwdfw                          1/1     Running   0          3h28m</span><br><span class="line">test-6c5bbd4f49-ns74j                          0/1     Running   92         6h55m</span><br><span class="line">test-7c78fbdf68-cg28l                          1/1     Running   0          8d</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ‰¾å‡ºå…¶ä¸­æœªå°±ç»ªä¸”é‡å¯æ¬¡æ•°å¤§äº10æ¬¡çš„pod</span></span><br><span class="line">[root@qz_k8s_m1 data]<span class="comment"># kubectl get pod -n dev | awk &#x27;($2==&quot;0/1&quot; &amp;&amp; $4&gt;10)&#x27;</span></span><br><span class="line">test-6c5bbd4f49-ns74j                          0/1     Running   93         6h57m</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯ä»¥åªæ‰“å°podåå­—</span></span><br><span class="line">[root@qz_k8s_m1 data]<span class="comment"># kubectl get pod -n dev | awk &#x27;($2==&quot;0/1&quot; &amp;&amp; $4&gt;20) &#123;print $1&#125;&#x27;</span></span><br><span class="line">test-6c5bbd4f49-ns74j</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸æ‰“å°ç¬¬ä¸€è¡Œ</span></span><br><span class="line">kubectl get deployment | awk <span class="string">&#x27;NR&gt;1 &#123;print $1&#125;&#x27;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Command </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>WSLå¸¸ç”¨æ“ä½œè®°å½•</title>
      <link href="/posts/eee9a081/"/>
      <url>/posts/eee9a081/</url>
      
        <content type="html"><![CDATA[<h2 id="é˜²ç«å¢™è§„åˆ™"><a href="#é˜²ç«å¢™è§„åˆ™" class="headerlink" title="é˜²ç«å¢™è§„åˆ™"></a>é˜²ç«å¢™è§„åˆ™</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">New-NetFirewallRule</span> <span class="literal">-DisplayName</span> <span class="string">&quot;WSL&quot;</span> <span class="literal">-Direction</span> Inbound  <span class="literal">-InterfaceAlias</span> <span class="string">&quot;vEthernet (WSL)&quot;</span>  <span class="literal">-Action</span> Allow</span><br></pre></td></tr></table></figure><h2 id="å¸¸ç”¨æ“ä½œ"><a href="#å¸¸ç”¨æ“ä½œ" class="headerlink" title="å¸¸ç”¨æ“ä½œ"></a>å¸¸ç”¨æ“ä½œ</h2><h3 id="å¯¼å‡º"><a href="#å¯¼å‡º" class="headerlink" title="å¯¼å‡º"></a>å¯¼å‡º</h3><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wsl --export centos7 centos7.tar</span><br></pre></td></tr></table></figure><h3 id="å¯¼å…¥"><a href="#å¯¼å…¥" class="headerlink" title="å¯¼å…¥"></a>å¯¼å…¥</h3><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wsl --import centos7 C:\centos7 centos7.tar</span><br></pre></td></tr></table></figure><h3 id="å¯åŠ¨æŒ‡å®šå‘è¡Œç‰ˆ"><a href="#å¯åŠ¨æŒ‡å®šå‘è¡Œç‰ˆ" class="headerlink" title="å¯åŠ¨æŒ‡å®šå‘è¡Œç‰ˆ"></a>å¯åŠ¨æŒ‡å®šå‘è¡Œç‰ˆ</h3><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wsl -d centos7</span><br></pre></td></tr></table></figure><h3 id="æŒ‡å®šç”¨æˆ·å¯åŠ¨"><a href="#æŒ‡å®šç”¨æˆ·å¯åŠ¨" class="headerlink" title="æŒ‡å®šç”¨æˆ·å¯åŠ¨"></a>æŒ‡å®šç”¨æˆ·å¯åŠ¨</h3><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wsl -d ubuntu -u root</span><br></pre></td></tr></table></figure><h2 id="å¼€æœºè‡ªå¯"><a href="#å¼€æœºè‡ªå¯" class="headerlink" title="å¼€æœºè‡ªå¯"></a>å¼€æœºè‡ªå¯</h2><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">WSL1</button><button type="button" class="tab">WSL2å’ŒWindows11</button></div><div class="tab-contents"><div class="tab-item-content active"><p>win+r è¾“å…¥ <code>shell:startup</code> å†™ä¸€ä¸ª <code>wsl_start.bat</code> å†…å®¹å¦‚ä¸‹</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wsl -d Ubuntu -u root /etc/init.d/ssh <span class="built_in">start</span></span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><p>sudo vim &#x2F;etc&#x2F;wsl.conf</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[boot]</span><br><span class="line"><span class="built_in">command</span> = service docker start</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div><h2 id="ä¿®æ”¹é»˜è®¤ç”¨æˆ·ä¸º-root"><a href="#ä¿®æ”¹é»˜è®¤ç”¨æˆ·ä¸º-root" class="headerlink" title="ä¿®æ”¹é»˜è®¤ç”¨æˆ·ä¸º root"></a>ä¿®æ”¹é»˜è®¤ç”¨æˆ·ä¸º root</h2><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">WSL1</button><button type="button" class="tab">WSL2å’ŒWindows11</button></div><div class="tab-contents"><div class="tab-item-content active"><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">%localappdata%</span>\Microsoft\WindowsApps\ubuntu.exe config --default-user root</span><br></pre></td></tr></table></figure><blockquote><p>æ ¹æ®ä½ çš„å‘è¡Œç‰ˆå†³å®š</p></blockquote></div><div class="tab-item-content"><p>sudo vim &#x2F;etc&#x2F;wsl.conf</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[user]</span><br><span class="line">default = root</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div><h2 id="å®‰è£…æƒ³è¦çš„å‘è¡Œç‰ˆ"><a href="#å®‰è£…æƒ³è¦çš„å‘è¡Œç‰ˆ" class="headerlink" title="å®‰è£…æƒ³è¦çš„å‘è¡Œç‰ˆ"></a>å®‰è£…æƒ³è¦çš„å‘è¡Œç‰ˆ</h2><blockquote><p>è¿™é‡Œä»¥ centos ä¸ºä¾‹</p></blockquote><p>é¦–å…ˆéœ€è¦ docker ç¯å¢ƒï¼Œæ‰§è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name centos7 centos:centos7</span><br></pre></td></tr></table></figure><p>ç„¶åå°†å®¹å™¨å¯¼å‡º</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">export</span> centos7 &gt; centos7.tar</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨ windows ä¸Šå¯¼å…¥</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wsl --import centos7 C:\centos7 centos7.tar</span><br></pre></td></tr></table></figure><p>å¯åŠ¨å‘è¡Œç‰ˆ</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wsl -d centos7</span><br></pre></td></tr></table></figure><p>å¸è½½å‘è¡Œç‰ˆ</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wsl --unregister centos7</span><br></pre></td></tr></table></figure><h2 id="äº’ç›¸è®¿é—®"><a href="#äº’ç›¸è®¿é—®" class="headerlink" title="äº’ç›¸è®¿é—®"></a>äº’ç›¸è®¿é—®</h2><h3 id="wsl-é‡Œè¿è¡Œ-windows-ç¨‹åº"><a href="#wsl-é‡Œè¿è¡Œ-windows-ç¨‹åº" class="headerlink" title="wsl é‡Œè¿è¡Œ windows ç¨‹åº"></a>wsl é‡Œè¿è¡Œ windows ç¨‹åº</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿è¡Œwindowsé‡Œçš„python</span></span><br><span class="line">py.exe update_gitee_pages.py</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰“å¼€èµ„æºç®¡ç†å™¨</span></span><br><span class="line">explorer.exe .</span><br></pre></td></tr></table></figure><h3 id="windows-é‡Œè¿è¡Œ-wsl-ç¨‹åº"><a href="#windows-é‡Œè¿è¡Œ-wsl-ç¨‹åº" class="headerlink" title="windows é‡Œè¿è¡Œ wsl ç¨‹åº"></a>windows é‡Œè¿è¡Œ wsl ç¨‹åº</h3><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wsl -d ubuntu sudo bash -c &quot;apt update&quot;</span><br></pre></td></tr></table></figure><h3 id="wsl-é‡Œè®¿é—®-windows-è·¯å¾„"><a href="#wsl-é‡Œè®¿é—®-windows-è·¯å¾„" class="headerlink" title="wsl é‡Œè®¿é—® windows è·¯å¾„"></a>wsl é‡Œè®¿é—® windows è·¯å¾„</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /mnt/c/Users/iuxt/Desktop</span><br></pre></td></tr></table></figure><h3 id="windows-é‡Œè®¿é—®-wsl-æ–‡ä»¶"><a href="#windows-é‡Œè®¿é—®-wsl-æ–‡ä»¶" class="headerlink" title="windows é‡Œè®¿é—® wsl æ–‡ä»¶"></a>windows é‡Œè®¿é—® wsl æ–‡ä»¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\\wsl$\Ubuntu\home\iuxt</span><br></pre></td></tr></table></figure><h3 id="å¿«é€Ÿåœ¨å½“å‰è·¯å¾„ä¸‹æ‰“å¼€-wsl-å‘½ä»¤è¡Œ"><a href="#å¿«é€Ÿåœ¨å½“å‰è·¯å¾„ä¸‹æ‰“å¼€-wsl-å‘½ä»¤è¡Œ" class="headerlink" title="å¿«é€Ÿåœ¨å½“å‰è·¯å¾„ä¸‹æ‰“å¼€ wsl å‘½ä»¤è¡Œ"></a>å¿«é€Ÿåœ¨å½“å‰è·¯å¾„ä¸‹æ‰“å¼€ wsl å‘½ä»¤è¡Œ</h3><p>åœ¨èµ„æºç®¡ç†å™¨çš„åœ°å€æ ç›´æ¥è¾“å…¥ wsl å³å¯ï¼ˆè¾“å…¥ cmd ç±»ä¼¼ï¼Œæ˜¯è¿›å…¥ cmd å‘½ä»¤è¡Œï¼‰</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202305041640284.png" alt="å¿«é€Ÿæ‰“å¼€wslå‘½ä»¤è¡Œ|572"></p><h3 id="bat-è„šæœ¬é‡Œè°ƒç”¨-wsl-å‘½ä»¤"><a href="#bat-è„šæœ¬é‡Œè°ƒç”¨-wsl-å‘½ä»¤" class="headerlink" title="bat è„šæœ¬é‡Œè°ƒç”¨ wsl å‘½ä»¤"></a>bat è„šæœ¬é‡Œè°ƒç”¨ wsl å‘½ä»¤</h3><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wsl --shell-<span class="built_in">type</span> login --<span class="built_in">cd</span> ~/code/zahuifan -- code .</span><br></pre></td></tr></table></figure><h3 id="æ–‡ä»¶è·¯å¾„è½¬æ¢"><a href="#æ–‡ä»¶è·¯å¾„è½¬æ¢" class="headerlink" title="æ–‡ä»¶è·¯å¾„è½¬æ¢"></a>æ–‡ä»¶è·¯å¾„è½¬æ¢</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># wslè·¯å¾„è½¬æ¢ä¸ºwindowsè·¯å¾„</span></span><br><span class="line">â¯ wslpath -w <span class="string">&quot;/mnt/c/Program Files (x86)/Steam/steamapps&quot;</span></span><br><span class="line">C:\Program Files (x86)\Steam\steamapps</span><br><span class="line"></span><br><span class="line"><span class="comment"># windowsè·¯å¾„è½¬æ¢ä¸ºwslè·¯å¾„</span></span><br><span class="line">â¯ wslpath <span class="string">&quot;C:\Program Files (x86)\Steam\steamapps&quot;</span></span><br><span class="line">/mnt/c/Program Files (x86)/Steam/steamapps</span><br></pre></td></tr></table></figure><h2 id="wsl-conf"><a href="#wsl-conf" class="headerlink" title="wsl.conf"></a>wsl.conf</h2><p><a href="https://learn.microsoft.com/zh-cn/windows/wsl/wsl-config">https://learn.microsoft.com/zh-cn/windows/wsl/wsl-config</a></p>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows </tag>
            
            <tag> WSL </tag>
            
            <tag> é…ç½®è®°å½• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Windowså³é”®èœå•æ·»åŠ md5ã€sha1æ ¡éªŒ</title>
      <link href="/posts/19e40a49/"/>
      <url>/posts/19e40a49/</url>
      
        <content type="html"><![CDATA[<blockquote><p>æ­¤æ–¹æ³•ä¾èµ– powershell, win10 æ²¡é—®é¢˜ï¼Œwin7 æ²¡æµ‹è¯•</p></blockquote><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">Windows Registry Editor Version <span class="number">5</span>.<span class="number">00</span></span><br><span class="line"></span><br><span class="line">[HKEY_CLASSES_ROOT\*\shell\hash]</span><br><span class="line">&quot;MUIVerb&quot;=&quot;æ ¡éªŒæ–‡ä»¶ Hash&quot;</span><br><span class="line">&quot;SubCommands&quot;=&quot;&quot;</span><br><span class="line">&quot;Icon&quot;=&quot;PowerShell.exe&quot;</span><br><span class="line"></span><br><span class="line">; SHA1</span><br><span class="line">[HKEY_CLASSES_ROOT\*\shell\hash\shell\<span class="number">01</span>menu]</span><br><span class="line">&quot;MUIVerb&quot;=&quot;SHA1&quot;</span><br><span class="line"></span><br><span class="line">[HKEY_CLASSES_ROOT\*\shell\hash\shell\<span class="number">01</span>menu\command]</span><br><span class="line">@=&quot;powershell -noexit get-filehash -literalpath &#x27;%<span class="number">1</span>&#x27; -algorithm SHA1 | <span class="built_in">format</span>-list&quot;</span><br><span class="line"></span><br><span class="line">; SHA256</span><br><span class="line">[HKEY_CLASSES_ROOT\*\shell\hash\shell\<span class="number">02</span>menu]</span><br><span class="line">&quot;MUIVerb&quot;=&quot;SHA256&quot;</span><br><span class="line"></span><br><span class="line">[HKEY_CLASSES_ROOT\*\shell\hash\shell\<span class="number">02</span>menu\command]</span><br><span class="line">@=&quot;powershell -noexit get-filehash -literalpath &#x27;%<span class="number">1</span>&#x27; -algorithm SHA256 | <span class="built_in">format</span>-list&quot;</span><br><span class="line"></span><br><span class="line">; SHA384</span><br><span class="line">[HKEY_CLASSES_ROOT\*\shell\hash\shell\<span class="number">03</span>menu]</span><br><span class="line">&quot;MUIVerb&quot;=&quot;SHA384&quot;</span><br><span class="line"></span><br><span class="line">[HKEY_CLASSES_ROOT\*\shell\hash\shell\<span class="number">03</span>menu\command]</span><br><span class="line">@=&quot;powershell -noexit get-filehash -literalpath &#x27;%<span class="number">1</span>&#x27; -algorithm SHA384 | <span class="built_in">format</span>-list&quot;</span><br><span class="line"></span><br><span class="line">; SHA512</span><br><span class="line">[HKEY_CLASSES_ROOT\*\shell\hash\shell\<span class="number">04</span>menu]</span><br><span class="line">&quot;MUIVerb&quot;=&quot;SHA512&quot;</span><br><span class="line"></span><br><span class="line">[HKEY_CLASSES_ROOT\*\shell\hash\shell\<span class="number">04</span>menu\command]</span><br><span class="line">@=&quot;powershell -noexit get-filehash -literalpath &#x27;%<span class="number">1</span>&#x27; -algorithm SHA512 | <span class="built_in">format</span>-list&quot;</span><br><span class="line"></span><br><span class="line">; MACTripleDES</span><br><span class="line">[HKEY_CLASSES_ROOT\*\shell\hash\shell\<span class="number">05</span>menu]</span><br><span class="line">&quot;MUIVerb&quot;=&quot;MACTripleDES&quot;</span><br><span class="line"></span><br><span class="line">[HKEY_CLASSES_ROOT\*\shell\hash\shell\<span class="number">05</span>menu\command]</span><br><span class="line">@=&quot;powershell -noexit get-filehash -literalpath &#x27;%<span class="number">1</span>&#x27; -algorithm MACTripleDES | <span class="built_in">format</span>-list&quot;</span><br><span class="line"></span><br><span class="line">; MD5</span><br><span class="line">[HKEY_CLASSES_ROOT\*\shell\hash\shell\<span class="number">06</span>menu]</span><br><span class="line">&quot;MUIVerb&quot;=&quot;MD5&quot;</span><br><span class="line"></span><br><span class="line">[HKEY_CLASSES_ROOT\*\shell\hash\shell\<span class="number">06</span>menu\command]</span><br><span class="line">@=&quot;powershell -noexit get-filehash -literalpath &#x27;%<span class="number">1</span>&#x27; -algorithm MD5 | <span class="built_in">format</span>-list&quot;</span><br><span class="line"></span><br><span class="line">; RIPEMD160</span><br><span class="line">[HKEY_CLASSES_ROOT\*\shell\hash\shell\<span class="number">07</span>menu]</span><br><span class="line">&quot;MUIVerb&quot;=&quot;RIPEMD160&quot;</span><br><span class="line"></span><br><span class="line">[HKEY_CLASSES_ROOT\*\shell\hash\shell\<span class="number">07</span>menu\command]</span><br><span class="line">@=&quot;powershell -noexit get-filehash -literalpath &#x27;%<span class="number">1</span>&#x27; -algorithm RIPEMD160 | <span class="built_in">format</span>-list&quot;</span><br><span class="line"></span><br><span class="line">; Allget-filehash -literalpath &#x27;%<span class="number">1</span>&#x27; -algorithm RIPEMD160 | <span class="built_in">format</span>-list</span><br><span class="line">[HKEY_CLASSES_ROOT\*\shell\hash\shell\<span class="number">08</span>menu]</span><br><span class="line">&quot;CommandFlags&quot;=dword:<span class="number">00000020</span></span><br><span class="line">&quot;MUIVerb&quot;=&quot;æ ¡éªŒå…¨éƒ¨&quot;</span><br><span class="line"></span><br><span class="line">[HKEY_CLASSES_ROOT\*\shell\hash\shell\<span class="number">08</span>menu\command]</span><br><span class="line">@=&quot;powershell -noexit get-filehash -literalpath &#x27;%<span class="number">1</span>&#x27; -algorithm SHA1 | <span class="built_in">format</span>-list;get-filehash -literalpath &#x27;%<span class="number">1</span>&#x27; -algorithm SHA256 | <span class="built_in">format</span>-list;get-filehash -literalpath &#x27;%<span class="number">1</span>&#x27; -algorithm SHA384 | <span class="built_in">format</span>-list;get-filehash -literalpath &#x27;%<span class="number">1</span>&#x27; -algorithm SHA512 | <span class="built_in">format</span>-list;get-filehash -literalpath &#x27;%<span class="number">1</span>&#x27; -algorithm MACTripleDES | <span class="built_in">format</span>-list;get-filehash -literalpath &#x27;%<span class="number">1</span>&#x27; -algorithm MD5 | <span class="built_in">format</span>-list;get-filehash -literalpath &#x27;%<span class="number">1</span>&#x27; -algorithm RIPEMD160 | <span class="built_in">format</span>-list&quot;</span><br></pre></td></tr></table></figure><blockquote><p>ä¸è¿‡è¦æ³¨æ„çš„æ˜¯ï¼Œè‡ªå·±å¤åˆ¶ä»£ç ä¿å­˜æ—¶ï¼Œç¼–ç å¿…é¡»é€‰æ‹©â€œ<strong>UTF-16 LE</strong>â€æ ¼å¼ï¼Œå¦åˆ™å³é”®èœå•çš„ä¸­æ–‡ä¼šä¹±ç ã€‚</p></blockquote><h2 id="å¸è½½"><a href="#å¸è½½" class="headerlink" title="å¸è½½"></a>å¸è½½</h2><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Windows Registry Editor Version <span class="number">5</span>.<span class="number">00</span></span><br><span class="line"></span><br><span class="line">[-HKEY_CLASSES_ROOT\*\shell\hash]</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Windowsç³»ç»Ÿè‡ªåŠ¨è¿æ¥openvpn</title>
      <link href="/posts/a6a8f287/"/>
      <url>/posts/a6a8f287/</url>
      
        <content type="html"><![CDATA[<blockquote><p>åœ¨å…¬å¸æƒ³è¿æ¥çº¿ä¸ŠæœåŠ¡å™¨æ­¥éª¤ï¼šæ‰“å¼€ openvpn è½¯ä»¶ï¼Œè¾“å…¥é™æ€å¯†ç ï¼Œæå‡ºæ‰‹æœºï¼Œè§£é”ï¼Œæ‰“å¼€ totp è½¯ä»¶ï¼Œè¾“å…¥ totp è½¯ä»¶çš„å¼€å¯å¯†ç ï¼Œè®°ä¸‹ 6 ä½æ•°åŠ¨æ€å¯†ç ï¼Œè¾“å…¥åˆ°ç”µè„‘é‡Œï¼Œå®Œæˆè¿æ¥ï¼Œé”å®šæ‰‹æœºã€‚éå¸¸éº»çƒ¦<br>è€Œä¸”å› ä¸ºæ—¶é—´åŒæ­¥é—®é¢˜ï¼Œå¯èƒ½è¿˜æœ‰ 10 ç§’å°±åˆ·æ–°åŠ¨æ€å¯†ç äº†ï¼Œè¿˜éœ€è¦ç­‰å¾…åˆ·æ–°åå†è¾“å…¥æ–°çš„å¯†ç ï¼Œæ›´éº»çƒ¦çš„æ˜¯ openvpn ä¼šä¿®æ”¹ç³»ç»Ÿçš„è·¯ç”±ï¼Œå¯¼è‡´æœ‰äº›å…¬å¸å†…éƒ¨ç½‘ç«™ä¸Šä¸äº†ï¼Œå°±ä¼šå‡ºç°è¿æ¥ vpnâ€” åš A äº‹æƒ…ï¼Œæ–­å¼€ vpn åš B äº‹æƒ…ã€‚</p></blockquote><p>è¿™é‡Œæä¾›ä¸€ä¸ªè„šæœ¬ï¼Œä¸€é”®è¿æ¥ openvpnï¼Œé€‚ç”¨äº windows</p><h2 id="1-å®‰è£…-openvpn-è½¯ä»¶"><a href="#1-å®‰è£…-openvpn-è½¯ä»¶" class="headerlink" title="1. å®‰è£… openvpn è½¯ä»¶"></a>1. å®‰è£… openvpn è½¯ä»¶</h2><p>è½¯ä»¶å®‰è£…åˆ°é»˜è®¤ä½ç½®ï¼Œéœ€è¦å®‰è£… tap driver<br>æ‰“å¼€ä¸€æ¬¡è½¯ä»¶ï¼ˆä¸ºäº†ç”Ÿæˆé…ç½®æ–‡ä»¶ç›®å½•ï¼‰ï¼Œä»¥åå°±å¯ä»¥ä¸ç”¨å¯åŠ¨</p><h2 id="è„šæœ¬å†…å®¹"><a href="#è„šæœ¬å†…å®¹" class="headerlink" title="è„šæœ¬å†…å®¹"></a>è„šæœ¬å†…å®¹</h2><p>start.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pyotp</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line">totp = pyotp.TOTP(<span class="string">&#x27;&lt;TOTP seed&gt;&#x27;</span>)  <span class="comment"># è¿™é‡Œè¦å¡«å†™çš„totpçš„seedï¼Œä¸€èˆ¬è§£æä¸€ä¸‹äºŒç»´ç å°±èƒ½è·å¾—</span></span><br><span class="line">password = <span class="string">&quot;&lt;ä½ çš„å›ºå®šå¯†ç &gt;&quot;</span> + totp.now()         <span class="comment"># å›ºå®šå¯†ç </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">r&quot;C:\Users\iuxt\OpenVPN\config\password.txt&quot;</span>, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:   <span class="comment"># è¿™é‡Œæ˜¯password.txtæ–‡ä»¶ä½ç½®</span></span><br><span class="line">    f.write(<span class="string">&quot;&lt;è¿™é‡Œå†™ä½ çš„ç”¨æˆ·å&gt;\n%s&quot;</span> % password)</span><br><span class="line">    </span><br><span class="line">subprocess.run([<span class="string">r&quot;C:\Program Files\OpenVPN\bin\openvpn.exe&quot;</span>, <span class="string">r&quot;C:\Users\iuxt\OpenVPN\config\win.ovpn&quot;</span>])  <span class="comment"># vpnå¯æ‰§è¡Œä½ç½®å’Œvpné…ç½®æ–‡ä»¶ä½ç½®</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>start.bat</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line">%<span class="number">1</span> mshta vbscript:CreateObject(&quot;Shell.Application&quot;).ShellExecute(&quot;<span class="built_in">cmd</span>.exe&quot;,&quot;/c %~s0 ::&quot;,&quot;&quot;,&quot;runas&quot;,<span class="number">1</span>)(window.close)&amp;&amp;<span class="keyword">exit</span></span><br><span class="line"><span class="built_in">cd</span> /d &quot;%~dp0&quot;</span><br><span class="line"><span class="comment">rem ä¸Šé¢è¿™æ®µæ˜¯è·å–ç®¡ç†å‘˜æƒé™ğŸ‘†</span></span><br><span class="line"></span><br><span class="line">python <span class="built_in">start</span>.py</span><br></pre></td></tr></table></figure><h2 id="2-è„šæœ¬æ‹·è´åˆ°é…ç½®æ–‡ä»¶ç›®å½•"><a href="#2-è„šæœ¬æ‹·è´åˆ°é…ç½®æ–‡ä»¶ç›®å½•" class="headerlink" title="2. è„šæœ¬æ‹·è´åˆ°é…ç½®æ–‡ä»¶ç›®å½•"></a>2. è„šæœ¬æ‹·è´åˆ°é…ç½®æ–‡ä»¶ç›®å½•</h2><p>å°† <code>start.py</code> <code>start.bat</code> <code>win.ovpn</code> æ‹·è´åˆ°é…ç½®æ–‡ä»¶ç›®å½• <code>C:\Users\iuxt\OpenVPN\config</code></p><p><code>start.py</code> éœ€è¦ä¿®æ”¹ä¸€ä¸‹æ³¨é‡Šä½ç½®</p><p><code>win.ovpn</code> éœ€è¦ä¿®æ”¹ <code>auth-user-pass C:\\Users\\iuxt\\OpenVPN\\config\\password.txt</code> éœ€è¦å’Œ <code>start.py</code> é‡Œé¢è·¯å¾„ä¿æŒä¸€è‡´</p><h2 id="3-å¯åŠ¨å’Œå…³é—­"><a href="#3-å¯åŠ¨å’Œå…³é—­" class="headerlink" title="3. å¯åŠ¨å’Œå…³é—­"></a>3. å¯åŠ¨å’Œå…³é—­</h2><p>åŒå‡» <code>start.bat</code> å³å¯è‡ªåŠ¨è¿æ¥</p><p>ctrl + c å³å¯å…³é—­</p><p>å¦‚æœæœ‰éšè— cmd çª—å£çš„éœ€æ±‚ï¼Œå¯ä»¥çœ‹çœ‹è¿™ç¯‡ <a href="/3b6d9935/">éšè—cmdçª—å£</a></p>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Windowså¸¸ç”¨å‘½ä»¤è®°å½•</title>
      <link href="/posts/801c62c9/"/>
      <url>/posts/801c62c9/</url>
      
        <content type="html"><![CDATA[<h2 id="smb-æ“ä½œ"><a href="#smb-æ“ä½œ" class="headerlink" title="smb æ“ä½œ"></a>smb æ“ä½œ</h2><h3 id="æŒ‚è½½-smb"><a href="#æŒ‚è½½-smb" class="headerlink" title="æŒ‚è½½ smb"></a>æŒ‚è½½ smb</h3><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">net</span> use z: \\<span class="number">192</span>.<span class="number">168</span>.<span class="number">10</span>.<span class="number">163</span>\share /user:&quot;&lt;è®¡ç®—æœºå\ç”¨æˆ·å&gt;&quot; &quot;&lt;å¯†ç &gt;&quot;</span><br></pre></td></tr></table></figure><h3 id="å¸è½½-smb"><a href="#å¸è½½-smb" class="headerlink" title="å¸è½½ smb"></a>å¸è½½ smb</h3><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">net</span> use z: /<span class="built_in">del</span> /y</span><br></pre></td></tr></table></figure><h2 id="å†™å…¥å‰ªåˆ‡æ¿"><a href="#å†™å…¥å‰ªåˆ‡æ¿" class="headerlink" title="å†™å…¥å‰ªåˆ‡æ¿"></a>å†™å…¥å‰ªåˆ‡æ¿</h2><p>ä»æ–‡ä»¶å†™å…¥</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">clip &lt; C:\Users\iuxt\.ssh\id_rsa.pub</span><br></pre></td></tr></table></figure><p>ç›´æ¥å†™å…¥</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="number">222</span> | clip</span><br></pre></td></tr></table></figure><h2 id="ç”¨æˆ·æ“ä½œ"><a href="#ç”¨æˆ·æ“ä½œ" class="headerlink" title="ç”¨æˆ·æ“ä½œ"></a>ç”¨æˆ·æ“ä½œ</h2><h3 id="å¯ç”¨-Administrator"><a href="#å¯ç”¨-Administrator" class="headerlink" title="å¯ç”¨ Administrator"></a>å¯ç”¨ Administrator</h3><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">net</span> user administrator Office@<span class="number">2015</span> /active:yes</span><br></pre></td></tr></table></figure><h3 id="æ–°å»ºç”¨æˆ·"><a href="#æ–°å»ºç”¨æˆ·" class="headerlink" title="æ–°å»ºç”¨æˆ·"></a>æ–°å»ºç”¨æˆ·</h3><p>æ–°å»ºç”¨æˆ· IT,å¯†ç ä¸º 123456,å¯†ç  * ä¸ºæ‰‹åŠ¨è¾“å…¥,ä¸èƒ½æ”¹å¯†ç ,å¯†ç æ°¸ä¸è¿‡æœŸ</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">net</span> user IT <span class="number">123456</span> /add /passwordchg:no /expires:never</span><br></pre></td></tr></table></figure><h3 id="å°†ç”¨æˆ·åŠ å…¥ç»„"><a href="#å°†ç”¨æˆ·åŠ å…¥ç»„" class="headerlink" title="å°†ç”¨æˆ·åŠ å…¥ç»„"></a>å°†ç”¨æˆ·åŠ å…¥ç»„</h3><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">net</span> localgroup Administrators IT /add</span><br></pre></td></tr></table></figure><h3 id="æ–°å»ºç”¨æˆ·ç»„"><a href="#æ–°å»ºç”¨æˆ·ç»„" class="headerlink" title="æ–°å»ºç”¨æˆ·ç»„"></a>æ–°å»ºç”¨æˆ·ç»„</h3><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">net</span> localgroup ç»„å /add</span><br></pre></td></tr></table></figure><h3 id="å…¶ä»–å‘½ä»¤"><a href="#å…¶ä»–å‘½ä»¤" class="headerlink" title="å…¶ä»–å‘½ä»¤"></a>å…¶ä»–å‘½ä»¤</h3><table><thead><tr><th>å‚æ•°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>&#x2F;active:no</td><td>å¯ç”¨æˆ–ç¦ç”¨ç”¨æˆ·</td></tr><tr><td>&#x2F;comment:â€Textâ€</td><td>ç”¨æˆ·æè¿°</td></tr></tbody></table><h2 id="å†…ç½®ç”¨æˆ·"><a href="#å†…ç½®ç”¨æˆ·" class="headerlink" title="å†…ç½®ç”¨æˆ·"></a>å†…ç½®ç”¨æˆ·</h2><h3 id="system-ç”¨æˆ·"><a href="#system-ç”¨æˆ·" class="headerlink" title="system ç”¨æˆ·"></a>system ç”¨æˆ·</h3><p>æœåŠ¡é»˜è®¤çš„æ‰§è¡Œç”¨æˆ·ï¼Œå¦‚æœä¸€ä¸ªç¨‹åºåœ¨ windows ä¸Šç›´æ¥è¿è¡Œå’Œé€šè¿‡æœåŠ¡æ¥è¿è¡Œæ•ˆæœä¸ä¸€æ ·ï¼Œå¯ä»¥è€ƒè™‘ä¸‹æœåŠ¡æ‰§è¡Œçš„ç”¨æˆ·æ˜¯ä¸æ˜¯å½“å‰ç”¨æˆ·ï¼Œæ¯”å¦‚æˆ‘ç”¨ syncthing ï¼Œç›´æ¥è¿è¡Œé…ç½®å¥½äº†ä¸€ä¼šï¼Œä½¿ç”¨ always up æ¥è¿è¡Œé…ç½®ä¸¢å¤±äº†ï¼ŒåŸå› æ˜¯é…ç½®æ–‡ä»¶è¢«å†™å…¥å½“å‰ç”¨æˆ·ï¼Œè€Œç”¨ always up é»˜è®¤ä½¿ç”¨çš„æ˜¯ system ç”¨æˆ·ï¼Œå…¶ä¸­ system ç”¨æˆ·çš„ç”¨æˆ·æ–‡ä»¶å¤¹åœ¨ï¼š</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">C:\<span class="title">Windows</span>\<span class="title">System32</span>\<span class="title">config</span>\<span class="title">systemprofile</span>\</span></span><br></pre></td></tr></table></figure><h1 id="win-R-é€ŸæŸ¥"><a href="#win-R-é€ŸæŸ¥" class="headerlink" title="win + R é€ŸæŸ¥"></a>win + R é€ŸæŸ¥</h1><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>certmgr.msc</td><td>è¯ä¹¦ç®¡ç†</td></tr><tr><td>compmgmt.msc</td><td>è®¡ç®—æœºç®¡ç†</td></tr><tr><td>control</td><td>æ§åˆ¶é¢æ¿</td></tr><tr><td>control userpasswords</td><td>ç”¨æˆ·è´¦æˆ·</td></tr><tr><td>devmgmt.msc</td><td>è®¾å¤‡ç®¡ç†å™¨</td></tr><tr><td>diskmgmt.msc</td><td>ç£ç›˜ç®¡ç†</td></tr><tr><td>eventvwr</td><td>äº‹ä»¶æŸ¥çœ‹å™¨</td></tr><tr><td>explorer</td><td>èµ„æºç®¡ç†å™¨</td></tr><tr><td>gpedit.msc</td><td>ç»„ç­–ç•¥ç¼–è¾‘å™¨</td></tr><tr><td>fsmgmt.msc</td><td>å…±äº«æ–‡ä»¶å¤¹</td></tr><tr><td>iexplore</td><td>IE æµè§ˆå™¨</td></tr><tr><td>lusrmgr.msc</td><td>æœ¬åœ°ç”¨æˆ·å’Œç»„</td></tr><tr><td>msconfig</td><td>ç³»ç»Ÿé…ç½®</td></tr><tr><td>mspaint</td><td>ç”»å›¾</td></tr><tr><td>mstsc</td><td>è¿œç¨‹æ¡Œé¢è¿æ¥</td></tr><tr><td>osk</td><td>å±å¹•é”®ç›˜</td></tr><tr><td>perfmon.msc</td><td>æ€§èƒ½ç›‘è§†å™¨</td></tr><tr><td>netplwiz</td><td>æ‰“å¼€è´¦æˆ·ç®¡ç†çª—å£ 2</td></tr><tr><td>control userpasswords2</td><td>æ‰“å¼€è´¦æˆ·ç®¡ç†çª—å£ 2</td></tr><tr><td>rundll32 netplwiz.dll,UsersRunDll</td><td>æ‰“å¼€è´¦æˆ·ç®¡ç†çª—å£ 2</td></tr><tr><td>gpmc.msc</td><td>åŸŸæ§ç»„ç­–ç•¥</td></tr><tr><td>taskschd.msc</td><td>ä»»åŠ¡è®¡åˆ’ç¨‹åº</td></tr><tr><td>ncpa.cpl</td><td>æ§åˆ¶é¢æ¿ - ç½‘ç»œç®¡ç†</td></tr><tr><td>systempropertiesprotection</td><td>ç³»ç»Ÿä¿æŠ¤è®¾ç½®é¡µé¢</td></tr><tr><td>sysdm.cpl</td><td>ç³»ç»Ÿå±æ€§é¡µé¢</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows </tag>
            
            <tag> é…ç½®è®°å½• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Windowsç³»ç»Ÿæ–‡ä»¶ç›®å½•</title>
      <link href="/posts/deff9f9f/"/>
      <url>/posts/deff9f9f/</url>
      
        <content type="html"><![CDATA[<h2 id="å¸¸ç”¨ç³»ç»Ÿç›®å½•"><a href="#å¸¸ç”¨ç³»ç»Ÿç›®å½•" class="headerlink" title="å¸¸ç”¨ç³»ç»Ÿç›®å½•"></a>å¸¸ç”¨ç³»ç»Ÿç›®å½•</h2><p>å¦‚æœå¸è½½è½¯ä»¶ï¼Œéœ€è¦æ³¨æ„è¿™äº›ç›®å½•æœ‰æ²¡æœ‰æ®‹ç•™ã€‚</p><table><thead><tr><th>ç›®å½•</th><th>å˜é‡æˆ–çŸ­è·¯å¾„</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>C:\Windows\System32\config\systemprofile\AppData</td><td></td><td>SYSTEM ç”¨æˆ·ç›®å½•ï¼ˆé¦–æ¬¡è®¿é—®éœ€è¦æˆæƒï¼‰</td></tr><tr><td>C:\Program Files</td><td></td><td>64 ä½ç¨‹åºå®‰è£…ç›®å½•ï¼ˆéœ€è¦ç®¡ç†å‘˜æƒé™ï¼‰</td></tr><tr><td>C:\Program Files (x86)</td><td></td><td>32 ä½ç¨‹åºå®‰è£…ç›®å½•ï¼ˆéœ€è¦ç®¡ç†å‘˜æƒé™ï¼‰</td></tr><tr><td>C:\Users\ç”¨æˆ·å</td><td><code>%userprofile%</code></td><td>ç”¨æˆ·çš„ Home ç›®å½•</td></tr><tr><td>C:\Users\ç”¨æˆ·å\AppData\Roaming</td><td><code>%appdata%</code></td><td></td></tr><tr><td>C:\Users\ç”¨æˆ·å\AppData\Local</td><td><code>%localappdata%</code></td><td>æ•°æ®ç›®å½•ï¼Œä»¥åŠä¸€äº›è½¯ä»¶å®‰è£…ç›®å½•ï¼ˆä¸éœ€è¦ç®¡ç†å‘˜æƒé™ï¼‰</td></tr><tr><td>C:\Users\iuxt\AppData\Local\Temp</td><td><code>%tmp%</code></td><td>ä¸´æ—¶ç›®å½•ï¼Œä¸€èˆ¬ä¸éœ€ç®¡ç†</td></tr><tr><td>C:\ProgramData</td><td><code>%programdata%</code></td><td>åº”ç”¨æ•°æ®ï¼ˆè¿™ä¸ªç›®å½•æ˜¯ä¸ªéšè—ç›®å½•ï¼‰</td></tr></tbody></table><h2 id="å¼€å§‹èœå•"><a href="#å¼€å§‹èœå•" class="headerlink" title="å¼€å§‹èœå•"></a>å¼€å§‹èœå•</h2><p>å…¨å±€ä½ç½®ï¼š<code>C:\ProgramData\Microsoft\Windows\Start Menu</code><br>ä¸ªäººä½ç½®ï¼š<code>%appdata%\Microsoft\Windows\Start Menu</code></p><h2 id="windows-update-æ›´æ–°ç¼“å­˜"><a href="#windows-update-æ›´æ–°ç¼“å­˜" class="headerlink" title="windows update æ›´æ–°ç¼“å­˜"></a>windows update æ›´æ–°ç¼“å­˜</h2><p><code>C:\Windows\SoftwareDistribution\Download</code></p><h2 id="æœåŠ¡ç›®å½•"><a href="#æœåŠ¡ç›®å½•" class="headerlink" title="æœåŠ¡ç›®å½•"></a>æœåŠ¡ç›®å½•</h2><p>windows çš„æœåŠ¡å­˜å‚¨çš„æ–‡ä»¶, å¦‚æœæ²¡æœ‰æŒ‡å®šç”¨æˆ·, å°±ä¼šä½¿ç”¨ç³»ç»Ÿç”¨æˆ· (SYSTEM) æ¥è¿è¡Œ, home ç›®å½•ä¸º:</p><p><code>C:\Windows\System32\config\systemprofile\</code></p><p>æ¯”å¦‚æˆ‘çš„ syncthing æ•°æ®å°±è¢«ä¿å­˜åˆ°äº† <code>C:\Windows\System32\config\systemprofile\AppData\Local\Syncthing</code> , æŒ‡å®šäº†å½“å‰ç”¨æˆ·çš„è¯æ˜¯åœ¨ <code>%localappdata%\Syncthing</code></p>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Windowsæ¢å¤ç¯å¢ƒWindows RE</title>
      <link href="/posts/c0eb591c/"/>
      <url>/posts/c0eb591c/</url>
      
        <content type="html"><![CDATA[<h2 id="reagentc-å‘½ä»¤"><a href="#reagentc-å‘½ä»¤" class="headerlink" title="reagentc å‘½ä»¤"></a>reagentc å‘½ä»¤</h2><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">reagentc /disable       ç¦ç”¨windowsRE</span><br><span class="line">reagentc /enable        å¯ç”¨windowsRE</span><br><span class="line">reagentc /info          æŸ¥çœ‹windowsREçŠ¶æ€</span><br><span class="line">reagentc /boottore      å°†ç³»ç»Ÿé…ç½®ä¸ºåœ¨ä¸‹æ¬¡ç³»ç»Ÿå¯åŠ¨æ—¶å¯åŠ¨ Windows RE</span><br></pre></td></tr></table></figure><h2 id="é‡æ–°å¯ç”¨-windowsRE"><a href="#é‡æ–°å¯ç”¨-windowsRE" class="headerlink" title="é‡æ–°å¯ç”¨ windowsRE"></a>é‡æ–°å¯ç”¨ windowsRE</h2><blockquote><p>å› ä¸ºå„ç§åŸå› ï¼Œæ¯”å¦‚æ‰‹åŠ¨åˆ é™¤äº† winre åˆ†åŒºï¼Œ ä½¿ç”¨ <code>reagentc /info</code> æŸ¥çœ‹å‘ç° RE å·²ç»æ²¡æœ‰äº†ï¼Œå¯ä»¥æ‰‹åŠ¨åˆ›å»º RE</p></blockquote><h3 id="æ‰¾åˆ°-winre-wim-é•œåƒ"><a href="#æ‰¾åˆ°-winre-wim-é•œåƒ" class="headerlink" title="æ‰¾åˆ° winre.wim é•œåƒ"></a>æ‰¾åˆ° winre.wim é•œåƒ</h3><p>æ‰¾åˆ°å’Œä½ ç³»ç»ŸåŒç‰ˆæœ¬çš„å®‰è£…é•œåƒï¼Œ æå–å…¶ä¸­çš„ <code>source\install.wim</code> æ–‡ä»¶, ç”¨è§£å‹ç¼©è½¯ä»¶æ‰“å¼€ install.wim æ–‡ä»¶, è§£å‹å…¶ä¸­çš„ <code>windows/system32/recovery/winre.wim</code>ï¼Œ æˆ‘ä»¬éœ€è¦çš„å°±æ˜¯ä¸€ä¸ª <code>winre.wim</code> æ–‡ä»¶ã€‚</p><h3 id="åˆ›å»º-winre-åˆ†åŒº"><a href="#åˆ›å»º-winre-åˆ†åŒº" class="headerlink" title="åˆ›å»º winre åˆ†åŒº"></a>åˆ›å»º winre åˆ†åŒº</h3><p>ç®¡ç†å‘˜æƒé™è¿è¡Œ diskpart å‘½ä»¤</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">create partition primary size=<span class="number">1024</span></span><br><span class="line"><span class="built_in">format</span> quick <span class="built_in">fs</span>=ntfs <span class="built_in">label</span>=&quot;Recovery&quot;</span><br><span class="line">assign letter=&quot;R&quot;</span><br></pre></td></tr></table></figure><h3 id="åˆ›å»º-WinRE-ç›®å½•"><a href="#åˆ›å»º-WinRE-ç›®å½•" class="headerlink" title="åˆ›å»º WinRE ç›®å½•"></a>åˆ›å»º WinRE ç›®å½•</h3><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> R:\Recovery\WindowsRE</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶å°†æ–‡ä»¶æ”¾å…¥ <code>R:\Recovery\WindowsRE</code> ä¸­</p><p>ç„¶åæ‰§è¡Œï¼š</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reagentc /setreimage /<span class="built_in">path</span> R:\Recovery\WindowsRE</span><br></pre></td></tr></table></figure><h3 id="è®¾ç½®ç£ç›˜å±æ€§"><a href="#è®¾ç½®ç£ç›˜å±æ€§" class="headerlink" title="è®¾ç½®ç£ç›˜å±æ€§"></a>è®¾ç½®ç£ç›˜å±æ€§</h3><p>ç®¡ç†å‘˜æƒé™è¿è¡Œ diskpart å‘½ä»¤</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">list disk             # æŸ¥çœ‹ç£ç›˜id</span><br><span class="line">select disk <span class="number">0</span>         # é€‰æ‹©ä½ çš„ç³»ç»Ÿç£ç›˜</span><br><span class="line">list partition        # æŸ¥çœ‹åˆ†åŒºid</span><br><span class="line">select partition <span class="number">5</span>    # é€‰æ‹©æ¢å¤åˆ†åŒºçš„id</span><br><span class="line"><span class="built_in">set</span> id=&quot;de94bba4-<span class="number">06</span>d1-<span class="number">4</span>d40-a16a-bfd50179d6ac&quot;</span><br><span class="line">gpt attributes=<span class="number">0</span>x8000000000000001</span><br></pre></td></tr></table></figure><h3 id="å¯ç”¨-winre"><a href="#å¯ç”¨-winre" class="headerlink" title="å¯ç”¨ winre"></a>å¯ç”¨ winre</h3><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">reagentc /enable</span><br><span class="line">reagentc /info</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Windowsé•œåƒç¼–è¾‘å·¥å…·ï¼ˆdismå’Œimagexï¼‰</title>
      <link href="/posts/a3a12a0e/"/>
      <url>/posts/a3a12a0e/</url>
      
        <content type="html"><![CDATA[<blockquote><p>imagex å’Œ dism éƒ½æ˜¯ windows å®˜æ–¹å¤„ç† windows å®‰è£…é•œåƒ wim æ–‡ä»¶çš„å·¥å…·ï¼Œå…¶ä¸­ dism æ˜¯è‡ªå¸¦çš„ï¼Œimagex æ˜¯å•æ–‡ä»¶ï¼Œä¾èµ–ç®€å•</p></blockquote><h2 id="imagex"><a href="#imagex" class="headerlink" title="imagex"></a>imagex</h2><blockquote><p>ä»¥ä¸‹ä»¥å°† windows32 ä½å®‰è£…é•œåƒå’Œ 64 ä½å®‰è£…é•œåƒæ•´åˆä¸ºä¾‹</p></blockquote><h3 id="é•œåƒå¯¼å‡ºåˆå¹¶"><a href="#é•œåƒå¯¼å‡ºåˆå¹¶" class="headerlink" title="é•œåƒå¯¼å‡ºåˆå¹¶"></a>é•œåƒå¯¼å‡ºåˆå¹¶</h3><blockquote><p>å°† 64 ä½é•œåƒå¯¼å‡ºå†™å…¥åˆ° 32 ä½é•œåƒé‡Œ</p></blockquote><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">imagex /export install64.wim <span class="number">1</span> install32.wim &quot;Win7 homebasic x64&quot;</span><br><span class="line">imagex /export install64.wim <span class="number">2</span> install32.wim &quot;win7 homepremium x64&quot;</span><br><span class="line">imagex /export install64.wim <span class="number">3</span> install32.wim &quot;win7 professional x64&quot;</span><br><span class="line">imagex /export install64.wim <span class="number">4</span> install32.wim &quot;win7 ultimate x64&quot;</span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹é•œåƒæè¿°ä¿¡æ¯"><a href="#ä¿®æ”¹é•œåƒæè¿°ä¿¡æ¯" class="headerlink" title="ä¿®æ”¹é•œåƒæè¿°ä¿¡æ¯"></a>ä¿®æ”¹é•œåƒæè¿°ä¿¡æ¯</h3><blockquote><p>ä¿®æ”¹å‰å¯ä»¥ä½¿ç”¨ <code>imagex /info C:\xxxxx.wim</code> æŸ¥çœ‹é•œåƒä¿¡æ¯</p></blockquote><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">imagex /info install32.wim <span class="number">1</span> &quot;Windows <span class="number">7</span> STARTER X86&quot; &quot;Windows <span class="number">7</span> ç®€æ˜“ç‰ˆ&quot;</span><br><span class="line">imagex /info install32.wim <span class="number">2</span> &quot;Windows <span class="number">7</span> HOMEBASIC X86&quot; &quot;Windows <span class="number">7</span> å®¶åº­æ™®é€šç‰ˆ <span class="number">32</span>ä½&quot;</span><br><span class="line">imagex /info install32.wim <span class="number">3</span> &quot;Windows <span class="number">7</span> HOMEPREMIUM X86&quot; &quot;Windows <span class="number">7</span> å®¶åº­é«˜çº§ç‰ˆ <span class="number">32</span>ä½&quot;</span><br><span class="line">imagex /info install32.wim <span class="number">4</span> &quot;Windows <span class="number">7</span> PROFESSIONAL X86&quot; &quot;Windows <span class="number">7</span> ä¸“ä¸šç‰ˆ <span class="number">32</span>ä½&quot;</span><br><span class="line">imagex /info install32.wim <span class="number">5</span> &quot;Windows <span class="number">7</span> ULTIMATE X86&quot; &quot;Windows <span class="number">7</span> æ——èˆ°ç‰ˆ <span class="number">32</span>ä½&quot;</span><br><span class="line">imagex /info install32.wim <span class="number">6</span> &quot;Windows <span class="number">7</span> HOMEBASIC X64&quot; &quot;Windows <span class="number">7</span> å®¶åº­æ™®é€šç‰ˆ <span class="number">64</span>ä½&quot;</span><br><span class="line">imagex /info install32.wim <span class="number">7</span> &quot;Windows <span class="number">7</span> HOMEPREMIUM X64&quot; &quot;Windows <span class="number">7</span> å®¶åº­é«˜çº§ç‰ˆ <span class="number">64</span>ä½&quot;</span><br><span class="line">imagex /info install32.wim <span class="number">8</span> &quot;Windows <span class="number">7</span> PROFESSIONAL X64&quot; &quot;Windows <span class="number">7</span> ä¸“ä¸šç‰ˆ <span class="number">64</span>ä½&quot;</span><br><span class="line">imagex /info install32.wim <span class="number">9</span> &quot;Windows <span class="number">7</span> ULTIMATE X64&quot; &quot;Windows <span class="number">7</span> æ——èˆ°ç‰ˆ <span class="number">64</span>ä½&quot;</span><br></pre></td></tr></table></figure><h2 id="dism"><a href="#dism" class="headerlink" title="dism"></a>dism</h2><h3 id="æŒ‰å¤§å°æ‹†åˆ†-wim-é•œåƒ"><a href="#æŒ‰å¤§å°æ‹†åˆ†-wim-é•œåƒ" class="headerlink" title="æŒ‰å¤§å°æ‹†åˆ† wim é•œåƒ"></a>æŒ‰å¤§å°æ‹†åˆ† wim é•œåƒ</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dism /<span class="built_in">Split-Image</span> /ImageFile:F:\sources\install.wim /SWMFile:D:\install.swm /FileSize:<span class="number">4096</span></span><br></pre></td></tr></table></figure><h3 id="é•œåƒæŒ‚è½½å¸è½½"><a href="#é•œåƒæŒ‚è½½å¸è½½" class="headerlink" title="é•œåƒæŒ‚è½½å¸è½½"></a>é•œåƒæŒ‚è½½å¸è½½</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹åˆ†å·ä¿¡æ¯</span></span><br><span class="line">DISM /<span class="built_in">Get-WimInfo</span> /WimFile:<span class="string">&quot;C:\path\to\install.wim&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‚è½½é•œåƒ</span></span><br><span class="line">DISM /<span class="built_in">Mount-Image</span> /ImageFile:<span class="string">&quot;C:\install.wim&quot;</span> /Index:<span class="number">1</span> /MountDir:<span class="string">&quot;C:\Mount&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¸è½½é•œåƒï¼Œå¹¶ä¿å­˜æ›´æ”¹</span></span><br><span class="line">DISM /Un<span class="built_in">mount-Image</span> /MountDir:<span class="string">&quot;C:\Mount&quot;</span> /Commit</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¸è½½é•œåƒï¼Œä¸ä¿å­˜æ›´æ”¹</span></span><br><span class="line">DISM /Un<span class="built_in">mount-Image</span> /MountDir:<span class="string">&quot;C:\Mount&quot;</span> /discard</span><br></pre></td></tr></table></figure><h3 id="æ£€æŸ¥-windows-å¥åº·åº¦"><a href="#æ£€æŸ¥-windows-å¥åº·åº¦" class="headerlink" title="æ£€æŸ¥ windows å¥åº·åº¦"></a>æ£€æŸ¥ windows å¥åº·åº¦</h3><p>For a quick check of an online image, you may be able to use the command: to scan and repair files. <code>sfc /scannow</code><br>For a more extensive check that can repair issues with the store, use <code>DISM /Cleanup-Image</code></p><p>Dism æ“ä½œå¦‚ä¸‹:</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">:: æ£€æŸ¥é•œåƒæ˜¯å¦å¯è¢«ä¿®å¤</span><br><span class="line">Dism /Online /Cleanup-Image /ScanHealth</span><br><span class="line">Dism /Online /Cleanup-Image /CheckHealth</span><br><span class="line"></span><br><span class="line">:: åœ¨çº¿ä¿®å¤</span><br><span class="line">DISM /Online /Cleanup-Image /RestoreHealth</span><br><span class="line"></span><br><span class="line">:: ç¦»çº¿ä¿®å¤, éœ€è¦æŒ‡å®šå®‰è£…æº</span><br><span class="line">Dism /Image:C:\offline /Cleanup-Image /RestoreHealth /Source:c:\test\mount\windows</span><br><span class="line"></span><br><span class="line">:: åœ¨çº¿ä¿®å¤æŒ‚è½½çš„å…¶ä»–ç³»ç»Ÿ(è¢«æŒ‚è½½åˆ°æœ¬æœºç¡¬ç›˜, æ¯”å¦‚æ˜¯wimæŒ‚è½½çš„)</span><br><span class="line">Dism /Online /Cleanup-Image /RestoreHealth /Source:c:\test\mount\windows /LimitAccess</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Windowsç¡¬ä»¶ç‰¹å¾</title>
      <link href="/posts/ltfd14pe/"/>
      <url>/posts/ltfd14pe/</url>
      
        <content type="html"><![CDATA[<p>æŸ¥çœ‹åºåˆ—å·</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic bios get serialnumber</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹ç¡¬ç›˜åºåˆ—å·</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic diskdrive get serialnumber</span><br></pre></td></tr></table></figure><p>ä¸»æ¿åºåˆ—å·</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic baseboard get serialnumber</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>æ‰“é€ ä¸€ä¸ªèµå¿ƒæ‚¦ç›®çš„ç»ˆç«¯</title>
      <link href="/posts/57e7c794/"/>
      <url>/posts/57e7c794/</url>
      
        <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡åŸºäº Windows å¹³å°ï¼Œç³»ç»Ÿç”¨çš„æ˜¯ WSL(ubuntu 20.04)ï¼Œshell ç”¨çš„æ˜¯ zshï¼Œlinux ç³»ç»Ÿåº”è¯¥ç±»ä¼¼</p></blockquote><p>å…ˆçœ‹æ•ˆæœï¼š<br>Windows Terminal:<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/oh-my-zsh_windows_terminal.jpg" alt="Windows Terminal"></p><p>VsCode:<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/oh-my-zsh_vscode.png" alt="vscode"></p><h2 id="oh-my-zsh"><a href="#oh-my-zsh" class="headerlink" title="oh-my-zsh"></a>oh-my-zsh</h2><blockquote><p>å®˜æ–¹é¡µé¢ï¼š<a href="https://ohmyz.sh/">https://ohmyz.sh/</a><br>github åœ°å€ï¼š<a href="https://github.com/ohmyzsh/ohmyzsh">https://github.com/ohmyzsh/ohmyzsh</a></p></blockquote><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt install zsh</span><br><span class="line">sh -c <span class="string">&quot;<span class="subst">$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)</span>&quot;</span></span><br></pre></td></tr></table></figure><h3 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><h3 id="ä¸»é¢˜"><a href="#ä¸»é¢˜" class="headerlink" title="ä¸»é¢˜"></a>ä¸»é¢˜</h3><p>æˆ‘ä½¿ç”¨çš„æ˜¯<a href="https://github.com/romkatv/powerlevel10k">https://github.com/romkatv/powerlevel10k</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> --depth=1 https://github.com/romkatv/powerlevel10k.git <span class="variable">$&#123;ZSH_CUSTOM:-<span class="variable">$HOME</span>/.oh-my-zsh/custom&#125;</span>/themes/powerlevel10k</span><br></pre></td></tr></table></figure><p>å¸¸ç”¨å‘½ä»¤ï¼š</p><table><thead><tr><th>å‘½ä»¤</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>p10k configure</td><td>é‡æ–°é…ç½® powerlevel10k</td></tr><tr><td>p10k help</td><td>æŸ¥çœ‹å¸®åŠ©</td></tr></tbody></table><h3 id="æ’ä»¶"><a href="#æ’ä»¶" class="headerlink" title="æ’ä»¶"></a>æ’ä»¶</h3><blockquote><p>æ’ä»¶åœ°å€ï¼š<a href="https://github.com/ohmyzsh/ohmyzsh/tree/master/plugins">https://github.com/ohmyzsh/ohmyzsh/tree/master/plugins</a></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/zsh-users/zsh-autosuggestions <span class="variable">$&#123;ZSH_CUSTOM:-~/.oh-my-zsh/custom&#125;</span>/plugins/zsh-autosuggestions</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹é…ç½® <code>vim ~/.zshrc</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">plugins=(</span><br><span class="line">    git</span><br><span class="line">    zsh-autosuggestions</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h2 id="å­—ä½“"><a href="#å­—ä½“" class="headerlink" title="å­—ä½“"></a>å­—ä½“</h2><p>å»ºè®®ä½¿ç”¨å¸¦ emoji çš„ poweline å­—ä½“ï¼Œ æ¨è <a href="https://www.nerdfonts.com/">Nert Fonts</a>, æˆ‘ç”¨çš„æ˜¯ jetbrains</p><h3 id="å…³äºç­‰å®½å­—ä½“"><a href="#å…³äºç­‰å®½å­—ä½“" class="headerlink" title="å…³äºç­‰å®½å­—ä½“"></a>å…³äºç­‰å®½å­—ä½“</h3><blockquote><p>é¡¾åæ€ä¹‰ï¼Œç­‰å®½å­—ä½“å°±æ˜¯å®½åº¦ç›¸ç­‰çš„å­—ä½“ï¼Œä¸¾ä¸ªä¾‹å­ï¼šæ™®é€šå­—ä½“ä¸­ M çœ‹ä½“å‹å°±æ¯” i è¦å®½ï¼Œä½†æ˜¯ç­‰å®½å­—ä½“ä¸­ä»–ä¿©æ˜¯ä¸€æ ·å®½çš„ï¼Œåœ¨ç¼–è¾‘å™¨ä¸­å°±å¯ä»¥å¯¹é½äº†</p></blockquote><p>ç­‰å®½å­—ä½“ä¸€èˆ¬æ–‡ä»¶åä¸­å¸¦ <code>Mono</code>ï¼Œå¦‚ <code>JetBrains Mono</code>ï¼Œä½†æ˜¯å¤§éƒ¨åˆ†ç­‰å®½å­—ä½“åªå¯¹è‹±æ–‡ç”Ÿæ•ˆï¼Œä¸­æ–‡å­—ä½“å’Œä¸­æ–‡ç¬¦å·æ˜¯ä¸å¯¹é½çš„<br>æƒ³è¦ä¸­æ–‡ä¹Ÿå¯¹é½çš„å°ä¼™ä¼´å¯ä»¥ä½¿ç”¨è¿™ä¸ªå­—ä½“ï¼š<a href="https://github.com/powerline/fonts/tree/master/UbuntuMono">Ubuntu Mono derivative Powerline</a>ï¼Œæ­¤å­—ä½“ä¸€ä¸ªæ±‰å­—å’Œä¸¤ä¸ªè‹±æ–‡ä¸€æ ·å®½ã€‚å†ä¹Ÿä¸æ€•ç»ˆç«¯ç¬¦å·å¯¹ä¸é½å•¦ã€‚</p><h2 id="windows-terminal-é…ç½®"><a href="#windows-terminal-é…ç½®" class="headerlink" title="windows terminal é…ç½®"></a>windows terminal é…ç½®</h2><h3 id="æ”¹å­—ä½“"><a href="#æ”¹å­—ä½“" class="headerlink" title="æ”¹å­—ä½“"></a>æ”¹å­—ä½“</h3><p><del>â€œfontFaceâ€: â€œJetBrainsMono NFâ€,</del></p><blockquote><p>æ–°ç‰ˆæœ¬çš„ Windows Terminal å¯ä»¥æœ‰å›¾å½¢ç•Œé¢é…ç½®äº†</p></blockquote><h3 id="æ”¹é…è‰²"><a href="#æ”¹é…è‰²" class="headerlink" title="æ”¹é…è‰²"></a>æ”¹é…è‰²</h3><p>ayu é…è‰²: <a href="https://github.com/ayu-theme/ayu-colors">https://github.com/ayu-theme/ayu-colors</a></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;background&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#0A0E14&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;black&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#01060E&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;blue&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#53BDFA&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;brightBlack&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#686868&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;brightBlue&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#59C2FF&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;brightCyan&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#95E6CB&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;brightGreen&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#C2D94C&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;brightPurple&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#FFEE99&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;brightRed&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#F07178&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;brightWhite&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#FFFFFF&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;brightYellow&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#FFB454&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;cursorColor&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#FFFFFF&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;cyan&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#90E1C6&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;foreground&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#B3B1AD&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;green&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#91B362&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Ayu Dark&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;purple&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#FAE994&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;red&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#EA6C73&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;selectionBackground&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#FFFFFF&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;white&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#C7C7C7&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;yellow&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#F9AF4F&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;background&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#FAFAFA&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;black&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#000000&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;blue&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#3199E1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;brightBlack&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#686868&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;brightBlue&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#399EE6&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;brightCyan&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#4CBF99&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;brightGreen&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#86B300&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;brightPurple&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#A37ACC&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;brightRed&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#F07171&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;brightWhite&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#D1D1D1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;brightYellow&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#F2AE49&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;cursorColor&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#FFFFFF&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;cyan&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#46BA94&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;foreground&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#6C7680&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;green&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#99BF4D&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Ayu Light&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;purple&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#9E75C7&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;red&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#EA6C6D&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;selectionBackground&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#FFFFFF&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;white&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#C7C7C7&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;yellow&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#ECA944&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;background&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#1F2430&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;black&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#191E2A&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;blue&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#6DCBFA&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;brightBlack&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#686868&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;brightBlue&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#73D0FF&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;brightCyan&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#95E6CB&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;brightGreen&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#BAE67E&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;brightPurple&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#D4BFFF&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;brightRed&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#F28779&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;brightWhite&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#FFFFFF&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;brightYellow&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#FFD580&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;cursorColor&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#FFFFFF&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;cyan&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#90E1C6&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;foreground&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#CBCCC6&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;green&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#A6CC70&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Ayu Mirage&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;purple&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#CFBAFA&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;red&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#ED8274&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;selectionBackground&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#FFFFFF&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;white&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#C7C7C7&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;yellow&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#FAD07B&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure><h3 id="é€æ˜èƒŒæ™¯"><a href="#é€æ˜èƒŒæ™¯" class="headerlink" title="é€æ˜èƒŒæ™¯"></a>é€æ˜èƒŒæ™¯</h3><p>é¦–å…ˆæ¥ä¸ªèƒŒæ™¯å›¾ï¼š<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/background.png" alt="èƒŒæ™¯å›¾"></p><p>è®¾ç½®èƒŒæ™¯å›¾åƒè·¯å¾„<br>èƒŒæ™¯å›¾åƒçš„ä¸é€æ˜åº¦ï¼š70<br>å¯ç”¨ acrylic<br>acrylic ä¸é€æ˜åº¦ï¼š1</p><h2 id="vscode-é…ç½®"><a href="#vscode-é…ç½®" class="headerlink" title="vscode é…ç½®"></a>vscode é…ç½®</h2><p>è®¾ç½®â¡ï¸æ§åˆ¶å­—ä½“ç³»åˆ— (editor.fontFamily)â¡ï¸<strong>åœ¨æœ€å‰é¢</strong>æ·»åŠ  <code>&#39;MeslolGS NF&#39;,</code></p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/oh-my-zsh_vscode_settings.png" alt="vscodeé…ç½®"></p><h2 id="ubuntu-è‡ªå¸¦-terminal-é…ç½®"><a href="#ubuntu-è‡ªå¸¦-terminal-é…ç½®" class="headerlink" title="ubuntu è‡ªå¸¦ terminal é…ç½®"></a>ubuntu è‡ªå¸¦ terminal é…ç½®</h2><p>ç³»ç»Ÿç›®å½•å’Œç”¨æˆ·ç›®å½•äºŒé€‰ä¸€</p><ul><li><p>å®‰è£…å­—ä½“ (ç³»ç»Ÿç›®å½•)</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">mkdir</span> -p /usr/share/fonts/custom</span><br><span class="line">sudo <span class="built_in">mv</span> *.ttf /usr/share/fonts/custom</span><br><span class="line"></span><br><span class="line">sudo mkfontscale</span><br><span class="line">sudo mkfontdir</span><br><span class="line">sudo fc-cache -fv</span><br></pre></td></tr></table></figure></li><li><p>å®‰è£…å­—ä½“ï¼ˆç”¨æˆ·ç›®å½•ï¼‰</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mv</span> *.ttf ~/.local/share/fonts</span><br></pre></td></tr></table></figure></li></ul><h3 id="terminal-è®¾ç½®"><a href="#terminal-è®¾ç½®" class="headerlink" title="terminal è®¾ç½®"></a>terminal è®¾ç½®</h3><p>è‡ªå®šä¹‰å­—ä½“å‹¾é€‰ï¼Œç„¶åé€‰æ‹©å­—ä½“å³å¯</p>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> WSL </tag>
            
            <tag> é…ç½®è®°å½• </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å®‰å“ç»ˆç«¯å·¥å…·termuxå¸¸ç”¨æ“ä½œè®°å½•</title>
      <link href="/posts/fd0c5290/"/>
      <url>/posts/fd0c5290/</url>
      
        <content type="html"><![CDATA[<blockquote><p>termux æ˜¯å®‰å“å¹³å°æ¨¡æ‹Ÿ linux ç¯å¢ƒçš„å·¥å…·ï¼Œå¯ä»¥è¿è¡Œå¸¸ç”¨çš„ linux å·¥å…·</p></blockquote><h2 id="å¸¸ç”¨é…ç½®"><a href="#å¸¸ç”¨é…ç½®" class="headerlink" title="å¸¸ç”¨é…ç½®"></a>å¸¸ç”¨é…ç½®</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¿®æ”¹è½¯ä»¶æº</span></span><br><span class="line">termux-change-repo</span><br><span class="line"></span><br><span class="line"><span class="comment"># homeç›®å½•æ·»åŠ storage, å¯ä»¥è®¿é—®æ‰‹æœºé‡Œçš„æ–‡ä»¶</span></span><br><span class="line">termux-setup-storage</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®å¤shebang</span></span><br><span class="line">termux-fix-shebang</span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹ç”¨æˆ·ç¯å¢ƒå˜é‡"><a href="#ä¿®æ”¹ç”¨æˆ·ç¯å¢ƒå˜é‡" class="headerlink" title="ä¿®æ”¹ç”¨æˆ·ç¯å¢ƒå˜é‡"></a>ä¿®æ”¹ç”¨æˆ·ç¯å¢ƒå˜é‡</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; ~/.profile &lt;&lt;-<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line"><span class="built_in">alias</span> ll=<span class="string">&#x27;ls -al&#x27;</span></span><br><span class="line"><span class="built_in">alias</span> l=<span class="string">&#x27;ls -l&#x27;</span></span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h3 id="è™šæ‹Ÿæ ¹ç›®å½•"><a href="#è™šæ‹Ÿæ ¹ç›®å½•" class="headerlink" title="è™šæ‹Ÿæ ¹ç›®å½•"></a>è™šæ‹Ÿæ ¹ç›®å½•</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> <span class="variable">$PREFIX</span></span><br></pre></td></tr></table></figure><h3 id="å®‰è£…-zsh"><a href="#å®‰è£…-zsh" class="headerlink" title="å®‰è£… zsh"></a>å®‰è£… zsh</h3><blockquote><p>æš‚æ—¶æœ‰ bug, å¯¼è‡´ nodejs ç¨‹åºè¿è¡Œæç¤º æ‰¾ä¸åˆ° env, å¯ä»¥æ‰§è¡Œ <code>termux-fix-shebang</code> ä¸´æ—¶è§£å†³</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh -c <span class="string">&quot;<span class="subst">$(curl -fsSL https://github.com/Cabbagec/termux-ohmyzsh/raw/master/install.sh)</span>&quot;</span></span><br></pre></td></tr></table></figure><h3 id="ç™»å½•æç¤ºè¯­"><a href="#ç™»å½•æç¤ºè¯­" class="headerlink" title="ç™»å½•æç¤ºè¯­"></a>ç™»å½•æç¤ºè¯­</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim <span class="variable">$PREFIX</span>/etc/motd</span><br></pre></td></tr></table></figure><blockquote><p>å¯ä»¥é…åˆ screenfetch é£Ÿç”¨</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pkg install screenfetch</span><br></pre></td></tr></table></figure><h3 id="å®šåˆ¶å±å¹•ä¸Šçš„æŒ‰é”®"><a href="#å®šåˆ¶å±å¹•ä¸Šçš„æŒ‰é”®" class="headerlink" title="å®šåˆ¶å±å¹•ä¸Šçš„æŒ‰é”®"></a>å®šåˆ¶å±å¹•ä¸Šçš„æŒ‰é”®</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[ -d ~/.termux/ ] || <span class="built_in">mkdir</span> ~/.termux/</span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &gt; ~/.termux/termux.properties &lt;&lt;-<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">extra-keys = [ \</span><br><span class="line">[<span class="string">&#x27;ESC&#x27;</span>,<span class="string">&#x27;|&#x27;</span>,<span class="string">&#x27;`&#x27;</span>,<span class="string">&#x27;HOME&#x27;</span>,<span class="string">&#x27;UP&#x27;</span>,<span class="string">&#x27;END&#x27;</span>,<span class="string">&#x27;$&#x27;</span>], \</span><br><span class="line">[<span class="string">&#x27;TAB&#x27;</span>,<span class="string">&#x27;CTRL&#x27;</span>,<span class="string">&#x27;~&#x27;</span>,<span class="string">&#x27;LEFT&#x27;</span>,<span class="string">&#x27;DOWN&#x27;</span>,<span class="string">&#x27;RIGHT&#x27;</span>,<span class="string">&#x27;ENTER&#x27;</span>] \</span><br><span class="line">]</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h2 id="åŒ…ç®¡ç†"><a href="#åŒ…ç®¡ç†" class="headerlink" title="åŒ…ç®¡ç†"></a>åŒ…ç®¡ç†</h2><h3 id="pkg"><a href="#pkg" class="headerlink" title="pkg"></a>pkg</h3><blockquote><p>Termux é™¤äº†æ”¯æŒ apt å‘½ä»¤å¤–,è¿˜åœ¨æ­¤åŸºç¡€ä¸Šå°è£…äº† pkg å‘½ä»¤,pkg å‘½ä»¤å‘ä¸‹å…¼å®¹ apt å‘½ä»¤</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">pkg search &lt;query&gt;              æœç´¢åŒ…</span><br><span class="line">pkg install &lt;package&gt;           å®‰è£…åŒ…</span><br><span class="line">pkg uninstall &lt;package&gt;         å¸è½½åŒ…</span><br><span class="line">pkg reinstall &lt;package&gt;         é‡æ–°å®‰è£…åŒ…</span><br><span class="line">pkg update                      æ›´æ–°æº</span><br><span class="line">pkg upgrade                     å‡çº§è½¯ä»¶åŒ…</span><br><span class="line">pkg list-all                    åˆ—å‡ºå¯ä¾›å®‰è£…çš„æ‰€æœ‰åŒ…</span><br><span class="line">pkg list-installed              åˆ—å‡ºå·²ç»å®‰è£…çš„åŒ…</span><br><span class="line">pkg shoe &lt;package&gt;              æ˜¾ç¤ºæŸä¸ªåŒ…çš„è¯¦ç»†ä¿¡æ¯</span><br><span class="line">pkg files &lt;package&gt;             æ˜¾ç¤ºæŸä¸ªåŒ…çš„ç›¸å…³æ–‡ä»¶å¤¹è·¯å¾„</span><br></pre></td></tr></table></figure><h3 id="apt"><a href="#apt" class="headerlink" title="apt"></a>apt</h3><p>å‚è€ƒ ubuntu çš„ apt</p><h3 id="å®‰è£…å¸¸ç”¨å·¥å…·"><a href="#å®‰è£…å¸¸ç”¨å·¥å…·" class="headerlink" title="å®‰è£…å¸¸ç”¨å·¥å…·"></a>å®‰è£…å¸¸ç”¨å·¥å…·</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pkg update &amp;&amp; pkg install -y git vim openssh curl wget python tar</span><br></pre></td></tr></table></figure><h2 id="å®‰è£…-vscode"><a href="#å®‰è£…-vscode" class="headerlink" title="å®‰è£… vscode"></a>å®‰è£… vscode</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pkg install python nodejs yarn</span><br><span class="line">yarn global add code-server</span><br></pre></td></tr></table></figure><h2 id="å®‰è£…å®Œæ•´ç‰ˆ-Linux"><a href="#å®‰è£…å®Œæ•´ç‰ˆ-Linux" class="headerlink" title="å®‰è£…å®Œæ•´ç‰ˆ Linux"></a>å®‰è£…å®Œæ•´ç‰ˆ Linux</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">pkg install proot-distro</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å¯ä»¥å®‰è£…çš„å‘è¡Œç‰ˆ</span></span><br><span class="line">proot-distro list</span><br><span class="line">proot-distro install ubuntu</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿›å…¥ubuntu</span></span><br><span class="line">proot-distro login ubuntu</span><br></pre></td></tr></table></figure><blockquote><p>å°† <code>proot-distro login ubuntu</code> å†™å…¥åˆ° <code>~/.profile</code> å¯ä»¥æ‰“å¼€è½¯ä»¶è‡ªåŠ¨è¿›å…¥ ubuntu ç³»ç»Ÿ</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Windowsç£ç›˜ç®¡ç†å·¥å…·diskpart</title>
      <link href="/posts/24b2eef7/"/>
      <url>/posts/24b2eef7/</url>
      
        <content type="html"><![CDATA[<h2 id="åˆ›å»º-EFI-åˆ†åŒº"><a href="#åˆ›å»º-EFI-åˆ†åŒº" class="headerlink" title="åˆ›å»º EFI åˆ†åŒº"></a>åˆ›å»º EFI åˆ†åŒº</h2><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">diskpart</span><br><span class="line">list disk</span><br><span class="line">select disk x</span><br><span class="line">create partition efi size=<span class="number">100</span></span><br><span class="line">assign letter=&quot;b&quot;</span><br><span class="line"><span class="built_in">format</span> quick <span class="built_in">fs</span>=FAT32</span><br></pre></td></tr></table></figure><h2 id="åˆ›å»º-msr-åˆ†åŒº"><a href="#åˆ›å»º-msr-åˆ†åŒº" class="headerlink" title="åˆ›å»º msr åˆ†åŒº"></a>åˆ›å»º msr åˆ†åŒº</h2><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create partition msr size=<span class="number">16</span></span><br></pre></td></tr></table></figure><h2 id="åˆ›å»º-Recovery-åˆ†åŒº-WindowsRE"><a href="#åˆ›å»º-Recovery-åˆ†åŒº-WindowsRE" class="headerlink" title="åˆ›å»º Recovery åˆ†åŒº (WindowsRE)"></a>åˆ›å»º Recovery åˆ†åŒº (WindowsRE)</h2><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">create partition primary size=<span class="number">1024</span></span><br><span class="line"><span class="built_in">format</span> quick <span class="built_in">fs</span>=ntfs <span class="built_in">label</span>=&quot;Recovery&quot;</span><br><span class="line">assign letter=&quot;R&quot;</span><br><span class="line"><span class="built_in">set</span> id=&quot;de94bba4-<span class="number">06</span>d1-<span class="number">4</span>d40-a16a-bfd50179d6ac&quot;</span><br><span class="line">gpt attributes=<span class="number">0</span>x8000000000000001</span><br></pre></td></tr></table></figure><h2 id="åˆ é™¤-winre-åˆ†åŒº"><a href="#åˆ é™¤-winre-åˆ†åŒº" class="headerlink" title="åˆ é™¤ winre åˆ†åŒº"></a>åˆ é™¤ winre åˆ†åŒº</h2><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select partition <span class="number">5</span></span><br><span class="line">delete partition override</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨-bat-è„šæœ¬è‡ªåŠ¨åŒ–åˆ›å»ºåˆ†åŒº"><a href="#ä½¿ç”¨-bat-è„šæœ¬è‡ªåŠ¨åŒ–åˆ›å»ºåˆ†åŒº" class="headerlink" title="ä½¿ç”¨ bat è„šæœ¬è‡ªåŠ¨åŒ–åˆ›å»ºåˆ†åŒº"></a>ä½¿ç”¨ bat è„šæœ¬è‡ªåŠ¨åŒ–åˆ›å»ºåˆ†åŒº</h2><p>diskpart_config.txt</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">rem é€‰æ‹©ç£ç›˜,å¹¶æ¸…ç©ºæ‰€æœ‰åˆ†åŒº</span></span><br><span class="line">list disk</span><br><span class="line">select disk <span class="number">0</span></span><br><span class="line">clean</span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">rem è½¬æ¢æˆgpt</span></span><br><span class="line"><span class="built_in">convert</span> gpt</span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">rem åˆ›å»ºefiåˆ†åŒº</span></span><br><span class="line">create partition efi size=<span class="number">100</span></span><br><span class="line"><span class="built_in">format</span> quick <span class="built_in">fs</span>=FAT32</span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">rem åˆ›å»ºmsråˆ†åŒº</span></span><br><span class="line">create partition msr size=<span class="number">16</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">rem åˆ›å»ºRecoveryåˆ†åŒº</span></span><br><span class="line">create partition primary size=<span class="number">1024</span></span><br><span class="line"><span class="built_in">format</span> quick <span class="built_in">fs</span>=ntfs <span class="built_in">label</span>=&quot;Recovery&quot;</span><br><span class="line"><span class="built_in">set</span> id=&quot;de94bba4-<span class="number">06</span>d1-<span class="number">4</span>d40-a16a-bfd50179d6ac&quot;</span><br><span class="line">gpt attributes=<span class="number">0</span>x8000000000000001</span><br></pre></td></tr></table></figure><p>diskpart.bat</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">diskpart /s diskpart_config.txt</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¸¸ç”¨batè„šæœ¬</title>
      <link href="/posts/54c97110/"/>
      <url>/posts/54c97110/</url>
      
        <content type="html"><![CDATA[<p>è¿™ç¯‡æ–‡ç« è¯´çš„éƒ½æ˜¯ç»å¸¸ç”¨åˆ°çš„ bat è„šæœ¬ç¼–å†™å°æŠ€å·§ï¼Œæ¯”å¦‚è·å–ç®¡ç†å‘˜æƒé™ã€æ³¨å†Œè¡¨æ“ä½œã€è¿›ç¨‹æ“ä½œã€æœåŠ¡æ“ä½œç­‰</p><h2 id="è‡ªåŠ¨è¾“å…¥-y"><a href="#è‡ªåŠ¨è¾“å…¥-y" class="headerlink" title="è‡ªåŠ¨è¾“å…¥ y"></a>è‡ªåŠ¨è¾“å…¥ y</h2><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> y|reg delete &quot;HKEY_CLASSES_ROOT\Local Settings\Software\Microsoft\Windows\CurrentVersion\TrayNotify&quot; /v IconStreams</span><br></pre></td></tr></table></figure><h2 id="bat-è„šæœ¬è·å–ç®¡ç†å‘˜æƒé™"><a href="#bat-è„šæœ¬è·å–ç®¡ç†å‘˜æƒé™" class="headerlink" title="bat è„šæœ¬è·å–ç®¡ç†å‘˜æƒé™"></a>bat è„šæœ¬è·å–ç®¡ç†å‘˜æƒé™</h2><p>åœ¨ bat è„šæœ¬æœ€ä¸Šé¢æ·»åŠ ä¸€è¡Œ</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line">%<span class="number">1</span> mshta vbscript:CreateObject(&quot;Shell.Application&quot;).ShellExecute(&quot;<span class="built_in">cmd</span>.exe&quot;,&quot;/c %~s0 ::&quot;,&quot;&quot;,&quot;runas&quot;,<span class="number">1</span>)(window.close)&amp;&amp;<span class="keyword">exit</span></span><br><span class="line"><span class="built_in">cd</span> /d &quot;%~dp0&quot;</span><br></pre></td></tr></table></figure><h2 id="è¾“å‡ºæ§åˆ¶å°ä¸æ¢è¡Œ"><a href="#è¾“å‡ºæ§åˆ¶å°ä¸æ¢è¡Œ" class="headerlink" title="è¾“å‡ºæ§åˆ¶å°ä¸æ¢è¡Œ"></a>è¾“å‡ºæ§åˆ¶å°ä¸æ¢è¡Œ</h2><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span>|<span class="built_in">set</span> /p=&quot;Test&quot;</span><br></pre></td></tr></table></figure><h2 id="æœåŠ¡æ“ä½œ"><a href="#æœåŠ¡æ“ä½œ" class="headerlink" title="æœåŠ¡æ“ä½œ"></a>æœåŠ¡æ“ä½œ</h2><blockquote><p>windows æœåŠ¡æ“ä½œå‘½ä»¤æœ‰ sc å’Œ net ä¸¤ä¸ªå‘½ä»¤;</p></blockquote><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># ä½¿ç”¨scæ“ä½œæœåŠ¡</span><br><span class="line">sc stop serviceName</span><br><span class="line">sc <span class="built_in">start</span> serviceName</span><br><span class="line"></span><br><span class="line"># ä½¿ç”¨<span class="built_in">net</span>æ“ä½œæœåŠ¡</span><br><span class="line"><span class="built_in">net</span> stop serviceName</span><br><span class="line"><span class="built_in">net</span> <span class="built_in">start</span> serviceName</span><br><span class="line"></span><br><span class="line"># sc ä¿®æ”¹æœåŠ¡</span><br><span class="line">sc config AcronisActiveProtectionService <span class="built_in">start</span>= disabled</span><br><span class="line">sc description npc &quot;å†…ç½‘ç©¿é€æœåŠ¡ã€‚&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># sc åˆ›å»ºæœåŠ¡</span><br><span class="line">sc create npc <span class="built_in">start</span>= auto binPath= &quot;C:\<span class="number">1</span>\npc\npc.exe -server=note.iuxt.top:<span class="number">10000</span> -vkey=ibtbrp5e3uc9lonq -<span class="built_in">type</span>=tcp&quot; DisplayName= &quot;npcå†…ç½‘ç©¿é€æœåŠ¡&quot;</span><br></pre></td></tr></table></figure><blockquote><p>è™½ç„¶ 2 ä¸ªéƒ½èƒ½è¾¾åˆ°åœæ­¢æœåŠ¡å’Œå¯åŠ¨æœåŠ¡çš„æ•ˆæœï¼Œä½†æ˜¯åœ¨é‡å¯æœåŠ¡æ—¶ï¼Œå°±æ˜¯ä½¿ç”¨æ‰¹å¤„ç†å…ˆ stop å start æ¥å®ç°é‡å¯æ—¶ï¼Œå¦‚æœæœåŠ¡å¤„äºå¯åŠ¨çŠ¶æ€ä½¿ç”¨ sc çš„ stop å startï¼Œç»“æœæœåŠ¡ä¸èƒ½å¯åŠ¨ï¼Œå› ä¸º sc å‘½ä»¤åœ¨æ‰§è¡Œ stop åä¸ä¼šç­‰å¾…ï¼Œè€Œæ˜¯ç»§ç»­æ‰§è¡Œæ‰¹å¤„ç†ä¸‹é¢çš„è¯­å¥ï¼Œè¿™æ—¶æœåŠ¡æ­£åœ¨å¤„äºåœæ­¢æ“ä½œçŠ¶æ€ï¼Œæ‰€ä»¥ start å‘½ä»¤ä¸èƒ½å¯åŠ¨ã€‚net å‘½ä»¤åœ¨ stop æ—¶ä¼šåœæ­¢ç­‰å¾…ï¼Œåœ¨æœåŠ¡å®Œå…¨åœæ­¢åå†ç»§ç»­æ‰§è¡Œæ‰¹å¤„ç†åé¢çš„è¯­å¥ï¼Œæ‰€ä»¥ net çš„é‡å¯å‘½ä»¤å°±ä¼šæ­£å¸¸ã€‚</p></blockquote><h2 id="è¿›ç¨‹æ“ä½œ"><a href="#è¿›ç¨‹æ“ä½œ" class="headerlink" title="è¿›ç¨‹æ“ä½œ"></a>è¿›ç¨‹æ“ä½œ</h2><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">taskkill</span> /f /im Xshell*</span><br></pre></td></tr></table></figure><h2 id="åˆ é™¤æ³¨å†Œè¡¨"><a href="#åˆ é™¤æ³¨å†Œè¡¨" class="headerlink" title="åˆ é™¤æ³¨å†Œè¡¨"></a>åˆ é™¤æ³¨å†Œè¡¨</h2><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">reg delete &quot;HKCU\Software\Microsoft\NetLicense&quot; /f</span><br><span class="line"></span><br><span class="line">reg add &quot;HKLM\SOFTWARE\Classes\.xdts&quot; /f /ve /d &quot;Xmanager.session&quot; &gt;<span class="built_in">NUL</span> <span class="number">2</span>&gt;<span class="built_in">NUL</span></span><br></pre></td></tr></table></figure><h2 id="åˆ é™¤ç›®å½•"><a href="#åˆ é™¤ç›®å½•" class="headerlink" title="åˆ é™¤ç›®å½•"></a>åˆ é™¤ç›®å½•</h2><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">rd</span>/s/q &quot;<span class="variable">%ProgramData%</span>\FLEXnet&quot; <span class="number">2</span>&gt;<span class="built_in">NUL</span></span><br><span class="line"><span class="built_in">rmdir</span>/s/q &quot;<span class="variable">%CommonProgramFiles%</span>\Macrovision Shared&quot;<span class="number">2</span>&gt;<span class="built_in">NUL</span></span><br></pre></td></tr></table></figure><blockquote><p>rd å°±æ˜¯ rmdir</p></blockquote><h2 id="åˆ¤æ–­æœ‰æ²¡æœ‰ç›®å½•"><a href="#åˆ¤æ–­æœ‰æ²¡æœ‰ç›®å½•" class="headerlink" title="åˆ¤æ–­æœ‰æ²¡æœ‰ç›®å½•"></a>åˆ¤æ–­æœ‰æ²¡æœ‰ç›®å½•</h2><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> <span class="keyword">exist</span> &quot;<span class="variable">%ProgramData%</span>\NetSarang Computer&quot; <span class="built_in">md</span> &quot;<span class="variable">%ProgramData%</span>\NetSarang Computer&quot;</span><br></pre></td></tr></table></figure><h2 id="å¤åˆ¶æ–‡ä»¶"><a href="#å¤åˆ¶æ–‡ä»¶" class="headerlink" title="å¤åˆ¶æ–‡ä»¶"></a>å¤åˆ¶æ–‡ä»¶</h2><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> f|<span class="built_in">xcopy</span> /e/i/c/y &quot;Data\NetSarang Computer&quot; &quot;<span class="variable">%ProgramData%</span>\NetSarang Computer&quot;</span><br></pre></td></tr></table></figure><h2 id="å¸¦ç©ºæ ¼è·¯å¾„çš„å¤„ç†"><a href="#å¸¦ç©ºæ ¼è·¯å¾„çš„å¤„ç†" class="headerlink" title="å¸¦ç©ºæ ¼è·¯å¾„çš„å¤„ç†"></a>å¸¦ç©ºæ ¼è·¯å¾„çš„å¤„ç†</h2><blockquote><p>ç”¨ â€œâ€ å¼•èµ·æ¥ï¼Œä¸æ–¹ä¾¿ç”¨ â€œâ€ çš„å¯ä»¥ç”¨ä¸‹é¢çš„çŸ­åç§°ï¼Œæˆ–è€…ç”¨å˜é‡çš„å½¢å¼è¡¨ç¤º</p></blockquote><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">start</span> C:\Progra~<span class="number">1</span>\Notepad++\notepad++.exe C:\Windows\System32\drivers\etc\hosts</span><br></pre></td></tr></table></figure><h2 id="å°†å­—ç¬¦ä¸²å¤åˆ¶åˆ°å‰ªåˆ‡æ¿"><a href="#å°†å­—ç¬¦ä¸²å¤åˆ¶åˆ°å‰ªåˆ‡æ¿" class="headerlink" title="å°†å­—ç¬¦ä¸²å¤åˆ¶åˆ°å‰ªåˆ‡æ¿"></a>å°†å­—ç¬¦ä¸²å¤åˆ¶åˆ°å‰ªåˆ‡æ¿</h2><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span>|<span class="built_in">set</span> /p=&quot;Test&quot; | clip</span><br></pre></td></tr></table></figure><h2 id="è®¾ç½®ç¯å¢ƒå˜é‡"><a href="#è®¾ç½®ç¯å¢ƒå˜é‡" class="headerlink" title="è®¾ç½®ç¯å¢ƒå˜é‡"></a>è®¾ç½®ç¯å¢ƒå˜é‡</h2><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">:: /M å¢åŠ ç³»ç»Ÿç¯å¢ƒå˜é‡</span><br><span class="line">setx /M MySQL_HOME &quot;C:\mysql&quot;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> bat </tag>
            
            <tag> Script </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¿«é€Ÿæ­å»ºç¯å¢ƒè®°å½•</title>
      <link href="/posts/5e168f7e/"/>
      <url>/posts/5e168f7e/</url>
      
        <content type="html"><![CDATA[<blockquote><p>å¿«é€Ÿæ­å»ºä¸€å¥—ç¯å¢ƒçš„è®°å½•ï¼ŒèŠ‚çœæŠ˜è…¾çš„æ—¶é—´ï¼Œå¯ä»¥é…åˆ <a href="https://github.com/iuxt/quickstart">quickstart</a> é£Ÿç”¨</p></blockquote><h2 id="Python-ç¯å¢ƒ"><a href="#Python-ç¯å¢ƒ" class="headerlink" title="Python ç¯å¢ƒ"></a>Python ç¯å¢ƒ</h2><p>å¯ä»¥ç›´æ¥ä½¿ç”¨ pipenv è¿™ç§å·¥å…·. ä¹Ÿå¯ä»¥è‡ªå·±ç¼–è¯‘å®‰è£…</p><h3 id="å®‰è£…ç¼–è¯‘éœ€è¦çš„ç¯å¢ƒ"><a href="#å®‰è£…ç¼–è¯‘éœ€è¦çš„ç¯å¢ƒ" class="headerlink" title="å®‰è£…ç¼–è¯‘éœ€è¦çš„ç¯å¢ƒ"></a>å®‰è£…ç¼–è¯‘éœ€è¦çš„ç¯å¢ƒ</h3><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">Ubuntuå’ŒDebianå®‰è£…</button><button type="button" class="tab">CentOSå’ŒFedoraå®‰è£…</button></div><div class="tab-contents"><div class="tab-item-content active"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install -y gcc make build-essential libssl-dev zlib1g-dev libbz2-dev libreadline-dev libsqlite3-dev wget curl llvm libncurses5-dev libncursesw5-dev xz-utils tk-dev libffi-dev liblzma-dev</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y gcc make libffi-devel openssl-devel bzip2-devel expat-devel gdbm-devel readline-devel sqlite-devel zlib-devel</span><br><span class="line"><span class="comment"># æ–°ç‰ˆæœ¬çš„RHELå¯èƒ½æ²¡æœ‰gdbm-develè¿™ä¸ªåŒ…äº†</span></span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div><h3 id="ä¸‹è½½æºç å¹¶ç¼–è¯‘"><a href="#ä¸‹è½½æºç å¹¶ç¼–è¯‘" class="headerlink" title="ä¸‹è½½æºç å¹¶ç¼–è¯‘"></a>ä¸‹è½½æºç å¹¶ç¼–è¯‘</h3><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">å®‰è£…åˆ°ç”¨æˆ·ç›®å½•(æ¨è)</button><button type="button" class="tab">å®‰è£…åˆ°ç³»ç»Ÿç›®å½•</button></div><div class="tab-contents"><div class="tab-item-content active"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /tmp/</span><br><span class="line"><span class="built_in">mkdir</span> <span class="variable">$&#123;HOME&#125;</span>/opt/</span><br><span class="line">wget https://www.python.org/ftp/python/3.8.20/Python-3.8.20.tgz</span><br><span class="line">tar xf Python-3.8.20.tgz</span><br><span class="line"><span class="built_in">cd</span> Python-3.8.20</span><br><span class="line">./configure --prefix=<span class="variable">$&#123;HOME&#125;</span>/opt/Python-3.8.20</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure><p>æ·»åŠ åˆ° PATH ç¯å¢ƒå˜é‡ (å¯é€‰)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">tee</span> -a <span class="variable">$&#123;HOME&#125;</span>/.bashrc &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># Python ç¯å¢ƒ</span></span><br><span class="line"><span class="string">export PATH=\$PATH:$&#123;HOME&#125;/opt/Python-3.8.20/bin</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">source</span> <span class="variable">$&#123;HOME&#125;</span>/.bashrc</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /tmp/</span><br><span class="line">wget https://www.python.org/ftp/python/3.8.20/Python-3.8.20.tgz</span><br><span class="line">tar xf Python-3.8.20.tgz</span><br><span class="line"><span class="built_in">cd</span> Python-3.8.20</span><br><span class="line">./configure --prefix=/opt/Python-3.8.20</span><br><span class="line">make</span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure><p>æ·»åŠ åˆ° PATH ç¯å¢ƒå˜é‡ (å¯é€‰)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">tee</span> -a /etc/profile &lt;&lt;-<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Python ç¯å¢ƒ</span></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:/opt/Python-3.8.20/bin</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div><blockquote><p>å¢åŠ  <code>--enable-optimizations</code> å‚æ•°é€Ÿåº¦ç¼–è¯‘é€Ÿåº¦ä¼šéå¸¸æ…¢ï¼Œ ä½†æ˜¯ä¼šä¼˜åŒ– python è¿è¡Œçš„æ€§èƒ½ã€‚</p></blockquote><h3 id="é…ç½®å›½å†…æº"><a href="#é…ç½®å›½å†…æº" class="headerlink" title="é…ç½®å›½å†…æº"></a>é…ç½®å›½å†…æº</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip config <span class="built_in">set</span> global.index-url https://mirrors.ustc.edu.cn/pypi/web/simple</span><br></pre></td></tr></table></figure><h2 id="java-ç¯å¢ƒ"><a href="#java-ç¯å¢ƒ" class="headerlink" title="java ç¯å¢ƒ"></a>java ç¯å¢ƒ</h2><p>å®˜æ–¹ç½‘ç«™ï¼š<a href="https://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html">https://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸‹è½½è§£å‹,åˆ›å»ºè½¯è¿æ¥</span></span><br><span class="line">wget https://file.babudiu.com/f/x2ux/jdk-8u351-linux-x64.tar.gz</span><br><span class="line">tar xf jdk-8u351-linux-x64.tar.gz -C /usr/local/</span><br><span class="line"><span class="built_in">ln</span> -sf /usr/local/jdk1.8.0_351/ /usr/local/java</span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®ç¯å¢ƒå˜é‡</span></span><br><span class="line"><span class="built_in">cat</span> &gt;&gt; /etc/profile &lt;&lt;-<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line"><span class="comment"># JAVAç¯å¢ƒå˜é‡</span></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/local/java</span><br><span class="line"><span class="built_in">export</span> CLASSPATH=<span class="variable">$JAVA_HOME</span>/lib/tools.jar:<span class="variable">$JAVA_HOME</span>/lib/dt.jar:<span class="variable">$JAVA_HOME</span>/lib:.</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$JAVA_HOME</span>/bin</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿å˜é‡ç”Ÿæ•ˆ</span></span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="golang-ç¯å¢ƒ"><a href="#golang-ç¯å¢ƒ" class="headerlink" title="golang ç¯å¢ƒ"></a>golang ç¯å¢ƒ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">wget https://dl.google.com/go/go1.23.1.linux-amd64.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="built_in">rm</span> -rf ~/opt/go &amp;&amp; <span class="built_in">mkdir</span> -p ~/opt/</span><br><span class="line">tar -C ~/opt/ -xzf go1.23.1.linux-amd64.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®ç¯å¢ƒå˜é‡</span></span><br><span class="line"><span class="built_in">tee</span> -a ~/.profile &lt;&lt;-<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># golang ç¯å¢ƒ</span></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:~/opt/go/bin</span><br><span class="line"></span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="built_in">source</span> ~/.profile</span><br></pre></td></tr></table></figure><h2 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h2><h3 id="docker-io"><a href="#docker-io" class="headerlink" title="docker.io"></a>docker.io</h3><p>å¦‚æœä½ ä¸ä»‹æ„ç‰ˆæœ¬é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨å‘è¡Œç‰ˆæºé‡Œçš„ <code>docker.io</code> ï¼Œå®‰è£…å¾ˆç®€å•ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Ubuntu</span></span><br><span class="line">sudo apt install docker.io</span><br><span class="line"></span><br><span class="line"><span class="comment"># CentOS</span></span><br><span class="line">sudo yum install docker.io</span><br></pre></td></tr></table></figure><h3 id="Docker-CE"><a href="#Docker-CE" class="headerlink" title="Docker-CE"></a>Docker-CE</h3><p>Docker-CE æ˜¯å®˜æ–¹ç¤¾åŒºç‰ˆï¼Œä¸€èˆ¬æ›´æ–°æ¯”è¾ƒåŠæ—¶ <a href="https://docs.docker.com/engine/install/centos/">å®˜æ–¹å®‰è£…æ–‡æ¡£</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">curl -fsSL get.docker.com | bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹ä¸€äº›é…ç½®</span></span><br><span class="line">sudo <span class="built_in">mkdir</span> -p /etc/docker &amp;&amp; sudo <span class="built_in">tee</span> /etc/docker/daemon.json &lt;&lt;-<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;exec-opts&quot;</span>: [<span class="string">&quot;native.cgroupdriver=systemd&quot;</span>],</span><br><span class="line">  <span class="string">&quot;log-driver&quot;</span>: <span class="string">&quot;json-file&quot;</span>,</span><br><span class="line">  <span class="string">&quot;log-opts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;max-size&quot;</span>: <span class="string">&quot;100m&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;storage-driver&quot;</span>: <span class="string">&quot;overlay2&quot;</span>,</span><br><span class="line">  <span class="string">&quot;registry-mirrors&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;https://hub-mirror.c.163.com&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://mirror.baidubce.com&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://go38p9zi.mirror.aliyuncs.com&quot;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># å½“å‰ç”¨æˆ·æ‰§è¡Œdockerå‘½ä»¤ï¼Œéœ€è¦æ³¨é”€ç”¨æˆ·</span></span><br><span class="line">sudo usermod -aG docker <span class="variable">$USER</span></span><br></pre></td></tr></table></figure><h2 id="nodejs"><a href="#nodejs" class="headerlink" title="nodejs"></a>nodejs</h2><p>æˆ‘ä¸ªäººæ›´å»ºè®®æŠŠ nodejs å®‰è£…åœ¨ Home ç›®å½•ä¸‹, åŸå› å¦‚ä¸‹:</p><ol><li>ç¯å¢ƒéš”ç¦», Linux å¦‚æœæœ‰å¤šä¸ªç”¨æˆ·, ä¸ä¼šå½±å“åˆ°å…¶ä»–ç”¨æˆ·çš„ç¯å¢ƒ</li><li>å®‰è£…åŒ…ä¸éœ€è¦ä½¿ç”¨ root æƒé™, ä¹Ÿä¸ä¼šæœ‰ä¸€äº›å¥‡å¥‡æ€ªæ€ªçš„æƒé™é—®é¢˜</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®¾ç½®å®‰è£…çš„ç‰ˆæœ¬</span></span><br><span class="line"><span class="built_in">export</span> NODE_VERSION=<span class="string">&quot;v20.17.0&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸‹è½½å®‰è£…åŒ…</span></span><br><span class="line">wget <span class="string">&quot;https://npmmirror.com/mirrors/node/<span class="variable">$&#123;NODE_VERSION&#125;</span>/node-<span class="variable">$&#123;NODE_VERSION&#125;</span>-linux-x64.tar.xz&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºç›®å½•</span></span><br><span class="line"><span class="built_in">mkdir</span> ~/opt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># è§£å‹</span></span><br><span class="line">tar xf <span class="string">&quot;node-<span class="variable">$&#123;NODE_VERSION&#125;</span>-linux-x64.tar.xz&quot;</span> -C ~/opt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ åˆ°PATHç¯å¢ƒå˜é‡</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;export PATH=\$PATH:/home/iuxt/opt/node-<span class="variable">$&#123;NODE_VERSION&#125;</span>-linux-x64/bin&quot;</span> &gt;&gt; ~/.profile</span><br></pre></td></tr></table></figure><h3 id="å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥"><a href="#å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥" class="headerlink" title="å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥"></a>å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥</h3><table><thead><tr><th>ä½œç”¨</th><th>å‘½ä»¤</th></tr></thead><tbody><tr><td>æŸ¥çœ‹å¯æ‰§è¡Œæ–‡ä»¶çš„ä½ç½®</td><td><code>npm bin</code></td></tr><tr><td>æŸ¥çœ‹å…¨å±€åŒ…çš„ä½ç½®</td><td><code>npm bin --location=global</code></td></tr><tr><td>å®‰è£…æŒ‡å®šåŒ…åˆ°.&#x2F;node_modules</td><td><code>npm i xxx</code></td></tr><tr><td>å®‰è£…æŒ‡å®šåŒ…åˆ°.&#x2F;node_modules å¹¶è®°å½•åœ¨ package.json æ–‡ä»¶ä¸­</td><td><code>npm i xxx --save</code></td></tr><tr><td>å…¨å±€å®‰è£…åŒ…</td><td><code>npm i xxx -g</code> æˆ–è€… <code>npm i xxx --location=global</code> (æ–°ç‰ˆ nodejs)</td></tr><tr><td>å®‰è£… package.json ä¸­å®šä¹‰çš„åŒ…</td><td><code>npm i</code></td></tr><tr><td>æ›´æ¢æº</td><td><code>npm config set registry https://registry.npmmirror.com</code></td></tr><tr><td>æŸ¥çœ‹æº</td><td><code>npm get registry</code></td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
            <tag> Linux </tag>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>selenium--webè‡ªåŠ¨åŒ–å·¥å…·</title>
      <link href="/posts/7a4b3586/"/>
      <url>/posts/7a4b3586/</url>
      
        <content type="html"><![CDATA[<blockquote><p>selenium æ˜¯ä¸€ä¸ª web è‡ªåŠ¨åŒ–å·¥å…·ï¼Œå®ƒå¯ä»¥æ§åˆ¶ chrome æµè§ˆå™¨å®ç°æˆ‘ä»¬æƒ³è¦çš„åŠŸèƒ½ï¼Œè·Ÿçˆ¬è™«ä¸åŒçš„æ˜¯ï¼šå®ƒæ˜¯æ¨¡æ‹Ÿäººç±»çš„æ“ä½œã€‚</p></blockquote><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><h3 id="ä¸‹è½½å¯¹åº”ç‰ˆæœ¬çš„-chromedriver"><a href="#ä¸‹è½½å¯¹åº”ç‰ˆæœ¬çš„-chromedriver" class="headerlink" title="ä¸‹è½½å¯¹åº”ç‰ˆæœ¬çš„ chromedriver"></a>ä¸‹è½½å¯¹åº”ç‰ˆæœ¬çš„ chromedriver</h3><p><a href="https://chromedriver.chromium.org/downloads">https://chromedriver.chromium.org/downloads</a>æ”¾åˆ° PATH ç¯å¢ƒå˜é‡é‡Œï¼Œ å¦‚æœæ˜¯ macï¼Œå¯ä»¥ç›´æ¥æ‰§è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install chromedriver</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…-python-åŒ…"><a href="#å®‰è£…-python-åŒ…" class="headerlink" title="å®‰è£… python åŒ…"></a>å®‰è£… python åŒ…</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install selenium -i https://pypi.tuna.tsinghua.edu.cn/simple</span><br></pre></td></tr></table></figure><h2 id="ç¼–å†™è„šæœ¬"><a href="#ç¼–å†™è„šæœ¬" class="headerlink" title="ç¼–å†™è„šæœ¬"></a>ç¼–å†™è„šæœ¬</h2><h3 id="è·å–-xpath"><a href="#è·å–-xpath" class="headerlink" title="è·å– xpath"></a>è·å– xpath</h3><p>è·å– xpath å¯ä»¥æŒ‰ä¸‹ <code>ctrl + shift + c</code> ç‚¹å‡»æŒ‰é’®ï¼Œ é«˜äº®çš„åœ°æ–¹å³é”®å¤åˆ¶ full xpath</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202211251607799.png" alt="è·å–XPATHå±æ€§"></p><h3 id="è·å–-id"><a href="#è·å–-id" class="headerlink" title="è·å– id"></a>è·å– id</h3><p>Charome æµè§ˆå™¨ç•Œé¢æŒ‰ä¸‹ <code>ctrl + shift + c</code> ç‚¹å‡»é¡µé¢, å³è¾¹å±æ€§è®°å½•ä¸€ä¸‹ html çš„ id å±æ€§</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202211251604573.png" alt="è·å–idå±æ€§"></p><h3 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¨¡æ‹Ÿæµè§ˆå™¨æ‰“å¼€åˆ°giteeç™»å½•ç•Œé¢</span></span><br><span class="line">driver = webdriver.Chrome()</span><br><span class="line">driver.get(<span class="string">&#x27;https://gitee.com/login&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†çª—å£æœ€å¤§åŒ–</span></span><br><span class="line">driver.maximize_window()</span><br><span class="line"></span><br><span class="line"><span class="comment"># é€šè¿‡htmlçš„idå±æ€§å®šä½è¾“å…¥ä½ç½®, ç„¶åè¾“å…¥æ–‡æœ¬</span></span><br><span class="line">driver.find_element(By.ID, <span class="string">r&#x27;user_login&#x27;</span>).send_keys(<span class="string">&quot;è¿™é‡Œå†™ä½ çš„ç”¨æˆ·å&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># é€šè¿‡xpathæŸ¥æ‰¾ä½ç½®, ç„¶åç‚¹å‡»é¼ æ ‡</span></span><br><span class="line">driver.find_element(By.XPATH, <span class="string">r&#x27;/html/body/div[2]/div[1]/div[2]/div/div/div[1]/div[2]/div/div/div[2]/div/div/div/form/div[5]/button&#x27;</span>).click()</span><br><span class="line"></span><br><span class="line"><span class="comment"># é€€å‡ºæµè§ˆå™¨</span></span><br><span class="line">driver.quit()</span><br></pre></td></tr></table></figure><h2 id="å¸¸ç”¨æ“ä½œ"><a href="#å¸¸ç”¨æ“ä½œ" class="headerlink" title="å¸¸ç”¨æ“ä½œ"></a>å¸¸ç”¨æ“ä½œ</h2><h3 id="æµè§ˆå™¨-options-å‚æ•°"><a href="#æµè§ˆå™¨-options-å‚æ•°" class="headerlink" title="æµè§ˆå™¨ options å‚æ•°"></a>æµè§ˆå™¨ options å‚æ•°</h3><p>æ–°ç‰ˆæœ¬ <code>webdriver.Chrome</code> å·²ç»æ²¡æœ‰ <code>chromeoptions</code> è¿™ä¸ªå‚æ•°äº†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</span><br><span class="line"></span><br><span class="line">options = webdriver.ChromeOptions()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æµè§ˆå™¨ä¸è‡ªåŠ¨é€€å‡ºã€‚</span></span><br><span class="line">options.add_experimental_option(<span class="string">&quot;detach&quot;</span>, <span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># éšè—æµè§ˆå™¨ç•Œé¢</span></span><br><span class="line">options.add_argument(<span class="string">&#x27;--headless&#x27;</span>)</span><br><span class="line">options.add_argument(<span class="string">&#x27;--disable-gpu&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># é˜²æ­¢æ£€æµ‹, åŒæ—¶æµè§ˆå™¨ä¸ä¼šæœ‰å—åˆ°è‡ªåŠ¨åŒ–æµ‹è¯•è½¯ä»¶æ§åˆ¶çš„æç¤º</span></span><br><span class="line">options.add_experimental_option(<span class="string">&#x27;excludeSwitches&#x27;</span>, [<span class="string">&#x27;enable-automation&#x27;</span>])</span><br><span class="line">options.add_argument(<span class="string">&#x27;--disable-blink-features=AutomationControlled&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">driver = webdriver.Chrome(options=options)</span><br><span class="line"></span><br><span class="line"><span class="comment"># é˜²æ­¢é˜¿é‡Œäº‘ç›‘æµ‹</span></span><br><span class="line">driver.execute_cdp_cmd(<span class="string">&quot;Page.addScriptToEvaluateOnNewDocument&quot;</span>, &#123;</span><br><span class="line">  <span class="string">&quot;source&quot;</span>: <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Object.defineProperty(navigator, &#x27;webdriver&#x27;, &#123;</span></span><br><span class="line"><span class="string">      get: () =&gt; undefined</span></span><br><span class="line"><span class="string">    &#125;)</span></span><br><span class="line"><span class="string">  &quot;&quot;&quot;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">driver.get(<span class="string">&#x27;https://signin.aliyun.com/login.htm#/main&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="æˆªå›¾"><a href="#æˆªå›¾" class="headerlink" title="æˆªå›¾"></a>æˆªå›¾</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.get_screenshot_as_file(<span class="string">&quot;test.png&quot;</span>)</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨ä»£ç†"><a href="#ä½¿ç”¨ä»£ç†" class="headerlink" title="ä½¿ç”¨ä»£ç†"></a>ä½¿ç”¨ä»£ç†</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver <span class="keyword">import</span> ChromeOptions</span><br><span class="line"></span><br><span class="line">options = webdriver.ChromeOptions()</span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®ä»£ç†åœ°å€</span></span><br><span class="line">options.add_argument(<span class="string">&#x27;--proxy-server=http://localhost:80&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸æç¤ºè¯ä¹¦é”™è¯¯</span></span><br><span class="line">options.add_argument(<span class="string">&quot;--ignore-certificate-errors&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®©æµè§ˆå™¨ä¸ä¼šè‡ªåŠ¨é€€å‡º</span></span><br><span class="line">options.add_experimental_option(<span class="string">&quot;detach&quot;</span>, <span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">driver = webdriver.Chrome(options=options)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Automatic </tag>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxå¸¸ç”¨å‘½ä»¤ä¹‹sed</title>
      <link href="/posts/83cbdb25/"/>
      <url>/posts/83cbdb25/</url>
      
        <content type="html"><![CDATA[<h2 id="å‚æ•°è¯´æ˜"><a href="#å‚æ•°è¯´æ˜" class="headerlink" title="å‚æ•°è¯´æ˜"></a>å‚æ•°è¯´æ˜</h2><blockquote><p>-e &lt; script &gt;æˆ– â€“expression&#x3D;&lt; script &gt; ä»¥é€‰é¡¹ä¸­æŒ‡å®šçš„ script æ¥å¤„ç†è¾“å…¥çš„æ–‡æœ¬æ–‡ä»¶ã€‚<br>-f &lt;script æ–‡ä»¶&gt;æˆ– â€“file&#x3D;&lt;script æ–‡ä»¶&gt; ä»¥é€‰é¡¹ä¸­æŒ‡å®šçš„ script æ–‡ä»¶æ¥å¤„ç†è¾“å…¥çš„æ–‡æœ¬æ–‡ä»¶ã€‚<br>-h æˆ– â€“help æ˜¾ç¤ºå¸®åŠ©ã€‚<br>-n æˆ– â€“quiet æˆ– â€“silent ä»…æ˜¾ç¤º script å¤„ç†åçš„ç»“æœã€‚<br>-V æˆ– â€“version æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯ã€‚<br>-i ç›´æ¥ä¿®æ”¹æ–‡ä»¶å†…å®¹</p></blockquote><h2 id="åŠ¨ä½œè¯´æ˜"><a href="#åŠ¨ä½œè¯´æ˜" class="headerlink" title="åŠ¨ä½œè¯´æ˜"></a>åŠ¨ä½œè¯´æ˜</h2><blockquote><p>a ï¼šæ–°å¢ï¼Œ a çš„åé¢å¯ä»¥æ¥å­—ä¸²ï¼Œè€Œè¿™äº›å­—ä¸²ä¼šåœ¨æ–°çš„ä¸€è¡Œå‡ºç° (ç›®å‰çš„ä¸‹ä¸€è¡Œ)ï½<br>c ï¼šå–ä»£ï¼Œ c çš„åé¢å¯ä»¥æ¥å­—ä¸²ï¼Œè¿™äº›å­—ä¸²å¯ä»¥å–ä»£ n1,n2 ä¹‹é—´çš„è¡Œï¼<br>d ï¼šåˆ é™¤ï¼Œå› ä¸ºæ˜¯åˆ é™¤å•Šï¼Œæ‰€ä»¥ d åé¢é€šå¸¸ä¸æ¥ä»»ä½•å’šå’šï¼›<br>i ï¼šæ’å…¥ï¼Œ i çš„åé¢å¯ä»¥æ¥å­—ä¸²ï¼Œè€Œè¿™äº›å­—ä¸²ä¼šåœ¨æ–°çš„ä¸€è¡Œå‡ºç° (ç›®å‰çš„ä¸Šä¸€è¡Œ)ï¼›<br>p ï¼šæ‰“å°ï¼Œäº¦å³å°†æŸä¸ªé€‰æ‹©çš„æ•°æ®å°å‡ºã€‚é€šå¸¸ p ä¼šä¸å‚æ•° sed -n ä¸€èµ·è¿è¡Œï½<br>s ï¼šå–ä»£ï¼Œå¯ä»¥ç›´æ¥è¿›è¡Œå–ä»£çš„å·¥ä½œå“©ï¼é€šå¸¸è¿™ä¸ª s çš„åŠ¨ä½œå¯ä»¥æ­é…æ­£è§„è¡¨ç¤ºæ³•ï¼ä¾‹å¦‚ 1,20s&#x2F;old&#x2F;new&#x2F;g å°±æ˜¯å•¦ï¼</p></blockquote><h2 id="ä¸€äº›ä¾‹å­"><a href="#ä¸€äº›ä¾‹å­" class="headerlink" title="ä¸€äº›ä¾‹å­"></a>ä¸€äº›ä¾‹å­</h2><h3 id="æ‰“å°ä¸¤ä¸ªå­—ç¬¦ä¹‹é—´çš„æ‰€æœ‰è¡Œ"><a href="#æ‰“å°ä¸¤ä¸ªå­—ç¬¦ä¹‹é—´çš„æ‰€æœ‰è¡Œ" class="headerlink" title="æ‰“å°ä¸¤ä¸ªå­—ç¬¦ä¹‹é—´çš„æ‰€æœ‰è¡Œ"></a>æ‰“å°ä¸¤ä¸ªå­—ç¬¦ä¹‹é—´çš„æ‰€æœ‰è¡Œ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -n <span class="string">&#x27;/-----BEGIN RSA PRIVATE KEY-----/,/-----END RSA PRIVATE KEY-----/p&#x27;</span> ~/.ssh/id_rsa</span><br></pre></td></tr></table></figure><h3 id="åœ¨æŒ‡å®šä½ç½®æ’å…¥è¡Œ"><a href="#åœ¨æŒ‡å®šä½ç½®æ’å…¥è¡Œ" class="headerlink" title="åœ¨æŒ‡å®šä½ç½®æ’å…¥è¡Œ"></a>åœ¨æŒ‡å®šä½ç½®æ’å…¥è¡Œ</h3><table><thead><tr><th>è¯´æ˜</th><th>å‘½ä»¤</th></tr></thead><tbody><tr><td>åœ¨ç¬¬äºŒè¡Œåé¢æ’å…¥ï¼Œä¹Ÿå°±æ˜¯ xxxx åœ¨ç¬¬ä¸‰è¡Œ</td><td>sed â€˜2a xxxxâ€™ a.txt</td></tr><tr><td>åœ¨ç¬¬äºŒè¡Œå‰é¢æ’å…¥ï¼Œä¹Ÿå°±æ˜¯ xxxx åœ¨ç¬¬äºŒè¡Œ</td><td>sed â€˜2i xxxxâ€™ a.txt</td></tr><tr><td>åœ¨ç¬¬äºŒå’Œç¬¬å››è¡Œåé¢æ’å…¥ï¼Œä¹Ÿå°±æ˜¯ xxxx åœ¨ç¬¬ 3 å’Œç¬¬ 5 è¡Œ</td><td>sed â€˜2,4a xxxxâ€™ a.txt</td></tr><tr><td>è·Ÿä¸Šé¢æœ‰æ‰€ä¸åŒï¼Œxxxx åœ¨ç¬¬ 3 è¡Œå’Œç¬¬ 6 è¡Œ</td><td>sed -e â€˜2a xxxxâ€™ -e â€˜4a xxxxâ€™ a.txt</td></tr><tr><td>è¡Œé¦–æ·»åŠ ä¸€è¡Œï¼Œxxxx åœ¨ç¬¬ä¸€è¡Œ</td><td>sed â€˜1i xxxxâ€™ a.txt</td></tr><tr><td>è¡Œå°¾æ·»åŠ ä¸€è¡Œï¼Œxxxx åœ¨æœ€åä¸€è¡Œ</td><td>sed â€˜$a xxxxâ€™ a.txt</td></tr><tr><td>åœ¨å¥‡æ•°è¡Œåæ·»åŠ ä¸€è¡Œ</td><td>sed â€˜1~2a xxxxâ€™ a.txt</td></tr><tr><td>åœ¨å¶æ•°è¡Œåæ·»åŠ ä¸€è¡Œ</td><td>sed â€˜2~2a xxxxâ€™ a.txt</td></tr><tr><td>åœ¨åŒ¹é…åˆ°çš„è¡Œåæ·»åŠ ä¸€è¡Œ</td><td>sed â€˜&#x2F;^hello&#x2F;a xxxxâ€™ a.txt</td></tr></tbody></table><h3 id="æŸ¥çœ‹-400-500-è¡Œçš„å†…å®¹"><a href="#æŸ¥çœ‹-400-500-è¡Œçš„å†…å®¹" class="headerlink" title="æŸ¥çœ‹ 400-500 è¡Œçš„å†…å®¹"></a>æŸ¥çœ‹ 400-500 è¡Œçš„å†…å®¹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed  -n  <span class="string">&#x27;400,500p&#x27;</span>  fileæ–‡ä»¶å</span><br></pre></td></tr></table></figure><blockquote><p>^è¡¨ç¤ºè¡Œé¦–<br>  $ è¡¨ç¤ºè¡Œå°¾<br>  &amp;è¡¨ç¤ºä¸€æ•´è¡Œ</p></blockquote><h3 id="åˆ é™¤ä¸€ä¸ªæ–‡ä»¶ä¸­è¡Œå·ä¸ºå¥‡æ•°çš„è¡Œ"><a href="#åˆ é™¤ä¸€ä¸ªæ–‡ä»¶ä¸­è¡Œå·ä¸ºå¥‡æ•°çš„è¡Œ" class="headerlink" title="åˆ é™¤ä¸€ä¸ªæ–‡ä»¶ä¸­è¡Œå·ä¸ºå¥‡æ•°çš„è¡Œ"></a>åˆ é™¤ä¸€ä¸ªæ–‡ä»¶ä¸­è¡Œå·ä¸ºå¥‡æ•°çš„è¡Œ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;1~2&#x27;</span>d  file</span><br></pre></td></tr></table></figure><h3 id="åˆ é™¤ä¸€ä¸ªæ–‡ä»¶ä¸­æŒ‡å®šè¡Œ"><a href="#åˆ é™¤ä¸€ä¸ªæ–‡ä»¶ä¸­æŒ‡å®šè¡Œ" class="headerlink" title="åˆ é™¤ä¸€ä¸ªæ–‡ä»¶ä¸­æŒ‡å®šè¡Œ"></a>åˆ é™¤ä¸€ä¸ªæ–‡ä»¶ä¸­æŒ‡å®šè¡Œ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ é™¤ç¬¬ä¸€è¡Œ</span></span><br><span class="line">sed -i <span class="string">&#x27;1d&#x27;</span> filename</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤300å’Œ400è¡Œ</span></span><br><span class="line">sed -i <span class="string">&#x27;300,400&#x27;</span>d file</span><br></pre></td></tr></table></figure><h3 id="åœ¨-testfile-æ–‡ä»¶çš„ç¬¬å››è¡Œåæ·»åŠ ä¸€è¡Œï¼Œå¹¶å°†ç»“æœè¾“å‡ºåˆ°æ ‡å‡†è¾“å‡º"><a href="#åœ¨-testfile-æ–‡ä»¶çš„ç¬¬å››è¡Œåæ·»åŠ ä¸€è¡Œï¼Œå¹¶å°†ç»“æœè¾“å‡ºåˆ°æ ‡å‡†è¾“å‡º" class="headerlink" title="åœ¨ testfile æ–‡ä»¶çš„ç¬¬å››è¡Œåæ·»åŠ ä¸€è¡Œï¼Œå¹¶å°†ç»“æœè¾“å‡ºåˆ°æ ‡å‡†è¾“å‡º"></a>åœ¨ testfile æ–‡ä»¶çš„ç¬¬å››è¡Œåæ·»åŠ ä¸€è¡Œï¼Œå¹¶å°†ç»“æœè¾“å‡ºåˆ°æ ‡å‡†è¾“å‡º</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -e 4a\newLine testfile</span><br></pre></td></tr></table></figure><h3 id="åˆ é™¤ç©ºè¡Œ"><a href="#åˆ é™¤ç©ºè¡Œ" class="headerlink" title="åˆ é™¤ç©ºè¡Œ"></a>åˆ é™¤ç©ºè¡Œ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;/^$/d&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="åˆ é™¤æŒ‡å®šçš„å­—ç¬¦"><a href="#åˆ é™¤æŒ‡å®šçš„å­—ç¬¦" class="headerlink" title="åˆ é™¤æŒ‡å®šçš„å­—ç¬¦"></a>åˆ é™¤æŒ‡å®šçš„å­—ç¬¦</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&#123;abc&#125;:\&quot;&quot;</span> | sed <span class="string">&#x27;s/[&#123;&#125;&quot;:]//g&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="sed-æ›¿æ¢-å­—ç¬¦ä¸²"><a href="#sed-æ›¿æ¢-å­—ç¬¦ä¸²" class="headerlink" title="sed æ›¿æ¢ å­—ç¬¦ä¸²"></a>sed æ›¿æ¢ å­—ç¬¦ä¸²</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git_url=$(<span class="built_in">echo</span> <span class="variable">$4</span> | sed <span class="string">&#x27;s/http/https/&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="å°†æŸä¸€è¡ŒåŠ æ³¨é‡Š"><a href="#å°†æŸä¸€è¡ŒåŠ æ³¨é‡Š" class="headerlink" title="å°†æŸä¸€è¡ŒåŠ æ³¨é‡Š"></a>å°†æŸä¸€è¡ŒåŠ æ³¨é‡Š</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;s/^nameserver/#&amp;/&#x27;</span> /etc/resolv.conf</span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹é…ç½®"><a href="#ä¿®æ”¹é…ç½®" class="headerlink" title="ä¿®æ”¹é…ç½®"></a>ä¿®æ”¹é…ç½®</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i <span class="string">&quot;s/aaa=.*/aaa=123456/g&quot;</span> config.ini</span><br></pre></td></tr></table></figure><h3 id="åˆ é™¤ç©ºæ ¼"><a href="#åˆ é™¤ç©ºæ ¼" class="headerlink" title="åˆ é™¤ç©ºæ ¼"></a>åˆ é™¤ç©ºæ ¼</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;   12 345   &#x27;</span> | sed <span class="string">&#x27;s/ //g&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="æ›¿æ¢æ–‡ä»¶é‡Œé¢çš„å†…å®¹"><a href="#æ›¿æ¢æ–‡ä»¶é‡Œé¢çš„å†…å®¹" class="headerlink" title="æ›¿æ¢æ–‡ä»¶é‡Œé¢çš„å†…å®¹"></a>æ›¿æ¢æ–‡ä»¶é‡Œé¢çš„å†…å®¹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sed -i <span class="string">&quot;s/archive.ubuntu.com/mirrors.aliyun.com/g&quot;</span> /etc/apt/sources.list</span><br><span class="line"><span class="comment"># å¦‚æœè¦æ›¿æ¢çš„æ–‡æœ¬é‡Œå«æœ‰/å¯ä»¥æ¢æˆ#ã€@</span></span><br><span class="line">sed -i <span class="string">&quot;s#security.ubuntu.com#mirrors.aliyun.com#g&quot;</span> /etc/apt/sources.list</span><br></pre></td></tr></table></figure><h2 id="å¤šæ¬¡æ›¿æ¢æ–‡æœ¬"><a href="#å¤šæ¬¡æ›¿æ¢æ–‡æœ¬" class="headerlink" title="å¤šæ¬¡æ›¿æ¢æ–‡æœ¬"></a>å¤šæ¬¡æ›¿æ¢æ–‡æœ¬</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sed -i xxx.txt \</span><br><span class="line">    -e <span class="string">&#x27;s/111/222/g&#x27;</span> \</span><br><span class="line">    -e <span class="string">&#x27;s/333/444/g&#x27;</span></span><br></pre></td></tr></table></figure><p>å°† 111 æ›¿æ¢æˆ 222ï¼Œ333 æ›¿æ¢æˆ 444</p>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Command </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¸¸ç”¨shellç»„åˆå‘½ä»¤</title>
      <link href="/posts/90ca4905/"/>
      <url>/posts/90ca4905/</url>
      
        <content type="html"><![CDATA[<h2 id="å¾ªç¯éå†"><a href="#å¾ªç¯éå†" class="headerlink" title="å¾ªç¯éå†"></a>å¾ªç¯éå†</h2><h3 id="1-3-è¿™ç§æ ¼å¼"><a href="#1-3-è¿™ç§æ ¼å¼" class="headerlink" title="{1..3} è¿™ç§æ ¼å¼"></a>{1..3} è¿™ç§æ ¼å¼</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># i å–å€¼ä¸º1 2 3</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..3&#125;; <span class="keyword">do</span> <span class="built_in">echo</span> 192.168.1.1<span class="variable">$i</span> ; <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># i å–å€¼ä¸º 1 3 5 7 9</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..9..2&#125; ; <span class="keyword">do</span> <span class="built_in">echo</span> <span class="variable">$i</span> ; <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰¹é‡åˆ é™¤æ–‡ä»¶ï¼Œç›¸å½“äºæ’åˆ—ç»„åˆ</span></span><br><span class="line"><span class="built_in">rm</span> -rf redis-&#123;1..6&#125;/&#123;appendonly.aof,nodes.conf,nohup.out&#125;</span><br></pre></td></tr></table></figure><h3 id="seq"><a href="#seq" class="headerlink" title="seq"></a>seq</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># i çš„å–å€¼æ˜¯ 1 3 5 7 9, 1å¼€å§‹9ç»“æŸï¼Œ2æ˜¯æ­¥è¿›</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(<span class="built_in">seq</span> 1 2 9) ; <span class="keyword">do</span> <span class="built_in">echo</span> <span class="variable">$i</span> ; <span class="keyword">done</span></span><br></pre></td></tr></table></figure><h3 id="for-å¾ªç¯"><a href="#for-å¾ªç¯" class="headerlink" title="for å¾ªç¯"></a>for å¾ªç¯</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ((i=<span class="number">1</span>;i&lt;=<span class="number">10</span>;i++))</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$i</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><h3 id="while-å¾ªç¯"><a href="#while-å¾ªç¯" class="headerlink" title="while å¾ªç¯"></a>while å¾ªç¯</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ­»å¾ªç¯</span></span><br><span class="line">i=0</span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$i</span>: <span class="subst">$(date)</span>&quot;</span></span><br><span class="line">  i=$((i+<span class="number">1</span>))</span><br><span class="line">  <span class="built_in">sleep</span> 1</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><h3 id="éå†åˆ—è¡¨"><a href="#éå†åˆ—è¡¨" class="headerlink" title="éå†åˆ—è¡¨"></a>éå†åˆ—è¡¨</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">list=(</span><br><span class="line">10.66.99.204</span><br><span class="line">10.66.230.25</span><br><span class="line">10.66.219.220</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$&#123;list[@]&#125;</span>&quot;</span>;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$i</span></span><br><span class="line">    <span class="keyword">if</span> [ $(iptables -L|grep -v grep|grep <span class="variable">$i</span>|<span class="built_in">wc</span> -l) -eq 0 ];<span class="keyword">then</span></span><br><span class="line">      iptables -I OUTPUT -d <span class="variable">$i</span> -j DROP</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><blockquote><p>è¿™ä¸ª list ä¹Ÿå¯ä»¥å†™æˆ <code>list=(a b c)</code> è¿™ç§å½¢å¼</p></blockquote><h3 id="éå†æ¢è¡Œå­—ç¬¦ä¸²"><a href="#éå†æ¢è¡Œå­—ç¬¦ä¸²" class="headerlink" title="éå†æ¢è¡Œå­—ç¬¦ä¸²"></a>éå†æ¢è¡Œå­—ç¬¦ä¸²</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">images=<span class="string">&quot;</span></span><br><span class="line"><span class="string">nginx:latest</span></span><br><span class="line"><span class="string">mysql:5.7</span></span><br><span class="line"><span class="string">&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> image <span class="keyword">in</span> <span class="variable">$images</span>;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;image= <span class="variable">$&#123;image&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><h2 id="æ¡ä»¶åˆ¤æ–­"><a href="#æ¡ä»¶åˆ¤æ–­" class="headerlink" title="æ¡ä»¶åˆ¤æ–­"></a>æ¡ä»¶åˆ¤æ–­</h2><p><a href="/posts/le2ugemu/">shellæ¡ä»¶åˆ¤æ–­</a></p><h2 id="è„šæœ¬é‡Œçš„äº¤äº’å‘½ä»¤"><a href="#è„šæœ¬é‡Œçš„äº¤äº’å‘½ä»¤" class="headerlink" title="è„šæœ¬é‡Œçš„äº¤äº’å‘½ä»¤"></a>è„šæœ¬é‡Œçš„äº¤äº’å‘½ä»¤</h2><h3 id="ä¿®æ”¹å¯†ç "><a href="#ä¿®æ”¹å¯†ç " class="headerlink" title="ä¿®æ”¹å¯†ç "></a>ä¿®æ”¹å¯†ç </h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line">passwd ubuntu&lt;&lt;-<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">ubuntu</span><br><span class="line">ubuntu</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h3 id="è‡ªåŠ¨æ‰§è¡Œ-fdisk"><a href="#è‡ªåŠ¨æ‰§è¡Œ-fdisk" class="headerlink" title="è‡ªåŠ¨æ‰§è¡Œ fdisk"></a>è‡ªåŠ¨æ‰§è¡Œ fdisk</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;n</span></span><br><span class="line"><span class="string">p</span></span><br><span class="line"><span class="string">1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">w</span></span><br><span class="line"><span class="string">&quot;</span> | fdisk /dev/vdb &amp;&amp; mkfs.ext4 /dev/vdb1</span><br></pre></td></tr></table></figure><h2 id="åˆ é™¤æ–‡ä»¶"><a href="#åˆ é™¤æ–‡ä»¶" class="headerlink" title="åˆ é™¤æ–‡ä»¶"></a>åˆ é™¤æ–‡ä»¶</h2><h3 id="åªä¿ç•™æœ€è¿‘-20-ä¸ª-jar-ç‰ˆæœ¬"><a href="#åªä¿ç•™æœ€è¿‘-20-ä¸ª-jar-ç‰ˆæœ¬" class="headerlink" title="åªä¿ç•™æœ€è¿‘ 20 ä¸ª jar ç‰ˆæœ¬"></a>åªä¿ç•™æœ€è¿‘ 20 ä¸ª jar ç‰ˆæœ¬</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> -t *.jar | awk <span class="string">&#x27;NR&gt;20&#x27;</span> | xargs <span class="built_in">rm</span> -f</span><br></pre></td></tr></table></figure><h2 id="å†™å…¥æ–‡ä»¶"><a href="#å†™å…¥æ–‡ä»¶" class="headerlink" title="å†™å…¥æ–‡ä»¶"></a>å†™å…¥æ–‡ä»¶</h2><h3 id="ä¸å¤„ç†å˜é‡"><a href="#ä¸å¤„ç†å˜é‡" class="headerlink" title="ä¸å¤„ç†å˜é‡"></a>ä¸å¤„ç†å˜é‡</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿™é‡Œçš„EOFåŠ ä¸Šäº†å•å¼•å·ï¼Œä¸å¯¹å˜é‡è¿›è¡Œå¤„ç†</span></span><br><span class="line"><span class="built_in">cat</span> &gt; filename.txt &lt;&lt;-<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">hello</span><br><span class="line">world</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h3 id="è¿™æ ·çš„å¯ä»¥å¤„ç†å˜é‡"><a href="#è¿™æ ·çš„å¯ä»¥å¤„ç†å˜é‡" class="headerlink" title="è¿™æ ·çš„å¯ä»¥å¤„ç†å˜é‡"></a>è¿™æ ·çš„å¯ä»¥å¤„ç†å˜é‡</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿™é‡Œçš„EOFæ²¡åŠ å¼•å·ï¼Œæˆ–è€…åŠ åŒå¼•å·éƒ½ä¼šæ­£å¸¸å¤„ç†å˜é‡</span></span><br><span class="line"><span class="built_in">cat</span> &gt;&gt; filename.txt &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">$hello</span></span><br><span class="line"><span class="string">world</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨-sudo-å†™å…¥"><a href="#ä½¿ç”¨-sudo-å†™å…¥" class="headerlink" title="ä½¿ç”¨ sudo å†™å…¥"></a>ä½¿ç”¨ sudo å†™å…¥</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">sudo -E <span class="built_in">cat</span> &gt; /etc/cni/net.d/10-mynet.conf &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  &quot;cniVersion&quot;: &quot;0.2.0&quot;,</span></span><br><span class="line"><span class="string">  &quot;name&quot;: &quot;mynet&quot;,</span></span><br><span class="line"><span class="string">  &quot;type&quot;: &quot;bridge&quot;,</span></span><br><span class="line"><span class="string">  &quot;bridge&quot;: &quot;cni0&quot;,</span></span><br><span class="line"><span class="string">  &quot;isGateway&quot;: true,</span></span><br><span class="line"><span class="string">  &quot;ipMasq&quot;: true,</span></span><br><span class="line"><span class="string">  &quot;ipam&quot;: &#123;</span></span><br><span class="line"><span class="string">    &quot;type&quot;: &quot;host-local&quot;,</span></span><br><span class="line"><span class="string">    &quot;subnet&quot;: &quot;172.19.0.0/24&quot;,</span></span><br><span class="line"><span class="string">    &quot;routes&quot;: [</span></span><br><span class="line"><span class="string">      &#123; &quot;dst&quot;: &quot;0.0.0.0/0&quot; &#125;</span></span><br><span class="line"><span class="string">    ]</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><h3 id="å†™å…¥å†…å®¹æ§åˆ¶å°çœ‹å¾—è§"><a href="#å†™å…¥å†…å®¹æ§åˆ¶å°çœ‹å¾—è§" class="headerlink" title="å†™å…¥å†…å®¹æ§åˆ¶å°çœ‹å¾—è§"></a>å†™å…¥å†…å®¹æ§åˆ¶å°çœ‹å¾—è§</h3><blockquote><p>tee -a ä¸ºè¿½åŠ , tee å‰é¢å¯ä»¥åŠ  sudo</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">tee</span> /etc/docker/daemon.json &lt;&lt;-<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;registry-mirrors&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;https://hub-mirror.c.163.com&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://mirror.baidubce.com&quot;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><p>æˆ–è€…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;</span></span><br><span class="line"><span class="string">xxx</span></span><br><span class="line"><span class="string">yyy</span></span><br><span class="line"><span class="string">&quot;</span> | sudo <span class="built_in">tee</span> /etc/apt/sources.list</span><br></pre></td></tr></table></figure><h2 id="è¿è¡Œ-5s-è‡ªåŠ¨é€€å‡º"><a href="#è¿è¡Œ-5s-è‡ªåŠ¨é€€å‡º" class="headerlink" title="è¿è¡Œ 5s è‡ªåŠ¨é€€å‡º"></a>è¿è¡Œ 5s è‡ªåŠ¨é€€å‡º</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">sleep</span> 5 &amp;&amp; <span class="built_in">kill</span> $$ &amp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span>;<span class="keyword">do</span> <span class="built_in">echo</span> <span class="variable">$RANDOM</span> ; <span class="built_in">sleep</span> 1;<span class="keyword">done</span></span><br></pre></td></tr></table></figure><h2 id="è„šæœ¬é‡Œè·å–ç›®å½•æˆ–åå­—"><a href="#è„šæœ¬é‡Œè·å–ç›®å½•æˆ–åå­—" class="headerlink" title="è„šæœ¬é‡Œè·å–ç›®å½•æˆ–åå­—"></a>è„šæœ¬é‡Œè·å–ç›®å½•æˆ–åå­—</h2><h3 id="è„šæœ¬é‡Œè·å–è·¯å¾„"><a href="#è„šæœ¬é‡Œè·å–è·¯å¾„" class="headerlink" title="è„šæœ¬é‡Œè·å–è·¯å¾„"></a>è„šæœ¬é‡Œè·å–è·¯å¾„</h3><p>è¿™ç§æ–¹æ³•å¯èƒ½æ˜¯ç»å¯¹è·¯å¾„ï¼Œä¹Ÿå¯èƒ½æ˜¯ç›¸å¯¹è·¯å¾„ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> `<span class="built_in">dirname</span> <span class="variable">$0</span>`</span><br></pre></td></tr></table></figure><p>ç»å¯¹è·¯å¾„</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> $(<span class="built_in">cd</span> <span class="string">&quot;<span class="subst">$( dirname <span class="string">&quot;<span class="variable">$&#123;BASH_SOURCE[0]&#125;</span>&quot;</span> )</span>&quot;</span> &amp;&amp; <span class="built_in">pwd</span> )</span><br></pre></td></tr></table></figure><h3 id="è„šæœ¬é‡Œè·å–è„šæœ¬æ–‡ä»¶å"><a href="#è„šæœ¬é‡Œè·å–è„šæœ¬æ–‡ä»¶å" class="headerlink" title="è„šæœ¬é‡Œè·å–è„šæœ¬æ–‡ä»¶å"></a>è„šæœ¬é‡Œè·å–è„šæœ¬æ–‡ä»¶å</h3><blockquote><p>$0 åœ¨ bash é‡Œè¡¨ç¤ºæ‰§è¡Œè„šæœ¬çš„å‘½ä»¤ï¼Œå¦‚ <code>./xx.sh</code> æˆ– <code>/opt/xxx.sh</code></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> `<span class="built_in">basename</span> <span class="variable">$0</span>`</span><br></pre></td></tr></table></figure><h2 id="æ‰¹é‡å¯åŠ¨æœåŠ¡"><a href="#æ‰¹é‡å¯åŠ¨æœåŠ¡" class="headerlink" title="æ‰¹é‡å¯åŠ¨æœåŠ¡"></a>æ‰¹é‡å¯åŠ¨æœåŠ¡</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `<span class="built_in">ls</span> /data/wwwroot/`</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">cd</span> /data/wwwroot/<span class="variable">$i</span> &amp;&amp; ./restart.sh</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><h2 id="åˆ¤æ–­é‡Œé¢æœ‰å˜é‡ï¼Œç”¨åŒä¸­æ‹¬å·"><a href="#åˆ¤æ–­é‡Œé¢æœ‰å˜é‡ï¼Œç”¨åŒä¸­æ‹¬å·" class="headerlink" title="åˆ¤æ–­é‡Œé¢æœ‰å˜é‡ï¼Œç”¨åŒä¸­æ‹¬å·"></a>åˆ¤æ–­é‡Œé¢æœ‰å˜é‡ï¼Œç”¨åŒä¸­æ‹¬å·</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">elif</span> [[ <span class="string">&quot;<span class="variable">$&#123;refs&#125;</span>&quot;</span> == refs/tags/shp-* ]];<span class="keyword">then</span></span><br></pre></td></tr></table></figure><h2 id="sudo-æ‰§è¡Œå‘½ä»¤"><a href="#sudo-æ‰§è¡Œå‘½ä»¤" class="headerlink" title="sudo æ‰§è¡Œå‘½ä»¤"></a>sudo æ‰§è¡Œå‘½ä»¤</h2><p>ä¸¾ä¸ªä¾‹å­</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">]$ <span class="built_in">echo</span> 1 &gt; /root/1</span><br><span class="line">-bash: /root/1: Permission denied</span><br><span class="line"></span><br><span class="line">]$ sudo <span class="built_in">echo</span> 1 &gt; /root/1</span><br><span class="line">-bash: /root/1: Permission denied</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sudo sh -c <span class="string">&#x27;echo 1 &gt; /root/1&#x27;</span>     <span class="comment"># è¿™æ ·ç¯å¢ƒå˜é‡ç”¨çš„æ˜¯rootçš„</span></span><br><span class="line">sudo -E sh -c <span class="string">&#x27;echo $SHELL&#x27;</span>       <span class="comment"># ä¿ç•™äº†å½“å‰ç”¨æˆ·çš„ç¯å¢ƒå˜é‡ï¼Œæ¯”å¦‚~/.bashrcé‡Œé¢çš„é…ç½®</span></span><br></pre></td></tr></table></figure><h2 id="æˆªå–æ–‡ä»¶åæˆ–è·¯å¾„å"><a href="#æˆªå–æ–‡ä»¶åæˆ–è·¯å¾„å" class="headerlink" title="æˆªå–æ–‡ä»¶åæˆ–è·¯å¾„å"></a>æˆªå–æ–‡ä»¶åæˆ–è·¯å¾„å</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="built_in">basename</span> /var/log/alternatives.log</span><br><span class="line">alternatives.log</span><br><span class="line"></span><br><span class="line">&gt; <span class="built_in">dirname</span> /var/log/alternatives.log</span><br><span class="line">/var/log</span><br></pre></td></tr></table></figure><h2 id="å»é™¤å­—ç¬¦ä¸²ä¸­é—´çš„ç©ºæ ¼"><a href="#å»é™¤å­—ç¬¦ä¸²ä¸­é—´çš„ç©ºæ ¼" class="headerlink" title="å»é™¤å­—ç¬¦ä¸²ä¸­é—´çš„ç©ºæ ¼"></a>å»é™¤å­—ç¬¦ä¸²ä¸­é—´çš„ç©ºæ ¼</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å»é™¤æ–‡æœ¬ä¸­çš„ç©ºæ ¼ï¼Œç›¸å½“äºpythoné‡Œé¢çš„strip()</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;   lo l  &quot;</span> | xargs</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¹Ÿå¯ä»¥ç”¨sedï¼Œä¸è¿‡æ„Ÿè§‰ä¸ä¼˜é›…ï¼Œä¼šæŠŠæ‰€æœ‰ç©ºæ ¼éƒ½å»æ‰</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;   lo l  &quot;</span> | sed <span class="string">&#x27;s/ //g&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="è¾“å…¥-yes-æˆ–-no-æ‰§è¡Œä¸åŒçš„é€‰é¡¹"><a href="#è¾“å…¥-yes-æˆ–-no-æ‰§è¡Œä¸åŒçš„é€‰é¡¹" class="headerlink" title="è¾“å…¥ yes æˆ– no æ‰§è¡Œä¸åŒçš„é€‰é¡¹"></a>è¾“å…¥ yes æˆ– no æ‰§è¡Œä¸åŒçš„é€‰é¡¹</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">read</span> -r -p <span class="string">&quot;Are You Sure? [Y/n] &quot;</span> input</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$input</span> <span class="keyword">in</span></span><br><span class="line">  [yY][eE][sS]|[yY])</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Yes&quot;</span></span><br><span class="line">  ;;</span><br><span class="line"></span><br><span class="line">  [nN][oO]|[nN])</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;No&quot;</span></span><br><span class="line">  ;;</span><br><span class="line"></span><br><span class="line">  *)</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Invalid input...&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line">  ;;</span><br><span class="line"><span class="keyword">esac</span></span><br></pre></td></tr></table></figure><h2 id="è·å–ç½‘å¡-IP"><a href="#è·å–ç½‘å¡-IP" class="headerlink" title="è·å–ç½‘å¡ IP"></a>è·å–ç½‘å¡ IP</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip addr | grep inet | egrep -v <span class="string">&#x27;(127.0.0.1|inet6|docker)&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | <span class="built_in">tr</span> -d <span class="string">&quot;addr:&quot;</span> | <span class="built_in">head</span> -n 1 | <span class="built_in">cut</span> -d / -f1</span><br></pre></td></tr></table></figure><h2 id="è·å–ç½‘å¡è®¾å¤‡å"><a href="#è·å–ç½‘å¡è®¾å¤‡å" class="headerlink" title="è·å–ç½‘å¡è®¾å¤‡å"></a>è·å–ç½‘å¡è®¾å¤‡å</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /proc/net/dev | awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> | grep <span class="string">&quot;:&quot;</span> | grep -Ev <span class="string">&quot;lo|docker|vnet|br&quot;</span> | sed <span class="string">&#x27;s/://&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="è·å–å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰ç›®å½•"><a href="#è·å–å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰ç›®å½•" class="headerlink" title="è·å–å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰ç›®å½•"></a>è·å–å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰ç›®å½•</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(<span class="built_in">ls</span> -d */); <span class="keyword">do</span></span><br><span class="line">  <span class="built_in">cd</span> <span class="variable">$i</span></span><br><span class="line">  git pull</span><br><span class="line">  <span class="built_in">cd</span> ..</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨-shell-ç”Ÿæˆéšæœº-MAC-åœ°å€"><a href="#ä½¿ç”¨-shell-ç”Ÿæˆéšæœº-MAC-åœ°å€" class="headerlink" title="ä½¿ç”¨ shell ç”Ÿæˆéšæœº MAC åœ°å€"></a>ä½¿ç”¨ shell ç”Ÿæˆéšæœº MAC åœ°å€</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> -n A0-62-2F; <span class="built_in">dd</span> bs=1 count=3 <span class="keyword">if</span>=/dev/random 2&gt;/dev/null |hexdump -v -e <span class="string">&#x27;/1 &quot;-%02X&quot;&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="ä»¥ç¦æ­¢ç™»å½•çš„ç”¨æˆ·æ‰§è¡Œå‘½ä»¤"><a href="#ä»¥ç¦æ­¢ç™»å½•çš„ç”¨æˆ·æ‰§è¡Œå‘½ä»¤" class="headerlink" title="ä»¥ç¦æ­¢ç™»å½•çš„ç”¨æˆ·æ‰§è¡Œå‘½ä»¤"></a>ä»¥ç¦æ­¢ç™»å½•çš„ç”¨æˆ·æ‰§è¡Œå‘½ä»¤</h2><p>ç”¨æˆ· shell é…ç½®æˆäº† <code>/sbin/nologin</code> æˆ–è€… <code>/bin/false</code> éƒ½å¯ä»¥æ‹’ç»ç”¨æˆ·ç™»å½•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">su -s /bin/bash www</span><br><span class="line">sudo -u www <span class="built_in">touch</span> xxx</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Script </tag>
            
            <tag> Linux </tag>
            
            <tag> Shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dockerå¸¸ç”¨é…ç½®</title>
      <link href="/posts/4bc23141/"/>
      <url>/posts/4bc23141/</url>
      
        <content type="html"><![CDATA[<h2 id="docker-å®‰è£…"><a href="#docker-å®‰è£…" class="headerlink" title="docker å®‰è£…"></a>docker å®‰è£…</h2><h3 id="å®˜æ–¹å®‰è£…è„šæœ¬"><a href="#å®˜æ–¹å®‰è£…è„šæœ¬" class="headerlink" title="å®˜æ–¹å®‰è£…è„šæœ¬"></a>å®˜æ–¹å®‰è£…è„šæœ¬</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -fsSL get.docker.com | bash</span><br></pre></td></tr></table></figure><h3 id="é˜¿é‡Œäº‘å®‰è£…ï¼ˆcentosï¼‰"><a href="#é˜¿é‡Œäº‘å®‰è£…ï¼ˆcentosï¼‰" class="headerlink" title="é˜¿é‡Œäº‘å®‰è£…ï¼ˆcentosï¼‰"></a>é˜¿é‡Œäº‘å®‰è£…ï¼ˆcentosï¼‰</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># step 1: å®‰è£…å¿…è¦çš„ä¸€äº›ç³»ç»Ÿå·¥å…·</span></span><br><span class="line">sudo yum install -y yum-utils device-mapper-persistent-data lvm2</span><br><span class="line"></span><br><span class="line"><span class="comment"># Step 2: æ·»åŠ è½¯ä»¶æºä¿¡æ¯</span></span><br><span class="line">sudo yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line"></span><br><span class="line"><span class="comment"># Step 3: æ›´æ–°å¹¶å®‰è£…Docker-CE</span></span><br><span class="line">sudo yum makecache fast</span><br><span class="line">sudo yum -y install docker-ce</span><br><span class="line"></span><br><span class="line"><span class="comment"># Step 4: å¼€å¯DockeræœåŠ¡</span></span><br><span class="line">sudo systemctl start docker.service</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="docker-compose-å®‰è£…"><a href="#docker-compose-å®‰è£…" class="headerlink" title="docker-compose å®‰è£…"></a>docker-compose å®‰è£…</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo curl -L <span class="string">&quot;https://github.com/docker/compose/releases/download/1.25.4/docker-compose-<span class="subst">$(uname -s)</span>-<span class="subst">$(uname -m)</span>&quot;</span> -o /usr/bin/docker-compose &amp;&amp; sudo <span class="built_in">chmod</span> +x /usr/bin/docker-compose</span><br></pre></td></tr></table></figure><h2 id="å…-root-æ‰§è¡Œ-docker-å‘½ä»¤"><a href="#å…-root-æ‰§è¡Œ-docker-å‘½ä»¤" class="headerlink" title="å… root æ‰§è¡Œ docker å‘½ä»¤"></a>å… root æ‰§è¡Œ docker å‘½ä»¤</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo usermod -aG docker <span class="variable">$USER</span></span><br></pre></td></tr></table></figure><blockquote><p>é¡ºä¾¿ç¡®å®šä¸€ä¸‹ sock æ–‡ä»¶æœ‰æ²¡æœ‰æƒé™ï¼ˆé»˜è®¤æ˜¯æœ‰çš„ï¼‰, é€€å‡ºè´¦æˆ·é‡æ–°ç™»å½•ä¸€ä¸‹å³å¯ç”Ÿæ•ˆ</p></blockquote><h2 id="é˜¿é‡Œäº‘-Docker-åŠ é€Ÿ"><a href="#é˜¿é‡Œäº‘-Docker-åŠ é€Ÿ" class="headerlink" title="é˜¿é‡Œäº‘ Docker åŠ é€Ÿ"></a>é˜¿é‡Œäº‘ Docker åŠ é€Ÿ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /etc/docker &amp;&amp; <span class="built_in">tee</span> /etc/docker/daemon.json &lt;&lt;-<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;registry-mirrors&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;https://hub-mirror.c.163.com&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://mirror.baidubce.com&quot;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><p>æˆ–è€…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; /etc/docker/daemon.json &lt;&lt;-<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;registry-mirrors&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;https://hub-mirror.c.163.com&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://mirror.baidubce.com&quot;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h2 id="å¸¸ç”¨æ“ä½œ"><a href="#å¸¸ç”¨æ“ä½œ" class="headerlink" title="å¸¸ç”¨æ“ä½œ"></a>å¸¸ç”¨æ“ä½œ</h2><h3 id="ä¸€æ¬¡æ€§åˆ é™¤æ‰€æœ‰çš„å®¹å™¨"><a href="#ä¸€æ¬¡æ€§åˆ é™¤æ‰€æœ‰çš„å®¹å™¨" class="headerlink" title="ä¸€æ¬¡æ€§åˆ é™¤æ‰€æœ‰çš„å®¹å™¨"></a>ä¸€æ¬¡æ€§åˆ é™¤æ‰€æœ‰çš„å®¹å™¨</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">rm</span> -f `docker ps -aq`</span><br></pre></td></tr></table></figure><h3 id="ä¸€æ¬¡æ€§åˆ é™¤æ‰€æœ‰çš„é•œåƒ"><a href="#ä¸€æ¬¡æ€§åˆ é™¤æ‰€æœ‰çš„é•œåƒ" class="headerlink" title="ä¸€æ¬¡æ€§åˆ é™¤æ‰€æœ‰çš„é•œåƒ"></a>ä¸€æ¬¡æ€§åˆ é™¤æ‰€æœ‰çš„é•œåƒ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rmi $(docker image <span class="built_in">ls</span> | awk <span class="string">&#x27;NR!=1 &#123;print $1 &quot;:&quot; $2&#125;&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="ä¸€æ¬¡æ€§åˆ é™¤æœªæ‰“æ ‡ç­¾çš„é•œåƒ"><a href="#ä¸€æ¬¡æ€§åˆ é™¤æœªæ‰“æ ‡ç­¾çš„é•œåƒ" class="headerlink" title="ä¸€æ¬¡æ€§åˆ é™¤æœªæ‰“æ ‡ç­¾çš„é•œåƒ"></a>ä¸€æ¬¡æ€§åˆ é™¤æœªæ‰“æ ‡ç­¾çš„é•œåƒ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker image <span class="built_in">ls</span> | grep none | awk <span class="string">&#x27;&#123;print $3&#125;&#x27;</span> | xargs docker rmi</span><br></pre></td></tr></table></figure><h3 id="ä¸€æ¬¡æ€§åˆ é™¤æ‰€æœ‰-volume"><a href="#ä¸€æ¬¡æ€§åˆ é™¤æ‰€æœ‰-volume" class="headerlink" title="ä¸€æ¬¡æ€§åˆ é™¤æ‰€æœ‰ volume"></a>ä¸€æ¬¡æ€§åˆ é™¤æ‰€æœ‰ volume</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker volume <span class="built_in">rm</span> `docker volume <span class="built_in">ls</span> -q`</span><br></pre></td></tr></table></figure><h3 id="Docker-è¿›å…¥å®¹å™¨"><a href="#Docker-è¿›å…¥å®¹å™¨" class="headerlink" title="Docker è¿›å…¥å®¹å™¨"></a>Docker è¿›å…¥å®¹å™¨</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run --name test_ubuntu -it ubuntu /bin/bash</span><br><span class="line">å¯åŠ¨ä¸€ä¸ªå®¹å™¨å¹¶æ‰“å¼€shell</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹å®¹å™¨è¯¦æƒ…"><a href="#æŸ¥çœ‹å®¹å™¨è¯¦æƒ…" class="headerlink" title="æŸ¥çœ‹å®¹å™¨è¯¦æƒ…"></a>æŸ¥çœ‹å®¹å™¨è¯¦æƒ…</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é‡çœ‹å®¹å™¨è¯¦æƒ…</span></span><br><span class="line">docker inspect å®¹å™¨<span class="built_in">id</span>æˆ–åå­—</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡çœ‹dockerè¯¦æƒ…</span></span><br><span class="line">docker info</span><br></pre></td></tr></table></figure><h3 id="å¯åŠ¨å®¹å™¨"><a href="#å¯åŠ¨å®¹å™¨" class="headerlink" title="å¯åŠ¨å®¹å™¨"></a>å¯åŠ¨å®¹å™¨</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it é•œåƒåå­— /bin/sh</span><br></pre></td></tr></table></figure><h3 id="è¿›å…¥ä¸€ä¸ªè¿è¡Œä¸­çš„å®¹å™¨"><a href="#è¿›å…¥ä¸€ä¸ªè¿è¡Œä¸­çš„å®¹å™¨" class="headerlink" title="è¿›å…¥ä¸€ä¸ªè¿è¡Œä¸­çš„å®¹å™¨"></a>è¿›å…¥ä¸€ä¸ªè¿è¡Œä¸­çš„å®¹å™¨</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it å®¹å™¨<span class="built_in">id</span> /bin/sh</span><br></pre></td></tr></table></figure><h3 id="æ‰“-tag"><a href="#æ‰“-tag" class="headerlink" title="æ‰“ tag"></a>æ‰“ tag</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker tag é•œåƒ<span class="built_in">id</span> oldboy1103/alpine:latest</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹å®¹å™¨å ç”¨ç£ç›˜ç©ºé—´"><a href="#æŸ¥çœ‹å®¹å™¨å ç”¨ç£ç›˜ç©ºé—´" class="headerlink" title="æŸ¥çœ‹å®¹å™¨å ç”¨ç£ç›˜ç©ºé—´"></a>æŸ¥çœ‹å®¹å™¨å ç”¨ç£ç›˜ç©ºé—´</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps -a --format <span class="string">&quot;table &#123;&#123;.Size&#125;&#125;\t&#123;&#123;.Names&#125;&#125;&quot;</span> | <span class="built_in">sort</span> -hr</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹å®¹å™¨-id"><a href="#æŸ¥çœ‹å®¹å™¨-id" class="headerlink" title="æŸ¥çœ‹å®¹å™¨ id"></a>æŸ¥çœ‹å®¹å™¨ id</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker inspect nginx --format <span class="string">&quot;&#123;&#123;.ID&#125;&#125;&quot;</span></span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶"><a href="#æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶" class="headerlink" title="æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶"></a>æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹nginxå®¹å™¨çš„æ—¥å¿—ä½ç½®</span></span><br><span class="line">docker inspect nginx --format <span class="string">&quot;&#123;&#123;.LogPath&#125;&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ‰€æœ‰å®¹å™¨çš„æ—¥å¿—ä½ç½®</span></span><br><span class="line">docker inspect --format=<span class="string">&#x27;&#123;&#123;.LogPath&#125;&#125;&#x27;</span> `docker ps -a -q`</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è·å–é•œåƒï¼ŒIDï¼Œç«¯å£å·ï¼ŒçŠ¶æ€</span></span><br><span class="line">docker ps -a --format <span class="string">&quot;table &#123;&#123;.Image&#125;&#125;\t&#123;&#123;.ID&#125;&#125;\t&#123;&#123;.Ports&#125;&#125;\t&#123;&#123;.Status&#125;&#125;&quot;</span> | <span class="built_in">sort</span> -hr</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ ¹æ®çŠ¶æ€åˆ—å‡ºå®¹å™¨</span></span><br><span class="line">docker ps -a -f  <span class="string">&quot;status=running&quot;</span></span><br><span class="line">docker ps -a -f  <span class="string">&quot;status=exited&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–å®¹å™¨çš„IP</span></span><br><span class="line">docker inspect --format=<span class="string">&#x27;&#123;&#123;range .NetworkSettings.Networks&#125;&#125;&#123;&#123;.IPAddress&#125;&#125;&#123;&#123;end&#125;&#125;&#x27;</span> $(docker ps -q)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–å®¹å™¨çš„macåœ°å€</span></span><br><span class="line">docker inspect --format=<span class="string">&#x27;&#123;&#123;range .NetworkSettings.Networks&#125;&#125;&#123;&#123;.MacAddress&#125;&#125;&#123;&#123;end&#125;&#125;&#x27;</span> $(docker ps -a -q)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–å®¹å™¨name</span></span><br><span class="line">docker inspect --format=<span class="string">&#x27;&#123;&#123;.Name&#125;&#125;&#x27;</span> $(docker ps -aq)</span><br><span class="line">docker inspect --format=<span class="string">&#x27;&#123;&#123;.Name&#125;&#125;&#x27;</span> $(docker ps -aq)|<span class="built_in">cut</span> -d<span class="string">&quot;/&quot;</span> -f2</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–å®¹å™¨çš„Hostname</span></span><br><span class="line">docker inspect --format <span class="string">&#x27;&#123;&#123; .Config.Hostname &#125;&#125;&#x27;</span> $(docker ps -q)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–hostname,ip</span></span><br><span class="line">docker inspect --format <span class="string">&#x27;Hostname:&#123;&#123; .Config.Hostname &#125;&#125;  Name:&#123;&#123;.Name&#125;&#125; IP:&#123;&#123;range .NetworkSettings.Networks&#125;&#125;&#123;&#123;.IPAddress&#125;&#125;&#123;&#123;end&#125;&#125;&#x27;</span> $(docker ps -q)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–å®¹å™¨çš„é•œåƒ</span></span><br><span class="line">docker inspect --format=<span class="string">&#x27;&#123;&#123;.Config.Image&#125;&#125;&#x27;</span> `docker ps -a -q`</span><br></pre></td></tr></table></figure><h2 id="å®¹å™¨å¤‡ä»½è¿˜åŸ"><a href="#å®¹å™¨å¤‡ä»½è¿˜åŸ" class="headerlink" title="å®¹å™¨å¤‡ä»½è¿˜åŸ"></a>å®¹å™¨å¤‡ä»½è¿˜åŸ</h2><h3 id="é•œåƒçš„å¤‡ä»½è¿˜åŸ"><a href="#é•œåƒçš„å¤‡ä»½è¿˜åŸ" class="headerlink" title="é•œåƒçš„å¤‡ä»½è¿˜åŸ"></a>é•œåƒçš„å¤‡ä»½è¿˜åŸ</h3><ol><li><p>commit å°†å®¹å™¨ä¿å­˜æˆé•œåƒ</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker commit [é€‰é¡¹] &lt;å®¹å™¨IDæˆ–å®¹å™¨å&gt; [&lt;ä»“åº“å&gt;[:&lt;æ ‡ç­¾&gt;]]</span><br></pre></td></tr></table></figure></li><li><p>å°†é•œåƒå¯¼å‡ºæˆ tar (é•œåƒæ˜¯åˆ†å±‚çš„,å¯ä»¥å›æ»š,)</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker save -o ./backup.tar gitlab/gitlab-ce</span><br></pre></td></tr></table></figure></li><li><p>ä» tar å¯¼å…¥é•œåƒï¼ˆé•œåƒå¤‡ä»½ä¸‹æ¥çš„ tarï¼‰</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker load -i ./backup.tar</span><br></pre></td></tr></table></figure></li></ol><blockquote><p>æ³¨æ„ï¼šä»¥ä¸Šä¼šå¤‡ä»½é•œåƒçš„å¤šå±‚ã€‚</p></blockquote><h3 id="å®¹å™¨çš„å¤‡ä»½è¿˜åŸ"><a href="#å®¹å™¨çš„å¤‡ä»½è¿˜åŸ" class="headerlink" title="å®¹å™¨çš„å¤‡ä»½è¿˜åŸ"></a>å®¹å™¨çš„å¤‡ä»½è¿˜åŸ</h3><ol><li><p>å¤‡ä»½å®¹å™¨</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">export</span> php &gt; phprongqi.tar</span><br></pre></td></tr></table></figure></li><li><p>è¿˜åŸæˆé•œåƒ</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker import ./phprongqi.tar php</span><br></pre></td></tr></table></figure></li></ol><blockquote><p>æ³¨æ„ï¼šå¤‡ä»½çš„åªæ˜¯ä¸€å±‚é•œåƒ</p></blockquote><h2 id="å®¹å™¨çš„æ—¥å¿—"><a href="#å®¹å™¨çš„æ—¥å¿—" class="headerlink" title="å®¹å™¨çš„æ—¥å¿—"></a>å®¹å™¨çš„æ—¥å¿—</h2><h3 id="æ—¥å¿—ä½ç½®"><a href="#æ—¥å¿—ä½ç½®" class="headerlink" title="æ—¥å¿—ä½ç½®"></a>æ—¥å¿—ä½ç½®</h3><p>docker æ—¥å¿—å»ºè®®è¾“å‡ºæ§åˆ¶å°ï¼Œæ§åˆ¶å°æ—¥å¿—å­˜å‚¨åœ¨ä¸»æœºä¸Š</p><p>å…ˆæŸ¥çœ‹ <code>Logging Driver</code> ç±»å‹ï¼Œé»˜è®¤åº”è¯¥æ˜¯ <code>json</code> æ ¼å¼</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker info | grep <span class="string">&quot;Logging Driver&quot;</span></span><br></pre></td></tr></table></figure><p>json æ ¼å¼çš„æ—¥å¿—åœ¨ <code>/var/lib/docker/containers/&lt;containerID&gt;/&lt;containerID&gt;-json.log</code><br>local æ ¼å¼çš„æ—¥å¿—åœ¨ <code>/var/lib/docker/containers/&lt;containerID&gt;/local-logs/container.log</code></p><h3 id="æ§åˆ¶æ—¥å¿—å¤§å°"><a href="#æ§åˆ¶æ—¥å¿—å¤§å°" class="headerlink" title="æ§åˆ¶æ—¥å¿—å¤§å°"></a>æ§åˆ¶æ—¥å¿—å¤§å°</h3><p>vi &#x2F;etc&#x2F;docker&#x2F;daemon.json</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span> </span><br><span class="line">    <span class="attr">&quot;log-driver&quot;</span><span class="punctuation">:</span> <span class="string">&quot;json-file&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;log-opts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;max-size&quot;</span><span class="punctuation">:</span> <span class="string">&quot;10m&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;max-file&quot;</span><span class="punctuation">:</span> <span class="string">&quot;3&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å®¹å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
            <tag> Docker </tag>
            
            <tag> Container </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ubuntuå¸¸ç”¨é…ç½®</title>
      <link href="/posts/27a660e/"/>
      <url>/posts/27a660e/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¿®æ”¹å›½å†…æº"><a href="#ä¿®æ”¹å›½å†…æº" class="headerlink" title="ä¿®æ”¹å›½å†…æº"></a>ä¿®æ”¹å›½å†…æº</h2><h3 id="ä»€ä¹ˆæ˜¯-DEB822-sources-æ–‡ä»¶æ ¼å¼ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯-DEB822-sources-æ–‡ä»¶æ ¼å¼ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ DEB822 (.sources) æ–‡ä»¶æ ¼å¼ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ DEB822 (.sources) æ–‡ä»¶æ ¼å¼ï¼Ÿ</h3><div class="note blue icon-padding simple"><i class="note-icon fas fa-bullhorn"></i><p>è‡ªæ–°ç‰ˆæœ¬çš„ Debian ä¸ Ubuntu èµ·ï¼Œä¾‹å¦‚ï¼š</p><ul><li>Debian 12 çš„å®¹å™¨é•œåƒ</li><li>Ubuntu 24.04</li></ul><p>é»˜è®¤é¢„è£…çš„ç³»ç»Ÿä¸­ APT çš„ç³»ç»Ÿæºé…ç½®æ–‡ä»¶ä¸å†æ˜¯ä¼ ç»Ÿçš„ <code>/etc/apt/sources.list</code>ã€‚ä¼ ç»Ÿæ ¼å¼ï¼ˆåˆè¢«ç§°ä¸º One-Line-Style æ ¼å¼ï¼‰ç±»ä¼¼å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">deb http://mirrors.ustc.edu.cn/debian/ bookworm main contrib</span><br></pre></td></tr></table></figure><p>æ–°çš„ DEB822 æ ¼å¼è‡ª APT 1.1ï¼ˆ2015 å¹´å‘å¸ƒï¼‰èµ·æ”¯æŒï¼Œåç¼€ä¸º .sourcesï¼Œå­˜å‚¨åœ¨ <code>/etc/apt/sources.list.d/</code> ç›®å½•ä¸‹ï¼Œæ ¼å¼ç±»ä¼¼å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Types: deb</span><br><span class="line">URIs: https://mirrors.ustc.edu.cn/debian</span><br><span class="line">Suites: bookworm</span><br><span class="line">Components: main contrib</span><br><span class="line">Signed-By: /usr/share/keyrings/debian-archive-keyring.gpg</span><br></pre></td></tr></table></figure><p>åœ¨åˆ‡æ¢è½¯ä»¶æºæ—¶ï¼Œéœ€è¦æ ¹æ®å®é™…æƒ…å†µé€‰æ‹©å¯¹åº”çš„æ ¼å¼è¿›è¡Œä¿®æ”¹ã€‚</p><p>å…³äº DEB822 æ ¼å¼çš„è®¾è®¡è€ƒè™‘ï¼Œå¯ä»¥å‚è€ƒ <a href="https://repolib.readthedocs.io/en/latest/deb822-format.html">å®˜æ–¹æ–‡æ¡£</a>ã€‚</p></div><ul><li><p>ä¼ ç»Ÿæ ¼å¼ï¼ˆ&#x2F;etc&#x2F;apt&#x2F;sources.listï¼‰</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo sed -i <span class="string">&#x27;s@//.*ubuntu.com@//mirrors.ustc.edu.cn@g&#x27;</span> /etc/apt/sources.list</span><br></pre></td></tr></table></figure></li><li><p>DEB822 æ ¼å¼ï¼ˆ&#x2F;etc&#x2F;apt&#x2F;sources.list.d&#x2F;ubuntu.sourcesï¼‰</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo sed -i <span class="string">&#x27;s@//.*archive.ubuntu.com@//mirrors.ustc.edu.cn@g&#x27;</span> /etc/apt/sources.list.d/ubuntu.sources</span><br></pre></td></tr></table></figure></li></ul><h2 id="ç¼–è¯‘ç¯å¢ƒå®‰è£…"><a href="#ç¼–è¯‘ç¯å¢ƒå®‰è£…" class="headerlink" title="ç¼–è¯‘ç¯å¢ƒå®‰è£…"></a>ç¼–è¯‘ç¯å¢ƒå®‰è£…</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install -y build-essential tcl gcc make zlib1g-dev libssl-dev libncursesw5-dev libgdbm-dev libc6-dev libffi-dev openssl libxml2-dev libpcre3 libpcre3-dev libncurses5-dev libicu-dev libmcrypt-dev curl libcurl4-gnutls-dev libjpeg-dev libpng-dev libxslt1-dev</span><br></pre></td></tr></table></figure><h2 id="åˆ‡æ¢è¯­è¨€ç¯å¢ƒ"><a href="#åˆ‡æ¢è¯­è¨€ç¯å¢ƒ" class="headerlink" title="åˆ‡æ¢è¯­è¨€ç¯å¢ƒ"></a>åˆ‡æ¢è¯­è¨€ç¯å¢ƒ</h2><p><code>dpkg-reconfigure locales</code></p><h2 id="Ubuntu-ç½‘å¡é…ç½®æ–‡ä»¶"><a href="#Ubuntu-ç½‘å¡é…ç½®æ–‡ä»¶" class="headerlink" title="Ubuntu ç½‘å¡é…ç½®æ–‡ä»¶"></a>Ubuntu ç½‘å¡é…ç½®æ–‡ä»¶</h2><h3 id="æŸ¥çœ‹ç½‘å¡ç¡¬ä»¶ä¿¡æ¯"><a href="#æŸ¥çœ‹ç½‘å¡ç¡¬ä»¶ä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹ç½‘å¡ç¡¬ä»¶ä¿¡æ¯"></a>æŸ¥çœ‹ç½‘å¡ç¡¬ä»¶ä¿¡æ¯</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lshw -short | grep network</span><br><span class="line">ifconfig -a</span><br></pre></td></tr></table></figure><h3 id="ç½‘å¡é…ç½®æ–‡ä»¶-16-ç‰ˆæœ¬åŠä»¥ä¸‹-etc-network-interfaces-æ–‡ä»¶å†…å®¹å¦‚ä¸‹"><a href="#ç½‘å¡é…ç½®æ–‡ä»¶-16-ç‰ˆæœ¬åŠä»¥ä¸‹-etc-network-interfaces-æ–‡ä»¶å†…å®¹å¦‚ä¸‹" class="headerlink" title="ç½‘å¡é…ç½®æ–‡ä»¶ (16 ç‰ˆæœ¬åŠä»¥ä¸‹):&#x2F;etc&#x2F;network&#x2F;interfaces æ–‡ä»¶å†…å®¹å¦‚ä¸‹"></a>ç½‘å¡é…ç½®æ–‡ä»¶ (16 ç‰ˆæœ¬åŠä»¥ä¸‹):&#x2F;etc&#x2F;network&#x2F;interfaces æ–‡ä»¶å†…å®¹å¦‚ä¸‹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">auto eth0</span><br><span class="line">iface eth0 inet static</span><br><span class="line">address 192.168.111.14</span><br><span class="line">gateway 192.168.111.2</span><br><span class="line">netmask 255.255.255.0</span><br><span class="line">dns-nameservers 192.168.111.2</span><br><span class="line"></span><br><span class="line"><span class="comment">#network 192.168.111.0</span></span><br><span class="line"><span class="comment">#broadcast 192.168.111.255</span></span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼šå¦‚æœ Ubuntu ç³»ç»Ÿé‡‡ç”¨çš„æ˜¯ desktop ç‰ˆï¼Œç”±äº desktop ç‰ˆå®‰è£…äº† NetworkManagerï¼Œä¿®æ”¹å®Œ interfaces æ–‡æ¡£ä¸­çš„å†…å®¹åï¼Œä¸ä¼šç”Ÿæ•ˆã€‚éœ€è¦å…ˆä¿®æ”¹&#x2F;etc&#x2F;NetworkManager&#x2F;NetworkManager.conf æ–‡æ¡£ä¸­çš„ managed å‚æ•°ï¼Œä½¿ä¹‹ä¸º true ï¼Œå¹¶é‡å¯ç³»ç»Ÿï¼Œ ç„¶ååœ¨ä¿®æ”¹&#x2F;etc&#x2F;network&#x2F;interfaces æ–‡ä»¶ï¼Œè®¾ç½®é™æ€ IPã€‚</p></blockquote><h3 id="é‡å¯ç½‘å¡ä½¿é…ç½®ç”Ÿæ•ˆ"><a href="#é‡å¯ç½‘å¡ä½¿é…ç½®ç”Ÿæ•ˆ" class="headerlink" title="é‡å¯ç½‘å¡ä½¿é…ç½®ç”Ÿæ•ˆ"></a>é‡å¯ç½‘å¡ä½¿é…ç½®ç”Ÿæ•ˆ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo /etc/init.d/networking restart</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸Šé¢å‘½ä»¤æ— æ³•ä»¤ ubuntu é‡å¯ç½‘ç»œï¼Œåˆ™ä½¿ç”¨ä¸‹é¢å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo ifdown eth0 &amp;&amp; sudo ifup eth0</span><br><span class="line">æˆ–è€…</span><br><span class="line"></span><br><span class="line">service networking restart</span><br><span class="line">æˆ–è€…</span><br><span class="line"></span><br><span class="line">ifconfig eth0 down &amp;&amp; ifconfig eth0 up</span><br></pre></td></tr></table></figure><h3 id="ç½‘å¡é…ç½®æ–‡ä»¶-17-10-etc-netplan-01-netcfg-yaml"><a href="#ç½‘å¡é…ç½®æ–‡ä»¶-17-10-etc-netplan-01-netcfg-yaml" class="headerlink" title="ç½‘å¡é…ç½®æ–‡ä»¶ (17.10+):&#x2F;etc&#x2F;netplan&#x2F;01-netcfg.yaml"></a>ç½‘å¡é…ç½®æ–‡ä»¶ (17.10+):&#x2F;etc&#x2F;netplan&#x2F;01-netcfg.yaml</h3><blockquote><p>ubuntu ä» 17.10 å¼€å§‹ï¼Œå·²æ”¾å¼ƒåœ¨&#x2F;etc&#x2F;network&#x2F;interfaces é‡Œå›ºå®š IP çš„é…ç½®ï¼Œè€Œæ˜¯æ”¹æˆ netplan æ–¹å¼ï¼Œé…ç½®å†™åœ¨&#x2F;etc&#x2F;netplan&#x2F;01-netcfg.yaml æˆ–è€…ç±»ä¼¼åç§°çš„ yaml æ–‡ä»¶é‡Œ</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># This file describes the network interfaces available on your system</span></span><br><span class="line"><span class="comment"># For more information, see netplan(5).</span></span><br><span class="line"><span class="attr">network:</span></span><br><span class="line">  <span class="attr">version:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">ethernets:</span></span><br><span class="line">    <span class="attr">ens33:</span></span><br><span class="line">      <span class="attr">addresses:</span> [ <span class="number">10.0</span><span class="number">.0</span><span class="number">.51</span><span class="string">/24</span> ]</span><br><span class="line">      <span class="attr">gateway4:</span> <span class="number">10.0</span><span class="number">.0</span><span class="number">.2</span></span><br><span class="line">      <span class="attr">nameservers:</span></span><br><span class="line">          <span class="attr">addresses:</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">&quot;10.0.0.2&quot;</span></span><br></pre></td></tr></table></figure><p>dhcp é…ç½®</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># This file describes the network interfaces available on your system</span></span><br><span class="line"><span class="comment"># For more information, see netplan(5).</span></span><br><span class="line"><span class="attr">network:</span></span><br><span class="line">  <span class="attr">version:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">ethernets:</span></span><br><span class="line">    <span class="attr">ens32:</span></span><br><span class="line">      <span class="attr">dhcp4:</span> <span class="literal">yes</span></span><br></pre></td></tr></table></figure><p>ç„¶åæ‰§è¡Œ <code>netplan apply</code> ä½¿é…ç½®ç”Ÿæ•ˆ,ä¸ç”¨é‡å¯ç½‘å¡.</p><h3 id="ä¸´æ—¶ä¿®æ”¹ç½‘å¡-DNS-åœ°å€"><a href="#ä¸´æ—¶ä¿®æ”¹ç½‘å¡-DNS-åœ°å€" class="headerlink" title="ä¸´æ—¶ä¿®æ”¹ç½‘å¡ DNS åœ°å€"></a>ä¸´æ—¶ä¿®æ”¹ç½‘å¡ DNS åœ°å€</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/resolv.conf(ä¸å»ºè®®ç›´æ¥ä¿®æ”¹)</span><br><span class="line">nameserver 223.5.5.5 <span class="comment">#ä¿®æ”¹æˆä½ çš„ä¸»DNS</span></span><br><span class="line">nameserver 223.6.6.6 <span class="comment">#ä¿®æ”¹æˆä½ çš„å¤‡ç”¨DNS</span></span><br><span class="line">search localhost <span class="comment">#ä½ çš„åŸŸå</span></span><br><span class="line">ä¿®æ”¹å:wqé€€å‡ºï¼Œé…ç½®ä¼šå®æ—¶ç”Ÿæ•ˆï¼Œä½†æ˜¯é‡å¯ç³»ç»Ÿåä¼šä¸¢å¤±é…ç½®ã€‚</span><br></pre></td></tr></table></figure><h3 id="æ°¸ä¹…ä¿®æ”¹ç½‘å¡-DNS"><a href="#æ°¸ä¹…ä¿®æ”¹ç½‘å¡-DNS" class="headerlink" title="æ°¸ä¹…ä¿®æ”¹ç½‘å¡ DNS"></a>æ°¸ä¹…ä¿®æ”¹ç½‘å¡ DNS</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/resolvconf/resolv.conf.d/base</span><br><span class="line">æ·»åŠ å¦‚ä¸‹å†…å®¹</span><br><span class="line"></span><br><span class="line">nameserver 8.8.8.8</span><br><span class="line">nameserver 8.8.4.4</span><br><span class="line"></span><br><span class="line">åˆ·æ–°DNSä½¿ç”Ÿæ•ˆ</span><br><span class="line"></span><br><span class="line">resolvconf -u</span><br></pre></td></tr></table></figure><blockquote><p>resolv.conf æ–‡ä»¶å°±æ˜¯æ ¹æ®&#x2F;etc&#x2F;resolvconf&#x2F;resolv.conf.d ç›®å½•ä¸­çš„è¿™å‡ ä¸ªæ–‡ä»¶ç”Ÿæˆçš„ã€‚</p></blockquote><h3 id="æŸ¥çœ‹ç°åœ¨æ­£åœ¨ä½¿ç”¨çš„-DNS"><a href="#æŸ¥çœ‹ç°åœ¨æ­£åœ¨ä½¿ç”¨çš„-DNS" class="headerlink" title="æŸ¥çœ‹ç°åœ¨æ­£åœ¨ä½¿ç”¨çš„ DNS"></a>æŸ¥çœ‹ç°åœ¨æ­£åœ¨ä½¿ç”¨çš„ DNS</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemd-resolve --status</span><br></pre></td></tr></table></figure><h3 id="å¯åŠ¨é€Ÿåº¦æ…¢"><a href="#å¯åŠ¨é€Ÿåº¦æ…¢" class="headerlink" title="å¯åŠ¨é€Ÿåº¦æ…¢"></a>å¯åŠ¨é€Ÿåº¦æ…¢</h3><p>ç­‰åœ¨ <code>a start job is running for wait for network to be configured</code> å¾ˆä¹…ï¼Œ å¯ä»¥ç›´æ¥å…³é—­ <code>systemd-networkd-wait-online</code> æœåŠ¡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl mask systemd-networkd-wait-online.service</span><br></pre></td></tr></table></figure><h2 id="ç³»ç»Ÿé…ç½®"><a href="#ç³»ç»Ÿé…ç½®" class="headerlink" title="ç³»ç»Ÿé…ç½®"></a>ç³»ç»Ÿé…ç½®</h2><h3 id="æ£€æŸ¥è®¾å¤‡åŠ è½½æƒ…å†µ"><a href="#æ£€æŸ¥è®¾å¤‡åŠ è½½æƒ…å†µ" class="headerlink" title="æ£€æŸ¥è®¾å¤‡åŠ è½½æƒ…å†µ"></a>æ£€æŸ¥è®¾å¤‡åŠ è½½æƒ…å†µ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dmesg | grep eth</span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹é»˜è®¤ç¼–è¾‘å™¨"><a href="#ä¿®æ”¹é»˜è®¤ç¼–è¾‘å™¨" class="headerlink" title="ä¿®æ”¹é»˜è®¤ç¼–è¾‘å™¨"></a>ä¿®æ”¹é»˜è®¤ç¼–è¾‘å™¨</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo update-alternatives --config editor   <span class="comment"># ç”¨äº visudo ç­‰</span></span><br><span class="line">sudo select-editor                         <span class="comment"># ç”¨äº crontab -e ç­‰</span></span><br></pre></td></tr></table></figure><h3 id="å®‰è£…å­—ä½“"><a href="#å®‰è£…å­—ä½“" class="headerlink" title="å®‰è£…å­—ä½“"></a>å®‰è£…å­—ä½“</h3><p>ç³»ç»Ÿå­—ä½“ä½ç½® <code>/usr/share/fonts/</code>, å°†å­—ä½“å¤åˆ¶åˆ° <code>/usr/share/fonts/</code> ç›®å½•<br>ç”¨æˆ·å­—ä½“ä½ç½® <code>~/.local/share/fonts</code>, å°†å­—ä½“å¤åˆ¶åˆ° <code>~/.local/share/fonts</code> ç›®å½•</p><p><del>ç„¶ååˆ·æ–°å­—ä½“ç¼“å­˜ï¼Œ ç»æµ‹è¯•ä¸åˆ·æ–°ä¹Ÿå¯ä»¥ç”Ÿæ•ˆ</del></p><p><del>fc-cache -vf</del></p><h2 id="åŒ…ç®¡ç†"><a href="#åŒ…ç®¡ç†" class="headerlink" title="åŒ…ç®¡ç†"></a>åŒ…ç®¡ç†</h2><h3 id="å®‰è£…æœ¬åœ°åŒ…ï¼Œä¸å¤„ç†ä¾èµ–"><a href="#å®‰è£…æœ¬åœ°åŒ…ï¼Œä¸å¤„ç†ä¾èµ–" class="headerlink" title="å®‰è£…æœ¬åœ°åŒ…ï¼Œä¸å¤„ç†ä¾èµ–"></a>å®‰è£…æœ¬åœ°åŒ…ï¼Œä¸å¤„ç†ä¾èµ–</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dpkg -i ./xxx.deb</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…æœ¬åœ°åŒ…ï¼Œå¹¶è‡ªåŠ¨å¤„ç†ä¾èµ–"><a href="#å®‰è£…æœ¬åœ°åŒ…ï¼Œå¹¶è‡ªåŠ¨å¤„ç†ä¾èµ–" class="headerlink" title="å®‰è£…æœ¬åœ°åŒ…ï¼Œå¹¶è‡ªåŠ¨å¤„ç†ä¾èµ–"></a>å®‰è£…æœ¬åœ°åŒ…ï¼Œå¹¶è‡ªåŠ¨å¤„ç†ä¾èµ–</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install ./xxx.deb</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹ä¸€ä¸ªåŒ…æœ‰å“ªäº›æ–‡ä»¶ç»„æˆ"><a href="#æŸ¥çœ‹ä¸€ä¸ªåŒ…æœ‰å“ªäº›æ–‡ä»¶ç»„æˆ" class="headerlink" title="æŸ¥çœ‹ä¸€ä¸ªåŒ…æœ‰å“ªäº›æ–‡ä»¶ç»„æˆ"></a>æŸ¥çœ‹ä¸€ä¸ªåŒ…æœ‰å“ªäº›æ–‡ä»¶ç»„æˆ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dpkg -L vim</span><br></pre></td></tr></table></figure><h3 id="é”å®šç‰ˆæœ¬-ä¸æ›´æ–°"><a href="#é”å®šç‰ˆæœ¬-ä¸æ›´æ–°" class="headerlink" title="é”å®šç‰ˆæœ¬, ä¸æ›´æ–°"></a>é”å®šç‰ˆæœ¬, ä¸æ›´æ–°</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-mark hold kubelet kubeadm kubectl</span><br></pre></td></tr></table></figure><h3 id="æŸ¥è¯¢æ–‡ä»¶å±äºå“ªä¸ªåŒ…"><a href="#æŸ¥è¯¢æ–‡ä»¶å±äºå“ªä¸ªåŒ…" class="headerlink" title="æŸ¥è¯¢æ–‡ä»¶å±äºå“ªä¸ªåŒ…"></a>æŸ¥è¯¢æ–‡ä»¶å±äºå“ªä¸ªåŒ…</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">apt install -y apt-file</span><br><span class="line">apt-file update</span><br><span class="line">apt-file search libssl.so.1.1</span><br></pre></td></tr></table></figure><h3 id="ä¸‹è½½ç¦»çº¿åŒ…"><a href="#ä¸‹è½½ç¦»çº¿åŒ…" class="headerlink" title="ä¸‹è½½ç¦»çº¿åŒ…"></a>ä¸‹è½½ç¦»çº¿åŒ…</h3><p>åªä¸‹è½½ï¼Œä¸å®‰è£…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">rm</span> -f /var/cache/apt/archives/*.deb</span><br><span class="line">sudo apt install -d fio</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸‹è½½çš„debæ–‡ä»¶åœ¨</span></span><br><span class="line">/var/cache/apt/archives</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„åŒ…"><a href="#å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„åŒ…" class="headerlink" title="å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„åŒ…"></a>å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„åŒ…</h3><p>æŸ¥è¯¢æºå†…å¯ç”¨çš„åŒ…ç‰ˆæœ¬</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-cache madison docker-ce</span><br></pre></td></tr></table></figure><p>å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„åŒ…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install docker-ce=&lt;VERSION_STRING&gt;</span><br></pre></td></tr></table></figure><h3 id="éäº¤äº’å¼"><a href="#éäº¤äº’å¼" class="headerlink" title="éäº¤äº’å¼"></a>éäº¤äº’å¼</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh -c <span class="string">&#x27;DEBIAN_FRONTEND=noninteractive apt-get install -y -qq apt-transport-https ca-certificates curl &gt;/dev/null&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="ä¸å®‰è£…æ¨èçš„è½¯ä»¶åŒ…"><a href="#ä¸å®‰è£…æ¨èçš„è½¯ä»¶åŒ…" class="headerlink" title="ä¸å®‰è£…æ¨èçš„è½¯ä»¶åŒ…"></a>ä¸å®‰è£…æ¨èçš„è½¯ä»¶åŒ…</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get --no-install-recommends </span><br></pre></td></tr></table></figure><h2 id="å›¾å½¢ç•Œé¢"><a href="#å›¾å½¢ç•Œé¢" class="headerlink" title="å›¾å½¢ç•Œé¢"></a>å›¾å½¢ç•Œé¢</h2><h3 id="æ¡Œé¢å›¾æ ‡é…ç½®æ–‡ä»¶"><a href="#æ¡Œé¢å›¾æ ‡é…ç½®æ–‡ä»¶" class="headerlink" title="æ¡Œé¢å›¾æ ‡é…ç½®æ–‡ä»¶"></a>æ¡Œé¢å›¾æ ‡é…ç½®æ–‡ä»¶</h3><p>ç”¨æˆ·é…ç½®æ–‡ä»¶ä½ç½® <code>~/.local/share/applications</code><br>ç³»ç»Ÿé…ç½®æ–‡ä»¶ä½ç½®: <code>/usr/share/applications</code></p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Desktop Entry]</span></span><br><span class="line"><span class="attr">Name</span>=Visual Studio Code</span><br><span class="line"><span class="attr">Comment</span>=Code Editing. Redefined.</span><br><span class="line"><span class="attr">GenericName</span>=Text Editor</span><br><span class="line"><span class="attr">Exec</span>=/usr/share/code/code --<span class="literal">no</span>-sandbox --unity-launch %F</span><br><span class="line"><span class="attr">Icon</span>=com.visualstudio.code</span><br><span class="line"><span class="attr">Type</span>=Application</span><br><span class="line"><span class="attr">StartupNotify</span>=<span class="literal">false</span></span><br><span class="line"><span class="attr">StartupWMClass</span>=Code</span><br><span class="line"><span class="attr">Categories</span>=Utility<span class="comment">;TextEditor;Development;IDE;</span></span><br><span class="line"><span class="attr">MimeType</span>=text/plain<span class="comment">;inode/directory;application/x-code-workspace;</span></span><br><span class="line"><span class="attr">Actions</span>=new-empty-window<span class="comment">;</span></span><br><span class="line"><span class="attr">Keywords</span>=vscode<span class="comment">;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">X-Desktop-File-Install-Version</span>=<span class="number">0.24</span></span><br><span class="line"></span><br><span class="line"><span class="section">[Desktop Action new-empty-window]</span></span><br><span class="line"><span class="attr">Name</span>=New Empty Window</span><br><span class="line"><span class="attr">Exec</span>=/usr/share/code/code --<span class="literal">no</span>-sandbox --new-window %F</span><br><span class="line"><span class="attr">Icon</span>=com.visualstudio.code</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
            <tag> Crontab </tag>
            
            <tag> Linux </tag>
            
            <tag> Ubuntu </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>centoså¸¸ç”¨é…ç½®</title>
      <link href="/posts/6cc59126/"/>
      <url>/posts/6cc59126/</url>
      
        <content type="html"><![CDATA[<p>centos ç³»ç»Ÿå‡çº§è¯·çœ‹<br><a href="/posts/6d586ed1">Centos7 å‡çº§ RHEL8</a></p><h2 id="ç½‘ç»œé…ç½®"><a href="#ç½‘ç»œé…ç½®" class="headerlink" title="ç½‘ç»œé…ç½®"></a>ç½‘ç»œé…ç½®</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/sysconfig/network-scripts/ifcfg-ens**</span><br></pre></td></tr></table></figure><h3 id="å›ºå®š-ip-é…ç½®"><a href="#å›ºå®š-ip-é…ç½®" class="headerlink" title="å›ºå®š ip é…ç½®"></a>å›ºå®š ip é…ç½®</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">TYPE=Ethernet</span><br><span class="line">BOOTPROTO=none</span><br><span class="line">DEVICE=ens33</span><br><span class="line">ONBOOT=yes</span><br><span class="line">IPADDR=10.0.0.7</span><br><span class="line">PREFIX=24</span><br><span class="line">GATEWAY=10.0.0.2</span><br><span class="line">DNS1=10.0.0.2</span><br><span class="line">DNS2=223.5.5.5</span><br><span class="line">DOMAIN=10.0.0.2</span><br></pre></td></tr></table></figure><h3 id="DHCP-é…ç½®"><a href="#DHCP-é…ç½®" class="headerlink" title="DHCP é…ç½®"></a>DHCP é…ç½®</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">TYPE=Ethernet</span><br><span class="line">BOOTPROTO=dhcp</span><br><span class="line">PERSISTENT_DHCLIENT=yes</span><br><span class="line">DEVICE=ens33</span><br><span class="line">ONBOOT=yes</span><br></pre></td></tr></table></figure><h3 id="ä¸´æ—¶ä¿®æ”¹-IPï¼ˆé‡å¯å¤±æ•ˆï¼‰"><a href="#ä¸´æ—¶ä¿®æ”¹-IPï¼ˆé‡å¯å¤±æ•ˆï¼‰" class="headerlink" title="ä¸´æ—¶ä¿®æ”¹ IPï¼ˆé‡å¯å¤±æ•ˆï¼‰"></a>ä¸´æ—¶ä¿®æ”¹ IPï¼ˆé‡å¯å¤±æ•ˆï¼‰</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ifconfig eth0 192.168.120.56</span><br><span class="line">ifconfig eth0 192.168.120.56 netmask 255.255.255.0</span><br><span class="line">ifconfig eth0 192.168.120.56 netmask 255.255.255.0 broadcast 192.168.120.255</span><br></pre></td></tr></table></figure><h3 id="ä¸´æ—¶å¢åŠ -vip"><a href="#ä¸´æ—¶å¢åŠ -vip" class="headerlink" title="ä¸´æ—¶å¢åŠ  vip"></a>ä¸´æ—¶å¢åŠ  vip</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip addr add 192.168.20.20/24 brd + dev eth0</span><br></pre></td></tr></table></figure><h3 id="ç½‘å¡é…ç½®-VLAN"><a href="#ç½‘å¡é…ç½®-VLAN" class="headerlink" title="ç½‘å¡é…ç½® VLAN"></a>ç½‘å¡é…ç½® VLAN</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">TYPE=Vlan</span><br><span class="line">VLAN=yes</span><br><span class="line">VLAN_ID=180</span><br><span class="line">BOOTPROTO=none</span><br><span class="line">DEFROUTE=yes</span><br><span class="line">NAME=enp3s0f0</span><br><span class="line">DEVICE=enp3s0f0</span><br><span class="line">ONBOOT=yes</span><br><span class="line">IPADDR=192.168.20.230</span><br><span class="line">PREFIX=24</span><br><span class="line">GATEWAY=192.168.20.1</span><br><span class="line">DNS1=114.114.114.114</span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹ç½‘å¡å"><a href="#ä¿®æ”¹ç½‘å¡å" class="headerlink" title="ä¿®æ”¹ç½‘å¡å"></a>ä¿®æ”¹ç½‘å¡å</h3><blockquote><p>centos7 é»˜è®¤æ˜¯ä»¥æ¥å£åç§°è¢«è‡ªåŠ¨åŸºäºå›ºä»¶ï¼Œæ‹“æ‰‘ç»“æ„å’Œä½ç½®ä¿¡æ¯æ¥ç¡®å®šã€‚å¦‚ ens33,å¦‚æœæƒ³è¦ä»¥ eth0 æ¥å‘½å</p></blockquote><ul><li>å®‰è£…æ—¶é…ç½®</li></ul><p>å…‰æ ‡é€‰æ‹©â€œInstall CentOS 7â€<br>ç‚¹å‡» Tabï¼Œæ‰“å¼€ kernel å¯åŠ¨é€‰é¡¹åï¼Œå¢åŠ  <code>net.ifnames=0 biosdevname=0</code></p><h2 id="ç³»ç»Ÿé…ç½®"><a href="#ç³»ç»Ÿé…ç½®" class="headerlink" title="ç³»ç»Ÿé…ç½®"></a>ç³»ç»Ÿé…ç½®</h2><h3 id="å…³é—­-selinux"><a href="#å…³é—­-selinux" class="headerlink" title="å…³é—­ selinux"></a>å…³é—­ selinux</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i <span class="string">&#x27;s#SELINUX=enforcing#SELINUX=disabled#g&#x27;</span> /etc/sysconfig/selinux &amp;&amp; setenforce 0</span><br></pre></td></tr></table></figure><h3 id="timedatectl-å‘½ä»¤"><a href="#timedatectl-å‘½ä»¤" class="headerlink" title="timedatectl å‘½ä»¤"></a>timedatectl å‘½ä»¤</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">timedatectl list-timezones                    <span class="comment"># åˆ—å‡ºæ‰€æœ‰æ—¶åŒº</span></span><br><span class="line">timedatectl set-local-rtc 1                   <span class="comment"># å°†ç¡¬ä»¶æ—¶é’Ÿè°ƒæ•´ä¸ºä¸æœ¬åœ°æ—¶é’Ÿä¸€è‡´, 0 ä¸ºè®¾ç½®ä¸º UTC æ—¶é—´</span></span><br><span class="line">timedatectl set-timezone Asia/Shanghai        <span class="comment"># è®¾ç½®ç³»ç»Ÿæ—¶åŒºä¸ºä¸Šæµ·</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">timedatectl status                            <span class="comment"># æŸ¥çœ‹çŠ¶æ€</span></span><br><span class="line"></span><br><span class="line">timedatectl set-ntp 0                         <span class="comment"># ç¦ç”¨ntp</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åªè®¾ç½®æ—¶é—´çš„è¯å¯ä»¥ä½¿ç”¨set-timeå¼€å…³ä»¥åŠHHï¼šMMï¼šSSï¼ˆå°æ—¶ï¼Œåˆ†ï¼Œç§’ï¼‰çš„æ—¶é—´æ ¼å¼ã€‚</span></span><br><span class="line">timedatectl set-time 15:58:30</span><br><span class="line"></span><br><span class="line"><span class="comment"># åªè®¾ç½®æ—¥æœŸçš„è¯å¯ä»¥ä½¿ç”¨set-timeå¼€å…³ä»¥åŠYYï¼šMMï¼šDDï¼ˆå¹´ï¼Œæœˆï¼Œæ—¥ï¼‰çš„æ—¥æœŸæ ¼å¼ã€‚</span></span><br><span class="line">timedatectl set-time 20151120</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®æ—¥æœŸå’Œæ—¶é—´ï¼š</span></span><br><span class="line">timedatectl set-time <span class="string">&#x27;16:10:40 2015-11-20&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="ntp-æ—¶é—´åŒæ­¥"><a href="#ntp-æ—¶é—´åŒæ­¥" class="headerlink" title="ntp æ—¶é—´åŒæ­¥"></a>ntp æ—¶é—´åŒæ­¥</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yum install ntp ntpdate -y </span><br><span class="line"></span><br><span class="line">systemctl start ntpdate</span><br><span class="line"></span><br><span class="line">ntpdate time.windows.com</span><br></pre></td></tr></table></figure><blockquote><p>ntp åªä¼šåŒæ­¥ç³»ç»Ÿæ—¶é—´è€Œä¸ä¼šåŒæ­¥ç¡¬ä»¶æ—¶é—´ï¼Œè‹¥æœåŠ¡å™¨é‡å¯åˆ™ç³»ç»Ÿæ—¶é—´ä¼šå¤±æ•ˆï¼Œä¾æ—§ä»ç¡¬ä»¶æ—¶é—´å¼€å§‹è®¡æ—¶ï¼Œæ‰€ä»¥ä½¿ç”¨ ntp åŒæ­¥ç³»ç»Ÿæ—¶é—´åéœ€è¦å°†ç³»ç»Ÿæ—¶é—´åŒæ­¥åˆ°ç¡¬ä»¶æ—¶é—´ hwclock -w</p></blockquote><h3 id="ä¿®æ”¹å†…æ ¸å‚æ•°"><a href="#ä¿®æ”¹å†…æ ¸å‚æ•°" class="headerlink" title="ä¿®æ”¹å†…æ ¸å‚æ•°"></a>ä¿®æ”¹å†…æ ¸å‚æ•°</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysctl -w net.ipv4.ip_forward=1</span><br></pre></td></tr></table></figure><h3 id="å¿˜è®°å¯†ç "><a href="#å¿˜è®°å¯†ç " class="headerlink" title="å¿˜è®°å¯†ç "></a>å¿˜è®°å¯†ç </h3><p>é‡å¯, åœ¨ <code>grub2</code> ç•Œé¢ å…ˆæŒ‰ <code>â†‘</code> åœåœ¨è¿™ä¸ªç•Œé¢,ç„¶åæŒ‰ <code>e</code> è¿›å…¥ç¼–è¾‘æ¨¡å¼<br>æ‰¾åˆ° <code>linux16</code> é‚£ä¸€è¡Œ, åœ¨æœ€åé¢æ·»åŠ  <code>init=/bin/sh</code><br>æŒ‰ <code>ctrl + x</code> ç»§ç»­å¯åŠ¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mount -o remount,rw /</span><br><span class="line">passwd root</span><br><span class="line"></span><br><span class="line"><span class="built_in">touch</span> /.autorelabel     <span class="comment"># ä½¿selinuxç”Ÿæ•ˆï¼Œå¦åˆ™å¯èƒ½æ— æ³•æ­£å¸¸å¯åŠ¨</span></span><br><span class="line"><span class="built_in">exec</span> /sbin/init         <span class="comment"># æ­£å¸¸å¯åŠ¨ç³»ç»Ÿ</span></span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹æ—¶åŒº"><a href="#ä¿®æ”¹æ—¶åŒº" class="headerlink" title="ä¿®æ”¹æ—¶åŒº"></a>ä¿®æ”¹æ—¶åŒº</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹é»˜è®¤è¯­è¨€</span></span><br><span class="line">sed -i <span class="string">&#x27;s@LANG=.*$@LANG=&quot;en_US.UTF-8&quot;@g&#x27;</span> /etc/locale.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># é€šè¿‡ç¯å¢ƒå˜é‡è®¾ç½®æ—¶åŒº</span></span><br><span class="line"><span class="built_in">export</span> TZ=<span class="string">&#x27;Asia/Shanghai&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹æ—¶åŒº(ä¿®æ”¹ç¯å¢ƒå˜é‡åå°±æ²¡å¿…è¦è¿™æ ·ä¿®æ”¹äº†)</span></span><br><span class="line"><span class="built_in">rm</span> -rf /etc/localtime</span><br><span class="line"><span class="built_in">ln</span> -s /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…ç›¸åº”å­—ä½“"><a href="#å®‰è£…ç›¸åº”å­—ä½“" class="headerlink" title="å®‰è£…ç›¸åº”å­—ä½“"></a>å®‰è£…ç›¸åº”å­—ä½“</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install dejavu-lgc-sans-fonts</span><br></pre></td></tr></table></figure><h3 id="å…¨å±€ä»£ç†"><a href="#å…¨å±€ä»£ç†" class="headerlink" title="å…¨å±€ä»£ç†"></a>å…¨å±€ä»£ç†</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/profile</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> http_proxy=<span class="string">&quot;http://10.0.0.1:21882&quot;</span></span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure><h2 id="æœåŠ¡"><a href="#æœåŠ¡" class="headerlink" title="æœåŠ¡"></a>æœåŠ¡</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">systemctl list-units                    <span class="comment">##åˆ—å‡ºå½“å‰ç³»ç»ŸæœåŠ¡çš„çŠ¶æ€</span></span><br><span class="line">systemctl list-unit-files               <span class="comment">##åˆ—å‡ºæœåŠ¡çš„å¼€æœºçŠ¶æ€</span></span><br><span class="line">systemctl status sshd                   <span class="comment">##æŸ¥çœ‹æŒ‡å®šæœåŠ¡çš„çŠ¶æ€</span></span><br><span class="line">systemctl stop sshd                     <span class="comment">##å…³é—­æŒ‡å®šæœåŠ¡</span></span><br><span class="line">systemctl start sshd                    <span class="comment">##å¼€å¯æŒ‡å®šæœåŠ¡</span></span><br><span class="line">systemctl restart sshd                  <span class="comment">##ä»æ–°å¯åŠ¨æœåŠ¡</span></span><br><span class="line">systemctl <span class="built_in">enable</span> sshd                   <span class="comment">##è®¾å®šæŒ‡å®šæœåŠ¡å¼€æœºå¼€å¯</span></span><br><span class="line">systemctl <span class="built_in">disable</span> sshd                  <span class="comment">##è®¾å®šæŒ‡å®šæœåŠ¡å¼€æœºå…³é—­</span></span><br><span class="line">systemctl reload sshd                   <span class="comment">##ä½¿æŒ‡å®šæœåŠ¡ä»æ–°åŠ è½½é…ç½®</span></span><br><span class="line">systemctl list-dependencies sshd        <span class="comment">##æŸ¥çœ‹æŒ‡å®šæœåŠ¡çš„å€šèµ–å…³ç³»</span></span><br><span class="line">systemctl mask  sshd                    <span class="comment">##å†»ç»“æŒ‡å®šæœåŠ¡</span></span><br><span class="line">systemctl unmask sshd                   <span class="comment">##å¯ç”¨æœåŠ¡</span></span><br><span class="line">systemctl set-default multi-user.target <span class="comment">##å¼€æœºä¸å¼€å¯å›¾å½¢</span></span><br><span class="line">systemctl set-default graphical.target  <span class="comment">##å¼€æœºå¯åŠ¨å›¾å½¢</span></span><br><span class="line">setterm                                 <span class="comment">##æ–‡æœ¬ç•Œé¢è®¾å®šcolor</span></span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹æ‰€æœ‰çš„-service"><a href="#æŸ¥çœ‹æ‰€æœ‰çš„-service" class="headerlink" title="æŸ¥çœ‹æ‰€æœ‰çš„ service"></a>æŸ¥çœ‹æ‰€æœ‰çš„ service</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ll /usr/lib/systemd/system/</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹å¼€æœºè‡ªå¯çš„-service"><a href="#æŸ¥çœ‹å¼€æœºè‡ªå¯çš„-service" class="headerlink" title="æŸ¥çœ‹å¼€æœºè‡ªå¯çš„ service"></a>æŸ¥çœ‹å¼€æœºè‡ªå¯çš„ service</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl list-unit-files | grep enabled</span><br><span class="line">ll /etc/systemd/system/multi-user.target.wants/</span><br></pre></td></tr></table></figure><h3 id="hostnamectl-å‘½ä»¤"><a href="#hostnamectl-å‘½ä»¤" class="headerlink" title="hostnamectl å‘½ä»¤"></a>hostnamectl å‘½ä»¤</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hostnamectl set-hostname centos1</span><br></pre></td></tr></table></figure><h3 id="é˜²ç«å¢™"><a href="#é˜²ç«å¢™" class="headerlink" title="é˜²ç«å¢™"></a>é˜²ç«å¢™</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl start firewalld.service</span><br><span class="line">systemctl stop firewalld.service</span><br><span class="line">systemctl <span class="built_in">disable</span> firewalld.service</span><br></pre></td></tr></table></figure><h2 id="åŸºç¡€ç¯å¢ƒ"><a href="#åŸºç¡€ç¯å¢ƒ" class="headerlink" title="åŸºç¡€ç¯å¢ƒ"></a>åŸºç¡€ç¯å¢ƒ</h2><h3 id="ç¼–è¯‘ç¯å¢ƒ"><a href="#ç¼–è¯‘ç¯å¢ƒ" class="headerlink" title="ç¼–è¯‘ç¯å¢ƒ"></a>ç¼–è¯‘ç¯å¢ƒ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum groupinstall <span class="string">&quot;Development Tools&quot;</span></span><br></pre></td></tr></table></figure><h2 id="yum-å’Œ-rpm"><a href="#yum-å’Œ-rpm" class="headerlink" title="yum å’Œ rpm"></a>yum å’Œ rpm</h2><blockquote><p>yum æ˜¯ç”¨ python å†™çš„</p></blockquote><h3 id="æŸ¥çœ‹ä¸€ä¸ªåŒ…æœ‰å“ªäº›æ–‡ä»¶ç»„æˆ"><a href="#æŸ¥çœ‹ä¸€ä¸ªåŒ…æœ‰å“ªäº›æ–‡ä»¶ç»„æˆ" class="headerlink" title="æŸ¥çœ‹ä¸€ä¸ªåŒ…æœ‰å“ªäº›æ–‡ä»¶ç»„æˆ"></a>æŸ¥çœ‹ä¸€ä¸ªåŒ…æœ‰å“ªäº›æ–‡ä»¶ç»„æˆ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -ql yum</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹æ‰€æœ‰åŒ…åˆ—è¡¨"><a href="#æŸ¥çœ‹æ‰€æœ‰åŒ…åˆ—è¡¨" class="headerlink" title="æŸ¥çœ‹æ‰€æœ‰åŒ…åˆ—è¡¨"></a>æŸ¥çœ‹æ‰€æœ‰åŒ…åˆ—è¡¨</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -qa</span><br></pre></td></tr></table></figure><h3 id="æœ¬åœ°å®‰è£…åŒ…-ä¼šè‡ªåŠ¨å¤„ç†ä¾èµ–"><a href="#æœ¬åœ°å®‰è£…åŒ…-ä¼šè‡ªåŠ¨å¤„ç†ä¾èµ–" class="headerlink" title="æœ¬åœ°å®‰è£…åŒ…,ä¼šè‡ªåŠ¨å¤„ç†ä¾èµ–"></a>æœ¬åœ°å®‰è£…åŒ…,ä¼šè‡ªåŠ¨å¤„ç†ä¾èµ–</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum localinstall ./xxx.rpm</span><br></pre></td></tr></table></figure><h3 id="æœ¬åœ°å®‰è£…åŒ…ï¼Œä¸å¤„ç†ä¾èµ–"><a href="#æœ¬åœ°å®‰è£…åŒ…ï¼Œä¸å¤„ç†ä¾èµ–" class="headerlink" title="æœ¬åœ°å®‰è£…åŒ…ï¼Œä¸å¤„ç†ä¾èµ–"></a>æœ¬åœ°å®‰è£…åŒ…ï¼Œä¸å¤„ç†ä¾èµ–</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -ivh ./xxx.rpm</span><br></pre></td></tr></table></figure><h3 id="é˜¿é‡Œäº‘æº"><a href="#é˜¿é‡Œäº‘æº" class="headerlink" title="é˜¿é‡Œäº‘æº"></a>é˜¿é‡Œäº‘æº</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mv</span> /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup</span><br><span class="line"></span><br><span class="line"><span class="comment"># CentOS 7</span></span><br><span class="line">curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span><br><span class="line"><span class="comment"># éé˜¿é‡Œäº‘ECSç”¨æˆ·</span></span><br><span class="line">sed -i -e <span class="string">&#x27;/mirrors.cloud.aliyuncs.com/d&#x27;</span> -e <span class="string">&#x27;/mirrors.aliyuncs.com/d&#x27;</span> /etc/yum.repos.d/CentOS-Base.repo</span><br><span class="line"></span><br><span class="line"><span class="comment"># epel(RHEL 7)</span></span><br><span class="line">curl -o /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo</span><br></pre></td></tr></table></figure><h3 id="Remi-æº-å„ç§ç‰ˆæœ¬çš„-php"><a href="#Remi-æº-å„ç§ç‰ˆæœ¬çš„-php" class="headerlink" title="Remi æº (å„ç§ç‰ˆæœ¬çš„ php)"></a>Remi æº (å„ç§ç‰ˆæœ¬çš„ php)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install https://mirrors.aliyun.com/remi/enterprise/remi-release-7.rpm</span><br><span class="line"></span><br><span class="line">yum install php74-php-fpm</span><br></pre></td></tr></table></figure><h3 id="æŸ¥è¯¢ä¸€ä¸ªæ–‡ä»¶å±äºå“ªä¸ªåŒ…"><a href="#æŸ¥è¯¢ä¸€ä¸ªæ–‡ä»¶å±äºå“ªä¸ªåŒ…" class="headerlink" title="æŸ¥è¯¢ä¸€ä¸ªæ–‡ä»¶å±äºå“ªä¸ªåŒ…"></a>æŸ¥è¯¢ä¸€ä¸ªæ–‡ä»¶å±äºå“ªä¸ªåŒ…</h3><ul><li>æœ¬æœºå·²ç»æœ‰è¿™ä¸ªæ–‡ä»¶ï¼Œæƒ³çŸ¥é“åœ¨å“ªä¸ªåŒ…é‡Œé¢</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -qf  /file/path</span><br></pre></td></tr></table></figure><ul><li>ç¼ºå°‘æ–‡ä»¶, æƒ³çŸ¥é“åœ¨å“ªä¸ªåŒ…é‡Œé¢ï¼Œæ–¹ä¾¿å®‰è£…</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum provides libm.so.6</span><br></pre></td></tr></table></figure><h3 id="åªä¸‹è½½ä¸å®‰è£…"><a href="#åªä¸‹è½½ä¸å®‰è£…" class="headerlink" title="åªä¸‹è½½ä¸å®‰è£…"></a>åªä¸‹è½½ä¸å®‰è£…</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yum install --downloadonly --downloaddir=/tmp/ vsftpd</span><br><span class="line"></span><br><span class="line"><span class="comment"># æˆ–è€…ä½¿ç”¨</span></span><br><span class="line">yumdownloader --resolve --destdir=./aa/ lrzsz</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„åŒ…"><a href="#å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„åŒ…" class="headerlink" title="å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„åŒ…"></a>å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„åŒ…</h3><p>æŸ¥è¯¢åŒ…æœ‰é‚£äº›å¯ç”¨çš„ç‰ˆæœ¬</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum list kubelet kubeadm kubectl  --showduplicates | <span class="built_in">sort</span> -r</span><br></pre></td></tr></table></figure><p>å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„åŒ…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install kubelet-1.16.9-0 kubeadm-1.16.9-0 kubectl-1.16.9-0</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
            <tag> Linux </tag>
            
            <tag> CentOS </tag>
            
            <tag> Systemd </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é™æ€åšå®¢ç”Ÿæˆå·¥å…·hexo</title>
      <link href="/posts/ab21860c/"/>
      <url>/posts/ab21860c/</url>
      
        <content type="html"><![CDATA[<p>hugo æ–‡æ¡£è¯·çœ‹ <a href="/tags/hugo">hugo</a></p><h2 id="å®‰è£…-nodejs-yarn-hexo"><a href="#å®‰è£…-nodejs-yarn-hexo" class="headerlink" title="å®‰è£… nodejs yarn hexo"></a>å®‰è£… nodejs yarn hexo</h2><blockquote><p>æ¨èä½¿ç”¨ yarn æ¥ä»£æ›¿ npm<br>é¦–å…ˆå®‰è£… nodejsï¼Œå’Œ npm, ç„¶åå†å®‰è£… yarn</p></blockquote><h3 id="å®‰è£…-yarn"><a href="#å®‰è£…-yarn" class="headerlink" title="å®‰è£… yarn"></a>å®‰è£… yarn</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g yarn</span><br></pre></td></tr></table></figure><h3 id="è®¾ç½®æ·˜å®æº"><a href="#è®¾ç½®æ·˜å®æº" class="headerlink" title="è®¾ç½®æ·˜å®æº"></a>è®¾ç½®æ·˜å®æº</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn config <span class="built_in">set</span> registry https://registry.npm.taobao.org -g</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…-hexo"><a href="#å®‰è£…-hexo" class="headerlink" title="å®‰è£… hexo"></a>å®‰è£… hexo</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn global add hexo-cli</span><br></pre></td></tr></table></figure><h3 id="åˆ›å»ºæ–°é¡¹ç›®"><a href="#åˆ›å»ºæ–°é¡¹ç›®" class="headerlink" title="åˆ›å»ºæ–°é¡¹ç›®"></a>åˆ›å»ºæ–°é¡¹ç›®</h3><blockquote><p>å¦‚æœæ‰¾ä¸åˆ° hexo,è¯·æŠŠ <code>yarn global bin</code> æ·»åŠ åˆ°ç¯å¢ƒå˜é‡</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo init myblog</span><br></pre></td></tr></table></figure><h2 id="ä¿®æ”¹é…ç½®"><a href="#ä¿®æ”¹é…ç½®" class="headerlink" title="ä¿®æ”¹é…ç½®"></a>ä¿®æ”¹é…ç½®</h2><h3 id="ä¿®æ”¹è¯­è¨€ä¸ºä¸­æ–‡"><a href="#ä¿®æ”¹è¯­è¨€ä¸ºä¸­æ–‡" class="headerlink" title="ä¿®æ”¹è¯­è¨€ä¸ºä¸­æ–‡"></a>ä¿®æ”¹è¯­è¨€ä¸ºä¸­æ–‡</h3><p>vim myblog&#x2F;_config.yml</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Site</span></span><br><span class="line"><span class="attr">title:</span> <span class="string">å¼ ç†å¤çš„åšå®¢</span></span><br><span class="line"><span class="attr">subtitle:</span> <span class="string">&#x27;é£æœºå¸ˆçš„é£è¡£&#x27;</span></span><br><span class="line"><span class="attr">keywords:</span></span><br><span class="line"><span class="attr">author:</span> <span class="string">å¼ ç†å¤</span></span><br><span class="line"><span class="attr">language:</span> <span class="string">zh-CN</span></span><br><span class="line"><span class="attr">timezone:</span> <span class="string">&#x27;Asia/Shanghai&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="å®‰è£…-next-ä¸»é¢˜"><a href="#å®‰è£…-next-ä¸»é¢˜" class="headerlink" title="å®‰è£… next ä¸»é¢˜"></a>å®‰è£… next ä¸»é¢˜</h3><p>github åœ°å€ï¼š<a href="https://github.com/theme-next/hexo-theme-next">https://github.com/theme-next/hexo-theme-next</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/theme-next/hexo-theme-next themes/next</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ theme é…ç½®æ–‡ä»¶ <code>vim next/_config.yml</code><br><code>scheme: Pisces</code></p><h3 id="æ·»åŠ æœç´¢åŠŸèƒ½"><a href="#æ·»åŠ æœç´¢åŠŸèƒ½" class="headerlink" title="æ·»åŠ æœç´¢åŠŸèƒ½"></a>æ·»åŠ æœç´¢åŠŸèƒ½</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add hexo-generator-searchdb</span><br></pre></td></tr></table></figure><p>ç„¶åä¸»é¢˜é…ç½®æ–‡ä»¶ <code>next/_config.yml</code><br><code>local_search:</code> æ ‡ç­¾ï¼Œé…ç½®å‚æ•° <code>enable: true</code></p><h3 id="æ·»åŠ çœ‹æ¿å¨˜"><a href="#æ·»åŠ çœ‹æ¿å¨˜" class="headerlink" title="æ·»åŠ çœ‹æ¿å¨˜"></a>æ·»åŠ çœ‹æ¿å¨˜</h3><blockquote><p>git åœ°å€ï¼š <a href="https://github.com/EYHN/hexo-helper-live2d/blob/master/README.zh-CN.md">https://github.com/EYHN/hexo-helper-live2d/blob/master/README.zh-CN.md</a></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yarn add hexo-helper-live2d</span><br><span class="line">yarn add live2d-widget-model-epsilon2_1</span><br></pre></td></tr></table></figure><p>åœ¨ <code>_config.yml</code> æ·»åŠ ä¸‹é¢é…ç½®</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">live2d:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">scriptFrom:</span> <span class="string">local</span></span><br><span class="line">  <span class="attr">pluginRootPath:</span> <span class="string">live2dw/</span></span><br><span class="line">  <span class="attr">pluginJsPath:</span> <span class="string">lib/</span></span><br><span class="line">  <span class="attr">pluginModelPath:</span> <span class="string">assets/</span></span><br><span class="line">  <span class="attr">tagMode:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">log:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">model:</span></span><br><span class="line">    <span class="attr">use:</span> <span class="string">live2d-widget-model-epsilon2_1</span></span><br><span class="line">  <span class="attr">display:</span></span><br><span class="line">    <span class="attr">position:</span> <span class="string">right</span></span><br><span class="line">    <span class="attr">width:</span> <span class="number">150</span></span><br><span class="line">    <span class="attr">height:</span> <span class="number">300</span></span><br><span class="line">  <span class="attr">mobile:</span></span><br><span class="line">    <span class="attr">show:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">react:</span></span><br><span class="line">    <span class="attr">opacity:</span> <span class="number">0.7</span></span><br></pre></td></tr></table></figure><blockquote><p>module.use é‡Œé¢çš„å’Œä½ å®‰è£…çš„è¦ä¸€æ ·</p></blockquote><h3 id="è®¾ç½®å¤´åƒ"><a href="#è®¾ç½®å¤´åƒ" class="headerlink" title="è®¾ç½®å¤´åƒ"></a>è®¾ç½®å¤´åƒ</h3><ul><li>å°†å›¾ç‰‡æ”¾å…¥ åšå®¢ç›®å½•&#x2F;themes&#x2F;next&#x2F;source&#x2F;imagesï¼Œå¹¶é‡å‘½åä¸º avatar.[æ ¼å¼]</li><li>ç¼–è¾‘ä¸»é¢˜é…ç½®æ–‡ä»¶ _config.yml<br><code>vim åšå®¢ç›®å½•/themes/next/_config.yml</code></li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">avatar:</span> <span class="string">/images/avatar.png</span></span><br></pre></td></tr></table></figure><h3 id="æ·»åŠ åˆ†ç±»å’Œæ ‡ç­¾"><a href="#æ·»åŠ åˆ†ç±»å’Œæ ‡ç­¾" class="headerlink" title="æ·»åŠ åˆ†ç±»å’Œæ ‡ç­¾"></a>æ·»åŠ åˆ†ç±»å’Œæ ‡ç­¾</h3><h4 id="åˆ†ç±»"><a href="#åˆ†ç±»" class="headerlink" title="åˆ†ç±»"></a>åˆ†ç±»</h4><p><code>hexo new page categories</code><br>æˆåŠŸåä¼šæç¤ºï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INFO  Created: ~/Documents/blog/source/categories/index.md</span><br></pre></td></tr></table></figure><p>æ·»åŠ  <code>type: &quot;categories&quot;</code> åˆ° index.md ä¸­:</p><figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: æ–‡ç« åˆ†ç±»</span><br><span class="line">date: 2017-05-27 13:47:40</span><br><span class="line"><span class="section">type: &quot;categories&quot;</span></span><br><span class="line"><span class="section">---</span></span><br></pre></td></tr></table></figure><p>ç»™æ–‡ç« æ·»åŠ â€œcategoriesâ€å±æ€§<br>æ‰“å¼€éœ€è¦æ·»åŠ åˆ†ç±»çš„æ–‡ç« ï¼Œä¸ºå…¶æ·»åŠ  categories å±æ€§ã€‚<br>æ³¨æ„ï¼šhexo ä¸€ç¯‡æ–‡ç« åªèƒ½å±äºä¸€ä¸ªåˆ†ç±»ï¼Œå¦‚æœå†™ä¸¤ä¸ªåˆ†ç±»ï¼Œåˆ™æ˜¯ç»™åˆ†ç±»åµŒå¥—</p><figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: hexo</span><br><span class="line">abbrlink: ab21860c</span><br><span class="line"><span class="section">date: 2021-02-02 17:28:26</span></span><br><span class="line"><span class="section">---</span></span><br></pre></td></tr></table></figure><h4 id="æ ‡ç­¾"><a href="#æ ‡ç­¾" class="headerlink" title="æ ‡ç­¾"></a>æ ‡ç­¾</h4><p>ç”Ÿæˆâ€œæ ‡ç­¾â€é¡µå¹¶æ·»åŠ  tpye å±æ€§<br>æ‰“å¼€å‘½ä»¤è¡Œï¼Œè¿›å…¥åšå®¢æ‰€åœ¨æ–‡ä»¶å¤¹ã€‚æ‰§è¡Œå‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo new page tags</span><br></pre></td></tr></table></figure><p>æˆåŠŸåä¼šæç¤ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INFO  Created: ~/Documents/blog/source/tags/index.md</span><br></pre></td></tr></table></figure><p>æ ¹æ®ä¸Šé¢çš„è·¯å¾„ï¼Œæ‰¾åˆ° index.md è¿™ä¸ªæ–‡ä»¶, æ·»åŠ  <code>type: &quot;tags&quot;</code></p><figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: æ–‡ç« åˆ†ç±»</span><br><span class="line">date: 2017-05-27 13:47:40</span><br><span class="line"><span class="section">type: &quot;tags&quot;</span></span><br><span class="line"><span class="section">---</span></span><br></pre></td></tr></table></figure><p>æ–‡ç« æ·»åŠ  <code>tags</code></p><figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: hexo</span><br><span class="line">abbrlink: ab21860c</span><br><span class="line"><span class="section">date: 2021-02-02 17:28:26</span></span><br><span class="line"><span class="section">---</span></span><br></pre></td></tr></table></figure><h3 id="æ·»åŠ å›¾ç‰‡"><a href="#æ·»åŠ å›¾ç‰‡" class="headerlink" title="æ·»åŠ å›¾ç‰‡"></a>æ·»åŠ å›¾ç‰‡</h3><p>å®‰è£…æ’ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add https://github.com/iuxt/hexo-asset-image.git</span><br></pre></td></tr></table></figure><p><code>vim myblog/_config.yml</code></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">post_asset_folder:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><p>åˆ›å»ºæ–°æ–‡ç« </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo new <span class="built_in">test</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨</p><p>å°†å›¾ç‰‡æ”¾åœ¨åŒåæ–‡ä»¶å¤¹, åœ¨ md é‡Œé¢å¼•ç”¨</p><figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">![<span class="string">pilot</span>](<span class="link">pilot.jpg</span>)</span><br></pre></td></tr></table></figure><h3 id="è‡ªå®šä¹‰åŸŸå"><a href="#è‡ªå®šä¹‰åŸŸå" class="headerlink" title="è‡ªå®šä¹‰åŸŸå"></a>è‡ªå®šä¹‰åŸŸå</h3><ol><li><p>åœ¨ <code>source</code> ç›®å½•æ·»åŠ  <code>CNAME</code> æ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹æ˜¯ä½ çš„åŸŸå</p></li><li><p>æ·»åŠ è§£æ CNAME åˆ° github çš„åŸŸå</p></li></ol><h2 id="å¼€å§‹å†™æ–‡ç« "><a href="#å¼€å§‹å†™æ–‡ç« " class="headerlink" title="å¼€å§‹å†™æ–‡ç« "></a>å¼€å§‹å†™æ–‡ç« </h2><h3 id="æ–°åˆ›å»ºæ–‡ç« "><a href="#æ–°åˆ›å»ºæ–‡ç« " class="headerlink" title="æ–°åˆ›å»ºæ–‡ç« "></a>æ–°åˆ›å»ºæ–‡ç« </h3><p><code>hexo new &lt;æ ‡é¢˜&gt;</code></p><p>ç„¶åç¼–è¾‘ <code>vim source/_posts/&lt;æ ‡é¢˜&gt;.md</code></p><h3 id="æœ¬åœ°æŸ¥çœ‹æ•ˆæœ"><a href="#æœ¬åœ°æŸ¥çœ‹æ•ˆæœ" class="headerlink" title="æœ¬åœ°æŸ¥çœ‹æ•ˆæœ"></a>æœ¬åœ°æŸ¥çœ‹æ•ˆæœ</h3><p><code>hexo s</code></p><h3 id="å‘å¸ƒæ–‡ç« "><a href="#å‘å¸ƒæ–‡ç« " class="headerlink" title="å‘å¸ƒæ–‡ç« "></a>å‘å¸ƒæ–‡ç« </h3><p>å®‰è£… git æ’ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add hexo-deployer-git</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ hexo é…ç½®æ–‡ä»¶ vim hexo&#x2F;_config.ymlï¼Œé…ç½® git åœ°å€</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">theme:</span> <span class="string">next</span></span><br><span class="line"></span><br><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">&#x27;git&#x27;</span></span><br><span class="line">  <span class="attr">repo:</span> [<span class="string">&#x27;git@gitee.com:iuxt/iuxt.git&#x27;</span>, <span class="string">&#x27;git@github.com:iuxt/iuxt.github.io.git&#x27;</span>]</span><br><span class="line">  <span class="attr">branch:</span> <span class="string">master</span></span><br><span class="line">  <span class="attr">message:</span> <span class="string">&#x27;hexo update&#x27;</span></span><br></pre></td></tr></table></figure><p>å‘å¸ƒ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo clean &amp;&amp; hexo d</span><br></pre></td></tr></table></figure><h2 id="ä¼˜åŒ–"><a href="#ä¼˜åŒ–" class="headerlink" title="ä¼˜åŒ–"></a>ä¼˜åŒ–</h2><h3 id="url-æ ¼å¼ä¼˜åŒ–"><a href="#url-æ ¼å¼ä¼˜åŒ–" class="headerlink" title="url æ ¼å¼ä¼˜åŒ–"></a>url æ ¼å¼ä¼˜åŒ–</h3><blockquote><p>æœ‰äººç»™æˆ‘è¯„è®ºäº†, ä½†æ˜¯åé¢æˆ‘æ›´æ–°äº†ä¸€ä¸‹ç›®å½•ç»“æ„, å‘ç°è¯„è®ºä¸¢å¤±äº†, ç©¶å…¶åŸå› æ˜¯å› ä¸ºæ–‡ç« çš„ url å˜äº†ï¼Œæ‰€ä»¥æƒ³å°†æ–‡ç« çš„ url å›ºå®šä¸‹æ¥ï¼Œä¹Ÿä¾¿äº seo<br>é»˜è®¤çš„ç”Ÿæˆè§„åˆ™æ˜¯ï¼š<code>:year/:month/:day/:title</code>ï¼Œæ˜¯æŒ‰ç…§å¹´ã€æœˆã€æ—¥ã€æ ‡é¢˜æ¥ç”Ÿæˆçš„ã€‚æ¯”å¦‚ï¼š<code>https://iuxt.gitee.io/2021/05/08/%E5%B7%A5%E5%85%B7/adb%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/</code></p></blockquote><h4 id="å®‰è£…æ’ä»¶"><a href="#å®‰è£…æ’ä»¶" class="headerlink" title="å®‰è£…æ’ä»¶"></a>å®‰è£…æ’ä»¶</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn global add hexo-abbrlink</span><br></pre></td></tr></table></figure><p>vim config.yml</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">permalink:</span> <span class="string">:abbrlink/</span></span><br><span class="line"><span class="comment"># abbrlink config</span></span><br><span class="line"><span class="attr">abbrlink:</span></span><br><span class="line">  <span class="attr">alg:</span> <span class="string">crc32</span>  <span class="comment"># ç®—æ³•ï¼šcrc16(default) and crc32</span></span><br><span class="line">  <span class="attr">rep:</span> <span class="string">hex</span>    <span class="comment"># è¿›åˆ¶ï¼šdec(default) and hex</span></span><br></pre></td></tr></table></figure><h2 id="seo"><a href="#seo" class="headerlink" title="seo"></a>seo</h2><h3 id="robots-txt"><a href="#robots-txt" class="headerlink" title="robots.txt"></a>robots.txt</h3><p>åœ¨ <code>source</code> ç›®å½•ä¸‹åˆ›å»º <code>robots.txt</code> æ–‡ä»¶</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># welcome to : iuxt.<span class="property">github</span>.<span class="property">io</span></span><br><span class="line"><span class="title class_">User</span>-<span class="attr">agent</span>: *</span><br><span class="line"><span class="title class_">Allow</span>: /</span><br><span class="line"><span class="title class_">Allow</span>: <span class="regexp">/archives/</span></span><br><span class="line"><span class="title class_">Allow</span>: <span class="regexp">/categories/</span></span><br><span class="line"><span class="title class_">Allow</span>: <span class="regexp">/about/</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Disallow</span>: <span class="regexp">/js/</span></span><br><span class="line"><span class="title class_">Disallow</span>: <span class="regexp">/css/</span></span><br><span class="line"><span class="title class_">Disallow</span>: <span class="regexp">/fonts/</span></span><br><span class="line"><span class="title class_">Disallow</span>: <span class="regexp">/vendors/</span></span><br><span class="line"><span class="title class_">Disallow</span>: <span class="regexp">/lib/</span></span><br><span class="line"><span class="title class_">Sitemap</span>: <span class="attr">https</span>:<span class="comment">//iuxt.github.io/sitemap.xml</span></span><br></pre></td></tr></table></figure><h3 id="sitemap-xml"><a href="#sitemap-xml" class="headerlink" title="sitemap.xml"></a>sitemap.xml</h3><p>å®‰è£…æ’ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yarn add hexo-generator-sitemap</span><br><span class="line">yarn add hexo-generator-baidu-sitemap</span><br></pre></td></tr></table></figure><p><code>themes/next/_config.yml</code> æ·»åŠ </p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">baidusitemap:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">baidusitemap.xml</span></span><br><span class="line"><span class="attr">sitemap:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">sitemap.xml</span></span><br></pre></td></tr></table></figure><p>ç„¶å <code>hexo g</code>, çœ‹ä¸‹ <code>public</code> ç›®å½•ä¸‹æœ‰æ²¡æœ‰ç”Ÿæˆ <code>sitemap.xml</code> å’Œ <code>baidusitemap.xml</code> æ–‡ä»¶</p>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Blog </tag>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxå¸¸ç”¨å‘½ä»¤ä¹‹lsof</title>
      <link href="/posts/ls0614ms/"/>
      <url>/posts/ls0614ms/</url>
      
        <content type="html"><![CDATA[<p>lsofï¼ˆlist open filesï¼‰æ˜¯ä¸€ä¸ªåˆ—å‡ºå½“å‰ç³»ç»Ÿæ‰“å¼€æ–‡ä»¶çš„å·¥å…·ã€‚åœ¨ linux ç¯å¢ƒä¸‹ï¼Œä»»ä½•äº‹ç‰©éƒ½ä»¥æ–‡ä»¶çš„å½¢å¼å­˜åœ¨ï¼Œé€šè¿‡æ–‡ä»¶ä¸ä»…ä»…å¯ä»¥è®¿é—®å¸¸è§„æ•°æ®ï¼Œè¿˜å¯ä»¥è®¿é—®ç½‘ç»œè¿æ¥å’Œç¡¬ä»¶ã€‚</p><h2 id="å¸¸ç”¨å‚æ•°"><a href="#å¸¸ç”¨å‚æ•°" class="headerlink" title="å¸¸ç”¨å‚æ•°"></a>å¸¸ç”¨å‚æ•°</h2><table><thead><tr><th>å‚æ•°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>-p</td><td>æ ¹æ® pid æŸ¥æ‰¾</td></tr><tr><td>ç›´æ¥åŠ æ–‡ä»¶è·¯å¾„</td><td>æŸ¥çœ‹è¿™ä¸ªæ–‡ä»¶è¢«å“ªä¸ªè¿›ç¨‹æ‰“å¼€äº†</td></tr><tr><td>-c</td><td>æ˜¾ç¤º COMMAND åˆ—ä¸­åŒ…å«æŒ‡å®šå­—ç¬¦çš„è¿›ç¨‹æ‰€æœ‰æ‰“å¼€çš„æ–‡ä»¶</td></tr><tr><td>lsof -u username</td><td>æ˜¾ç¤ºæ‰€å± user è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶</td></tr><tr><td>-i</td><td>ç”¨ä»¥æ˜¾ç¤ºç¬¦åˆæ¡ä»¶çš„è¿›ç¨‹æƒ…å†µ</td></tr><tr><td>lsof -g gid</td><td>æ˜¾ç¤ºå½’å± gid çš„è¿›ç¨‹æƒ…å†µ</td></tr><tr><td>lsof +d &#x2F;DIR&#x2F;</td><td>æ˜¾ç¤ºç›®å½•ä¸‹è¢«è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶</td></tr><tr><td>lsof +D &#x2F;DIR&#x2F;</td><td>åŒä¸Šï¼Œä½†æ˜¯ä¼šæœç´¢ç›®å½•ä¸‹çš„æ‰€æœ‰ç›®å½•ï¼Œæ—¶é—´ç›¸å¯¹è¾ƒé•¿</td></tr><tr><td>lsof -d FD</td><td>æ˜¾ç¤ºæŒ‡å®šæ–‡ä»¶æè¿°ç¬¦çš„è¿›ç¨‹</td></tr><tr><td>lsof -n</td><td>ä¸å°† IP è½¬æ¢ä¸º hostnameï¼Œç¼ºçœæ˜¯ä¸åŠ ä¸Š -n å‚æ•°</td></tr><tr><td>lsof -i</td><td>ç”¨ä»¥æ˜¾ç¤ºç¬¦åˆæ¡ä»¶çš„è¿›ç¨‹æƒ…å†µ</td></tr></tbody></table><h2 id="ä¸€äº›ä¾‹å­"><a href="#ä¸€äº›ä¾‹å­" class="headerlink" title="ä¸€äº›ä¾‹å­"></a>ä¸€äº›ä¾‹å­</h2><h3 id="æŸ¥çœ‹-java-ç¨‹åºæ‰“å¼€çš„æ–‡ä»¶"><a href="#æŸ¥çœ‹-java-ç¨‹åºæ‰“å¼€çš„æ–‡ä»¶" class="headerlink" title="æŸ¥çœ‹ java ç¨‹åºæ‰“å¼€çš„æ–‡ä»¶"></a>æŸ¥çœ‹ java ç¨‹åºæ‰“å¼€çš„æ–‡ä»¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsof -c java</span><br></pre></td></tr></table></figure><p>å½“ç„¶ä½ ä¹Ÿå¯ä»¥åˆ° <code>/proc/&lt;è¿›ç¨‹pid&gt;/fd</code> é‡Œé¢çœ‹åˆ°è¿™ä¸ªè¿›ç¨‹è¢«æ‰“å¼€çš„æ–‡ä»¶</p><h3 id="æŸ¥çœ‹ä¸€ä¸ªæ–‡ä»¶è¢«å“ªä¸ªç¨‹åºæ‰“å¼€"><a href="#æŸ¥çœ‹ä¸€ä¸ªæ–‡ä»¶è¢«å“ªä¸ªç¨‹åºæ‰“å¼€" class="headerlink" title="æŸ¥çœ‹ä¸€ä¸ªæ–‡ä»¶è¢«å“ªä¸ªç¨‹åºæ‰“å¼€"></a>æŸ¥çœ‹ä¸€ä¸ªæ–‡ä»¶è¢«å“ªä¸ªç¨‹åºæ‰“å¼€</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsof /tmp/a.log</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹ä¸€ä¸ªç«¯å£å¯¹åº”ç¨‹åºæ‰“å¼€çš„æ–‡ä»¶"><a href="#æŸ¥çœ‹ä¸€ä¸ªç«¯å£å¯¹åº”ç¨‹åºæ‰“å¼€çš„æ–‡ä»¶" class="headerlink" title="æŸ¥çœ‹ä¸€ä¸ªç«¯å£å¯¹åº”ç¨‹åºæ‰“å¼€çš„æ–‡ä»¶"></a>æŸ¥çœ‹ä¸€ä¸ªç«¯å£å¯¹åº”ç¨‹åºæ‰“å¼€çš„æ–‡ä»¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsof -i :22</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹-root-ç”¨æˆ·æ‰“å¼€çš„-txt-æ–‡ä»¶"><a href="#æŸ¥çœ‹-root-ç”¨æˆ·æ‰“å¼€çš„-txt-æ–‡ä»¶" class="headerlink" title="æŸ¥çœ‹ root ç”¨æˆ·æ‰“å¼€çš„ txt æ–‡ä»¶"></a>æŸ¥çœ‹ root ç”¨æˆ·æ‰“å¼€çš„ txt æ–‡ä»¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsof -a -u root -d txt</span><br></pre></td></tr></table></figure><h3 id="æ„å¤–åˆ é™¤æ–‡ä»¶æ¢å¤"><a href="#æ„å¤–åˆ é™¤æ–‡ä»¶æ¢å¤" class="headerlink" title="æ„å¤–åˆ é™¤æ–‡ä»¶æ¢å¤"></a>æ„å¤–åˆ é™¤æ–‡ä»¶æ¢å¤</h3><p>å½“ç³»ç»Ÿä¸­çš„æŸä¸ªæ–‡ä»¶è¢«æ„å¤–åœ°åˆ é™¤äº†ï¼Œåªè¦è¿™ä¸ªæ—¶å€™ç³»ç»Ÿä¸­è¿˜æœ‰è¿›ç¨‹æ­£åœ¨è®¿é—®è¯¥æ–‡ä»¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ lsof ä»&#x2F;proc ç›®å½•ä¸‹æ¢å¤è¯¥æ–‡ä»¶çš„å†…å®¹ã€‚å‡å¦‚ç”±äºè¯¯æ“ä½œå°†&#x2F;var&#x2F;log&#x2F;messages æ–‡ä»¶åˆ é™¤æ‰äº†ï¼Œé‚£ä¹ˆè¿™æ—¶è¦å°†&#x2F;var&#x2F;log&#x2F;messages æ–‡ä»¶æ¢å¤çš„æ–¹æ³•å¦‚ä¸‹ï¼š</p><p>é¦–å…ˆä½¿ç”¨ lsof æ¥æŸ¥çœ‹å½“å‰æ˜¯å¦æœ‰è¿›ç¨‹æ‰“å¼€&#x2F;var&#x2F;logmessages æ–‡ä»¶ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lsof |grep /var/log/messages</span><br><span class="line">syslogd 1283 root 2w REG 3,3 5381017 1773647 /var/log/messages (deleted)</span><br></pre></td></tr></table></figure><p>ä»ä¸Šé¢çš„ä¿¡æ¯å¯ä»¥çœ‹åˆ° PID 1283ï¼ˆsyslogdï¼‰æ‰“å¼€æ–‡ä»¶çš„æ–‡ä»¶æè¿°ç¬¦ä¸º 2ã€‚åŒæ—¶è¿˜å¯ä»¥çœ‹åˆ°&#x2F;var&#x2F;log&#x2F;messages å·²ç»æ ‡è®°è¢«åˆ é™¤äº†ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨ &#x2F;proc&#x2F;1283&#x2F;fd&#x2F;2 ï¼ˆfd ä¸‹çš„æ¯ä¸ªä»¥æ•°å­—å‘½åçš„æ–‡ä»¶è¡¨ç¤ºè¿›ç¨‹å¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦ï¼‰å¾—åˆ°æ‰€è¦æ¢å¤çš„æ•°æ®ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
            <tag> å‘½ä»¤è¡Œå·¥å…· </tag>
            
            <tag> cli </tag>
            
            <tag> Linux </tag>
            
            <tag> bash </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è§£å†³ yum update å¡ä½ä¸åŠ¨</title>
      <link href="/posts/si7e5o/"/>
      <url>/posts/si7e5o/</url>
      
        <content type="html"><![CDATA[<p>å¦‚æœæ˜¯ä½å†…å­˜æœºå™¨ï¼Œæœ‰å¯èƒ½æ˜¯å†…å­˜ä¸å¤Ÿäº†ï¼Œå¢åŠ ä¸€äº› swap è¯•è¯•ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¼ºåˆ¶ç»“æŸyumè¿›ç¨‹</span></span><br><span class="line"><span class="built_in">kill</span> -9 &lt;pid&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤rpmæ•°æ®æ–‡ä»¶</span></span><br><span class="line"><span class="built_in">rm</span> -f /var/lib/rpm/__db.00*</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡å»ºrpmæ•°æ®æ–‡ä»¶</span></span><br><span class="line">rpm -vv --rebuilddb</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¸…ç©ºç¼“å­˜åå†é‡æ–°ç¼“å­˜</span></span><br><span class="line">yum clean all </span><br><span class="line">yum makecache</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CentOS 7 é…ç½® fail2ban</title>
      <link href="/posts/shxj0z/"/>
      <url>/posts/shxj0z/</url>
      
        <content type="html"><![CDATA[<h2 id="åŸºæœ¬é…ç½®"><a href="#åŸºæœ¬é…ç½®" class="headerlink" title="åŸºæœ¬é…ç½®"></a>åŸºæœ¬é…ç½®</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">disable</span> --now firewalld</span><br><span class="line">sed -i <span class="string">&#x27;s#SELINUX=enforcing#SELINUX=disabled#g&#x27;</span> /etc/sysconfig/selinux &amp;&amp; setenforce 0</span><br><span class="line"></span><br><span class="line">yum install fail2ban -y</span><br><span class="line"></span><br><span class="line"><span class="built_in">rm</span> -f /etc/fail2ban/jail.d/00-firewalld.conf</span><br></pre></td></tr></table></figure><h2 id="å¼€å¯-ssh-å°ç¦è§„åˆ™"><a href="#å¼€å¯-ssh-å°ç¦è§„åˆ™" class="headerlink" title="å¼€å¯ ssh å°ç¦è§„åˆ™"></a>å¼€å¯ ssh å°ç¦è§„åˆ™</h2><p>vim &#x2F;etc&#x2F;fail2ban&#x2F;jail.d&#x2F;ssh.conf</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[DEFAULT]</span></span><br><span class="line"><span class="comment"># å°ç¦æ—¶é—´å¤šä¹…ï¼Œå•ä½æ˜¯ç§’ï¼Œä¹Ÿå¯ä»¥å†™ 10m è¡¨ç¤º 10 åˆ†é’Ÿã€‚1h è¡¨ç¤º 1 å°æ—¶</span></span><br><span class="line"><span class="attr">bantime</span> = <span class="number">3600</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Override /etc/fail2ban/jail.d/00-firewalld.conf:</span></span><br><span class="line"><span class="attr">banaction</span> = iptables-multiport</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»Ÿè®¡å‘¨æœŸæ—¶é—´ï¼Œé»˜è®¤å•ä½æ˜¯ç§’</span></span><br><span class="line"><span class="attr">findtime</span>  = <span class="number">10</span>m</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨ä¸€ä¸ªå‘¨æœŸå†…å…è®¸å¤±è´¥å‡ æ¬¡</span></span><br><span class="line"><span class="attr">maxretry</span> = <span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="section">[sshd]</span></span><br><span class="line"><span class="attr">enabled</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">mode</span> = aggressive</span><br></pre></td></tr></table></figure><p><code>mode = aggressive</code> é…ç½®æ˜¯ ä¸ºäº†å°†é‚£äº› ä½¿ç”¨é”™è¯¯ key ç™»å½•å¤±è´¥çš„ä¸€èµ·ç¦ç”¨äº†ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è‡ªåŠ¨åŒ– </tag>
            
            <tag> å®‰å…¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>macOSç»ˆç«¯å·¥å…·iTerm2é…ç½®lrzszä¸Šä¼ ä¸‹è½½</title>
      <link href="/posts/sgpjuj/"/>
      <url>/posts/sgpjuj/</url>
      
        <content type="html"><![CDATA[<p>lrzsz æ˜¯ä¸ªå¾ˆå¤è€çš„è½¯ä»¶äº†ï¼Œ ä¸Šæ¬¡æ›´æ–°æ˜¯ 1998 å¹´ï¼Œ è·ä»Šå·²ç» 20 å¤šå¹´å†å²äº†ï¼Œé‚£ä¸ºå•¥è¿˜è¦ç”¨è¿™ä¹ˆå¤è€çš„è½¯ä»¶å‘¢ï¼Œlrzsz åˆ©ç”¨ç»ˆç«¯æ¥ä¼ è¾“æ–‡ä»¶ï¼Œç›¸æ¯”äº scpã€sftp ç­‰æ¥è¯´æ–¹ä¾¿å€’æ˜¯å…¶æ¬¡ï¼Œæƒ³è±¡ä¸€ä¸‹ <code>æˆ‘çš„ç”µè„‘ --&gt; è·³æ¿æœºA --&gt; è·³æ¿æœºB --&gt; ç›®æ ‡æœºå™¨</code> å¹¶ä¸”å¾ˆå¤šè·³æ¿æœºéƒ½æœ‰å„ç§é™åˆ¶ï¼Œä¸ä¸€å®šæ”¯æŒä¸Šä¼ æ–‡ä»¶ï¼Œè¿™ä¸ªæ—¶å€™é€šè¿‡ç»ˆç«¯æ¥ä¼ æ–‡ä»¶å°±æ˜¯å”¯ä¸€çš„é€‰æ‹©äº†ã€‚</p><p>å®˜æ–¹ä»‹ç»ï¼š<a href="https://www.ohse.de/uwe/software/lrzsz.html">https://www.ohse.de/uwe/software/lrzsz.html</a></p><p>ç±»ä¼¼ä¸ lrzsz è¿˜æœ‰ä¸ªè½¯ä»¶å« trzszï¼Œ ç›¸æ¯” lrzsz æ›´å¿«ï¼Œæ›´æ–¹ä¾¿ã€‚</p><h2 id="lrzsz-åŸç†"><a href="#lrzsz-åŸç†" class="headerlink" title="lrzsz åŸç†"></a>lrzsz åŸç†</h2><ul><li><p>ä¸‹è½½æ–‡ä»¶<br>  åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œ szï¼ˆSend by ZMODEMï¼‰ï¼Œå…ˆåœ¨ç»ˆç«¯ä¸Šè¾“å‡º **B00000000000000ï¼Œç„¶åå®¢æˆ·ç«¯åœ¨ç»ˆç«¯å‘é€æŒ‡ä»¤ï¼Œè¡¨ç¤ºæ‹’ç»ï¼Œè¿˜æ˜¯æ¥æ”¶ï¼ˆæ¥æ”¶çš„è¯ï¼Œå°±åœ¨å®¢æˆ·ç«¯è¿è¡Œ rz æŒ‡ä»¤ä¸æœåŠ¡ç«¯äº¤äº’ï¼‰</p></li><li><p>ä¸Šä¼ æ–‡ä»¶<br>  åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œ rzï¼ˆReceive by ZMODEMï¼‰ï¼Œå…ˆåœ¨ç»ˆç«¯ä¸Šè¾“å‡º rz waiting to receive.**B0100000023be50ï¼Œç„¶åå®¢æˆ·ç«¯å‘é€æŒ‡ä»¤ï¼Œè¡¨ç¤ºå–æ¶ˆï¼Œè¿˜æ˜¯ä¸Šä¼ ï¼ˆä¸Šä¼ çš„è¯ï¼Œåœ¨å®¢æˆ·ç«¯è¿è¡Œ sz å‘½ä»¤ä¸æœåŠ¡ç«¯äº¤äº’ï¼‰ã€‚</p></li></ul><p>å¯ä»¥çœ‹åˆ°åœ¨ä¸Šè¿°æµç¨‹ä¸­ï¼Œå¯¹ Terminal çš„è¦æ±‚å°±æ˜¯ï¼Œé‡åˆ°ç‰¹æ®ŠæŒ‡ä»¤ï¼Œè§¦å‘å¯¹åº”çš„æ“ä½œï¼ˆæ‰§è¡Œæœ¬åœ°å‘½ä»¤ï¼‰</p><p>ç”±äº macOS è‡ªå¸¦çš„ Terminal.app ä¸æ”¯æŒè¿™ä¸ªï¼Œæ‰€ä»¥ç½‘ä¸Šå¤§éƒ¨åˆ†æ•™ç¨‹éƒ½æ˜¯ä½¿ç”¨ iTerm2</p><p>å‚è€ƒé“¾æ¥ï¼š<a href="https://www.jianshu.com/p/d5bbb6009b05">https://www.jianshu.com/p/d5bbb6009b05</a></p><h2 id="å®‰è£…-lrzsz"><a href="#å®‰è£…-lrzsz" class="headerlink" title="å®‰è£… lrzsz"></a>å®‰è£… lrzsz</h2><p>è¦ä½¿ç”¨ lrzszï¼Œè‡ªå·±çš„ç”µè„‘å’ŒæœåŠ¡å™¨ä¸Šéƒ½éœ€è¦å®‰è£… lrzsz åŒ…ï¼Œåœ¨ macOS ä¸Šå¯ä»¥ä½¿ç”¨ brew æ¥å®‰è£…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install lrzsz</span><br></pre></td></tr></table></figure><h2 id="åˆ›å»ºè„šæœ¬"><a href="#åˆ›å»ºè„šæœ¬" class="headerlink" title="åˆ›å»ºè„šæœ¬"></a>åˆ›å»ºè„šæœ¬</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; iterm2-recv-zmodem.sh &lt;&lt;<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment"># Author: Matt Mastracci (matthew@mastracci.com)</span></span><br><span class="line"><span class="comment"># AppleScript from http://stackoverflow.com/questions/4309087/cancel-button-on-osascript-in-a-bash-script</span></span><br><span class="line"><span class="comment"># licensed under cc-wiki with attribution required</span></span><br><span class="line"><span class="comment"># Remainder of script public domain</span></span><br><span class="line"></span><br><span class="line">osascript -e <span class="string">&#x27;tell application &quot;iTerm2&quot; to version&#x27;</span> &gt; /dev/null 2&gt;&amp;1 &amp;&amp; NAME=iTerm2 || NAME=iTerm</span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$NAME</span> = <span class="string">&quot;iTerm&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">FILE=$(osascript -e <span class="string">&#x27;tell application &quot;iTerm&quot; to activate&#x27;</span> -e <span class="string">&#x27;tell application &quot;iTerm&quot; to set thefile to choose folder with prompt &quot;Choose a folder to place received files in&quot;&#x27;</span> -e <span class="string">&quot;do shell script (\&quot;echo \&quot;&amp;(quoted form of POSIX path of thefile as Unicode text)&amp;\&quot;\&quot;)&quot;</span>)</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">FILE=$(osascript -e <span class="string">&#x27;tell application &quot;iTerm2&quot; to activate&#x27;</span> -e <span class="string">&#x27;tell application &quot;iTerm2&quot; to set thefile to choose folder with prompt &quot;Choose a folder to place received files in&quot;&#x27;</span> -e <span class="string">&quot;do shell script (\&quot;echo \&quot;&amp;(quoted form of POSIX path of thefile as Unicode text)&amp;\&quot;\&quot;)&quot;</span>)</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$FILE</span> = <span class="string">&quot;&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> Cancelled.</span><br><span class="line"><span class="comment"># Send ZModem cancel</span></span><br><span class="line"><span class="built_in">echo</span> -e \\x18\\x18\\x18\\x18\\x18</span><br><span class="line"><span class="built_in">sleep</span> 1</span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span> \<span class="comment"># Cancelled transfer</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">cd</span> <span class="string">&quot;<span class="variable">$FILE</span>&quot;</span></span><br><span class="line">/usr/local/bin/rz --rename --escape --binary --bufsize 4096</span><br><span class="line"><span class="built_in">sleep</span> 1</span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span> \<span class="comment"># Sent \-\&gt; $FILE</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &gt; iterm2-send-zmodem.sh &lt;&lt;<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment"># Author: Matt Mastracci (matthew@mastracci.com)</span></span><br><span class="line"><span class="comment"># AppleScript from http://stackoverflow.com/questions/4309087/cancel-button-on-osascript-in-a-bash-script</span></span><br><span class="line"><span class="comment"># licensed under cc-wiki with attribution required</span></span><br><span class="line"><span class="comment"># Remainder of script public domain</span></span><br><span class="line"></span><br><span class="line">osascript -e <span class="string">&#x27;tell application &quot;iTerm2&quot; to version&#x27;</span> &gt; /dev/null 2&gt;&amp;1 &amp;&amp; NAME=iTerm2 || NAME=iTerm</span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$NAME</span> = <span class="string">&quot;iTerm&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">FILE=$(osascript -e <span class="string">&#x27;tell application &quot;iTerm&quot; to activate&#x27;</span> -e <span class="string">&#x27;tell application &quot;iTerm&quot; to set thefile to choose file with prompt &quot;Choose a file to send&quot;&#x27;</span> -e <span class="string">&quot;do shell script (\&quot;echo \&quot;&amp;(quoted form of POSIX path of thefile as Unicode text)&amp;\&quot;\&quot;)&quot;</span>)</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">FILE=$(osascript -e <span class="string">&#x27;tell application &quot;iTerm2&quot; to activate&#x27;</span> -e <span class="string">&#x27;tell application &quot;iTerm2&quot; to set thefile to choose file with prompt &quot;Choose a file to send&quot;&#x27;</span> -e <span class="string">&quot;do shell script (\&quot;echo \&quot;&amp;(quoted form of POSIX path of thefile as Unicode text)&amp;\&quot;\&quot;)&quot;</span>)</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$FILE</span> = <span class="string">&quot;&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> Cancelled.</span><br><span class="line"><span class="comment"># Send ZModem cancel</span></span><br><span class="line"><span class="built_in">echo</span> -e \\x18\\x18\\x18\\x18\\x18</span><br><span class="line"><span class="built_in">sleep</span> 1</span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span> \<span class="comment"># Cancelled transfer</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">/usr/local/bin/sz <span class="string">&quot;<span class="variable">$FILE</span>&quot;</span> --escape --binary --bufsize 4096</span><br><span class="line"><span class="built_in">sleep</span> 1</span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span> \<span class="comment"># Received &quot;$FILE&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">EOF</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="é…ç½®-iTerm2"><a href="#é…ç½®-iTerm2" class="headerlink" title="é…ç½® iTerm2"></a>é…ç½® iTerm2</h2><p><code>Profiles</code> â€“&gt; <code>Advanced</code> â€“&gt; <code>Triggers</code> â€“&gt; <code>Edit</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">1.ç¬¬ä¸€æ¡</span><br><span class="line">        Regular expression: rz waiting to receive.\*\*B0100</span><br><span class="line">        Action: Run Silent Coprocess</span><br><span class="line">        Parameters: /Users/iuxt/icloud/macOS/iterm2/iterm2-send-zmodem.sh</span><br><span class="line">        Instant: checked</span><br><span class="line"></span><br><span class="line">2.ç¬¬äºŒæ¡</span><br><span class="line">        Regular expression: \*\*B00000000000000</span><br><span class="line">        Action: Run Silent Coprocess</span><br><span class="line">        Parameters: /Users/iuxt/icloud/macOS/iterm2/iterm2-recv-zmodem.sh</span><br><span class="line">        Instant: checked</span><br></pre></td></tr></table></figure><h2 id="å¦ä¸€ç§æ–¹å¼ï¼Œä½¿ç”¨-tssh"><a href="#å¦ä¸€ç§æ–¹å¼ï¼Œä½¿ç”¨-tssh" class="headerlink" title="å¦ä¸€ç§æ–¹å¼ï¼Œä½¿ç”¨ tssh"></a>å¦ä¸€ç§æ–¹å¼ï¼Œä½¿ç”¨ tssh</h2><p>tssh æ–°ç‰ˆæ”¯æŒäº† lrzsz äº†ï¼Œå¯ä»¥ç”¨ tssh æ¥æ›¿ä»£ sshï¼Œ å¯ä»¥åŒæ—¶æ”¯æŒ lrzsz å’Œ trzszã€‚é…åˆ iTerm2 ä¹Ÿä¸é”™ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install trzsz-ssh</span><br></pre></td></tr></table></figure><p>ç„¶åç”¨ <code>tssh --zmodem</code> æ¥æ›¿ä»£ <code>ssh</code> ï¼Œæ¯”å¦‚é…ç½® alias</p><p>ä½¿ç”¨ tssh å°±ä¸ç”¨é…ç½® iTerm2 çš„ Triggers äº†ï¼Œå¹¶ä¸”ä¸Šä¼ ä¸‹è½½çš„æ—¶å€™å¯ä»¥æ˜¾ç¤ºé€Ÿåº¦å’Œä¼ è¾“çš„å¤§å°ã€‚</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202407261625730.png" alt="image.png"></p>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> OpenSSH </tag>
            
            <tag> lrzsz </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æœ€å°åŒ–å®‰è£…çš„Linuxå®‰è£…å›¾å½¢ç•Œé¢</title>
      <link href="/posts/spi6z2/"/>
      <url>/posts/spi6z2/</url>
      
        <content type="html"><![CDATA[<p>é’ˆå¯¹äº CentOS ç³»åˆ—çš„å‘è¡Œç‰ˆã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">yum <span class="built_in">groups</span> list </span><br><span class="line"></span><br><span class="line">yum groupinstall <span class="string">&quot;Server with GUI&quot;</span></span><br><span class="line"></span><br><span class="line">systemctl get-default</span><br><span class="line">systemctl set-default graphical.target</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>é‡å¯å³å¯ç”Ÿæ•ˆ</p><p>å¦‚æœä¸æƒ³é‡å¯ï¼Œå¯ä»¥æ‰§è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">nohup</span> startx &amp;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é…ç½®è®°å½• </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
