<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>æ‚çƒ©é¥­</title>
  <icon>https://zahui.fan/favicon.ico</icon>
  <subtitle>å¼ ç†å¤çš„åšå®¢ - è¿ç»´æŠ€æœ¯åˆ†äº«</subtitle>
  <link href="https://zahui.fan/atom.xml" rel="self"/>
  
  <link href="https://zahui.fan/"/>
  <updated>2025-04-05T01:36:57.000Z</updated>
  <id>https://zahui.fan/</id>
  
  <author>
    <name>å¼ ç†å¤</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>å®‰è£…æ’ä»¶æ–¹å¼æ¥è¿è¡Œgrafana-image-renderer</title>
    <link href="https://zahui.fan/posts/su3lwr/"/>
    <id>https://zahui.fan/posts/su3lwr/</id>
    <published>2025-04-02T16:02:51.000Z</published>
    <updated>2025-04-05T01:36:57.000Z</updated>
    
    <content type="html"><![CDATA[<p>å®‰è£…å¯ä»¥ä½¿ç”¨å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grafana-cli plugins install grafana-image-renderer</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸èƒ½æ­£å¸¸è®¿é—®ç½‘ç»œï¼Œæˆ–è€…ä¸‹è½½é€Ÿåº¦å¤ªæ…¢ï¼Œå¯ä»¥ä½¿ç”¨ç¦»çº¿åŒ…ï¼šåˆ°è¿™é‡Œ<a href="https://grafana.com/grafana/plugins/grafana-image-renderer/?tab=installation">https://grafana.com/grafana/plugins/grafana-image-renderer/?tab=installation</a>ä¸‹è½½ç¦»çº¿åŒ…ï¼Œç„¶åæ”¾åˆ° plugins æ–‡ä»¶å¤¹ä¸‹ã€‚éœ€è¦æ³¨æ„ä¸‹ plugins æ–‡ä»¶å¤¹çš„ä½ç½®ï¼Œå¯èƒ½ä½¿ç”¨å‘½ä»¤å®‰è£…çš„è·¯å¾„å’ŒçœŸå®çš„ plugins ç›®å½•ä¸ä¸€è‡´ã€‚</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/20250402181200283.png" alt="image.png|654"></p><p>å¦‚æœæ’ä»¶å¯åŠ¨å¤±è´¥ï¼ŒæŠ¥é”™ï¼šå¯ä»¥æ£€æŸ¥ä¸‹ <code>plugins/grafana-image-renderer/chrome-headless-shell/linux-136.0.7101.0/chrome-headless-shell-linux64</code> è¿™ä¸ªç¨‹åºèƒ½å¦æ­£å¸¸è¿è¡Œï¼Œå¦‚æœæŠ¥é”™<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/20250402181642753.png" alt="image.png"></p><p>éœ€è¦å®‰è£… <code>apt install -y libasound2t64</code></p><h2 id="å®Œæ•´é…ç½®å®¹å™¨"><a href="#å®Œæ•´é…ç½®å®¹å™¨" class="headerlink" title="å®Œæ•´é…ç½®å®¹å™¨"></a>å®Œæ•´é…ç½®å®¹å™¨</h2><p>Dockerfileï¼š</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> grafana/grafana-oss:<span class="number">11.5</span>.<span class="number">3</span>-ubuntu</span><br><span class="line"><span class="keyword">USER</span> root</span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get update &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    apt-get install -y \</span></span><br><span class="line"><span class="language-bash">    ca-certificates \</span></span><br><span class="line"><span class="language-bash">    fonts-liberation \</span></span><br><span class="line"><span class="language-bash">    libasound2 \</span></span><br><span class="line"><span class="language-bash">    libatk-bridge2.0-0 \</span></span><br><span class="line"><span class="language-bash">    libatk1.0-0 \</span></span><br><span class="line"><span class="language-bash">    libc6 \</span></span><br><span class="line"><span class="language-bash">    libcairo2 \</span></span><br><span class="line"><span class="language-bash">    libcups2 \</span></span><br><span class="line"><span class="language-bash">    libdbus-1-3 \</span></span><br><span class="line"><span class="language-bash">    libexpat1 \</span></span><br><span class="line"><span class="language-bash">    libfontconfig1 \</span></span><br><span class="line"><span class="language-bash">    libgbm1 \</span></span><br><span class="line"><span class="language-bash">    libgcc1 \</span></span><br><span class="line"><span class="language-bash">    libglib2.0-0 \</span></span><br><span class="line"><span class="language-bash">    libgtk-3-0 \</span></span><br><span class="line"><span class="language-bash">    libnspr4 \</span></span><br><span class="line"><span class="language-bash">    libnss3 \</span></span><br><span class="line"><span class="language-bash">    libpango-1.0-0 \</span></span><br><span class="line"><span class="language-bash">    libpangocairo-1.0-0 \</span></span><br><span class="line"><span class="language-bash">    libstdc++6 \</span></span><br><span class="line"><span class="language-bash">    libx11-6 \</span></span><br><span class="line"><span class="language-bash">    libx11-xcb1 \</span></span><br><span class="line"><span class="language-bash">    libxcb1 \</span></span><br><span class="line"><span class="language-bash">    libxcomposite1 \</span></span><br><span class="line"><span class="language-bash">    libxcursor1 \</span></span><br><span class="line"><span class="language-bash">    libxdamage1 \</span></span><br><span class="line"><span class="language-bash">    libxext6 \</span></span><br><span class="line"><span class="language-bash">    libxfixes3 \</span></span><br><span class="line"><span class="language-bash">    libxi6 \</span></span><br><span class="line"><span class="language-bash">    libxrandr2 \</span></span><br><span class="line"><span class="language-bash">    libxrender1 \</span></span><br><span class="line"><span class="language-bash">    libxss1 \</span></span><br><span class="line"><span class="language-bash">    libxtst6 \</span></span><br><span class="line"><span class="language-bash">    lsb-release \</span></span><br><span class="line"><span class="language-bash">    wget \</span></span><br><span class="line"><span class="language-bash">    xdg-utils \</span></span><br><span class="line"><span class="language-bash">    fonts-noto-cjk \</span></span><br><span class="line"><span class="language-bash">    ttf-wqy-microhei &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    fc-cache -f -v &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    apt clean all</span></span><br><span class="line"><span class="keyword">USER</span> grafana</span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> grafana cli plugins install grafana-image-renderer</span></span><br></pre></td></tr></table></figure><h2 id="kubernetes-éƒ¨ç½²é…ç½®"><a href="#kubernetes-éƒ¨ç½²é…ç½®" class="headerlink" title="kubernetes éƒ¨ç½²é…ç½®"></a>kubernetes éƒ¨ç½²é…ç½®</h2><p>k8s è¿è¡Œçš„æ—¶å€™ï¼Œéœ€è¦é…ç½® <code>root_url</code> è¢«è¿™ä¸ªå‘äº†å¾ˆä¹…ï¼Œå®Œæ•´çš„é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">grafana-ldap-config</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">ops</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">ldap.toml:</span> <span class="string">|</span></span><br><span class="line"><span class="string">    [[servers]]</span></span><br><span class="line"><span class="string">    host = &quot;1.1.1.1&quot;</span></span><br><span class="line"><span class="string">    port = 389</span></span><br><span class="line"><span class="string">    use_ssl = false</span></span><br><span class="line"><span class="string">    start_tls = false</span></span><br><span class="line"><span class="string">    ssl_skip_verify = false</span></span><br><span class="line"><span class="string">    bind_dn = &quot;cn=admin,dc=example,dc=com&quot;</span></span><br><span class="line"><span class="string">    bind_password = &quot;example&quot;</span></span><br><span class="line"><span class="string">    search_filter = &quot;(uid=%s)&quot;</span></span><br><span class="line"><span class="string">    search_base_dns = [&quot;dc=example,dc=com&quot;]</span></span><br><span class="line"><span class="string">    [servers.attributes]</span></span><br><span class="line"><span class="string">    member_of = &quot;memberOf&quot;</span></span><br><span class="line"><span class="string">    email =  &quot;uid&quot;</span></span><br><span class="line"><span class="string">    name = &quot;cn&quot;</span></span><br><span class="line"><span class="string">    username = &quot;uid&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">sre-grafana</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">ops</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">sre-grafana</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">sre-grafana</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">sre-grafana</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">ldap-config</span></span><br><span class="line">          <span class="attr">configMap:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">grafana-ldap-config</span></span><br><span class="line">            <span class="attr">defaultMode:</span> <span class="number">420</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">grafana</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">registry.cn-hangzhou.aliyuncs.com/iuxt/grafana-with-render:11.5.3-ubuntu</span></span><br><span class="line">          <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">http-grafana</span></span><br><span class="line">              <span class="attr">containerPort:</span> <span class="number">3000</span></span><br><span class="line">              <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">          <span class="attr">env:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">GF_AUTH_BASIC_ENABLED</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&#x27;true&#x27;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">GF_AUTH_ANONYMOUS_ENABLED</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&#x27;false&#x27;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">GF_AUTH_ANONYMOUS_ORG_ROLE</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">Admin</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">GF_DASHBOARDS_JSON_ENABLED</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&#x27;true&#x27;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">GF_SECURITY_ADMIN_USER</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">admin</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">GF_SECURITY_ADMIN_PASSWORD</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">admin</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">GF_DATABASE_TYPE</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">mysql</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">GF_DATABASE_HOST</span></span><br><span class="line">              <span class="attr">value:</span> <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">GF_DATABASE_PORT</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&#x27;3306&#x27;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">GF_DATABASE_USER</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">root</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">GF_DATABASE_PASSWORD</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">example</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">GF_DATABASE_NAME</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">sre-grafana</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">GF_AUTH_LDAP_ENABLED</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&#x27;true&#x27;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">GF_AUTH_LDAP_ALLOW_SIGN_UP</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&#x27;true&#x27;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">GF_AUTH_LDAP_CONFIG_FILE</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">/etc/grafana/ldap.toml</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">GF_SERVER_ROOT_URL</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">https://sre-grafana.example.com/</span></span><br><span class="line">          <span class="attr">resources:</span></span><br><span class="line">            <span class="attr">requests:</span></span><br><span class="line">              <span class="attr">cpu:</span> <span class="string">250m</span></span><br><span class="line">              <span class="attr">memory:</span> <span class="string">750Mi</span></span><br><span class="line">          <span class="attr">volumeMounts:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">ldap-config</span></span><br><span class="line">              <span class="attr">mountPath:</span> <span class="string">/etc/grafana/ldap.toml</span></span><br><span class="line">              <span class="attr">subPath:</span> <span class="string">ldap.toml</span></span><br><span class="line">          <span class="attr">livenessProbe:</span></span><br><span class="line">            <span class="attr">tcpSocket:</span></span><br><span class="line">              <span class="attr">port:</span> <span class="number">3000</span></span><br><span class="line">            <span class="attr">initialDelaySeconds:</span> <span class="number">30</span></span><br><span class="line">            <span class="attr">timeoutSeconds:</span> <span class="number">1</span></span><br><span class="line">            <span class="attr">periodSeconds:</span> <span class="number">10</span></span><br><span class="line">            <span class="attr">successThreshold:</span> <span class="number">1</span></span><br><span class="line">            <span class="attr">failureThreshold:</span> <span class="number">3</span></span><br><span class="line">          <span class="attr">readinessProbe:</span></span><br><span class="line">            <span class="attr">httpGet:</span></span><br><span class="line">              <span class="attr">path:</span> <span class="string">/robots.txt</span></span><br><span class="line">              <span class="attr">port:</span> <span class="number">3000</span></span><br><span class="line">              <span class="attr">scheme:</span> <span class="string">HTTP</span></span><br><span class="line">            <span class="attr">initialDelaySeconds:</span> <span class="number">10</span></span><br><span class="line">            <span class="attr">timeoutSeconds:</span> <span class="number">2</span></span><br><span class="line">            <span class="attr">periodSeconds:</span> <span class="number">30</span></span><br><span class="line">            <span class="attr">successThreshold:</span> <span class="number">1</span></span><br><span class="line">            <span class="attr">failureThreshold:</span> <span class="number">3</span></span><br><span class="line">          <span class="attr">terminationMessagePath:</span> <span class="string">/dev/termination-log</span></span><br><span class="line">          <span class="attr">terminationMessagePolicy:</span> <span class="string">File</span></span><br><span class="line">          <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">      <span class="attr">restartPolicy:</span> <span class="string">Always</span></span><br><span class="line">      <span class="attr">terminationGracePeriodSeconds:</span> <span class="number">30</span></span><br><span class="line">      <span class="attr">dnsPolicy:</span> <span class="string">ClusterFirst</span></span><br><span class="line">      <span class="attr">securityContext:</span></span><br><span class="line">        <span class="attr">supplementalGroups:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="number">0</span></span><br><span class="line">        <span class="attr">fsGroup:</span> <span class="number">472</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">sre-grafana</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">ops</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">sre-grafana</span></span><br><span class="line">      <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">3000</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">3000</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">sre-grafana</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">ClusterIP</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">sre-grafana</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">ops</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">kubernetes.io/ingress.class:</span> <span class="string">private-nginx</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/ssl-redirect:</span> <span class="string">&#x27;true&#x27;</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">tls:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">hosts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">sre-grafana.example.com</span></span><br><span class="line">      <span class="attr">secretName:</span> <span class="string">example-com</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">sre-grafana.example.com</span></span><br><span class="line">      <span class="attr">http:</span></span><br><span class="line">        <span class="attr">paths:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/</span></span><br><span class="line">            <span class="attr">pathType:</span> <span class="string">Prefix</span></span><br><span class="line">            <span class="attr">backend:</span></span><br><span class="line">              <span class="attr">service:</span></span><br><span class="line">                <span class="attr">name:</span> <span class="string">sre-grafana</span></span><br><span class="line">                <span class="attr">port:</span></span><br><span class="line">                  <span class="attr">number:</span> <span class="number">3000</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;p&gt;å®‰è£…å¯ä»¥ä½¿ç”¨å‘½ä»¤ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;grafana-cli plugins install</summary>
        
      
    
    
    
    <category term="ç›‘æ§" scheme="https://zahui.fan/categories/%E7%9B%91%E6%8E%A7/"/>
    
    
    <category term="Docker" scheme="https://zahui.fan/tags/Docker/"/>
    
    <category term="grafana" scheme="https://zahui.fan/tags/grafana/"/>
    
    <category term="Puppeteer" scheme="https://zahui.fan/tags/Puppeteer/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨ Python è‡ªåŠ¨æˆªå›¾ Grafana ä»ªè¡¨ç›˜ï¼Œå®ç°å¯è§†åŒ–ç›‘æ§å¿«ç…§</title>
    <link href="https://zahui.fan/posts/stucr2/"/>
    <id>https://zahui.fan/posts/stucr2/</id>
    <published>2025-03-28T16:06:38.000Z</published>
    <updated>2025-04-05T01:37:15.000Z</updated>
    
    <content type="html"><![CDATA[<p>å®˜æ–¹é…ç½®æ–‡æ¡£åœ¨è¿™é‡Œï¼š<a href="https://grafana.com/docs/grafana/latest/setup-grafana/image-rendering/">https://grafana.com/docs/grafana/latest/setup-grafana/image-rendering/</a> ä½¿ç”¨æ–¹å¼æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯ç›´æ¥åœ¨ grafana æœºå™¨ä¸Šå®‰è£…æ’ä»¶ï¼Œå¦ä¸€ä¸ªæ˜¯ä½¿ç”¨å¤–æŒ‚æ¸²æŸ“å™¨çš„æ–¹å¼ã€‚</p><h2 id="éƒ¨ç½²æ¸²æŸ“å™¨-grafana-image-renderer"><a href="#éƒ¨ç½²æ¸²æŸ“å™¨-grafana-image-renderer" class="headerlink" title="éƒ¨ç½²æ¸²æŸ“å™¨ grafana-image-renderer"></a>éƒ¨ç½²æ¸²æŸ“å™¨ grafana-image-renderer</h2><blockquote><p>å®˜æ–¹æœ‰ç°æˆçš„é•œåƒï¼Œä¹Ÿå¯ä»¥ä¸ç”¨è‡ªå·±æ„å»ºé•œåƒ: <code>grafana/grafana-image-renderer:3.12.3</code> ä¹Ÿå¯ä»¥ç”¨ bitnami æ‰“åŒ…çš„é•œåƒï¼š<code>bitnami/grafana-image-renderer:latest</code>ï¼Œ æˆ‘å“¼å“§å“¼å“§æäº†åŠå¤©æ‰æƒ³èµ·æ¥å®˜æ–¹ä¹Ÿæœ‰é•œåƒğŸ˜“</p></blockquote><p>æˆ‘çš„ grafana æ˜¯è¿è¡Œåœ¨ kubernetes é‡Œçš„ï¼Œæ‰€ä»¥é€‰æ‹©ç”¨å¤–æŒ‚æ¸²æŸ“å™¨çš„æ–¹æ³•ã€‚æ¸²æŸ“å™¨æ ¸å¿ƒç”¨çš„æ˜¯ Puppeteerï¼Œæ ¹æ®å®˜ç½‘æ–‡æ¡£å®‰è£…ä¾èµ–åŒ…ï¼š<a href="https://pptr.dev/troubleshooting#chrome-doesnt-launch-on-linux">https://pptr.dev/troubleshooting#chrome-doesnt-launch-on-linux</a> ï¼Œå¦å¤–å¢åŠ äº†ä¸­æ–‡å­—ä½“åŒ…ï¼Œè§£å†³äº†ä¸­æ–‡æ˜¾ç¤ºæ¡†æ¡†çš„é—®é¢˜ã€‚æœ€ç»ˆçš„æ¸²æŸ“å™¨é•œåƒ dockerfile å¦‚ä¸‹ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> node:<span class="number">22.14</span>.<span class="number">0</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> git <span class="built_in">clone</span> --depth 1 https://github.com/grafana/grafana-image-renderer.git /app &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    <span class="built_in">cd</span> /app &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    yarn install --pure-lockfile &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    yarn run build</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> sed -i <span class="string">&#x27;s/deb.debian.org/mirrors.ustc.edu.cn/g&#x27;</span> /etc/apt/sources.list.d/debian.sources &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    apt-get update &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    apt-get install -y \</span></span><br><span class="line"><span class="language-bash">    ca-certificates \</span></span><br><span class="line"><span class="language-bash">    fonts-liberation \</span></span><br><span class="line"><span class="language-bash">    libasound2 \</span></span><br><span class="line"><span class="language-bash">    libatk-bridge2.0-0 \</span></span><br><span class="line"><span class="language-bash">    libatk1.0-0 \</span></span><br><span class="line"><span class="language-bash">    libc6 \</span></span><br><span class="line"><span class="language-bash">    libcairo2 \</span></span><br><span class="line"><span class="language-bash">    libcups2 \</span></span><br><span class="line"><span class="language-bash">    libdbus-1-3 \</span></span><br><span class="line"><span class="language-bash">    libexpat1 \</span></span><br><span class="line"><span class="language-bash">    libfontconfig1 \</span></span><br><span class="line"><span class="language-bash">    libgbm1 \</span></span><br><span class="line"><span class="language-bash">    libgcc1 \</span></span><br><span class="line"><span class="language-bash">    libglib2.0-0 \</span></span><br><span class="line"><span class="language-bash">    libgtk-3-0 \</span></span><br><span class="line"><span class="language-bash">    libnspr4 \</span></span><br><span class="line"><span class="language-bash">    libnss3 \</span></span><br><span class="line"><span class="language-bash">    libpango-1.0-0 \</span></span><br><span class="line"><span class="language-bash">    libpangocairo-1.0-0 \</span></span><br><span class="line"><span class="language-bash">    libstdc++6 \</span></span><br><span class="line"><span class="language-bash">    libx11-6 \</span></span><br><span class="line"><span class="language-bash">    libx11-xcb1 \</span></span><br><span class="line"><span class="language-bash">    libxcb1 \</span></span><br><span class="line"><span class="language-bash">    libxcomposite1 \</span></span><br><span class="line"><span class="language-bash">    libxcursor1 \</span></span><br><span class="line"><span class="language-bash">    libxdamage1 \</span></span><br><span class="line"><span class="language-bash">    libxext6 \</span></span><br><span class="line"><span class="language-bash">    libxfixes3 \</span></span><br><span class="line"><span class="language-bash">    libxi6 \</span></span><br><span class="line"><span class="language-bash">    libxrandr2 \</span></span><br><span class="line"><span class="language-bash">    libxrender1 \</span></span><br><span class="line"><span class="language-bash">    libxss1 \</span></span><br><span class="line"><span class="language-bash">    libxtst6 \</span></span><br><span class="line"><span class="language-bash">    lsb-release \</span></span><br><span class="line"><span class="language-bash">    wget \</span></span><br><span class="line"><span class="language-bash">    xdg-utils \</span></span><br><span class="line"><span class="language-bash">    fonts-noto-cjk \</span></span><br><span class="line"><span class="language-bash">    fonts-wqy-microhei &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    fc-cache -f -v &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    apt clean all</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;node&quot;</span>, <span class="string">&quot;build/app.js&quot;</span>, <span class="string">&quot;server&quot;</span>]</span></span><br></pre></td></tr></table></figure><p>éƒ¨ç½²åœ¨ kubernetes ä¸­ï¼Œyml æ–‡ä»¶å¦‚ä¸‹ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">grafana-image-renderer</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">ops</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">grafana-image-renderer</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">grafana-image-renderer</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">grafana-image-renderer</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">registry.cn-hangzhou.aliyuncs.com/iuxt/grafana-image-renderer:3</span></span><br><span class="line">          <span class="attr">env:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">HTTP_HOST</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&quot;0.0.0.0&quot;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">HTTP_PORT</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&quot;80&quot;</span></span><br><span class="line">          <span class="attr">resources:</span></span><br><span class="line">            <span class="attr">limits:</span></span><br><span class="line">              <span class="attr">cpu:</span> <span class="number">2</span></span><br><span class="line">              <span class="attr">memory:</span> <span class="string">2Gi</span></span><br><span class="line">            <span class="attr">requests:</span></span><br><span class="line">              <span class="attr">cpu:</span> <span class="number">2</span></span><br><span class="line">              <span class="attr">memory:</span> <span class="string">2Gi</span></span><br><span class="line">          <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">      <span class="attr">restartPolicy:</span> <span class="string">Always</span></span><br><span class="line">      <span class="attr">terminationGracePeriodSeconds:</span> <span class="number">30</span></span><br><span class="line">      <span class="attr">dnsPolicy:</span> <span class="string">ClusterFirst</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">grafana-image-renderer</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">ops</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">80</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">grafana-image-renderer</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">ClusterIP</span></span><br></pre></td></tr></table></figure><h2 id="Grafana-æ¥å…¥æ¸²æŸ“å™¨"><a href="#Grafana-æ¥å…¥æ¸²æŸ“å™¨" class="headerlink" title="Grafana æ¥å…¥æ¸²æŸ“å™¨"></a>Grafana æ¥å…¥æ¸²æŸ“å™¨</h2><p>å®¹å™¨è¿è¡Œçš„ grafana æ¥å…¥ æ¸²æŸ“å™¨ï¼Œå¢åŠ è¿™ä¸¤ä¸ªç¯å¢ƒå˜é‡</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">GF_RENDERING_SERVER_URL</span></span><br><span class="line">  <span class="attr">value:</span> <span class="string">http://grafana-image-renderer/render</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">GF_RENDERING_CALLBACK_URL</span></span><br><span class="line">  <span class="attr">value:</span> <span class="string">http://grafana:3000/</span></span><br></pre></td></tr></table></figure><p>åœ¨å¯¹åº”çš„é¢æ¿ï¼Œç‚¹å‡»åˆ†äº« å°±å¯ä»¥æ‹¿åˆ°æ¸²æŸ“åçš„å›¾åƒé“¾æ¥ï¼Œæµè§ˆå™¨æ‰“å¼€å¯ä»¥æ‹¿åˆ°å¯¹åº”çš„å›¾ç‰‡ã€‚</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/20250329003245507.png" alt="image.png|637"></p><h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><p>æ ¸å¿ƒä»£ç å°±æ˜¯è¿™ä¸ªï¼Œè¯·æ±‚æ¥å£ï¼Œç„¶åä¿å­˜æˆæ–‡ä»¶</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">render_panel</span>(<span class="params">self, panel_id, panel_title</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;æ¸²æŸ“é¢æ¿å¹¶ä¿å­˜ä¸º PNG&quot;&quot;&quot;</span></span><br><span class="line">    response = requests.get(</span><br><span class="line">        <span class="string">f&quot;https://sre-grafana.example.com/render/d-solo/<span class="subst">&#123;self.uid&#125;</span>?orgId=1&amp;from=<span class="subst">&#123;self.date_from&#125;</span>&amp;to=<span class="subst">&#123;self.date_to&#125;</span>&amp;panelId=<span class="subst">&#123;panel_id&#125;</span>&amp;width=1500&amp;height=750&amp;scale=1&amp;tz=Asia%2FShanghai&quot;</span>,</span><br><span class="line">        headers=&#123;<span class="string">&quot;Authorization&quot;</span>: <span class="string">f&quot;Bearer <span class="subst">&#123;self.api_key&#125;</span>&quot;</span>&#125;</span><br><span class="line">    )</span><br><span class="line">    <span class="built_in">print</span>(response.url)</span><br><span class="line">    safe_filename = re.sub(<span class="string">r&#x27;[\\/*?:&quot;&lt;&gt;|]&#x27;</span>, <span class="string">&#x27;_&#x27;</span>, panel_title) + <span class="string">&#x27;.png&#x27;</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(safe_filename, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(response.content)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;download png success, save to <span class="subst">&#123;safe_filename&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯æ¯”å¦‚æƒ³è‡ªåŠ¨æˆªå–ä¸€ä¸ª dashboard é‡Œé¢çš„æ¯ä¸€å¼ å›¾ï¼Œå°±éœ€è¦è¿›è¡Œå¾ªç¯ panel äº†ã€‚è¿™ç§æ–¹å¼å¯ä»¥æ‹¿åˆ° dashboard çš„ jsonï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_dashboard_json</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;è·å–ä»ªè¡¨æ¿ JSON æ•°æ®&quot;&quot;&quot;</span></span><br><span class="line">    response = requests.get(</span><br><span class="line">        <span class="string">f&quot;https://sre-grafana.example.com/api/dashboards/uid/<span class="subst">&#123;self.uid&#125;</span>&quot;</span>,</span><br><span class="line">        headers=&#123;<span class="string">&quot;Authorization&quot;</span>: <span class="string">f&quot;Bearer <span class="subst">&#123;self.api_key&#125;</span>&quot;</span>&#125;</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">return</span> response.json()</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;p&gt;å®˜æ–¹é…ç½®æ–‡æ¡£åœ¨è¿™é‡Œï¼š&lt;a href=&quot;https://grafana.com/docs/grafana/latest/setup-grafana/image-rendering/&quot;&gt;https://grafana.com/docs/grafana/latest/setup-grafana/image-rendering/&lt;/a&gt; ä½¿ç”¨æ–¹å¼æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯ç›´æ¥åœ¨ grafana</summary>
        
      
    
    
    
    <category term="ç›‘æ§" scheme="https://zahui.fan/categories/%E7%9B%91%E6%8E%A7/"/>
    
    
    <category term="grafana" scheme="https://zahui.fan/tags/grafana/"/>
    
    <category term="Puppeteer" scheme="https://zahui.fan/tags/Puppeteer/"/>
    
  </entry>
  
  <entry>
    <title>javaå®¹å™¨entrypoint.shå‚æ•°ä¼ é€’çš„éšè—é™·é˜±</title>
    <link href="https://zahui.fan/posts/stgvyr/"/>
    <id>https://zahui.fan/posts/stgvyr/</id>
    <published>2025-03-21T09:35:15.000Z</published>
    <updated>2025-03-24T15:08:50.000Z</updated>
    
    <content type="html"><![CDATA[<p>æ„å»ºå®¹å™¨é•œåƒå¯¹è¿ç»´æ¥è¯´å·²ç»è½»è½¦ç†Ÿè·¯äº†ï¼Œä½†æ˜¯æœ€è¿‘é‡åˆ°ä¸ªé—®é¢˜ç™¾æ€ä¸å¾—å…¶è§£ï¼Œå‡†ç¡®çš„è¯´å°±æ˜¯æ‰‹åŠ¨æ‰§è¡Œ java -jar å¸¦ä¸Šæ‰€æœ‰å‚æ•°ï¼Œå¯ä»¥æ­£å¸¸å¯åŠ¨ï¼Œä½†æ˜¯æ‰“åŒ…æˆé•œåƒå°±ä¼šæŠ¥é”™ï¼š</p><p>å…ˆé™„ä¸Š <code>entrypoint.sh</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -n <span class="string">&quot;<span class="variable">$JVM_PARAM</span>&quot;</span> ];</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;JVM_PARAM: <span class="variable">$JVM_PARAM</span>&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  JVM_PARAM=<span class="string">&quot;-Xms2g -Xmx2g -XX:MetaspaceSize=256m -XX:MaxMetaspaceSize=512m&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -n <span class="string">&quot;<span class="variable">$JVM_OPTS</span>&quot;</span> ];</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;JVM_OPTS: <span class="variable">$JVM_OPTS</span>&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  JVM_OPTS=<span class="string">&quot;-XX:+UseConcMarkSweepGC -XX:+UseCMSInitiatingOccupancyOnly -XX:CMSInitiatingOccupancyFraction=70 -XX:+ExplicitGCInvokesConcurrentAndUnloadsClasses -XX:+CMSClassUnloadingEnabled -XX:+ParallelRefProcEnabled -XX:+CMSScavengeBeforeRemark -XX:ErrorFile=/logs/hs_err_pid%p.log -Xloggc:/logs/gc.log -XX:HeapDumpPath=/logs -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:+HeapDumpOnOutOfMemoryError -XX:+PrintCommandLineFlags&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">JAVA_CMD=<span class="string">&quot;<span class="variable">$JVM_PARAM</span> <span class="variable">$JVM_OPTS</span>&quot;</span></span><br><span class="line"></span><br><span class="line">AGENT_OPTS=<span class="string">&quot;-javaagent:/hawkeye-agent/hawkeye-agent.jar=APPNAME?AGENT_UID=x-zahuifan-userid&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;true&quot;</span> == <span class="string">&quot;<span class="variable">$AGENT_ENABLED</span>&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;JAVA_CMD: <span class="variable">$JAVA_CMD</span> <span class="variable">$AGENT_OPTS</span>&quot;</span></span><br><span class="line">    java <span class="string">&quot;<span class="variable">$JAVA_CMD</span>&quot;</span> <span class="string">&quot;<span class="variable">$AGENT_OPTS</span>&quot;</span> -jar /app/app.jar</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;JAVA_CMD: <span class="variable">$JAVA_CMD</span>&quot;</span></span><br><span class="line">    java <span class="string">&quot;<span class="variable">$JAVA_CMD</span>&quot;</span> -jar /app/app.jar</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><p>Dockerfile:</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> java:xxx</span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash"> app.jar /app.jar</span></span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash"> entrypoint.sh /entrypoint.sh</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;/entrypoint.sh&quot;</span>]</span></span><br></pre></td></tr></table></figure><p>çœ‹èµ·æ¥å¾ˆæ­£å¸¸å¯¹å§ï¼Œä½†æ˜¯å¯åŠ¨æŠ¥é”™ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Invalid initial heap size: -Xms2g -Xmx2g -XX:MetaspaceSize=256m -XX:MaxMetaspaceSize=512m -XX:+UseConcMarkSweepGC -XX:+UseCMSInitiatingOccupancyOnly -XX:CMSInitiatingOccupancyFraction=70 -XX:+ExplicitGCInvokesConcurrentAndUnloadsClasses -XX:+CMSClassUnloadingEnabled -XX:+ParallelRefProcEnabled -XX:+CMSScavengeBeforeRemark -XX:ErrorFile=/logs/hs_err_pid%p.log -Xloggc:/logs/gc.log -XX:HeapDumpPath=/logs -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:+HeapDumpOnOutOfMemoryError -XX:+PrintCommandLineFlags</span><br><span class="line">Error: Could not create the Java Virtual Machine.</span><br><span class="line">Error: A fatal exception has occurred. Program will <span class="built_in">exit</span>.</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹æ§åˆ¶å°ï¼Œecho å‡ºæ¥çš„ <code>JAVA_CMD</code> å˜é‡ä¹Ÿæ˜¯æ­£å¸¸çš„<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/20250321172510730.png" alt="image.png"></p><p>ä¸­é—´æ’æŸ¥è¿‡ç¨‹å¿½ç•¥ï¼Œæœ€åå¢åŠ äº† <code>set -x</code> å‚æ•°åï¼Œé‡æ–°æ‰“åŒ…é•œåƒï¼Œå†æ¬¡æŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºï¼š</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/20250321171117808.png" alt="image.png"></p><p>æ³¨æ„ä»¥ + å¼€å¤´çš„è¾“å‡º è¿™é‡Œ java å¯åŠ¨å‘½ä»¤æ˜¯è¢«è§£ææˆäº†å•å¼•å·å¼•ç”¨ï¼Œæ‰€ä»¥é€ æˆæ— æ³•å¯åŠ¨ã€‚æŠŠ java å¯åŠ¨å‚æ•°ä¸­çš„ç¯å¢ƒå˜é‡åŒå¼•å·å»æ‰ï¼Œå¯ä»¥æ­£å¸¸å¯åŠ¨äº†ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">set</span> -x</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -n <span class="string">&quot;<span class="variable">$JVM_PARAM</span>&quot;</span> ];</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;JVM_PARAM: <span class="variable">$JVM_PARAM</span>&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  JVM_PARAM=<span class="string">&quot;-Xms2g -Xmx2g -XX:MetaspaceSize=256m -XX:MaxMetaspaceSize=512m&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -n <span class="string">&quot;<span class="variable">$JVM_OPTS</span>&quot;</span> ];</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;JVM_OPTS: <span class="variable">$JVM_OPTS</span>&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  JVM_OPTS=<span class="string">&quot;-XX:+UseConcMarkSweepGC -XX:+UseCMSInitiatingOccupancyOnly -XX:CMSInitiatingOccupancyFraction=70 -XX:+ExplicitGCInvokesConcurrentAndUnloadsClasses -XX:+CMSClassUnloadingEnabled -XX:+ParallelRefProcEnabled -XX:+CMSScavengeBeforeRemark -XX:ErrorFile=/logs/hs_err_pid%p.log -Xloggc:/logs/gc.log -XX:HeapDumpPath=/logs -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:+HeapDumpOnOutOfMemoryError -XX:+PrintCommandLineFlags&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">JAVA_CMD=<span class="string">&quot;<span class="variable">$JVM_PARAM</span> <span class="variable">$JVM_OPTS</span>&quot;</span></span><br><span class="line"></span><br><span class="line">AGENT_OPTS=<span class="string">&quot;-javaagent:/hawkeye-agent/hawkeye-agent.jar=APPNAME?AGENT_UID=x-zahuifan-userid&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;true&quot;</span> == <span class="string">&quot;<span class="variable">$AGENT_ENABLED</span>&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;JAVA_CMD: <span class="variable">$JAVA_CMD</span> <span class="variable">$AGENT_OPTS</span>&quot;</span></span><br><span class="line">    java <span class="variable">$JAVA_CMD</span> <span class="variable">$AGENT_OPTS</span> -jar /app/app.jar  <span class="comment"># è¿™é‡Œå»æ‰åŒå¼•å·</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;JAVA_CMD: <span class="variable">$JAVA_CMD</span>&quot;</span></span><br><span class="line">    java <span class="variable">$JAVA_CMD</span> -jar /app/app.jar              <span class="comment"># è¿™é‡Œå»æ‰åŒå¼•å·</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><p>ç½ªé­ç¥¸é¦–ï¼šShell å˜é‡å±•å¼€çš„åˆ†è¯æœºåˆ¶<br>é—®é¢˜çš„æœ¬è´¨åœ¨äº Shell è„šæœ¬ä¸­å˜é‡å±•å¼€æ—¶çš„å‚æ•°åˆ†å‰²è§„åˆ™ã€‚å½“æˆ‘ä»¬ä½¿ç”¨ <code>&quot;$VAR&quot;</code> è¿™ç§å¸¦å¼•å·çš„å†™æ³•æ—¶ï¼Œå˜é‡å€¼ä¸­çš„æ‰€æœ‰å†…å®¹ä¼šè¢«è§†ä¸ºä¸€ä¸ªæ•´ä½“å‚æ•°ï¼Œå³ä½¿å…¶ä¸­åŒ…å«ç©ºæ ¼ä¹Ÿä¸ä¼šè¢«åˆ†å‰²ã€‚è€Œ Java è™šæ‹Ÿæœºè¦æ±‚æ¯ä¸ªå‚æ•°å¿…é¡»ä½œä¸ºç‹¬ç«‹çš„å‘½ä»¤è¡Œå‚æ•°ä¼ é€’ã€‚</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;p&gt;æ„å»ºå®¹å™¨é•œåƒå¯¹è¿ç»´æ¥è¯´å·²ç»è½»è½¦ç†Ÿè·¯äº†ï¼Œä½†æ˜¯æœ€è¿‘é‡åˆ°ä¸ªé—®é¢˜ç™¾æ€ä¸å¾—å…¶è§£ï¼Œå‡†ç¡®çš„è¯´å°±æ˜¯æ‰‹åŠ¨æ‰§è¡Œ java -jar å¸¦ä¸Šæ‰€æœ‰å‚æ•°ï¼Œå¯ä»¥æ­£å¸¸å¯åŠ¨ï¼Œä½†æ˜¯æ‰“åŒ…æˆé•œåƒå°±ä¼šæŠ¥é”™ï¼š&lt;/p&gt;
&lt;p&gt;å…ˆé™„ä¸Š &lt;code&gt;entrypoint.sh&lt;/code&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span</summary>
        
      
    
    
    
    <category term="å®¹å™¨" scheme="https://zahui.fan/categories/%E5%AE%B9%E5%99%A8/"/>
    
    
    <category term="Shell" scheme="https://zahui.fan/tags/Shell/"/>
    
    <category term="Docker" scheme="https://zahui.fan/tags/Docker/"/>
    
    <category term="java" scheme="https://zahui.fan/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>åœ¨ Hyper-V ä¸‹å¯ç”¨ Fedora 41 çš„å¢å¼ºä¼šè¯æ¨¡å¼</title>
    <link href="https://zahui.fan/posts/ssqj2c/"/>
    <id>https://zahui.fan/posts/ssqj2c/</id>
    <published>2025-03-07T03:58:59.000Z</published>
    <updated>2025-03-28T03:05:24.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å®‰è£…ä¸€äº›åŸºç¡€åŒ…"><a href="#å®‰è£…ä¸€äº›åŸºç¡€åŒ…" class="headerlink" title="å®‰è£…ä¸€äº›åŸºç¡€åŒ…"></a>å®‰è£…ä¸€äº›åŸºç¡€åŒ…</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo dnf install -y hyperv-tools</span><br><span class="line">sudo dnf install -y xrdp xrdp-selinux</span><br></pre></td></tr></table></figure><h2 id="é…ç½®-Fedora"><a href="#é…ç½®-Fedora" class="headerlink" title="é…ç½® Fedora"></a>é…ç½® Fedora</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> xrdp</span><br><span class="line">systemctl <span class="built_in">enable</span> xrdp-sesman</span><br><span class="line"></span><br><span class="line"><span class="comment"># use vsock transport.</span></span><br><span class="line">sed -i_orig -e <span class="string">&#x27;s/port=3389/port=vsock:\/\/-1:3389/g&#x27;</span> /etc/xrdp/xrdp.ini</span><br><span class="line"><span class="comment"># use rdp security.</span></span><br><span class="line">sed -i_orig -e <span class="string">&#x27;s/security_layer=negotiate/security_layer=rdp/g&#x27;</span> /etc/xrdp/xrdp.ini</span><br><span class="line"><span class="comment"># remove encryption validation.</span></span><br><span class="line">sed -i_orig -e <span class="string">&#x27;s/crypt_level=high/crypt_level=none/g&#x27;</span> /etc/xrdp/xrdp.ini</span><br><span class="line"><span class="comment"># disable bitmap compression since its local its much faster</span></span><br><span class="line">sed -i_orig -e <span class="string">&#x27;s/bitmap_compression=true/bitmap_compression=false/g&#x27;</span> /etc/xrdp/xrdp.ini</span><br><span class="line"><span class="comment"># rename the redirected drives to &#x27;shared-drives&#x27;</span></span><br><span class="line">sed -i_orig -e <span class="string">&#x27;s/FuseMountName=thinclient_drives/FuseMountName=shared-drives/g&#x27;</span> /etc/xrdp/sesman.ini</span><br><span class="line"></span><br><span class="line"><span class="comment"># Change the allowed_users</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;allowed_users=anybody&quot;</span> &gt; /etc/X11/Xwrapper.config</span><br><span class="line"></span><br><span class="line"><span class="comment">#Ensure hv_sock gets loaded</span></span><br><span class="line"><span class="keyword">if</span> [ ! -e /etc/modules-load.d/hv_sock.conf ]; <span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;hv_sock&quot;</span> &gt; /etc/modules-load.d/hv_sock.conf</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Open port</span></span><br><span class="line">firewall-cmd --add-port=3389/tcp --permanent</span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure><h2 id="é…ç½®-Hyper-V-è™šæ‹Ÿæœº"><a href="#é…ç½®-Hyper-V-è™šæ‹Ÿæœº" class="headerlink" title="é…ç½® Hyper-V è™šæ‹Ÿæœº"></a>é…ç½® Hyper-V è™šæ‹Ÿæœº</h2><p>å°† Fedora å…³æœºï¼Œä»¥<strong>ç®¡ç†å‘˜</strong>èº«ä»½è¿è¡Œ powershellï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Set-VM</span> <span class="literal">-VMName</span> &lt;your_vm_name&gt; <span class="literal">-EnhancedSessionTransportType</span> HvSocket</span><br></pre></td></tr></table></figure><h2 id="å¼•ç”¨"><a href="#å¼•ç”¨" class="headerlink" title="å¼•ç”¨"></a>å¼•ç”¨</h2><p>ä»£ç æ¥è‡ªï¼š<a href="https://github.com/hu-ximing/Hyper-V-RHEL-Fedora-enhanced-session/">https://github.com/hu-ximing/Hyper-V-RHEL-Fedora-enhanced-session/</a></p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h2 id=&quot;å®‰è£…ä¸€äº›åŸºç¡€åŒ…&quot;&gt;&lt;a href=&quot;#å®‰è£…ä¸€äº›åŸºç¡€åŒ…&quot; class=&quot;headerlink&quot; title=&quot;å®‰è£…ä¸€äº›åŸºç¡€åŒ…&quot;&gt;&lt;/a&gt;å®‰è£…ä¸€äº›åŸºç¡€åŒ…&lt;/h2&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span</summary>
        
      
    
    
    
    <category term="å·¥å…·" scheme="https://zahui.fan/categories/%E5%B7%A5%E5%85%B7/"/>
    
    
  </entry>
  
  <entry>
    <title>Logstash å†™å…¥ ESï¼šå€ŸåŠ©è‡ªå®šä¹‰æ¨¡æ¿ä¼˜åŒ–æ•°æ®æ˜ å°„ä¸å­˜å‚¨</title>
    <link href="https://zahui.fan/posts/ss9srz/"/>
    <id>https://zahui.fan/posts/ss9srz/</id>
    <published>2025-02-26T03:09:35.000Z</published>
    <updated>2025-02-26T03:41:19.000Z</updated>
    
    <content type="html"><![CDATA[<p>æˆ‘ä»¬çš„ä¸šåŠ¡åœºæ™¯æ˜¯ ES å­˜å‚¨çš„éƒ½æ˜¯ä¸€äº›ä¸å¤ªé‡è¦çš„æ—¥å¿—ï¼Œä½†æ˜¯å¯¹å­˜å‚¨æ¯”è¾ƒæ•æ„Ÿï¼Œä½†æ˜¯æŸ¥çœ‹äº† ES ç´¢å¼•éƒ½æ˜¯é»˜è®¤åˆ›å»ºäº†ä¸€ä¸ªå‰¯æœ¬çš„ã€‚è¿™ä¼šé€ æˆå­˜å‚¨ç©ºé—´ç¿»å€ã€‚ç°åœ¨é€šè¿‡è°ƒæ•´ logstash é…ç½®æ¥å®ç°åˆ›å»ºå‡ºæ¥çš„ç´¢å¼•åº”ç”¨è‡ªå®šä¹‰é…ç½®ï¼Œæ¯”å¦‚å¯ä»¥å®ç° 30 å¤©å‰çš„æ—¥å¿—è‡ªåŠ¨æ¸…ç†ï¼Œé»˜è®¤ä¸åˆ›å»ºå‰¯æœ¬ç­‰ã€‚</p><h2 id="åˆ›å»ºç”Ÿå‘½å‘¨æœŸç­–ç•¥"><a href="#åˆ›å»ºç”Ÿå‘½å‘¨æœŸç­–ç•¥" class="headerlink" title="åˆ›å»ºç”Ÿå‘½å‘¨æœŸç­–ç•¥"></a>åˆ›å»ºç”Ÿå‘½å‘¨æœŸç­–ç•¥</h2><p>åœ¨ ES ä¸Šåˆ›å»ºä¸€ä¸ªç”Ÿå‘½å‘¨æœŸç­–ç•¥ï¼Œå®šä¹‰ç´¢å¼•ä¿ç•™ 14 å¤©ã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">PUT _ilm/policy/user_monitor_point-retention-policy</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;policy&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;phases&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;hot&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;min_age&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0ms&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;actions&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;delete&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;min_age&quot;</span><span class="punctuation">:</span> <span class="string">&quot;14d&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;actions&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;delete&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h2 id="åˆ›å»º-ES-æ¨¡æ¿é…ç½®æ–‡ä»¶"><a href="#åˆ›å»º-ES-æ¨¡æ¿é…ç½®æ–‡ä»¶" class="headerlink" title="åˆ›å»º ES æ¨¡æ¿é…ç½®æ–‡ä»¶"></a>åˆ›å»º ES æ¨¡æ¿é…ç½®æ–‡ä»¶</h2><p>å‡†å¤‡ä¸€ä¸ª template é…ç½®æ–‡ä»¶ <code>logstash-template.json</code></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;index_patterns&quot;</span><span class="punctuation">:</span> <span class="string">&quot;user_monitor_point-*&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;order&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;lifecycle&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;user_monitor_point-retention-policy&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;number_of_replicas&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œå®šä¹‰äº†åº”ç”¨çš„æ¨¡æ¿è§„åˆ™ï¼Œåº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸè§„åˆ™ï¼Œè¿˜æœ‰å‰¯æœ¬æ•°ã€‚</p><p>logstash é…ç½®æ–‡ä»¶ <code>logstash.conf</code></p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">output &#123;</span><br><span class="line">  <span class="keyword">if</span> [type] == <span class="string">&quot;logstash_mixins&quot;</span> &#123;</span><br><span class="line">      elasticsearch &#123;</span><br><span class="line">        action   =&gt; <span class="string">&quot;index&quot;</span></span><br><span class="line">        hosts    =&gt; [<span class="string">&quot;http://10.20.20.2:9200&quot;</span>, <span class="string">&quot;http://10.20.20.3:9200&quot;</span>,<span class="string">&quot;http://10.20.20.6:9200&quot;</span>]</span><br><span class="line">        index    =&gt; <span class="string">&quot;user_monitor_point-%&#123;+YYYY.MM.dd&#125;&quot;</span></span><br><span class="line">        user     =&gt; <span class="string">&quot;elastic&quot;</span></span><br><span class="line">        password =&gt; <span class="string">&quot;password&quot;</span></span><br><span class="line">        <span class="comment"># è¿™ä¸ªè®¾ç½®æ§åˆ¶æ˜¯å¦è‡ªåŠ¨ç®¡ç†ç´¢å¼•æ¨¡æ¿ã€‚è®¾ç½®ä¸º true æ—¶ï¼ŒLogstash ä¼šè‡ªåŠ¨åˆ›å»ºå’Œç®¡ç†ç´¢å¼•æ¨¡æ¿ï¼ˆåŒ…æ‹¬å­—æ®µæ˜ å°„å’Œè®¾ç½®ï¼‰</span></span><br><span class="line">        manage_template =&gt; <span class="literal">true</span></span><br><span class="line">        <span class="comment"># å¦‚æœå·²ç»å­˜åœ¨ç›¸åŒåç§°çš„ç´¢å¼•æ¨¡æ¿ï¼Œè®¾ç½® template_overwrite =&gt; true ä¼šè¦†ç›–ç°æœ‰æ¨¡æ¿ã€‚</span></span><br><span class="line">        template_overwrite =&gt; <span class="literal">true</span></span><br><span class="line">        template =&gt; <span class="string">&#x27;/etc/logstash-template.json&#x27;</span></span><br><span class="line">     &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·ä½¿ç”¨ logstash åˆ›å»ºç´¢å¼•çš„æ—¶å€™å°±ä¼šè‡ªåŠ¨åº”ç”¨æ¨¡æ¿è§„åˆ™ã€‚</p><p>å½“ç„¶ä¹Ÿå¯ä»¥å°† <code>manage_template</code> è®¾ç½®æˆ <code>false</code> è½¬è€Œä½¿ç”¨ ES æ¥ç®¡ç†ç´¢å¼•æ¨¡æ¿é…ç½®ã€‚</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;p&gt;æˆ‘ä»¬çš„ä¸šåŠ¡åœºæ™¯æ˜¯ ES å­˜å‚¨çš„éƒ½æ˜¯ä¸€äº›ä¸å¤ªé‡è¦çš„æ—¥å¿—ï¼Œä½†æ˜¯å¯¹å­˜å‚¨æ¯”è¾ƒæ•æ„Ÿï¼Œä½†æ˜¯æŸ¥çœ‹äº† ES ç´¢å¼•éƒ½æ˜¯é»˜è®¤åˆ›å»ºäº†ä¸€ä¸ªå‰¯æœ¬çš„ã€‚è¿™ä¼šé€ æˆå­˜å‚¨ç©ºé—´ç¿»å€ã€‚ç°åœ¨é€šè¿‡è°ƒæ•´ logstash é…ç½®æ¥å®ç°åˆ›å»ºå‡ºæ¥çš„ç´¢å¼•åº”ç”¨è‡ªå®šä¹‰é…ç½®ï¼Œæ¯”å¦‚å¯ä»¥å®ç° 30 å¤©å‰çš„æ—¥å¿—è‡ªåŠ¨æ¸…ç†ï¼Œé»˜è®¤ä¸åˆ›å»ºå‰¯æœ¬ç­‰ã€‚&lt;/p&gt;
&lt;h2 id=&quot;åˆ›å»ºç”Ÿå‘½å‘¨æœŸç­–ç•¥&quot;&gt;&lt;a href=&quot;#åˆ›å»ºç”Ÿå‘½å‘¨æœŸç­–ç•¥&quot;</summary>
        
      
    
    
    
    <category term="æ—¥å¿—" scheme="https://zahui.fan/categories/%E6%97%A5%E5%BF%97/"/>
    
    
    <category term="Elasticsearch" scheme="https://zahui.fan/tags/Elasticsearch/"/>
    
    <category term="ES" scheme="https://zahui.fan/tags/ES/"/>
    
    <category term="logstash" scheme="https://zahui.fan/tags/logstash/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨Pythonè¯†åˆ«éªŒè¯ç  ddddocr</title>
    <link href="https://zahui.fan/posts/ss2wk6/"/>
    <id>https://zahui.fan/posts/ss2wk6/</id>
    <published>2025-02-22T09:48:05.000Z</published>
    <updated>2025-04-01T06:36:31.000Z</updated>
    
    <content type="html"><![CDATA[<p>GitHub åœ°å€ï¼š<a href="https://github.com/sml2h3/ddddocr">https://github.com/sml2h3/ddddocr</a></p><p>å®‰è£…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install ddddocr</span><br></pre></td></tr></table></figure><p>å¦‚æœ windows å®‰è£…æŠ¥é”™ï¼š<code>ImportErrorï¼šDLL load failed: æ‰¾ä¸åˆ°æŒ‡å®šçš„æ¨¡å—ã€‚</code><br>éœ€è¦å®‰è£… vc è¿è¡Œåº“ï¼š<br><a href="https://aka.ms/vs/16/release/VC_redist.x86.exe">https://aka.ms/vs/16/release/VC_redist.x86.exe</a></p><p><a href="https://aka.ms/vs/16/release/VC_redist.x64.exe">https://aka.ms/vs/16/release/VC_redist.x64.exe</a></p><p>åŸºæœ¬ä½¿ç”¨ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ddddocr</span><br><span class="line"></span><br><span class="line">ocr = ddddocr.DdddOcr(show_ad=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">image = <span class="built_in">open</span>(<span class="string">&quot;example.jpg&quot;</span>, <span class="string">&quot;rb&quot;</span>).read()</span><br><span class="line">result = ocr.classification(image)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure><p>åˆå§‹åŒ–ä¼ å‚ <code>show_ad=False</code> è¾“å‡ºå°±ä¸å¸¦ä½œè€…çš„å¹¿å‘Šäº†ã€‚</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;p&gt;GitHub åœ°å€ï¼š&lt;a href=&quot;https://github.com/sml2h3/ddddocr&quot;&gt;https://github.com/sml2h3/ddddocr&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å®‰è£…&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span</summary>
        
      
    
    
    
    <category term="å¼€å‘" scheme="https://zahui.fan/categories/%E5%BC%80%E5%8F%91/"/>
    
    
    <category term="Python" scheme="https://zahui.fan/tags/Python/"/>
    
    <category term="OCR" scheme="https://zahui.fan/tags/OCR/"/>
    
  </entry>
  
  <entry>
    <title>è§£å†³PyCharmç»ˆç«¯ä½¿ç”¨zsh powerlevel10kä¸»é¢˜æ—¶çš„ä¹±ç é—®é¢˜</title>
    <link href="https://zahui.fan/posts/srz9zs/"/>
    <id>https://zahui.fan/posts/srz9zs/</id>
    <published>2025-02-20T10:47:52.000Z</published>
    <updated>2025-02-20T15:12:52.000Z</updated>
    
    <content type="html"><![CDATA[<p><code>powerlevel10k</code> æ˜¯ zsh ä¸Šå¾ˆå¥½çœ‹çš„ä¸»é¢˜ï¼Œæˆ‘ä¸€ç›´æ˜¯åœ¨ wsl é‡Œç”¨ï¼Œé…åˆ <code>Windows Terminal</code> å¾ˆå¥½çœ‹ï¼Œä¸è¿‡åœ¨ PyCharm é‡Œæ‰“å¼€ä¼šä¹±ç ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹æ§åˆ¶å°å­—ä½“ä¸ºæ”¯æŒ powerline çš„å­—ä½“ï¼Œä¸è¿‡è¿˜æ˜¯ä¸å®Œç¾ï¼Œæœ‰æ—¶å€™è¿˜æœ‰ BUGã€‚</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/20250220230144904.png" alt="image.png|577"></p><p>æƒ³äº†ä¸‹ï¼Œæˆ‘å¹³æ—¶éƒ½æ˜¯åœ¨ <code>Windows Terminal</code> ä¸Šç”¨çš„ï¼Œé‚£ä¹ˆå¯ä»¥è®©ä½¿ç”¨ <code>Windows Terminal</code> çš„æ—¶å€™æ˜¾ç¤ºæˆ<strong>èŠ±é‡Œèƒ¡å“¨</strong>çš„ä¸»é¢˜ï¼Œç”¨å…¶ä»–è½¯ä»¶æ¯”å¦‚ PyCharm æˆ–è€… VScode çš„æ—¶å€™ï¼Œæ¢æˆ<strong>æœ´ç´ </strong>çš„ä¸»é¢˜ã€‚çœ‹äº†ä¸‹ï¼Œåœ¨ <code>Windows Terminal</code> ä¸Šæœ‰ä¸ªç‰¹æ®Šçš„ç¯å¢ƒå˜é‡ <code>WT_SESSION</code> å’Œ <code>WT_PROFILE_ID</code> ï¼Œçœ‹åå­—åº”è¯¥æ˜¯å’Œ Windows terminal æœ‰å…³ï¼Œæµ‹è¯•äº†ä¸‹ä¹Ÿç¡®å®å¦‚æ­¤ï¼Œé‚£ä¹ˆå¯ä»¥ä¿®æ”¹ <code>~/.zshrc</code> æ¥å®ç°ã€‚</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/20250220230859339.png" alt="image.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> [[ <span class="variable">$WT_SESSION</span> ]]; <span class="keyword">then</span></span><br><span class="line">  ZSH_THEME=<span class="string">&quot;powerlevel10k/powerlevel10k&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  ZSH_THEME=<span class="string">&quot;robbyrussell&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><p>æ­¤æ—¶æ˜¾ç¤ºå¦‚ä¸‹ï¼š</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/20250220231032118.png"></p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;p&gt;&lt;code&gt;powerlevel10k&lt;/code&gt; æ˜¯ zsh ä¸Šå¾ˆå¥½çœ‹çš„ä¸»é¢˜ï¼Œæˆ‘ä¸€ç›´æ˜¯åœ¨ wsl é‡Œç”¨ï¼Œé…åˆ &lt;code&gt;Windows Terminal&lt;/code&gt; å¾ˆå¥½çœ‹ï¼Œä¸è¿‡åœ¨ PyCharm é‡Œæ‰“å¼€ä¼šä¹±ç ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹æ§åˆ¶å°å­—ä½“ä¸ºæ”¯æŒ powerline çš„å­—ä½“ï¼Œä¸è¿‡è¿˜æ˜¯ä¸å®Œç¾ï¼Œæœ‰æ—¶å€™è¿˜æœ‰ BUGã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=</summary>
        
      
    
    
    
    <category term="å·¥å…·" scheme="https://zahui.fan/categories/%E5%B7%A5%E5%85%B7/"/>
    
    
  </entry>
  
  <entry>
    <title>Nacos 2.0.3 é›†ç¾¤å‡çº§ä¸º 2.1.0</title>
    <link href="https://zahui.fan/posts/srnwhe/"/>
    <id>https://zahui.fan/posts/srnwhe/</id>
    <published>2025-02-14T07:22:25.000Z</published>
    <updated>2025-02-14T07:40:13.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="2-0-3-ç‰ˆæœ¬çš„-BUG"><a href="#2-0-3-ç‰ˆæœ¬çš„-BUG" class="headerlink" title="2.0.3 ç‰ˆæœ¬çš„ BUG"></a>2.0.3 ç‰ˆæœ¬çš„ BUG</h2><p>è¯¦ç»† bug åœ¨ GitHub ä¸Šæœ‰ï¼Œæ¯”å¦‚ï¼š<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/20250214153333408.webp" alt="image.png"></p><p>issue é“¾æ¥è§ï¼š<br><a href="https://github.com/alibaba/nacos/issues/9332">https://github.com/alibaba/nacos/issues/9332</a><br><a href="https://github.com/alibaba/nacos/issues/8492">https://github.com/alibaba/nacos/issues/8492</a></p><p>æˆ‘ä»¬é‡åˆ°çš„ bug ç®€å•ä¸€å¥è¯æ€»ç»“å°±æ˜¯ï¼šé›†ç¾¤æ–¹å¼éƒ¨ç½²çš„ nacos å…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹é‡å¯åå¯èƒ½ä¼šæœ‰èŠ‚ç‚¹æ•°æ®ä¸ä¸€è‡´çš„ç°è±¡ï¼ˆæœåŠ¡æ³¨å†Œä¸æœåŠ¡å‘ç°é‡Œé¢çš„æœåŠ¡æ•°é‡ä¸ä¸€è‡´ï¼‰æ¯”å¦‚è¯´ä¸€ä¸ªæœåŠ¡æ³¨å†Œåˆ°äº† nacos ä¸­ï¼Œæˆ‘åœ¨ nacos ç½‘é¡µæ§åˆ¶å° <code>æœåŠ¡ç®¡ç†</code> <code>æœåŠ¡åˆ—è¡¨</code> é‡ŒæŸ¥çœ‹æœ‰ 10 ä¸ªæœåŠ¡æ³¨å†Œè¿›æ¥ï¼Œåˆ·æ–°ä¸‹ç½‘é¡µå¯èƒ½å°±å˜æˆäº† 9 ä¸ªï¼Œå†åˆ·æ–°åˆå˜æˆ 10 ä¸ªï¼Œè¿™ç§æƒ…å†µå°±æ˜¯ nacos çš„å¤šä¸ªèŠ‚ç‚¹æ•°æ®ä¸åŒæ­¥äº†ï¼ˆnacos é…ç½®ä¸­å¿ƒæ•°æ®æ˜¯ä» MySQL å–çš„ï¼Œä¸å—è¿™ä¸ª bug çš„å½±å“ï¼‰ï¼Œè¿™ç§æƒ…å†µå¯ä»¥ç›´æ¥å°† nacos å‰¯æœ¬æ•°è®¾ç½®æˆ 1 ä¸´æ—¶è§£å†³ï¼Œæƒ³è¦å½»åº•è§£å†³æˆ‘ä»¬éªŒè¯äº†å‡çº§åˆ° 2.1.0 å°±èƒ½ä¿®å¤ã€‚</p><h2 id="å‡çº§æ•°æ®åº“è¡¨ç»“æ„"><a href="#å‡çº§æ•°æ®åº“è¡¨ç»“æ„" class="headerlink" title="å‡çº§æ•°æ®åº“è¡¨ç»“æ„"></a>å‡çº§æ•°æ®åº“è¡¨ç»“æ„</h2><blockquote><p>nacos å®˜ç½‘æ–‡æ¡£å†™çš„å¤ªæ•·è¡äº†ï¼Œç‰ˆæœ¬ä¹‹é—´çš„å·®å¼‚éœ€è¦è‡ªå·±æ‰¾ï¼Œå“ªæ€•ä½ ä¸Šä¸ª flyway ä¹Ÿå¥½å•Šã€‚</p></blockquote><p>å…¶ä¸­æœ‰ä¸‰ä¸ªè¡¨ï¼ˆconfig_infoã€config_info_betaã€his_config_infoï¼‰éƒ½åŠ äº† encrypted_data_key è¿™ä¸ªå­—æ®µã€‚ æ‰€ä»¥å‡çº§æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼Œåœ¨è¿™ä¸‰å¼ è¡¨ä¸Šéƒ½åŠ ä¸Š encrypted_data_key è¿™ä¸ªå­—æ®µå°±è¡Œäº†ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> nacos.config_info <span class="keyword">ADD</span> encrypted_data_key TEXT <span class="keyword">NOT</span> <span class="keyword">NULL</span>; </span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> nacos.config_info_beta <span class="keyword">ADD</span> encrypted_data_key TEXT <span class="keyword">NOT</span> <span class="keyword">NULL</span>; </span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> nacos.his_config_info <span class="keyword">ADD</span> encrypted_data_key TEXT <span class="keyword">NOT</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure><h2 id="å‡çº§ç‰ˆæœ¬åˆ°-2-1-0"><a href="#å‡çº§ç‰ˆæœ¬åˆ°-2-1-0" class="headerlink" title="å‡çº§ç‰ˆæœ¬åˆ° 2.1.0"></a>å‡çº§ç‰ˆæœ¬åˆ° 2.1.0</h2><p>æˆ‘ä»¬æ˜¯éƒ¨ç½²åœ¨ Kubernetes ä¸­çš„ï¼Œåªéœ€è¦å‡çº§é•œåƒç‰ˆæœ¬å°±è¡Œäº†ã€‚ä¸€ä¸ªé•œåƒä»£ç†åœ°å€ï¼š<code>registry.cn-hangzhou.aliyuncs.com/iuxt/nacos-server:v2.1.0</code></p><p>å…·ä½“éƒ¨ç½²é…ç½®æŸ¥çœ‹ï¼š<a href="/posts/sebxm6/">åœ¨Kubernetesä¸­éƒ¨ç½²nacos 2.1.0</a></p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h2 id=&quot;2-0-3-ç‰ˆæœ¬çš„-BUG&quot;&gt;&lt;a href=&quot;#2-0-3-ç‰ˆæœ¬çš„-BUG&quot; class=&quot;headerlink&quot; title=&quot;2.0.3 ç‰ˆæœ¬çš„ BUG&quot;&gt;&lt;/a&gt;2.0.3 ç‰ˆæœ¬çš„ BUG&lt;/h2&gt;&lt;p&gt;è¯¦ç»† bug åœ¨ GitHub ä¸Šæœ‰ï¼Œæ¯”å¦‚ï¼š&lt;br&gt;&lt;img src= &quot;https://static.zahui.fan/public/nes.gif&quot;</summary>
        
      
    
    
    
    <category term="å®¹å™¨" scheme="https://zahui.fan/categories/%E5%AE%B9%E5%99%A8/"/>
    
    
    <category term="Kubernetes" scheme="https://zahui.fan/tags/Kubernetes/"/>
    
    <category term="nacos" scheme="https://zahui.fan/tags/nacos/"/>
    
  </entry>
  
  <entry>
    <title>ç¾¤æ™–NASéƒ¨ç½²zerotierå†…ç½‘ç©¿é€è®¿é—®</title>
    <link href="https://zahui.fan/posts/spi492/"/>
    <id>https://zahui.fan/posts/spi492/</id>
    <published>2025-01-03T07:17:25.000Z</published>
    <updated>2025-01-03T15:40:32.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å®Œæˆè¿™ä¸ªæ•™ç¨‹ï¼Œä½ ä¸»è¦éœ€è¦å®Œæˆä»¥ä¸‹æµç¨‹ï¼š</p><ul><li>åœ¨ NAS ä¸Šå¯ç”¨ SSH</li><li>åˆ›å»ºä¸€ä¸ªæŒä¹…çš„ TUN</li><li>å®‰è£… Docker</li><li>è®¾ç½® Docker</li></ul><h2 id="åˆ›å»ºä¸€ä¸ªæŒä¹…çš„-TUN"><a href="#åˆ›å»ºä¸€ä¸ªæŒä¹…çš„-TUN" class="headerlink" title="åˆ›å»ºä¸€ä¸ªæŒä¹…çš„ TUN"></a>åˆ›å»ºä¸€ä¸ªæŒä¹…çš„ TUN</h2><div class="note info flat"><p>å¦‚æœæœ‰ <code>/dev/net/tun</code> å°±ä¸ç”¨å†æ‰§è¡Œäº†</p></div><p>ä½¿ç”¨ SSH è¿æ¥åˆ°ä½ çš„ NASï¼Œåˆ‡æ¢ä¸º root èº«ä»½</p><p>åˆ›å»ºä¸€ä¸ªå¼€æœºè‡ªå¯åŠ¨è„šæœ¬: <code>/usr/local/etc/rc.d/tun.sh</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºå¼€æœºè‡ªå¯åŠ¨è„šæœ¬</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&#x27;#!/bin/sh -e \ninsmod /lib/modules/tun.ko&#x27;</span> &gt; /usr/local/etc/rc.d/tun.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ å¯æ‰§è¡Œæƒé™</span></span><br><span class="line"><span class="built_in">chmod</span> a+x /usr/local/etc/rc.d/tun.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰‹åŠ¨æ‰§è¡Œä¸€ä¸‹</span></span><br><span class="line">/usr/local/etc/rc.d/tun.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ˜¯å¦æœ‰tunè®¾å¤‡</span></span><br><span class="line"><span class="built_in">ls</span> /dev/net/tun</span><br></pre></td></tr></table></figure><h2 id="å®‰è£…-Docker-åˆ°ä½ çš„-NAS-ä¸Š"><a href="#å®‰è£…-Docker-åˆ°ä½ çš„-NAS-ä¸Š" class="headerlink" title="å®‰è£… Docker åˆ°ä½ çš„ NAS ä¸Š"></a>å®‰è£… Docker åˆ°ä½ çš„ NAS ä¸Š</h2><p>ç›´æ¥åˆ°å¥—ä»¶ä¸­å¿ƒå»å®‰è£…ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /var/lib/zerotier-one</span><br></pre></td></tr></table></figure><p>åˆ›å»ºä¸€ä¸ªå®¹å™¨ï¼Œè¿™é‡Œå°†å®ƒå‘½åä¸º zerotierï¼Œè¿™é‡Œä¼šè‡ªåŠ¨ä¸‹è½½æœ€æ–°ç‰ˆçš„ zerotier</p><p>è¦åœ¨ ssh é‡Œåˆ›å»ºï¼Œä¸è¦åœ¨ç¾¤æ™–æ§åˆ¶å°åˆ›å»ºã€‚åˆ›å»ºå®Œæˆåå¯ä»¥åœ¨æ§åˆ¶å°è¿›è¡Œç®¡ç†ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">docker run -d           \</span><br><span class="line">  --name zerotier       \</span><br><span class="line">  --restart=always      \</span><br><span class="line">  --device=/dev/net/tun \</span><br><span class="line">  --net=host            \</span><br><span class="line">  --cap-add=NET_ADMIN   \</span><br><span class="line">  --cap-add=SYS_ADMIN   \</span><br><span class="line">  -v /var/lib/zerotier-one:/var/lib/zerotier-one \</span><br><span class="line">  registry.cn-hangzhou.aliyuncs.com/iuxt/zerotier-synology:1.14.0</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨ï¼šå®˜æ–¹é•œåƒï¼š<code>zerotier/zerotier-synology:latest</code></p></blockquote><h2 id="ä½¿ç”¨ä¸é…ç½®"><a href="#ä½¿ç”¨ä¸é…ç½®" class="headerlink" title="ä½¿ç”¨ä¸é…ç½®"></a>ä½¿ç”¨ä¸é…ç½®</h2><p>æŸ¥çœ‹çŠ¶æ€</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it zerotier zerotier-cli status</span><br></pre></td></tr></table></figure><p>æ·»åŠ ç½‘ç»œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it zerotier zerotier-cli <span class="built_in">join</span> &lt;ä½ çš„ç½‘ç»œID&gt;</span><br></pre></td></tr></table></figure><p>åœ¨ zerotier åå°æˆæƒå½“å‰è®¾å¤‡ï¼Œç„¶åæŸ¥çœ‹çŠ¶æ€ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it zerotier zerotier-cli listnetworks</span><br></pre></td></tr></table></figure><h2 id="ä½¿å±€åŸŸç½‘ç½‘æ®µå¯ä»¥è®¿é—®"><a href="#ä½¿å±€åŸŸç½‘ç½‘æ®µå¯ä»¥è®¿é—®" class="headerlink" title="ä½¿å±€åŸŸç½‘ç½‘æ®µå¯ä»¥è®¿é—®"></a>ä½¿å±€åŸŸç½‘ç½‘æ®µå¯ä»¥è®¿é—®</h2><h3 id="1-æ·»åŠ è·¯ç”±"><a href="#1-æ·»åŠ è·¯ç”±" class="headerlink" title="1. æ·»åŠ è·¯ç”±"></a>1. æ·»åŠ è·¯ç”±</h3><p>å‡è®¾å®¶é‡Œçš„æœºå™¨ï¼šzerotier åœ°å€æ˜¯ï¼š172.28.135.11ï¼Œå†…ç½‘ IP åœ°å€æ˜¯ 192.168.1.11</p><p>åœ¨ zerotier ç½‘ç«™çš„ networks é‡Œé¢çš„ Managed Routes ä¸‹é…ç½®è·¯ç”±è¡¨,å¢åŠ å¦‚ä¸‹å†…å®¹</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/20250103135337663.png" alt="image.png"></p><p>åŠ è¿‡è·¯ç”±åï¼Œå¯ä»¥è®¿é—®è¿™å° zerotier èŠ‚ç‚¹çš„å†…ç½‘ ipï¼ˆ192.168.1.11ï¼‰ äº†ï¼Œä½†æ˜¯ä¸èƒ½è®¿é—®å†…ç½‘çš„å…¶ä»– ipï¼Œè¿˜éœ€è¦åšä¸€ä¸‹è½¬å‘ã€‚</p><h3 id="2-å¼€å¯å†…æ ¸è½¬å‘"><a href="#2-å¼€å¯å†…æ ¸è½¬å‘" class="headerlink" title="2. å¼€å¯å†…æ ¸è½¬å‘"></a>2. å¼€å¯å†…æ ¸è½¬å‘</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo sysctl -w net.ipv4.ip_forward=1</span><br><span class="line">sudo sysctl -p</span><br></pre></td></tr></table></figure><p>é‡å¯åé…ç½®ä¼šä¸¢å¤±ï¼Œè¦æŒä¹…åŒ–å¯ä»¥å†™å…¥åˆ° <code>/etc/sysctl.conf</code></p><h3 id="3-é˜²ç«å¢™è®¾ç½®"><a href="#3-é˜²ç«å¢™è®¾ç½®" class="headerlink" title="3. é˜²ç«å¢™è®¾ç½®"></a>3. é˜²ç«å¢™è®¾ç½®</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> PHY_IF=ovs_eth0 <span class="comment"># ç‰©ç†ç½‘å¡è®¾å¤‡å</span></span><br><span class="line"><span class="built_in">export</span> ZT_IF=ztre4xmo4y <span class="comment"># Zerotierè™šæ‹Ÿç½‘å¡è®¾å¤‡å</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ è½¬å‘è§„åˆ™</span></span><br><span class="line">sudo iptables -t nat -A POSTROUTING -o <span class="variable">$PHY_IF</span> -j MASQUERADE</span><br><span class="line">sudo iptables -A FORWARD -i <span class="variable">$PHY_IF</span> -o <span class="variable">$ZT_IF</span> -m state --state RELATED,ESTABLISHED -j ACCEPT</span><br><span class="line">sudo iptables -A FORWARD -i <span class="variable">$ZT_IF</span> -o <span class="variable">$PHY_IF</span> -j ACCEPT</span><br></pre></td></tr></table></figure><p>é˜²ç«å¢™è§„åˆ™æ²¡ä¿å­˜çš„è¯é‡å¯åä¼šä¸¢å¤±ã€‚</p><div class="note info flat"><p>è¿™ä¸‰æ¡ iptables è§„åˆ™ç”¨äºé…ç½®ç½‘ç»œåœ°å€è½¬æ¢ï¼ˆNATï¼‰å’Œæ•°æ®åŒ…è½¬å‘ï¼›</p><p>å«ä¹‰å¦‚ä¸‹ï¼š</p><p>è§„åˆ™ 1ï¼š <code>sudo iptables -t nat -A POSTROUTING -o $PHY_IF -j MASQUERADE</code></p><p>è¿™æ¡è§„åˆ™åœ¨ nat è¡¨çš„ POSTROUTING é“¾ä¸­æ·»åŠ äº†ä¸€æ¡è§„åˆ™ã€‚-o $PHY_IF è¡¨ç¤ºè¿™æ¡è§„åˆ™é€‚ç”¨äºæ‰€æœ‰é€šè¿‡ $PHY_IF è¿™ä¸ªç½‘ç»œæ¥å£ï¼ˆé€šå¸¸æ˜¯ç‰©ç†æ¥å£ï¼‰å‡ºå»çš„æ•°æ®åŒ…ã€‚-j MASQUERADE æŒ‡å®šäº† NAT æ“ä½œä¸­çš„ä¼ªè£…ï¼ˆmasqueradingï¼‰ã€‚è¿™æ„å‘³ç€ï¼Œå½“æ•°æ®åŒ…ä» $PHY_IF å‘é€å‡ºå»æ—¶ï¼Œå…¶æº IP åœ°å€ä¼šè¢«æ›¿æ¢ä¸º $PHY_IF çš„ IP åœ°å€ã€‚è¿™é€šå¸¸ç”¨äºå…è®¸å†…éƒ¨ç½‘ç»œé€šè¿‡ä¸€ä¸ªå…¬å…± IP åœ°å€è¿›è¡Œå¤–éƒ¨é€šä¿¡ï¼›</p><p>è§„åˆ™ 2ï¼š <code>sudo iptables -A FORWARD -i $PHY_IF -o $ZT_IF -m state --state RELATED,ESTABLISHED -j ACCEPT</code></p><p>è¿™æ¡è§„åˆ™åœ¨ filter è¡¨çš„ FORWARD é“¾ä¸­æ·»åŠ äº†ä¸€æ¡è§„åˆ™ã€‚-i $PHY_IF è¡¨ç¤ºé€‚ç”¨äºä» $PHY_IF è¿™ä¸ªæ¥å£è¿›å…¥çš„æ•°æ®åŒ…ï¼Œ-o $ZT_IF è¡¨ç¤ºè¿™äº›æ•°æ®åŒ…è¦è½¬å‘åˆ° $ZT_IF è¿™ä¸ªæ¥å£ã€‚-m state â€“state RELATED,ESTABLISHED æŒ‡å®šäº†åªæœ‰é‚£äº›ä¸å·²æœ‰è¿æ¥ç›¸å…³æˆ–å·²ç»å»ºç«‹çš„è¿æ¥çš„æ•°æ®åŒ…æ‰è¢«æ¥å—ï¼ˆACCEPTï¼‰ã€‚è¿™ä¸ªè§„åˆ™é€šå¸¸ç”¨äºå…è®¸æ¥è‡ªå¤–éƒ¨ç½‘ç»œçš„è¿”å›æµé‡è¿›å…¥å†…éƒ¨ç½‘ç»œï¼Œä»è€Œæ”¯æŒè¯¸å¦‚ HTTP ä¼šè¯ç­‰ï¼›</p><p>è§„åˆ™ 3ï¼š <code>sudo iptables -A FORWARD -i $ZT_IF -o $PHY_IF -j ACCEPT</code></p><p>è¿™æ¡è§„åˆ™åœ¨ filter è¡¨çš„ FORWARD é“¾ä¸­æ·»åŠ äº†ä¸€æ¡è§„åˆ™ã€‚-i $ZT_IF è¡¨ç¤ºé€‚ç”¨äºä» $ZT_IF è¿™ä¸ªæ¥å£è¿›å…¥çš„æ•°æ®åŒ…ï¼Œ-o $PHY_IF è¡¨ç¤ºè¿™äº›æ•°æ®åŒ…è¦è½¬å‘åˆ° $PHY_IF è¿™ä¸ªæ¥å£ã€‚-j ACCEPT è¡¨ç¤ºè¿™äº›æ•°æ®åŒ…ä¼šè¢«æ¥å—å¹¶è½¬å‘ã€‚è¿™æ¡è§„åˆ™å…è®¸æ¥è‡ª $ZT_IF çš„æµé‡ç»è¿‡è·¯ç”±å™¨è½¬å‘åˆ° $PHY_IFï¼Œä»è€Œå®ç°ç½‘ç»œä¹‹é—´çš„æ•°æ®ä¼ è¾“ï¼›</p><p>æ€»ç»“ï¼š</p><p>ç¬¬ä¸€æ¡è§„åˆ™ç”¨äºè®¾ç½®æºåœ°å€ä¼ªè£…ï¼Œå…è®¸å†…éƒ¨ç½‘ç»œè®¾å¤‡é€šè¿‡ä¸€ä¸ªå…¬å…± IP åœ°å€è¿›è¡Œå¤–éƒ¨é€šä¿¡ï¼›<br>ç¬¬äºŒæ¡è§„åˆ™å…è®¸è¿”å›æµé‡å’Œå·²ç»å»ºç«‹çš„è¿æ¥çš„æ•°æ®åŒ…ä»å¤–éƒ¨ç½‘ç»œè¿›å…¥å†…éƒ¨ç½‘ç»œï¼›<br>ç¬¬ä¸‰æ¡è§„åˆ™å…è®¸æ¥è‡ªå†…éƒ¨ç½‘ç»œçš„æ•°æ®åŒ…è¢«è½¬å‘åˆ°å¤–éƒ¨ç½‘ç»œï¼›</p></div><p>ç½‘å¡è®¾å¤‡åå‚è€ƒ åœ¨æœºå™¨ä¸Šä½¿ç”¨å‘½ä»¤ <code>ip a</code> æŸ¥çœ‹ï¼š</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/20250103232323506.png" alt="image.png"></p><h2 id="å¼•ç”¨ä¸æ–‡çŒ®"><a href="#å¼•ç”¨ä¸æ–‡çŒ®" class="headerlink" title="å¼•ç”¨ä¸æ–‡çŒ®"></a>å¼•ç”¨ä¸æ–‡çŒ®</h2><blockquote><p>æœ¬æ–‡åŸºäºå®˜æ–¹åŸæ–‡è¿›è¡Œç¿»è¯‘å’Œè¡¥å…… <a href="https://docs.zerotier.com/synology/#set-up-container">https://docs.zerotier.com/synology/#set-up-container</a><br>  iptables è§„åˆ™è½¬è½½è‡ªï¼š<a href="https://jasonkayzk.github.io/2024/08/21/Zerotier%E9%85%8D%E7%BD%AE%E5%86%85%E7%BD%91%E6%B5%81%E9%87%8F%E8%BD%AC%E5%8F%91/">https://jasonkayzk.github.io/2024/08/21/Zerotier%E9%85%8D%E7%BD%AE%E5%86%85%E7%BD%91%E6%B5%81%E9%87%8F%E8%BD%AC%E5%8F%91/</a></p></blockquote>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;å®Œæˆè¿™ä¸ªæ•™ç¨‹ï¼Œä½ ä¸»è¦éœ€è¦å®Œæˆä»¥ä¸‹æµç¨‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨ NAS ä¸Šå¯ç”¨ SSH&lt;/li&gt;
&lt;li&gt;åˆ›å»ºä¸€ä¸ªæŒä¹…çš„ TUN&lt;/li&gt;
&lt;li&gt;å®‰è£… Docker&lt;/li&gt;
&lt;li&gt;è®¾ç½® Docker&lt;/li&gt;
&lt;/ul&gt;
&lt;h2</summary>
        
      
    
    
    
    <category term="å·¥å…·" scheme="https://zahui.fan/categories/%E5%B7%A5%E5%85%B7/"/>
    
    
    <category term="ç½‘ç»œ" scheme="https://zahui.fan/tags/%E7%BD%91%E7%BB%9C/"/>
    
    <category term="nas" scheme="https://zahui.fan/tags/nas/"/>
    
  </entry>
  
  <entry>
    <title>ç®¡ç†Rediså†…å­˜å ç”¨</title>
    <link href="https://zahui.fan/posts/spcjoj/"/>
    <id>https://zahui.fan/posts/spcjoj/</id>
    <published>2024-12-31T07:04:50.000Z</published>
    <updated>2025-01-05T03:38:30.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ·˜æ±°ç­–ç•¥"><a href="#æ·˜æ±°ç­–ç•¥" class="headerlink" title="æ·˜æ±°ç­–ç•¥"></a>æ·˜æ±°ç­–ç•¥</h2><p>å¦‚æœè®¾ç½®äº†åˆé€‚çš„æ·˜æ±°ç­–ç•¥ï¼ŒRedis ä¼šæ ¹æ®ä»¥ä¸‹å‡ ç§ç­–ç•¥é€‰æ‹©æ€§åœ°ç§»é™¤æŸäº›é”®ï¼Œè…¾å‡ºå†…å­˜ç©ºé—´ï¼ˆæ·˜æ±°ç­–ç•¥éœ€è¦å’Œå†…å­˜é™åˆ¶é…åˆä½¿ç”¨ï¼‰</p><p>å¸¸ç”¨æ·˜æ±°ç­–ç•¥è¯´æ˜</p><table><thead><tr><th>ç­–ç•¥</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>volatile-lru</td><td>ä»è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ä¸­ï¼Œç§»é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼ˆLRUï¼‰çš„é”®ã€‚</td></tr><tr><td>allkeys-lru</td><td>ä»æ‰€æœ‰é”®ä¸­ï¼Œç§»é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼ˆLRUï¼‰çš„é”®ã€‚</td></tr><tr><td>volatile-random</td><td>ä»è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ä¸­ï¼Œéšæœºç§»é™¤é”®ã€‚</td></tr><tr><td>allkeys-random</td><td>ä»æ‰€æœ‰é”®ä¸­ï¼Œéšæœºç§»é™¤é”®ã€‚</td></tr><tr><td>volatile-ttl</td><td>ä»è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ä¸­ï¼Œç§»é™¤å³å°†è¿‡æœŸçš„é”®ï¼ˆä¼˜å…ˆç§»é™¤ TTL çŸ­çš„é”®ï¼‰ã€‚</td></tr><tr><td>noeviction</td><td>å½“å†…å­˜è¶…è¿‡é™åˆ¶æ—¶ï¼Œç›´æ¥è¿”å›é”™è¯¯ï¼Œä¸å†æ‰§è¡Œæ–°å¢æ“ä½œï¼ˆè¿™æ˜¯é»˜è®¤ç­–ç•¥ï¼‰ã€‚</td></tr></tbody></table><p>è®¾ç½®æ–¹æ³•ï¼š åœ¨ redis.conf æ–‡ä»¶ä¸­æ·»åŠ æˆ–ä¿®æ”¹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">maxmemory-policy allkeys-lru</span><br></pre></td></tr></table></figure><p>æˆ–é€šè¿‡å‘½ä»¤è¡ŒåŠ¨æ€è®¾ç½®ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli config <span class="built_in">set</span> maxmemory-policy allkeys-lru</span><br></pre></td></tr></table></figure><h2 id="å†…å­˜é™åˆ¶"><a href="#å†…å­˜é™åˆ¶" class="headerlink" title="å†…å­˜é™åˆ¶"></a>å†…å­˜é™åˆ¶</h2><p>è®¾ç½® maxmemory</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">maxmemory 4gb</span><br><span class="line"># maxmemory 4G</span><br><span class="line"># maxmemory 4294967296</span><br></pre></td></tr></table></figure><p>é€šè¿‡å‘½ä»¤è¡ŒåŠ¨æ€è®¾ç½®ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli config <span class="built_in">set</span> maxmemory 4294967296</span><br></pre></td></tr></table></figure><h2 id="æŒä¹…åŒ–è®¾ç½®"><a href="#æŒä¹…åŒ–è®¾ç½®" class="headerlink" title="æŒä¹…åŒ–è®¾ç½®"></a>æŒä¹…åŒ–è®¾ç½®</h2><p>å¦‚æœç¼“å­˜æ•°æ®å¯ä¸¢å¤±ï¼Œå¯ä»¥ç¦ç”¨æŒä¹…åŒ–ï¼ˆRDB å’Œ AOFï¼‰ä»¥å‡å°‘ç£ç›˜ IO å¼€é”€ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">save <span class="string">&quot;&quot;</span></span><br><span class="line">appendonly no</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h2 id=&quot;æ·˜æ±°ç­–ç•¥&quot;&gt;&lt;a href=&quot;#æ·˜æ±°ç­–ç•¥&quot; class=&quot;headerlink&quot; title=&quot;æ·˜æ±°ç­–ç•¥&quot;&gt;&lt;/a&gt;æ·˜æ±°ç­–ç•¥&lt;/h2&gt;&lt;p&gt;å¦‚æœè®¾ç½®äº†åˆé€‚çš„æ·˜æ±°ç­–ç•¥ï¼ŒRedis</summary>
        
      
    
    
    
    <category term="æ•°æ®åº“" scheme="https://zahui.fan/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
    <category term="redis" scheme="https://zahui.fan/tags/redis/"/>
    
    <category term="æ€§èƒ½ä¼˜åŒ–" scheme="https://zahui.fan/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨Pythonè¯†åˆ«éªŒè¯ç  Muggle OCR</title>
    <link href="https://zahui.fan/posts/sp3b30/"/>
    <id>https://zahui.fan/posts/sp3b30/</id>
    <published>2024-12-26T07:20:59.000Z</published>
    <updated>2025-02-22T09:48:29.000Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘å‘ç°ä¸ª ddddocrï¼Œè¯†åˆ«ç‡å¾ˆé«˜ï¼Œè¯†åˆ«é€Ÿåº¦è¿˜å¾ˆå¿«ï¼š<a href="/posts/ss2wk6/">ä½¿ç”¨Pythonè¯†åˆ«éªŒè¯ç  ddddocr</a></p><div class="note flat"><p>ä»¥å‰ç”¨è¿‡ä»€ä¹ˆ pytesseract è¯†åˆ«æ•ˆæœå¾ˆå·®ï¼Œè¿˜éœ€è¦ç”µè„‘ä¸Šå®‰è£… <code>Tesseract OCR</code> çš„è½¯ä»¶ï¼Œä½†æ˜¯ä½¿ç”¨ä¸‹æ¥ï¼Œæ•ˆæœä¸å¥½ï¼Œåé¢ä¹Ÿç”¨è¿‡ <code>PaddleOCR</code> å¯ä»¥è¯†åˆ«ï¼Œä½†æ˜¯è¯†åˆ«é€Ÿåº¦æ¯”è¾ƒæ…¢ï¼ŒæˆåŠŸç‡ä¹Ÿä¸é«˜ã€‚åé¢åˆçœ‹åˆ°äº†è¿™ä¸ªå¼€æºå·¥å…·ï¼Œå¹ç‰›é€¼æ¯”è¾ƒå‰å®³ï¼Œå·ç§°è‡ªå·±æ˜¯éªŒè¯ç è¯†åˆ«çš„æœ€é«˜å¢ƒç•Œï¼Œå°±è¯•è¯•çœ‹ã€‚å®˜æ–¹çš„ GitHub åœ°å€æ˜¯ï¼š<a href="https://github.com/litongjava/muggle_ocr">https://github.com/litongjava/muggle_ocr</a></p></div><h2 id="æ•ˆæœå±•ç¤º"><a href="#æ•ˆæœå±•ç¤º" class="headerlink" title="æ•ˆæœå±•ç¤º"></a>æ•ˆæœå±•ç¤º</h2><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/20241226175928967.gif" alt="20241226175928967.gif|728"></p><h2 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h2><p>OSï¼š Windows 11<br>Pythonï¼š python-3.10.10-amd64</p><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>è¿™ä¸ªå¼€æºç¨‹åºåœ¨ pypi ä»“åº“ä¸Šè¢«ç§»é™¤äº†ï¼Œéœ€è¦åœ¨ GitHub ä¸Šå°†æºç åŒ…ä¸‹è½½ä¸‹æ¥å®‰è£…ã€‚</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/20241226152841716.png" alt="image.png|595"></p><p>ä¸‹è½½åˆ°æœ¬åœ°ï¼Œè§£å‹åï¼Œæ‰“å¼€ cmd å‘½ä»¤æç¤ºç¬¦ï¼Œ</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">REM åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ</span></span><br><span class="line">python -m venv venv</span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">REM å®‰è£…muggle_ocr</span></span><br><span class="line"><span class="built_in">cd</span> muggle_ocr-main</span><br><span class="line">python setup.py install</span><br></pre></td></tr></table></figure><h3 id="æŠ¥é”™å¤„ç†"><a href="#æŠ¥é”™å¤„ç†" class="headerlink" title="æŠ¥é”™å¤„ç†"></a>æŠ¥é”™å¤„ç†</h3><p><code>error: numpy 2.2.1 is installed but numpy&lt;2.1.0,&gt;=1.26.0 is required by &#123;&#39;tensorflow-intel&#39;&#125;</code></p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">REM ç”¨è¿™æ¡å‘½ä»¤æŸ¥ä¸€ä¸‹å¯ç”¨çš„ç‰ˆæœ¬</span></span><br><span class="line">pip index versions numpy</span><br><span class="line"></span><br><span class="line">pip install numpy==<span class="number">2</span>.<span class="number">0</span>.<span class="number">2</span></span><br></pre></td></tr></table></figure><p>ç„¶åå†é‡æ–°å®‰è£… muggle_ocr</p><h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><p>è¯†åˆ«éªŒè¯ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> os </span><br><span class="line"><span class="keyword">import</span> muggle_ocr</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">ä½¿ç”¨é¢„ç½®æ¨¡å‹ï¼Œé¢„ç½®æ¨¡å‹åŒ…å«äº†[ModelType.OCR, ModelType.Captcha] ä¸¤ç§</span></span><br><span class="line"><span class="string">å…¶ä¸­ ModelType.OCR ç”¨äºè¯†åˆ«æ™®é€šå°åˆ·æ–‡æœ¬, ModelType.Captcha ç”¨äºè¯†åˆ«4-6ä½ç®€å•è‹±æ•°éªŒè¯ç </span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰“å¼€éªŒè¯ç å›¾ç‰‡</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">r&quot;1.png&quot;</span>, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    captcha_bytes = f.read()</span><br><span class="line"></span><br><span class="line"><span class="comment"># ModelType.Captcha å¯è¯†åˆ«4-6ä½éªŒè¯ç </span></span><br><span class="line">sdk = muggle_ocr.SDK(model_type=muggle_ocr.ModelType.Captcha)</span><br><span class="line"><span class="comment"># 3. è°ƒç”¨é¢„æµ‹å‡½æ•°</span></span><br><span class="line">text = sdk.predict(image_bytes=captcha_bytes)</span><br><span class="line"><span class="built_in">print</span>(text)</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;p&gt;æœ€è¿‘å‘ç°ä¸ª ddddocrï¼Œè¯†åˆ«ç‡å¾ˆé«˜ï¼Œè¯†åˆ«é€Ÿåº¦è¿˜å¾ˆå¿«ï¼š&lt;a href=&quot;/posts/ss2wk6/&quot;&gt;ä½¿ç”¨Pythonè¯†åˆ«éªŒè¯ç  ddddocr&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;note flat&quot;&gt;&lt;p&gt;ä»¥å‰ç”¨è¿‡ä»€ä¹ˆ pytesseract è¯†åˆ«æ•ˆæœå¾ˆå·®ï¼Œè¿˜éœ€è¦ç”µè„‘ä¸Šå®‰è£… &lt;code&gt;Tesseract OCR&lt;/code&gt; çš„è½¯ä»¶ï¼Œä½†æ˜¯ä½¿ç”¨ä¸‹æ¥ï¼Œæ•ˆæœä¸å¥½ï¼Œåé¢ä¹Ÿç”¨è¿‡</summary>
        
      
    
    
    
    <category term="å¼€å‘" scheme="https://zahui.fan/categories/%E5%BC%80%E5%8F%91/"/>
    
    
    <category term="Python" scheme="https://zahui.fan/tags/Python/"/>
    
    <category term="OCR" scheme="https://zahui.fan/tags/OCR/"/>
    
  </entry>
  
  <entry>
    <title>nginxåå‘ä»£ç†çš„context path</title>
    <link href="https://zahui.fan/posts/sootea/"/>
    <id>https://zahui.fan/posts/sootea/</id>
    <published>2024-12-18T11:32:33.000Z</published>
    <updated>2025-02-19T09:46:45.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="è¿”å›è¯·æ±‚-uri"><a href="#è¿”å›è¯·æ±‚-uri" class="headerlink" title="è¿”å›è¯·æ±‚ uri"></a>è¿”å›è¯·æ±‚ uri</h2><p>åœ¨ Nginx ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ <code>$request_uri</code> æ¥è¡¨ç¤ºè¯·æ±‚ uri, é…ç½®å¦‚ä¸‹ï¼›</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name example.com;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        add_header Content-Type text/html;</span><br><span class="line">        return 200 &quot;$request_uri\n&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå†ä½¿ç”¨å¦ä¸€å° nginx åå‘ä»£ç†åˆ°è¿™å° nginx å°±å¯ä»¥æµ‹è¯•è¯·æ±‚çš„ uri äº†ã€‚</p><h2 id="æµ‹è¯•-nginx-çš„åå‘ä»£ç†-content-path"><a href="#æµ‹è¯•-nginx-çš„åå‘ä»£ç†-content-path" class="headerlink" title="æµ‹è¯• nginx çš„åå‘ä»£ç† content path"></a>æµ‹è¯• nginx çš„åå‘ä»£ç† content path</h2><h3 id="1"><a href="#1" class="headerlink" title="1"></a>1</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">   proxy_pass http://192.168.200.12;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æœæ˜¯</p><p><code>curl localhost/aa/bb/</code> â€“&gt; <code>http://192.168.200.12/aa/bb/</code></p><h3 id="2"><a href="#2" class="headerlink" title="2"></a>2</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location /aa &#123;</span><br><span class="line">   proxy_pass http://192.168.200.12;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æœå’Œä¸Šé¢ä¸€æ ·ï¼Œä½†æ˜¯åªæœ‰ &#x2F;aa å¼€å¤´çš„æ‰èƒ½è½¬å‘åˆ°è¿™é‡Œ</p><h3 id="3"><a href="#3" class="headerlink" title="3"></a>3</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location /aa/ &#123;</span><br><span class="line">   proxy_pass http://192.168.200.12;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æœå’Œä¸Šé¢ä¸€æ ·ï¼Œä½†æ˜¯åªæœ‰ &#x2F;aa&#x2F; å¼€å¤´çš„æ‰èƒ½è½¬å‘åˆ°è¿™é‡Œ</p><h3 id="4"><a href="#4" class="headerlink" title="4"></a>4</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location /aa &#123;</span><br><span class="line">   proxy_pass http://192.168.200.12/;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æœæ˜¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@master1 nginx]<span class="comment"># curl localhost/aa/bb/cc</span></span><br><span class="line">//bb/cc</span><br></pre></td></tr></table></figure><h3 id="5"><a href="#5" class="headerlink" title="5"></a>5</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location /aa &#123;</span><br><span class="line">   proxy_pass http://192.168.200.12/x/y/z;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æœæ˜¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@master1 nginx]<span class="comment"># curl localhost/aa</span></span><br><span class="line">/x/y/z</span><br></pre></td></tr></table></figure><h2 id="nginx-çš„-alias"><a href="#nginx-çš„-alias" class="headerlink" title="nginx çš„ alias"></a>nginx çš„ alias</h2><p>Nginx çš„ alias æŒ‡ä»¤å¯ä»¥ç†è§£ä¸ºâ€œè·¯å¾„åˆ«åâ€ï¼Œå®ƒèƒ½æŠŠç”¨æˆ·è®¿é—®çš„ URL è·¯å¾„ç›´æ¥æ˜ å°„åˆ°æœåŠ¡å™¨ä¸Šçš„å¦ä¸€ä¸ªçœŸå®ç›®å½•ã€‚ä¸¾ä¸ªä¾‹å­ï¼š</p><p>å‡è®¾ä½ é…ç½®äº†ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location /images/ &#123;</span><br><span class="line">    alias /var/www/my_photos/;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ç”¨æˆ·è®¿é—® <code>http://ä½ çš„ç½‘ç«™/images/cat.jpg</code> æ—¶ï¼ŒNginx ä¼šç›´æ¥å»æœåŠ¡å™¨ä¸Šçš„ <code>/var/www/my_photos/cat.jpg</code> æ‰¾æ–‡ä»¶ï¼Œè€Œä¸ä¼šä¿ç•™ URL ä¸­çš„ <code>/images/</code> è·¯å¾„ã€‚</p><p>å’Œå¦ä¸€ä¸ªæŒ‡ä»¤ root çš„åŒºåˆ«åœ¨äºï¼š</p><p>ç”¨ root æ—¶ï¼Œè·¯å¾„æ˜¯è¿½åŠ ï¼ˆæ¯”å¦‚ location &#x2F;a&#x2F; { root &#x2F;b; }ï¼Œè®¿é—® <code>/a/1.jpg</code> ä¼šæ‰¾ <code>/b/a/1.jpg</code>ï¼‰<br>ç”¨ alias æ—¶ï¼Œè·¯å¾„æ˜¯æ›¿æ¢ï¼ˆåŒæ ·é…ç½®ä¸‹ï¼Œè®¿é—® <code>/a/1.jpg</code> ä¼šç›´æ¥æ‰¾ <code>/b/1.jpg</code>ï¼‰<br>éœ€è¦æ³¨æ„ï¼šé…ç½®æ—¶è·¯å¾„æœ«å°¾çš„ <code>/</code> è¦ç»Ÿä¸€ï¼Œæ¯”å¦‚ <code>location /images/</code> å’Œ <code>alias /var/www/my_photos/</code> éƒ½è¦å¸¦æ–œæ ï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´è·¯å¾„é”™è¯¯</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h2 id=&quot;è¿”å›è¯·æ±‚-uri&quot;&gt;&lt;a href=&quot;#è¿”å›è¯·æ±‚-uri&quot; class=&quot;headerlink&quot; title=&quot;è¿”å›è¯·æ±‚ uri&quot;&gt;&lt;/a&gt;è¿”å›è¯·æ±‚ uri&lt;/h2&gt;&lt;p&gt;åœ¨ Nginx ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ &lt;code&gt;$request_uri&lt;/code&gt; æ¥è¡¨ç¤ºè¯·æ±‚ uri, é…ç½®å¦‚ä¸‹ï¼›&lt;/p&gt;
&lt;figure class=&quot;highlight</summary>
        
      
    
    
    
    <category term="åŸºç¡€è¿ç»´" scheme="https://zahui.fan/categories/%E5%9F%BA%E7%A1%80%E8%BF%90%E7%BB%B4/"/>
    
    
    <category term="Nginx" scheme="https://zahui.fan/tags/Nginx/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨kubeadméƒ¨ç½²ä¸€å¥—é«˜å¯ç”¨k8s 1.32é›†ç¾¤ for AlmaLinux9(RHEL9)</title>
    <link href="https://zahui.fan/posts/sof9i3/"/>
    <id>https://zahui.fan/posts/sof9i3/</id>
    <published>2024-12-13T07:44:27.000Z</published>
    <updated>2025-01-08T10:08:52.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>åŸºäº AlmaLinux9 ä½¿ç”¨ kubeadm æ­å»ºé›†ç¾¤ï¼Œ <a href="/posts/526ffc9a/">ubuntuéƒ¨ç½²æ–‡æ¡£</a>, æœ‰ç–‘é—®çš„åœ°æ–¹å¯ä»¥çœ‹ <a href="https://kubernetes.io/zh/docs/setup/production-environment/tools/kubeadm/">å®˜æ–¹æ–‡æ¡£</a>, æœ¬æ•™ç¨‹éœ€è¦èƒ½è®¿é—® <strong>å›½é™…äº’è”ç½‘</strong> ã€‚ä¸èƒ½çš„è¯ï¼Œéœ€è¦è§£å†³é•œåƒæ‹‰å–é—®é¢˜ã€yum å®‰è£…ç»„ä»¶çš„é—®é¢˜ã€‚</p></blockquote><h2 id="å‡†å¤‡æœºå™¨"><a href="#å‡†å¤‡æœºå™¨" class="headerlink" title="å‡†å¤‡æœºå™¨"></a>å‡†å¤‡æœºå™¨</h2><blockquote><p>æˆ‘çš„æœºå™¨è¯¦æƒ…å¦‚ä¸‹, é…ç½®è‡³å°‘ä¸º 4C4G</p></blockquote><table><thead><tr><th>hostname</th><th>IP</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>master1</td><td>10.0.0.11</td><td>k8s master èŠ‚ç‚¹</td></tr><tr><td>master2</td><td>10.0.0.12</td><td>k8s master èŠ‚ç‚¹</td></tr><tr><td>master3</td><td>10.0.0.13</td><td>k8s master èŠ‚ç‚¹</td></tr><tr><td>worker1</td><td>10.0.0.21</td><td>k8s worker èŠ‚ç‚¹</td></tr><tr><td>worker2</td><td>10.0.0.22</td><td>k8s worker èŠ‚ç‚¹</td></tr></tbody></table><p>æ¯å°æœºå™¨éƒ½åšåŸŸåè§£æï¼Œæˆ–è€…ç»‘å®š hostsï¼ˆç›´æ¥ä½¿ç”¨ ip åœ°å€ä¼šæœ‰è­¦å‘Šï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/hosts</span><br><span class="line"></span><br><span class="line">10.0.0.11 master1</span><br><span class="line">10.0.0.12 master2</span><br><span class="line">10.0.0.13 master3</span><br></pre></td></tr></table></figure><p>æ¯å°æœºå™¨éƒ½å…³é—­é˜²ç«å¢™å’Œ SELinux</p><blockquote><p>è´Ÿè½½å‡è¡¡æœºå™¨å¿…é¡»è¦å…³é—­,å› ä¸º 6443 ä¸æ˜¯ nginx çš„æ ‡å‡†ç«¯å£,ä¼šè¢« selinux æ‹¦æˆª, é˜²ç«å¢™ä¹Ÿéœ€è¦æ”¾è¡Œ 6443 ç«¯å£, å¯ä»¥è€ƒè™‘ç›´æ¥å…³é—­é˜²ç«å¢™</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl <span class="built_in">disable</span> --now firewalld</span><br><span class="line">setenforce 0</span><br><span class="line">sed -i <span class="string">&quot;s/^SELINUX=.*/SELINUX=disabled/g&quot;</span> /etc/selinux/config</span><br><span class="line"></span><br><span class="line"><span class="comment"># RHEL9ç³»åˆ—å®Œå…¨å…³é—­selinuxéœ€è¦ä¿®æ”¹å†…æ ¸å¯åŠ¨å‚æ•°ï¼Œ/etc/selinux/config æ–‡ä»¶é‡Œé¢æœ‰è¯´æ˜</span></span><br></pre></td></tr></table></figure><h2 id="åŸºç¡€ç¯å¢ƒé…ç½®"><a href="#åŸºç¡€ç¯å¢ƒé…ç½®" class="headerlink" title="åŸºç¡€ç¯å¢ƒé…ç½®"></a>åŸºç¡€ç¯å¢ƒé…ç½®</h2><blockquote><p>åŸºç¡€ç¯å¢ƒæ˜¯ä¸ç®¡ master è¿˜æ˜¯ worker éƒ½éœ€è¦çš„ç¯å¢ƒ</p></blockquote><ol><li>ç¦ç”¨ swap</li><li>ç¡®ä¿æ¯ä¸ªèŠ‚ç‚¹ä¸Š MAC åœ°å€å’Œ product_uuid çš„å”¯ä¸€æ€§ <code>sudo cat /sys/class/dmi/id/product_uuid</code></li><li>ä¿®æ”¹ hostname</li></ol><h3 id="å®‰è£…-runtime"><a href="#å®‰è£…-runtime" class="headerlink" title="å®‰è£… runtime"></a>å®‰è£… runtime</h3><h4 id="è®¾ç½®å†…æ ¸å‚æ•°"><a href="#è®¾ç½®å†…æ ¸å‚æ•°" class="headerlink" title="è®¾ç½®å†…æ ¸å‚æ•°"></a>è®¾ç½®å†…æ ¸å‚æ•°</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®¾ç½®å¿…éœ€çš„ sysctl å‚æ•°ï¼Œè¿™äº›å‚æ•°åœ¨é‡æ–°å¯åŠ¨åä»ç„¶å­˜åœ¨ã€‚</span></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF | sudo tee /etc/sysctl.d/99-kubernetes-cri.conf</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-iptables  = 1</span></span><br><span class="line"><span class="string">net.ipv4.ip_forward                 = 1</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-ip6tables = 1</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åº”ç”¨ sysctl å‚æ•°è€Œæ— éœ€é‡æ–°å¯åŠ¨</span></span><br><span class="line">sudo sysctl --system</span><br></pre></td></tr></table></figure><h4 id="å¯ç”¨å†…æ ¸æ¨¡å—"><a href="#å¯ç”¨å†…æ ¸æ¨¡å—" class="headerlink" title="å¯ç”¨å†…æ ¸æ¨¡å—"></a>å¯ç”¨å†…æ ¸æ¨¡å—</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF | sudo tee /etc/modules-load.d/containerd.conf</span></span><br><span class="line"><span class="string">overlay</span></span><br><span class="line"><span class="string">br_netfilter</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">sudo modprobe overlay</span><br><span class="line">sudo modprobe br_netfilter</span><br></pre></td></tr></table></figure><h4 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¸è½½æ—§ç‰ˆæœ¬Docker</span></span><br><span class="line">sudo yum remove docker \</span><br><span class="line">              docker-client \</span><br><span class="line">              docker-client-latest \</span><br><span class="line">              docker-common \</span><br><span class="line">              docker-latest \</span><br><span class="line">              docker-latest-logrotate \</span><br><span class="line">              docker-logrotate \</span><br><span class="line">              docker-engine</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…dockerä»“åº“</span></span><br><span class="line">sudo yum install -y yum-utils</span><br><span class="line">sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…containerd</span></span><br><span class="line">sudo yum install containerd.io -y</span><br></pre></td></tr></table></figure><h4 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h4><p>ä» yum æºå®‰è£…çš„ containerd é»˜è®¤ç¦ç”¨äº† criï¼Œå¯ä»¥ä½¿ç”¨å‘½ä»¤é‡æ–°ç”Ÿæˆé»˜è®¤é…ç½®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è½¯ä»¶åŒ…ä¸­è‡ªå¸¦çš„é…ç½®æ–‡ä»¶ä¸å…¨ï¼Œä½¿ç”¨å‘½ä»¤ç”Ÿæˆã€‚</span></span><br><span class="line">containerd config default | sudo <span class="built_in">tee</span> /etc/containerd/config.toml</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»“åˆ runc ä½¿ç”¨ systemd cgroup é©±åŠ¨ï¼Œåœ¨ `/etc/containerd/config.toml` ä¸­è®¾ç½®</span></span><br><span class="line">sed -i <span class="string">&#x27;s#SystemdCgroup = .*#SystemdCgroup = true#g&#x27;</span> /etc/containerd/config.toml</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹ pauseå®¹å™¨ é•œåƒï¼Œä¸èƒ½æ‹‰å–å®˜æ–¹é•œåƒçš„å¯ä»¥ä½¿ç”¨é˜¿é‡Œäº‘é•œåƒæº</span></span><br><span class="line"><span class="comment"># sed -i &#x27;s#sandbox_image = .*#sandbox_image = &quot;registry.aliyuncs.com/google_containers/pause:3.9&quot;#g&#x27; /etc/containerd/config.toml</span></span><br><span class="line">sed -i <span class="string">&#x27;s#sandbox_image = .*#sandbox_image = &quot;registry.k8s.io/pause:3.10&quot;#g&#x27;</span> /etc/containerd/config.toml</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®å¼€æœºè‡ªå¯åŠ¨</span></span><br><span class="line">sudo systemctl <span class="built_in">enable</span> containerd</span><br><span class="line">sudo systemctl restart containerd</span><br></pre></td></tr></table></figure><h4 id="crictl-é…ç½®"><a href="#crictl-é…ç½®" class="headerlink" title="crictl é…ç½®"></a>crictl é…ç½®</h4><p>ä¹‹å‰ä½¿ç”¨ docker çš„æ—¶å€™ï¼Œdocker ç»™æˆ‘ä»¬åšäº†å¾ˆå¤šå¥½ç”¨çš„å·¥å…·ï¼Œç°åœ¨ç”¨äº† containerdï¼Œç®¡ç†å®¹å™¨æˆ‘ä»¬ç”¨ cri ç®¡ç†å·¥å…· crictlï¼Œåˆ›å»ºé…ç½®æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; /etc/crictl.yaml &lt;&lt;-<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">runtime-endpoint: unix:///run/containerd/containerd.sock</span><br><span class="line">debug: <span class="literal">false</span></span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…-kubeadmã€kubelet-å’Œ-kubectl"><a href="#å®‰è£…-kubeadmã€kubelet-å’Œ-kubectl" class="headerlink" title="å®‰è£… kubeadmã€kubelet å’Œ kubectl"></a>å®‰è£… kubeadmã€kubelet å’Œ kubectl</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF | sudo tee /etc/yum.repos.d/kubernetes.repo</span></span><br><span class="line"><span class="string">[kubernetes]</span></span><br><span class="line"><span class="string">name=Kubernetes</span></span><br><span class="line"><span class="string">baseurl=https://pkgs.k8s.io/core:/stable:/v1.32/rpm/</span></span><br><span class="line"><span class="string">enabled=1</span></span><br><span class="line"><span class="string">gpgcheck=1</span></span><br><span class="line"><span class="string">gpgkey=https://pkgs.k8s.io/core:/stable:/v1.32/rpm/repodata/repomd.xml.key</span></span><br><span class="line"><span class="string">exclude=kubelet kubeadm kubectl cri-tools kubernetes-cni</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å¯ç”¨çš„ç‰ˆæœ¬</span></span><br><span class="line">yum list kubelet kubeadm kubectl --showduplicates --disableexcludes=kubernetes</span><br><span class="line"></span><br><span class="line">sudo yum install -y kubelet-1.32.0 kubeadm-1.32.0 kubectl-1.32.0 --disableexcludes=kubernetes</span><br><span class="line">sudo systemctl <span class="built_in">enable</span> --now kubelet</span><br></pre></td></tr></table></figure><h2 id="kube-apiserver-é«˜å¯ç”¨æ–¹æ¡ˆ"><a href="#kube-apiserver-é«˜å¯ç”¨æ–¹æ¡ˆ" class="headerlink" title="kube-apiserver é«˜å¯ç”¨æ–¹æ¡ˆ"></a>kube-apiserver é«˜å¯ç”¨æ–¹æ¡ˆ</h2><p>é«˜å¯ç”¨æ–¹æ¡ˆæœ‰å¾ˆå¤šç§ï¼Œå…¶ä»–æ–¹æ¡ˆè¯·å‚è€ƒ <a href="/posts/10cef768/">Kubernetesä¹‹masteré«˜å¯ç”¨æ–¹æ¡ˆ</a></p><p>è¿™é‡Œä½¿ç”¨<strong>æ¯å°</strong>èŠ‚ç‚¹éƒ¨ç½² nginx åä»£æ¥å®ç°é«˜å¯ç”¨ï¼Œè¿™ç§æ–¹å¼éœ€è¦<strong>æ‰€æœ‰</strong>èŠ‚ç‚¹éƒ½å®‰è£…è´Ÿè½½å‡è¡¡ (åŒ…æ‹¬ master å’Œ worker )</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /etc/kube-lb/&#123;conf,logs,sbin&#125;</span><br><span class="line"></span><br><span class="line">curl -L -C - https://file.babudiu.com/f/qjhX/kube-lb -o /etc/kube-lb/sbin/kube-lb</span><br><span class="line"><span class="built_in">chmod</span> +x /etc/kube-lb/sbin/kube-lb</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/kube-lb/conf/kube-lb.conf &lt;&lt;<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">user root;</span><br><span class="line">worker_processes 1;</span><br><span class="line"></span><br><span class="line">error_log  /etc/kube-lb/logs/error.log warn;</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  3000;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">stream &#123;</span><br><span class="line">    upstream backend &#123;</span><br><span class="line">        server 10.0.0.11:6443    max_fails=2 fail_timeout=3s;</span><br><span class="line">        server 10.0.0.12:6443    max_fails=2 fail_timeout=3s;</span><br><span class="line">        server 10.0.0.13:6443    max_fails=2 fail_timeout=3s;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen 127.0.0.1:8443;</span><br><span class="line">        proxy_connect_timeout 1s;</span><br><span class="line">        proxy_pass backend;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/systemd/system/kube-lb.service &lt;&lt;<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">[Unit]</span><br><span class="line">Description=l4 nginx proxy <span class="keyword">for</span> kube-apiservers</span><br><span class="line">After=network.target</span><br><span class="line">After=network-online.target</span><br><span class="line">Wants=network-online.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">ExecStartPre=/etc/kube-lb/sbin/kube-lb -c /etc/kube-lb/conf/kube-lb.conf -p /etc/kube-lb -t</span><br><span class="line">ExecStart=/etc/kube-lb/sbin/kube-lb -c /etc/kube-lb/conf/kube-lb.conf -p /etc/kube-lb</span><br><span class="line">ExecReload=/etc/kube-lb/sbin/kube-lb -c /etc/kube-lb/conf/kube-lb.conf -p /etc/kube-lb -s reload</span><br><span class="line">PrivateTmp=<span class="literal">true</span></span><br><span class="line">Restart=always</span><br><span class="line">RestartSec=15</span><br><span class="line">StartLimitInterval=0</span><br><span class="line">LimitNOFILE=65536</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨æœåŠ¡</span></span><br><span class="line">systemctl <span class="built_in">enable</span> --now kube-lb</span><br></pre></td></tr></table></figure><div class="note default flat"><p>kube-lb å…¶å®å°±æ˜¯è‡ªå·±ç¼–è¯‘çš„ Nginxï¼Œç²¾ç®€äº† http æ¨¡å—ï¼Œåªå¼€å¯äº† stream æ¨¡å—ç”¨ä½œ 4 å±‚è½¬å‘ï¼Œè¯¦ç»†å‚æ•°å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nginx version: nginx/1.24.0</span><br><span class="line">built by gcc 4.8.5 20150623 (Red Hat 4.8.5-44) (GCC)</span><br><span class="line">configure arguments: --with-stream --without-http --without-http_uwsgi_module --without-http_scgi_module --without-http_fastcgi_module</span><br></pre></td></tr></table></figure></div><h2 id="åˆ›å»ºé›†ç¾¤"><a href="#åˆ›å»ºé›†ç¾¤" class="headerlink" title="åˆ›å»ºé›†ç¾¤"></a>åˆ›å»ºé›†ç¾¤</h2><h3 id="æå‰æ‹‰é•œåƒï¼ˆå¯é€‰ï¼‰"><a href="#æå‰æ‹‰é•œåƒï¼ˆå¯é€‰ï¼‰" class="headerlink" title="æå‰æ‹‰é•œåƒï¼ˆå¯é€‰ï¼‰"></a>æå‰æ‹‰é•œåƒï¼ˆå¯é€‰ï¼‰</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubeadm config images pull \</span><br><span class="line">--kubernetes-version 1.32.0 \</span><br><span class="line">--image-repository registry.aliyuncs.com/google_containers</span><br></pre></td></tr></table></figure><h3 id="kubeadm-init"><a href="#kubeadm-init" class="headerlink" title="kubeadm init"></a>kubeadm init</h3><p>åœ¨ master1 ä¸Šæ‰§è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo kubeadm init \</span><br><span class="line">--control-plane-endpoint <span class="string">&quot;127.0.0.1:8443&quot;</span> \</span><br><span class="line">--kubernetes-version 1.32.0 \</span><br><span class="line">--upload-certs \</span><br><span class="line">--service-cidr=10.96.0.0/12 \</span><br><span class="line">--pod-network-cidr=10.244.0.0/16</span><br></pre></td></tr></table></figure><ul><li>ä¹Ÿå¯ä»¥ç”¨ <code>kubeadm config print init-defaults &gt; init.yaml</code> ç”Ÿæˆ kubeadm çš„é…ç½®ï¼Œå¹¶ç”¨ <code>kubeadm init --config=init.yaml</code> æ¥åˆ›å»ºé›†ç¾¤ã€‚</li><li>å¦‚æœä¸èƒ½æ‹‰å®˜æ–¹é•œåƒï¼Œå¢åŠ å‚æ•°ä½¿ç”¨é˜¿é‡Œäº‘é•œåƒæº <code>--image-repository registry.aliyuncs.com/google_containers</code></li></ul><h3 id="å®‰è£…ç½‘ç»œæ’ä»¶"><a href="#å®‰è£…ç½‘ç»œæ’ä»¶" class="headerlink" title="å®‰è£…ç½‘ç»œæ’ä»¶"></a>å®‰è£…ç½‘ç»œæ’ä»¶</h3><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">å®‰è£…flannelæ’ä»¶</button><button type="button" class="tab">å®‰è£…calicoæ’ä»¶</button></div><div class="tab-contents"><div class="tab-item-content active"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¦‚æœä¿®æ”¹äº† pod-network-cidr è¿™ä¸ªymlæ–‡ä»¶ä¹Ÿéœ€è¦ä¿®æ”¹</span></span><br><span class="line">kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å¾…è¡¥å……</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div><h2 id="å¸¸è§é—®é¢˜"><a href="#å¸¸è§é—®é¢˜" class="headerlink" title="å¸¸è§é—®é¢˜"></a>å¸¸è§é—®é¢˜</h2><p><a href="/posts/sepu3k/">kubeadm éƒ¨ç½²çš„é›†ç¾¤ å¸¸è§é—®é¢˜æ±‡æ€»</a></p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;åŸºäº AlmaLinux9 ä½¿ç”¨ kubeadm æ­å»ºé›†ç¾¤ï¼Œ &lt;a href=&quot;/posts/526ffc9a/&quot;&gt;ubuntuéƒ¨ç½²æ–‡æ¡£&lt;/a&gt;, æœ‰ç–‘é—®çš„åœ°æ–¹å¯ä»¥çœ‹ &lt;a href=&quot;https://kubernetes.io/zh/docs/setup/production-environment/tools/kubeadm/&quot;&gt;å®˜æ–¹æ–‡æ¡£&lt;/a&gt;,</summary>
        
      
    
    
    
    <category term="å®¹å™¨" scheme="https://zahui.fan/categories/%E5%AE%B9%E5%99%A8/"/>
    
    
  </entry>
  
  <entry>
    <title>Grafanaè¡¨æ ¼ç»˜åˆ¶</title>
    <link href="https://zahui.fan/posts/so9bdi/"/>
    <id>https://zahui.fan/posts/so9bdi/</id>
    <published>2024-12-10T02:39:17.000Z</published>
    <updated>2024-12-23T08:45:49.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="é€‰æ‹©ä¸€ä¸ªå…³è”æ ‡ç­¾"><a href="#é€‰æ‹©ä¸€ä¸ªå…³è”æ ‡ç­¾" class="headerlink" title="é€‰æ‹©ä¸€ä¸ªå…³è”æ ‡ç­¾"></a>é€‰æ‹©ä¸€ä¸ªå…³è”æ ‡ç­¾</h2><p><code>instance</code> æ˜¯æœºå™¨ ipï¼Œä¸ä¼šé‡å¤ï¼Œæ‰€ä»¥æˆ‘ç”¨è¿™ä¸ªåšå…³è”å­—æ®µã€‚<br>ç¬¬ä¸€ä¸ªæŸ¥è¯¢æˆ‘ä¼šä¿ç•™å¤šä¸€äº›æ ‡ç­¾ï¼Œï¼ˆå¯ä»¥ä½¿ç”¨ <code>sum by ... (instance)</code> ä¿ç•™æƒ³è¦çš„æ ‡ç­¾ï¼‰å…¶ä»–çš„æŸ¥è¯¢å°½é‡åªä¿ç•™å…³è”å­—æ®µã€‚</p><p>é»˜è®¤é…ç½®äº†å¤šä¸ªæŸ¥è¯¢ï¼Œå¹¶å°† Grafana å›¾è¡¨ç±»å‹è®¾ç½®æˆ table åï¼Œå†å°†æŸ¥è¯¢çš„æ ¼å¼è®¾ç½®æˆ Tableï¼Œæ˜¾ç¤ºå¦‚ä¸‹ï¼Œæœ‰ä»¥ä¸‹å‡ ä¸ªé—®é¢˜ï¼š</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/20241210104651576.png" alt="image.png|918"></p><h2 id="æ•´åˆå¤šä¸ªæŸ¥è¯¢åœ¨ä¸€å¼ è¡¨é‡Œé¢"><a href="#æ•´åˆå¤šä¸ªæŸ¥è¯¢åœ¨ä¸€å¼ è¡¨é‡Œé¢" class="headerlink" title="æ•´åˆå¤šä¸ªæŸ¥è¯¢åœ¨ä¸€å¼ è¡¨é‡Œé¢"></a>æ•´åˆå¤šä¸ªæŸ¥è¯¢åœ¨ä¸€å¼ è¡¨é‡Œé¢</h2><p>ç°åœ¨æ˜¾ç¤ºçš„æ˜¯ 3 ä¸ªæŸ¥è¯¢ï¼Œé€šè¿‡ä¸€ä¸ªé€‰æ¡†æ¥åˆ‡æ¢çš„ï¼Œæˆ‘ä»¬æƒ³è¦è®©è¿™ 3 ä¸ªæŸ¥è¯¢æ˜¾ç¤ºåœ¨ä¸€ä¸ªæ¡†ä¸­ï¼Œå¯ä»¥åœ¨ Grafana çš„ <code>Transform data</code> ä¸­å¢åŠ ä¸€ä¸ª <code>Join by field</code>ï¼Œ æˆ‘è¿™é‡Œä»¥ instance è¿™ä¸ªå­—æ®µåšå…³è”ï¼Œä¹Ÿå°±æ˜¯è¯´åŒæ ·çš„ instance è®¤ä¸ºæ˜¯ä¸€æ¡æ•°æ®ã€‚å¯ä»¥çœ‹åˆ°å±•ç¤ºå‡ºæ¥åªæœ‰ä¸€æ¡æ•°æ®äº†ï¼Œå¹¶ä¸”é€‰æ¡†æ²¡æœ‰äº†ã€‚<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/20241210104917046.png" alt="image.png|970"></p><h2 id="ç§»é™¤ä¸æƒ³å±•ç¤ºçš„å­—æ®µ"><a href="#ç§»é™¤ä¸æƒ³å±•ç¤ºçš„å­—æ®µ" class="headerlink" title="ç§»é™¤ä¸æƒ³å±•ç¤ºçš„å­—æ®µ"></a>ç§»é™¤ä¸æƒ³å±•ç¤ºçš„å­—æ®µ</h2><p>ä¸Šé¢å¯ä»¥çœ‹åˆ°æ•°æ®å·²ç»è¢«å…³è”æˆäº†ä¸€æ¡ï¼Œä½†æ˜¯æœ‰å¾ˆå¤šä¸æƒ³æ˜¾ç¤ºçš„å­—æ®µï¼Œåœ¨ <code>Transform data</code> ä¸­å¢åŠ ä¸€ä¸ª <code>Organize fields by name</code>ï¼Œç»è¿‡è°ƒæ•´å</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/20241210105622474.png" alt="image.png|937"></p><h2 id="ä¿®æ”¹å­—æ®µå•ä½"><a href="#ä¿®æ”¹å­—æ®µå•ä½" class="headerlink" title="ä¿®æ”¹å­—æ®µå•ä½"></a>ä¿®æ”¹å­—æ®µå•ä½</h2><p>ä¸Šé¢çš„è¿è¡Œæ—¶é—´ï¼Œå•ä½æ˜¯ç§’ï¼Œéœ€è¦è°ƒæ•´ä¸€ä¸‹å•ä½ï¼Œåœ¨ Override ä¸­è°ƒæ•´ï¼š</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/20241210105842096.png" alt="image.png|1008"></p><h2 id="ç»™è¡¨æ ¼åˆ†é…é¢œè‰²"><a href="#ç»™è¡¨æ ¼åˆ†é…é¢œè‰²" class="headerlink" title="ç»™è¡¨æ ¼åˆ†é…é¢œè‰²"></a>ç»™è¡¨æ ¼åˆ†é…é¢œè‰²</h2><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/20241223164145064.png" alt="image.png|1051"></p><p>è¿™é‡Œçš„ unit å•ä½æ˜¯ percent 0-1 æ‰€ä»¥ä¸‹é¢çš„é˜ˆå€¼ä¹Ÿåº”è¯¥è®¾ç½®ä¸º 0-1 ä¹‹é—´ï¼Œæ¯”å¦‚è¶…è¿‡ 95% è®¾ç½®æˆçº¢è‰²ï¼Œè¶…è¿‡ 80% è®¾ç½®æˆé»„è‰²ã€‚</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h2 id=&quot;é€‰æ‹©ä¸€ä¸ªå…³è”æ ‡ç­¾&quot;&gt;&lt;a href=&quot;#é€‰æ‹©ä¸€ä¸ªå…³è”æ ‡ç­¾&quot; class=&quot;headerlink&quot; title=&quot;é€‰æ‹©ä¸€ä¸ªå…³è”æ ‡ç­¾&quot;&gt;&lt;/a&gt;é€‰æ‹©ä¸€ä¸ªå…³è”æ ‡ç­¾&lt;/h2&gt;&lt;p&gt;&lt;code&gt;instance&lt;/code&gt; æ˜¯æœºå™¨ ipï¼Œä¸ä¼šé‡å¤ï¼Œæ‰€ä»¥æˆ‘ç”¨è¿™ä¸ªåšå…³è”å­—æ®µã€‚&lt;br&gt;ç¬¬ä¸€ä¸ªæŸ¥è¯¢æˆ‘ä¼šä¿ç•™å¤šä¸€äº›æ ‡ç­¾ï¼Œï¼ˆå¯ä»¥ä½¿ç”¨ &lt;code&gt;sum by ... (instance)&lt;/code&gt;</summary>
        
      
    
    
    
    <category term="ç›‘æ§" scheme="https://zahui.fan/categories/%E7%9B%91%E6%8E%A7/"/>
    
    
    <category term="grafana" scheme="https://zahui.fan/tags/grafana/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨RedisShakeè¿›è¡ŒRedisè¿ç§»</title>
    <link href="https://zahui.fan/posts/lmojvw5l/"/>
    <id>https://zahui.fan/posts/lmojvw5l/</id>
    <published>2024-12-02T04:51:47.000Z</published>
    <updated>2024-12-31T03:52:34.000Z</updated>
    
    <content type="html"><![CDATA[<p>å¯¹äºè‡ªå»ºçš„ redis, æˆ‘ä»¬å¯ä»¥å°† rdb&#x2F;aof æ–‡ä»¶æ‹·è´åˆ°ç›®çš„ redis, å¯åŠ¨æ¢å¤, ä½†æ˜¯äº‘ redis æˆ–è€…æŸäº›ç‰¹æ®Šæƒ…å†µ, æ¯”å¦‚æ²¡æœ‰äº‘å¹³å°çš„æƒé™ç­‰ç­‰æƒ…å†µ, å¯ä»¥ä½¿ç”¨å·¥å…·æ¥è¿›è¡Œè¿ç§».</p><p>RedisShake æ˜¯é˜¿é‡Œäº‘ Tair å›¢é˜Ÿ ç§¯æç»´æŠ¤çš„ä¸€ä¸ªé¡¹ç›®ã€‚å®ƒçš„æ¼”å˜å¯ä»¥è¿½æº¯åˆ°å…¶åˆå§‹ç‰ˆæœ¬ï¼Œè¯¥ç‰ˆæœ¬æ˜¯ä» redis-port åˆ†æ”¯å‡ºæ¥çš„ã€‚å®˜æ–¹æ–‡æ¡£<a href="https://tair-opensource.github.io/RedisShake/zh/guide/introduction.html">https://tair-opensource.github.io/RedisShake/zh/guide/introduction.html</a></p><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/tair-opensource/RedisShake/releases/download/v4.0.0/redis-shake-linux-amd64.tar.gz</span><br><span class="line">tar xf redis-shake-linux-amd64.tar.gz</span><br></pre></td></tr></table></figure><h2 id="åŒæ­¥è¿ç§»"><a href="#åŒæ­¥è¿ç§»" class="headerlink" title="åŒæ­¥è¿ç§»"></a>åŒæ­¥è¿ç§»</h2><p>åˆ›å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶ <code>redis_sync.toml</code></p><figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[sync_reader]</span></span><br><span class="line"><span class="attr">cluster</span> = <span class="literal">false</span>            <span class="comment"># æ˜¯å¦ä¸ºé›†ç¾¤</span></span><br><span class="line"><span class="attr">address</span> = <span class="string">&quot;127.0.0.1:6379&quot;</span></span><br><span class="line"><span class="attr">username</span> = <span class="string">&quot;&quot;</span>              <span class="comment"># keep empty if not using ACL</span></span><br><span class="line"><span class="attr">password</span> = <span class="string">&quot;&quot;</span>              <span class="comment"># keep empty if no authentication is required</span></span><br><span class="line"><span class="attr">tls</span> = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="section">[redis_writer]</span></span><br><span class="line"><span class="attr">cluster</span> = <span class="literal">false</span></span><br><span class="line"><span class="attr">address</span> = <span class="string">&quot;127.0.0.1:6380&quot;</span></span><br><span class="line"><span class="attr">username</span> = <span class="string">&quot;&quot;</span>              <span class="comment"># keep empty if not using ACL</span></span><br><span class="line"><span class="attr">password</span> = <span class="string">&quot;&quot;</span>              <span class="comment"># keep empty if no authentication is required</span></span><br><span class="line"><span class="attr">tls</span> = <span class="literal">false</span></span><br></pre></td></tr></table></figure><p>æ‰§è¡Œè¿ç§»æ“ä½œ, å‘½ä»¤ä¼šåœ¨åå°è¿›è¡Œç›‘å¬, åŒæ­¥ redis çš„å˜åŒ–, è¿ç§»å®Œæˆå†å…³é—­æ­¤æœåŠ¡.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./redis-shake ./redis_sync.toml</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨-RDB-æ–‡ä»¶è¿ç§»"><a href="#ä½¿ç”¨-RDB-æ–‡ä»¶è¿ç§»" class="headerlink" title="ä½¿ç”¨ RDB æ–‡ä»¶è¿ç§»"></a>ä½¿ç”¨ RDB æ–‡ä»¶è¿ç§»</h2><p>å…ˆåœ¨æº redis å¯¼å‡º rdb æ–‡ä»¶, ä¸Šä¼ åˆ°ä¸€å° linux æœºå™¨ (å¯ä»¥è®¿é—®ç›®æ ‡ redis), ç„¶åæ‰§è¡Œè¿ç§».</p><p>é…ç½®æ–‡ä»¶:</p><figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[rdb_reader]</span></span><br><span class="line"><span class="attr">filepath</span> = <span class="string">&quot;/tmp/dump.rdb&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="section">[redis_writer]</span></span><br><span class="line"><span class="attr">cluster</span> = <span class="literal">false</span></span><br><span class="line"><span class="attr">address</span> = <span class="string">&quot;127.0.0.1:6380&quot;</span></span><br><span class="line"><span class="attr">username</span> = <span class="string">&quot;&quot;</span>              <span class="comment"># keep empty if not using ACL</span></span><br><span class="line"><span class="attr">password</span> = <span class="string">&quot;&quot;</span>              <span class="comment"># keep empty if no authentication is required</span></span><br><span class="line"><span class="attr">tls</span> = <span class="literal">false</span></span><br></pre></td></tr></table></figure><p>æ‰§è¡Œè¿ç§»æ“ä½œ:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./redis-shake ./redis_sync.toml</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;p&gt;å¯¹äºè‡ªå»ºçš„ redis, æˆ‘ä»¬å¯ä»¥å°† rdb&amp;#x2F;aof æ–‡ä»¶æ‹·è´åˆ°ç›®çš„ redis, å¯åŠ¨æ¢å¤, ä½†æ˜¯äº‘ redis æˆ–è€…æŸäº›ç‰¹æ®Šæƒ…å†µ, æ¯”å¦‚æ²¡æœ‰äº‘å¹³å°çš„æƒé™ç­‰ç­‰æƒ…å†µ, å¯ä»¥ä½¿ç”¨å·¥å…·æ¥è¿›è¡Œè¿ç§».&lt;/p&gt;
&lt;p&gt;RedisShake æ˜¯é˜¿é‡Œäº‘ Tair å›¢é˜Ÿ ç§¯æç»´æŠ¤çš„ä¸€ä¸ªé¡¹ç›®ã€‚å®ƒçš„æ¼”å˜å¯ä»¥è¿½æº¯åˆ°å…¶åˆå§‹ç‰ˆæœ¬ï¼Œè¯¥ç‰ˆæœ¬æ˜¯ä» redis-port åˆ†æ”¯å‡ºæ¥çš„ã€‚å®˜æ–¹æ–‡æ¡£&lt;a</summary>
        
      
    
    
    
    <category term="æ•°æ®åº“" scheme="https://zahui.fan/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
    <category term="æ•°æ®è¿ç§»" scheme="https://zahui.fan/tags/%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB/"/>
    
    <category term="redis" scheme="https://zahui.fan/tags/redis/"/>
    
  </entry>
  
  <entry>
    <title>Elasticsearchç´¢å¼•ç”Ÿå‘½å‘¨æœŸé…ç½®</title>
    <link href="https://zahui.fan/posts/snui2r/"/>
    <id>https://zahui.fan/posts/snui2r/</id>
    <published>2024-12-02T02:40:03.000Z</published>
    <updated>2025-02-26T03:53:02.000Z</updated>
    
    <content type="html"><![CDATA[<p>å‚è€ƒ<br><a href="https://www.cnblogs.com/feifuzeng/p/13563430.html">https://www.cnblogs.com/feifuzeng/p/13563430.html</a><br><a href="https://blog.csdn.net/feiying0canglang/article/details/129789161">https://blog.csdn.net/feiying0canglang/article/details/129789161</a></p><p>è¿™é‡Œä»¥ <code>Elasticsearch 7.17.14</code> ä¸ºä¾‹ï¼Œ7.8 ç‰ˆæœ¬ä¹‹å‰ä¸ä¹‹åæœ‰ä¸€ç‚¹åŒºåˆ«ã€‚7.8 ä¹‹åçš„ API æ˜¯ï¼š<code>_index_template</code>ï¼Œ7.8 ä¹‹å‰çš„å‘½ä»¤æ˜¯ï¼š<code>_template</code></p><h2 id="è®¾ç½®ç´¢å¼•æ¨¡æ¿"><a href="#è®¾ç½®ç´¢å¼•æ¨¡æ¿" class="headerlink" title="è®¾ç½®ç´¢å¼•æ¨¡æ¿"></a>è®¾ç½®ç´¢å¼•æ¨¡æ¿</h2><p>æ¨¡æ¿æ˜¯ä¸ºäº†è®©åˆ›å»ºçš„ç´¢å¼•æŒ‰ç…§ä¸€å®šçš„è§„åˆ™ï¼Œæ¯”å¦‚ç´¢å¼•æŒ‰å¤©åˆ†å‰²ï¼Œæ‰‹åŠ¨ç»™æ¯ä¸ªç´¢å¼•åšé…ç½®å¤ªéº»çƒ¦</p><h2 id="åˆ›å»ºç”Ÿå‘½å‘¨æœŸç­–ç•¥"><a href="#åˆ›å»ºç”Ÿå‘½å‘¨æœŸç­–ç•¥" class="headerlink" title="åˆ›å»ºç”Ÿå‘½å‘¨æœŸç­–ç•¥"></a>åˆ›å»ºç”Ÿå‘½å‘¨æœŸç­–ç•¥</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®¾ç½®ingressæ—¥å¿—ä¿ç•™14å¤©ï¼Œè¶…è¿‡14å¤©åˆ é™¤ã€‚</span></span><br><span class="line">PUT _ilm/policy/ingress-log-retention-policy</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;policy&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;phases&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;hot&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;actions&quot;</span>: &#123;&#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&quot;delete&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;min_age&quot;</span>: <span class="string">&quot;14d&quot;</span>,</span><br><span class="line">        <span class="string">&quot;actions&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;delete&quot;</span>: &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åˆ›å»ºç´¢å¼•æ¨¡æ¿"><a href="#åˆ›å»ºç´¢å¼•æ¨¡æ¿" class="headerlink" title="åˆ›å»ºç´¢å¼•æ¨¡æ¿"></a>åˆ›å»ºç´¢å¼•æ¨¡æ¿</h2><p>ç´¢å¼•æ¨¡æ¿å¼•ç”¨ä¸Šé¢åˆ›å»ºçš„ç”Ÿå‘½å‘¨æœŸç­–ç•¥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºç´¢å¼•æ¨¡æ¿ï¼Œä¿è¯æ–°åˆ›å»ºçš„ç´¢å¼•éƒ½åº”ç”¨è¿™ä¸ªæ¨¡æ¿</span></span><br><span class="line">PUT /_index_template/ingress-log-template</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;index_patterns&quot;</span>: [<span class="string">&quot;ingress-*&quot;</span>],</span><br><span class="line">  <span class="string">&quot;template&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;settings&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;number_of_replicas&quot;</span>: 0,</span><br><span class="line">      <span class="string">&quot;index&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;lifecycle&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;name&quot;</span>: <span class="string">&quot;ingress-log-retention-policy&quot;</span>,</span><br><span class="line">          <span class="string">&quot;rollover_alias&quot;</span>: <span class="string">&quot;ingress-log-alias&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ£€æŸ¥æ˜¯å¦ç”Ÿæ•ˆ"><a href="#æ£€æŸ¥æ˜¯å¦ç”Ÿæ•ˆ" class="headerlink" title="æ£€æŸ¥æ˜¯å¦ç”Ÿæ•ˆ"></a>æ£€æŸ¥æ˜¯å¦ç”Ÿæ•ˆ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥è¯¢ç´¢å¼•çš„ilmçŠ¶æ€</span></span><br><span class="line">GET ingress-2024.12.01/_ilm/explain</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥è¯¢ç´¢å¼•è®¾ç½®ï¼Œæ¯”å¦‚æŸ¥çœ‹æ˜¯å¦ç»‘å®šäº†ilmç­–ç•¥</span></span><br><span class="line">GET ingress-2024.12.01/_settings</span><br></pre></td></tr></table></figure><h2 id="ä¿®æ”¹ç³»ç»Ÿé…ç½®"><a href="#ä¿®æ”¹ç³»ç»Ÿé…ç½®" class="headerlink" title="ä¿®æ”¹ç³»ç»Ÿé…ç½®"></a>ä¿®æ”¹ç³»ç»Ÿé…ç½®</h2><p>Elasticsearch ä¸ä¼šå®æ—¶æ£€æµ‹ï¼Œå¯ä»¥ä¿®æ”¹æ£€æµ‹æ—¶é—´é—´éš”</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹é›†ç¾¤çš„è®¾ç½®</span></span><br><span class="line">GET /_cluster/settings</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®æ£€æŸ¥æ—¶é—´ä¸º60s</span></span><br><span class="line">PUT _cluster/settings</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;persistent&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;indices.lifecycle.poll_interval&quot;</span>:<span class="string">&quot;60s&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ‰‹åŠ¨ä¿®æ”¹ç°å­˜çš„ç´¢å¼•"><a href="#æ‰‹åŠ¨ä¿®æ”¹ç°å­˜çš„ç´¢å¼•" class="headerlink" title="æ‰‹åŠ¨ä¿®æ”¹ç°å­˜çš„ç´¢å¼•"></a>æ‰‹åŠ¨ä¿®æ”¹ç°å­˜çš„ç´¢å¼•</h2><p>å› ä¸ºæˆ‘ä»¬åˆ›å»ºäº†ç´¢å¼•æ¨¡æ¿ï¼Œåªèƒ½åœ¨ä¸‹æ¬¡åˆ›å»ºæ–°ç´¢å¼•æ‰èƒ½ç”Ÿæ•ˆï¼Œè€ç´¢å¼•éœ€è¦æ‰‹åŠ¨ç»‘å®šåˆ°ç­–ç•¥ä¸Šã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ‰‹åŠ¨ä¿®æ”¹ç´¢å¼•ç»‘å®šçš„ilmç­–ç•¥</span></span><br><span class="line">PUT ingress-2024.12.01/_settings</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;index&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;lifecycle.name&quot;</span>: <span class="string">&quot;ingress-log-retention-policy&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å¯¹äº-logstash"><a href="#å¯¹äº-logstash" class="headerlink" title="å¯¹äº logstash"></a>å¯¹äº logstash</h2><p>logstash ä¼šåˆ›å»ºè‡ªå·±çš„é»˜è®¤ templateï¼Œæ‰€ä»¥æƒ³è¦åº”ç”¨ template éœ€è¦ç¦ç”¨ logstash çš„ manage_template</p><p><code>logstash.conf</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">input &#123;</span><br><span class="line">  kafka &#123;</span><br><span class="line">    bootstrap_servers =&gt; &quot;10.10.10.10:9092,10.10.10.11:9092,10.10.10.12:9092&quot;</span><br><span class="line">    topics =&gt; [&quot;ingress-k8s&quot;]</span><br><span class="line">    codec =&gt; &quot;json&quot;</span><br><span class="line">    consumer_threads =&gt; 3</span><br><span class="line">    group_id =&gt; &quot;k8s_group&quot;</span><br><span class="line">    decorate_events =&gt; true</span><br><span class="line">    type =&gt; &quot;logstash_mixins&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">filter&#123;</span><br><span class="line">    mutate&#123;</span><br><span class="line">        rename =&gt; [&quot;[host][name]&quot;, &quot;hostname&quot;]</span><br><span class="line">        remove_field =&gt; [&quot;ecs&quot;,&quot;@version&quot;,&quot;input&quot;,&quot;host&quot;,&quot;agent&quot;,&quot;log&quot;]</span><br><span class="line">        convert =&gt; &#123;</span><br><span class="line">          &quot;status&quot; =&gt; &quot;integer&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line">  if [type] == &quot;logstash_mixins&quot; &#123;</span><br><span class="line">      elasticsearch &#123;</span><br><span class="line">          action   =&gt; &quot;index&quot;</span><br><span class="line">          manage_template =&gt; false</span><br><span class="line">          hosts    =&gt; [&quot;http://10.10.10.21:9200&quot;,&quot;http://10.10.10.22:9200&quot;,&quot;http://10.10.10.23:9200&quot;]</span><br><span class="line">          index    =&gt; &quot;%&#123;[fields][type]&#125;-%&#123;+YYYY.MM.dd&#125;&quot;</span><br><span class="line">          user     =&gt; &quot;elastic&quot;</span><br><span class="line">          password =&gt; &quot;password&quot;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>éœ€è¦åœ¨ output ä¸­æ·»åŠ ä¸€è¡Œï¼š<code>manage_template =&gt; false</code></p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;p&gt;å‚è€ƒ&lt;br&gt;&lt;a href=&quot;https://www.cnblogs.com/feifuzeng/p/13563430.html&quot;&gt;https://www.cnblogs.com/feifuzeng/p/13563430.html&lt;/a&gt;&lt;br&gt;&lt;a</summary>
        
      
    
    
    
    <category term="æ—¥å¿—" scheme="https://zahui.fan/categories/%E6%97%A5%E5%BF%97/"/>
    
    
    <category term="å¸¸ç”¨æ“ä½œ" scheme="https://zahui.fan/tags/%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/"/>
    
    <category term="ES" scheme="https://zahui.fan/tags/ES/"/>
    
  </entry>
  
  <entry>
    <title>åœ¨Windowsä¸­ä½¿ç”¨msysæ¥è¿è¡Œlinuxå‘½ä»¤</title>
    <link href="https://zahui.fan/posts/snrcqh/"/>
    <id>https://zahui.fan/posts/snrcqh/</id>
    <published>2024-11-30T09:51:53.000Z</published>
    <updated>2025-04-01T06:01:03.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä¸ºä»€ä¹ˆä¸ç”¨-WSL"><a href="#ä¸ºä»€ä¹ˆä¸ç”¨-WSL" class="headerlink" title="ä¸ºä»€ä¹ˆä¸ç”¨ WSL"></a>ä¸ºä»€ä¹ˆä¸ç”¨ WSL</h2><p>ä¸»è¦åŸå› æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ol><li>WSL è®¿é—® Windows çš„è·¯å¾„å’ŒåŸç”Ÿ Windows ä¸ä¸€è‡´ï¼Œéœ€è¦æ‰‹åŠ¨æˆ–è€… <code>wslpath</code> å‘½ä»¤æ¥è½¬æ¢</li><li>åœ¨ Windows çš„å‘½ä»¤è¡Œè¿è¡Œ wsl å‘½ä»¤çš„æ—¶å€™ï¼Œéœ€è¦é€šè¿‡ <code>wsl &lt;linuxå‘½ä»¤&gt;</code> è¿™ç§æ–¹å¼æ¥å®ç°ï¼Œå¹¶ä¸æ˜¯åŸç”Ÿçš„ Windows å‘½ä»¤å†™æ³•ã€‚</li><li>WSL å¯åŠ¨è€—æ—¶é—®é¢˜ï¼ˆå€’è¿˜å¥½ï¼Œå½±å“ä¸å¤§ã€‚ï¼‰</li></ol><h2 id="ä¸‹è½½å®‰è£…"><a href="#ä¸‹è½½å®‰è£…" class="headerlink" title="ä¸‹è½½å®‰è£…"></a>ä¸‹è½½å®‰è£…</h2><p>å®˜ç½‘åœ°å€ï¼š<a href="https://www.msys2.org/">https://www.msys2.org/</a><br>å®‰è£…ç›´æ¥ä¸‹ä¸€æ­¥ä¸‹ä¸€æ­¥å³å¯ã€‚</p><blockquote><p>ä¸åŒçš„å¯åŠ¨å™¨ä¹‹é—´çš„åŒºåˆ«è¯·çœ‹ï¼š<a href="https://www.msys2.org/docs/environments/">https://www.msys2.org/docs/environments/</a></p></blockquote><h2 id="å¢åŠ ç¯å¢ƒå˜é‡"><a href="#å¢åŠ ç¯å¢ƒå˜é‡" class="headerlink" title="å¢åŠ ç¯å¢ƒå˜é‡"></a>å¢åŠ ç¯å¢ƒå˜é‡</h2><p>æˆ–è€… win + R è¾“å…¥ <code>sysdm.cpl</code> ç‚¹å‡» é«˜çº§ ç¯å¢ƒå˜é‡ è¿›å…¥ç¯å¢ƒå˜é‡é…ç½®ç•Œé¢ï¼š</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202411302227697.png" alt="image.png|753"></p><p>ä¸€èˆ¬æ¥è¯´å»ºè®®ä¿®æ”¹ç”¨æˆ·å˜é‡é‡Œé¢çš„ PATH å³å¯ï¼Œæ·»åŠ ä¸€ä¸ªè·¯å¾„ï¼š<code>C:\msys64\usr\bin</code></p><p>ç„¶åå°±å¯ä»¥æ­£å¸¸ä½¿ç”¨äº†ã€‚</p><h2 id="å¸¸ç”¨æŠ€å·§"><a href="#å¸¸ç”¨æŠ€å·§" class="headerlink" title="å¸¸ç”¨æŠ€å·§"></a>å¸¸ç”¨æŠ€å·§</h2><p>åŒ…ç®¡ç†ä½¿ç”¨çš„æ˜¯ pacman ï¼Œä½¿ç”¨æ–‡æ¡£å¯ä»¥çœ‹è¿™é‡Œï¼š<a href="https://www.msys2.org/docs/package-management/">https://www.msys2.org/docs/package-management/</a></p><p>æ¯”å¦‚å®‰è£… vimï¼Œå¯ä»¥æ‰§è¡Œ <code>pacman -S vim</code></p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h2 id=&quot;ä¸ºä»€ä¹ˆä¸ç”¨-WSL&quot;&gt;&lt;a href=&quot;#ä¸ºä»€ä¹ˆä¸ç”¨-WSL&quot; class=&quot;headerlink&quot; title=&quot;ä¸ºä»€ä¹ˆä¸ç”¨ WSL&quot;&gt;&lt;/a&gt;ä¸ºä»€ä¹ˆä¸ç”¨ WSL&lt;/h2&gt;&lt;p&gt;ä¸»è¦åŸå› æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;WSL è®¿é—® Windows çš„è·¯å¾„å’ŒåŸç”Ÿ Windows ä¸ä¸€è‡´ï¼Œéœ€è¦æ‰‹åŠ¨æˆ–è€… &lt;code&gt;wslpath&lt;/code&gt;</summary>
        
      
    
    
    
    <category term="Windows" scheme="https://zahui.fan/categories/Windows/"/>
    
    
  </entry>
  
  <entry>
    <title>HTTPSçš„åŸç†ï¼Œä½¿ç”¨HTTPSå°±ä¸€å®šæ˜¯å®‰å…¨çš„å—ï¼Ÿ</title>
    <link href="https://zahui.fan/posts/sna41n/"/>
    <id>https://zahui.fan/posts/sna41n/</id>
    <published>2024-11-21T02:24:59.000Z</published>
    <updated>2024-11-29T04:26:41.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="HTTPS-æ˜¯ä»€ä¹ˆ"><a href="#HTTPS-æ˜¯ä»€ä¹ˆ" class="headerlink" title="HTTPS æ˜¯ä»€ä¹ˆ"></a>HTTPS æ˜¯ä»€ä¹ˆ</h2><p>ä»¥å‰ä¸€ç›´ä»¥ä¸º HTTPS æ˜¯ä¸€ç§ä¸ HTTP ç±»ä¼¼çš„åº”ç”¨å±‚åè®®ï¼Œåæ¥æ‰å‘ç° HTTPS å¹¶ä¸æ˜¯ä¸€ç§åè®®ã€‚https åªæ˜¯åœ¨ URI ä¸­ä½œä¸º protocol identifier ç½¢äº†ã€‚HTTPS å…¶å®æ˜¯ HTTP Over TLSï¼ˆ <a href="https://datatracker.ietf.org/doc/html/rfc2818">RFC2818</a> ï¼‰çš„ç®€ç§°ï¼Œä¹Ÿå°±æ˜¯è¿è¡Œåœ¨ TLS åè®®ä¸Šçš„ HTTP åè®®ï¼Œä½¿ç”¨ TLS åè®®å¯¹ HTTP æ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œä»è€Œä¿è¯äº†å®‰å…¨æ€§ã€‚</p><h2 id="TLS-åè®®ç®€ä»‹"><a href="#TLS-åè®®ç®€ä»‹" class="headerlink" title="TLS åè®®ç®€ä»‹"></a>TLS åè®®ç®€ä»‹</h2><p>HTTPS çš„æ ¸å¿ƒå°±æ˜¯ TLS åè®®ï¼Œé‚£ä¹ˆ TLS åè®®åˆæ˜¯ä»€ä¹ˆå‘¢ï¼ŸTLS çš„å…¨ç§°ä¸º Transport Layer Securityï¼Œä¹Ÿå°±æ˜¯åœ¨ä¼ è¾“å±‚ä¿è¯å®‰å…¨ <a href="https://tools.ietf.org/html/rfc5246">RFC5246</a>ã€‚ä¸»è¦åˆ†ä¸ºä»¥ä¸‹å››ä¸ªåè®®ï¼š</p><ul><li><a href="https://tools.ietf.org/html/rfc5246#page-37">handshake protocol</a>ï¼Œç”¨æ¥å»ºç«‹è¿æ¥ã€èº«ä»½è®¤è¯ã€å¯†é’¥åå•†</li><li><a href="https://tools.ietf.org/html/rfc5246#page-28">alert protocol</a>ï¼Œç”¨æ¥å…³é—­è¿æ¥</li><li><a href="https://tools.ietf.org/html/rfc5246#page-27">change cipher spec protocol</a>ï¼Œç”¨æ¥è¡¨ç¤ºå¼€å§‹ä½¿ç”¨åå•†å¥½çš„åŠ å¯†æ–¹å¼è¿›è¡Œæ•°æ®ä¼ è¾“</li><li><a href="https://tools.ietf.org/html/rfc5246#page-65">application data protocol</a>ï¼Œç”¨æ¥ä¼ è¾“å¯†æ–‡</li></ul><p>TLS åè®®ä¸­æœ€é‡è¦çš„å°±æ˜¯ handshake äº†ï¼Œåœ¨æ¡æ‰‹é˜¶æ®µé€šä¿¡åŒæ–¹ä»¥å®‰å…¨çš„æ–¹å¼åå•†å¥½ç”¨äºä¹‹åæ•°æ®ä¼ è¾“çš„åŠ å¯†æ–¹å¼ä»¥åŠå„ç§å¯†é’¥ã€‚</p><h2 id="HTTPS-è¿æ¥è¿‡ç¨‹"><a href="#HTTPS-è¿æ¥è¿‡ç¨‹" class="headerlink" title="HTTPS è¿æ¥è¿‡ç¨‹"></a>HTTPS è¿æ¥è¿‡ç¨‹</h2><p>å¤§å®¶å¯èƒ½éƒ½å¬è¯´è¿‡ HTTPS åè®®ä¹‹æ‰€ä»¥æ˜¯å®‰å…¨çš„æ˜¯å› ä¸º HTTPS åè®®ä¼šå¯¹ä¼ è¾“çš„æ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œè€ŒåŠ å¯†è¿‡ç¨‹æ˜¯ä½¿ç”¨äº†éå¯¹ç§°åŠ å¯†å®ç°ã€‚ä½†å…¶å®ï¼ŒHTTPS åœ¨å†…å®¹ä¼ è¾“çš„åŠ å¯†ä¸Šä½¿ç”¨çš„æ˜¯å¯¹ç§°åŠ å¯†ï¼Œéå¯¹ç§°åŠ å¯†åªä½œç”¨åœ¨è¯ä¹¦éªŒè¯é˜¶æ®µã€‚</p><p>HTTPS çš„æ•´ä½“è¿‡ç¨‹åˆ†ä¸ºè¯ä¹¦éªŒè¯å’Œæ•°æ®ä¼ è¾“é˜¶æ®µï¼Œå…·ä½“çš„äº¤äº’è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202411211110422.webp" alt="41ac7d0df61046f0ab518fba866838dd.webp"></p><h3 id="å®¢æˆ·ç«¯è¯·æ±‚å»ºç«‹è¿æ¥"><a href="#å®¢æˆ·ç«¯è¯·æ±‚å»ºç«‹è¿æ¥" class="headerlink" title="å®¢æˆ·ç«¯è¯·æ±‚å»ºç«‹è¿æ¥"></a>å®¢æˆ·ç«¯è¯·æ±‚å»ºç«‹è¿æ¥</h3><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202411211139023.png" alt="image.png"></p><p>å®¢æˆ·ç«¯é¦–å…ˆè¦å‘æœåŠ¡å™¨è¯·æ±‚å»ºç«‹ä¸€ä¸ªå®‰å…¨è¿æ¥ã€‚éœ€è¦å‘é€ç»™æœåŠ¡å™¨çš„å¿…è¦ä¿¡æ¯æœ‰ï¼š</p><ul><li>TLS åè®®ç‰ˆæœ¬ã€‚</li><li>Cipher Suitesã€‚ç”±äºåŒæ–¹å¯¹ä¸€äº›åŠ å¯†ç®—æ³•çš„æ”¯æŒç¨‹åº¦å¯èƒ½ä¸åŒï¼Œå®¢æˆ·ç«¯éœ€è¦å°†å®ƒæ”¯æŒçš„åŠ å¯†æ–¹æ³•å‘é€ç»™æœåŠ¡å™¨ï¼Œä»¥ä¾›æœåŠ¡å™¨è¿›è¡Œé€‰æ‹©ã€‚</li><li>Session IDã€‚å¦‚æœæä¾›çš„è¯ï¼Œè¡¨ç¤ºä½¿ç”¨å‰ä¸€ä¸ªä¼šè¯ä¸­å·²åå•†å¥½çš„å¯†é’¥ï¼Œè€Œæ— éœ€å†æ¬¡åå•†ã€‚</li><li>Randomã€‚å®¢æˆ·ç«¯ç”Ÿæˆçš„éšæœºå€¼ï¼Œç”¨æ¥ç”Ÿæˆ <code>Master Secret</code>ã€‚</li><li>server_name extensionã€‚è¡¨ç¤ºè®¿é—®çš„æ˜¯å“ªä¸ªç½‘ç«™ã€‚</li></ul><h3 id="æœåŠ¡å™¨ç¡®å®šåŠ å¯†å¥—ä»¶"><a href="#æœåŠ¡å™¨ç¡®å®šåŠ å¯†å¥—ä»¶" class="headerlink" title="æœåŠ¡å™¨ç¡®å®šåŠ å¯†å¥—ä»¶"></a>æœåŠ¡å™¨ç¡®å®šåŠ å¯†å¥—ä»¶</h3><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202411211418010.png" alt="image.png"></p><p>æœåŠ¡å™¨æ¥æ”¶åˆ°å»ºç«‹è¿æ¥çš„è¯·æ±‚ä¹‹åï¼Œè¦å‘é€ä»¥ä¸‹ä¿¡æ¯ï¼š</p><ul><li>TLS åè®®ç‰ˆæœ¬ã€‚</li><li>Cipher Suiteã€‚ä»å®¢æˆ·ç«¯æä¾›çš„å¯é€‰åŠ å¯†æ–¹å¼ä¸­é€‰æ‹©ä¸€ä¸ªã€‚</li><li>Session IDã€‚æœ¬æ¬¡ä¼šè¯çš„ IDã€‚</li><li>Randomã€‚éšæœºç”Ÿæˆçš„å€¼ï¼Œç”¨æ¥ç”Ÿæˆ <code>Master Secret</code>ã€‚</li></ul><h3 id="æœåŠ¡å™¨å‘é€è¯ä¹¦"><a href="#æœåŠ¡å™¨å‘é€è¯ä¹¦" class="headerlink" title="æœåŠ¡å™¨å‘é€è¯ä¹¦"></a>æœåŠ¡å™¨å‘é€è¯ä¹¦</h3><p>åœ¨å‘é€ <code>Server Hello</code> ä¹‹åï¼ŒæœåŠ¡å™¨è¿˜éœ€è¦æŠŠå…¶è¯ä¹¦é€šè¿‡ <code>Certificate</code> å‘ç»™å®¢æˆ·ç«¯ã€‚</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202411211418690.png" alt="image.png"></p><p>è¯ä¹¦çš„ä½œç”¨åœ¨ <a href="https://yieldnull.com/blog/001efdfe76e6f4f672faf785dff1cc54e4fd26ba/">â€œç”¨æ•°å­—è¯ä¹¦è¯æ˜ä½ æ˜¯ä½ â€</a> ä¸€æ–‡ä¸­å·²ç»é˜æ˜ã€‚</p><p>è¦æ˜¯ä¹‹å‰ç¡®å®šçš„åŠ å¯†å¥—ä»¶ä¸­çš„ç§˜é’¥äº¤æ¢ç®—æ³•è¿˜éœ€è¦ä¸€äº›é¢å¤–çš„ä¿¡æ¯ï¼Œé‚£ä¹ˆæœåŠ¡å™¨è¿˜ä¼šå‘é€ä¸€ä¸ª <code>Server Key Exchange</code>ï¼Œç”¨æ¥ä¼ é€’é¢å¤–çš„ä¿¡æ¯ã€‚</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202411211419536.png" alt="image.png"></p><h3 id="åŒæ–¹å®Œæˆèº«ä»½è®¤è¯"><a href="#åŒæ–¹å®Œæˆèº«ä»½è®¤è¯" class="headerlink" title="åŒæ–¹å®Œæˆèº«ä»½è®¤è¯"></a>åŒæ–¹å®Œæˆèº«ä»½è®¤è¯</h3><p>ï¼ˆå¦‚æœæœåŠ¡å™¨è¦è®¤è¯å®¢æˆ·ç«¯çš„èº«ä»½ï¼Œé‚£ä¹ˆä¼šå‘é€ä¸€ä¸ª <code>Certificate Request</code> æ¥å‘å®¢æˆ·ç«¯è¯·æ±‚è¯ä¹¦ï¼Œå®¢æˆ·ç«¯æ”¶åˆ°è¯·æ±‚ä¹‹åä¼šå‘é€ <code>Certificate</code> ç»™æœåŠ¡å™¨ï¼‰</p><p>æœ€åï¼Œï¼ˆç¡®è®¤å®¢æˆ·ç«¯èº«ä»½ä¹‹åï¼‰æœåŠ¡å™¨å‘é€ <code>Server Done</code> è¡¨ç¤ºæˆ‘æƒ³çŸ¥é“çš„éƒ½å·²ç»çŸ¥é“äº†ï¼Œè¯¥å‘çš„ä¹Ÿå‘ç»™ä½ äº†ã€‚</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202411211419375.png" alt="image.png"></p><h3 id="ç”Ÿæˆå¯†é’¥"><a href="#ç”Ÿæˆå¯†é’¥" class="headerlink" title="ç”Ÿæˆå¯†é’¥"></a>ç”Ÿæˆå¯†é’¥</h3><p>é€šè¿‡ä¹‹å‰çš„æ­¥éª¤ï¼Œé€šä¿¡åŒæ–¹è®¤è¯äº†å¯¹æ–¹çš„èº«ä»½ï¼Œæ˜ç¡®äº†åŠ å¯†å¥—ä»¶ï¼Œç°åœ¨å°±ç¼ºåŠ å¯†å¯†é’¥äº†ã€‚</p><p>æ­¤æ—¶ï¼Œå®¢æˆ·ç«¯ä¼šç”Ÿæˆä¸€ä¸ª <code>premaster secret</code>ï¼Œå¹¶ç”¨æœåŠ¡å™¨è¯ä¹¦ä¸­çš„å…¬é’¥è¿›è¡ŒåŠ å¯†ï¼Œç„¶åé€šè¿‡ <code>Client Key Exchange</code> å‘é€ç»™æœåŠ¡å™¨ã€‚</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202411211420975.png" alt="image.png"></p><p>åŒæ—¶ï¼Œå®¢æˆ·ç«¯ä¼šåœ¨æœ¬åœ°ä½¿ç”¨ <code>premaster secret</code>ï¼Œä»¥åŠä¹‹å‰åœ¨ <code>Hello</code> é˜¶æ®µåŒæ–¹ç”Ÿæˆçš„ä¸¤ä¸ªéšæœºæ•°ï¼Œç”Ÿæˆæœ€ç»ˆçš„ <code>master secret</code></p><p>æœåŠ¡å™¨æ”¶åˆ° <code>Client Key Exchange</code> ä¹‹åï¼Œä½¿ç”¨å…¶ç§é’¥è§£å¯†å‡º <code>premaster secret</code>ã€‚ç„¶åä½¿ç”¨ä¸å®¢æˆ·ç«¯ç›¸åŒçš„æ–¹å¼ï¼Œç”Ÿæˆä¸å®¢æˆ·ç«¯ç›¸åŒçš„ <code>master secret</code>ã€‚</p><h3 id="é€šçŸ¥å¼€å§‹åŠ å¯†ä¼ è¾“"><a href="#é€šçŸ¥å¼€å§‹åŠ å¯†ä¼ è¾“" class="headerlink" title="é€šçŸ¥å¼€å§‹åŠ å¯†ä¼ è¾“"></a>é€šçŸ¥å¼€å§‹åŠ å¯†ä¼ è¾“</h3><p>å½“åŒæ–¹éƒ½å¾—åˆ° <code>master secret</code> ä¹‹åï¼Œå°±ä¼šå‘é€ <code>Change Cipher Spec</code> é€šçŸ¥å¯¹æ–¹ï¼šæˆ‘å¼€å§‹ç”¨ä¹‹å‰å•†é‡å¥½çš„åŠ å¯†æ–¹å¼ä»¥åŠå¯†é’¥ä¼ è¾“æ•°æ®äº†ã€‚</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202411211420400.png" alt="image.png"></p><h3 id="ç¡®ä¿å¯†é’¥å¯ç”¨"><a href="#ç¡®ä¿å¯†é’¥å¯ç”¨" class="headerlink" title="ç¡®ä¿å¯†é’¥å¯ç”¨"></a>ç¡®ä¿å¯†é’¥å¯ç”¨</h3><p>ä¸ºäº†ç¡®ä¿ä¹‹å‰çš„åå•†çš„ç¡®æ˜¯æˆåŠŸäº†ï¼ŒåŒæ–¹è¿˜éœ€è¦ç¡®è®¤ä¸€ä¸‹åŒæ–¹ä½¿ç”¨çš„å¯†é’¥æ˜¯ä¸æ˜¯ä¸€è‡´çš„ã€‚æ€ä¹ˆç¡®è®¤å‘¢ï¼Ÿé‚£å°±æŠŠä» <code>Client Hello</code> ä»¥æ¥æ¡æ‰‹è¿‡ç¨‹ä¸­åŒæ–¹é€šä¿¡çš„æ‰€æœ‰ä¿¡æ¯åŠ å¯†ä¹‹åï¼Œå†ç»™å¯¹æ–¹å‘é€ä¸€éã€‚è¦æ˜¯å¯¹æ–¹å‘è¿‡æ¥çš„ä¿¡æ¯è§£å¯†ä¹‹åä¸è‡ªå·±è®°å½•çš„ç›¸åŒï¼Œåˆ™è¡¨ç¤ºå¯†é’¥ç”Ÿæ•ˆäº†ï¼<br><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202411211420778.png" alt="image.png"></p><h3 id="åŠ å¯†å¥—ä»¶ä¸å¯†é’¥"><a href="#åŠ å¯†å¥—ä»¶ä¸å¯†é’¥" class="headerlink" title="åŠ å¯†å¥—ä»¶ä¸å¯†é’¥"></a>åŠ å¯†å¥—ä»¶ä¸å¯†é’¥</h3><p>ä¸Šä¸€èŠ‚ä»…ä»‹ç»äº†æ¡æ‰‹çš„æµç¨‹ï¼Œç°åœ¨æ¥ä»”ç»†çœ‹çœ‹å…¶ä¸­æ¶‰åŠåˆ°çš„åŠ å¯†å¥—ä»¶ï¼ˆ<a href="https://en.wikipedia.org/wiki/Cipher_suite">Cipher_suite</a>ï¼‰ä¸ <code>master secret</code>ã€‚</p><h3 id="åŠ å¯†å¥—ä»¶"><a href="#åŠ å¯†å¥—ä»¶" class="headerlink" title="åŠ å¯†å¥—ä»¶"></a>åŠ å¯†å¥—ä»¶</h3><p>åŠ å¯†å¥—ä»¶å®šä¹‰çš„æ˜¯åœ¨æ•´ä¸ªæ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸­ä½¿ç”¨åˆ°çš„åŠ å¯†æ–¹å¼ã€‚ä»¥ <code>TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256</code> ä¸ºä¾‹ï¼Œå…¶åŒ…å«ä»¥ä¸‹ç®—æ³•</p><ul><li><strong>å¯†é’¥äº¤æ¢ç®—æ³•</strong>ã€‚ç”¨æ¥äº¤æ¢å¯†é’¥ã€‚ä¾‹å¦‚ <code>ECDHE_RSA</code></li><li><strong>å¯¹ç§°åŠ å¯†ç®—æ³•</strong>ã€‚ç”¨æ¥åŠ å¯†ä¿¡æ¯ã€‚ä¾‹å¦‚ <code>AES_128_GCM</code></li><li><strong>ä¿¡æ¯æ‘˜è¦ç®—æ³•</strong>ã€‚ç”¨æ¥è®¡ç®—æ‘˜è¦ï¼Œé˜²æ­¢ç¯¡æ”¹ã€‚ä¾‹å¦‚ <code>SHA256</code></li><li><strong>ä¼ªéšæœºå‡½æ•°</strong>ã€‚ç”Ÿæˆ <code>master secret</code>ã€‚è¦ç”¨åˆ°ä¿¡æ¯æ‘˜è¦ç®—æ³•ã€‚</li></ul><h3 id="master-secret"><a href="#master-secret" class="headerlink" title="master secret"></a>master secret</h3><p>ä¸Šä¸€èŠ‚æåˆ°ï¼Œå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¼šæ ¹æ® <code>premaster secret</code> ä»¥åŠäºŒè€…åœ¨ <code>Hello</code> é˜¶æ®µå„è‡ªç”Ÿæˆçš„éšæœºæ•°ï¼Œäº§ç”Ÿç›¸åŒçš„ <code>master secret</code>ã€‚äºŒè€…ä½¿ç”¨çš„å‡½æ•°ä¸º</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202411211421527.png" alt="image.png"></p><p>è‡³äºç”Ÿæˆçš„ <code>master secret</code>ï¼Œå…¶æ ¼å¼ä¸º</p><blockquote><p>client write MAC key server write MAC key client write encryption key server write encryption key client write IV server write IV</p></blockquote><p>å‰ä¸¤ä¸ªæ˜¯è®¡ç®—æ‘˜è¦ç”¨çš„ KEYï¼Œä¸­é—´ä¸¤ä¸ªæ˜¯åŠ å¯†æ—¶ç”¨çš„ï¼Œæœ€åä¸¤ä¸ªé€‚ç”¨äºåŠ å¯†å¥—ä»¶ä½¿ç”¨ <code>AEAD</code> æ—¶ã€‚</p><h3 id="æ€»ç»“ä¸‹è¿æ¥è¿‡ç¨‹"><a href="#æ€»ç»“ä¸‹è¿æ¥è¿‡ç¨‹" class="headerlink" title="æ€»ç»“ä¸‹è¿æ¥è¿‡ç¨‹"></a>æ€»ç»“ä¸‹è¿æ¥è¿‡ç¨‹</h3><p><strong>â‘  è¯ä¹¦éªŒè¯é˜¶æ®µ</strong></p><ol><li>æµè§ˆå™¨å‘èµ· HTTPS è¯·æ±‚</li><li>æœåŠ¡ç«¯è¿”å› HTTPS è¯ä¹¦</li><li>å®¢æˆ·ç«¯éªŒè¯è¯ä¹¦æ˜¯å¦åˆæ³•ï¼Œå¦‚æœä¸åˆæ³•åˆ™æç¤ºå‘Šè­¦</li></ol><p><strong>â‘¡ æ•°æ®ä¼ è¾“é˜¶æ®µ</strong></p><ol><li>å½“è¯ä¹¦éªŒè¯åˆæ³•åï¼Œåœ¨æœ¬åœ°ç”Ÿæˆéšæœºæ•°</li><li>é€šè¿‡å…¬é’¥åŠ å¯†éšæœºæ•°ï¼Œå¹¶æŠŠåŠ å¯†åçš„éšæœºæ•°ä¼ è¾“åˆ°æœåŠ¡ç«¯</li><li>æœåŠ¡ç«¯é€šè¿‡ç§é’¥å¯¹éšæœºæ•°è¿›è¡Œè§£å¯†</li><li>æœåŠ¡ç«¯é€šè¿‡å®¢æˆ·ç«¯ä¼ å…¥çš„éšæœºæ•°æ„é€ å¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œå¯¹è¿”å›ç»“æœå†…å®¹è¿›è¡ŒåŠ å¯†åä¼ è¾“</li></ol><h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><h3 id="ä¸ºä»€ä¹ˆæ•°æ®ä¼ è¾“æ˜¯ç”¨å¯¹ç§°åŠ å¯†ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆæ•°æ®ä¼ è¾“æ˜¯ç”¨å¯¹ç§°åŠ å¯†ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆæ•°æ®ä¼ è¾“æ˜¯ç”¨å¯¹ç§°åŠ å¯†ï¼Ÿ"></a>ä¸ºä»€ä¹ˆæ•°æ®ä¼ è¾“æ˜¯ç”¨å¯¹ç§°åŠ å¯†ï¼Ÿ</h3><p>é¦–å…ˆï¼Œéå¯¹ç§°åŠ å¯†çš„åŠ è§£å¯†æ•ˆç‡æ˜¯éå¸¸ä½çš„ï¼Œè€Œ http çš„åº”ç”¨åœºæ™¯ä¸­é€šå¸¸ç«¯ä¸ç«¯ä¹‹é—´å­˜åœ¨å¤§é‡çš„äº¤äº’ï¼Œéå¯¹ç§°åŠ å¯†çš„æ•ˆç‡æ˜¯æ— æ³•æ¥å—çš„ï¼›</p><p>å¦å¤–ï¼Œåœ¨ HTTPS çš„åœºæ™¯ä¸­åªæœ‰æœåŠ¡ç«¯ä¿å­˜äº†ç§é’¥ï¼Œä¸€å¯¹å…¬ç§é’¥åªèƒ½å®ç°å•å‘çš„åŠ è§£å¯†ï¼Œæ‰€ä»¥ HTTPS ä¸­å†…å®¹ä¼ è¾“åŠ å¯†é‡‡å–çš„æ˜¯å¯¹ç§°åŠ å¯†ï¼Œè€Œä¸æ˜¯éå¯¹ç§°åŠ å¯†ã€‚</p><h3 id="ä¸ºä»€ä¹ˆéœ€è¦-CA-è®¤è¯æœºæ„é¢å‘è¯ä¹¦ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆéœ€è¦-CA-è®¤è¯æœºæ„é¢å‘è¯ä¹¦ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦ CA è®¤è¯æœºæ„é¢å‘è¯ä¹¦ï¼Ÿ"></a>ä¸ºä»€ä¹ˆéœ€è¦ CA è®¤è¯æœºæ„é¢å‘è¯ä¹¦ï¼Ÿ</h3><p>HTTP åè®®è¢«è®¤ä¸ºä¸å®‰å…¨æ˜¯å› ä¸ºä¼ è¾“è¿‡ç¨‹å®¹æ˜“è¢«ç›‘å¬è€…å‹¾çº¿ç›‘å¬ã€ä¼ªé€  <a href="https://cloud.tencent.com/product/cvm/?from_column=20065&from=20065">æœåŠ¡å™¨</a>ï¼Œè€Œ HTTPS åè®®ä¸»è¦è§£å†³çš„ä¾¿æ˜¯ç½‘ç»œä¼ è¾“çš„å®‰å…¨æ€§é—®é¢˜ã€‚</p><p>é¦–å…ˆæˆ‘ä»¬å‡è®¾ä¸å­˜åœ¨è®¤è¯æœºæ„ï¼Œä»»ä½•äººéƒ½å¯ä»¥åˆ¶ä½œè¯ä¹¦ï¼Œè¿™å¸¦æ¥çš„å®‰å…¨é£é™©ä¾¿æ˜¯ç»å…¸çš„Â <strong>â€œä¸­é—´äººæ”»å‡»â€</strong>Â é—®é¢˜ã€‚</p><p>â€œä¸­é—´äººæ”»å‡»â€çš„å…·ä½“è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202411211111399.webp" alt="f35348523dd744408647d2b97d2534c6.webp"></p><p>è¿‡ç¨‹åŸç†ï¼š</p><ol><li>æœ¬åœ°è¯·æ±‚è¢«åŠ«æŒï¼ˆå¦‚ DNS åŠ«æŒç­‰ï¼‰ï¼Œæ‰€æœ‰è¯·æ±‚å‡å‘é€åˆ°ä¸­é—´äººçš„æœåŠ¡å™¨</li><li>ä¸­é—´äººæœåŠ¡å™¨è¿”å›ä¸­é—´äººè‡ªå·±çš„è¯ä¹¦</li><li>å®¢æˆ·ç«¯åˆ›å»ºéšæœºæ•°ï¼Œé€šè¿‡ä¸­é—´äººè¯ä¹¦çš„å…¬é’¥å¯¹éšæœºæ•°åŠ å¯†åä¼ é€ç»™ä¸­é—´äººï¼Œç„¶åå‡­éšæœºæ•°æ„é€ å¯¹ç§°åŠ å¯†å¯¹ä¼ è¾“å†…å®¹è¿›è¡ŒåŠ å¯†ä¼ è¾“</li><li>ä¸­é—´äººå› ä¸ºæ‹¥æœ‰å®¢æˆ·ç«¯çš„éšæœºæ•°ï¼Œå¯ä»¥é€šè¿‡å¯¹ç§°åŠ å¯†ç®—æ³•è¿›è¡Œå†…å®¹è§£å¯†</li><li>ä¸­é—´äººä»¥å®¢æˆ·ç«¯çš„è¯·æ±‚å†…å®¹å†å‘æ­£è§„ç½‘ç«™å‘èµ·è¯·æ±‚</li><li>å› ä¸ºä¸­é—´äººä¸æœåŠ¡å™¨çš„é€šä¿¡è¿‡ç¨‹æ˜¯åˆæ³•çš„ï¼Œæ­£è§„ç½‘ç«™é€šè¿‡å»ºç«‹çš„å®‰å…¨é€šé“è¿”å›åŠ å¯†åçš„æ•°æ®</li><li>ä¸­é—´äººå‡­å€Ÿä¸æ­£è§„ç½‘ç«™å»ºç«‹çš„å¯¹ç§°åŠ å¯†ç®—æ³•å¯¹å†…å®¹è¿›è¡Œè§£å¯†</li><li>ä¸­é—´äººé€šè¿‡ä¸å®¢æˆ·ç«¯å»ºç«‹çš„å¯¹ç§°åŠ å¯†ç®—æ³•å¯¹æ­£è§„å†…å®¹è¿”å›çš„æ•°æ®è¿›è¡ŒåŠ å¯†ä¼ è¾“</li><li>å®¢æˆ·ç«¯é€šè¿‡ä¸ä¸­é—´äººå»ºç«‹çš„å¯¹ç§°åŠ å¯†ç®—æ³•å¯¹è¿”å›ç»“æœæ•°æ®è¿›è¡Œè§£å¯†</li></ol><p>ç”±äºç¼ºå°‘å¯¹è¯ä¹¦çš„éªŒè¯ï¼Œæ‰€ä»¥å®¢æˆ·ç«¯è™½ç„¶å‘èµ·çš„æ˜¯ HTTPS è¯·æ±‚ï¼Œä½†å®¢æˆ·ç«¯å®Œå…¨ä¸çŸ¥é“è‡ªå·±çš„ç½‘ç»œå·²è¢«æ‹¦æˆªï¼Œä¼ è¾“å†…å®¹è¢«ä¸­é—´äººå…¨éƒ¨çªƒå–ã€‚</p><h3 id="æµè§ˆå™¨æ˜¯å¦‚ä½•ç¡®ä¿-CA-è¯ä¹¦çš„åˆæ³•æ€§ï¼Ÿ"><a href="#æµè§ˆå™¨æ˜¯å¦‚ä½•ç¡®ä¿-CA-è¯ä¹¦çš„åˆæ³•æ€§ï¼Ÿ" class="headerlink" title="æµè§ˆå™¨æ˜¯å¦‚ä½•ç¡®ä¿ CA è¯ä¹¦çš„åˆæ³•æ€§ï¼Ÿ"></a>æµè§ˆå™¨æ˜¯å¦‚ä½•ç¡®ä¿ CA è¯ä¹¦çš„åˆæ³•æ€§ï¼Ÿ</h3><h4 id="1-è¯ä¹¦åŒ…å«ä»€ä¹ˆä¿¡æ¯ï¼Ÿ"><a href="#1-è¯ä¹¦åŒ…å«ä»€ä¹ˆä¿¡æ¯ï¼Ÿ" class="headerlink" title="1. è¯ä¹¦åŒ…å«ä»€ä¹ˆä¿¡æ¯ï¼Ÿ"></a>1. è¯ä¹¦åŒ…å«ä»€ä¹ˆä¿¡æ¯ï¼Ÿ</h4><ul><li>é¢å‘æœºæ„ä¿¡æ¯</li><li>å…¬é’¥</li><li>å…¬å¸ä¿¡æ¯</li><li>åŸŸå</li><li>æœ‰æ•ˆæœŸ</li><li>æŒ‡çº¹</li><li>â€¦â€¦</li></ul><h4 id="2-è¯ä¹¦çš„åˆæ³•æ€§ä¾æ®æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#2-è¯ä¹¦çš„åˆæ³•æ€§ä¾æ®æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="2. è¯ä¹¦çš„åˆæ³•æ€§ä¾æ®æ˜¯ä»€ä¹ˆï¼Ÿ"></a>2. è¯ä¹¦çš„åˆæ³•æ€§ä¾æ®æ˜¯ä»€ä¹ˆï¼Ÿ</h4><p>é¦–å…ˆï¼Œæƒå¨æœºæ„æ˜¯è¦æœ‰è®¤è¯çš„ï¼Œä¸æ˜¯éšä¾¿ä¸€ä¸ªæœºæ„éƒ½æœ‰èµ„æ ¼é¢å‘è¯ä¹¦ï¼Œä¸ç„¶ä¹Ÿä¸å«åšæƒå¨æœºæ„ã€‚å¦å¤–ï¼Œè¯ä¹¦çš„å¯ä¿¡æ€§åŸºäºä¿¡ä»»åˆ¶ï¼Œæƒå¨æœºæ„éœ€è¦å¯¹å…¶é¢å‘çš„è¯ä¹¦è¿›è¡Œä¿¡ç”¨èƒŒä¹¦ï¼Œåªè¦æ˜¯æƒå¨æœºæ„ç”Ÿæˆçš„è¯ä¹¦ï¼Œæˆ‘ä»¬å°±è®¤ä¸ºæ˜¯åˆæ³•çš„ã€‚æ‰€ä»¥æƒå¨æœºæ„ä¼šå¯¹ç”³è¯·è€…çš„ä¿¡æ¯è¿›è¡Œå®¡æ ¸ï¼Œä¸åŒç­‰çº§çš„æƒå¨æœºæ„å¯¹å®¡æ ¸çš„è¦æ±‚ä¹Ÿä¸ä¸€æ ·ï¼Œäºæ˜¯è¯ä¹¦ä¹Ÿåˆ†ä¸ºå…è´¹çš„ã€ä¾¿å®œçš„å’Œè´µçš„ã€‚</p><h4 id="3-æµè§ˆå™¨å¦‚ä½•éªŒè¯è¯ä¹¦çš„åˆæ³•æ€§ï¼Ÿ"><a href="#3-æµè§ˆå™¨å¦‚ä½•éªŒè¯è¯ä¹¦çš„åˆæ³•æ€§ï¼Ÿ" class="headerlink" title="3. æµè§ˆå™¨å¦‚ä½•éªŒè¯è¯ä¹¦çš„åˆæ³•æ€§ï¼Ÿ"></a>3. æµè§ˆå™¨å¦‚ä½•éªŒè¯è¯ä¹¦çš„åˆæ³•æ€§ï¼Ÿ</h4><p>æµè§ˆå™¨å‘èµ· HTTPS è¯·æ±‚æ—¶ï¼ŒæœåŠ¡å™¨ä¼šè¿”å›ç½‘ç«™çš„ SSL è¯ä¹¦ï¼Œæµè§ˆå™¨éœ€è¦å¯¹è¯ä¹¦åšä»¥ä¸‹éªŒè¯ï¼š</p><ol><li>éªŒè¯åŸŸåã€æœ‰æ•ˆæœŸç­‰ä¿¡æ¯æ˜¯å¦æ­£ç¡®ã€‚è¯ä¹¦ä¸Šéƒ½æœ‰åŒ…å«è¿™äº›ä¿¡æ¯ï¼Œæ¯”è¾ƒå®¹æ˜“å®ŒæˆéªŒè¯ï¼›</li><li>åˆ¤æ–­è¯ä¹¦æ¥æºæ˜¯å¦åˆæ³•ã€‚æ¯ä»½ç­¾å‘è¯ä¹¦éƒ½å¯ä»¥æ ¹æ®éªŒè¯é“¾æŸ¥æ‰¾åˆ°å¯¹åº”çš„æ ¹è¯ä¹¦ï¼Œæ“ä½œç³»ç»Ÿã€æµè§ˆå™¨ä¼šåœ¨æœ¬åœ°å­˜å‚¨æƒå¨æœºæ„çš„æ ¹è¯ä¹¦ï¼Œåˆ©ç”¨æœ¬åœ°æ ¹è¯ä¹¦å¯ä»¥å¯¹å¯¹åº”æœºæ„ç­¾å‘è¯ä¹¦å®Œæˆæ¥æºéªŒè¯ï¼›</li></ol><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202411211112715.webp" alt="e7d864735b9d4ff9a42e761bd44ce513.webp"></p><ol><li>åˆ¤æ–­è¯ä¹¦æ˜¯å¦è¢«ç¯¡æ”¹ã€‚éœ€è¦ä¸ CA æœåŠ¡å™¨è¿›è¡Œæ ¡éªŒï¼›</li><li>åˆ¤æ–­è¯ä¹¦æ˜¯å¦å·²åŠé”€ã€‚é€šè¿‡ CRLï¼ˆCertificate Revocation List è¯ä¹¦æ³¨é”€åˆ—è¡¨ï¼‰å’Œ OCSPï¼ˆOnline Certificate Status Protocol åœ¨çº¿è¯ä¹¦çŠ¶æ€åè®®ï¼‰å®ç°ï¼Œå…¶ä¸­ OCSP å¯ç”¨äºç¬¬ 3 æ­¥ä¸­ä»¥å‡å°‘ä¸ CA æœåŠ¡å™¨çš„äº¤äº’ï¼Œæé«˜éªŒè¯æ•ˆç‡</li></ol><p>ä»¥ä¸Šä»»æ„ä¸€æ­¥éƒ½æ»¡è¶³çš„æƒ…å†µä¸‹æµè§ˆå™¨æ‰è®¤ä¸ºè¯ä¹¦æ˜¯åˆæ³•çš„ã€‚</p><blockquote><p>è¿™é‡Œæ’ä¸€ä¸ªæˆ‘æƒ³äº†å¾ˆä¹…çš„ä½†å…¶å®ç­”æ¡ˆå¾ˆç®€å•çš„é—®é¢˜ï¼šÂ  æ—¢ç„¶è¯ä¹¦æ˜¯å…¬å¼€çš„ï¼Œå¦‚æœè¦å‘èµ·ä¸­é—´äººæ”»å‡»ï¼Œæˆ‘åœ¨å®˜ç½‘ä¸Šä¸‹è½½ä¸€ä»½è¯ä¹¦ä½œä¸ºæˆ‘çš„æœåŠ¡å™¨è¯ä¹¦ï¼Œé‚£å®¢æˆ·ç«¯è‚¯å®šä¼šè®¤åŒè¿™ä¸ªè¯ä¹¦æ˜¯åˆæ³•çš„ï¼Œå¦‚ä½•é¿å…è¿™ç§è¯ä¹¦å†’ç”¨çš„æƒ…å†µï¼Ÿ å…¶å®è¿™å°±æ˜¯éåŠ å¯†å¯¹ç§°ä¸­å…¬ç§é’¥çš„ç”¨å¤„ï¼Œè™½ç„¶ä¸­é—´äººå¯ä»¥å¾—åˆ°è¯ä¹¦ï¼Œä½†ç§é’¥æ˜¯æ— æ³•è·å–çš„ï¼Œä¸€ä»½å…¬é’¥æ˜¯ä¸å¯èƒ½æ¨ç®—å‡ºå…¶å¯¹åº”çš„ç§é’¥ï¼Œä¸­é—´äººå³ä½¿æ‹¿åˆ°è¯ä¹¦ä¹Ÿæ— æ³•ä¼ªè£…æˆåˆæ³•æœåŠ¡ç«¯ï¼Œå› ä¸ºæ— æ³•å¯¹å®¢æˆ·ç«¯ä¼ å…¥çš„åŠ å¯†æ•°æ®è¿›è¡Œè§£å¯†ã€‚</p></blockquote><h4 id="4-åªæœ‰è®¤è¯æœºæ„å¯ä»¥ç”Ÿæˆè¯ä¹¦å—ï¼Ÿ"><a href="#4-åªæœ‰è®¤è¯æœºæ„å¯ä»¥ç”Ÿæˆè¯ä¹¦å—ï¼Ÿ" class="headerlink" title="4. åªæœ‰è®¤è¯æœºæ„å¯ä»¥ç”Ÿæˆè¯ä¹¦å—ï¼Ÿ"></a>4. åªæœ‰è®¤è¯æœºæ„å¯ä»¥ç”Ÿæˆè¯ä¹¦å—ï¼Ÿ</h4><p>å¦‚æœéœ€è¦æµè§ˆå™¨ä¸æç¤ºå®‰å…¨é£é™©ï¼Œé‚£åªèƒ½ä½¿ç”¨è®¤è¯æœºæ„ç­¾å‘çš„è¯ä¹¦ã€‚ä½†æµè§ˆå™¨é€šå¸¸åªæ˜¯æç¤ºå®‰å…¨é£é™©ï¼Œå¹¶ä¸é™åˆ¶ç½‘ç«™ä¸èƒ½è®¿é—®ï¼Œæ‰€ä»¥ä»æŠ€æœ¯ä¸Šè°éƒ½å¯ä»¥ç”Ÿæˆè¯ä¹¦ï¼Œåªè¦æœ‰è¯ä¹¦å°±å¯ä»¥å®Œæˆç½‘ç«™çš„ HTTPS ä¼ è¾“ã€‚ä¾‹å¦‚æ—©æœŸçš„ 12306 é‡‡ç”¨çš„ä¾¿æ˜¯æ‰‹åŠ¨å®‰è£…ç§æœ‰è¯ä¹¦çš„å½¢å¼å®ç° HTTPS è®¿é—®ã€‚</p><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202411211112378.png" alt="1e9f4c5925fc4929804b8a1bc94cdd87.png"></p><p><strong>å¦‚ä½•ä¿è¯éšæœºæ•°ä¸ä¼šè¢«çªƒå–ï¼Ÿ</strong></p><p>å…¶å® HTTPS å¹¶ä¸åŒ…å«å¯¹éšæœºæ•°çš„å®‰å…¨ä¿è¯ï¼ŒHTTPS ä¿è¯çš„åªæ˜¯ä¼ è¾“è¿‡ç¨‹å®‰å…¨ï¼Œè€Œéšæœºæ•°å­˜å‚¨äºæœ¬åœ°ï¼Œæœ¬åœ°çš„å®‰å…¨å±äºå¦ä¸€å®‰å…¨èŒƒç•´ï¼Œåº”å¯¹çš„æªæ–½æœ‰å®‰è£…æ€æ¯’è½¯ä»¶ã€åæœ¨é©¬ã€æµè§ˆå™¨å‡çº§ä¿®å¤æ¼æ´ç­‰ã€‚</p><h3 id="ç”¨äº†-HTTPS-ä¼šè¢«æŠ“åŒ…å—ï¼Ÿ"><a href="#ç”¨äº†-HTTPS-ä¼šè¢«æŠ“åŒ…å—ï¼Ÿ" class="headerlink" title="ç”¨äº† HTTPS ä¼šè¢«æŠ“åŒ…å—ï¼Ÿ"></a>ç”¨äº† HTTPS ä¼šè¢«æŠ“åŒ…å—ï¼Ÿ</h3><p>HTTPS çš„æ•°æ®æ˜¯åŠ å¯†çš„ï¼Œå¸¸è§„ä¸‹æŠ“åŒ…å·¥å…·ä»£ç†è¯·æ±‚åæŠ“åˆ°çš„åŒ…å†…å®¹æ˜¯åŠ å¯†çŠ¶æ€ï¼Œæ— æ³•ç›´æ¥æŸ¥çœ‹ã€‚</p><p>ä½†æ˜¯ï¼Œæ­£å¦‚å‰æ–‡æ‰€è¯´ï¼Œæµè§ˆå™¨åªä¼šæç¤ºå®‰å…¨é£é™©ï¼Œå¦‚æœç”¨æˆ·æˆæƒä»ç„¶å¯ä»¥ç»§ç»­è®¿é—®ç½‘ç«™ï¼Œå®Œæˆè¯·æ±‚ã€‚å› æ­¤ï¼Œåªè¦å®¢æˆ·ç«¯æ˜¯æˆ‘ä»¬è‡ªå·±çš„ç»ˆç«¯ï¼Œæˆ‘ä»¬æˆæƒçš„æƒ…å†µä¸‹ï¼Œä¾¿å¯ä»¥ç»„å»ºä¸­é—´äººç½‘ç»œï¼Œè€ŒæŠ“åŒ…å·¥å…·ä¾¿æ˜¯ä½œä¸ºä¸­é—´äººçš„ä»£ç†ã€‚é€šå¸¸ HTTPS æŠ“åŒ…å·¥å…·çš„ä½¿ç”¨æ–¹æ³•æ˜¯ä¼šç”Ÿæˆä¸€ä¸ªè¯ä¹¦ï¼Œç”¨æˆ·éœ€è¦æ‰‹åŠ¨æŠŠè¯ä¹¦å®‰è£…åˆ°å®¢æˆ·ç«¯ä¸­ï¼Œç„¶åç»ˆç«¯å‘èµ·çš„æ‰€æœ‰è¯·æ±‚é€šè¿‡è¯¥è¯ä¹¦å®Œæˆä¸æŠ“åŒ…å·¥å…·çš„äº¤äº’ï¼Œç„¶åæŠ“åŒ…å·¥å…·å†è½¬å‘è¯·æ±‚åˆ°æœåŠ¡å™¨ï¼Œæœ€åæŠŠæœåŠ¡å™¨è¿”å›çš„ç»“æœåœ¨æ§åˆ¶å°è¾“å‡ºåå†è¿”å›ç»™ç»ˆç«¯ï¼Œä»è€Œå®Œæˆæ•´ä¸ªè¯·æ±‚çš„é—­ç¯ã€‚</p><p><strong>æ—¢ç„¶ HTTPS ä¸èƒ½é˜²æŠ“åŒ…ï¼Œé‚£ HTTPS æœ‰ä»€ä¹ˆæ„ä¹‰ï¼Ÿ</strong>Â  HTTPS å¯ä»¥é˜²æ­¢ç”¨æˆ·åœ¨ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹é€šä¿¡é“¾è·¯è¢«ç›‘å¬ï¼Œå¯¹äºä¸»åŠ¨æˆä¿¡çš„æŠ“åŒ…æ“ä½œæ˜¯ä¸æä¾›é˜²æŠ¤çš„ï¼Œå› ä¸ºè¿™ä¸ªåœºæ™¯ç”¨æˆ·æ˜¯å·²ç»å¯¹é£é™©çŸ¥æƒ…ã€‚è¦é˜²æ­¢è¢«æŠ“åŒ…ï¼Œéœ€è¦é‡‡ç”¨åº”ç”¨çº§çš„å®‰å…¨é˜²æŠ¤ï¼Œä¾‹å¦‚é‡‡ç”¨ç§æœ‰çš„å¯¹ç§°åŠ å¯†ï¼ŒåŒæ—¶åšå¥½ç§»åŠ¨ç«¯çš„é˜²åç¼–è¯‘åŠ å›ºï¼Œé˜²æ­¢æœ¬åœ°ç®—æ³•è¢«ç ´è§£ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ä»¥ä¸‹ç”¨ç®€çŸ­çš„ Q&amp;A å½¢å¼è¿›è¡Œå…¨æ–‡æ€»ç»“ï¼š</p><p>Q: HTTPS ä¸ºä»€ä¹ˆå®‰å…¨ï¼ŸÂ </p><p>A: å› ä¸º HTTPS ä¿è¯äº†ä¼ è¾“å®‰å…¨ï¼Œé˜²æ­¢ä¼ è¾“è¿‡ç¨‹è¢«ç›‘å¬ã€é˜²æ­¢æ•°æ®è¢«çªƒå–ï¼Œå¯ä»¥ç¡®è®¤ç½‘ç«™çš„çœŸå®æ€§ã€‚</p><p>Q: HTTPS çš„ä¼ è¾“è¿‡ç¨‹æ˜¯æ€æ ·çš„ï¼ŸÂ </p><p>A: å®¢æˆ·ç«¯å‘èµ· HTTPS è¯·æ±‚ï¼ŒæœåŠ¡ç«¯è¿”å›è¯ä¹¦ï¼Œå®¢æˆ·ç«¯å¯¹è¯ä¹¦è¿›è¡ŒéªŒè¯ï¼ŒéªŒè¯é€šè¿‡åæœ¬åœ°ç”Ÿæˆç”¨äºæ”¹é€ å¯¹ç§°åŠ å¯†ç®—æ³•çš„éšæœºæ•°ï¼Œé€šè¿‡è¯ä¹¦ä¸­çš„å…¬é’¥å¯¹éšæœºæ•°è¿›è¡ŒåŠ å¯†ä¼ è¾“åˆ°æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯æ¥æ”¶åé€šè¿‡ç§é’¥è§£å¯†å¾—åˆ°éšæœºæ•°ï¼Œä¹‹åçš„æ•°æ®äº¤äº’é€šè¿‡å¯¹ç§°åŠ å¯†ç®—æ³•è¿›è¡ŒåŠ è§£å¯†ã€‚</p><p>Q: ä¸ºä»€ä¹ˆéœ€è¦è¯ä¹¦ï¼ŸÂ </p><p>A: é˜²æ­¢â€ä¸­é—´äººâ€œæ”»å‡»ï¼ŒåŒæ—¶å¯ä»¥ä¸ºç½‘ç«™æä¾›èº«ä»½è¯æ˜ã€‚</p><p>Q: ä½¿ç”¨ HTTPS ä¼šè¢«æŠ“åŒ…å—ï¼ŸÂ </p><p>A: ä¼šè¢«æŠ“åŒ…ï¼ŒHTTPS åªé˜²æ­¢ç”¨æˆ·åœ¨ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹é€šä¿¡è¢«ç›‘å¬ï¼Œå¦‚æœç”¨æˆ·ä¸»åŠ¨æˆä¿¡ï¼Œæ˜¯å¯ä»¥æ„å»ºâ€œä¸­é—´äººâ€ç½‘ç»œï¼Œä»£ç†è½¯ä»¶å¯ä»¥å¯¹ä¼ è¾“å†…å®¹è¿›è¡Œè§£å¯†ã€‚</p><h2 id="æ¥æº"><a href="#æ¥æº" class="headerlink" title="æ¥æº"></a>æ¥æº</h2><ul><li><a href="https://tools.ietf.org/html/rfc2818">HTTP Over TLS. RFC2818</a></li><li><a href="https://msdn.microsoft.com/en-us/library/windows/desktop/aa380513%28v=vs.85%29.aspx">TLS Handshake Protocol</a></li><li><a href="http://www.moserware.com/2009/06/first-few-milliseconds-of-https.html">The First Few Milliseconds of an HTTPS Connection</a></li><li><a href="https://segmentfault.com/a/1190000002554673">SSL&#x2F;TLSåŸç†è¯¦è§£</a></li><li><a href="https://www.wosign.com/faq/faq2016-0309-04.htm">TLS&#x2F;SSLæ¡æ‰‹è¿‡ç¨‹</a></li><li><a href="http://blog.csdn.net/dog250/article/details/5717162">sslåè®®ä¸­çš„dhç®—æ³•çš„pre-master-secret</a></li><li><a href="https://en.wikipedia.org/wiki/Cipher_suite">Cipher_suite</a></li><li><a href="https://yieldnull.com/blog/001efdfe76e6f4f672faf785dff1cc54e4fd26ba/">ç”¨æ•°å­—è¯ä¹¦è¯æ˜ä½ æ˜¯ä½ </a></li></ul>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h2 id=&quot;HTTPS-æ˜¯ä»€ä¹ˆ&quot;&gt;&lt;a href=&quot;#HTTPS-æ˜¯ä»€ä¹ˆ&quot; class=&quot;headerlink&quot; title=&quot;HTTPS æ˜¯ä»€ä¹ˆ&quot;&gt;&lt;/a&gt;HTTPS æ˜¯ä»€ä¹ˆ&lt;/h2&gt;&lt;p&gt;ä»¥å‰ä¸€ç›´ä»¥ä¸º HTTPS æ˜¯ä¸€ç§ä¸ HTTP ç±»ä¼¼çš„åº”ç”¨å±‚åè®®ï¼Œåæ¥æ‰å‘ç° HTTPS å¹¶ä¸æ˜¯ä¸€ç§åè®®ã€‚https åªæ˜¯åœ¨ URI ä¸­ä½œä¸º protocol identifier ç½¢äº†ã€‚HTTPS</summary>
        
      
    
    
    
    <category term="åŸºç¡€è¿ç»´" scheme="https://zahui.fan/categories/%E5%9F%BA%E7%A1%80%E8%BF%90%E7%BB%B4/"/>
    
    
    <category term="åŠ å¯†" scheme="https://zahui.fan/tags/%E5%8A%A0%E5%AF%86/"/>
    
    <category term="tls" scheme="https://zahui.fan/tags/tls/"/>
    
    <category term="https" scheme="https://zahui.fan/tags/https/"/>
    
    <category term="SSL" scheme="https://zahui.fan/tags/SSL/"/>
    
  </entry>
  
  <entry>
    <title>ç”Ÿäº§ç¯å¢ƒPrometheusç›‘æ§æ¶æ„è®°å½•</title>
    <link href="https://zahui.fan/posts/sn6pu2/"/>
    <id>https://zahui.fan/posts/sn6pu2/</id>
    <published>2024-11-19T06:25:14.000Z</published>
    <updated>2024-11-29T04:26:41.000Z</updated>
    
    <content type="html"><![CDATA[<p>æ¯”å¦‚æœ‰ 30 å®¶å®¢æˆ·ï¼Œæ¯ä¸€ä¸ªå®¢æˆ·éƒ½æœ‰è‡ªå·±çš„ Kubernetes é›†ç¾¤ï¼Œéƒ¨ç½²æ–¹å¼åƒå·®ä¸‡åˆ«ï¼Œè¿˜æœ‰å®¢æˆ·ä¸ä½¿ç”¨ Kubernetes çš„ï¼Œä½¿ç”¨è™šæ‹Ÿæœºéƒ¨ç½²ï¼Œé‚£ä¹ˆæ€ä¹ˆå¯¹è¿™ä¹ˆå¤šå®¢æˆ·çš„æœºå™¨ã€æœåŠ¡è¿›è¡Œæœ‰æ•ˆçš„ç›‘æ§ï¼Œæœ¬æ–‡è®°å½•ä¸€ä¸‹ç›‘æ§çš„æ¶æ„æ–¹æ¡ˆã€‚</p><h2 id="ç›‘æ§æ¶æ„å›¾"><a href="#ç›‘æ§æ¶æ„å›¾" class="headerlink" title="ç›‘æ§æ¶æ„å›¾"></a>ç›‘æ§æ¶æ„å›¾</h2><p><img src= "https://static.zahui.fan/public/nes.gif" data-lazy-src="https://static.zahui.fan/images/202411201501698.png"></p><p>è¯´æ˜ï¼š<br>Prometheus Core æ˜¯ä¸€ä¸ªæ ¸å¿ƒçš„ Prometheusï¼Œæ‰€æœ‰å…¶ä»– Prometheus çš„æ•°æ®éƒ½æ±‡æ€»åˆ°è¿™é‡Œï¼ŒæŸ¥è¯¢ã€å‘Šè­¦ç­‰éƒ½ä½¿ç”¨è¿™ä¸ª Prometheus</p><h2 id="Prometheus-Core"><a href="#Prometheus-Core" class="headerlink" title="Prometheus Core"></a>Prometheus Core</h2><p>è¿™ä¸ªæ˜¯æ ¸å¿ƒçš„ Prometheusï¼Œå…¶ä»–å®¢æˆ·çš„ Prometheus é€šè¿‡è”é‚¦æ¥å…¥æˆ–è€… è¿œç¨‹å†™ (remote write) çš„æ–¹å¼æ¥å†™å…¥æ•°æ®åˆ°è¿™ä¸ª Prometheus ä¸­ã€‚Prometheus Core å¯ä»¥æ›´æ¢æˆ <a href="/posts/e59d8e32">VictoriaMetrics</a></p><h3 id="è”é‚¦æ¥å…¥é…ç½®"><a href="#è”é‚¦æ¥å…¥é…ç½®" class="headerlink" title="è”é‚¦æ¥å…¥é…ç½®"></a>è”é‚¦æ¥å…¥é…ç½®</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># http æ¥å£è”é‚¦</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;federate-http&#x27;</span></span><br><span class="line">  <span class="attr">scrape_interval:</span> <span class="string">30s</span></span><br><span class="line">  <span class="attr">scrape_timeout:</span> <span class="string">30s</span></span><br><span class="line">  <span class="attr">honor_labels:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">metrics_path:</span> <span class="string">&#x27;/federate&#x27;</span></span><br><span class="line">  <span class="attr">basic_auth:</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">&#x27;admin&#x27;</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">&#x27;password&#x27;</span></span><br><span class="line">  <span class="attr">params:</span></span><br><span class="line">    <span class="string">&#x27;match[]&#x27;</span><span class="string">:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;&#123;job=~&quot;.+&quot;&#125;&#x27;</span></span><br><span class="line">  <span class="attr">file_sd_configs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">files:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">/data/prometheus/conf.d/federate_http.yml</span></span><br><span class="line">      <span class="attr">refresh_interval:</span> <span class="string">30s</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># https æ¥å£è”é‚¦</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;federate-https&#x27;</span></span><br><span class="line">  <span class="attr">scrape_interval:</span> <span class="string">30s</span></span><br><span class="line">  <span class="attr">scrape_timeout:</span> <span class="string">30s</span></span><br><span class="line">  <span class="attr">honor_labels:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">metrics_path:</span> <span class="string">&#x27;/federate&#x27;</span></span><br><span class="line">  <span class="attr">basic_auth:</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">&#x27;admin&#x27;</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">&#x27;password&#x27;</span></span><br><span class="line">  <span class="attr">scheme:</span> <span class="string">https</span></span><br><span class="line">  <span class="attr">params:</span></span><br><span class="line">    <span class="string">&#x27;match[]&#x27;</span><span class="string">:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;&#123;job=~&quot;.+&quot;&#125;&#x27;</span></span><br><span class="line">  <span class="attr">file_sd_configs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">files:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">/data/prometheus/conf.d/federate_https.yml</span></span><br><span class="line">      <span class="attr">refresh_interval:</span> <span class="string">1m</span></span><br><span class="line">  <span class="attr">tls_config:</span></span><br><span class="line">    <span class="attr">insecure_skip_verify:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><p>å¯¹åº”çš„ <code>federate_http.yml</code></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">targets:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">10.252</span><span class="number">.0</span><span class="number">.250</span><span class="string">:9090</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">env:</span> <span class="string">&quot;test&quot;</span></span><br><span class="line">    <span class="attr">k8s:</span> <span class="string">k8s-test</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">&quot;prometheus&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">targets:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">10.249</span><span class="number">.48</span><span class="number">.250</span><span class="string">:9090</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">env:</span> <span class="string">&quot;prod&quot;</span></span><br><span class="line">    <span class="attr">k8s:</span> <span class="string">k8s-prod</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">&quot;prometheus&quot;</span></span><br></pre></td></tr></table></figure><h3 id="è¿œç¨‹å†™å…¥é…ç½®"><a href="#è¿œç¨‹å†™å…¥é…ç½®" class="headerlink" title="è¿œç¨‹å†™å…¥é…ç½®"></a>è¿œç¨‹å†™å…¥é…ç½®</h3><p>ä¿®æ”¹ Prometheus å¯åŠ¨å‚æ•°ï¼Œå¢åŠ ï¼š<code>--enable-feature=remote-write-receiver</code> å¯åŠ¨å‚æ•°ã€‚</p><h2 id="Kubernetes-ä¸­éƒ¨ç½²æœ‰é›†ç¾¤æƒé™çš„-Prometheus"><a href="#Kubernetes-ä¸­éƒ¨ç½²æœ‰é›†ç¾¤æƒé™çš„-Prometheus" class="headerlink" title="Kubernetes ä¸­éƒ¨ç½²æœ‰é›†ç¾¤æƒé™çš„ Prometheus"></a>Kubernetes ä¸­éƒ¨ç½²æœ‰é›†ç¾¤æƒé™çš„ Prometheus</h2><p>é€‚åˆæœ‰é›†ç¾¤æƒé™çš„ Prometheus,å¯ä»¥åˆ›å»º serviceaccount å’Œ clusterrole clusterrolebinding èµ„æºæ‰å¯ä»¥è‡ªåŠ¨å‘ç°</p><p>å‚è€ƒ Prometheus å®˜æ–¹ GitHub ä¸Šçš„é…ç½®æ–‡ä»¶ <a href="https://github.com/prometheus/prometheus/blob/main/documentation/examples/rbac-setup.yml">https://github.com/prometheus/prometheus/blob/main/documentation/examples/rbac-setup.yml</a></p><p>å®Œæ•´çš„é…ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">prometheus</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">nodes</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">nodes/proxy</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">services</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">endpoints</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">pods</span></span><br><span class="line">  <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;list&quot;</span>, <span class="string">&quot;watch&quot;</span>]</span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">extensions</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">networking.k8s.io</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">ingresses</span></span><br><span class="line">  <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;list&quot;</span>, <span class="string">&quot;watch&quot;</span>]</span><br><span class="line"><span class="bullet">-</span> <span class="attr">nonResourceURLs:</span> [<span class="string">&quot;/metrics&quot;</span>]</span><br><span class="line">  <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">prometheus</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">monitor</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">prometheus</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">prometheus</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">prometheus</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">monitor</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">prometheus-deployment</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">prometheus</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">monitor</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">prometheus</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">prometheus</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">serviceAccountName:</span> <span class="string">prometheus</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">image:</span> <span class="string">prom/prometheus:v2.34.0</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">prometheus</span></span><br><span class="line">        <span class="attr">command:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&quot;/bin/prometheus&quot;</span></span><br><span class="line">        <span class="attr">args:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&quot;--config.file=/etc/prometheus/prometheus.yml&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&quot;--storage.tsdb.path=/prometheus&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&quot;--storage.tsdb.retention=24h&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&quot;--web.enable-lifecycle&quot;</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">9090</span></span><br><span class="line">          <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">data</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">&quot;/prometheus&quot;</span></span><br><span class="line">        <span class="comment"># è¿™ç§æ–¹å¼æŒ‚è½½ï¼Œä¼šå°†åŸå§‹ç›®å½•æ•´ä¸ªæŒ‚è½½ï¼Œä¹Ÿå°±æ˜¯çœ‹ä¸åˆ°åŸå§‹çš„æ–‡ä»¶äº†ã€‚</span></span><br><span class="line">        <span class="comment"># - name: prometheus-config</span></span><br><span class="line">        <span class="comment">#   mountPath: /etc/prometheus</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">prometheus-config</span>                <span class="comment"># volumesçš„åå­—</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/etc/prometheus/prometheus.yml</span>     <span class="comment"># å®¹å™¨å†…çš„ç›®å½•</span></span><br><span class="line">          <span class="attr">subPath:</span> <span class="string">prometheus.yml</span>                       <span class="comment"># æŒ‡å®šconfigmapé‡Œé¢çš„key</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">prometheus-config</span>                <span class="comment"># volumesçš„åå­—</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/etc/prometheus/web.yml</span>     <span class="comment"># å®¹å™¨å†…çš„ç›®å½•</span></span><br><span class="line">          <span class="attr">subPath:</span> <span class="string">web.yml</span>                       <span class="comment"># æŒ‡å®šconfigmapé‡Œé¢çš„key</span></span><br><span class="line">        <span class="attr">resources:</span></span><br><span class="line">          <span class="attr">requests:</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">&quot;1&quot;</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">&quot;2Gi&quot;</span></span><br><span class="line">          <span class="attr">limits:</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">&quot;1&quot;</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">&quot;2Gi&quot;</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">data</span></span><br><span class="line">        <span class="attr">emptyDir:</span> &#123;&#125;</span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">prometheus-config</span></span><br><span class="line">        <span class="attr">configMap:</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">prometheus-config</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">prometheus</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">prometheus</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">monitor</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="comment"># type: NodePort</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">9090</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">9090</span></span><br><span class="line">    <span class="comment"># nodePort: 30090</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">prometheus</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">prometheus</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">monitor</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">kubernetes.io/ingress.class:</span> <span class="string">&quot;nginx&quot;</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/ssl-redirect:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">tls:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">hosts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">prometheus.i.com</span></span><br><span class="line">    <span class="attr">secretName:</span> <span class="string">i-com</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">prometheus.i.com</span></span><br><span class="line">    <span class="attr">http:</span></span><br><span class="line">      <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/</span></span><br><span class="line">        <span class="attr">pathType:</span> <span class="string">Prefix</span></span><br><span class="line">        <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">service:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">prometheus</span></span><br><span class="line">            <span class="attr">port:</span></span><br><span class="line">              <span class="attr">number:</span> <span class="number">9090</span></span><br></pre></td></tr></table></figure><p><code>configmap.yml</code></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">prometheus-config</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">monitor</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">web.yml:</span> <span class="string">|</span></span><br><span class="line"><span class="string">    basic_auth_users:</span></span><br><span class="line"><span class="string">      admin: $2y$05$UKSS18ztdsUNoEuXYScr2OE1TCMe1hWnmD6JuwUi/uPTJayHIakae</span></span><br><span class="line"><span class="string"></span>  <span class="attr">prometheus.yml:</span> <span class="string">|</span></span><br><span class="line"><span class="string">    global:</span></span><br><span class="line"><span class="string">      scrape_interval:     15s</span></span><br><span class="line"><span class="string">      evaluation_interval: 15s</span></span><br><span class="line"><span class="string">      </span></span><br><span class="line"><span class="string">      # å…¨å±€æ ‡ç­¾</span></span><br><span class="line"><span class="string">      external_labels:</span></span><br><span class="line"><span class="string">        env: prod</span></span><br><span class="line"><span class="string">        dept: ops</span></span><br><span class="line"><span class="string">        project: example</span></span><br><span class="line"><span class="string">        k8s: example</span></span><br><span class="line"><span class="string"></span></span><br><span class="line">    <span class="attr">scrape_configs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;apiservers&#x27;</span></span><br><span class="line">        <span class="attr">kubernetes_sd_configs:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">endpoints</span></span><br><span class="line">        <span class="attr">scheme:</span> <span class="string">https</span></span><br><span class="line">        <span class="attr">tls_config:</span></span><br><span class="line">          <span class="attr">ca_file:</span> <span class="string">/var/run/secrets/kubernetes.io/serviceaccount/ca.crt</span></span><br><span class="line">        <span class="attr">bearer_token_file:</span> <span class="string">/var/run/secrets/kubernetes.io/serviceaccount/token</span></span><br><span class="line">        <span class="attr">relabel_configs:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__meta_kubernetes_namespace</span>, <span class="string">__meta_kubernetes_service_name</span>, <span class="string">__meta_kubernetes_endpoint_port_name</span>]</span><br><span class="line">          <span class="attr">action:</span> <span class="string">keep</span></span><br><span class="line">          <span class="attr">regex:</span> <span class="string">default;kubernetes;https</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;cadvisor&#x27;</span></span><br><span class="line">        <span class="attr">kubernetes_sd_configs:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">node</span></span><br><span class="line">        <span class="attr">scheme:</span> <span class="string">https</span></span><br><span class="line">        <span class="attr">tls_config:</span></span><br><span class="line">          <span class="attr">ca_file:</span> <span class="string">/var/run/secrets/kubernetes.io/serviceaccount/ca.crt</span></span><br><span class="line">          <span class="attr">insecure_skip_verify:</span> <span class="literal">false</span></span><br><span class="line">        <span class="attr">bearer_token_file:</span> <span class="string">/var/run/secrets/kubernetes.io/serviceaccount/token</span></span><br><span class="line">        <span class="attr">relabel_configs:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">action:</span> <span class="string">labelmap</span></span><br><span class="line">          <span class="attr">regex:</span> <span class="string">__meta_kubernetes_node_label_(.+)</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">target_label:</span> <span class="string">__address__</span></span><br><span class="line">          <span class="attr">replacement:</span> <span class="string">kubernetes.default.svc:443</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__meta_kubernetes_node_name</span>]</span><br><span class="line">          <span class="attr">regex:</span> <span class="string">(.+)</span></span><br><span class="line">          <span class="attr">target_label:</span> <span class="string">__metrics_path__</span></span><br><span class="line">          <span class="attr">replacement:</span> <span class="string">/api/v1/nodes/$&#123;1&#125;/proxy/metrics/cadvisor</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&quot;kubelet&quot;</span></span><br><span class="line">        <span class="attr">honor_timestamps:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">scrape_interval:</span> <span class="string">1m</span></span><br><span class="line">        <span class="attr">scrape_timeout:</span> <span class="string">1m</span></span><br><span class="line">        <span class="attr">metrics_path:</span> <span class="string">/metrics</span></span><br><span class="line">        <span class="attr">scheme:</span> <span class="string">https</span></span><br><span class="line">        <span class="attr">kubernetes_sd_configs:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">node</span></span><br><span class="line">        <span class="attr">bearer_token_file:</span> <span class="string">/var/run/secrets/kubernetes.io/serviceaccount/token</span></span><br><span class="line">        <span class="attr">tls_config:</span></span><br><span class="line">          <span class="attr">ca_file:</span> <span class="string">/var/run/secrets/kubernetes.io/serviceaccount/ca.crt</span></span><br><span class="line">          <span class="attr">insecure_skip_verify:</span> <span class="literal">false</span></span><br><span class="line">        <span class="attr">relabel_configs:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">separator:</span> <span class="string">;</span></span><br><span class="line">          <span class="attr">regex:</span> <span class="string">__meta_kubernetes_node_label_(.+)</span></span><br><span class="line">          <span class="attr">replacement:</span> <span class="string">$1</span></span><br><span class="line">          <span class="attr">action:</span> <span class="string">labelmap</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">separator:</span> <span class="string">;</span></span><br><span class="line">          <span class="attr">regex:</span> <span class="string">(.*)</span></span><br><span class="line">          <span class="attr">target_label:</span> <span class="string">__address__</span></span><br><span class="line">          <span class="attr">replacement:</span> <span class="string">kubernetes.default.svc:443</span></span><br><span class="line">          <span class="attr">action:</span> <span class="string">replace</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__meta_kubernetes_node_name</span>]</span><br><span class="line">          <span class="attr">separator:</span> <span class="string">;</span></span><br><span class="line">          <span class="attr">regex:</span> <span class="string">(.+)</span></span><br><span class="line">          <span class="attr">target_label:</span> <span class="string">__metrics_path__</span></span><br><span class="line">          <span class="attr">replacement:</span> <span class="string">/api/v1/nodes/$&#123;1&#125;/proxy/metrics</span></span><br><span class="line">          <span class="attr">action:</span> <span class="string">replace</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;service_endpoints_metrics&#x27;</span></span><br><span class="line">        <span class="comment"># service éœ€è¦æ·»åŠ å…ƒæ•°æ® é€šå¸¸éœ€è¦æœ‰ /metrics æ¥å£è¿”å› prometheus æ•°æ®æ ¼å¼</span></span><br><span class="line">        <span class="comment"># prometheus.io/path: /metrics</span></span><br><span class="line">        <span class="comment"># prometheus.io/port: &quot;8080&quot;</span></span><br><span class="line">        <span class="comment"># prometheus.io/scrape: &quot;true&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="attr">kubernetes_sd_configs:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">endpoints</span></span><br><span class="line">        <span class="attr">relabel_configs:</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># å¸¦æ³¨è§£  prometheus.io/scrape: true  çš„æ‰ä¼šè¢«é‡‡é›†ï¼Œä¸ç„¶ä¸é‡‡é›†ï¼Œä¸å…¥åº“</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__meta_kubernetes_service_annotation_prometheus_io_scrape</span>]</span><br><span class="line">          <span class="attr">action:</span> <span class="string">keep</span></span><br><span class="line">          <span class="attr">regex:</span> <span class="literal">true</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__meta_kubernetes_service_annotation_prometheus_io_scheme</span>]</span><br><span class="line">          <span class="attr">action:</span> <span class="string">replace</span></span><br><span class="line">          <span class="attr">target_label:</span> <span class="string">__scheme__</span></span><br><span class="line">          <span class="attr">regex:</span> <span class="string">(https?)</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__meta_kubernetes_service_annotation_prometheus_io_path</span>]</span><br><span class="line">          <span class="attr">action:</span> <span class="string">replace</span></span><br><span class="line">          <span class="attr">target_label:</span> <span class="string">__metrics_path__</span></span><br><span class="line">          <span class="attr">regex:</span> <span class="string">(.+)</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__address__</span>, <span class="string">__meta_kubernetes_service_annotation_prometheus_io_port</span>]</span><br><span class="line">          <span class="attr">action:</span> <span class="string">replace</span></span><br><span class="line">          <span class="attr">target_label:</span> <span class="string">__address__</span></span><br><span class="line">          <span class="attr">regex:</span> <span class="string">([^:]+)(?::\d+)?;(\d+)</span></span><br><span class="line">          <span class="attr">replacement:</span> <span class="string">$1:$2</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">action:</span> <span class="string">labelmap</span></span><br><span class="line">          <span class="attr">regex:</span> <span class="string">__meta_kubernetes_service_label_(.+)</span></span><br></pre></td></tr></table></figure><blockquote><p>æ³¨ï¼šå¦‚æœéœ€è¦ç›‘æ§ pod çŠ¶æ€ï¼Œæ¯”å¦‚ pod é‡å¯æ¬¡æ•°ç­‰æ•°æ®ï¼Œéœ€è¦å®‰è£… <code>kube-state-metrics</code> å¹¶é€šè¿‡æœåŠ¡å‘ç°çš„æ–¹å¼å°†æ•°æ®æ¥å…¥åˆ° Prometheus</p></blockquote><h2 id="Kubernetes-ä¸­éƒ¨ç½²æ— é›†ç¾¤æƒé™çš„-Prometheus"><a href="#Kubernetes-ä¸­éƒ¨ç½²æ— é›†ç¾¤æƒé™çš„-Prometheus" class="headerlink" title="Kubernetes ä¸­éƒ¨ç½²æ— é›†ç¾¤æƒé™çš„ Prometheus"></a>Kubernetes ä¸­éƒ¨ç½²æ— é›†ç¾¤æƒé™çš„ Prometheus</h2><p>æœ‰çš„å®¢æˆ·ä¸ç»™é›†ç¾¤æƒé™ï¼Œæ¯”å¦‚ä¸€ä¸ªå¤§çš„ Kubernetes é›†ç¾¤ä¸­ï¼Œç»™åˆ†é…äº†ä¸€ä¸ª namespaceï¼Œå…¶ä»– namespace æ˜¯åˆ«äººçš„æœåŠ¡ï¼Œå½“ç„¶ä¸èƒ½ç»™ä½ å¾ˆé«˜çš„æƒé™ï¼Œæˆ–è€…æ˜¯ä¸ªå®šåˆ¶çš„æ§åˆ¶ç•Œé¢ï¼Œæ— æ³•è¿›è¡Œåˆ›å»º serviceaccount çš„æ“ä½œç­‰ã€‚è¿™æ ·åªèƒ½ç›‘æ§ä¸€äº›åŸºç¡€çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ service é€šä¸é€šï¼ˆé€šè¿‡ service åœ°å€æ¥ç›‘æ§ï¼‰ï¼Œç›‘æ§ä¸€äº›ä¸­é—´ä»¶çš„ç›‘æ§æ•°æ®ï¼ˆæ‰‹åŠ¨é…ç½® exporter çš„ service åœ°å€ï¼‰</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">global:</span></span><br><span class="line">  <span class="attr">scrape_interval:</span>     <span class="string">30s</span></span><br><span class="line">  <span class="attr">evaluation_interval:</span> <span class="string">30s</span></span><br><span class="line">  <span class="attr">external_labels:</span></span><br><span class="line">    <span class="attr">env:</span> <span class="string">prod</span></span><br><span class="line">    <span class="attr">dept:</span> <span class="string">ops</span></span><br><span class="line">    <span class="attr">project:</span> <span class="string">example</span></span><br><span class="line">    <span class="attr">k8s:</span> <span class="string">example</span></span><br><span class="line"></span><br><span class="line"><span class="attr">scrape_configs:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&quot;mysql_instance&quot;</span></span><br><span class="line">  <span class="attr">static_configs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;mysql-exporter:9104&#x27;</span>]</span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">prod_example_mysql</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&quot;redis_instance&quot;</span></span><br><span class="line">  <span class="attr">static_configs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;redis-exporter:9121&#x27;</span>]</span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">prod_example_redis</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&quot;port&quot;</span></span><br><span class="line">  <span class="attr">scrape_interval:</span> <span class="string">20s</span></span><br><span class="line">  <span class="attr">params:</span></span><br><span class="line">    <span class="attr">module:</span> [<span class="string">tcp_connect</span>]</span><br><span class="line">  <span class="attr">metrics_path:</span> <span class="string">/probe</span></span><br><span class="line">  <span class="attr">scheme:</span> <span class="string">http</span></span><br><span class="line">  <span class="attr">static_configs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;10.133.103.171:6379&#x27;</span>]</span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">redis</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;10.133.103.170:3306&#x27;</span>]</span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">mysql</span></span><br><span class="line">  <span class="attr">relabel_configs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__address__</span>]</span><br><span class="line">      <span class="attr">target_label:</span> <span class="string">__param_target</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__param_target</span>]</span><br><span class="line">      <span class="attr">target_label:</span> <span class="string">addr</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__param_target</span>]</span><br><span class="line">      <span class="attr">action:</span> <span class="string">replace</span></span><br><span class="line">      <span class="attr">regex:</span> <span class="string">(.+):(.*)</span></span><br><span class="line">      <span class="attr">replacement:</span> <span class="string">$2</span></span><br><span class="line">      <span class="attr">target_label:</span> <span class="string">port</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">target_label:</span> <span class="string">__address__</span></span><br><span class="line">      <span class="attr">replacement:</span> <span class="string">&quot;blackbox-exporter:9115&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿™é‡Œæ‰‹åŠ¨é…ç½®çš„serviceè¯·æ±‚åœ°å€</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&quot;http_get&quot;</span></span><br><span class="line">  <span class="attr">scrape_interval:</span> <span class="string">20s</span></span><br><span class="line">  <span class="attr">metrics_path:</span> <span class="string">/probe</span></span><br><span class="line">  <span class="attr">scheme:</span> <span class="string">http</span></span><br><span class="line">  <span class="attr">params:</span></span><br><span class="line">    <span class="attr">module:</span> [<span class="string">http_2xx</span>]</span><br><span class="line">  <span class="attr">static_configs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;prod-idk-mob-sdk-server:5003/actuator/info&#x27;</span>]</span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">idk-mob-sdk-server</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;prod-public-hsm-services:8007/hsm/actuator/health&#x27;</span>]</span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">public-hsm-services</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">relabel_configs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__address__</span>]</span><br><span class="line">      <span class="attr">target_label:</span> <span class="string">__param_target</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__param_target</span>]</span><br><span class="line">      <span class="attr">target_label:</span> <span class="string">instance</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">target_label:</span> <span class="string">__address__</span></span><br><span class="line">      <span class="attr">replacement:</span> <span class="string">&quot;blackbox-exporter:9115&quot;</span></span><br></pre></td></tr></table></figure><h2 id="è™šæ‹Ÿæœºéƒ¨ç½²"><a href="#è™šæ‹Ÿæœºéƒ¨ç½²" class="headerlink" title="è™šæ‹Ÿæœºéƒ¨ç½²"></a>è™šæ‹Ÿæœºéƒ¨ç½²</h2><p>ç±»ä¼¼äºä¸Šé¢çš„ Kubernetes ä¸­éƒ¨ç½²çš„æ— æƒé™ Prometheus</p><h2 id="æ²¡æœ‰å…¬ç½‘åŸŸåçš„-Prometheus"><a href="#æ²¡æœ‰å…¬ç½‘åŸŸåçš„-Prometheus" class="headerlink" title="æ²¡æœ‰å…¬ç½‘åŸŸåçš„ Prometheus"></a>æ²¡æœ‰å…¬ç½‘åŸŸåçš„ Prometheus</h2><p>æ²¡æœ‰å…¬ç½‘åŸŸåæ„å‘³ç€æ— æ³•é€šè¿‡ Prometheus Core æ¥æ‹‰å–ï¼ˆè”é‚¦ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ remote write è¿œç¨‹å†™çš„æ–¹å¼å†™å…¥åˆ°ç›®æ ‡çš„ Prometheus Core ä¸­</p><p><code>vim prometheus.yml</code></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">remote_write:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">url:</span> <span class="string">&quot;https://prometheus.example.com/api/v1/write&quot;</span></span><br><span class="line">  <span class="attr">basic_auth:</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">admin</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">password</span></span><br><span class="line">  <span class="attr">remote_timeout:</span> <span class="string">30s</span></span><br><span class="line">  <span class="attr">tls_config:</span></span><br><span class="line">    <span class="attr">insecure_skip_verify:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">queue_config:</span></span><br><span class="line">    <span class="attr">capacity:</span> <span class="number">2000</span></span><br><span class="line">    <span class="attr">max_shards:</span> <span class="number">1000</span></span><br><span class="line">    <span class="attr">min_shards:</span> <span class="number">1</span></span><br><span class="line">    <span class="attr">max_samples_per_send:</span> <span class="number">1000</span></span><br><span class="line">    <span class="attr">batch_send_deadline:</span> <span class="string">5s</span></span><br><span class="line">    <span class="attr">min_backoff:</span> <span class="string">30ms</span></span><br><span class="line">    <span class="attr">max_backoff:</span> <span class="string">100ms</span></span><br></pre></td></tr></table></figure><h3 id="è¿œç¨‹å†™-Prometheus-è‡ªèº«æŒ‚æ‰å¦‚ä½•ç›‘æ§"><a href="#è¿œç¨‹å†™-Prometheus-è‡ªèº«æŒ‚æ‰å¦‚ä½•ç›‘æ§" class="headerlink" title="è¿œç¨‹å†™ Prometheus è‡ªèº«æŒ‚æ‰å¦‚ä½•ç›‘æ§"></a>è¿œç¨‹å†™ Prometheus è‡ªèº«æŒ‚æ‰å¦‚ä½•ç›‘æ§</h3><p>ä½¿ç”¨ absent å‡½æ•°æ¥åšåˆ¤æ–­ å…·ä½“å¯ä»¥çœ‹ <a href="/posts/666e547f/">Prometheusé€šè¿‡remote_writeå†™å…¥æ•°æ®åˆ°å¦ä¸€å°Prometheus</a></p><h2 id="basicauth-è®¤è¯"><a href="#basicauth-è®¤è¯" class="headerlink" title="basicauth è®¤è¯"></a>basicauth è®¤è¯</h2><p>å…³äºè®¤è¯ï¼Œå¯ä»¥çœ‹ <a href="/posts/165a0cd3/">Prometheuså¼€å¯basic_authè®¤è¯</a></p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;p&gt;æ¯”å¦‚æœ‰ 30 å®¶å®¢æˆ·ï¼Œæ¯ä¸€ä¸ªå®¢æˆ·éƒ½æœ‰è‡ªå·±çš„ Kubernetes é›†ç¾¤ï¼Œéƒ¨ç½²æ–¹å¼åƒå·®ä¸‡åˆ«ï¼Œè¿˜æœ‰å®¢æˆ·ä¸ä½¿ç”¨ Kubernetes çš„ï¼Œä½¿ç”¨è™šæ‹Ÿæœºéƒ¨ç½²ï¼Œé‚£ä¹ˆæ€ä¹ˆå¯¹è¿™ä¹ˆå¤šå®¢æˆ·çš„æœºå™¨ã€æœåŠ¡è¿›è¡Œæœ‰æ•ˆçš„ç›‘æ§ï¼Œæœ¬æ–‡è®°å½•ä¸€ä¸‹ç›‘æ§çš„æ¶æ„æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;h2 id=&quot;ç›‘æ§æ¶æ„å›¾&quot;&gt;&lt;a href=&quot;#ç›‘æ§æ¶æ„å›¾&quot; class=&quot;headerlink&quot;</summary>
        
      
    
    
    
    <category term="ç›‘æ§" scheme="https://zahui.fan/categories/%E7%9B%91%E6%8E%A7/"/>
    
    
    <category term="prometheus" scheme="https://zahui.fan/tags/prometheus/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨snmp exporterå¯¹äº¤æ¢æœºã€æœåŠ¡å™¨ç­‰è¿›è¡Œç›‘æ§</title>
    <link href="https://zahui.fan/posts/smz2c9/"/>
    <id>https://zahui.fan/posts/smz2c9/</id>
    <published>2024-11-15T03:14:33.000Z</published>
    <updated>2024-11-29T04:26:41.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>åˆ° GitHub ä¸‹è½½ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œç›´æ¥è¿è¡Œå³å¯ï¼Œæˆ–è€…ä½¿ç”¨ systemd æ¥è¿è¡Œï¼Œä¹Ÿå¯ä»¥ç›´æ¥éƒ¨ç½²åˆ° Kubernetes ä¸­ã€‚<br><a href="https://github.com/prometheus/snmp_exporter">https://github.com/prometheus/snmp_exporter</a></p><p>systemd é…ç½®ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Unit]</span></span><br><span class="line"><span class="attr">Description</span>=snmp_exporter</span><br><span class="line"><span class="attr">After</span>=network.target</span><br><span class="line"></span><br><span class="line"><span class="section">[Service]</span></span><br><span class="line"><span class="attr">ExecStart</span>=/opt/snmp_exporter/snmp_exporter --config.file=/opt/snmp_exporter/snmp.yml</span><br><span class="line"><span class="attr">Restart</span>=<span class="literal">on</span>-failure</span><br><span class="line"></span><br><span class="line"><span class="section">[Install]</span></span><br><span class="line"><span class="attr">WantedBy</span>=multi-user.target</span><br></pre></td></tr></table></figure><h2 id="äº¤æ¢æœºæˆ–æœåŠ¡å™¨æ‰“å¼€-snmp-åè®®"><a href="#äº¤æ¢æœºæˆ–æœåŠ¡å™¨æ‰“å¼€-snmp-åè®®" class="headerlink" title="äº¤æ¢æœºæˆ–æœåŠ¡å™¨æ‰“å¼€ snmp åè®®"></a>äº¤æ¢æœºæˆ–æœåŠ¡å™¨æ‰“å¼€ snmp åè®®</h2><p>è¿™ä¸€æ­¥éœ€è¦åœ¨äº¤æ¢æœºæˆ–æœåŠ¡å™¨çš„ ipmi ä¸Šé…ç½®ï¼Œäº¤æ¢æœºè¿™ç§ç½‘ç»œè®¾å¤‡ä¸€èˆ¬éƒ½åªæ”¯æŒ snmp åè®®æ¥è·å–æ•°æ®ï¼Œæ¯”å¦‚è¯´æ¯ä¸ªæ¥å£çš„çŠ¶æ€ï¼ˆæœ‰æ²¡æœ‰æ’ç½‘çº¿ç­‰ï¼‰<br>å¯¹äºæœåŠ¡å™¨ï¼Œåƒ cpu å ç”¨ç‡ã€å†…å­˜ä½¿ç”¨ç‡è¿™äº›æ•°æ®ä½¿ç”¨ node_exporter å°±å¯ä»¥åšï¼Œä¸ºå•¥è¿˜è¦ä½¿ç”¨ snmp_exporter å‘¢ï¼Œsnmp_exporter å¯ä»¥åšåˆ°ä¸€äº›åº•å±‚çš„ç›‘æ§ï¼Œæ¯”å¦‚è¯´ï¼šé£æ‰‡è½¬é€Ÿã€ç”µæºæ˜¯å¦æœ‰æŸåçš„ï¼ˆä¸€èˆ¬æœåŠ¡å™¨éƒ½æœ‰å¤šä¸ªç”µæºæ¨¡å—ï¼‰ã€æ¸©åº¦æƒ…å†µã€ç£ç›˜é˜µåˆ—çŠ¶æ€ï¼ˆæ˜¯å¦æœ‰ç¡¬ç›˜åæ‰äº†ï¼Œæ¯”å¦‚åšäº† raid1ï¼Œåäº†ä¸€å—ç¡¬ç›˜åœ¨è½¯ä»¶å±‚é¢æ˜¯æ— æ„ŸçŸ¥çš„ï¼Œä½†æ˜¯éœ€è¦åŠæ—¶æ›´æ¢ç¡¬ç›˜äº†ã€‚ï¼‰</p><p>æ‰“å¼€ snmp åè®®åï¼Œéœ€è¦è®¾ç½®å¹¶è®°å½•ä¸€ä¸‹å›¢ä½“åã€‚</p><p>æµ‹è¯• snmp å‘½ä»¤ç¤ºä¾‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">snmpwalk -v 2c -c 123456 100.200.1.254</span><br><span class="line">snmpwalk -v 2c -c 123456 172.18.48.5 1.3.6.1.2.1.47.1.1.1.1.7</span><br><span class="line">snmpwalk -v3 -u sysadmin -a MD5 -A rootuser -x DES -X rootuser -l authpriv 100.200.1.24</span><br></pre></td></tr></table></figure><h2 id="ç”Ÿæˆé…ç½®æ–‡ä»¶"><a href="#ç”Ÿæˆé…ç½®æ–‡ä»¶" class="headerlink" title="ç”Ÿæˆé…ç½®æ–‡ä»¶"></a>ç”Ÿæˆé…ç½®æ–‡ä»¶</h2><p>snmp exporter å¼€æºè½¯ä»¶ä¸­æœ‰ä¸ª snmp generator ï¼Œå¯ä»¥ç”¨äºç”Ÿæˆ snmp exporter çš„é…ç½®æ–‡ä»¶ã€‚<br>é…ç½®æ–‡ä»¶ä¸­æ ¹æ®ç¡¬ä»¶çš„ MIB æ–‡ä»¶ç”Ÿæˆäº† OID çš„æ˜ å°„å…³ç³»ã€‚ä»¥ Cisco äº¤æ¢æœºä¸ºä¾‹ï¼Œåœ¨å®˜æ–¹ GitHub ä¸Šä¸‹è½½æœ€æ–°çš„ <strong>snmp.yml</strong> æ–‡ä»¶ï¼Œç”±äº Cisco äº¤æ¢æœºä½¿ç”¨çš„æ˜¯ if_mib æ¨¡å—ï¼Œåœ¨ if_mib ä¸‹æ–°å¢ auth é…ç½®ï¼Œå›¢ä½“åè¦å’Œäº¤æ¢æœºä¸Šé…ç½®çš„ä¸€è‡´ã€‚<br>æ ¹æ® mib æ–‡ä»¶ç”Ÿæˆ yaml é…ç½®æ–‡ä»¶å·¥å…·ï¼š<a href="https://github.com/prometheus/snmp_exporter/tree/main/generator">https://github.com/prometheus/snmp_exporter/tree/main/generator</a><br>å…³äºé‡‡é›†çš„ç›‘æ§é¡¹æ˜¯åœ¨ walk å­—æ®µä¸‹ï¼Œå¦‚æœè¦æ–°å¢ç›‘æ§é¡¹ï¼Œå†™åœ¨ walk é¡¹ä¸‹ã€‚æˆ‘æ–°å¢äº†äº¤æ¢æœºçš„ CPU å’Œå†…å­˜ä¿¡æ¯ã€‚å®˜æ–¹ç¤ºä¾‹ä¸­çš„ if_mib è¿™ä¸ªæ˜¯ module åå­—ï¼Œ if_mib æ˜¯ä¸ªç½‘ç»œè®¾å¤‡çš„è§„èŒƒï¼ŒRFC1573</p><h3 id="H3C-äº¤æ¢æœºé…ç½®ç¤ºä¾‹"><a href="#H3C-äº¤æ¢æœºé…ç½®ç¤ºä¾‹" class="headerlink" title="H3C äº¤æ¢æœºé…ç½®ç¤ºä¾‹"></a>H3C äº¤æ¢æœºé…ç½®ç¤ºä¾‹</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># WARNING: This file was auto-generated using snmp_exporter generator, manual changes will be lost.</span></span><br><span class="line"><span class="attr">H3C:</span></span><br><span class="line">  <span class="attr">walk:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span>                     <span class="comment">#ç«¯å£æè¿°</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span><span class="number">.2</span><span class="number">.1</span><span class="number">.8</span>                     <span class="comment">#ç«¯å£çŠ¶æ€ 1upï¼Œ2down</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.31</span><span class="number">.1</span><span class="number">.1</span><span class="number">.1</span><span class="number">.1</span>                  <span class="comment">#ç«¯å£åç§°</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.31</span><span class="number">.1</span><span class="number">.1</span><span class="number">.1</span><span class="number">.18</span>                 <span class="comment">#ç«¯å£åˆ«å</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.25506</span><span class="number">.2</span><span class="number">.40</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span><span class="number">.3</span><span class="number">.1</span><span class="number">.5</span>      <span class="comment">#H3Cç«¯å£è¿›æµé‡</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.25506</span><span class="number">.2</span><span class="number">.40</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span><span class="number">.3</span><span class="number">.1</span><span class="number">.6</span>      <span class="comment">#H3Cç«¯å£å‡ºæµé‡</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.25506</span><span class="number">.8</span><span class="number">.35</span><span class="number">.18</span><span class="number">.4</span><span class="number">.3</span><span class="number">.1</span><span class="number">.13</span>      <span class="comment">#å†…å­˜åˆ©ç”¨ç‡</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.25506</span><span class="number">.8</span><span class="number">.35</span><span class="number">.18</span><span class="number">.4</span><span class="number">.3</span><span class="number">.1</span><span class="number">.4</span>       <span class="comment">#CPUåˆ©ç”¨ç‡</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.25506</span><span class="number">.8</span><span class="number">.35</span><span class="number">.9</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span>        <span class="comment">#ç”µæºçŠ¶æ€</span></span><br><span class="line">  <span class="attr">get:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.1</span><span class="number">.0</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.3</span><span class="number">.0</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.5</span><span class="number">.0</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.25506</span><span class="number">.8</span><span class="number">.35</span><span class="number">.18</span><span class="number">.1</span><span class="number">.1</span><span class="number">.0</span></span><br><span class="line">  <span class="attr">metrics:</span></span><br><span class="line">  <span class="comment"># è¿™é‡Œçš„nameå°±æ˜¯æ”¶é›†åˆ°çš„æŒ‡æ ‡çš„åå­—</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">sysDescr</span></span><br><span class="line">    <span class="attr">oid:</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">DisplayString</span></span><br><span class="line">    <span class="attr">help:</span> <span class="string">A</span> <span class="string">textual</span> <span class="string">description</span> <span class="string">of</span> <span class="string">the</span> <span class="string">entity</span> <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">sysUpTime</span></span><br><span class="line">    <span class="attr">oid:</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.3</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">gauge</span></span><br><span class="line">    <span class="attr">help:</span> <span class="string">The</span> <span class="string">time</span> <span class="string">(in</span> <span class="string">hundredths</span> <span class="string">of</span> <span class="string">a</span> <span class="string">second)</span> <span class="string">since</span> <span class="string">the</span> <span class="string">network</span> <span class="string">management</span> <span class="string">portion</span></span><br><span class="line">      <span class="string">of</span> <span class="string">the</span> <span class="string">system</span> <span class="string">was</span> <span class="string">last</span> <span class="string">re-initialized.</span> <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.3</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">sysName</span></span><br><span class="line">    <span class="attr">oid:</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.5</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">DisplayString</span></span><br><span class="line">    <span class="attr">help:</span> <span class="string">An</span> <span class="string">administratively-assigned</span> <span class="string">name</span> <span class="string">for</span> <span class="string">this</span> <span class="string">managed</span> <span class="string">node</span> <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.5</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">ifOperStatus</span></span><br><span class="line">    <span class="attr">oid:</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span><span class="number">.2</span><span class="number">.1</span><span class="number">.8</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">gauge</span></span><br><span class="line">    <span class="attr">help:</span> <span class="string">The</span> <span class="string">current</span> <span class="string">operational</span> <span class="string">state</span> <span class="string">of</span> <span class="string">the</span> <span class="string">interface</span> <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span><span class="number">.2</span><span class="number">.1</span><span class="number">.8</span></span><br><span class="line">    <span class="attr">indexes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">labelname:</span> <span class="string">ifIndex</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">gauge</span></span><br><span class="line">    <span class="attr">lookups:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">labels:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ifIndex</span></span><br><span class="line">      <span class="attr">labelname:</span> <span class="string">ifAlias</span></span><br><span class="line">      <span class="attr">oid:</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.31</span><span class="number">.1</span><span class="number">.1</span><span class="number">.1</span><span class="number">.18</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">DisplayString</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">labels:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ifIndex</span></span><br><span class="line">      <span class="attr">labelname:</span> <span class="string">ifDescr</span></span><br><span class="line">      <span class="attr">oid:</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">DisplayString</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">labels:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ifIndex</span></span><br><span class="line">      <span class="attr">labelname:</span> <span class="string">ifName</span></span><br><span class="line">      <span class="attr">oid:</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.31</span><span class="number">.1</span><span class="number">.1</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">DisplayString</span></span><br><span class="line">    <span class="attr">enum_values:</span></span><br><span class="line">      <span class="attr">1:</span> <span class="string">up</span></span><br><span class="line">      <span class="attr">2:</span> <span class="string">down</span></span><br><span class="line">      <span class="attr">3:</span> <span class="string">testing</span></span><br><span class="line">      <span class="attr">4:</span> <span class="string">unknown</span></span><br><span class="line">      <span class="attr">5:</span> <span class="string">dormant</span></span><br><span class="line">      <span class="attr">6:</span> <span class="string">notPresent</span></span><br><span class="line">      <span class="attr">7:</span> <span class="string">lowerLayerDown</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">hh3cIfStatFlowHCInBytes</span></span><br><span class="line">    <span class="attr">oid:</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.25506</span><span class="number">.2</span><span class="number">.40</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span><span class="number">.3</span><span class="number">.1</span><span class="number">.5</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">counter</span></span><br><span class="line">    <span class="attr">help:</span> <span class="string">In</span> <span class="string">bytes</span> <span class="string">in</span> <span class="string">the</span> <span class="string">specified</span> <span class="string">interval</span> <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.25506</span><span class="number">.2</span><span class="number">.40</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span><span class="number">.3</span><span class="number">.1</span><span class="number">.5</span></span><br><span class="line">    <span class="attr">indexes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">labelname:</span> <span class="string">ifIndex</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">gauge</span></span><br><span class="line">    <span class="attr">lookups:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">labels:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ifIndex</span></span><br><span class="line">      <span class="attr">labelname:</span> <span class="string">ifAlias</span></span><br><span class="line">      <span class="attr">oid:</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.31</span><span class="number">.1</span><span class="number">.1</span><span class="number">.1</span><span class="number">.18</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">DisplayString</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">labels:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ifIndex</span></span><br><span class="line">      <span class="attr">labelname:</span> <span class="string">ifDescr</span></span><br><span class="line">      <span class="attr">oid:</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">DisplayString</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">labels:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ifIndex</span></span><br><span class="line">      <span class="attr">labelname:</span> <span class="string">ifName</span></span><br><span class="line">      <span class="attr">oid:</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.31</span><span class="number">.1</span><span class="number">.1</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">DisplayString</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">hh3cIfStatFlowHCOutBytes</span></span><br><span class="line">    <span class="attr">oid:</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.25506</span><span class="number">.2</span><span class="number">.40</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span><span class="number">.3</span><span class="number">.1</span><span class="number">.6</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">counter</span></span><br><span class="line">    <span class="attr">help:</span> <span class="string">Out</span> <span class="string">bytes</span> <span class="string">in</span> <span class="string">the</span> <span class="string">specified</span> <span class="string">interval</span> <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.25506</span><span class="number">.2</span><span class="number">.40</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span><span class="number">.3</span><span class="number">.1</span><span class="number">.6</span></span><br><span class="line">    <span class="attr">indexes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">labelname:</span> <span class="string">ifIndex</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">gauge</span></span><br><span class="line">    <span class="attr">lookups:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">labels:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ifIndex</span></span><br><span class="line">      <span class="attr">labelname:</span> <span class="string">ifAlias</span></span><br><span class="line">      <span class="attr">oid:</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.31</span><span class="number">.1</span><span class="number">.1</span><span class="number">.1</span><span class="number">.18</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">DisplayString</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">labels:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ifIndex</span></span><br><span class="line">      <span class="attr">labelname:</span> <span class="string">ifDescr</span></span><br><span class="line">      <span class="attr">oid:</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">DisplayString</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">labels:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ifIndex</span></span><br><span class="line">      <span class="attr">labelname:</span> <span class="string">ifName</span></span><br><span class="line">      <span class="attr">oid:</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.31</span><span class="number">.1</span><span class="number">.1</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">DisplayString</span>  </span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">hh3cLswSysIpAddr</span></span><br><span class="line">    <span class="attr">oid:</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.25506</span><span class="number">.8</span><span class="number">.35</span><span class="number">.18</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">InetAddressIPv4</span></span><br><span class="line">    <span class="attr">help:</span> <span class="string">System</span> <span class="string">IP</span> <span class="string">address,</span> <span class="string">which</span> <span class="string">is</span> <span class="string">the</span> <span class="string">primary</span> <span class="string">IP</span> <span class="string">address</span> <span class="string">of</span> <span class="string">the</span> <span class="string">VLAN</span> <span class="string">interface</span></span><br><span class="line">      <span class="string">that</span> <span class="string">has</span> <span class="string">smallest</span> <span class="string">VLAN</span> <span class="string">ID</span> <span class="string">and</span> <span class="string">is</span> <span class="string">configured</span> <span class="string">IP</span> <span class="string">address.</span> <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.25506</span><span class="number">.8</span><span class="number">.35</span><span class="number">.18</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">hh3cLswSlotMemoryRatio</span></span><br><span class="line">    <span class="attr">oid:</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.25506</span><span class="number">.8</span><span class="number">.35</span><span class="number">.18</span><span class="number">.4</span><span class="number">.3</span><span class="number">.1</span><span class="number">.13</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">gauge</span></span><br><span class="line">    <span class="attr">help:</span> <span class="string">The</span> <span class="string">percentage</span> <span class="string">of</span> <span class="string">system</span> <span class="string">memory</span> <span class="string">in</span> <span class="string">use</span> <span class="string">on</span> <span class="string">the</span> <span class="string">board</span> <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.25506</span><span class="number">.8</span><span class="number">.35</span><span class="number">.18</span><span class="number">.4</span><span class="number">.3</span><span class="number">.1</span><span class="number">.13</span></span><br><span class="line">    <span class="attr">indexes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">labelname:</span> <span class="string">hh3cLswFrameIndex</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">gauge</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">labelname:</span> <span class="string">hh3cLswSlotIndex</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">gauge</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">hh3cLswSlotCpuRatio</span></span><br><span class="line">    <span class="attr">oid:</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.25506</span><span class="number">.8</span><span class="number">.35</span><span class="number">.18</span><span class="number">.4</span><span class="number">.3</span><span class="number">.1</span><span class="number">.4</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">gauge</span></span><br><span class="line">    <span class="attr">help:</span> <span class="string">CPU</span> <span class="string">usage</span> <span class="string">of</span> <span class="string">the</span> <span class="string">slot</span> <span class="string">in</span> <span class="string">accuracy</span> <span class="string">of</span> <span class="number">1</span><span class="string">%,</span> <span class="string">and</span> <span class="string">the</span> <span class="string">range</span> <span class="string">of</span> <span class="string">value</span> <span class="string">is</span> <span class="number">1</span> <span class="string">to</span></span><br><span class="line">      <span class="number">100</span><span class="string">.</span> <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.25506</span><span class="number">.8</span><span class="number">.35</span><span class="number">.18</span><span class="number">.4</span><span class="number">.3</span><span class="number">.1</span><span class="number">.4</span></span><br><span class="line">    <span class="attr">indexes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">labelname:</span> <span class="string">hh3cLswFrameIndex</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">gauge</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">labelname:</span> <span class="string">hh3cLswSlotIndex</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">gauge</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">hh3cDevMPowerStatus</span></span><br><span class="line">    <span class="attr">oid:</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.25506</span><span class="number">.8</span><span class="number">.35</span><span class="number">.9</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">gauge</span></span><br><span class="line">    <span class="attr">help:</span> <span class="string">&#x27;Power status: active (1), deactive (2) not installed (3) and unsupported</span></span><br><span class="line"><span class="string">      - 1.3.6.1.4.1.25506.8.35.9.1.2.1.2&#x27;</span></span><br><span class="line">    <span class="attr">indexes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">labelname:</span> <span class="string">hh3cDevMPowerNum</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">gauge</span></span><br><span class="line">    <span class="attr">enum_values:</span></span><br><span class="line">      <span class="attr">1:</span> <span class="string">active</span></span><br><span class="line">      <span class="attr">2:</span> <span class="string">deactive</span></span><br><span class="line">      <span class="attr">3:</span> <span class="string">not-install</span></span><br><span class="line">      <span class="attr">4:</span> <span class="string">unsupport</span></span><br><span class="line">  <span class="attr">version:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">max_repetitions:</span> <span class="number">25</span></span><br><span class="line">  <span class="attr">retries:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">timeout:</span> <span class="string">60s</span></span><br><span class="line">  <span class="attr">auth:</span></span><br><span class="line">    <span class="attr">community:</span> <span class="number">123456</span></span><br></pre></td></tr></table></figure><h3 id="æµªæ½®æœåŠ¡å™¨é…ç½®ç¤ºä¾‹"><a href="#æµªæ½®æœåŠ¡å™¨é…ç½®ç¤ºä¾‹" class="headerlink" title="æµªæ½®æœåŠ¡å™¨é…ç½®ç¤ºä¾‹"></a>æµªæ½®æœåŠ¡å™¨é…ç½®ç¤ºä¾‹</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># WARNING: This file was auto-generated using snmp_exporter generator, manual changes will be lost.</span></span><br><span class="line"><span class="attr">Inspur:</span></span><br><span class="line">  <span class="attr">walk:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.37945</span><span class="number">.2</span><span class="number">.1</span><span class="number">.5</span><span class="number">.1</span><span class="number">.1</span><span class="number">.3</span><span class="number">.19</span><span class="number">.9</span><span class="number">.65</span><span class="number">.115</span><span class="number">.115</span><span class="number">.101</span><span class="number">.116</span><span class="number">.32</span><span class="number">.84</span><span class="number">.97</span><span class="number">.103</span> <span class="comment">#æœºå™¨fruä¿¡æ¯</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.37945</span><span class="number">.2</span><span class="number">.3</span><span class="number">.1</span><span class="number">.1</span><span class="number">.1</span><span class="number">.3</span> <span class="comment">#ç”µæºæ¨¡å—PSUå½“å‰åœ¨ä½çŠ¶æ€</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.37945</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.1</span><span class="number">.1</span><span class="number">.1</span><span class="number">.3</span> <span class="comment">#CPUçŠ¶æ€</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.37945</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.3</span> <span class="comment">#ç”µå‹sensorå¥åº·çŠ¶æ€,0-N/A;1-Normal;2-Warning;3-Critical</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.37945</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.1</span><span class="number">.3</span> <span class="comment">#æ¸©åº¦sensorçš„å¥åº·çŠ¶æ€,0-N/A;1-Normal;2-Warning;3-Critical</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.37945</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span><span class="number">.3</span><span class="number">.1</span><span class="number">.1</span><span class="number">.3</span> <span class="comment">#é£æ‰‡è½¬é€Ÿ,0-N/A;1-Normal;2-Warning;3-Critical</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.37945</span><span class="number">.2</span><span class="number">.1</span><span class="number">.3</span><span class="number">.1</span><span class="number">.1</span><span class="number">.1</span><span class="number">.4</span> <span class="comment">#å‰ç½®ç¡¬ç›˜çŠ¶æ€ 0-N/A;1-Normal;2-Warning;3-Critical</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.37945</span><span class="number">.2</span><span class="number">.1</span><span class="number">.6</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.9</span> <span class="comment">#ç¡¬ç›˜çŠ¶æ€ç›‘æ§ä¿¡æ¯(é©±åŠ¨å™¨æ’æ§½)</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.37945</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.6</span><span class="number">.1</span><span class="number">.1</span><span class="number">.9</span> <span class="comment">#ç”µæºpower 0-N/A;1-Normal;2-Warning;3-Critical</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.37945</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span><span class="number">.5</span><span class="number">.1</span><span class="number">.1</span><span class="number">.3</span> <span class="comment">#å†…å­˜ç›‘æ§ 0-N/A;1-Normal;2-Warning;3-Critical</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.37945</span><span class="number">.2</span><span class="number">.1</span><span class="number">.6</span><span class="number">.3</span><span class="number">.1</span><span class="number">.1</span><span class="number">.4</span> <span class="comment">#raidç±»å‹,æ¯”å¦‚raid1 raid5 raid10</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.37945</span><span class="number">.2</span><span class="number">.1</span><span class="number">.6</span><span class="number">.3</span><span class="number">.1</span><span class="number">.1</span><span class="number">.2</span> <span class="comment">#Raidå¡å¥åº·çŠ¶æ€ä¿¡æ¯, &quot;Absent&quot;,&quot;Normal&quot;,&quot;Critical&quot;,&quot;N/A&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.37945</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span><span class="number">.14</span><span class="number">.1</span><span class="number">.1</span><span class="number">.5</span> <span class="comment">#ç½‘å¡å¥åº·çŠ¶æ€ï¼Œæ˜¾ç¤ºä¸º&quot;Normal&quot;,&quot;Warning&quot;,&quot;Critical&quot;,&quot;N/A&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">metrics:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">serverFRUInfoSetupAttributeValue</span>  <span class="comment">#æœºå™¨fruä¿¡æ¯:åºåˆ—å·</span></span><br><span class="line">    <span class="attr">oid:</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.37945</span><span class="number">.2</span><span class="number">.1</span><span class="number">.5</span><span class="number">.1</span><span class="number">.1</span><span class="number">.3</span><span class="number">.19</span><span class="number">.9</span><span class="number">.65</span><span class="number">.115</span><span class="number">.115</span><span class="number">.101</span><span class="number">.116</span><span class="number">.32</span><span class="number">.84</span><span class="number">.97</span><span class="number">.103</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">DisplayString</span></span><br><span class="line">    <span class="attr">help:</span> <span class="string">The</span> <span class="string">serverFRUInfoSetupAttributeValue</span> <span class="string">of</span> <span class="string">this</span> <span class="string">conceptual</span> <span class="string">row.</span> <span class="bullet">-</span> <span class="string">æœºå™¨fru</span> <span class="string">åºåˆ—å·ä¿¡æ¯</span></span><br><span class="line">    <span class="attr">indexes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">labelname:</span> <span class="string">inspur</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">gauge</span></span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">serverPowerSupplyMonitorPresent</span>  <span class="comment">#ç”µæºæ¨¡å—PSUå½“å‰åœ¨ä½çŠ¶æ€</span></span><br><span class="line">    <span class="attr">oid:</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.37945</span><span class="number">.2</span><span class="number">.3</span><span class="number">.1</span><span class="number">.1</span><span class="number">.1</span><span class="number">.3</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">DisplayString</span></span><br><span class="line">    <span class="attr">help:</span> <span class="string">The</span> <span class="string">serverPowerSupplyMonitorPresent</span> <span class="string">of</span> <span class="string">this</span> <span class="string">conceptual</span> <span class="string">row.</span> <span class="bullet">-</span> <span class="string">ç”µæºæ¨¡å—PSUå½“å‰åœ¨ä½çŠ¶æ€</span></span><br><span class="line">    <span class="attr">indexes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">labelname:</span> <span class="string">inspur</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">gauge</span></span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">serverCPUInfoPresent</span>  <span class="comment">#CPUå½“å‰åœ¨ä½çŠ¶æ€</span></span><br><span class="line">    <span class="attr">oid:</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.37945</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.1</span><span class="number">.1</span><span class="number">.1</span><span class="number">.3</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">DisplayString</span></span><br><span class="line">    <span class="attr">help:</span> <span class="string">The</span> <span class="string">serverCPUInfoPresent</span> <span class="string">of</span> <span class="string">this</span> <span class="string">conceptual</span> <span class="string">row.</span> <span class="bullet">-</span> <span class="string">CPUå½“å‰åœ¨ä½çŠ¶æ€</span></span><br><span class="line">    <span class="attr">indexes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">labelname:</span> <span class="string">inspur</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">gauge</span></span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">serverRaidDiskInfoVolumeraidLevel</span>  <span class="comment"># raidå¡ç±»å‹</span></span><br><span class="line">    <span class="attr">oid:</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.37945</span><span class="number">.2</span><span class="number">.1</span><span class="number">.6</span><span class="number">.3</span><span class="number">.1</span><span class="number">.1</span><span class="number">.4</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">DisplayString</span></span><br><span class="line">    <span class="attr">help:</span> <span class="string">serverRaidDiskInfoVolumeraidLevel</span> <span class="string">of</span> <span class="string">this</span> <span class="string">conceptual</span> <span class="string">row.</span> <span class="bullet">-</span> <span class="string">raidå¡ç±»å‹</span></span><br><span class="line">    <span class="attr">indexes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">labelname:</span> <span class="string">inspur</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">gauge</span></span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">serverVoltageStatus</span> <span class="comment">#ç”µå‹sensorå¥åº·çŠ¶æ€</span></span><br><span class="line">    <span class="attr">oid:</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.37945</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.3</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">gauge</span></span><br><span class="line">    <span class="attr">help:</span> <span class="string">The</span> <span class="string">serverVoltagestatus</span> <span class="string">of</span> <span class="string">this</span> <span class="string">conceptual</span> <span class="string">row.</span> <span class="bullet">-</span> <span class="string">ç”µå‹sensorå¥åº·çŠ¶æ€</span> <span class="number">1</span><span class="string">è¡¨ç¤ºæ­£å¸¸</span></span><br><span class="line">    <span class="attr">indexes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">labelname:</span> <span class="string">inspur</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">gauge</span></span><br><span class="line">    <span class="attr">enum_values:</span></span><br><span class="line">      <span class="attr">0:</span> <span class="string">N/A</span></span><br><span class="line">      <span class="attr">1:</span> <span class="string">Normal</span></span><br><span class="line">      <span class="attr">2:</span> <span class="string">Warning</span></span><br><span class="line">      <span class="attr">3:</span> <span class="string">Critical</span></span><br><span class="line">          </span><br><span class="line">          </span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">serverTemperatureSensorStatus</span> <span class="comment">#æ¸©åº¦sensorçš„å¥åº·çŠ¶æ€</span></span><br><span class="line">    <span class="attr">oid:</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.37945</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.1</span><span class="number">.3</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">gauge</span></span><br><span class="line">    <span class="attr">help:</span> <span class="string">The</span> <span class="string">serverTemperatureSensorStatus</span> <span class="string">of</span> <span class="string">this</span> <span class="string">conceptual</span> <span class="string">row.</span> <span class="bullet">-</span> <span class="string">æ¸©åº¦sensorçš„å¥åº·çŠ¶æ€</span> <span class="number">1</span><span class="string">è¡¨ç¤ºæ­£å¸¸</span></span><br><span class="line">    <span class="attr">indexes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">labelname:</span> <span class="string">inspur</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">gauge</span></span><br><span class="line">    <span class="attr">enum_values:</span></span><br><span class="line">      <span class="attr">0:</span> <span class="string">N/A</span></span><br><span class="line">      <span class="attr">1:</span> <span class="string">Normal</span></span><br><span class="line">      <span class="attr">2:</span> <span class="string">Warning</span></span><br><span class="line">      <span class="attr">3:</span> <span class="string">Critical</span></span><br><span class="line">          </span><br><span class="line">          </span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">serverFanSensorStatus</span> <span class="comment">#é£æ‰‡è½¬é€ŸçŠ¶æ€</span></span><br><span class="line">    <span class="attr">oid:</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.37945</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span><span class="number">.3</span><span class="number">.1</span><span class="number">.1</span><span class="number">.3</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">gauge</span></span><br><span class="line">    <span class="attr">help:</span> <span class="string">The</span> <span class="string">serverFanSensorStatus</span> <span class="string">of</span> <span class="string">this</span> <span class="string">conceptual</span> <span class="string">row.</span> <span class="bullet">-</span> <span class="string">é£æ‰‡è½¬é€ŸçŠ¶æ€</span> <span class="number">1</span><span class="string">è¡¨ç¤ºæ­£å¸¸</span></span><br><span class="line">    <span class="attr">indexes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">labelname:</span> <span class="string">inspur</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">gauge</span></span><br><span class="line">    <span class="attr">enum_values:</span></span><br><span class="line">      <span class="attr">0:</span> <span class="string">N/A</span></span><br><span class="line">      <span class="attr">1:</span> <span class="string">Normal</span></span><br><span class="line">      <span class="attr">2:</span> <span class="string">Warning</span></span><br><span class="line">      <span class="attr">3:</span> <span class="string">Critical</span></span><br><span class="line">         </span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">serverMemoryStatus</span> <span class="comment">#å†…å­˜ç›‘æ§</span></span><br><span class="line">    <span class="attr">oid:</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.37945</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span><span class="number">.5</span><span class="number">.1</span><span class="number">.1</span><span class="number">.3</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">gauge</span></span><br><span class="line">    <span class="attr">help:</span> <span class="string">The</span> <span class="string">serverMemoryStatus</span> <span class="string">of</span> <span class="string">this</span> <span class="string">conceptual</span> <span class="string">row.</span> <span class="bullet">-</span> <span class="string">å†…å­˜ç›‘æ§</span> <span class="number">1</span><span class="string">ä»£è¡¨æ­£å¸¸</span></span><br><span class="line">    <span class="attr">indexes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">labelname:</span> <span class="string">inspur</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">gauge</span></span><br><span class="line">    <span class="attr">enum_values:</span></span><br><span class="line">      <span class="attr">0:</span> <span class="string">N/A</span></span><br><span class="line">      <span class="attr">1:</span> <span class="string">Normal</span></span><br><span class="line">      <span class="attr">2:</span> <span class="string">Warning</span></span><br><span class="line">      <span class="attr">3:</span> <span class="string">Critical</span>        </span><br><span class="line">          </span><br><span class="line">          </span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">serverPowerSupplyStatus</span> <span class="comment">#ç”µæºpower</span></span><br><span class="line">    <span class="attr">oid:</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.37945</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.6</span><span class="number">.1</span><span class="number">.1</span><span class="number">.9</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">gauge</span></span><br><span class="line">    <span class="attr">help:</span> <span class="string">The</span> <span class="string">serverPowerSupplyStatus</span> <span class="string">of</span> <span class="string">this</span> <span class="string">conceptual</span> <span class="string">row.</span> <span class="bullet">-</span> <span class="string">ç”µæºpower</span> <span class="number">1</span><span class="string">ä»£è¡¨æ­£å¸¸</span></span><br><span class="line">    <span class="attr">indexes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">labelname:</span> <span class="string">inspur</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">gauge</span></span><br><span class="line">    <span class="attr">enum_values:</span></span><br><span class="line">      <span class="attr">0:</span> <span class="string">N/A</span></span><br><span class="line">      <span class="attr">1:</span> <span class="string">Normal</span></span><br><span class="line">      <span class="attr">2:</span> <span class="string">Warning</span></span><br><span class="line">      <span class="attr">3:</span> <span class="string">Critical</span>       </span><br><span class="line">          </span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">serverFrontHDStatus</span> <span class="comment">#å‰ç½®ç‰©ç†ç£ç›˜å¥åº·çŠ¶æ€</span></span><br><span class="line">    <span class="attr">oid:</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.37945</span><span class="number">.2</span><span class="number">.1</span><span class="number">.3</span><span class="number">.1</span><span class="number">.1</span><span class="number">.1</span><span class="number">.4</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">DisplayString</span></span><br><span class="line">    <span class="attr">help:</span> <span class="string">The</span> <span class="string">serverFrontHDStatus</span> <span class="string">of</span> <span class="string">this</span> <span class="string">conceptual</span> <span class="string">row.</span> <span class="bullet">-</span> <span class="string">å‰ç½®ç‰©ç†ç£ç›˜å¥åº·çŠ¶æ€</span> <span class="string">Normalä»£è¡¨æ­£å¸¸</span></span><br><span class="line">    <span class="attr">indexes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">labelname:</span> <span class="string">inspur</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">gauge</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">serverDriveSlotStatus</span> <span class="comment">#ç¡¬ç›˜å¥åº·çŠ¶æ€ä¿¡æ¯(é©±åŠ¨å™¨æ’æ§½)</span></span><br><span class="line">    <span class="attr">oid:</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.37945</span><span class="number">.2</span><span class="number">.1</span><span class="number">.6</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.9</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">DisplayString</span></span><br><span class="line">    <span class="attr">help:</span> <span class="string">The</span> <span class="string">serverDriveSlotStatus</span> <span class="string">of</span> <span class="string">this</span> <span class="string">conceptual</span> <span class="string">row.</span> <span class="bullet">-</span> <span class="string">ç¡¬ç›˜å¥åº·çŠ¶æ€ä¿¡æ¯</span> <span class="string">Normalä»£è¡¨æ­£å¸¸</span></span><br><span class="line">    <span class="attr">indexes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">labelname:</span> <span class="string">inspur</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">gauge</span></span><br><span class="line">    <span class="attr">enum_values:</span></span><br><span class="line">      <span class="attr">0:</span> <span class="number">0</span><span class="string">-N/A</span></span><br><span class="line">      <span class="attr">1:</span> <span class="string">Normal</span></span><br><span class="line">      <span class="attr">2:</span> <span class="string">Warning</span></span><br><span class="line">      <span class="attr">3:</span> <span class="string">Critical</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">serverRaidLogicDiskInfoStatus</span> <span class="comment">#Raidå¡å¥åº·çŠ¶æ€ä¿¡æ¯</span></span><br><span class="line">    <span class="attr">oid:</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.37945</span><span class="number">.2</span><span class="number">.1</span><span class="number">.6</span><span class="number">.3</span><span class="number">.1</span><span class="number">.1</span><span class="number">.2</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">DisplayString</span></span><br><span class="line">    <span class="attr">help:</span> <span class="string">The</span> <span class="string">serverRaidControllorStandardStatus</span> <span class="string">of</span> <span class="string">this</span> <span class="string">conceptual</span> <span class="string">row.</span> <span class="bullet">-</span> <span class="string">Raidå¡å¥åº·çŠ¶æ€ä¿¡æ¯</span> <span class="string">Optimalä»£è¡¨æ­£å¸¸</span></span><br><span class="line">    <span class="attr">indexes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">labelname:</span> <span class="string">inspur</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">gauge</span></span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">serverSystemNICStandardStatus</span> <span class="comment">#ç½‘å¡ç›‘æ§</span></span><br><span class="line">    <span class="attr">oid:</span> <span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.37945</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span><span class="number">.14</span><span class="number">.1</span><span class="number">.1</span><span class="number">.5</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">DisplayString</span></span><br><span class="line">    <span class="attr">help:</span> <span class="string">The</span> <span class="string">serverSystemNICStandardStatus</span> <span class="string">of</span> <span class="string">this</span> <span class="string">conceptual</span> <span class="string">row.</span> <span class="bullet">-</span> <span class="string">ç½‘å¡å¥åº·çŠ¶æ€ä¿¡æ¯</span> <span class="string">Normalä»£è¡¨æ­£å¸¸</span></span><br><span class="line">    <span class="attr">indexes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">labelname:</span> <span class="string">inspur</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">gauge</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">version:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">max_repetitions:</span> <span class="number">25</span></span><br><span class="line">  <span class="attr">retries:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">timeout:</span> <span class="string">60s</span></span><br><span class="line">  <span class="attr">auth:</span></span><br><span class="line">    <span class="attr">community:</span> <span class="number">123456</span></span><br><span class="line">    <span class="attr">security_level:</span> <span class="string">authPriv</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">sysadmin</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">rootuser</span></span><br><span class="line">    <span class="attr">auth_protocol:</span> <span class="string">MD5</span></span><br><span class="line">    <span class="attr">priv_protocol:</span> <span class="string">DES</span></span><br><span class="line">    <span class="attr">priv_password:</span> <span class="string">rootuser</span></span><br></pre></td></tr></table></figure><h3 id="éªŒè¯-snmp-exporter"><a href="#éªŒè¯-snmp-exporter" class="headerlink" title="éªŒè¯ snmp exporter"></a>éªŒè¯ snmp exporter</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://localhost:9116/snmp?module=if_mib,arista_sw&amp;target=192.0.0.8</span><br></pre></td></tr></table></figure><h2 id="prometheus-é‡‡é›†"><a href="#prometheus-é‡‡é›†" class="headerlink" title="prometheus é‡‡é›†"></a>prometheus é‡‡é›†</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;Inspurserver&#x27;</span></span><br><span class="line">  <span class="attr">scrape_interval:</span> <span class="string">60s</span></span><br><span class="line">  <span class="attr">scrape_timeout:</span> <span class="string">60s</span></span><br><span class="line">  <span class="attr">scheme:</span> <span class="string">http</span></span><br><span class="line">  <span class="attr">file_sd_configs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">files:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/data/prometheus/conf.d/inspur_server.yml</span></span><br><span class="line">      <span class="attr">refresh_interval:</span> <span class="string">30s</span></span><br><span class="line">  <span class="attr">metrics_path:</span> <span class="string">/snmp</span></span><br><span class="line">  <span class="attr">params:</span></span><br><span class="line">    <span class="attr">module:</span> [<span class="string">Inspur</span>]</span><br><span class="line">  <span class="attr">relabel_configs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__address__</span>]</span><br><span class="line">      <span class="attr">target_label:</span> <span class="string">__param_target</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__param_target</span>]</span><br><span class="line">      <span class="attr">target_label:</span> <span class="string">instance</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">target_label:</span> <span class="string">__address__</span></span><br><span class="line">      <span class="attr">replacement:</span> <span class="number">10.200</span><span class="number">.4</span><span class="number">.64</span><span class="string">:9130</span> </span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;h3cswitch&#x27;</span></span><br><span class="line">  <span class="attr">scrape_interval:</span> <span class="string">60s</span></span><br><span class="line">  <span class="attr">scrape_timeout:</span> <span class="string">60s</span></span><br><span class="line">  <span class="attr">scheme:</span> <span class="string">http</span></span><br><span class="line">  <span class="attr">file_sd_configs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">files:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/data/prometheus/conf.d/h3c_switch.yml</span></span><br><span class="line">      <span class="attr">refresh_interval:</span> <span class="string">30s</span></span><br><span class="line">  <span class="attr">metrics_path:</span> <span class="string">/snmp</span></span><br><span class="line">  <span class="attr">params:</span></span><br><span class="line">    <span class="attr">module:</span> [<span class="string">H3C</span>]</span><br><span class="line">  <span class="attr">relabel_configs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__address__</span>]</span><br><span class="line">      <span class="attr">target_label:</span> <span class="string">__param_target</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__param_target</span>]</span><br><span class="line">      <span class="attr">target_label:</span> <span class="string">instance</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">target_label:</span> <span class="string">__address__</span></span><br><span class="line">      <span class="attr">replacement:</span> <span class="number">10.200</span><span class="number">.4</span><span class="number">.64</span><span class="string">:9131</span></span><br></pre></td></tr></table></figure><p>å…·ä½“çš„æœºå™¨é…ç½®æ–‡ä»¶åœ¨ï¼š <code>/data/prometheus/conf.d/inspur_server.yml</code></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;100.200.1.23&#x27;</span>]</span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">&quot;lvs01&quot;</span></span><br><span class="line">    <span class="attr">addr:</span> <span class="string">&quot;100.200.1.23&quot;</span></span><br><span class="line">    <span class="attr">env:</span> <span class="string">prod</span></span><br><span class="line">    <span class="attr">dept:</span> <span class="string">hardware</span></span><br><span class="line">    <span class="attr">project:</span> <span class="string">&quot;hardware&quot;</span></span><br><span class="line">    <span class="attr">ip:</span> <span class="string">&quot;172.16.1.11&quot;</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">&quot;hardware&quot;</span></span><br><span class="line">    <span class="attr">hardware:</span> <span class="string">&quot;server&quot;</span></span><br><span class="line">    </span><br><span class="line"><span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;100.200.1.24&#x27;</span>]</span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">&quot;lvs02&quot;</span></span><br><span class="line">    <span class="attr">addr:</span> <span class="string">&quot;100.200.1.24&quot;</span></span><br><span class="line">    <span class="attr">env:</span> <span class="string">prod</span></span><br><span class="line">    <span class="attr">dept:</span> <span class="string">bi</span></span><br><span class="line">    <span class="attr">project:</span> <span class="string">&quot;bi&quot;</span></span><br><span class="line">    <span class="attr">ip:</span> <span class="string">&quot;172.16.1.12&quot;</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">&quot;hardware&quot;</span></span><br><span class="line">    <span class="attr">hardware:</span> <span class="string">&quot;server&quot;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h2 id=&quot;å®‰è£…&quot;&gt;&lt;a href=&quot;#å®‰è£…&quot; class=&quot;headerlink&quot; title=&quot;å®‰è£…&quot;&gt;&lt;/a&gt;å®‰è£…&lt;/h2&gt;&lt;p&gt;åˆ° GitHub ä¸‹è½½ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œç›´æ¥è¿è¡Œå³å¯ï¼Œæˆ–è€…ä½¿ç”¨ systemd æ¥è¿è¡Œï¼Œä¹Ÿå¯ä»¥ç›´æ¥éƒ¨ç½²åˆ° Kubernetes ä¸­ã€‚&lt;br&gt;&lt;a</summary>
        
      
    
    
    
    <category term="ç›‘æ§" scheme="https://zahui.fan/categories/%E7%9B%91%E6%8E%A7/"/>
    
    
    <category term="prometheus" scheme="https://zahui.fan/tags/prometheus/"/>
    
    <category term="snmp" scheme="https://zahui.fan/tags/snmp/"/>
    
  </entry>
  
</feed>
