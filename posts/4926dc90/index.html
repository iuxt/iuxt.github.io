<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>KVM虚拟机常用操作记录 | 杂烩饭</title><meta name="author" content="张理坤"><meta name="copyright" content="张理坤"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="检查前提条件12345678# 如果是 Intel 的 CPU, 输出 VMX;如果是 AMD 的 CPU, 输出 SVMgrep -Eoc &#x27;(vmx|svm)&#x27; &#x2F;proc&#x2F;cpuinfo# 或者使用 kvm-ok 工具监测sudo apt updatesudo apt install cpu-checkerkvm-ok  安装 kvm123456789101112sudo">
<meta property="og:type" content="article">
<meta property="og:title" content="KVM虚拟机常用操作记录">
<meta property="og:url" content="https://zahui.fan/posts/4926dc90/">
<meta property="og:site_name" content="杂烩饭">
<meta property="og:description" content="检查前提条件12345678# 如果是 Intel 的 CPU, 输出 VMX;如果是 AMD 的 CPU, 输出 SVMgrep -Eoc &#x27;(vmx|svm)&#x27; &#x2F;proc&#x2F;cpuinfo# 或者使用 kvm-ok 工具监测sudo apt updatesudo apt install cpu-checkerkvm-ok  安装 kvm123456789101112sudo">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s3.babudiu.com/iuxt/public/skeleton1.svg">
<meta property="article:published_time" content="2021-07-21T06:20:55.000Z">
<meta property="article:modified_time" content="2025-01-24T15:46:34.000Z">
<meta property="article:author" content="张理坤">
<meta property="article:tag" content="配置记录">
<meta property="article:tag" content="VirtualMachine">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s3.babudiu.com/iuxt/public/skeleton1.svg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "KVM虚拟机常用操作记录",
  "url": "https://zahui.fan/posts/4926dc90/",
  "image": "https://s3.babudiu.com/iuxt/public/skeleton1.svg",
  "datePublished": "2021-07-21T06:20:55.000Z",
  "dateModified": "2025-01-24T15:46:34.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "张理坤",
      "url": "https://zahui.fan/"
    }
  ]
}</script><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="https://zahui.fan/posts/4926dc90/"><link rel="preconnect"/><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""/><link rel="preconnect" href="//hm.baidu.com"/><link rel="manifest" href="/site.webmanifest"/><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"/><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="/pluginsSrc/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="/pluginsSrc/@fancyapps/ui/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'undefined')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'undefined')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?50b516d50102c8c9ac5f80529b81ca17";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
btf.addGlobalFn('pjaxComplete', () => {
  _hmt.push(['_trackPageview',window.location.pathname])
}, 'baidu_analytics')
</script><script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-YN0WWZGVYN"></script><script>window.dataLayer = window.dataLayer || []
function gtag(){dataLayer.push(arguments)}
gtag('js', new Date())
gtag('config', 'G-YN0WWZGVYN')
btf.addGlobalFn('pjaxComplete', () => {
  gtag('config', 'G-YN0WWZGVYN', {'page_path': window.location.pathname})
}, 'google_analytics')
</script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: '/pluginsSrc/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'KVM虚拟机常用操作记录',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="https://s3.babudiu.com/iuxt/libs/lxgw-wenkai-screen-webfont/style.min.css" /><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="杂烩饭" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="https://s3.babudiu.com/iuxt/public/dog.svg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">370</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">221</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 工具</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://bbk-games.zahui.fan/"><i class="fa-fw fas fa-gamepad"></i><span> 步步高小游戏</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://aria2.babudiu.com/"><i class="fa-fw fas fa-download"></i><span> Aria2NG</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa-solid fa-paperclip"></i><span> 林克</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa-brands fa-apple fa-bounce"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg fixed" id="page-header" style="background-image: url(https://s3.babudiu.com/iuxt/public/skeleton1.svg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="https://s3.babudiu.com/iuxt/public/boob.png" alt="Logo"><span class="site-name">杂烩饭</span></a><a class="nav-page-title" href="/"><span class="site-name">KVM虚拟机常用操作记录</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 工具</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://bbk-games.zahui.fan/"><i class="fa-fw fas fa-gamepad"></i><span> 步步高小游戏</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://aria2.babudiu.com/"><i class="fa-fw fas fa-download"></i><span> Aria2NG</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa-solid fa-paperclip"></i><span> 林克</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa-brands fa-apple fa-bounce"></i><span> 关于</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">KVM虚拟机常用操作记录</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-07-21T06:20:55.000Z" title="发表于 2021-07-21 14:20:55">2021-07-21</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-01-24T15:46:34.000Z" title="更新于 2025-01-24 23:46:34">2025-01-24</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%9F%BA%E7%A1%80%E8%BF%90%E7%BB%B4/">基础运维</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:365,&quot;messagePrev&quot;:&quot;此文章距离发布已经&quot;,&quot;messageNext&quot;:&quot;天了，内容可能已经过时，请自行判断是否可用或联系博主更新。&quot;,&quot;postUpdate&quot;:&quot;2025-01-24 23:46:34&quot;}" hidden></div><h2 id="检查前提条件"><a href="#检查前提条件" class="headerlink" title="检查前提条件"></a>检查前提条件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果是 Intel 的 CPU, 输出 VMX;如果是 AMD 的 CPU, 输出 SVM</span></span><br><span class="line">grep -Eoc <span class="string">&#x27;(vmx|svm)&#x27;</span> /proc/cpuinfo</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者使用 kvm-ok 工具监测</span></span><br><span class="line">sudo apt update</span><br><span class="line">sudo apt install cpu-checker</span><br><span class="line">kvm-ok</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="安装-kvm"><a href="#安装-kvm" class="headerlink" title="安装 kvm"></a>安装 kvm</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install qemu-kvm libvirt-daemon-system libvirt-clients bridge-utils virtinst libvirt-daemon</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装图形管理工具（可选）</span></span><br><span class="line"><span class="comment"># apt install virt-manager -y</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证</span></span><br><span class="line">sudo systemctl is-active libvirtd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 增加用户权限</span></span><br><span class="line">sudo usermod -aG libvirt <span class="variable">$USER</span></span><br><span class="line">sudo usermod -aG kvm <span class="variable">$USER</span></span><br></pre></td></tr></table></figure>

<h2 id="添加和删除网卡（虚拟硬件）"><a href="#添加和删除网卡（虚拟硬件）" class="headerlink" title="添加和删除网卡（虚拟硬件）"></a>添加和删除网卡（虚拟硬件）</h2><p>要列出要在 KVM 虚拟机中使用的可用网络，请运行以下命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">virsh net-list --all</span><br></pre></td></tr></table></figure>

<p>默认情况下是不活跃的，需要启动</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">virsh net-start default</span><br><span class="line">virsh net-autostart default</span><br></pre></td></tr></table></figure>

<h3 id="查看网卡列表"><a href="#查看网卡列表" class="headerlink" title="查看网卡列表"></a>查看网卡列表</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo virsh domiflist vm-yaohai</span><br></pre></td></tr></table></figure>

<h3 id="添加网卡-模式桥接到-br0"><a href="#添加网卡-模式桥接到-br0" class="headerlink" title="添加网卡 (模式桥接到 br0)"></a>添加网卡 (模式桥接到 br0)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo virsh attach-interface vm-yaohai --<span class="built_in">type</span> bridge --<span class="built_in">source</span> br0 --model virtio --config</span><br></pre></td></tr></table></figure>

<h3 id="删除网卡-指定-mac-地址删除"><a href="#删除网卡-指定-mac-地址删除" class="headerlink" title="删除网卡 (指定 mac 地址删除)"></a>删除网卡 (指定 mac 地址删除)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo virsh detach-interface vm-yaohai --<span class="built_in">type</span> bridge --mac 52:54:00:61:4c:f3 --config</span><br></pre></td></tr></table></figure>

<p><del>添加网卡或删除网卡后需要重新定义,不然重启会失效</del></p>
<p><del>virsh dumpxml vm-yaohai &gt; &#x2F;etc&#x2F;libvirt&#x2F;qemu&#x2F;vm-yaohai.xml</del><br><del>virsh define &#x2F;etc&#x2F;libvirt&#x2F;qemu&#x2F;vm-yaohai.xml</del></p>
<h2 id="kvm-默认网桥"><a href="#kvm-默认网桥" class="headerlink" title="kvm 默认网桥"></a>kvm 默认网桥</h2><blockquote>
<p>libvirt 默认使用了一个名为 default 的 nat 网络，这个网络默认使用 virbr0 作为桥接接口，使用 dnsmasq 来为使用 nat 网络的虚拟机提供 dns 及 dhcp 服务，dnsmasq 生效后的配置文件：<code>/var/lib/libvirt/network/default.xml</code><br>当 libvirtd 服务启动的时候，它会将它管理的被标记为 autostart 的 network 一并启动起来，而启动 network 的时候就会自动调用 dnsmasq 并赋予其适宜的配置文件来运行服务。</p>
</blockquote>
<h3 id="KVM-网桥启动"><a href="#KVM-网桥启动" class="headerlink" title="KVM 网桥启动"></a>KVM 网桥启动</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># default网卡自动启动（virbr0）</span></span><br><span class="line">virsh net-autostart default</span><br><span class="line"></span><br><span class="line"><span class="comment"># default网卡启动（virbr0）</span></span><br><span class="line">virsh net-start default</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看网卡列表</span></span><br><span class="line">virsh net-list --all</span><br></pre></td></tr></table></figure>

<h3 id="修改网段"><a href="#修改网段" class="headerlink" title="修改网段"></a>修改网段</h3><p>编辑配置文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo virsh net-edit default</span><br></pre></td></tr></table></figure>

<p><del>重新定义</del></p>
<p><del>&#96;&#96;&#96;bash</del><br><del>sudo virsh net-define &#x2F;etc&#x2F;libvirt&#x2F;qemu&#x2F;networks&#x2F;default.xml</del><br><del>&#96;&#96;&#96;</del></p>
<p>重新启动网卡</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo virsh net-destroy default</span><br><span class="line">sudo virsh net-start default</span><br></pre></td></tr></table></figure>

<h2 id="virsh-常用命令"><a href="#virsh-常用命令" class="headerlink" title="virsh 常用命令"></a>virsh 常用命令</h2><h3 id="查看虚拟机"><a href="#查看虚拟机" class="headerlink" title="查看虚拟机"></a>查看虚拟机</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">virsh list --all</span><br></pre></td></tr></table></figure>

<h3 id="销毁虚拟机"><a href="#销毁虚拟机" class="headerlink" title="销毁虚拟机"></a>销毁虚拟机</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">virsh destroy debian11</span><br><span class="line">virsh undefine debian11</span><br></pre></td></tr></table></figure>

<h3 id="关闭虚拟机"><a href="#关闭虚拟机" class="headerlink" title="关闭虚拟机"></a>关闭虚拟机</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">virsh shutdown debian11</span><br></pre></td></tr></table></figure>

<h3 id="创建-Linux-虚拟机"><a href="#创建-Linux-虚拟机" class="headerlink" title="创建 Linux 虚拟机"></a>创建 Linux 虚拟机</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建虚拟机磁盘</span></span><br><span class="line">qemu-img create -f qcow2 /var/lib/libvirt/images/debian11.qcow2 20G</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">virt-install \</span><br><span class="line">    --name debian11 \</span><br><span class="line">    --memory memory=1024,currentMemory=512 \</span><br><span class="line">    --disk path=/var/lib/libvirt/images/debian11.qcow2,size=20 \</span><br><span class="line">    --vcpus 1 \</span><br><span class="line">    --os-type linux \</span><br><span class="line">    --os-variant debian10 \</span><br><span class="line">    --network bridge=br0,model=virtio \</span><br><span class="line">    --graphics none \</span><br><span class="line">    --console pty,target_type=serial \</span><br><span class="line">    --location <span class="string">&#x27;http://mirrors.tencent.com/debian/dists/bullseye/main/installer-amd64/&#x27;</span> \</span><br><span class="line">    --extra-args <span class="string">&#x27;console=ttyS0,115200n8 serial&#x27;</span> \</span><br><span class="line">    --debug</span><br></pre></td></tr></table></figure>

<h3 id="创建-windows-虚拟机"><a href="#创建-windows-虚拟机" class="headerlink" title="创建 windows 虚拟机"></a>创建 windows 虚拟机</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">virt-install \</span><br><span class="line">    --name win10 \</span><br><span class="line">    --ram 2048 \</span><br><span class="line">    --disk path=/var/lib/libvirt/images/win10.qcow2,size=20 \</span><br><span class="line">    --vcpus 2 \</span><br><span class="line">    --os-type windows \</span><br><span class="line">    --os-variant win10 \</span><br><span class="line">    --network bridge=br0,model=virtio \</span><br><span class="line">    --graphics none \</span><br><span class="line">    --console pty,target_type=serial \</span><br><span class="line">    --cdrom /home/test/Downloads/Win10_21H1_Chinese(Simplified)_x64.iso \</span><br><span class="line">    --extra-args <span class="string">&#x27;console=ttyS0,115200n8 serial&#x27;</span></span><br></pre></td></tr></table></figure>

<p>开启 vnc</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">virsh vncdisplay win10</span><br></pre></td></tr></table></figure>

<h3 id="导入虚拟机"><a href="#导入虚拟机" class="headerlink" title="导入虚拟机"></a>导入虚拟机</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">virt-install \</span><br><span class="line">--name debian11 \</span><br><span class="line">--ram 2048 \</span><br><span class="line">--disk path=/var/lib/libvirt/images/debian11.qcow2,size=20 \</span><br><span class="line">--vcpus 2 \</span><br><span class="line">--os-type linux \</span><br><span class="line">--os-variant debian11 \</span><br><span class="line">--network bridge=br0,model=virtio \</span><br><span class="line">--graphics none \</span><br><span class="line">--console pty,target_type=serial \</span><br><span class="line">--import</span><br></pre></td></tr></table></figure>

<h3 id="导出虚拟机为-qcow2"><a href="#导出虚拟机为-qcow2" class="headerlink" title="导出虚拟机为 qcow2"></a>导出虚拟机为 qcow2</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">virt-clone --original debian11 --name debian11-clone --file /var/lib/libvirt/images/debian11-clone.qcow2</span><br></pre></td></tr></table></figure>

<h2 id="kickstart-自动装机"><a href="#kickstart-自动装机" class="headerlink" title="kickstart 自动装机"></a>kickstart 自动装机</h2><h3 id="virt-install-命令"><a href="#virt-install-命令" class="headerlink" title="virt-install 命令"></a>virt-install 命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">virt-install \</span><br><span class="line">    --hvm --virt-type kvm \</span><br><span class="line">    --accelerate \</span><br><span class="line">    --name vm-1 \</span><br><span class="line">    --os-type linux \</span><br><span class="line">    --os-variant centos-stream8 \</span><br><span class="line">    --vcpus 2 \</span><br><span class="line">    --ram 4096 \</span><br><span class="line">    --disk path=/dev/mapper/lv_name \</span><br><span class="line">    --network <span class="string">&quot;bridge:br0,model=virtio&quot;</span> \</span><br><span class="line">    --nographics \</span><br><span class="line">    --location https://mirrors.aliyun.com/centos/8-stream/BaseOS/x86_64/os/ \</span><br><span class="line">    --initrd-inject=./ks.cfg \</span><br><span class="line">    --cpu host \</span><br><span class="line">    --extra-args <span class="string">&quot;ks=file:/ks.cfg console=tty0 console=ttyS0,115200n8 net.ifnames=0 biosdevname=0&quot;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>后面的 <code>net.ifnames=0 biosdevname=0</code> 是内核参数,将网卡设备名固定为 eth0..eth1 等<br>–os-type 可以通过命令 <code>osinfo-query os</code> 获取</p>
</blockquote>
<h3 id="kickstart-内容"><a href="#kickstart-内容" class="headerlink" title="kickstart 内容"></a>kickstart 内容</h3><blockquote>
<p>在系统安装后桌面上会生成一份 <code>anaconda-ks.cfg</code> 这个就是安装这个系统使用的 kickstart 配置</p>
</blockquote>
<p>安装 <code>centos8 stream</code> 的 <code>ks.cfg</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Kickstart file automatically generated by anaconda.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#version=DEVEL</span></span><br><span class="line">install</span><br><span class="line">url --url=<span class="string">&quot;https://mirrors.aliyun.com/centos/8-stream/BaseOS/x86_64/os/&quot;</span></span><br><span class="line">repo --name=<span class="string">&quot;CentOS&quot;</span>  --baseurl=<span class="string">&quot;https://mirrors.aliyun.com/centos/8-stream/BaseOS/x86_64/os/&quot;</span> --cost=100</span><br><span class="line"></span><br><span class="line">lang en_US.UTF-8</span><br><span class="line">keyboard us</span><br><span class="line">network --onboot <span class="built_in">yes</span> --device eth0 --bootproto static --ip 10.0.0.120 --netmask 255.255.0.0 --gateway 10.0.0.8 --noipv6 --nameserver 10.0.0.35,10.0.0.30</span><br><span class="line">network  --hostname=vm-name</span><br><span class="line"></span><br><span class="line"><span class="comment">#default pwd is R/)ydu.?egUdT&#x27;Xl</span></span><br><span class="line">rootpw  --iscrypted $6$7ljjIEi8rX8ydAOv<span class="variable">$N4qtXrPQZIp5n5pbLf</span>/BQ/1BgE0ODHoXGJzCiWCYl006hOhZeITXl.yz0kpRvolScvAMOZ..XzPIX7iiRtV5v/</span><br><span class="line">firewall --service=ssh</span><br><span class="line">authconfig --enableshadow --passalgo=sha512</span><br><span class="line">selinux --enforcing</span><br><span class="line">timezone --utc Asia/Shanghai</span><br><span class="line">text</span><br><span class="line">bootloader --location=mbr --driveorder=vda --append=<span class="string">&quot; crashkernel=auto console=ttyS0,115200n8 net.ifnames=0 biosdevname=0&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The following is the partition information you requested</span></span><br><span class="line"><span class="comment"># Note that any partitions you deleted are not expressed</span></span><br><span class="line"><span class="comment"># here so unless you clear all partitions first, this is</span></span><br><span class="line"><span class="comment"># not guaranteed to work</span></span><br><span class="line"></span><br><span class="line">clearpart --all --drives=vda</span><br><span class="line">part /boot --fstype=xfs --size=500</span><br><span class="line">part pv.01 --grow</span><br><span class="line">volgroup vg_os pv.01</span><br><span class="line">logvol / --fstype=xfs --name=lv_root --vgname=vg_os --percent 90</span><br><span class="line"></span><br><span class="line"><span class="comment"># any invalid partition tables found on disks are initialized</span></span><br><span class="line"></span><br><span class="line">zerombr</span><br><span class="line"></span><br><span class="line">%packages</span><br><span class="line">@core</span><br><span class="line">curl</span><br><span class="line"></span><br><span class="line"><span class="comment"># install puppet agent. But it could be very slow, so you have to install it manually</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#%post</span></span><br><span class="line"><span class="comment">#(</span></span><br><span class="line"><span class="comment">#    echo &#x27;Install Puppet&#x27;</span></span><br><span class="line"><span class="comment">#    curl -OL https://yum.puppetlabs.com/puppet6-release-el-7.noarch.rpm</span></span><br><span class="line"><span class="comment">#    rpm -i puppet6-release-el-7.noarch.rpm</span></span><br><span class="line"><span class="comment">#    yum update -y</span></span><br><span class="line"><span class="comment">#    yum install -y puppet-agent</span></span><br><span class="line"><span class="comment">#) 1&gt;&gt; /root/post_install.log 2&gt;&amp;1</span></span><br><span class="line"></span><br><span class="line">%end</span><br></pre></td></tr></table></figure>

<h2 id="kvm-透传主机-usb-设备"><a href="#kvm-透传主机-usb-设备" class="headerlink" title="kvm 透传主机 usb 设备"></a>kvm 透传主机 usb 设备</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo usermod -aG kvm <span class="variable">$USER</span></span><br></pre></td></tr></table></figure>

<h2 id="kvm-修改配置"><a href="#kvm-修改配置" class="headerlink" title="kvm 修改配置"></a>kvm 修改配置</h2><h3 id="修改内存大小"><a href="#修改内存大小" class="headerlink" title="修改内存大小"></a>修改内存大小</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo virsh setmaxmem &lt;vm-name&gt; 16G --config</span><br><span class="line">sudo virsh setmem &lt;vm-name&gt; 16G --config</span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://zahui.fan">张理坤</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://zahui.fan/posts/4926dc90/">https://zahui.fan/posts/4926dc90/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://zahui.fan" target="_blank">杂烩饭</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E9%85%8D%E7%BD%AE%E8%AE%B0%E5%BD%95/">配置记录</a><a class="post-meta__tags" href="/tags/VirtualMachine/">VirtualMachine</a></div><div class="post-share"><div class="social-share" data-image="https://s3.babudiu.com/iuxt/public/skeleton1.svg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="/pluginsSrc/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="/pluginsSrc/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/6c12bda4/" title="Python脚本接受参数"><img class="cover" src="https://s3.babudiu.com/iuxt/public/python.svg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">Python脚本接受参数</div></div><div class="info-2"><div class="info-item-1">完善一下 python 脚本，让它支持更完善的参数（长参数、短参数） 12345678910111213141516171819202122232425262728293031323334import getopt, sysdef parse_args(args=sys.argv[1:]):    try:        opts, args = getopt.getopt(args, &quot;hvc:w:&quot;, [&quot;help&quot;, &quot;short&quot;, &quot;verbose&quot;, &quot;critical_num=&quot;, &quot;warning_num=&quot;])    except getopt.GetoptError as err:        print(&quot;Input parameter error&quot;)        sys.exit()    verbose = False    short = False    for opt, arg in opts:     ...</div></div></div></a><a class="pagination-related" href="/posts/f6f77df5/" title="Windows个人文件夹名字变英文"><img class="cover" src="https://s3.babudiu.com/iuxt/public/Windows.svg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">Windows个人文件夹名字变英文</div></div><div class="info-2"><div class="info-item-1"> 有时候 windows 用户文件夹里面有些会变成英文,虽然没什么影响,不过强迫症会不舒服 (比如我)  这种情况是由于文件夹内没有 desktop.ini 导致的,或者 desktop.ini 权限不正确  desktop.ini 文件是一个隐藏文件  windows10 的 desktop.ini...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/posts/si78gg/" title="CentOS 7 停止维护后如何使用"><img class="cover" src="https://s3.babudiu.com/iuxt/public/CentOS.svg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="fas fa-history fa-fw"></i> 2025-01-03</div><div class="info-item-2">CentOS 7 停止维护后如何使用</div></div><div class="info-2"><div class="info-item-1">CentOS 7 停止维护后，很多源都失效了，使用 yum 的时候报错 404，需要修改源才能继续使用。 老版本 CentOS 源被更改成 vault 源，需要更换成 vault 源才能继续使用 yum。 一、修改成官方源1234sudo sed -i.bak \  -e &#x27;s|^mirrorlist=|#mirrorlist=|g&#x27; \  -e &#x27;s|^#baseurl=http://mirror.centos.org/centos|baseurl=https://vault.centos.org/centos|g&#x27; \  /etc/yum.repos.d/CentOS-Base.repo  二、换成阿里云源1curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo  三、更换成中科大的源123456789101112131415161718192021222324252627282930313233cat &gt;...</div></div></div></a><a class="pagination-related" href="/posts/8a7e6530/" title="CentOS7更新内核版本"><img class="cover" src="https://s3.babudiu.com/iuxt/public/CentOS.svg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="fas fa-history fa-fw"></i> 2025-07-11</div><div class="info-item-2">CentOS7更新内核版本</div></div><div class="info-2"><div class="info-item-1">确认当前内核版本1uname -r  安装内核仓库 仓库的官方地址是： http://elrepo.org/tiki/HomePage  12rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.orgyum install https://www.elrepo.org/elrepo-release-7.el7.elrepo.noarch.rpm  查看可用的内核列表1yum --disablerepo=&quot;*&quot; --enablerepo=&quot;elrepo-kernel&quot; list available  安装 LTS 版内核1yum --enablerepo=elrepo-kernel install kernel-lt-devel kernel-lt kernel-lt-tools kernel-lt-tools-libs-devel -y  查看当前系统可用的内核1awk -F\&#x27; &#x27;$1==&quot;menuentry &quot; &#123;print...</div></div></div></a><a class="pagination-related" href="/posts/8c4ff9d2/" title="Debian常用配置"><img class="cover" src="https://s3.babudiu.com/iuxt/public/debian.svg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="fas fa-history fa-fw"></i> 2025-07-11</div><div class="info-item-2">Debian常用配置</div></div><div class="info-2"><div class="info-item-1">这里以 Debian12 为例 修改国内源1sed -i &#x27;s@//.*debian.org@//mirrors.ustc.edu.cn@g&#x27; /etc/apt/sources.list  配置网络vim &#x2F;etc&#x2F;network&#x2F;interfaces 固定 ip 配置12345678auto enp0s3iface enp0s3 inet static    address 192.168.1.240/24    network 192.168.1.0    broadcast 192.168.1.255    gateway 192.168.1.1    dns-nameservers 8.8.8.8# 其中 network\broadcast 可以省略不写  DHCP 配置1iface enp0s3 inet dhcp  重启网络服务1sudo systemctl restart networking.service </div></div></div></a><a class="pagination-related" href="/posts/lm8t2usn/" title="Jenkins pipeline中正确使用git"><img class="cover" src="https://s3.babudiu.com/iuxt/images/202304111550061.svg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="fas fa-history fa-fw"></i> 2025-07-11</div><div class="info-item-2">Jenkins pipeline中正确使用git</div></div><div class="info-2"><div class="info-item-1">看到很多 jenkins 使用都是直接执行 git clone 命令, 这么做有以下几个缺点.  需要耗费时间去处理 git 分支, 代码冲突等工作, 还需要判断是使用 git clone 还是 git pull 账号密码 (或者 ssh 秘钥) 需要存储在构建机器上, 如果更换了构建节点, 那么需要重新配置, 即对构建环境有依赖, 构建环境是个黑盒子, 因为你不知道上个维护者在这台构建机器上做了什么. 不受 jenkins 管理, 比如删除流水线, 拉取的代码任然存在机器上 做个分支选项框是个痛苦的事情将代码交给 jenkins 管理则省去了这些操作.  使用凭据管理账号密码在 系统管理 – 凭据 – 系统 – 全局凭据 里面增加一个新的凭据 成功后记录一下 ID 编写流水线1234567891011121314151617pipeline &#123;    agent any    parameters &#123;      gitParameter branch: &#x27;&#x27;, branchFilter: &#x27;.*&#x27;,...</div></div></div></a><a class="pagination-related" href="/posts/f4ea28c3/" title="LVM逻辑卷管理"><img class="cover" src="https://s3.babudiu.com/iuxt/public/skeleton1.svg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="fas fa-history fa-fw"></i> 2025-03-24</div><div class="info-item-2">LVM逻辑卷管理</div></div><div class="info-2"><div class="info-item-1">LVM 是 Logical Volume Manager 的缩写，中文逻辑卷管理，LVM 是建立在磁盘分区和文件系统之间的一个逻辑层，LVM 会更加灵活，可以动态扩容缩容分区大小。调整分区大小有风险，请做好充分测试再决定是否执行。如果没有启用 lvm，请查看 linux磁盘扩容 - 非LVM那么怎么知道机器有没有启用 LVM 呢，可以执行 sudo lvdisplay 查看有没有已存在的 LV，对比 df -hT 里面的 Filesystem，也可以用 lsblk 查看有没有 lvm。 记住一点， 如果你的磁盘没有分区并已经在使用中， 那么千万不要使用 fdisk 来分区，会损坏数据！！！   LVM 的一些概念PV： 物理卷，比如一个分区，一个磁盘VG： 卷组，将多个 PV 整合在一起，形成一个大的池子LV： 逻辑卷，从 VG 划分出来一个个空间，可以当作分区来看待，可以格式化，可以挂载 常用命令    查看 查看详细信息 扩展 创建    卷组 VG vgs vgdisplay vgextend vgcreate   逻辑卷...</div></div></div></a><a class="pagination-related" href="/posts/23ada041/" title="Linux下tmp目录的管理"><img class="cover" src="https://s3.babudiu.com/iuxt/public/skeleton1.svg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="fas fa-history fa-fw"></i> 2024-10-31</div><div class="info-item-2">Linux下tmp目录的管理</div></div><div class="info-2"><div class="info-item-1">生成临时文件可以使用 mktemp 命令生成 tmp 文件，mktemp -d 生成临时目录，避免临时目录重复使用的问题 123456#!/bin/bashtmp_file=&quot;$(mktemp)&quot;tmp_folder=&quot;$(mktemp -d)&quot;echo $tmp_fileecho $tmp_folder  tmp 目录定时清理这个是由 systemd 的几个模块实现的， 在 centos7 中： 123systemd-tmpfiles-setup.service  ：Create Volatile Files and Directoriessystemd-tmpfiles-setup-dev.service：Create static device nodes in /devsystemd-tmpfiles-clean.service ：Cleanup of Temporary Directories  配置文件也有 3...</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="giscus-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="https://s3.babudiu.com/iuxt/public/dog.svg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">张理坤</div><div class="author-info-description">张理坤的博客</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">370</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">221</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div><a id="card-info-btn" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/iuxt"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/iuxt" rel="external nofollow noreferrer" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:x@zahui.fan" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://space.bilibili.com/165330963" rel="external nofollow noreferrer" target="_blank" title="Bilibili"><i class="fa-brands fa-bilibili"></i></a><a class="social-icon" href="https://stackoverflow.com/users/15620461/" rel="external nofollow noreferrer" target="_blank" title="StackOverflow"><i class="fa-brands fa-stack-overflow"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title="RSS"><i class="fa-solid fa-square-rss"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">此博客为我记录运维工作总结所用，供网友阅读参考，如有侵权，请通知我，我会核实后进行处理。</br>
<strong style="color: red;">欢迎加入技术交流群：</strong>
<div class="aside-qrcode" >
<img src="https://src.babudiu.com/card/wechat_ops_group.JPG" title="微信群" width="100%" height="auto">
</div>
</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E5%89%8D%E6%8F%90%E6%9D%A1%E4%BB%B6"><span class="toc-number">1.</span> <span class="toc-text">检查前提条件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-kvm"><span class="toc-number">2.</span> <span class="toc-text">安装 kvm</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E5%92%8C%E5%88%A0%E9%99%A4%E7%BD%91%E5%8D%A1%EF%BC%88%E8%99%9A%E6%8B%9F%E7%A1%AC%E4%BB%B6%EF%BC%89"><span class="toc-number">3.</span> <span class="toc-text">添加和删除网卡（虚拟硬件）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E7%BD%91%E5%8D%A1%E5%88%97%E8%A1%A8"><span class="toc-number">3.1.</span> <span class="toc-text">查看网卡列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E7%BD%91%E5%8D%A1-%E6%A8%A1%E5%BC%8F%E6%A1%A5%E6%8E%A5%E5%88%B0-br0"><span class="toc-number">3.2.</span> <span class="toc-text">添加网卡 (模式桥接到 br0)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E7%BD%91%E5%8D%A1-%E6%8C%87%E5%AE%9A-mac-%E5%9C%B0%E5%9D%80%E5%88%A0%E9%99%A4"><span class="toc-number">3.3.</span> <span class="toc-text">删除网卡 (指定 mac 地址删除)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#kvm-%E9%BB%98%E8%AE%A4%E7%BD%91%E6%A1%A5"><span class="toc-number">4.</span> <span class="toc-text">kvm 默认网桥</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#KVM-%E7%BD%91%E6%A1%A5%E5%90%AF%E5%8A%A8"><span class="toc-number">4.1.</span> <span class="toc-text">KVM 网桥启动</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E7%BD%91%E6%AE%B5"><span class="toc-number">4.2.</span> <span class="toc-text">修改网段</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#virsh-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">5.</span> <span class="toc-text">virsh 常用命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E8%99%9A%E6%8B%9F%E6%9C%BA"><span class="toc-number">5.1.</span> <span class="toc-text">查看虚拟机</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%94%80%E6%AF%81%E8%99%9A%E6%8B%9F%E6%9C%BA"><span class="toc-number">5.2.</span> <span class="toc-text">销毁虚拟机</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E9%97%AD%E8%99%9A%E6%8B%9F%E6%9C%BA"><span class="toc-number">5.3.</span> <span class="toc-text">关闭虚拟机</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA-Linux-%E8%99%9A%E6%8B%9F%E6%9C%BA"><span class="toc-number">5.4.</span> <span class="toc-text">创建 Linux 虚拟机</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA-windows-%E8%99%9A%E6%8B%9F%E6%9C%BA"><span class="toc-number">5.5.</span> <span class="toc-text">创建 windows 虚拟机</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5%E8%99%9A%E6%8B%9F%E6%9C%BA"><span class="toc-number">5.6.</span> <span class="toc-text">导入虚拟机</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E5%87%BA%E8%99%9A%E6%8B%9F%E6%9C%BA%E4%B8%BA-qcow2"><span class="toc-number">5.7.</span> <span class="toc-text">导出虚拟机为 qcow2</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#kickstart-%E8%87%AA%E5%8A%A8%E8%A3%85%E6%9C%BA"><span class="toc-number">6.</span> <span class="toc-text">kickstart 自动装机</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#virt-install-%E5%91%BD%E4%BB%A4"><span class="toc-number">6.1.</span> <span class="toc-text">virt-install 命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#kickstart-%E5%86%85%E5%AE%B9"><span class="toc-number">6.2.</span> <span class="toc-text">kickstart 内容</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#kvm-%E9%80%8F%E4%BC%A0%E4%B8%BB%E6%9C%BA-usb-%E8%AE%BE%E5%A4%87"><span class="toc-number">7.</span> <span class="toc-text">kvm 透传主机 usb 设备</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#kvm-%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE"><span class="toc-number">8.</span> <span class="toc-text">kvm 修改配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E5%86%85%E5%AD%98%E5%A4%A7%E5%B0%8F"><span class="toc-number">8.1.</span> <span class="toc-text">修改内存大小</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/lrr6ze9h/" title="macOS常用操作记录"><img src="https://s3.babudiu.com/iuxt/public/macos.svg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="macOS常用操作记录"/></a><div class="content"><a class="title" href="/posts/lrr6ze9h/" title="macOS常用操作记录">macOS常用操作记录</a><time datetime="2025-10-06T14:30:40.000Z" title="更新于 2025-10-06 22:30:40">2025-10-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/t37flu/" title="正在运行的Docker容器增加端口映射"><img src="https://s3.babudiu.com/iuxt/public/skeleton1.svg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="正在运行的Docker容器增加端口映射"/></a><div class="content"><a class="title" href="/posts/t37flu/" title="正在运行的Docker容器增加端口映射">正在运行的Docker容器增加端口映射</a><time datetime="2025-10-04T15:24:34.000Z" title="更新于 2025-10-04 23:24:34">2025-10-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/t3e151/" title="macOS自定义后台运行程序"><img src="https://s3.babudiu.com/iuxt/public/skeleton1.svg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="macOS自定义后台运行程序"/></a><div class="content"><a class="title" href="/posts/t3e151/" title="macOS自定义后台运行程序">macOS自定义后台运行程序</a><time datetime="2025-09-30T07:23:39.000Z" title="更新于 2025-09-30 15:23:39">2025-09-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/c0880a78/" title="使用Fail2ban抵御暴力破解和cc攻击"><img src="https://s3.babudiu.com/iuxt/public/fail2ban.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="使用Fail2ban抵御暴力破解和cc攻击"/></a><div class="content"><a class="title" href="/posts/c0880a78/" title="使用Fail2ban抵御暴力破解和cc攻击">使用Fail2ban抵御暴力破解和cc攻击</a><time datetime="2025-09-24T15:55:24.000Z" title="更新于 2025-09-24 23:55:24">2025-09-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/518e617c/" title="git常用操作记录"><img src="https://s3.babudiu.com/iuxt/public/skeleton1.svg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="git常用操作记录"/></a><div class="content"><a class="title" href="/posts/518e617c/" title="git常用操作记录">git常用操作记录</a><time datetime="2025-09-19T13:47:17.000Z" title="更新于 2025-09-19 21:47:17">2025-09-19</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.3.5</a></div><div class="footer_custom_text"><a target="_blank" rel="noopener external nofollow noreferrer" href='https://www.upyun.com/?utm_source=lianmeng&utm_medium=referral'>
  本网站由<img src='https://s3.babudiu.com/iuxt/public/upyun.svg' alt='又拍云' width='70' height='28' style="vertical-align:bottom">
  提供CDN加速/云存储服务
</a>
</br>
<a href="https://beian.miit.gov.cn/" rel="external nofollow noreferrer" target="_blank">沪ICP备2021015230号-1</a>
</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/pluginsSrc/@fancyapps/ui/dist/fancybox/fancybox.umd.js"></script><script src="/pluginsSrc/vanilla-lazyload/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null

  const getGiscusTheme = theme => theme === 'dark' ? 'dark' : 'light'

  const createScriptElement = config => {
    const ele = document.createElement('script')
    Object.entries(config).forEach(([key, value]) => {
      ele.setAttribute(key, value)
    })
    return ele
  }

  const loadGiscus = (el = document, key) => {
    const mappingConfig = isShuoshuo
      ? { 'data-mapping': 'specific', 'data-term': key }
      : { 'data-mapping': (option && option['data-mapping']) || 'pathname' }

    const giscusConfig = {
      src: 'https://giscus.babudiu.com/client.js',
      'data-repo': 'iuxt/iuxt.github.io',
      'data-repo-id': 'R_kgDOMszkdA',
      'data-category-id': 'DIC_kwDOMszkdM4CiMyw',
      'data-theme': getGiscusTheme(document.documentElement.getAttribute('data-theme')),
      'data-reactions-enabled': '1',
      crossorigin: 'anonymous',
      async: true,
      ...option,
      ...mappingConfig
    }

    const scriptElement = createScriptElement(giscusConfig)

    el.querySelector('#giscus-wrap').appendChild(scriptElement)

    if (isShuoshuo) {
      window.shuoshuoComment.destroyGiscus = () => {
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }
  }

  const changeGiscusTheme = theme => {
    const iframe = document.querySelector('#giscus-wrap iframe')
    if (iframe) {
      const message = {
        giscus: {
          setConfig: {
            theme: getGiscusTheme(theme)
          }
        }
      }
      iframe.contentWindow.postMessage(message, 'https://giscus.babudiu.com')
    }
  }

  btf.addGlobalFn('themeChange', changeGiscusTheme, 'giscus')

  if (isShuoshuo) {
    'Giscus' === 'Giscus'
      ? window.shuoshuoComment = { loadComment: loadGiscus }
      : window.loadOtherComment = loadGiscus
    return
  }

  if ('Giscus' === 'Giscus' || !false) {
    if (false) btf.loadComment(document.getElementById('giscus-wrap'), loadGiscus)
    else loadGiscus()
  } else {
    window.loadOtherComment = loadGiscus
  }
})()</script></div><script async data-pjax src="https://events.vercount.one/js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜搜搜" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>