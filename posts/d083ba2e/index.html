<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Docker容器间优雅的互联 | 杂烩饭</title><meta name="author" content="张理坤"><meta name="copyright" content="张理坤"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="本文主要介绍如何优雅的让 Docker 容器和 Docker 容器之间相互通信，以及 Docker 容器如何和宿主机进行网络通信。 容器间网络通信docker 容器间通信常见的方式是使用 –link 进行连接，但是 Docker 已经弃用这种方式，并且容器数量一旦一多，–link 会显得很乱。官方推荐使用自定义网络来进行互联。 创建自定义网络1docker network create my-ne">
<meta property="og:type" content="article">
<meta property="og:title" content="Docker容器间优雅的互联">
<meta property="og:url" content="https://zahui.fan/posts/d083ba2e/">
<meta property="og:site_name" content="杂烩饭">
<meta property="og:description" content="本文主要介绍如何优雅的让 Docker 容器和 Docker 容器之间相互通信，以及 Docker 容器如何和宿主机进行网络通信。 容器间网络通信docker 容器间通信常见的方式是使用 –link 进行连接，但是 Docker 已经弃用这种方式，并且容器数量一旦一多，–link 会显得很乱。官方推荐使用自定义网络来进行互联。 创建自定义网络1docker network create my-ne">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s3.babudiu.com/iuxt/public/Docker.svg">
<meta property="article:published_time" content="2022-04-25T14:13:22.000Z">
<meta property="article:modified_time" content="2025-07-11T15:21:31.000Z">
<meta property="article:author" content="张理坤">
<meta property="article:tag" content="Docker">
<meta property="article:tag" content="Container">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s3.babudiu.com/iuxt/public/Docker.svg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Docker容器间优雅的互联",
  "url": "https://zahui.fan/posts/d083ba2e/",
  "image": "https://s3.babudiu.com/iuxt/public/Docker.svg",
  "datePublished": "2022-04-25T14:13:22.000Z",
  "dateModified": "2025-07-11T15:21:31.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "张理坤",
      "url": "https://zahui.fan/"
    }
  ]
}</script><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="https://zahui.fan/posts/d083ba2e/"><link rel="preconnect"/><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""/><link rel="preconnect" href="//hm.baidu.com"/><link rel="manifest" href="/site.webmanifest"/><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"/><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="/pluginsSrc/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="/pluginsSrc/@fancyapps/ui/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'undefined')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'undefined')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?50b516d50102c8c9ac5f80529b81ca17";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
btf.addGlobalFn('pjaxComplete', () => {
  _hmt.push(['_trackPageview',window.location.pathname])
}, 'baidu_analytics')
</script><script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-YN0WWZGVYN"></script><script>window.dataLayer = window.dataLayer || []
function gtag(){dataLayer.push(arguments)}
gtag('js', new Date())
gtag('config', 'G-YN0WWZGVYN')
btf.addGlobalFn('pjaxComplete', () => {
  gtag('config', 'G-YN0WWZGVYN', {'page_path': window.location.pathname})
}, 'google_analytics')
</script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":600,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: '/pluginsSrc/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Docker容器间优雅的互联',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="https://s3.babudiu.com/iuxt/libs/lxgw-wenkai-screen-webfont/style.min.css" /><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="杂烩饭" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="https://s3.babudiu.com/iuxt/public/dog.svg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">373</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">222</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 工具</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://bbk-games.zahui.fan/"><i class="fa-fw fas fa-gamepad"></i><span> 步步高小游戏</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://aria2.babudiu.com/"><i class="fa-fw fas fa-download"></i><span> Aria2NG</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa-solid fa-paperclip"></i><span> 林克</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa-brands fa-apple fa-bounce"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg fixed" id="page-header" style="background-image: url(https://s3.babudiu.com/iuxt/public/Docker.svg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="https://s3.babudiu.com/iuxt/public/boob.png" alt="Logo"><span class="site-name">杂烩饭</span></a><a class="nav-page-title" href="/"><span class="site-name">Docker容器间优雅的互联</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 工具</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://bbk-games.zahui.fan/"><i class="fa-fw fas fa-gamepad"></i><span> 步步高小游戏</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://aria2.babudiu.com/"><i class="fa-fw fas fa-download"></i><span> Aria2NG</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa-solid fa-paperclip"></i><span> 林克</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa-brands fa-apple fa-bounce"></i><span> 关于</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Docker容器间优雅的互联</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-04-25T14:13:22.000Z" title="发表于 2022-04-25 22:13:22">2022-04-25</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-07-11T15:21:31.000Z" title="更新于 2025-07-11 23:21:31">2025-07-11</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%AE%B9%E5%99%A8/">容器</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:365,&quot;messagePrev&quot;:&quot;此文章距离发布已经&quot;,&quot;messageNext&quot;:&quot;天了，内容可能已经过时，请自行判断是否可用或联系博主更新。&quot;,&quot;postUpdate&quot;:&quot;2025-07-11 23:21:31&quot;}" hidden></div><p>本文主要介绍如何优雅的让 Docker 容器和 Docker 容器之间相互通信，以及 Docker 容器如何和宿主机进行网络通信。</p>
<h2 id="容器间网络通信"><a href="#容器间网络通信" class="headerlink" title="容器间网络通信"></a>容器间网络通信</h2><p>docker 容器间通信常见的方式是使用 –link 进行连接，但是 Docker 已经弃用这种方式，并且容器数量一旦一多，–link 会显得很乱。官方推荐使用自定义网络来进行互联。</p>
<h3 id="创建自定义网络"><a href="#创建自定义网络" class="headerlink" title="创建自定义网络"></a>创建自定义网络</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network create my-network</span><br></pre></td></tr></table></figure>

<h3 id="创建容器使用自定义-network"><a href="#创建容器使用自定义-network" class="headerlink" title="创建容器使用自定义 network"></a>创建容器使用自定义 network</h3><p>比如一个 nginx 容器需要访问 php 容器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 80:80 --network my-network nginx</span><br><span class="line">docker run --name php --network my-network php</span><br></pre></td></tr></table></figure>

<p>这个时候 nginx 可以直接通过 <code>php</code> 来访问 php 容器，打开&#x2F;etc&#x2F;hosts 可以发现是 docker 自动帮你添加了解析</p>
<h2 id="容器访问主机服务"><a href="#容器访问主机服务" class="headerlink" title="容器访问主机服务"></a>容器访问主机服务</h2><p>可以使用容器的网关 IP 来访问（nat 网络），不过使用 ip 不优雅，旧版本的 Docker 可以使用 <code>host.docker.internal</code> 来访问主机，新版本的无法直接访问，可以通过 <code>docker run</code> 增加启动参数来兼容这种方案</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">docker run --name nginx \</span><br><span class="line">  -v <span class="string">&quot;<span class="subst">$(pwd)</span>&quot;</span>/www:/usr/share/nginx/html:ro \</span><br><span class="line">  -v <span class="string">&quot;<span class="subst">$(pwd)</span>&quot;</span>/conf/nginx.conf:/etc/nginx/nginx.conf \</span><br><span class="line">  -v <span class="string">&quot;<span class="subst">$(pwd)</span>&quot;</span>/conf/conf.d:/etc/nginx/conf.d \</span><br><span class="line">  -v <span class="string">&quot;<span class="subst">$(pwd)</span>&quot;</span>/conf/ssl:/etc/nginx/ssl \</span><br><span class="line">  -p 80:80 \</span><br><span class="line">  -p 443:443 \</span><br><span class="line">  --add-host=host.docker.internal:host-gateway \</span><br><span class="line">  --network iuxt \</span><br><span class="line">  --restart always \</span><br><span class="line">  -d nginx</span><br></pre></td></tr></table></figure>

<p>之后就可以在容器内通过 <code>host.docker.internal</code> 来访问主机了。</p>
<h2 id="使用固定的-ip-进行通信"><a href="#使用固定的-ip-进行通信" class="headerlink" title="使用固定的 ip 进行通信"></a>使用固定的 ip 进行通信</h2><p>如果想固定每个容器的 IP，比如想部署一个 ElasticSearch 集群，需要每个节点 IP 都配置到配置文件里面。可以使用这种方式：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建一个Docker网络</span></span><br><span class="line">docker network create --subnet=172.16.0.0/24 elasticsearch-br0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 每个容器手动指定使用这个Docker网络，并分配固定的IP</span></span><br><span class="line">docker run -d --name elasticsearch1 \</span><br><span class="line">    -e <span class="string">&quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot;</span> \</span><br><span class="line">    -v <span class="string">&quot;<span class="subst">$(pwd)</span>&quot;</span>/elasticsearch1.yml:/usr/share/elasticsearch/config/elasticsearch.yml:ro \</span><br><span class="line">    -v es-data1:/usr/share/elasticsearch/data:rw \</span><br><span class="line">    -v es-logs1:/usr/share/elasticsearch/logs:rw \</span><br><span class="line">    --network elasticsearch-br0 \</span><br><span class="line">    --ip 172.16.0.11 \</span><br><span class="line">    -p 9201:9200 -p 9301:9300 \</span><br><span class="line">    elasticsearch:7.16.2</span><br><span class="line"></span><br><span class="line">docker run -d --name elasticsearch2 \</span><br><span class="line">    -e <span class="string">&quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot;</span> \</span><br><span class="line">    -v <span class="string">&quot;<span class="subst">$(pwd)</span>&quot;</span>/elasticsearch2.yml:/usr/share/elasticsearch/config/elasticsearch.yml:ro \</span><br><span class="line">    -v es-data2:/usr/share/elasticsearch/data:rw \</span><br><span class="line">    -v es-logs2:/usr/share/elasticsearch/logs:rw \</span><br><span class="line">    --network elasticsearch-br0 \</span><br><span class="line">    --ip 172.16.0.12 \</span><br><span class="line">    -p 9202:9200 -p 9302:9300 \</span><br><span class="line">    elasticsearch:7.16.2</span><br><span class="line"></span><br><span class="line">docker run -d --name elasticsearch3 \</span><br><span class="line">    -e <span class="string">&quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot;</span> \</span><br><span class="line">    -v <span class="string">&quot;<span class="subst">$(pwd)</span>&quot;</span>/elasticsearch3.yml:/usr/share/elasticsearch/config/elasticsearch.yml:ro \</span><br><span class="line">    -v es-data3:/usr/share/elasticsearch/data:rw \</span><br><span class="line">    -v es-logs3:/usr/share/elasticsearch/logs:rw \</span><br><span class="line">    --network elasticsearch-br0 \</span><br><span class="line">    --ip 172.16.0.13 \</span><br><span class="line">    -p 9203:9200 -p 9303:9300 \</span><br><span class="line">    elasticsearch:7.16.2</span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://zahui.fan">张理坤</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://zahui.fan/posts/d083ba2e/">https://zahui.fan/posts/d083ba2e/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://zahui.fan" target="_blank">杂烩饭</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Docker/">Docker</a><a class="post-meta__tags" href="/tags/Container/">Container</a></div><div class="post-share"><div class="social-share" data-image="https://s3.babudiu.com/iuxt/public/Docker.svg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="/pluginsSrc/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="/pluginsSrc/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/ee708f6b/" title="Elasticsearch常用API操作"><img class="cover" src="https://s3.babudiu.com/iuxt/public/elasticsearch.svg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">Elasticsearch常用API操作</div></div><div class="info-2"><div class="info-item-1">如果有 Kibana 的话，以下所有操作都可以在 Kibana 的 DevTools 页面进行调试，可以免去认证操作。     接口 功能    &#x2F;_cat&#x2F;health?v 集群健康状态   &#x2F;_cat&#x2F;shards 分片信息   &#x2F;_cat&#x2F;nodes 节点信息   &#x2F;_cat&#x2F;indices 索引信息   &#x2F;_cat&#x2F;allocation?v 磁盘占用   &#x2F;索引名字&#x2F;_mapping?pretty 查看 mapping（索引字段类型等）   ?v 是详细信息输出 索引查看、创建、删除12345678# 查看有哪些索引curl -u elastic:password localhost:9200/_cat/indices# 创建索引curl -u elastic:password -X PUT &quot;localhost:9200/索引名字?pretty&quot;# 删除索引curl -u elastic:password -s -XDELETE...</div></div></div></a><a class="pagination-related" href="/posts/265ea5f9/" title="MySQL主从同步配置"><img class="cover" src="https://s3.babudiu.com/iuxt/public/MySQL.svg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">MySQL主从同步配置</div></div><div class="info-2"><div class="info-item-1">主从同步可以相当于实时备份，读写分离还能提高数据库的性能，记录一下主从同步的配置 不停机增加从库可以查看 优雅地给正在运行的MySQL添加从库 一.准备 主从数据库版本最好一致 保证数据库的 uuid 不一致     服务器 ip 地址    MySQL Master 192.168.21.53   MySQL Slave 192.168.21.54   二.操作主数据库操作开启 binlog123[mysqld]log_bin=mysql-binserver-id=1  这里注意 server-id 主从不能一样, 配置完成重启 mysql 创建用于同步的用户账号登陆数据库 1mysql -hlocalhost -uroot -ppassword  创建用户并授权 1CREATE USER &#x27;repl&#x27;@&#x27;%&#x27; IDENTIFIED BY &#x27;A4MyDNdzpHvg5M02KRtm&#x27;;  授权 12GRANT REPLICATION SLAVE ON *.* TO...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/posts/lmucp5lg/" title="Dockerfile中ADD文件的路径问题"><img class="cover" src="https://s3.babudiu.com/iuxt/public/Docker.svg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="fas fa-history fa-fw"></i> 2025-07-11</div><div class="info-item-2">Dockerfile中ADD文件的路径问题</div></div><div class="info-2"><div class="info-item-1">首先看一个案例 当前目录的文件如下: 12345678[root@devops_build watcher_svr]# tree.├── 1├── 2│   └── 3└── Dockerfile1 directory, 3 files  Dockerfile 文件内容如下: 123FROM node:14.20.1-busterADD * /code/WORKDIR /code  本意是想把当前目录下的所有文件放到容器内的 /code 目录, 这个时候使用 docker build 后无法启动, 进入容器, 打开 /code 一看: 123456789[root@devops_build watcher_svr]# docker run -it test bashroot@cb7543054ef2:/code# ls -altotal 12drwxr-xr-x 2 root root 4096 Sep 22 08:47 .drwxr-xr-x 1 root root 4096 Sep 22 08:47 ..-rw-r--r-- 1 root root    0 Sep 22...</div></div></div></a><a class="pagination-related" href="/posts/581a1bd9/" title="Docker不支持中文解决方案"><img class="cover" src="https://s3.babudiu.com/iuxt/public/Docker.svg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="fas fa-history fa-fw"></i> 2025-07-11</div><div class="info-item-2">Docker不支持中文解决方案</div></div><div class="info-2"><div class="info-item-1"> ubuntu 官方镜像默认的字符集支持 C, C.UTF-8, and POSIX  查看容器使用的字符集 12345678910111213141516root@huige-demo-web-0:/var/www/html/forum/files#...</div></div></div></a><a class="pagination-related" href="/posts/4bc23141/" title="Docker常用配置"><img class="cover" src="https://s3.babudiu.com/iuxt/public/Docker.svg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="fas fa-history fa-fw"></i> 2025-07-11</div><div class="info-item-2">Docker常用配置</div></div><div class="info-2"><div class="info-item-1">docker 安装官方安装脚本1curl -fsSL get.docker.com | bash  阿里云安装（centos）12345678910111213# step 1: 安装必要的一些系统工具sudo yum install -y yum-utils device-mapper-persistent-data lvm2# Step 2: 添加软件源信息sudo yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo# Step 3: 更新并安装Docker-CEsudo yum makecache fastsudo yum -y install docker-ce# Step 4: 开启Docker服务sudo systemctl start docker.service  docker-compose 安装1sudo curl -L...</div></div></div></a><a class="pagination-related" href="/posts/23f11af0/" title="Kubernetes 绑定Hosts的正确姿势"><img class="cover" src="https://s3.babudiu.com/iuxt/public/kubernetes.svg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="fas fa-history fa-fw"></i> 2025-07-11</div><div class="info-item-2">Kubernetes 绑定Hosts的正确姿势</div></div><div class="info-2"><div class="info-item-1">有的时候我们需要在容器里面绑定 hosts，比如我们用 logstash 需要消费 kafka 消息，但是 kafka 监听的地址是 hostname，这个时候就需要绑定 hosts（规范一点是做解析）在容器里面绑定 hosts 常见的方法一种是挂载主机的 hosts 文件，一种是修改容器的启动 CMD，每次启动修改 hosts，这两种方法都有个缺点，就是不受 kubelet 管理了，默认的 hosts 内容也会被覆盖掉在 k8s 环境下有更好的解决方案：那就是让 k8s 自己来管理 使用 hostAliases 来绑定 hosts12345678910111213141516171819202122232425apiVersion: apps/v1kind: Deploymentmetadata:  name: logstash-k8s  namespace: opsspec:  replicas: 1  selector:    matchLabels:      app: logstash-k8s  template:    metadata:      labels: ...</div></div></div></a><a class="pagination-related" href="/posts/ffacccf0/" title="使用 docker buildx 构建不同平台的镜像"><img class="cover" src="https://s3.babudiu.com/iuxt/images/202412031037042.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="fas fa-history fa-fw"></i> 2025-07-11</div><div class="info-item-2">使用 docker buildx 构建不同平台的镜像</div></div><div class="info-2"><div class="info-item-1"> 一直使用 oracle 提供的免费 arm 云服务器，自己的 pc 又是 x86 架构，x86 构建出来的镜像不能在 arm 平台使用  使用 buildx 可以生成跨平台镜像，跨平台镜像就是同一个镜像名称，同一个 tag，但是 arm 机器和 amd64 机器拉下来的镜像 hash 是不一样的 创建 docker buildx 构建环境 这里的 driver 有两种，一种是 docker-container，一种是 docker，构建多平台版本只能使用 docker-container, –use 是将切换为默认  1docker buildx create --use --name buildx --node buildx --driver-opt network=host  准备 qemu 模拟器构建不通架构的镜像是通过 qemu 来模拟的，你会发现构建过程中，和 build 机器同架构的会构建很快，不同架构构建很慢。 12345678# 安装全部模拟器docker run --privileged --rm tonistiigi/binfmt --install...</div></div></div></a><a class="pagination-related" href="/posts/b86d9e9f/" title="使用kubeadm部署一套高可用k8s集群1.21 for CentOS"><img class="cover" src="https://s3.babudiu.com/iuxt/public/Kubeadm.svg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="fas fa-history fa-fw"></i> 2025-10-29</div><div class="info-item-2">使用kubeadm部署一套高可用k8s集群1.21 for CentOS</div></div><div class="info-2"><div class="info-item-1"> 基于 centos 使用 kubeadm 搭建集群， ubuntu部署文档, 有疑问的地方可以看 官方文档  准备机器 我的机器详情如下, 配置至少为 4C4G     hostname IP 作用    public 10.0.0.3 ingress 和 apiserver 的负载均衡，nfs 存储   master1 10.0.0.11 k8s master 节点   master2 10.0.0.12 k8s master 节点   master3 10.0.0.13 k8s master 节点   worker1 10.0.0.21 k8s worker 节点   worker2 10.0.0.22 k8s worker 节点   每台机器都做域名解析，或者绑定 hosts(可选但建议) 123456vim /etc/hosts10.0.0.3  public kube-apiserver10.0.0.11 master110.0.0.12 master210.0.0.13 master3  每台机器都关闭防火墙和 SELinux  负载均衡机器必须要关闭,因为...</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="giscus-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="https://s3.babudiu.com/iuxt/public/dog.svg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">张理坤</div><div class="author-info-description">张理坤的博客</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">373</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">222</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div><a id="card-info-btn" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/iuxt"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/iuxt" rel="external nofollow noreferrer" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:x@zahui.fan" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://space.bilibili.com/165330963" rel="external nofollow noreferrer" target="_blank" title="Bilibili"><i class="fa-brands fa-bilibili"></i></a><a class="social-icon" href="https://stackoverflow.com/users/15620461/" rel="external nofollow noreferrer" target="_blank" title="StackOverflow"><i class="fa-brands fa-stack-overflow"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title="RSS"><i class="fa-solid fa-square-rss"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">此博客为我记录运维工作总结所用，供网友阅读参考，如有侵权，请通知我，我会核实后进行处理。</br>
<strong style="color: red;">欢迎加入技术交流群：</strong>
<div class="aside-qrcode" >
<img src="https://src.babudiu.com/card/wechat_ops_group.JPG" title="微信群" width="100%" height="auto">
</div>
</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E9%97%B4%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1"><span class="toc-number">1.</span> <span class="toc-text">容器间网络通信</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BD%91%E7%BB%9C"><span class="toc-number">1.1.</span> <span class="toc-text">创建自定义网络</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%AE%B9%E5%99%A8%E4%BD%BF%E7%94%A8%E8%87%AA%E5%AE%9A%E4%B9%89-network"><span class="toc-number">1.2.</span> <span class="toc-text">创建容器使用自定义 network</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E8%AE%BF%E9%97%AE%E4%B8%BB%E6%9C%BA%E6%9C%8D%E5%8A%A1"><span class="toc-number">2.</span> <span class="toc-text">容器访问主机服务</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9B%BA%E5%AE%9A%E7%9A%84-ip-%E8%BF%9B%E8%A1%8C%E9%80%9A%E4%BF%A1"><span class="toc-number">3.</span> <span class="toc-text">使用固定的 ip 进行通信</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/cb400b2a/" title="我们为什么要用容器(或者说k8s)"><img src="https://s3.babudiu.com/iuxt/public/kubernetes.svg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="我们为什么要用容器(或者说k8s)"/></a><div class="content"><a class="title" href="/posts/cb400b2a/" title="我们为什么要用容器(或者说k8s)">我们为什么要用容器(或者说k8s)</a><time datetime="2025-12-21T13:04:45.000Z" title="更新于 2025-12-21 21:04:45">2025-12-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/scpj14/" title="单节点Kubernetes更换ip地址"><img src="https://s3.babudiu.com/iuxt/public/kubernetes.svg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="单节点Kubernetes更换ip地址"/></a><div class="content"><a class="title" href="/posts/scpj14/" title="单节点Kubernetes更换ip地址">单节点Kubernetes更换ip地址</a><time datetime="2025-12-21T13:03:00.000Z" title="更新于 2025-12-21 21:03:00">2025-12-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/518e617c/" title="git常用操作记录"><img src="https://s3.babudiu.com/iuxt/public/skeleton1.svg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="git常用操作记录"/></a><div class="content"><a class="title" href="/posts/518e617c/" title="git常用操作记录">git常用操作记录</a><time datetime="2025-12-20T13:26:16.000Z" title="更新于 2025-12-20 21:26:16">2025-12-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/t79irt/" title="容器调试工具之BusyBox"><img src="https://s3.babudiu.com/iuxt/public/skeleton1.svg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="容器调试工具之BusyBox"/></a><div class="content"><a class="title" href="/posts/t79irt/" title="容器调试工具之BusyBox">容器调试工具之BusyBox</a><time datetime="2025-12-14T14:47:12.000Z" title="更新于 2025-12-14 22:47:12">2025-12-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/syv4vu/" title="minio自建对象存储"><img src="https://s3.babudiu.com/iuxt/2025/07/9b62bab970676aeef01b597ccff9a533.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="minio自建对象存储"/></a><div class="content"><a class="title" href="/posts/syv4vu/" title="minio自建对象存储">minio自建对象存储</a><time datetime="2025-12-07T05:34:57.000Z" title="更新于 2025-12-07 13:34:57">2025-12-07</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.3.5</a></div><div class="footer_custom_text"><a target="_blank" rel="noopener external nofollow noreferrer" href='https://www.upyun.com/?utm_source=lianmeng&utm_medium=referral'>
  本网站由<img src='https://s3.babudiu.com/iuxt/public/upyun.svg' alt='又拍云' width='70' height='28' style="vertical-align:bottom">
  提供CDN加速/云存储服务
</a>
</br>
<a href="https://beian.miit.gov.cn/" rel="external nofollow noreferrer" target="_blank">沪ICP备2021015230号-1</a>
</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/pluginsSrc/@fancyapps/ui/dist/fancybox/fancybox.umd.js"></script><script src="/pluginsSrc/vanilla-lazyload/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null

  const getGiscusTheme = theme => theme === 'dark' ? 'dark' : 'light'

  const createScriptElement = config => {
    const ele = document.createElement('script')
    Object.entries(config).forEach(([key, value]) => {
      ele.setAttribute(key, value)
    })
    return ele
  }

  const loadGiscus = (el = document, key) => {
    const mappingConfig = isShuoshuo
      ? { 'data-mapping': 'specific', 'data-term': key }
      : { 'data-mapping': (option && option['data-mapping']) || 'pathname' }

    const giscusConfig = {
      src: 'https://giscus.babudiu.com/client.js',
      'data-repo': 'iuxt/iuxt.github.io',
      'data-repo-id': 'R_kgDOMszkdA',
      'data-category-id': 'DIC_kwDOMszkdM4CiMyw',
      'data-theme': getGiscusTheme(document.documentElement.getAttribute('data-theme')),
      'data-reactions-enabled': '1',
      crossorigin: 'anonymous',
      async: true,
      ...option,
      ...mappingConfig
    }

    const scriptElement = createScriptElement(giscusConfig)

    el.querySelector('#giscus-wrap').appendChild(scriptElement)

    if (isShuoshuo) {
      window.shuoshuoComment.destroyGiscus = () => {
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }
  }

  const changeGiscusTheme = theme => {
    const iframe = document.querySelector('#giscus-wrap iframe')
    if (iframe) {
      const message = {
        giscus: {
          setConfig: {
            theme: getGiscusTheme(theme)
          }
        }
      }
      iframe.contentWindow.postMessage(message, 'https://giscus.babudiu.com')
    }
  }

  btf.addGlobalFn('themeChange', changeGiscusTheme, 'giscus')

  if (isShuoshuo) {
    'Giscus' === 'Giscus'
      ? window.shuoshuoComment = { loadComment: loadGiscus }
      : window.loadOtherComment = loadGiscus
    return
  }

  if ('Giscus' === 'Giscus' || !false) {
    if (false) btf.loadComment(document.getElementById('giscus-wrap'), loadGiscus)
    else loadGiscus()
  } else {
    window.loadOtherComment = loadGiscus
  }
})()</script></div><script async data-pjax src="https://events.vercount.one/js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜搜搜" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>